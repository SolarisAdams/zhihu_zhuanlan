{
    "title": "汽车软件及工具开发", 
    "description": "汽车软件及工具开发", 
    "followers": [
        "https://www.zhihu.com/people/zhang-yu-xiang-92", 
        "https://www.zhihu.com/people/shi-qi-shi-dai-jing-ling-wang", 
        "https://www.zhihu.com/people/feng-lei-4-6", 
        "https://www.zhihu.com/people/xie-yu-48", 
        "https://www.zhihu.com/people/su-mu-han-48", 
        "https://www.zhihu.com/people/wang-lao-ji-32-63", 
        "https://www.zhihu.com/people/zhao-qi-wu-88", 
        "https://www.zhihu.com/people/cheng-tao-74-61", 
        "https://www.zhihu.com/people/bao-ding-da-chang-cheng", 
        "https://www.zhihu.com/people/chen-lin-23-84", 
        "https://www.zhihu.com/people/jaker-96-74", 
        "https://www.zhihu.com/people/song-ji-84-1", 
        "https://www.zhihu.com/people/xie-miao-bo", 
        "https://www.zhihu.com/people/xiong-xiong-32-99", 
        "https://www.zhihu.com/people/shui-ban-wo-chuang-dang-24-86", 
        "https://www.zhihu.com/people/qiu-shan-57-39", 
        "https://www.zhihu.com/people/yao-xing-34-49", 
        "https://www.zhihu.com/people/niu-xiao-bai-74", 
        "https://www.zhihu.com/people/zww-48-67", 
        "https://www.zhihu.com/people/faihung", 
        "https://www.zhihu.com/people/rophy-luo", 
        "https://www.zhihu.com/people/guo-da-xia-16-74", 
        "https://www.zhihu.com/people/xie-jing-6-3", 
        "https://www.zhihu.com/people/zhao-qing-5-36", 
        "https://www.zhihu.com/people/mr-x-23-66", 
        "https://www.zhihu.com/people/ben-xiao-ye-you-qiang", 
        "https://www.zhihu.com/people/xia-xue-de-tian-kong-19", 
        "https://www.zhihu.com/people/wang-peng-93-55", 
        "https://www.zhihu.com/people/momo-67-69-33", 
        "https://www.zhihu.com/people/clockhunter", 
        "https://www.zhihu.com/people/chang-li-bo-94", 
        "https://www.zhihu.com/people/hheng-yu-y", 
        "https://www.zhihu.com/people/hedy-82-92-11", 
        "https://www.zhihu.com/people/vinton-42", 
        "https://www.zhihu.com/people/joney-20-96", 
        "https://www.zhihu.com/people/zhang-jian-36-25", 
        "https://www.zhihu.com/people/ivanli", 
        "https://www.zhihu.com/people/sharon-83-80", 
        "https://www.zhihu.com/people/geass-code", 
        "https://www.zhihu.com/people/li-yuan-36-79-49", 
        "https://www.zhihu.com/people/ding-la-44", 
        "https://www.zhihu.com/people/li-yu-76-91-69", 
        "https://www.zhihu.com/people/gua-feng-xia-yu-88", 
        "https://www.zhihu.com/people/jiang-nan-10-72", 
        "https://www.zhihu.com/people/xi-li-hua-la-91-31", 
        "https://www.zhihu.com/people/bu-tai-ai-chi-hong-shao-rou-14", 
        "https://www.zhihu.com/people/he-xing-61-14", 
        "https://www.zhihu.com/people/a-pu-40-29", 
        "https://www.zhihu.com/people/andy-wang-79-8", 
        "https://www.zhihu.com/people/ning-dao", 
        "https://www.zhihu.com/people/chi-an-40-35", 
        "https://www.zhihu.com/people/J-ASON", 
        "https://www.zhihu.com/people/zhoufeixin-30", 
        "https://www.zhihu.com/people/pan-pan-1-23-42", 
        "https://www.zhihu.com/people/klaus-99-33", 
        "https://www.zhihu.com/people/lao-bing-1-44", 
        "https://www.zhihu.com/people/deng-deng-wo-ha", 
        "https://www.zhihu.com/people/xing-chen-lei-71-39", 
        "https://www.zhihu.com/people/ha-ha-40-2-38", 
        "https://www.zhihu.com/people/dai-qb", 
        "https://www.zhihu.com/people/li-zhao-long-11", 
        "https://www.zhihu.com/people/jiang-wu-41", 
        "https://www.zhihu.com/people/sha-zhou-han-zhi-64", 
        "https://www.zhihu.com/people/yang-bing-bing-30", 
        "https://www.zhihu.com/people/xiao-ji-ji-31-72", 
        "https://www.zhihu.com/people/zhang-kang-ping-96-71", 
        "https://www.zhihu.com/people/hu-xi-ting-70", 
        "https://www.zhihu.com/people/qing-feng-96-40-22", 
        "https://www.zhihu.com/people/he-zhen-21-44", 
        "https://www.zhihu.com/people/lili-93-29-81", 
        "https://www.zhihu.com/people/ny-aniuzeng", 
        "https://www.zhihu.com/people/ying-jian-zai-huan", 
        "https://www.zhihu.com/people/dong-bei-xiao-bai-cai-93", 
        "https://www.zhihu.com/people/a-ha-2-29", 
        "https://www.zhihu.com/people/wangpingpia", 
        "https://www.zhihu.com/people/xiao-da-jiang-7", 
        "https://www.zhihu.com/people/raymond-lei-98", 
        "https://www.zhihu.com/people/guo-guo-guo-24-79-82", 
        "https://www.zhihu.com/people/empty-zhang", 
        "https://www.zhihu.com/people/yin-su-qun-30", 
        "https://www.zhihu.com/people/mariner-95", 
        "https://www.zhihu.com/people/zhang-qing-jie-39-73", 
        "https://www.zhihu.com/people/yi-jie-yi-shi", 
        "https://www.zhihu.com/people/gu-zhi-xin-12", 
        "https://www.zhihu.com/people/zhi-mi-88-51", 
        "https://www.zhihu.com/people/yuan-wei-62-15-36", 
        "https://www.zhihu.com/people/yao-yi-zheng-84", 
        "https://www.zhihu.com/people/way-22-36", 
        "https://www.zhihu.com/people/dianye", 
        "https://www.zhihu.com/people/andrei.zhu", 
        "https://www.zhihu.com/people/jian-jiu-20", 
        "https://www.zhihu.com/people/xu-shuo-42", 
        "https://www.zhihu.com/people/hc-li-34", 
        "https://www.zhihu.com/people/wayne_yi", 
        "https://www.zhihu.com/people/lu-yi-wang-1", 
        "https://www.zhihu.com/people/gao-xuan-19-42", 
        "https://www.zhihu.com/people/curry-89-76", 
        "https://www.zhihu.com/people/a-huan-28-8", 
        "https://www.zhihu.com/people/jforever-5", 
        "https://www.zhihu.com/people/YPHFree", 
        "https://www.zhihu.com/people/xxx-72-25", 
        "https://www.zhihu.com/people/yuyu0821", 
        "https://www.zhihu.com/people/ni-zhao-hui-24", 
        "https://www.zhihu.com/people/ni-gou-38-11", 
        "https://www.zhihu.com/people/zhang-yu-an-92", 
        "https://www.zhihu.com/people/zhicheng-yang", 
        "https://www.zhihu.com/people/du-jiang-tao-50", 
        "https://www.zhihu.com/people/zhang-en-ze-25", 
        "https://www.zhihu.com/people/bian-su-qi-jian-zhi-gong-cheng-shi", 
        "https://www.zhihu.com/people/wei-zhao-49", 
        "https://www.zhihu.com/people/lwj-23-89", 
        "https://www.zhihu.com/people/xixi-85-15", 
        "https://www.zhihu.com/people/che-liang-lin", 
        "https://www.zhihu.com/people/hymao-90", 
        "https://www.zhihu.com/people/blush", 
        "https://www.zhihu.com/people/yu-ming-6-1", 
        "https://www.zhihu.com/people/li-pei-yu-52", 
        "https://www.zhihu.com/people/yunhaitingtao_rtaws", 
        "https://www.zhihu.com/people/han11-74", 
        "https://www.zhihu.com/people/wu-ming-wei-30-82", 
        "https://www.zhihu.com/people/jiang-er-fan", 
        "https://www.zhihu.com/people/x.gong", 
        "https://www.zhihu.com/people/xia-you-dao-21", 
        "https://www.zhihu.com/people/diego", 
        "https://www.zhihu.com/people/jeff-77-10", 
        "https://www.zhihu.com/people/hevehicle", 
        "https://www.zhihu.com/people/zuoguangsheng", 
        "https://www.zhihu.com/people/ga-ou", 
        "https://www.zhihu.com/people/xiu-qi-che-de-shu-ke", 
        "https://www.zhihu.com/people/duan-ji-lue", 
        "https://www.zhihu.com/people/tie-xiao-tie-93", 
        "https://www.zhihu.com/people/zhou-min-61", 
        "https://www.zhihu.com/people/chenzhongxu", 
        "https://www.zhihu.com/people/wyman-lei", 
        "https://www.zhihu.com/people/du-gu-wu-di-83-40", 
        "https://www.zhihu.com/people/ying-wei-lai-13", 
        "https://www.zhihu.com/people/shuang-yue-shang-du", 
        "https://www.zhihu.com/people/yi-ge-ji-zhi-de-ren", 
        "https://www.zhihu.com/people/cai-cong-cong-55", 
        "https://www.zhihu.com/people/qianpengpeng", 
        "https://www.zhihu.com/people/zhang-he-57-20", 
        "https://www.zhihu.com/people/hideinspring", 
        "https://www.zhihu.com/people/xia-yu-71-71-60", 
        "https://www.zhihu.com/people/wo-de-tian-kong-xia-de", 
        "https://www.zhihu.com/people/wang-kang-ming-94", 
        "https://www.zhihu.com/people/bai-chi-gan-tou-80", 
        "https://www.zhihu.com/people/yang-ming-53-32", 
        "https://www.zhihu.com/people/wu-kong-45-2-9", 
        "https://www.zhihu.com/people/fu-wu-qiong-32", 
        "https://www.zhihu.com/people/chen-si-hao-97-42", 
        "https://www.zhihu.com/people/chen-ge-18-1", 
        "https://www.zhihu.com/people/feng-lin-shuang-ye", 
        "https://www.zhihu.com/people/shi-jie-nian-xin", 
        "https://www.zhihu.com/people/su-hao-91-44", 
        "https://www.zhihu.com/people/anhuang-14", 
        "https://www.zhihu.com/people/li-gong-38-6", 
        "https://www.zhihu.com/people/fancy-22-55", 
        "https://www.zhihu.com/people/jie-yang-84", 
        "https://www.zhihu.com/people/xiao-ming-de-zi-xing-che", 
        "https://www.zhihu.com/people/meng-xiao-qun-71", 
        "https://www.zhihu.com/people/song-jia-94-28", 
        "https://www.zhihu.com/people/khq-43", 
        "https://www.zhihu.com/people/qiu-yu-92-47", 
        "https://www.zhihu.com/people/qing-cai-xiao-wan-zi", 
        "https://www.zhihu.com/people/chen-ming-82-75", 
        "https://www.zhihu.com/people/shen-guang-31", 
        "https://www.zhihu.com/people/xiaoniao-73", 
        "https://www.zhihu.com/people/benjamin1st", 
        "https://www.zhihu.com/people/wu-ming-39-5-23", 
        "https://www.zhihu.com/people/er-yue-er-41-68", 
        "https://www.zhihu.com/people/gogo-91-76", 
        "https://www.zhihu.com/people/fang-wei-40", 
        "https://www.zhihu.com/people/ContiSilva", 
        "https://www.zhihu.com/people/wixbao", 
        "https://www.zhihu.com/people/qi-che-ren-82", 
        "https://www.zhihu.com/people/guan-wu-zhi", 
        "https://www.zhihu.com/people/han-fang-xu-19", 
        "https://www.zhihu.com/people/ni-shuo-wo-zou-bu-zou-ni", 
        "https://www.zhihu.com/people/hua_hua", 
        "https://www.zhihu.com/people/guangj-ai", 
        "https://www.zhihu.com/people/li-gen-47-57", 
        "https://www.zhihu.com/people/bing-al", 
        "https://www.zhihu.com/people/mei-you-ni-cheng-93-13", 
        "https://www.zhihu.com/people/wu-an-ping-92", 
        "https://www.zhihu.com/people/openes", 
        "https://www.zhihu.com/people/di-sheng-19-26-62"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/67674852", 
            "userName": "云天河", 
            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
            "upvote": 15, 
            "title": "OBD(On-Board Diagnostic)介绍", 
            "content": "<p>       OBD（on-Board Diagnostics）全称车载诊断系统，起源于19世纪80年代的美国，当时美国为了控制汽车排放，规定加州销售车辆装备车载诊断系统，也是最早的OBD系统。最早的OBD系统也称OBD-I，监控范围包括氧传感器、排气再循环系统、然后供给系统和发动机控制模块，只能检测到与排放有关部件的连续性故障，无法监测其渐进损坏情况。同时系统没有同意的标准，使用的协议也不相同，投入之后效果并不好。</p><p>       针对OBD-I 出现的缺陷，SAE（美国汽车工程师协议）制定了OBD-II系统，并制定了一系列相关的标准和规范。相对于之前的OBD-I， OBD-II采用了标准化的16针诊断座DL、相同的故障代码DTC和标准化通信协议，并且扩充了系统的检测项目，欧洲共同体基于也在同时规定了欧洲版的EOBD，也采用统一的诊断座、通信协议和故障代码等，两者基本原理和诊断项目类似。</p><p>       OBD系统在我国发展较迟，在05年，国家环保总局颁布了规定在2007年7月1日实施国III排放法规，我国的排放法规与欧洲的排放标准类似。尽管OBD-II针对汽车排放起到明显的控制作用，为了更及时监测排放，OBD-III也出现了。增加了无线通信方式来读取发送机、变速器和ABS系统ECU中的数据，将车辆识别代码（VIN）、故障码等一些数据自动传送到交通管理部分，不过由于该系统可能涉及侵犯用户隐私，所以在考察中。</p><p>1.1 工作原理</p><p>       OBD系统的监控对象是传感器、执行器以及电子控制器本身，通过实时监测与排放相关的部件的工作信号，来判断汽车尾气排放是否超标，如果某些信号发生异常变化而出现排放超标的现象，系统会判断这一信号相关的部件或电路出现故障，点亮故障指示灯（MIL）并将对应故障码存入内部数据。故障信息可以通过诊断仪来读取。</p><p>1.2 系统结构</p><p>      车载中的诊断软件、传感器、执行器、诊断座以及外围的诊断仪设备共同组成了OBD系统，诊断口统一为16针，一般装在方向盘下方的内饰板中，分布如下图：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-cace6c6da0253d95df8ef6865a3ad4f6_b.jpg\" data-size=\"normal\" data-rawwidth=\"367\" data-rawheight=\"233\" class=\"content_image\" width=\"367\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;367&#39; height=&#39;233&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"367\" data-rawheight=\"233\" class=\"content_image lazy\" width=\"367\" data-actualsrc=\"https://pic3.zhimg.com/v2-cace6c6da0253d95df8ef6865a3ad4f6_b.jpg\"/><figcaption>OBD插口</figcaption></figure><p>      OBD输出参考标准为ISO15031，共6部分，包括诊断信息的通信方式、诊断数据的获取、故障码定义等多种标准，其中ISO15031-5 排放有关诊断服务规定了诊断数据的输出格式和单位。此外SAE J1979也是定义输出标准，功能与ISO 15031一致。ISO 15031和SAE J1979的标准兼容CAN和K_line通讯</p><p>1.3 OBD输出内容：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-927816d5ac6eeff0611968d11e32c29d_b.jpg\" data-size=\"normal\" data-rawwidth=\"1037\" data-rawheight=\"310\" class=\"origin_image zh-lightbox-thumb\" width=\"1037\" data-original=\"https://pic2.zhimg.com/v2-927816d5ac6eeff0611968d11e32c29d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1037&#39; height=&#39;310&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1037\" data-rawheight=\"310\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1037\" data-original=\"https://pic2.zhimg.com/v2-927816d5ac6eeff0611968d11e32c29d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-927816d5ac6eeff0611968d11e32c29d_b.jpg\"/><figcaption>OBD支持的功能</figcaption></figure><p>2. OBD 各自子功能介绍</p><p><b>2.1  关于Mode $01 :读取动力系统诊断当前诊断数据</b><br/>       除所要求的冻结帧数据信息外，一旦需要，还应能够通过标准数据连接器的串口获得下述信息（如果车载电控单元具有、或通过车载电控单元能够被确定的信息）：诊断故障码、发动机冷却液温度、燃料控制系统状态（闭环/开环及其它）、燃油修正、点火正时提前、进气温度、歧管空气压力、空气流量、发动机转速、节气门位置传感器输出值、二次空气状态（上游、下游或大气）、计算的负荷值、车速和燃油压力。</p><p>以上是法规中的要求。</p><p>请求格式如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5862f62dac320587f5a0c17ffb90d224_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"216\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-5862f62dac320587f5a0c17ffb90d224_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;216&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"216\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-5862f62dac320587f5a0c17ffb90d224_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-5862f62dac320587f5a0c17ffb90d224_b.jpg\"/><figcaption>OBD mode 01 request</figcaption></figure><p>PID具体定义参考SAE J1979</p><p>回复格式如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-e4b7c4b5719d38454423da1d7f044d35_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"310\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-e4b7c4b5719d38454423da1d7f044d35_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;310&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"310\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-e4b7c4b5719d38454423da1d7f044d35_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-e4b7c4b5719d38454423da1d7f044d35_b.jpg\"/><figcaption>OBD mode 01 response</figcaption></figure><p>ECU支持的PID列表众多，我们可以通过发送特定的PID来查询是否支持。规定各个PID对应的范围表格如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-a6f88288d319fcac53c7b637e053d590_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"236\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-a6f88288d319fcac53c7b637e053d590_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;236&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"236\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-a6f88288d319fcac53c7b637e053d590_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-a6f88288d319fcac53c7b637e053d590_b.jpg\"/><figcaption>OBD 01 request support PIDs</figcaption></figure><p>如果你单独发送 01 00，表示查询在PID01-20之间，ECU支持哪些，如果支持的话，对应的bit位会置1。如果你发送01 00 20 40 60 80 A0，基本查询所有支持的PID，比如ECU#1支持的回复如下:</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a9a7f9eb3deb6a788dc27d51a2a5dc0d_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"298\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-a9a7f9eb3deb6a788dc27d51a2a5dc0d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;298&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"298\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-a9a7f9eb3deb6a788dc27d51a2a5dc0d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-a9a7f9eb3deb6a788dc27d51a2a5dc0d_b.jpg\"/><figcaption>OBD 01 response supported PIDs</figcaption></figure><p>通过以上信息解读，该ECU#1支持PID03-08，PID0B-10，不支持PID29-30。</p><p>现在通过这个命令我们已经了解ECU支持的PID列表，我们可以查询具体的数据信息，比如PID05 表示发送机冷却温度，PID0C 表示发送机速度，我们可以发送指令：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-5e1eb235610f143992eab393bd98f1e6_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"233\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-5e1eb235610f143992eab393bd98f1e6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;233&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"233\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-5e1eb235610f143992eab393bd98f1e6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-5e1eb235610f143992eab393bd98f1e6_b.jpg\"/><figcaption>OBD 01 resquest example</figcaption></figure><p>Table136这个表里一次性发送查询很多信息，包括水温，转速，车速等信息。这个时候ECU#1 回复了自己支持的PID 具体数据信息，如下图：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-8e71b98eb66cfc06b68d38a04ad3293e_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"427\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-8e71b98eb66cfc06b68d38a04ad3293e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;427&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"427\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-8e71b98eb66cfc06b68d38a04ad3293e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-8e71b98eb66cfc06b68d38a04ad3293e_b.jpg\"/><figcaption>OBD mode 01 response example</figcaption></figure><p>上表里所有支持的数据都体现出来。如果简化来讲，我们只查询PID 01,</p><p>发送：01 01</p><p>回复：41 01 83 07 EF 63</p><p>PID 01后面跟了4个字节，每个字节的bit表示不同含义，这里就不再详述了。</p><p><b>2.2 关于Mode $02 读取冻结帧数据法规要求如下描述 :</b></p><p><b>       一旦测定了任何部件或系统的首次故障</b>，应将当时发动机状态的冻结帧存储在电控单元存储器中。如果随后发生了<b>供油系统或失火故障</b>，任何原存储的冻结帧应被供油系统或失火状态（取先发生者）所替代。<b>存储的发动机状态应包括，但不限于</b>：计算的负荷值、发动机转速、燃油修正值（如有）、燃油压力（如有）、车速（如有）、冷却液温度、进气支管压力（如有）、闭环或开环运转状态（如有）和引发上述数据被存储的故障代码<b>………</b></p><p>必须按照IA.6.5.3的规定，以<b>标准单位</b>提供这些信号。实际信号必须能从默认值或跛行回家信号中被清晰地单独分辨出。</p><p>发送报文示例：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-dd81aa3bcd54918840359755d1ce0dff_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"159\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-dd81aa3bcd54918840359755d1ce0dff_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;159&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"159\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-dd81aa3bcd54918840359755d1ce0dff_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-dd81aa3bcd54918840359755d1ce0dff_b.jpg\"/><figcaption>OBD mode 02 request </figcaption></figure><p>回复报文：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-ae75c2a8f7a109047967e236c761458b_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"187\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-ae75c2a8f7a109047967e236c761458b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;187&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"187\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-ae75c2a8f7a109047967e236c761458b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-ae75c2a8f7a109047967e236c761458b_b.jpg\"/><figcaption>OBD mode 02 response</figcaption></figure><p>Frame表示组别，00是OBD标准规定的，如果主机厂自定义其他的帧，可以分其他编号，比如01,02等。</p><p><b>2.3 关于Mode $03：读取排放相关动力系诊断故障码</b></p><p>      Mode 3使外部设备获取排放相关的动力系的确认的故障代码。如果同一故障在40个以上发动机暖机循环内不再出现，车载诊断系统可以清除该故障代码，Mode 3不再输出该故障码。</p><p>发送格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-428a56a7c3aae940e565d9c55535e76f_b.png\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"73\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-428a56a7c3aae940e565d9c55535e76f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;73&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"73\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-428a56a7c3aae940e565d9c55535e76f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-428a56a7c3aae940e565d9c55535e76f_b.png\"/><figcaption>OBD mode 03 request</figcaption></figure><p>回复格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-819514891d65136b96205edc0d3f8709_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"221\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-819514891d65136b96205edc0d3f8709_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;221&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"221\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-819514891d65136b96205edc0d3f8709_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-819514891d65136b96205edc0d3f8709_b.jpg\"/><figcaption>OBD mode 03 response</figcaption></figure><p><b>2.4 关于Mode $04：清除/重置排放相关诊断信息</b></p><p>Mode 4使外部的测试设备能够清除ECU中排放相关的诊断信息，清除的信息包括：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-9124c6647264d198d297c851170be3eb_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"207\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-9124c6647264d198d297c851170be3eb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;207&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"207\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-9124c6647264d198d297c851170be3eb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-9124c6647264d198d297c851170be3eb_b.jpg\"/><figcaption>OBD mode 04 support DTC</figcaption></figure><p>发送指令：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a1cc26ea5e0322963f213ce3530eeb46_b.png\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"75\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-a1cc26ea5e0322963f213ce3530eeb46_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;75&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"75\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-a1cc26ea5e0322963f213ce3530eeb46_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-a1cc26ea5e0322963f213ce3530eeb46_b.png\"/><figcaption>OBD mode 04 request</figcaption></figure><p>回复指令：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b33bed943a5ddb1a87fb938375f3a14c_b.png\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"71\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-b33bed943a5ddb1a87fb938375f3a14c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;71&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"71\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-b33bed943a5ddb1a87fb938375f3a14c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b33bed943a5ddb1a87fb938375f3a14c_b.png\"/><figcaption>OBD mode 04 response</figcaption></figure><p>如果无法清除，则会报负反馈，类似UDS服务中的NRC22响应码，条件不正确。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-0252186acf7b55f83e40050af5f5b5aa_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"156\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-0252186acf7b55f83e40050af5f5b5aa_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;156&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"156\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-0252186acf7b55f83e40050af5f5b5aa_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-0252186acf7b55f83e40050af5f5b5aa_b.jpg\"/><figcaption>OBD mode 04 negative response</figcaption></figure><p><b>2.5 Mode $05：读取氧传感器测试结果</b></p><p>       Mode 5读取氧传感器的监测结果。<b>只有K_line</b>的系统支持Mode 5的输出，CAN通信系统氧传感器信息输出到Mode 6。</p><p>       ISO 15031-5中定义了所有可以获得的氧传感器信息。每条信息都有一个TID与之相对应。Mode 5支持输出哪些TID的输出是根据项目的具体配置设定的。</p><p><b>2.6 Mode $06：读取指定监测系统OBD测试结果</b></p><p>      对于所有需进行规定的车载评价试验（<b>催化转化器、氧传感器等</b>）的排放控制系统，除失火监测、供油系统监测和综合部件监测外，汽车最近进行的<b>试验结果及用于比较的限值</b>，均应能通过IA.6.5.3规定的标准数据连接器上的串行口获得。对于被监测部件和系统，除上述内容外，还应能通过数据连接器获得其最新试验结果的<b>合格/不合格</b>指示。</p><p>     Mode 6读取指定系统的监测结果。如氧传感器、催化器、VVT等系统，Mode6的输出也是根据项目配置而定。</p><p>发送格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-3d214f33c757a061d705203331e499e8_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"244\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-3d214f33c757a061d705203331e499e8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;244&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"244\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-3d214f33c757a061d705203331e499e8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-3d214f33c757a061d705203331e499e8_b.jpg\"/><figcaption>OBD mode 06 request supported OBDMIDs</figcaption></figure><p>回复报文：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f6999715aaa49f308ae3e37c4ff897bd_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"342\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-f6999715aaa49f308ae3e37c4ff897bd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;342&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"342\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-f6999715aaa49f308ae3e37c4ff897bd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-f6999715aaa49f308ae3e37c4ff897bd_b.jpg\"/><figcaption>OBD mode 06 response supported MIDs</figcaption></figure><p>      CAN通信Mode6的输出包括OBDMID、TID、USID、测量值、最小值、最大值。 OBDMID、部分TID、USID在ISO 15031-5中有标准化定义。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-79cc08b5d07c5afc4bb73d1ebfbf78a2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"471\" data-rawheight=\"224\" class=\"origin_image zh-lightbox-thumb\" width=\"471\" data-original=\"https://pic3.zhimg.com/v2-79cc08b5d07c5afc4bb73d1ebfbf78a2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;471&#39; height=&#39;224&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"471\" data-rawheight=\"224\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"471\" data-original=\"https://pic3.zhimg.com/v2-79cc08b5d07c5afc4bb73d1ebfbf78a2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-79cc08b5d07c5afc4bb73d1ebfbf78a2_b.jpg\"/></figure><p>Mode6输出的内容较多，ISO标准规定了Mode6的输出应遵循以下<b>原则</b>：</p><p>        o Mode6的输出要在诊断完成之后；新驾驶循环诊断完成前，Mode6的输出保持上一次的输出值</p><p>        o 对于无故障系统，Mode6输出的测量值在其上下限范围内</p><p>        o 如果诊断功能有Codeword控制，对于CodeWord关闭的情况，其Mode6的输出为不可见，如果输出是0就不行</p><p>        o 如果一个监测系统有多项输出，则其中任一项报出故障，其余监测项的输出都为0</p><p>        o Mode6的输出在fcmclr操作后，测量值、上、下限制全部清0，直到下一次诊断完成，才能输出。第一次刷软件后，诊断完成前，Mode6输出的测量值、最大值、最小值都为0</p><p><b>2.7 Mode $07: 读取当前或上一驾驶循环排放相关诊断故障码</b></p><p>        Ø Mode 7输出当前或上一驾驶循环的诊断故障码。这可以帮助维修人员在进行修理之后确认故障是否真的被移除了，而不必要进行多个驾驶循环；</p><p>         Ø Mode 7中显示的故障码并不一定表明系统一直存在相应的故障。Mode 7的输出独立于Mode 3。当故障被确认并且点亮了MIL灯，则该故障码就不再显示在Mode 7中，而是显示在Mode 3中了</p><p>发送格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-af4d7b568185947731d307bcae205dec_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"98\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-af4d7b568185947731d307bcae205dec_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;98&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"98\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-af4d7b568185947731d307bcae205dec_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-af4d7b568185947731d307bcae205dec_b.jpg\"/><figcaption>OBD mode 07 request</figcaption></figure><p>回复格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-3db83743387987b7f4e1e7a6904a0332_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"250\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-3db83743387987b7f4e1e7a6904a0332_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;250&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"250\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic3.zhimg.com/v2-3db83743387987b7f4e1e7a6904a0332_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-3db83743387987b7f4e1e7a6904a0332_b.jpg\"/><figcaption>OBD mode 07 response</figcaption></figure><p><b>2.8 Mode $08: 对OBD系统进行控制或测试</b></p><p>比如说：</p><p>       发送请求打开OBD系统，控制或测试，关闭OBD系统，控制或测试，或者做循环操作，回复结果如汇报系统状态和测试结果等。</p><p>发送格式（这里举例读取支持的TIDs的示例）：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-537e212f2ca8236bec57c050bd7c1e09_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"211\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-537e212f2ca8236bec57c050bd7c1e09_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;211&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"211\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-537e212f2ca8236bec57c050bd7c1e09_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-537e212f2ca8236bec57c050bd7c1e09_b.jpg\"/><figcaption>OBD mode 08 request</figcaption></figure><p>回复格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-0b166d2b80327252ee4caf6122bb0457_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"269\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-0b166d2b80327252ee4caf6122bb0457_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;269&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"269\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic4.zhimg.com/v2-0b166d2b80327252ee4caf6122bb0457_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-0b166d2b80327252ee4caf6122bb0457_b.jpg\"/><figcaption>OBD mode 08 response</figcaption></figure><p><b>2.9 Mode $09: 读取车辆信息</b></p><ul><li>   Mode 9输出车辆的特定信息，如车辆识别号码 （VIN），标定识别号码(CID)等。</li></ul><p>      其中一些信息被标准化规定，INFOTYPEs在SAE J1979-DA中有定义。同样的，我们可以先发送查询支持哪些infotype，然后具体读取infotype的值</p><p>发送格式（查询支持的infotype）：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-14d585338f3f86746c43d1814b279065_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"215\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-14d585338f3f86746c43d1814b279065_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;215&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"215\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-14d585338f3f86746c43d1814b279065_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-14d585338f3f86746c43d1814b279065_b.jpg\"/><figcaption>OBD mode 09 request</figcaption></figure><p>回复格式：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-fc5d05645840ef06b3dd061b85256afc_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"322\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-fc5d05645840ef06b3dd061b85256afc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;322&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"322\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic1.zhimg.com/v2-fc5d05645840ef06b3dd061b85256afc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-fc5d05645840ef06b3dd061b85256afc_b.jpg\"/><figcaption>OBD mode 09 response</figcaption></figure><p>当我们查询到支持某个infotype之后，可以发送如下指令读取</p><p>发送: 09 XX</p><p>回复：49 XX XX XX…</p><p>规定：INFOTYPE 0x02: VIN</p><p>          INFOTYPE 0x04: Cal. ID</p><p>          INFOTYPE 0x06: Cal. CVN</p><p><b>2.10 Mode $0A: 读取排放相关永久DTC</b></p><p>      功能是读取存储在NVRAM里的故障码，目的防止作弊，如通过清除故障码的方式消除故障。这些永久故障码可以通过ECU自身确认消除或者OBD系统自己决定这些出现的故障不会再出现。</p><p>发送指令：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-3663a112d34cb92c1212e5d3d0048039_b.png\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"93\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-3663a112d34cb92c1212e5d3d0048039_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;93&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"93\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-3663a112d34cb92c1212e5d3d0048039_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-3663a112d34cb92c1212e5d3d0048039_b.png\"/><figcaption>OBD mode 0A request</figcaption></figure><p>回复指令：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-141449d0bb7e6482218eb8f135eb5a49_b.jpg\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"246\" class=\"origin_image zh-lightbox-thumb\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-141449d0bb7e6482218eb8f135eb5a49_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;576&#39; height=&#39;246&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"576\" data-rawheight=\"246\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"576\" data-original=\"https://pic2.zhimg.com/v2-141449d0bb7e6482218eb8f135eb5a49_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-141449d0bb7e6482218eb8f135eb5a49_b.jpg\"/><figcaption>OBD mode 0A response</figcaption></figure><p>引用资料：</p><p>[1] 汽车OBD系统发展综述_陈传灿</p><p>[2] ISO 15031-5-2011</p><hr/><p>广告：关注公众号：汽车电子工程师</p>", 
            "topic": [
                {
                    "tag": "OBD", 
                    "tagLink": "https://api.zhihu.com/topics/19603874"
                }, 
                {
                    "tag": "汽车电子控制", 
                    "tagLink": "https://api.zhihu.com/topics/19752937"
                }, 
                {
                    "tag": "CAN总线", 
                    "tagLink": "https://api.zhihu.com/topics/19744765"
                }
            ], 
            "comments": [
                {
                    "userName": "wyman lei", 
                    "userLink": "https://www.zhihu.com/people/1e3e080846b6e82faed086f9e0525288", 
                    "content": "可以详细说说mode6对于维修有什么帮助吧?", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/66942353", 
            "userName": "云天河", 
            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
            "upvote": 3, 
            "title": "（一）UDS诊断服务中的诊断会话控制（DiagnosticSessionControl，0x10）", 
            "content": "<p>诊断会话在服务器中启用一组特定的诊断服务和/或功能，此服务提供服务器可以报告对启用的诊断会话有效的数据链路层特定参数值（例如定时参数值）的功能。</p><p>基本用法：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-23e347635476a0258aaa68c920911810_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1004\" data-rawheight=\"126\" class=\"origin_image zh-lightbox-thumb\" width=\"1004\" data-original=\"https://pic1.zhimg.com/v2-23e347635476a0258aaa68c920911810_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1004&#39; height=&#39;126&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1004\" data-rawheight=\"126\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1004\" data-original=\"https://pic1.zhimg.com/v2-23e347635476a0258aaa68c920911810_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-23e347635476a0258aaa68c920911810_b.png\"/></figure><p>ISO 14229规定了几个特定的子功能，比如：</p><ol><li>10 01  //默认会话</li><li>10 02  //编程会话</li><li>10 03  // 扩展会话</li></ol><p>以上几种在汽车ECU软件开发中最常用的三种，协议中规定，一次只能有一个会话，不能既是默认会话同时又是扩展会话。UDS其他服务在不同会话中会有不同的表现，比如安全认证只能在扩展会话下进行，而不能在默认话下进行。不同的会话可以相互切换，通常所有的会话都可以切回默认会话，而编程会话一般只会在扩展会话下进入，除了默认会话不需要保持之外，其他会话均需要发送指令来维持会话，否则超时之后返回默认会话。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-9f6309b4a9cfa17973929e248f22e7a3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"971\" data-rawheight=\"336\" class=\"origin_image zh-lightbox-thumb\" width=\"971\" data-original=\"https://pic4.zhimg.com/v2-9f6309b4a9cfa17973929e248f22e7a3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;971&#39; height=&#39;336&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"971\" data-rawheight=\"336\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"971\" data-original=\"https://pic4.zhimg.com/v2-9f6309b4a9cfa17973929e248f22e7a3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-9f6309b4a9cfa17973929e248f22e7a3_b.jpg\"/></figure><p>UDS中其他服务在不同会话中表现如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e81f540273c406ab2ee9526ded22167f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1000\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1000\" data-original=\"https://pic4.zhimg.com/v2-e81f540273c406ab2ee9526ded22167f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1000&#39; height=&#39;608&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1000\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1000\" data-original=\"https://pic4.zhimg.com/v2-e81f540273c406ab2ee9526ded22167f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-e81f540273c406ab2ee9526ded22167f_b.jpg\"/></figure><p>说明：0x11 ECUreset 服务表示在默认会话和其他会话中均支持，而0x28 通信控制则不能在默认会话中得到肯定响应。</p><p>0x10服务正响应回复格式如下规定：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-e6a9e46c63730302217903c711771926_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1004\" data-rawheight=\"217\" class=\"origin_image zh-lightbox-thumb\" width=\"1004\" data-original=\"https://pic3.zhimg.com/v2-e6a9e46c63730302217903c711771926_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1004&#39; height=&#39;217&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1004\" data-rawheight=\"217\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1004\" data-original=\"https://pic3.zhimg.com/v2-e6a9e46c63730302217903c711771926_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-e6a9e46c63730302217903c711771926_b.jpg\"/></figure><p>对于sessionParameterRecord的规定如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-6a579dd421c5d65006cabd90aa17e2f7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1002\" data-rawheight=\"193\" class=\"origin_image zh-lightbox-thumb\" width=\"1002\" data-original=\"https://pic4.zhimg.com/v2-6a579dd421c5d65006cabd90aa17e2f7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1002&#39; height=&#39;193&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1002\" data-rawheight=\"193\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1002\" data-original=\"https://pic4.zhimg.com/v2-6a579dd421c5d65006cabd90aa17e2f7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-6a579dd421c5d65006cabd90aa17e2f7_b.jpg\"/></figure><p>上述几个参数是UDS会话层时间参数，有关会话层的时间参数讨论后续写一个总结。</p><p>如果是否定响应应答负反馈码如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f183ab5fe16351c622658dd5a88d9b99_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1008\" data-rawheight=\"276\" class=\"origin_image zh-lightbox-thumb\" width=\"1008\" data-original=\"https://pic2.zhimg.com/v2-f183ab5fe16351c622658dd5a88d9b99_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1008&#39; height=&#39;276&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1008\" data-rawheight=\"276\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1008\" data-original=\"https://pic2.zhimg.com/v2-f183ab5fe16351c622658dd5a88d9b99_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-f183ab5fe16351c622658dd5a88d9b99_b.jpg\"/></figure><p>示例：</p><p>诊断仪： 10 01 （CAN报文：02 10 01 XX XX XX XX XX）</p><p>正响应： 50 01 00 32 01 F4  （CAN报文：06 50 01 00 32 01 F4 XX）</p><p>负响应： 7F 10 XX   （CAN报文：03 7F 10 <b>22</b> XX XX XX XX）</p><p>如果发送肯定抑制响应（抑制肯定响应位 Subfunction | 0x80， - 子服务bit7为1：抑制肯定响应    - 子服务bit7为0：正常响应）</p><p>诊断仪： 10 81</p><p>正响应： 无报文</p><p>负响应： 7F 10 XX</p><p><i>[1] 参考资料：ISO 14229-1 2013</i></p>", 
            "topic": [
                {
                    "tag": "汽车", 
                    "tagLink": "https://api.zhihu.com/topics/19551915"
                }, 
                {
                    "tag": "ECU", 
                    "tagLink": "https://api.zhihu.com/topics/19627740"
                }, 
                {
                    "tag": "故障诊断", 
                    "tagLink": "https://api.zhihu.com/topics/19620241"
                }
            ], 
            "comments": [
                {
                    "userName": "知乎用户", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "好冷啊", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "知乎用户", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "😄", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "十里春风", 
                    "userLink": "https://www.zhihu.com/people/36c5d16e939f47fe1549091c644a34b9", 
                    "content": "<p>顶一个</p>", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/66784395", 
            "userName": "云天河", 
            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
            "upvote": 2, 
            "title": "UDS（Unified Diagnostic Services，统一的诊断服务）", 
            "content": "<p>UDS（Unified Diagnostic Services，统一的诊断服务）诊断协议是ISO 15765-3 和ISO 14229  定义的一种汽车通用诊断协议，位于OSI模型中的应用层，目前大部分汽车厂商均采用UDS on CAN的诊断协议。</p><p>作为汽车诊断通信重要构成部分，UDS在诊断中作用主要体现在以下几个方面</p><ol><li>在诊断故障码中运用</li></ol><blockquote>读取当前故障，历史故障，读取故障发生时环境信息，清除故障码</blockquote><p>2. 数据传输</p><blockquote>读取各种参数，下线配置</blockquote><p>3. 控制例程</p><blockquote>下线测试，身份认证，控制器reset等</blockquote><p>4. 上传下载</p><blockquote>刷新</blockquote><p>除了UDS之外也有其它的通信协议，比如OBD（用于汽车法规排放相关协议）。基于CAN的UDS俗称UDSonCAN，而基于K线的UDS目前很少见。对于UDS和OBD的通信结构如下图:</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a3ec9e3446e2173181835d1a7faf883a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"875\" data-rawheight=\"509\" class=\"origin_image zh-lightbox-thumb\" width=\"875\" data-original=\"https://pic3.zhimg.com/v2-a3ec9e3446e2173181835d1a7faf883a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;875&#39; height=&#39;509&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"875\" data-rawheight=\"509\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"875\" data-original=\"https://pic3.zhimg.com/v2-a3ec9e3446e2173181835d1a7faf883a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-a3ec9e3446e2173181835d1a7faf883a_b.jpg\"/></figure><p>UDS一些特点：</p><p>UDS为事件驱动型，不会主动告诉外部信息，一问一答的形式，如诊断仪发出指令，UDS回复。</p><p>UDS的众多的服务中，有10种经常会被用到（非刷新场景）。它们分别是：</p><blockquote><b>0x10</b> Diagnostic Session Control（诊断会话）<br/><b>0x11</b> ECUReset（控制器重启）<br/><b>0x14</b> Clear Diagnostic Information（清除诊断信息）<br/><b>0x19 </b>Read DTC Information<br/><b>0x22</b> Read Data By Identifier（通过ID读数据）<br/><b>0x27</b> Security Access（安全访问）<br/><b>0x28</b> CommunicationControl（通信控制）<br/><b>0x2E </b>Write Data By Identifier（通过ID写数据）<br/><b>0x3E</b> Tester Present（待机握手）<br/><b>0x85</b> ControlDTCSetting（DTC设置）</blockquote><p>关于UDS其他知识分享后续陆续总结</p>", 
            "topic": [
                {
                    "tag": "汽车", 
                    "tagLink": "https://api.zhihu.com/topics/19551915"
                }, 
                {
                    "tag": "ECU", 
                    "tagLink": "https://api.zhihu.com/topics/19627740"
                }, 
                {
                    "tag": "故障诊断", 
                    "tagLink": "https://api.zhihu.com/topics/19620241"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/66189196", 
            "userName": "云天河", 
            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
            "upvote": 8, 
            "title": "CAPL编程基础", 
            "content": "<p>CAPL是CAN总线访问编程语言，在汽车电子开发中运行十分广泛，类似C语言，同时是基于事件建模的语言，事件类型包含三种：</p><ul><li>总线事件</li><li>属性事件</li><li>时间时间</li></ul><p>CAPL时间类型可以从一张表格清楚表示，图片素材来源网络</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-aba462fb2beb3964398864cdcc0150e7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"906\" data-rawheight=\"617\" class=\"origin_image zh-lightbox-thumb\" width=\"906\" data-original=\"https://pic4.zhimg.com/v2-aba462fb2beb3964398864cdcc0150e7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;906&#39; height=&#39;617&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"906\" data-rawheight=\"617\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"906\" data-original=\"https://pic4.zhimg.com/v2-aba462fb2beb3964398864cdcc0150e7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-aba462fb2beb3964398864cdcc0150e7_b.jpg\"/></figure><p><b>1. 和时间相关用法</b></p><p>on timer myTimer       //表示对myTimer设定的时间到反应</p><p>msTimer  myTimer;     //声明了一个ms定时器，定时单位是毫秒<br/>timer    myTimer;        //声明了一个以秒为单位的定时器；</p><p>定时器设置：</p><p>setTimer(myTimer,20);           //将定时器设置为20ms,并启动myTimer函数里的动作一次</p><p>setTimerCyclic(myTimer,1);  //设置定时器myTimer为一个1s为周期的循环定时器；</p><p>cancelTimer(myTimer);         //停止定时器myTimer</p><p>需要执行该时间时间的函数写法：</p><div class=\"highlight\"><pre><code class=\"language-text\">myTimer\n{\n      tester.dlc =8;\n      tester.byte(0) = 0x02;\n      tester.byte(1) = 0x10;\n      tester.byte(2) = 0x03;\n      tester.byte(3) = 0x00;\n      tester.byte(4) = 0x00;\n      tester.byte(5) = 0x00;\n      tester.byte(6) = 0x00;\n      tester.byte(7) = 0x00;\n      output(tester);\n }\n</code></pre></div><p><b>2.  消息键盘事件</b></p><p>on message 0x7E0   //监测到0x7E0报文的反应</p><p>on message UDSReqeust  // 对UDSRequest反应</p><p>on message CAN1.123   // 对CAN1通道收到报文123的反应</p><p>on message *        //对所有消息的反应</p><p>on message 0x7E0-0x7E8 //对0x7E0-0x7E8 之间报文的反应</p><p>on key‘F’   // 按键盘F时触发动作</p><p>on key Ctrl-F1  //按Ctrl+F1 触发动作</p><p>对于以上两种事件类型是常用到的功能，能满足绝大部分需求。</p><p><b>3.  CAPL中数据类型</b></p><p>无符号</p><ol><li>byte (1个字节)</li><li>word (2个字节)</li><li>dword(4个字节)</li></ol><p>有符号</p><ol><li>int (2个字节)</li><li>long (4个字节)</li></ol><p>浮点型</p><ol><li>float</li><li>double</li></ol><p><b>4.  消息的申明</b></p><p>message 0x7E0 i14229_extend;</p><p>如果键盘时间出发送报文</p><div class=\"highlight\"><pre><code class=\"language-text\">on key &#39;a&#39;\n{\n    i14229_extend.dlc = 8;  //表示长度\n    i14229_extend.byte(0) = 0x02;   //第0个\n    i14229_extend.byte(1) = 0x10;\n    i14229_extend.byte(2) = 0x03;\n    i14229_extend.byte(3) = 00;\n    i14229_extend.byte(4) = 00;\n    i14229_extend.byte(5) = 00;\n    i14229_extend.byte(6) = 00;\n    i14229_extend.byte(7) = 00;\n    output(i14229_extend);   //发送该报文\n}</code></pre></div><p>如果接收到则作出反应并发出另一帧</p><div class=\"highlight\"><pre><code class=\"language-text\">on message 0x7E8\n{\n    //extend session \n    if((this.BYTE(1) == 0x50) || (this.BYTE(2) == 0x03))\n    {\n      i14229_seca.dlc = 8;\n      i14229_seca.byte(0) = 0x02;\n      i14229_seca.byte(1) = 0x27;\n      i14229_seca.byte(2) = 0x01;\n      i14229_seca.byte(3) = 00;\n      i14229_seca.byte(4) = 00;\n      i14229_seca.byte(5) = 00;\n      i14229_seca.byte(6) = 00;\n      i14229_seca.byte(7) = 00;\n      output(i14229_seca);\n    }\n }</code></pre></div><p><b>5.  CAPL完整结构</b></p><p>通常可由三部分组成</p><ol><li>定义全局变量</li><li>事件过程</li><li>自定义函数块</li></ol><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-6bd2d329b67ba2fc349121c26cd1b551_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1101\" data-rawheight=\"690\" class=\"origin_image zh-lightbox-thumb\" width=\"1101\" data-original=\"https://pic2.zhimg.com/v2-6bd2d329b67ba2fc349121c26cd1b551_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1101&#39; height=&#39;690&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1101\" data-rawheight=\"690\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1101\" data-original=\"https://pic2.zhimg.com/v2-6bd2d329b67ba2fc349121c26cd1b551_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-6bd2d329b67ba2fc349121c26cd1b551_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "CAN总线", 
                    "tagLink": "https://api.zhihu.com/topics/19744765"
                }, 
                {
                    "tag": "ECU", 
                    "tagLink": "https://api.zhihu.com/topics/19627740"
                }, 
                {
                    "tag": "汽车", 
                    "tagLink": "https://api.zhihu.com/topics/19551915"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/66140683", 
            "userName": "云天河", 
            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
            "upvote": 16, 
            "title": "UDS on CAN协议的Bootloader刷写", 
            "content": "<p>       Bootloader 又称引导加载程序，是系统上电之后运行的第一段代码。由于汽车软件功能需求变更以及功能变得越来越多，在开发ECU过程中需要频繁的更新软件升级程序，对应解决方案是目前流行方案都是通过UDS协议进行刷写，本文介绍基于UDS协议的Bootloader刷写软件实现原理。</p><p>Bootloader是什么？</p><p>       Bootloader是嵌入式系统上电后运行的第一段代码，即Bootloader从目标机上的某个固态存储设备上将操作系统加在到RAM中运行，Bootloader可以简单理解裸机程序，在这里将判断是否进行更新程序，或者不更新，如果不更新将完成其他工作，比如部分初始化工作，进入到应用层等。汽车ECU控制器再加入Bootloader之后可以理解划分APP层和Bootloader层，Bootloader层负责日后的程序升级功能，Bootloader更新程序通常不会擦除自己的代码块区域，防止异常中断而导致无法再次更新，所以加入Bootloader的ECU是可以继续中断刷新。</p><p>UDS协议简介</p><p>       UDS（Unified Diagnostic Services，统一的诊断服务）是ISO 15765 和ISO 14229 定义的汽车通用诊断协议，它可在不同的汽车总线（例如CAN, LIN, Flexray, Ethernet 和 K-line）上实现，UDS本质上是一种定向的通信，是一种交互协议（Request/Response）。诊断规范定义了诊断仪和汽车ECU之间的交互。基于UDS的刷写用到的服务包含以下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-63e90baf9cdab1d03a752ccc15e094ba_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"931\" data-rawheight=\"432\" class=\"origin_image zh-lightbox-thumb\" width=\"931\" data-original=\"https://pic3.zhimg.com/v2-63e90baf9cdab1d03a752ccc15e094ba_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;931&#39; height=&#39;432&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"931\" data-rawheight=\"432\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"931\" data-original=\"https://pic3.zhimg.com/v2-63e90baf9cdab1d03a752ccc15e094ba_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-63e90baf9cdab1d03a752ccc15e094ba_b.jpg\"/></figure><p>实现方案</p><p>       Bootloader程序更新流程可以如下图所示。上位机（Tester）向ECU发送启动程序更新的指令，ECU收到指令之后，进入Bootloader程序，FlashDriver可以从外部下载到RAM空间，也可以将bootloader更新指令放在RAM区。FlashDriver程序启动擦除程序并下载数据到Flash中完成程序更新的操作。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-66181b707b2c50ea309f73a391f2354b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1019\" data-rawheight=\"637\" class=\"origin_image zh-lightbox-thumb\" width=\"1019\" data-original=\"https://pic4.zhimg.com/v2-66181b707b2c50ea309f73a391f2354b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1019&#39; height=&#39;637&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1019\" data-rawheight=\"637\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1019\" data-original=\"https://pic4.zhimg.com/v2-66181b707b2c50ea309f73a391f2354b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-66181b707b2c50ea309f73a391f2354b_b.jpg\"/></figure><p>升级程序可以分为三个阶段：</p><p>1. 预编程：主要进行一些环境配置</p><p>2. 编程： 刷写过程</p><p>3. 刷新完成：恢复配置</p><p>Bootloader可以保证在上述三个阶段任一问题出现都能再次进入该过程重新刷新。</p><p>1. 预编程阶段</p><p>在进入刷新之前，通常都会关闭故障码保存，并且关闭CAN通信加快刷写速度，过程如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-3887f4b1377a13a8f65871bd750e9241_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1026\" data-rawheight=\"131\" class=\"origin_image zh-lightbox-thumb\" width=\"1026\" data-original=\"https://pic2.zhimg.com/v2-3887f4b1377a13a8f65871bd750e9241_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1026&#39; height=&#39;131&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1026\" data-rawheight=\"131\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1026\" data-original=\"https://pic2.zhimg.com/v2-3887f4b1377a13a8f65871bd750e9241_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-3887f4b1377a13a8f65871bd750e9241_b.png\"/></figure><p>2. 编程阶段</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-5730e40bfa26beda3384fc739adfc4cd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1020\" data-rawheight=\"619\" class=\"origin_image zh-lightbox-thumb\" width=\"1020\" data-original=\"https://pic2.zhimg.com/v2-5730e40bfa26beda3384fc739adfc4cd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1020&#39; height=&#39;619&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1020\" data-rawheight=\"619\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1020\" data-original=\"https://pic2.zhimg.com/v2-5730e40bfa26beda3384fc739adfc4cd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-5730e40bfa26beda3384fc739adfc4cd_b.jpg\"/></figure><p>3. 编程结束</p><p>刷写完成之后，ECU进行重启，重新进入扩展会话，打开之前关闭的配置即可。</p>", 
            "topic": [
                {
                    "tag": "汽车", 
                    "tagLink": "https://api.zhihu.com/topics/19551915"
                }, 
                {
                    "tag": "嵌入式开发", 
                    "tagLink": "https://api.zhihu.com/topics/19610823"
                }, 
                {
                    "tag": "ECU", 
                    "tagLink": "https://api.zhihu.com/topics/19627740"
                }
            ], 
            "comments": [
                {
                    "userName": "知乎用户", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "人好少啊", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "云天河", 
                            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
                            "content": "昨天才建立的专栏，都是很冷门的 <a class=\"comment_sticker\" href=\"https://pic3.zhimg.com/v2-6eeb544aa5ce6be1e6a6add75e436746.gif\"> [哈哈]</a>", 
                            "likes": 0, 
                            "replyToAuthor": "知乎用户"
                        }
                    ]
                }, 
                {
                    "userName": "阳明", 
                    "userLink": "https://www.zhihu.com/people/e90caa915e71ba89d11603858d6dc8fe", 
                    "content": "希望更详细点，有实例就更完美了", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "云天河", 
                            "userLink": "https://www.zhihu.com/people/150d0a676c617fddaa9c71b2a47902f9", 
                            "content": "可以，后面有时间写一篇涉及具体指令以及刷新流程的文章", 
                            "likes": 0, 
                            "replyToAuthor": "阳明"
                        }, 
                        {
                            "userName": "阳明", 
                            "userLink": "https://www.zhihu.com/people/e90caa915e71ba89d11603858d6dc8fe", 
                            "content": "期待…", 
                            "likes": 0, 
                            "replyToAuthor": "云天河"
                        }
                    ]
                }, 
                {
                    "userName": "khq", 
                    "userLink": "https://www.zhihu.com/people/035c88ae4925d19c0788c7dfce9e2c1b", 
                    "content": "[赞]", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "巴啦啦", 
                    "userLink": "https://www.zhihu.com/people/ef636e662c881b970ee46d3efb8c2f77", 
                    "content": "期待更详细的内容", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "白云城主", 
                    "userLink": "https://www.zhihu.com/people/7ceac9a62be04fb93404238789390f7f", 
                    "content": "请问这种能实现bootload自更新？仅仅只能更新application？", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/autoele"
}
