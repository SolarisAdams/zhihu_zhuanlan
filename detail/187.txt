{
    "title": "数据融合", 
    "description": "从事机器人控制相关工作，对于工作学习中遇到的核心知识点，做简要总结和记录。", 
    "followers": [
        "https://www.zhihu.com/people/constvar", 
        "https://www.zhihu.com/people/rui-jia-33-6", 
        "https://www.zhihu.com/people/dong-lin-le-bo", 
        "https://www.zhihu.com/people/da-xiao-4-5", 
        "https://www.zhihu.com/people/zao-zhi-dao-91-84", 
        "https://www.zhihu.com/people/iamecong", 
        "https://www.zhihu.com/people/greip", 
        "https://www.zhihu.com/people/max-85-39-68", 
        "https://www.zhihu.com/people/chuan-gan-qi-zhuan-jia-wang", 
        "https://www.zhihu.com/people/hei-an-zhong-de-tun", 
        "https://www.zhihu.com/people/ding-dang-ding-33", 
        "https://www.zhihu.com/people/gaohongchen01", 
        "https://www.zhihu.com/people/lee-28-5-11", 
        "https://www.zhihu.com/people/syq786-51", 
        "https://www.zhihu.com/people/hobby-43", 
        "https://www.zhihu.com/people/zheng-hao-86-4", 
        "https://www.zhihu.com/people/bu-neng-pao-dan-xi-huan-chi-cao", 
        "https://www.zhihu.com/people/yang-jie", 
        "https://www.zhihu.com/people/husad", 
        "https://www.zhihu.com/people/wang-xiao-xiong-99", 
        "https://www.zhihu.com/people/liuvay", 
        "https://www.zhihu.com/people/ren-shang-kun", 
        "https://www.zhihu.com/people/tony-tom", 
        "https://www.zhihu.com/people/zhang-lin-hu-92", 
        "https://www.zhihu.com/people/mei-xi-31-99", 
        "https://www.zhihu.com/people/da-hua-84-84", 
        "https://www.zhihu.com/people/zhou-wei-lin-59", 
        "https://www.zhihu.com/people/qia-qi-se-90", 
        "https://www.zhihu.com/people/xiao-wei-47-26", 
        "https://www.zhihu.com/people/lan-feng-19-48", 
        "https://www.zhihu.com/people/wzpd", 
        "https://www.zhihu.com/people/wang-jing-bo-27-88", 
        "https://www.zhihu.com/people/zhou-ran-46-17", 
        "https://www.zhihu.com/people/lao-wang-13-89", 
        "https://www.zhihu.com/people/mushroom-x", 
        "https://www.zhihu.com/people/yan-xing-22-26", 
        "https://www.zhihu.com/people/yuan-xiao-cui-72", 
        "https://www.zhihu.com/people/upsam", 
        "https://www.zhihu.com/people/huang-rui-87-1", 
        "https://www.zhihu.com/people/liu-zhi-56-73", 
        "https://www.zhihu.com/people/xwai", 
        "https://www.zhihu.com/people/lu-zai-he-fang-72-82", 
        "https://www.zhihu.com/people/li-ling-12-18-63", 
        "https://www.zhihu.com/people/yj580", 
        "https://www.zhihu.com/people/lu-wei-3-41", 
        "https://www.zhihu.com/people/hong-jun-yu", 
        "https://www.zhihu.com/people/JJ-UAV", 
        "https://www.zhihu.com/people/quiescencent", 
        "https://www.zhihu.com/people/crazyalexzhang", 
        "https://www.zhihu.com/people/lian-zhi-wen", 
        "https://www.zhihu.com/people/ou-yang-cai-zi-54", 
        "https://www.zhihu.com/people/lin-ming-33-56", 
        "https://www.zhihu.com/people/wang-sen-20-27-11", 
        "https://www.zhihu.com/people/juljl", 
        "https://www.zhihu.com/people/he-xiao-bai-61-42", 
        "https://www.zhihu.com/people/wj2014-59", 
        "https://www.zhihu.com/people/chang-sun-wu-ming-62", 
        "https://www.zhihu.com/people/he-zheng-e", 
        "https://www.zhihu.com/people/joesula", 
        "https://www.zhihu.com/people/fei-tian-kan-miao-xiao", 
        "https://www.zhihu.com/people/zun-yu-9", 
        "https://www.zhihu.com/people/alex-48-90", 
        "https://www.zhihu.com/people/hahaha-92-99", 
        "https://www.zhihu.com/people/enigmawl", 
        "https://www.zhihu.com/people/she-liang", 
        "https://www.zhihu.com/people/dong-meng-14-51", 
        "https://www.zhihu.com/people/yu-hong-sheng-91", 
        "https://www.zhihu.com/people/huo-sheng-san-mei", 
        "https://www.zhihu.com/people/liu-lu-34-98", 
        "https://www.zhihu.com/people/ge-xiao-lu-33", 
        "https://www.zhihu.com/people/su-zhu-95-16", 
        "https://www.zhihu.com/people/ren-si-yuan-94", 
        "https://www.zhihu.com/people/li-zhao-xi-91", 
        "https://www.zhihu.com/people/tielang2253", 
        "https://www.zhihu.com/people/yinkai7269", 
        "https://www.zhihu.com/people/kintzhao", 
        "https://www.zhihu.com/people/joker-91-40", 
        "https://www.zhihu.com/people/ye-gang-91", 
        "https://www.zhihu.com/people/zhou-jia-le-hua-li-xin-xi-xue-yuan", 
        "https://www.zhihu.com/people/congleetea", 
        "https://www.zhihu.com/people/sun-le-yuan", 
        "https://www.zhihu.com/people/xiao-chang-yu-14", 
        "https://www.zhihu.com/people/wang-bin-64-93", 
        "https://www.zhihu.com/people/zou-you-zhi-22", 
        "https://www.zhihu.com/people/gu-jin-ming-57-12", 
        "https://www.zhihu.com/people/Rabbitzhuy", 
        "https://www.zhihu.com/people/kumaq", 
        "https://www.zhihu.com/people/li-hao-79-83", 
        "https://www.zhihu.com/people/wang-yi-ting-70", 
        "https://www.zhihu.com/people/cyrus-37-51", 
        "https://www.zhihu.com/people/he-wen-qiang-61", 
        "https://www.zhihu.com/people/eyeeh", 
        "https://www.zhihu.com/people/ding-gua-gua-91"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/83570396", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 5, 
            "title": "初探sfm", 
            "content": "<p>单目slam基础：</p><p>单目SLAM一般处理流程包括track和map两部分。所谓的track是用来估计相机的位姿。而map部分就是计算pixel的深度，如果相机的位姿有了，就可以通过三角法(triangulation)确定pixel的深度，把这些计算好深度的pixel放到map里就重建出了三维环境。</p><p>参考博客：</p><a href=\"https://link.zhihu.com/?target=https%3A//blog.csdn.net/heyijia0327/article/details/50758944\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Monocular slam 的理论基础</a><p>参考书籍：</p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/leekaka/V_SLAM/blob/master/VINS-Mono/%25E8%25B5%2584%25E6%2596%2599/Mastering%2520OpenCV%2520with%2520Practical%2520Computer%2520Vision%2520Projects%2520%255BeBook%255D.pdf\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Mastering OpenCV with Practical Computer Vision Projects [eBook].pdf</a><p>其中我是看博客知晓了上述书籍，这书本中的第四章是专门讲述怎么用OpenCV 来做sfm这样一个事情，为了只理解其中核心要素，第四章还对适用环境做了限制（1、只使用单目；2、离散的几帧照片而不是视频流）这样简单便于理解和实现，其中也说到是参考了另外一本书：</p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/leekaka/V_SLAM/blob/master/VINS-Mono/%25E8%25B5%2584%25E6%2596%2599/%25E8%25A7%2586%25E8%25A7%2589%25E5%2587%25A0%25E4%25BD%2595.pdf\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">视觉几何</a><p>有时间也去翻一翻肯定是不错的。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-c861c6d1449fed341be2140128f6502a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1606\" data-rawheight=\"852\" class=\"origin_image zh-lightbox-thumb\" width=\"1606\" data-original=\"https://pic3.zhimg.com/v2-c861c6d1449fed341be2140128f6502a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1606&#39; height=&#39;852&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1606\" data-rawheight=\"852\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1606\" data-original=\"https://pic3.zhimg.com/v2-c861c6d1449fed341be2140128f6502a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-c861c6d1449fed341be2140128f6502a_b.jpg\"/></figure><p>第四章基本框架如图：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-0de5907d608a6651c34c398a58e9ff1b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1214\" data-rawheight=\"496\" class=\"origin_image zh-lightbox-thumb\" width=\"1214\" data-original=\"https://pic4.zhimg.com/v2-0de5907d608a6651c34c398a58e9ff1b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1214&#39; height=&#39;496&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1214\" data-rawheight=\"496\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1214\" data-original=\"https://pic4.zhimg.com/v2-0de5907d608a6651c34c398a58e9ff1b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-0de5907d608a6651c34c398a58e9ff1b_b.jpg\"/></figure><p>其实也是slam14讲中前端的基本框架，看完还是收货不少。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-ddab8498f4f388ea8b8fc904f19ec889_b.jpg\" data-size=\"normal\" data-rawwidth=\"1388\" data-rawheight=\"772\" class=\"origin_image zh-lightbox-thumb\" width=\"1388\" data-original=\"https://pic2.zhimg.com/v2-ddab8498f4f388ea8b8fc904f19ec889_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1388&#39; height=&#39;772&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1388\" data-rawheight=\"772\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1388\" data-original=\"https://pic2.zhimg.com/v2-ddab8498f4f388ea8b8fc904f19ec889_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-ddab8498f4f388ea8b8fc904f19ec889_b.jpg\"/><figcaption>经典图</figcaption></figure><p>具体细节不详细展开，简述其中基本思想如下：</p><h3>如何通过两张图片来估计运动：</h3><ul><ul><li>特征匹配（常见的有）</li><ul><li>特征提取和描述子匹配</li><li>光流法匹配</li></ul><li>通过匹配的特征点求解运动姿态R,t</li><ul><li>会用到求解本征矩阵</li><li>会用到SVD方法（可以看下复习链接）</li></ul></ul></ul><a href=\"https://zhuanlan.zhihu.com/p/83230104\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic2.zhimg.com/equation.jpg\" data-image-width=\"0\" data-image-height=\"0\" class=\"internal\">legal high：复习SVD分解</a><p>通过分解本征矩阵，会得到R,t的四个组合，这时，需要根据Z向都为正来做选取。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c2857e0e3d9f46ad44e7df675aaf9337_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1570\" data-rawheight=\"344\" class=\"origin_image zh-lightbox-thumb\" width=\"1570\" data-original=\"https://pic4.zhimg.com/v2-c2857e0e3d9f46ad44e7df675aaf9337_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1570&#39; height=&#39;344&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1570\" data-rawheight=\"344\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1570\" data-original=\"https://pic4.zhimg.com/v2-c2857e0e3d9f46ad44e7df675aaf9337_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-c2857e0e3d9f46ad44e7df675aaf9337_b.jpg\"/></figure><p>求解时发现会有个尺度问题，对于每两帧都会求出一个尺度，这个尺度不是某个单位，如米，厘米，而是一个相对尺度。问题：这样对于多帧图，岂不是会有求出无数个不同的尺度？</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-15b89d3abf0e1af8ab4226b0fa1eec15_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1560\" data-rawheight=\"374\" class=\"origin_image zh-lightbox-thumb\" width=\"1560\" data-original=\"https://pic2.zhimg.com/v2-15b89d3abf0e1af8ab4226b0fa1eec15_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1560&#39; height=&#39;374&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1560\" data-rawheight=\"374\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1560\" data-original=\"https://pic2.zhimg.com/v2-15b89d3abf0e1af8ab4226b0fa1eec15_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-15b89d3abf0e1af8ab4226b0fa1eec15_b.jpg\"/></figure><h3>如何重建三维点</h3><ul><li>通过上述分解求出了运动姿态，可以再根据三角化求出空间点坐标，这里书本和博客略有出入，大致意思相同，等以后更加熟悉了再来理解：</li><ul><li>书上把限制条件转成了 <img src=\"https://www.zhihu.com/equation?tex=AX%3DB\" alt=\"AX=B\" eeimg=\"1\"/> 来求</li></ul></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-8950de8dfedb3e7a3716070a88eddcfa_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1616\" data-rawheight=\"428\" class=\"origin_image zh-lightbox-thumb\" width=\"1616\" data-original=\"https://pic3.zhimg.com/v2-8950de8dfedb3e7a3716070a88eddcfa_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1616&#39; height=&#39;428&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1616\" data-rawheight=\"428\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1616\" data-original=\"https://pic3.zhimg.com/v2-8950de8dfedb3e7a3716070a88eddcfa_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-8950de8dfedb3e7a3716070a88eddcfa_b.jpg\"/></figure><p>博客直接：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-f58e09e2185a339ef49e6895ec263be7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1720\" data-rawheight=\"466\" class=\"origin_image zh-lightbox-thumb\" width=\"1720\" data-original=\"https://pic4.zhimg.com/v2-f58e09e2185a339ef49e6895ec263be7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1720&#39; height=&#39;466&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1720\" data-rawheight=\"466\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1720\" data-original=\"https://pic4.zhimg.com/v2-f58e09e2185a339ef49e6895ec263be7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-f58e09e2185a339ef49e6895ec263be7_b.jpg\"/></figure><p>这个可以对比开源框架看看。</p><p>其中还有cv自带的三角化函数，也略有不同。</p><p>三角化的结果就是求出了对应特征点的三维空间点，如何评价空间点是否正确呢？可以通过姿态抓换把三维点映射到图像上，和图像上愿来的特征点做距离对比，距离太大则说明三角化有问题，这也是以后用BA优化的损失函数。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-72fb52d22d17d369c753a9ed44ab0a58_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1558\" data-rawheight=\"314\" class=\"origin_image zh-lightbox-thumb\" width=\"1558\" data-original=\"https://pic1.zhimg.com/v2-72fb52d22d17d369c753a9ed44ab0a58_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1558&#39; height=&#39;314&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1558\" data-rawheight=\"314\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1558\" data-original=\"https://pic1.zhimg.com/v2-72fb52d22d17d369c753a9ed44ab0a58_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-72fb52d22d17d369c753a9ed44ab0a58_b.jpg\"/></figure><h3>如何重建更多的图像</h3><p>上述两节，可以通过两帧来实现三维点重建，但是实际操作中远不止两帧，那要怎么办呢？</p><p>不可能一直两两求姿态，再来三角化，这样就会有上述提到的scale问题。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-36dad050f404b7735a6dc2dbefd7f772_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1580\" data-rawheight=\"360\" class=\"origin_image zh-lightbox-thumb\" width=\"1580\" data-original=\"https://pic3.zhimg.com/v2-36dad050f404b7735a6dc2dbefd7f772_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1580&#39; height=&#39;360&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1580\" data-rawheight=\"360\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1580\" data-original=\"https://pic3.zhimg.com/v2-36dad050f404b7735a6dc2dbefd7f772_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-36dad050f404b7735a6dc2dbefd7f772_b.jpg\"/></figure><p>不过，可以通过PNP来求解，也可以ICP来求解，方法有很多。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-6e82fe7dc9b149e3849c6858cd3a0d00_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1590\" data-rawheight=\"384\" class=\"origin_image zh-lightbox-thumb\" width=\"1590\" data-original=\"https://pic1.zhimg.com/v2-6e82fe7dc9b149e3849c6858cd3a0d00_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1590&#39; height=&#39;384&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1590\" data-rawheight=\"384\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1590\" data-original=\"https://pic1.zhimg.com/v2-6e82fe7dc9b149e3849c6858cd3a0d00_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-6e82fe7dc9b149e3849c6858cd3a0d00_b.jpg\"/></figure><p>其中PNP就是3D-2D方法，第一步还是前面两个步骤，先建立一个基础定位，三角化第一批3D点，并且对3D点和第一张图上的2D点做好匹配。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-26a7f0e3ca76e94b17478501e2c8ca33_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1538\" data-rawheight=\"642\" class=\"origin_image zh-lightbox-thumb\" width=\"1538\" data-original=\"https://pic4.zhimg.com/v2-26a7f0e3ca76e94b17478501e2c8ca33_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1538&#39; height=&#39;642&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1538\" data-rawheight=\"642\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1538\" data-original=\"https://pic4.zhimg.com/v2-26a7f0e3ca76e94b17478501e2c8ca33_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-26a7f0e3ca76e94b17478501e2c8ca33_b.jpg\"/></figure><p>接下来就使用新的帧中的和第一帧做特征匹配，其中把有3D点的特征点给拎出来，使用匹配上的3D和2D，调用函数solvePnP即可求出新帧的姿态：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-875bbdc0036dc7422d2218761fce5550_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1576\" data-rawheight=\"536\" class=\"origin_image zh-lightbox-thumb\" width=\"1576\" data-original=\"https://pic1.zhimg.com/v2-875bbdc0036dc7422d2218761fce5550_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1576&#39; height=&#39;536&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1576\" data-rawheight=\"536\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1576\" data-original=\"https://pic1.zhimg.com/v2-875bbdc0036dc7422d2218761fce5550_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-875bbdc0036dc7422d2218761fce5550_b.jpg\"/></figure><p>并且注意到，使用的是Ransac,这个算法之前面试有人问，可以去翻阅一下其他博客。这样得到姿态之后，就又可以根据三角化得到更多的3D点啦。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-27aeb38a5a9b4b2167a5affb77b58905_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1560\" data-rawheight=\"246\" class=\"origin_image zh-lightbox-thumb\" width=\"1560\" data-original=\"https://pic2.zhimg.com/v2-27aeb38a5a9b4b2167a5affb77b58905_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1560&#39; height=&#39;246&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1560\" data-rawheight=\"246\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1560\" data-original=\"https://pic2.zhimg.com/v2-27aeb38a5a9b4b2167a5affb77b58905_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-27aeb38a5a9b4b2167a5affb77b58905_b.png\"/></figure><p>看起来没什么问题，其中问题还是不少：比如，如何保证新帧和第一帧匹配上的特征点有足够多对应的3D点？此外，重新三角化新增的3D点，就不会有尺度问题了么？</p><p>这在很多开源框架里都做了优化，我感觉slide window，貌似也能解决这个问题。</p><p>在这之后，就是如何优化了</p><h3>如何优化</h3><p>万变不离其中的BA方法：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e4af0e9862699ff38746089709225853_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1586\" data-rawheight=\"570\" class=\"origin_image zh-lightbox-thumb\" width=\"1586\" data-original=\"https://pic4.zhimg.com/v2-e4af0e9862699ff38746089709225853_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1586&#39; height=&#39;570&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1586\" data-rawheight=\"570\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1586\" data-original=\"https://pic4.zhimg.com/v2-e4af0e9862699ff38746089709225853_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-e4af0e9862699ff38746089709225853_b.jpg\"/></figure><p>书本中用的库，我没去试了，学好ceres应该足以应对大部分问题。</p><p>优化涉及的东西较多，以后慢慢展开，在此不展开了。</p><h3>3D点云的可视化</h3><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-ea18467567e11a671373ce7cb2272fb8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1602\" data-rawheight=\"552\" class=\"origin_image zh-lightbox-thumb\" width=\"1602\" data-original=\"https://pic1.zhimg.com/v2-ea18467567e11a671373ce7cb2272fb8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1602&#39; height=&#39;552&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1602\" data-rawheight=\"552\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1602\" data-original=\"https://pic1.zhimg.com/v2-ea18467567e11a671373ce7cb2272fb8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-ea18467567e11a671373ce7cb2272fb8_b.jpg\"/></figure><p>书本中用的方法就是slam14里介绍的。在此也不展开了。</p><p>上述几个段落，基本就是sfm的主要知识点，书本对此也做了总结：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-6846635f22675996d345643ea165c9e5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1552\" data-rawheight=\"1488\" class=\"origin_image zh-lightbox-thumb\" width=\"1552\" data-original=\"https://pic2.zhimg.com/v2-6846635f22675996d345643ea165c9e5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1552&#39; height=&#39;1488&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1552\" data-rawheight=\"1488\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1552\" data-original=\"https://pic2.zhimg.com/v2-6846635f22675996d345643ea165c9e5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-6846635f22675996d345643ea165c9e5_b.jpg\"/></figure><p>简而言之：</p><p>本章做了很多简化，尤其使用OpenCV调库更显简单，真实的sfm其实很复杂，也有很多大神做了很多工作，比如推崇的H and Z。如果想更加深入sfm,那么多看开源框架是必不可少了啦~~</p><p>此外，咱还没开始介绍SLAM，及时定位和构图，这个sfm简直就是开胃菜啦....</p><p>还有，这都已经是书上的了..所以已经很旧了，不过经典。</p>", 
            "topic": [
                {
                    "tag": "计算机视觉", 
                    "tagLink": "https://api.zhihu.com/topics/19590195"
                }, 
                {
                    "tag": "同时定位和地图构建（SLAM）", 
                    "tagLink": "https://api.zhihu.com/topics/20033502"
                }
            ], 
            "comments": [
                {
                    "userName": "Ricepig", 
                    "userLink": "https://www.zhihu.com/people/80f6264ceb7566ef12faa7f579ffbbf5", 
                    "content": "很有启发，感谢。单目视觉场景重建由SLAM而起，但应用更加广泛。", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/83230104", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 0, 
            "title": "复习SVD分解", 
            "content": "<h2>特征值与特征向量</h2><h3>定义</h3><p>设 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 是一个 <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 阶方阵， <img src=\"https://www.zhihu.com/equation?tex=%5Clambda\" alt=\"\\lambda\" eeimg=\"1\"/> 是一个数，如果方程：<img src=\"https://www.zhihu.com/equation?tex=A%5Cvec+x%3D+%5Clambda+%5Cvec+x\" alt=\"A\\vec x= \\lambda \\vec x\" eeimg=\"1\"/>  存在非零解，则称 <img src=\"https://www.zhihu.com/equation?tex=%5Clambda\" alt=\"\\lambda\" eeimg=\"1\"/> 是 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 的一个特征值，相应的非零向量 <img src=\"https://www.zhihu.com/equation?tex=%5Cvec+x\" alt=\"\\vec x\" eeimg=\"1\"/> 则是属于特征值 <img src=\"https://www.zhihu.com/equation?tex=%5Clambda\" alt=\"\\lambda\" eeimg=\"1\"/> 的特征向量。</p><p>上述方程可以写成： <img src=\"https://www.zhihu.com/equation?tex=%28A-%5Clambda+I%29%5Cvec+x+%3D+0\" alt=\"(A-\\lambda I)\\vec x = 0\" eeimg=\"1\"/>  这是 <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 个未知数 <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 个方程的齐次线性方程组，它有非零解的充要条件是系数行列式 <img src=\"https://www.zhihu.com/equation?tex=%7CA-%5Clambda+I%7C+%3D+0\" alt=\"|A-\\lambda I| = 0\" eeimg=\"1\"/> ,即：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cleft+%7C+%5Cbegin%7Bmatrix%7D++a_%7B11%7D+%26+a_%7B12%7D+%26+%5Cdots+%26a_%7B1n%7D+%5C%5C+a_%7B21%7D%26+a_%7B22%7D-%5Clambda%26%5Cdots+%26a_%7B2n%7D%5C%5C+%5Cdots+%26+%5Cdots+%26%5Cdots+%26%5Cdots+%5C%5C+a_%7Bn1%7D%26+a_%7Bn2%7D%26%5Cdots+%26a_%7Bnn%7D-%5Clambda%5C%5C+%5Cend%7Bmatrix%7D+%5Cright+%7C%3D0\" alt=\"\\left | \\begin{matrix}  a_{11} &amp; a_{12} &amp; \\dots &amp;a_{1n} \\\\ a_{21}&amp; a_{22}-\\lambda&amp;\\dots &amp;a_{2n}\\\\ \\dots &amp; \\dots &amp;\\dots &amp;\\dots \\\\ a_{n1}&amp; a_{n2}&amp;\\dots &amp;a_{nn}-\\lambda\\\\ \\end{matrix} \\right |=0\" eeimg=\"1\"/> </p><p>上式是以 <img src=\"https://www.zhihu.com/equation?tex=%5Clambda\" alt=\"\\lambda\" eeimg=\"1\"/> 为未知数的一元 <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 此次方程，称为方阵 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 的特征方程。</p><p>求解特征方程后，能得到所有特征值，再根据特征值，可以求得相对应的特征向量。</p><h3>相似矩阵</h3><p>设 <img src=\"https://www.zhihu.com/equation?tex=A+\" alt=\"A \" eeimg=\"1\"/> 、 <img src=\"https://www.zhihu.com/equation?tex=B\" alt=\"B\" eeimg=\"1\"/> 都是 <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 阶方阵，若存在满秩矩阵 <img src=\"https://www.zhihu.com/equation?tex=P\" alt=\"P\" eeimg=\"1\"/> ,使得 <img src=\"https://www.zhihu.com/equation?tex=B%3DP%5E%7B-1%7DAP\" alt=\"B=P^{-1}AP\" eeimg=\"1\"/> 则称 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 与 <img src=\"https://www.zhihu.com/equation?tex=B\" alt=\"B\" eeimg=\"1\"/> 相似，记作 <img src=\"https://www.zhihu.com/equation?tex=A+%5Csim+B\" alt=\"A \\sim B\" eeimg=\"1\"/> ,切满秩矩阵 <img src=\"https://www.zhihu.com/equation?tex=P\" alt=\"P\" eeimg=\"1\"/> 称为 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 变为 <img src=\"https://www.zhihu.com/equation?tex=B\" alt=\"B\" eeimg=\"1\"/> 的相似变换矩阵。</p><p>定理： <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 阶矩阵 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 与对角矩阵 <img src=\"https://www.zhihu.com/equation?tex=%5CLambda+%3D+diag%28%5Clambda_%7B1%7D%2C%5Clambda_%7B2%7D%2C%5Clambda_%7B3%7D%2C%5Ccdots%2C%5Clambda_%7Bn%7D%29\" alt=\"\\Lambda = diag(\\lambda_{1},\\lambda_{2},\\lambda_{3},\\cdots,\\lambda_{n})\" eeimg=\"1\"/> 相似的充要条件是：矩阵 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 有 <img src=\"https://www.zhihu.com/equation?tex=n\" alt=\"n\" eeimg=\"1\"/> 个线性无关的分别属于特征值 <img src=\"https://www.zhihu.com/equation?tex=%5Clambda_%7B1%7D%2C%5Clambda_%7B2%7D%2C%5Clambda_%7B3%7D%2C%5Ccdots%2C%5Clambda_%7Bn%7D\" alt=\"\\lambda_{1},\\lambda_{2},\\lambda_{3},\\cdots,\\lambda_{n}\" eeimg=\"1\"/> 的特征向量。（ <img src=\"https://www.zhihu.com/equation?tex=%5Clambda_%7B1%7D%2C%5Clambda_%7B2%7D%2C%5Clambda_%7B3%7D%2C%5Ccdots%2C%5Clambda_%7Bn%7D\" alt=\"\\lambda_{1},\\lambda_{2},\\lambda_{3},\\cdots,\\lambda_{n}\" eeimg=\"1\"/> 可相同）</p><p>即： <img src=\"https://www.zhihu.com/equation?tex=A%3DP%5E%7B-1%7D%5CLambda+P\" alt=\"A=P^{-1}\\Lambda P\" eeimg=\"1\"/> </p><h2>特征值分解</h2><p>当 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 是 <img src=\"https://www.zhihu.com/equation?tex=m%5Ctimes+m\" alt=\"m\\times m\" eeimg=\"1\"/> 的实对称矩阵时（ <img src=\"https://www.zhihu.com/equation?tex=A%5E%7BT%7D%3DA\" alt=\"A^{T}=A\" eeimg=\"1\"/> ），那么他可以被分解成如下形式：</p><p><img src=\"https://www.zhihu.com/equation?tex=A%3DQ%5CSigma+Q%5E%7BT%7D+%3D+Q+%5Cleft%7C%5Cbegin%7Bmatrix%7D+%5Clambda_%7B1%7D%26%5Ccdots+%26+%5Ccdots%26%5Ccdots%5C%5C++%5Ccdots+%26%5Clambda_%7B2%7D%26%5Ccdots%26%5Ccdots+%5C%5C+%5Ccdots+%26%5Ccdots%26%5Ccdots%26%5Ccdots+%5C%5C+%5Ccdots+%26%5Ccdots+%26%5Ccdots%26%5Clambda_%7Bm%7D%5C%5C+++%5Cend%7Bmatrix%7D%5Cright%7C+Q%5E%7BT%7D\" alt=\"A=Q\\Sigma Q^{T} = Q \\left|\\begin{matrix} \\lambda_{1}&amp;\\cdots &amp; \\cdots&amp;\\cdots\\\\  \\cdots &amp;\\lambda_{2}&amp;\\cdots&amp;\\cdots \\\\ \\cdots &amp;\\cdots&amp;\\cdots&amp;\\cdots \\\\ \\cdots &amp;\\cdots &amp;\\cdots&amp;\\lambda_{m}\\\\   \\end{matrix}\\right| Q^{T}\" eeimg=\"1\"/> </p><p>其中 <img src=\"https://www.zhihu.com/equation?tex=Q\" alt=\"Q\" eeimg=\"1\"/> 为标准正交阵，即有 <img src=\"https://www.zhihu.com/equation?tex=QQ%5E%7BT%7D+%3D+I\" alt=\"QQ^{T} = I\" eeimg=\"1\"/> ， <img src=\"https://www.zhihu.com/equation?tex=%5CSigma\" alt=\"\\Sigma\" eeimg=\"1\"/> 为对角矩阵，且上面的矩阵的维度均为 <img src=\"https://www.zhihu.com/equation?tex=m%5Ctimes+m\" alt=\"m\\times m\" eeimg=\"1\"/> 。 <img src=\"https://www.zhihu.com/equation?tex=%5Clambda_%7Bi%7D\" alt=\"\\lambda_{i}\" eeimg=\"1\"/> 称为<code>特征值</code>， <img src=\"https://www.zhihu.com/equation?tex=q_%7Bi%7D\" alt=\"q_{i}\" eeimg=\"1\"/> 是 <img src=\"https://www.zhihu.com/equation?tex=Q\" alt=\"Q\" eeimg=\"1\"/> （特征矩阵）中的列向量，也为<code><b>特征向量</b></code>。</p><p>上面的特征值分解，对矩阵有着较高的要求，它需要被分解的矩阵 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> 为实对称矩阵，但是现实中，我们所遇到的问题一般不是实对称矩阵。那么当我们碰到一般性的矩阵，即有一个 <img src=\"https://www.zhihu.com/equation?tex=m%5Ctimes+n\" alt=\"m\\times n\" eeimg=\"1\"/> 的矩阵 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> ，它也可以分解成上面的形式，即今天的主角：SVD分解。</p><h2>SVD分解</h2><p>有一个 <img src=\"https://www.zhihu.com/equation?tex=m%5Ctimes+n+\" alt=\"m\\times n \" eeimg=\"1\"/> 的实数矩阵 <img src=\"https://www.zhihu.com/equation?tex=A\" alt=\"A\" eeimg=\"1\"/> ，我们想要把它分解成如下的形式</p><p><img src=\"https://www.zhihu.com/equation?tex=A+%3D+U%5CSigma+V%5E%7BT%7D\" alt=\"A = U\\Sigma V^{T}\" eeimg=\"1\"/> </p><p>其中 <img src=\"https://www.zhihu.com/equation?tex=U\" alt=\"U\" eeimg=\"1\"/> 和 <img src=\"https://www.zhihu.com/equation?tex=V\" alt=\"V\" eeimg=\"1\"/> 均为单位正交阵，即有 <img src=\"https://www.zhihu.com/equation?tex=UU%5E%7BT%7D+%3D+I\" alt=\"UU^{T} = I\" eeimg=\"1\"/> 和 <img src=\"https://www.zhihu.com/equation?tex=VV%5E%7BT%7D+%3D+I\" alt=\"VV^{T} = I\" eeimg=\"1\"/> ， <img src=\"https://www.zhihu.com/equation?tex=U\" alt=\"U\" eeimg=\"1\"/> 称为<code><b>左奇异矩阵</b></code>， <img src=\"https://www.zhihu.com/equation?tex=V\" alt=\"V\" eeimg=\"1\"/> 称为<code><b>右奇异矩阵</b></code>， <img src=\"https://www.zhihu.com/equation?tex=%5CSigma\" alt=\"\\Sigma\" eeimg=\"1\"/> 仅在主对角线上有值，我们称它为<code><b>奇异值</b></code>，其它元素均为0。上面矩阵的维度分别为 <img src=\"https://www.zhihu.com/equation?tex=U%5Cin+R%5E%7Bm%5Ctimes+m%7D\" alt=\"U\\in R^{m\\times m}\" eeimg=\"1\"/> , <img src=\"https://www.zhihu.com/equation?tex=%5CSigma+%5Cin+R%5E%7Bm+%5Ctimes+n%7D\" alt=\"\\Sigma \\in R^{m \\times n}\" eeimg=\"1\"/> , <img src=\"https://www.zhihu.com/equation?tex=V+%5Cin+R%5E%7Bn+%5Ctimes+n%7D\" alt=\"V \\in R^{n \\times n}\" eeimg=\"1\"/> 。</p><p>一般地 <img src=\"https://www.zhihu.com/equation?tex=%5CSigma\" alt=\"\\Sigma\" eeimg=\"1\"/> 有如下形式:</p><p><img src=\"https://www.zhihu.com/equation?tex=%5CSigma+%3D+%5Cleft+%7C%5Cbegin%7Bmatrix%7D++%5Csigma_%7B1%7D+%26+0+%26+0+%260+%26+0+%5C%5C+0%26%5Csigma_%7B2%7D%260%260%260%5C%5C+0%260%26%5Csigma_%7B3%7D%260%260%5C%5C+0%260%260%26%5Cddots%260+%5Cend%7Bmatrix%7D+%5Cright+%7C\" alt=\"\\Sigma = \\left |\\begin{matrix}  \\sigma_{1} &amp; 0 &amp; 0 &amp;0 &amp; 0 \\\\ 0&amp;\\sigma_{2}&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;\\sigma_{3}&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;\\ddots&amp;0 \\end{matrix} \\right |\" eeimg=\"1\"/> hi有主对角线有奇异值，其余为0.</p><p>正常求上面的 <img src=\"https://www.zhihu.com/equation?tex=U%E3%80%81V%E3%80%81%5CSigma\" alt=\"U、V、\\Sigma\" eeimg=\"1\"/> 不便于求，我们可以利用如下性质</p><p><img src=\"https://www.zhihu.com/equation?tex=AA%5E%7BT%7D+%3D+U%5CSigma+V%5E%7BT%7DV%5CSigma+U%5E%7BT%7D%3D+U%5CSigma+%5CSigma%5E%7BT%7DU%5E%7BT%7D\" alt=\"AA^{T} = U\\Sigma V^{T}V\\Sigma U^{T}= U\\Sigma \\Sigma^{T}U^{T}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=A%5E%7BT%7DA+%3D+V%5CSigma%5E%7BT%7D+U%5E%7BT%7DU%5CSigma+V%5E%7BT%7D+%3D+V%5CSigma%5E%7BT%7D%5CSigma+V%5E%7BT%7D\" alt=\"A^{T}A = V\\Sigma^{T} U^{T}U\\Sigma V^{T} = V\\Sigma^{T}\\Sigma V^{T}\" eeimg=\"1\"/> </p><p>对于上两式分别做特征值分解即可求 <img src=\"https://www.zhihu.com/equation?tex=U%E3%80%81V%E3%80%81%5CSigma\" alt=\"U、V、\\Sigma\" eeimg=\"1\"/> 。</p><p>同时注意到在slam中很多地方都用到了SVD分解，比如：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-01d87648dfd08f8ac6bfe4da1e9b46ba_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1732\" data-rawheight=\"124\" class=\"origin_image zh-lightbox-thumb\" width=\"1732\" data-original=\"https://pic3.zhimg.com/v2-01d87648dfd08f8ac6bfe4da1e9b46ba_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1732&#39; height=&#39;124&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1732\" data-rawheight=\"124\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1732\" data-original=\"https://pic3.zhimg.com/v2-01d87648dfd08f8ac6bfe4da1e9b46ba_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-01d87648dfd08f8ac6bfe4da1e9b46ba_b.png\"/></figure><p>在求AX=0时，可以直接将A做奇异值分解。</p><p><img src=\"https://www.zhihu.com/equation?tex=A%5E%7BT%7DA%5Cvec+x+%3D+V%5CSigma%5E%7BT%7D%5CSigma+V%5E%7BT%7D%5Cvec+x%3D0\" alt=\"A^{T}A\\vec x = V\\Sigma^{T}\\Sigma V^{T}\\vec x=0\" eeimg=\"1\"/> ， <img src=\"https://www.zhihu.com/equation?tex=AA%5E%7BT%7D\" alt=\"AA^{T}\" eeimg=\"1\"/> 是实对称矩阵，可按特征值分解...</p><p>因为肯定有个特征值为0，放在最后，那么对应的特征向量不就是 <img src=\"https://www.zhihu.com/equation?tex=V%5E%7BT%7D\" alt=\"V^{T}\" eeimg=\"1\"/> 的最后一列么？</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>", 
            "topic": [
                {
                    "tag": "代数", 
                    "tagLink": "https://api.zhihu.com/topics/19558721"
                }, 
                {
                    "tag": "同时定位和地图构建（SLAM）", 
                    "tagLink": "https://api.zhihu.com/topics/20033502"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68308738", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 3, 
            "title": "Vslam初探", 
            "content": "<p>Vslam几个模块：传感器数据采集、视觉里程计(Visual Odometry)、后端优化、建图(Mapping)、闭环检测(Loop closure detection)。</p><h2>视觉里程计</h2><p>就是利用一个图像序列或者一个视频流，计算摄像机的方向和位置的过程。一般包括图像获取后、畸变校正、特征检测匹配或者直接匹配对应像素、通过对极几何原理估计相机的旋转矩阵和平移向量。 </p><h2>后端优化</h2><p>  后端优化理论上来说，如果视觉里程计模块估计的相机的旋转矩阵R和平移向量t都正确的话，我们就能得到完美的定位和建图了。但实际试验中，我们得到的数据往往有很多噪声，且由于传感器的精度、错误的匹配等，都对造成结果有误差。并且由于我们是只把新的一帧与前一个关键帧进行比较，当某一帧的结果有误差时，就会对后面的结果产生累计误差，最后的结果肯定误差越来越大。为了解决这个问题，引入后端优化。 </p><p>  后端优化一般采用捆集调整(BA)、卡尔曼滤波(EKF)、图优化等方式来解决。其中基于图优化的后端优化，效果最好。Graph-based SLAM一般使用g2o求解器，进行图优化计算。 </p><h2>闭环检测</h2><p>  后端优化可能得到一个比较优的解，但当运动回到某一个之前去过的地方，如果我们能认出这个地方，并找到那个时候的关键帧进行比较，我们就可以得到比单用后端优化更准确更高效的结果。闭环检测就是要解决这个问题。 </p><p>  闭环检测有两种方式，一是根据估计出来的相机的位置，看是否与之前否个位置邻近；另外一种是根据图像，去自动识别出来这个场景之前到过，并找到那时候的关键帧。现在比较常用的是后一种方法，其实是一个非监督的模式识别问题。比较常用的方法是使用Bag-of-Words(BOW)，ORB-SLAM就是使用这个方法来进行闭环检测。 </p><h2>核心问题：</h2><p>谈论视觉SLAM，主要指如何用<b> 相机</b>解决<b>定位和构图</b>问题，也就是SLAM的含义所在。——Simultaneous Localization And Mapping。SLAM问题模型：状态估计问题：如何通过带有噪声的测量数据，估计内部的，隐藏着的状态变量。</p><h3>根据相机不同，slam有不同实现</h3><p>相机分了很多种。主要有</p><ul><li> 单目相机（Monocular）</li><li>双目相机 ( Stereo )</li><li>深度相机 ( RGB-D )</li></ul><p>单目相机的缺点：</p><ol><li>无法确定真实尺寸</li><li>平移之后才能计算深度</li></ol><p>双目相机</p><ol><li> 通过相机间的距离（Base line）来估算像素间的位置。（和人眼类似）</li><li>测量的深度范围和基线相关，基线越大，测量越远。</li><li>视差的计算非常消耗资源</li></ol><p>深度相机</p><p>主动向物体发射光，并接受光，来测算距离，相当于单目和雷达的结合。避免了双目大量的计算消耗。</p><p>其中可参考文献：</p><p>单目SLAM: </p><p>(1).PTAM(Parallel Tracking And Mapping):2007年 很牛逼的SLAM项目，是第一个使用BA完成实时SLAM的系统，论文中提出的关键帧以及多线程处理思想成为之后视觉SLAM标配。但其由于缺乏回环检测和重定位等功能，只能作用于小规模的场景，且稳定性也不是很高; </p><p>(2).2011年，Direct SLAM方法的鼻祖：DTAM(Dense tracking and mapping in real-time)；</p><p>(3).2014年一个半稠密SLAM系统：LSD-SLAM(Large-Scale Direct Monocular SLAM)；</p><p>(4).2015年一个比较完整的基于特征点的SLAM系统：ORB-SLAM。</p><p>RGBD: </p><p>(1).KinectFusion 2011 </p><p>(2).RGBD-SLAM2 2014 </p><p>(3).ElasticFusion 2015</p><p>目前根据特征点的ORB-SLAM最为全面简洁，适合新手入门。</p><p>建议把slam14讲多看几遍才开始看框架，基本功不牢，看的很累。<br/>强推《概率机器人》和白巧克力唯心的博客。</p>", 
            "topic": [
                {
                    "tag": "传感器", 
                    "tagLink": "https://api.zhihu.com/topics/19561057"
                }, 
                {
                    "tag": "同时定位和地图构建（SLAM）", 
                    "tagLink": "https://api.zhihu.com/topics/20033502"
                }
            ], 
            "comments": [
                {
                    "userName": "思est", 
                    "userLink": "https://www.zhihu.com/people/51637d1a2740ef57cda33f40de3ecc7e", 
                    "content": "你好，请问编译运行slam14第九章的run_vo出现segmentation fault(core dumped)什么原因呢？不知道您有没有遇见过。", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "legal high", 
                            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
                            "content": "<p>我编译过没问题额，晚上回去一起讨论讨论。</p>", 
                            "likes": 0, 
                            "replyToAuthor": "思est"
                        }, 
                        {
                            "userName": "思est", 
                            "userLink": "https://www.zhihu.com/people/51637d1a2740ef57cda33f40de3ecc7e", 
                            "content": "好的 [拜托][拜托][拜托]", 
                            "likes": 0, 
                            "replyToAuthor": "legal high"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/60207971", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 0, 
            "title": "IMU和GPS的数据融合概览", 
            "content": "<p>IMU使用概览里简略介绍了IMU的相关信息，在具体使用IMU过程中，我们发现单只有IMU时，使用时间越长，IMU的数据越不准确，而此时，则需要用其他传感器对其数据进行修正，也就是所谓的多传感器数据融合。</p><a href=\"https://zhuanlan.zhihu.com/p/41299359\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\"internal\">legal high：IMU使用概览</a><p>这里，我们从实际使用出发，介绍IMU和其他传感器的数据融合，比如融合GPS的位置和速度。</p><p>EKF公式抄录如下：</p><h2>预测过程：</h2><p><img src=\"https://www.zhihu.com/equation?tex=%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D+%3D+f%28%5Ctilde%7Bx%7D_%7Bk-1%2Ck-1%7D+%29+%3D+%5CPhi_%7Bk%7D%5Ctilde%7Bx%7D_%7Bk-1%2Ck-1%7D+%2BB_%7Bk%7Du_%7Bk%7D\" alt=\"\\tilde{x}_{k,k-1} = f(\\tilde{x}_{k-1,k-1} ) = \\Phi_{k}\\tilde{x}_{k-1,k-1} +B_{k}u_{k}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=P_%7Bk%2Ck-1%7D%3D+%5CPhi_%7Bk%7DP_%7Bk-1%2Ck-1%7D+%5CPhi_%7Bk%7D%5E%7BT%7D+%2B+%5CGamma_%7Bk-1%7DQ_%7Bk-1%7D%5CGamma_%7Bk-1%7D%5E%7BT%7D\" alt=\"P_{k,k-1}= \\Phi_{k}P_{k-1,k-1} \\Phi_{k}^{T} + \\Gamma_{k-1}Q_{k-1}\\Gamma_{k-1}^{T}\" eeimg=\"1\"/> </p><h2>更新过程：</h2><p><img src=\"https://www.zhihu.com/equation?tex=K_%7Bk%7D+%3D+P_%7Bk.k-1%7DH_%7Bk%7D%5E%7BT%7D%28R_%7Bk%7D%2BH_%7Bk%7DP_%7Bk%2Ck-1%7DH_%7Bk%7D%5E%7BT%7D%29%5E%7B-1%7D\" alt=\"K_{k} = P_{k.k-1}H_{k}^{T}(R_{k}+H_{k}P_{k,k-1}H_{k}^{T})^{-1}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Ctilde%7Bx%7D_%7Bk%2Ck%7D%3D%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D+%2B+K_%7Bk%7D%28z_%7Bk%7D-h%28%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D+%29%29++\" alt=\"\\tilde{x}_{k,k}=\\tilde{x}_{k,k-1} + K_{k}(z_{k}-h(\\tilde{x}_{k,k-1} ))  \" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=P_%7Bk%2Ck%7D%3DP_%7Bk%2Ck-1%7D-K_%7Bk%7DH_%7Bk%7DP_%7Bk%2Ck-1%7D\" alt=\"P_{k,k}=P_{k,k-1}-K_{k}H_{k}P_{k,k-1}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=+%5CPhi_%7Bk%7D%3DI%2BF_%7Bk%7Dt\" alt=\" \\Phi_{k}=I+F_{k}t\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=F_%7Bk%7D%3D%5Cfrac%7B%5Cpartial+f%28x%29%7D%7B%5Cpartial+x%7D+%7Cx%3D%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D\" alt=\"F_{k}=\\frac{\\partial f(x)}{\\partial x} |x=\\tilde{x}_{k,k-1}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=H_%7Bk%7D%3D%5Cfrac%7B%5Cpartial+h%28x%29%7D%7B%5Cpartial+x%7D+%7Cx%3D%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D\" alt=\"H_{k}=\\frac{\\partial h(x)}{\\partial x} |x=\\tilde{x}_{k,k-1}\" eeimg=\"1\"/> </p><p>根据公式，我们将融合过程中分成三个部分，将上述公式按步骤实现即可。</p><h3>实际实现过程：</h3><h3>初始化：</h3><p>初始化变量，比如协方差矩阵Ｐ，系统误差矩阵Ｑ，观测误差矩阵Ｒ等。</p><p>其中Ｐ和Ｒ是可以根据实际传感器给出一个大概值，Ｑ相对来说很小。</p><p>这里我忽略了一个很重要的问题，姿态角r和p可以由加速度计求出的静态角初始化，<b>那航向怎么初始化？</b></p><p>当只有IMU和GPS的时候，怎么知道大地坐标系下的北方向呢，这个问题在面试的时候遇到过。</p><h3>预测阶段：</h3><p>只需要使用IMU积分计算，作为预测阶段，计算当前得位置，速度，和姿态信息。</p><p>因为与时间息息相关，所以预测过程可以用一个<b>定时器回调</b>来实现，</p><p>假设定时器为200hz，则在计算过程中的时间为1/200；</p><p>1.包括一步预测及更新方差矩阵</p><p>2.通过一步预测得到的abcd更新rpy</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-9e94b8720501b54e30b5ff6279db974a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"473\" data-rawheight=\"186\" class=\"origin_image zh-lightbox-thumb\" width=\"473\" data-original=\"https://pic3.zhimg.com/v2-9e94b8720501b54e30b5ff6279db974a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;473&#39; height=&#39;186&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"473\" data-rawheight=\"186\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"473\" data-original=\"https://pic3.zhimg.com/v2-9e94b8720501b54e30b5ff6279db974a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-9e94b8720501b54e30b5ff6279db974a_b.jpg\"/></figure><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-d4d6238a5493f1939a589aefb441bdcd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"377\" data-rawheight=\"250\" class=\"content_image\" width=\"377\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;377&#39; height=&#39;250&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"377\" data-rawheight=\"250\" class=\"content_image lazy\" width=\"377\" data-actualsrc=\"https://pic2.zhimg.com/v2-d4d6238a5493f1939a589aefb441bdcd_b.jpg\"/></figure><h3>更新阶段：</h3><p>使用GPS的数据，比如位置，和速度信息来作为观测量进行传感器数据的修正。</p><p>１．比如取得速度估计二阶矩，Rvel，求当前预测方差，与测量方差的和，算增益</p><p><img src=\"https://www.zhihu.com/equation?tex=K_%7Bk%7D+%3D+P_%7Bk.k-1%7DH_%7Bk%7D%5E%7BT%7D%28R_%7Bk%7D%2BH_%7Bk%7DP_%7Bk%2Ck-1%7DH_%7Bk%7D%5E%7BT%7D%29%5E%7B-1%7D\" alt=\"K_{k} = P_{k.k-1}H_{k}^{T}(R_{k}+H_{k}P_{k,k-1}H_{k}^{T})^{-1}\" eeimg=\"1\"/> </p><p>２．计算预测与观察值误差，根据增益与误差，更新状态</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Ctilde%7Bx%7D_%7Bk%2Ck%7D%3D%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D+%2B+K_%7Bk%7D%28z_%7Bk%7D-h%28%5Ctilde%7Bx%7D_%7Bk%2Ck-1%7D+%29%29++\" alt=\"\\tilde{x}_{k,k}=\\tilde{x}_{k,k-1} + K_{k}(z_{k}-h(\\tilde{x}_{k,k-1} ))  \" eeimg=\"1\"/> </p><p>３．新当前方差</p><p><img src=\"https://www.zhihu.com/equation?tex=P_%7Bk%2Ck%7D%3DP_%7Bk%2Ck-1%7D-K_%7Bk%7DH_%7Bk%7DP_%7Bk%2Ck-1%7D\" alt=\"P_{k,k}=P_{k,k-1}-K_{k}H_{k}P_{k,k-1}\" eeimg=\"1\"/> </p><p><b>值得注意的是，在更新速度时候，由于GPS的速度有延迟，可以考虑把观测速度根据加速度稍微做一个预测。</b></p><p></p>", 
            "topic": [
                {
                    "tag": "传感器", 
                    "tagLink": "https://api.zhihu.com/topics/19561057"
                }
            ], 
            "comments": [
                {
                    "userName": "是壳不是皮", 
                    "userLink": "https://www.zhihu.com/people/c4f11ef15016f8d5d757a021437af643", 
                    "content": "<p>你好，想问一下，你有没有具体实现的代码呢？如果有的话是否可以提供？</p>", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "legal high", 
                    "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
                    "content": "<p>可参考这个无人驾驶技术入门（十八）| 手把手教你写扩展卡尔曼滤波器 - 陈光的文章 - 知乎<br><a href=\"https://zhuanlan.zhihu.com/p/63641680\" class=\"internal\"><span class=\"invisible\">https://</span><span class=\"visible\">zhuanlan.zhihu.com/p/63</span><span class=\"invisible\">641680</span><span class=\"ellipsis\"></span></a></p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "是壳不是皮", 
                            "userLink": "https://www.zhihu.com/people/c4f11ef15016f8d5d757a021437af643", 
                            "content": "谢谢你", 
                            "likes": 0, 
                            "replyToAuthor": "legal high"
                        }
                    ]
                }, 
                {
                    "userName": "是壳不是皮", 
                    "userLink": "https://www.zhihu.com/people/c4f11ef15016f8d5d757a021437af643", 
                    "content": "<p>还有个问题，用imu作为prediction的时候s，作者你是怎么对imu进行积分求速度和位置的？需要对原始加速度计的数据进行怎样的处理呢？</p><p></p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "legal high", 
                            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
                            "content": "加计转成大地坐标系", 
                            "likes": 0, 
                            "replyToAuthor": "是壳不是皮"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/52335076", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 9, 
            "title": "四元数、欧拉角及方向余弦矩阵的相互转化公式", 
            "content": "<p>最开始接触姿态结算的时候，四元数、欧拉角和方向余弦矩阵的相互转化便是在进阶路上的一条小老虎，看的多了，终于也算熟悉了。</p><p>引用别人的“<a href=\"https://zhuanlan.zhihu.com/p/46243954\" class=\"internal\">凡是把一本书读100遍的人，没有一个人不成大器</a>”这句话，希望对大家有所勉励。</p><p>基础理论</p><p>对于在三维空间里的一个参考系，任何坐标系的取向，都可以用三个欧拉角</p><p>来表现，一个与参考系重合的坐标系，通过绕 Z 轴的偏航角（Yaw），绕 Y 轴的</p><p>俯仰角（Pitch）和绕 X 轴的横滚角（Roll）旋转到当前姿态，常用坐标系如下：</p><figure data-size=\"small\"><noscript><img src=\"https://pic1.zhimg.com/v2-aa9bba6ff30af1c356ee5cd137e09008_b.jpg\" data-size=\"small\" data-rawwidth=\"616\" data-rawheight=\"614\" class=\"origin_image zh-lightbox-thumb\" width=\"616\" data-original=\"https://pic1.zhimg.com/v2-aa9bba6ff30af1c356ee5cd137e09008_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;616&#39; height=&#39;614&#39;&gt;&lt;/svg&gt;\" data-size=\"small\" data-rawwidth=\"616\" data-rawheight=\"614\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"616\" data-original=\"https://pic1.zhimg.com/v2-aa9bba6ff30af1c356ee5cd137e09008_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-aa9bba6ff30af1c356ee5cd137e09008_b.jpg\"/><figcaption>北东地坐标系</figcaption></figure><p>一、方向余弦矩阵 (参考《捷联惯性导航技术》张天光等)</p><p>假定初始时刻载体坐标系和世界坐标系重合， 那么任一向量在载体坐标系和世界坐标系中的表达式相同， 即 <img src=\"https://www.zhihu.com/equation?tex=r_%7Bb%7D+%3D+r_%7Bn%7D\" alt=\"r_{b} = r_{n}\" eeimg=\"1\"/> , <img src=\"https://www.zhihu.com/equation?tex=r_%7Bn%7D\" alt=\"r_{n}\" eeimg=\"1\"/> 先绕Z轴旋转角度 <img src=\"https://www.zhihu.com/equation?tex=%5Cpsi\" alt=\"\\psi\" eeimg=\"1\"/> ,旋转矩阵为：                                                               </p><p><img src=\"https://www.zhihu.com/equation?tex=C_%7B1%7D%3D+%5Cbegin%7Bbmatrix%7D+cos%5Cpsi%26sin%5Cpsi%260%5C%5C-sin%5Cpsi%26cos%5Cpsi%260%5C%5C0%260%261%5Cend+%7Bbmatrix%7D\" alt=\"C_{1}= \\begin{bmatrix} cos\\psi&amp;sin\\psi&amp;0\\\\-sin\\psi&amp;cos\\psi&amp;0\\\\0&amp;0&amp;1\\end {bmatrix}\" eeimg=\"1\"/> </p><p>推导如图：</p><figure data-size=\"small\"><noscript><img src=\"https://pic3.zhimg.com/v2-dd8fa451932cc96eefe1726480dc3892_b.jpg\" data-size=\"small\" data-rawwidth=\"890\" data-rawheight=\"674\" class=\"origin_image zh-lightbox-thumb\" width=\"890\" data-original=\"https://pic3.zhimg.com/v2-dd8fa451932cc96eefe1726480dc3892_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;890&#39; height=&#39;674&#39;&gt;&lt;/svg&gt;\" data-size=\"small\" data-rawwidth=\"890\" data-rawheight=\"674\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"890\" data-original=\"https://pic3.zhimg.com/v2-dd8fa451932cc96eefe1726480dc3892_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-dd8fa451932cc96eefe1726480dc3892_b.jpg\"/><figcaption>绕Z轴旋转，其他轴类似，Y轴旋转时方向相反</figcaption></figure><p>再绕 Y 轴旋转角度 <img src=\"https://www.zhihu.com/equation?tex=%5Ctheta+\" alt=\"\\theta \" eeimg=\"1\"/> <img src=\"https://www.zhihu.com/equation?tex=C_%7B2%7D%3D+%5Cbegin%7Bbmatrix%7D+cos%5Ctheta%260%26-sin%5Ctheta%5C%5C0%261%260%5C%5Csin%5Ctheta%260%26cos%5Ctheta%5Cend+%7Bbmatrix%7D\" alt=\"C_{2}= \\begin{bmatrix} cos\\theta&amp;0&amp;-sin\\theta\\\\0&amp;1&amp;0\\\\sin\\theta&amp;0&amp;cos\\theta\\end {bmatrix}\" eeimg=\"1\"/> </p><p>再绕 X 轴旋转角度 <img src=\"https://www.zhihu.com/equation?tex=%5Cphi\" alt=\"\\phi\" eeimg=\"1\"/> <img src=\"https://www.zhihu.com/equation?tex=C_%7B3%7D%3D+%5Cbegin%7Bbmatrix%7D+1%260%260%5C%5C0%26cos%5Cphi%26sin%5Cphi%5C%5C0%26-sin%5Cphi%26cos%5Cphi%5Cend+%7Bbmatrix%7D\" alt=\"C_{3}= \\begin{bmatrix} 1&amp;0&amp;0\\\\0&amp;cos\\phi&amp;sin\\phi\\\\0&amp;-sin\\phi&amp;cos\\phi\\end {bmatrix}\" eeimg=\"1\"/> </p><p>此时 <img src=\"https://www.zhihu.com/equation?tex=r_%7Bn%7D\" alt=\"r_{n}\" eeimg=\"1\"/> 然保持不变， 但是在载体坐标系中的表达式则变为 <img src=\"https://www.zhihu.com/equation?tex=r%5E%7B%27%7D_%7Bb%7D+%3D+C_%7B3%7DC_%7B2%7DC_%7B1%7Dr_%7Bb%7D+%3D+C_%7B3%7DC_%7B2%7DC_%7B1%7Dr_%7Bn%7D\" alt=\"r^{&#39;}_{b} = C_{3}C_{2}C_{1}r_{b} = C_{3}C_{2}C_{1}r_{n}\" eeimg=\"1\"/> </p><p>因此从世界坐标系到载体坐标系的变换矩阵可由下式给出</p><p><img src=\"https://www.zhihu.com/equation?tex=C%5E%7Bb%7D_%7Bn%7D+%3D+C_%7B3%7DC_%7B2%7DC_%7B1%7D\" alt=\"C^{b}_{n} = C_{3}C_{2}C_{1}\" eeimg=\"1\"/> </p><p>那么，从载体坐标系到世界坐标系的转变矩阵可以表示如下：</p><p><img src=\"https://www.zhihu.com/equation?tex=C%5E%7Bn%7D_%7Bb%7D++%3D+C%5E%7Bb%27%7D_%7Bn%7D+%3D+C%5E%7B%27%7D_%7B1%7DC%5E%7B%27%7D_%7B2%7DC%5E%7B%27%7D_%7B3%7D+%5CRightarrow+C%5E%7B%27%7D_%7B1%7D%3D+%5Cbegin%7Bbmatrix%7D+cos%5Cpsi%26-sin%5Cpsi%260%5C%5Csin%5Cpsi%26cos%5Cpsi%260%5C%5C0%260%261%5Cend+%7Bbmatrix%7D+C%5E%7B%27%7D_%7B2%7D%3D+%5Cbegin%7Bbmatrix%7D+cos%5Ctheta%260%26sin%5Ctheta%5C%5C0%261%260%5C%5C-sin%5Ctheta%260%26cos%5Ctheta%5Cend+%7Bbmatrix%7D+C%5E%7B%27%7D_%7B3%7D%3D+%5Cbegin%7Bbmatrix%7D+1%260%260%5C%5C0%26cos%5Cphi%26-sin%5Cphi%5C%5C0%26sin%5Cphi%26cos%5Cphi%5Cend+%7Bbmatrix%7D\" alt=\"C^{n}_{b}  = C^{b&#39;}_{n} = C^{&#39;}_{1}C^{&#39;}_{2}C^{&#39;}_{3} \\Rightarrow C^{&#39;}_{1}= \\begin{bmatrix} cos\\psi&amp;-sin\\psi&amp;0\\\\sin\\psi&amp;cos\\psi&amp;0\\\\0&amp;0&amp;1\\end {bmatrix} C^{&#39;}_{2}= \\begin{bmatrix} cos\\theta&amp;0&amp;sin\\theta\\\\0&amp;1&amp;0\\\\-sin\\theta&amp;0&amp;cos\\theta\\end {bmatrix} C^{&#39;}_{3}= \\begin{bmatrix} 1&amp;0&amp;0\\\\0&amp;cos\\phi&amp;-sin\\phi\\\\0&amp;sin\\phi&amp;cos\\phi\\end {bmatrix}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=C%5E%7Bn%7D_%7Bb%7D+%3D+%5Cbegin%7Bbmatrix%7D+cos%5Cpsi+cos%5Ctheta%26cos%5Cpsi+sin%5Ctheta+sin%5Cphi-cos%5Cphi+sin%5Cpsi+%26sin%5Cpsi+sin%5Cphi%2Bcos%5Cphi+cos%5Cpsi+sin%5Ctheta%5C%5Ccos%5Ctheta+sin%5Cpsi%26cos%5Cpsi+cos%5Cphi+%2B+sin%5Cpsi+sin%5Cphi+sin%5Ctheta%26cos%5Cphi+sin%5Cpsi+sin%5Ctheta-cos%5Cpsi+sin%5Cphi%5C%5C-sin%5Ctheta%26cos%5Ctheta+sin%5Cphi%26cos%5Ctheta+cos%5Cphi%5Cend+%7Bbmatrix%7D\" alt=\"C^{n}_{b} = \\begin{bmatrix} cos\\psi cos\\theta&amp;cos\\psi sin\\theta sin\\phi-cos\\phi sin\\psi &amp;sin\\psi sin\\phi+cos\\phi cos\\psi sin\\theta\\\\cos\\theta sin\\psi&amp;cos\\psi cos\\phi + sin\\psi sin\\phi sin\\theta&amp;cos\\phi sin\\psi sin\\theta-cos\\psi sin\\phi\\\\-sin\\theta&amp;cos\\theta sin\\phi&amp;cos\\theta cos\\phi\\end {bmatrix}\" eeimg=\"1\"/> </p><p>此外，注意到当姿态角很小的时候， <img src=\"https://www.zhihu.com/equation?tex=C%5E%7Bn%7D_%7Bb%7D\" alt=\"C^{n}_{b}\" eeimg=\"1\"/> 可以简化成：</p><p><img src=\"https://www.zhihu.com/equation?tex=C%5E%7Bn%7D_%7Bb%7D+%3D+%5Cbegin%7Bbmatrix%7D1%26-%5Cpsi+%26%5Ctheta%5C%5C%5Cpsi%261%26-%5Cphi%5C%5C-%5Ctheta%26%5Cphi%261%5Cend+%7Bbmatrix%7D\" alt=\"C^{n}_{b} = \\begin{bmatrix}1&amp;-\\psi &amp;\\theta\\\\\\psi&amp;1&amp;-\\phi\\\\-\\theta&amp;\\phi&amp;1\\end {bmatrix}\" eeimg=\"1\"/> </p><p class=\"ztext-empty-paragraph\"><br/></p><p>二、欧拉角与四元数</p><p>按Z-Y-X的旋转变换顺序有：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbegin%7Bbmatrix%7Dq_%7B0%7D+%5C%5Cq_%7B1%7D%5C%5Cq_%7B3%7D%5C%5Cq_%7B4%7D+%5Cend+%7Bbmatrix%7D%3D%5Cbegin%7Bbmatrix%7Dcos%28%5Cpsi%2F2%29+%5C%5C0%5C%5C0%5C%5Csin%28%5Cpsi%2F2%29+%5Cend+%7Bbmatrix%7D%5Cbegin%7Bbmatrix%7Dcos%28%5Ctheta%2F2%29+%5C%5C0%5C%5Csin%28%5Ctheta%2F2%29+%5C%5C0%5Cend+%7Bbmatrix%7D%5Cbegin%7Bbmatrix%7Dcos%28%5Cphi%2F2%29+%5C%5Csin%28%5Cphi%2F2%29%5C%5C0+%5C%5C0%5Cend+%7Bbmatrix%7D\" alt=\"\\begin{bmatrix}q_{0} \\\\q_{1}\\\\q_{3}\\\\q_{4} \\end {bmatrix}=\\begin{bmatrix}cos(\\psi/2) \\\\0\\\\0\\\\sin(\\psi/2) \\end {bmatrix}\\begin{bmatrix}cos(\\theta/2) \\\\0\\\\sin(\\theta/2) \\\\0\\end {bmatrix}\\begin{bmatrix}cos(\\phi/2) \\\\sin(\\phi/2)\\\\0 \\\\0\\end {bmatrix}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%3D%5Cbegin%7Bbmatrix%7Dcos%28%5Cphi%2F2%29cos%28%5Ctheta%2F2%29+cos%28%5Cpsi%2F2%29+%2Bsin%28%5Cphi%2F2%29sin%28%5Ctheta%2F2%29sin+%28%5Cpsi%2F2%29+%5C%5Csin%28%5Cphi%2F2%29cos%28%5Ctheta%2F2%29+cos%28%5Cpsi%2F2%29+-cos%28%5Cphi%2F2%29sin%28%5Ctheta%2F2%29+sin%28%5Cpsi%2F2%29%5C%5Ccos%28%5Cphi%2F2%29sin%28%5Ctheta%2F2%29+cos%28%5Cpsi%2F2%29+%2Bsin%28%5Cphi%2F2%29cos%28%5Ctheta%2F2%29+sin%28%5Cpsi%2F2%29%5C%5Ccos%28%5Cphi%2F2%29cos%28%5Ctheta%2F2%29+sin%28%5Cpsi%2F2%29+-sin%28%5Cphi%2F2%29sin%28%5Ctheta%2F2%29+cos%28%5Cpsi%2F2%29%5Cend+%7Bbmatrix%7D\" alt=\"=\\begin{bmatrix}cos(\\phi/2)cos(\\theta/2) cos(\\psi/2) +sin(\\phi/2)sin(\\theta/2)sin (\\psi/2) \\\\sin(\\phi/2)cos(\\theta/2) cos(\\psi/2) -cos(\\phi/2)sin(\\theta/2) sin(\\psi/2)\\\\cos(\\phi/2)sin(\\theta/2) cos(\\psi/2) +sin(\\phi/2)cos(\\theta/2) sin(\\psi/2)\\\\cos(\\phi/2)cos(\\theta/2) sin(\\psi/2) -sin(\\phi/2)sin(\\theta/2) cos(\\psi/2)\\end {bmatrix}\" eeimg=\"1\"/> </p><p>四元数与旋转矩阵（常用来做坐标变换）</p><p>2.1  b系转到R系的坐标变换矩阵</p><p><img src=\"https://www.zhihu.com/equation?tex=p%27+%3D+q%5Cotimes+p%5Cotimes+q%2A\" alt=\"p&#39; = q\\otimes p\\otimes q*\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=C_%7Bb%7D%5E%7BR%7D+%3D+%5Cbegin%7Bbmatrix%7Dq_%7B0%7D%5E%7B2%7D%2Bq_%7B1%7D%5E%7B2%7D-q_%7B2%7D%5E%7B2%7D-q_%7B3%7D%5E%7B2%7D+%26++2%28q_%7B1%7Dq_%7B2%7D-q_%7B0%7Dq_%7B3%7D%29%26+2%28q_%7B1%7Dq_%7B3%7D%2Bq_%7B0%7Dq_%7B2%7D%29+%5C%5C2%28q_%7B1%7Dq_%7B2%7D%2Bq_%7B0%7Dq_%7B3%7D%29+%26+q_%7B0%7D%5E%7B2%7D-q_%7B1%7D%5E%7B2%7D%2Bq_%7B2%7D%5E%7B2%7D-q_%7B3%7D%5E%7B2%7D+%26+2%28q_%7B2%7Dq_%7B3%7D-q_%7B0%7Dq_%7B1%7D%29++%5C%5C++2%28q_%7B1%7Dq_%7B3%7D-q_%7B0%7Dq_%7B2%7D%29%26+2%28q_%7B2%7Dq_%7B3%7D%2Bq_%7B0%7Dq_%7B1%7D%29%26q_%7B0%7D%5E%7B2%7D-q_%7B1%7D%5E%7B2%7D-q_%7B2%7D%5E%7B2%7D%2Bq_%7B3%7D%5E%7B2%7D%5Cend+%7Bbmatrix%7D\" alt=\"C_{b}^{R} = \\begin{bmatrix}q_{0}^{2}+q_{1}^{2}-q_{2}^{2}-q_{3}^{2} &amp;  2(q_{1}q_{2}-q_{0}q_{3})&amp; 2(q_{1}q_{3}+q_{0}q_{2}) \\\\2(q_{1}q_{2}+q_{0}q_{3}) &amp; q_{0}^{2}-q_{1}^{2}+q_{2}^{2}-q_{3}^{2} &amp; 2(q_{2}q_{3}-q_{0}q_{1})  \\\\  2(q_{1}q_{3}-q_{0}q_{2})&amp; 2(q_{2}q_{3}+q_{0}q_{1})&amp;q_{0}^{2}-q_{1}^{2}-q_{2}^{2}+q_{3}^{2}\\end {bmatrix}\" eeimg=\"1\"/> </p><p>2.2 R系转到b系的坐标变换矩阵</p><p><img src=\"https://www.zhihu.com/equation?tex=C_%7BR%7D%5E%7Bb%7D++%3D%7B+C_%7Bb%7D%5E%7BR%7D+%7D%5E%7BT%7D\" alt=\"C_{R}^{b}  ={ C_{b}^{R} }^{T}\" eeimg=\"1\"/> (为上述矩阵的转置)</p><p>对比R和 <img src=\"https://www.zhihu.com/equation?tex=C_%7Bb%7D%5E%7BR%7D+\" alt=\"C_{b}^{R} \" eeimg=\"1\"/> 即可很容易将四元数转换成欧拉角。</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbegin%7Bbmatrix%7D%5Cphi+%5C%5C%5Ctheta%5C%5C%5Cpsi+%5Cend+%7Bbmatrix%7D+%3D+%5Cbegin%7Bbmatrix%7Darctan%7B%5Cfrac%7B2%28q_%7B0%7Dq_%7B1%7D%2Bq_%7B2%7Dq_%7B3%7D%29%7D%7Bq_%7B0%7D%5E2-q_%7B1%7D%5E2-q_%7B2%7D%5E2%2Bq_%7B3%7D%5E2%7D%7D%5C%5Carcsin%5B2%28q_%7B0%7Dq_%7B2%7D-q_%7B1%7Dq_%7B3%7D%29%5D%5C%5Carctan%7B%5Cfrac%7B2%28q_%7B0%7Dq_%7B3%7D%2Bq_%7B1%7Dq_%7B2%7D%29%7D%7Bq_%7B0%7D%5E2%2Bq_%7B1%7D%5E2-q_%7B2%7D%5E2-q_%7B3%7D%5E2%7D%7D%5Cend+%7Bbmatrix%7D\" alt=\"\\begin{bmatrix}\\phi \\\\\\theta\\\\\\psi \\end {bmatrix} = \\begin{bmatrix}arctan{\\frac{2(q_{0}q_{1}+q_{2}q_{3})}{q_{0}^2-q_{1}^2-q_{2}^2+q_{3}^2}}\\\\arcsin[2(q_{0}q_{2}-q_{1}q_{3})]\\\\arctan{\\frac{2(q_{0}q_{3}+q_{1}q_{2})}{q_{0}^2+q_{1}^2-q_{2}^2-q_{3}^2}}\\end {bmatrix}\" eeimg=\"1\"/> </p><p>三、四元数的更新</p><p><img src=\"https://www.zhihu.com/equation?tex=Q+%3D+cos%EF%BC%88%5Ctheta%2F2%EF%BC%89%2Bn%2Asin%28%5Ctheta%2F2%29\" alt=\"Q = cos（\\theta/2）+n*sin(\\theta/2)\" eeimg=\"1\"/> </p><p>Q对时间求导数：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cfrac%7B%5Cpartial+Q+%7D%7B%5Cpartial+t%7D%3D+-%5Cfrac%7B1+%7D%7B2%7Dsin%EF%BC%88%5Ctheta%2F2%EF%BC%89%5Cfrac%7B%5Cpartial+%5Ctheta+%7D%7B%5Cpartial+t%7D%2B%5Cfrac%7B%5Cpartial+n+%7D%7B%5Cpartial+t%7D%2Asin%28%5Ctheta%2F2%29+%2B+n%2Acos%28%5Ctheta%2F2%29%5Cfrac%7B%5Cpartial+%5Ctheta+%7D%7B%5Cpartial+t%7D\" alt=\"\\frac{\\partial Q }{\\partial t}= -\\frac{1 }{2}sin（\\theta/2）\\frac{\\partial \\theta }{\\partial t}+\\frac{\\partial n }{\\partial t}*sin(\\theta/2) + n*cos(\\theta/2)\\frac{\\partial \\theta }{\\partial t}\" eeimg=\"1\"/> </p><p>因为</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cfrac%7B%5Cpartial+n+%7D%7B%5Cpartial+t%7D%3D0+\" alt=\"\\frac{\\partial n }{\\partial t}=0 \" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=n%2An%3D-1\" alt=\"n*n=-1\" eeimg=\"1\"/> </p><p>所以</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cfrac%7B%5Cpartial+Q+%7D%7B%5Cpartial+t%7D%3D+%5Cfrac%7B1+%7D%7B2%7D+%28cos%EF%BC%88%5Ctheta%2F2%29+%2B+n%2Asin%EF%BC%88%5Ctheta%2F2%29%29%5Cfrac%7B%5Cpartial+%5Ctheta+%7D%7B%5Cpartial+t%7D\" alt=\"\\frac{\\partial Q }{\\partial t}= \\frac{1 }{2} (cos（\\theta/2) + n*sin（\\theta/2))\\frac{\\partial \\theta }{\\partial t}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cfrac%7B%5Cpartial+Q+%7D%7B%5Cpartial+t%7D%3D+%5Cfrac%7B1+%7D%7B2%7D+W%5E%7Bn%7DQ\" alt=\"\\frac{\\partial Q }{\\partial t}= \\frac{1 }{2} W^{n}Q\" eeimg=\"1\"/> 其中 <img src=\"https://www.zhihu.com/equation?tex=W%5E%7Bn%7D%3D%5Cfrac%7B%5Cpartial+%5Ctheta+%7D%7B%5Cpartial+t%7D\" alt=\"W^{n}=\\frac{\\partial \\theta }{\\partial t}\" eeimg=\"1\"/> 也是大地坐标系下的角速度,由四元数旋转得：</p><p><img src=\"https://www.zhihu.com/equation?tex=W%5E%7Bn%7D%3DQW%5E%7Bb%7DQ%5E%7B%2A%7D\" alt=\"W^{n}=QW^{b}Q^{*}\" eeimg=\"1\"/> 推出 <img src=\"https://www.zhihu.com/equation?tex=W%5E%7Bn%7DQ%3DQW%5E%7Bb%7D\" alt=\"W^{n}Q=QW^{b}\" eeimg=\"1\"/> </p><p>所以 <img src=\"https://www.zhihu.com/equation?tex=%5Cfrac%7B%5Cpartial+Q+%7D%7B%5Cpartial+t%7D%3D+%5Cfrac%7B1+%7D%7B2%7D+QW%5E%7Bb%7D\" alt=\"\\frac{\\partial Q }{\\partial t}= \\frac{1 }{2} QW^{b}\" eeimg=\"1\"/> </p><p>代码实现：</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"kt\">void</span> <span class=\"nf\">abcd2cbn</span><span class=\"p\">(</span><span class=\"n\">strcut</span><span class=\"o\">*</span> <span class=\"n\">data</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n    <span class=\"kt\">float</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"p\">,</span> <span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"n\">ab</span><span class=\"p\">,</span> <span class=\"n\">ac</span><span class=\"p\">,</span> <span class=\"n\">ad</span><span class=\"p\">,</span> <span class=\"n\">bb</span><span class=\"p\">,</span> <span class=\"n\">bc</span><span class=\"p\">,</span> <span class=\"n\">bd</span><span class=\"p\">,</span> <span class=\"n\">cc</span><span class=\"p\">,</span> <span class=\"n\">cd</span><span class=\"p\">,</span> <span class=\"n\">dd</span><span class=\"p\">;</span>\n\n    <span class=\"n\">a</span>  <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">-&gt;</span><span class=\"n\">q0</span>\n    <span class=\"n\">b</span>  <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">-&gt;</span><span class=\"n\">q1</span>\n    <span class=\"n\">c</span>  <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">-&gt;</span><span class=\"n\">q2</span>\n    <span class=\"n\">d</span>  <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">-&gt;</span><span class=\"n\">q3</span>\n\n    <span class=\"n\">ab</span> <span class=\"o\">=</span> <span class=\"n\">a</span> <span class=\"o\">*</span> <span class=\"n\">b</span><span class=\"p\">;</span>\n    <span class=\"n\">ac</span> <span class=\"o\">=</span> <span class=\"n\">a</span> <span class=\"o\">*</span> <span class=\"n\">c</span><span class=\"p\">;</span>\n    <span class=\"n\">ad</span> <span class=\"o\">=</span> <span class=\"n\">a</span> <span class=\"o\">*</span> <span class=\"n\">d</span><span class=\"p\">;</span>\n    <span class=\"n\">bb</span> <span class=\"o\">=</span> <span class=\"n\">b</span> <span class=\"o\">*</span> <span class=\"n\">b</span><span class=\"p\">;</span>\n    <span class=\"n\">bc</span> <span class=\"o\">=</span> <span class=\"n\">b</span> <span class=\"o\">*</span> <span class=\"n\">c</span><span class=\"p\">;</span>\n    <span class=\"n\">bd</span> <span class=\"o\">=</span> <span class=\"n\">b</span> <span class=\"o\">*</span> <span class=\"n\">d</span><span class=\"p\">;</span>\n    <span class=\"n\">cc</span> <span class=\"o\">=</span> <span class=\"n\">c</span> <span class=\"o\">*</span> <span class=\"n\">c</span><span class=\"p\">;</span>\n    <span class=\"n\">cd</span> <span class=\"o\">=</span> <span class=\"n\">c</span> <span class=\"o\">*</span> <span class=\"n\">d</span><span class=\"p\">;</span>\n    <span class=\"n\">dd</span> <span class=\"o\">=</span> <span class=\"n\">d</span> <span class=\"o\">*</span> <span class=\"n\">d</span><span class=\"p\">;</span>\n\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn11</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">cc</span> <span class=\"o\">+</span> <span class=\"n\">dd</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn12</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">bc</span> <span class=\"o\">-</span> <span class=\"n\">ad</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn13</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">bd</span> <span class=\"o\">+</span> <span class=\"n\">ac</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn21</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">bc</span> <span class=\"o\">+</span> <span class=\"n\">ad</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn22</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">bb</span> <span class=\"o\">+</span> <span class=\"n\">dd</span><span class=\"p\">);</span>\n    <span class=\"n\">dataa</span><span class=\"p\">.</span><span class=\"n\">cbn23</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">cd</span> <span class=\"o\">-</span> <span class=\"n\">ab</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn31</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">bd</span> <span class=\"o\">-</span> <span class=\"n\">ac</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn32</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">cd</span> <span class=\"o\">+</span> <span class=\"n\">ab</span><span class=\"p\">);</span>\n    <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">cbn33</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">bb</span> <span class=\"o\">+</span> <span class=\"n\">cc</span><span class=\"p\">);</span>\n<span class=\"p\">}</span></code></pre></div><p></p>", 
            "topic": [
                {
                    "tag": "传感器", 
                    "tagLink": "https://api.zhihu.com/topics/19561057"
                }
            ], 
            "comments": [
                {
                    "userName": "llllllll", 
                    "userLink": "https://www.zhihu.com/people/9d906c11fea89c10da66e30801663ccb", 
                    "content": "标题写错了，是四元数不是四元素。", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/50765306", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 2, 
            "title": "数据融合——几种常见的估计", 
            "content": "<p>所谓估计，就是根据测量的出的与状态 <img src=\"https://www.zhihu.com/equation?tex=X%28t%29\" alt=\"X(t)\" eeimg=\"1\"/> 有关的数据 <img src=\"https://www.zhihu.com/equation?tex=Z%28t%29%3Dh%5BX%28t%29%5D+%2BV%28t%29\" alt=\"Z(t)=h[X(t)] +V(t)\" eeimg=\"1\"/> 解算出 <img src=\"https://www.zhihu.com/equation?tex=X%28t%29\" alt=\"X(t)\" eeimg=\"1\"/> 的计算值 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X%28t%29\" alt=\"\\hat X(t)\" eeimg=\"1\"/> ,其中随机向量 <img src=\"https://www.zhihu.com/equation?tex=V%28t%29\" alt=\"V(t)\" eeimg=\"1\"/> 为量测误差， <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 称为<img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的估计， <img src=\"https://www.zhihu.com/equation?tex=Z\" alt=\"Z\" eeimg=\"1\"/> 称为 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的量测。</p><p>因为 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 是根据 <img src=\"https://www.zhihu.com/equation?tex=Z%28t%29\" alt=\"Z(t)\" eeimg=\"1\"/> 来确定的，所以 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X%28t%29\" alt=\"\\hat X(t)\" eeimg=\"1\"/> 是 <img src=\"https://www.zhihu.com/equation?tex=Z%28t%29\" alt=\"Z(t)\" eeimg=\"1\"/> 的函数。若 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 是 <img src=\"https://www.zhihu.com/equation?tex=Z\" alt=\"Z\" eeimg=\"1\"/> 的线性函数，则称 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 是 <img src=\"https://www.zhihu.com/equation?tex=Z\" alt=\"Z\" eeimg=\"1\"/> 的线性估计。</p><h2>我们学过的估计</h2><p>1、最小二乘估计</p><p>设 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 为随机变量， <img src=\"https://www.zhihu.com/equation?tex=Z\" alt=\"Z\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的量测，量测方程为</p><p><img src=\"https://www.zhihu.com/equation?tex=Z_%7B1%7D+%3D+H_%7B1%7DX%2BV_%7B1%7D++\" alt=\"Z_{1} = H_{1}X+V_{1}  \" eeimg=\"1\"/></p><p><img src=\"https://www.zhihu.com/equation?tex=Z_%7B2%7D+%3D+H_%7B2%7DX%2BV_%7B2%7D+\" alt=\"Z_{2} = H_{2}X+V_{2} \" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cvdots\" alt=\"\\vdots\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=Z_%7Bi%7D+%3D+H_%7Bi%7DX%2BV_%7Bi%7D\" alt=\"Z_{i} = H_{i}X+V_{i}\" eeimg=\"1\"/> </p><p>若找到 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 使得 <img src=\"https://www.zhihu.com/equation?tex=%28Z-H%5Chat+X%29%5ET+%28Z-HX%29\" alt=\"(Z-H\\hat X)^T (Z-HX)\" eeimg=\"1\"/> 最小，则称 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的最小二乘估计</p><p>可以证明: <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X%3D%28H%5ET+H%29%5E%7B-1%7D+H%5ET+Z\" alt=\"\\hat X=(H^T H)^{-1} H^T Z\" eeimg=\"1\"/> </p><p class=\"ztext-empty-paragraph\"><br/></p><p>2、最小方差估计</p><p>定理：最小方差估计等量测为某一具体实现条件下的条件均值：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Chat+X%28Z%29+%3D+E%28X%2FZ%29\" alt=\"\\hat X(Z) = E(X/Z)\" eeimg=\"1\"/> </p><p>若找到 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 使得 <img src=\"https://www.zhihu.com/equation?tex=E%28%28X-%5Chat+X%29%5E%7BT%7D%28X-%5Chat+X%29%29\" alt=\"E((X-\\hat X)^{T}(X-\\hat X))\" eeimg=\"1\"/> 最小，则称 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的最小方差估计</p><p>可以被证明当 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 与 <img src=\"https://www.zhihu.com/equation?tex=Z\" alt=\"Z\" eeimg=\"1\"/> 均为正态分布时， 且</p><p><img src=\"https://www.zhihu.com/equation?tex=E%28X%29+%3D+m_%7BX%7D\" alt=\"E(X) = m_{X}\" eeimg=\"1\"/> ， <img src=\"https://www.zhihu.com/equation?tex=E%28Z%29+%3D+m_%7BZ%7D\" alt=\"E(Z) = m_{Z}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=Cov%28X%2CZ%29%3DE%5B%28X-m_%7BX%7D%29%28X-m_%7BZ%7D%29%5D%3DC_%7BXZ%7D\" alt=\"Cov(X,Z)=E[(X-m_{X})(X-m_{Z})]=C_{XZ}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=Var%5BZ%5D%3DE%5B%28Z-m_%7BZ%7D%29%28Z-m_%7BZ%7D%29%5E%7BT%7D%5D%3DC_%7BZ%7D\" alt=\"Var[Z]=E[(Z-m_{Z})(Z-m_{Z})^{T}]=C_{Z}\" eeimg=\"1\"/> </p><p>则<img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的最小方差估计为：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Chat+X+%28Z%29%3Dm_%7BX%7D%2BC_%7BXZ%7D+C_%7BZ%7D%5E%7B-1%7D+%28Z-m_%7BZ+%7D+%29\" alt=\"\\hat X (Z)=m_{X}+C_{XZ} C_{Z}^{-1} (Z-m_{Z } )\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=Var%5BX-%5Chat+X%5D%3DC_%7BX%7D-C_%7BXZ%7D+C_%7BZ%7D%5E%7B-1%7D+C_%7BZX%7D\" alt=\"Var[X-\\hat X]=C_{X}-C_{XZ} C_{Z}^{-1} C_{ZX}\" eeimg=\"1\"/> </p><p class=\"ztext-empty-paragraph\"><br/></p><p>3、极大后验估计</p><p>设 <img src=\"https://www.zhihu.com/equation?tex=X+\" alt=\"X \" eeimg=\"1\"/> 为随机变量， <img src=\"https://www.zhihu.com/equation?tex=Z\" alt=\"Z\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X+\" alt=\"X \" eeimg=\"1\"/> 的量测， <img src=\"https://www.zhihu.com/equation?tex=%5Crho%28x%2Fz%29\" alt=\"\\rho(x/z)\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=Z%3Dz\" alt=\"Z=z\" eeimg=\"1\"/> 条件下的条件概率密度，如果估计值 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 使得 <img src=\"https://www.zhihu.com/equation?tex=%5Crho%28x%2Fz%29+\" alt=\"\\rho(x/z) \" eeimg=\"1\"/> 最大，则称 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X+\" alt=\"X \" eeimg=\"1\"/> 的极大验后估计。</p><p class=\"ztext-empty-paragraph\"><br/></p><p>4、极大似然估计</p><p>设 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 为随机变量， <img src=\"https://www.zhihu.com/equation?tex=Z+\" alt=\"Z \" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的量测， <img src=\"https://www.zhihu.com/equation?tex=%5Crho%28z%2Fx%29\" alt=\"\\rho(z/x)\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X%3Dx\" alt=\"X=x\" eeimg=\"1\"/> 条件下的条件概率密度，如果估计值 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X+\" alt=\"\\hat X \" eeimg=\"1\"/> 使得 <img src=\"https://www.zhihu.com/equation?tex=%5Crho%28z%2Fx%29\" alt=\"\\rho(z/x)\" eeimg=\"1\"/> 最大，则称 <img src=\"https://www.zhihu.com/equation?tex=%5Chat+X\" alt=\"\\hat X\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=X\" alt=\"X\" eeimg=\"1\"/> 的极大似然估计。</p><p class=\"ztext-empty-paragraph\"><br/></p><h2>卡尔曼滤波</h2><p>设 <img src=\"https://www.zhihu.com/equation?tex=t_%7Bk%7D\" alt=\"t_{k}\" eeimg=\"1\"/> 时刻的被估计状态 <img src=\"https://www.zhihu.com/equation?tex=X_%7Bk%7D\" alt=\"X_{k}\" eeimg=\"1\"/> 受系统噪声序列 <img src=\"https://www.zhihu.com/equation?tex=W_%7Bk-1%7D\" alt=\"W_{k-1}\" eeimg=\"1\"/> 驱动，则状态方程可描述如下：</p><p><img src=\"https://www.zhihu.com/equation?tex=X_%7Bk%7D+%3D+%5CPhi_%7Bk%2Ck-1%7DX_%7Bk-1%7D+%2B+%5CGamma_%7Bk-1%7DW_%7Bk-1%7D\" alt=\"X_{k} = \\Phi_{k,k-1}X_{k-1} + \\Gamma_{k-1}W_{k-1}\" eeimg=\"1\"/> </p><p>量测方程为：</p><p><img src=\"https://www.zhihu.com/equation?tex=Z_%7Bk%7D+%3D+H_%7Bk%7DX_%7Bk%7D+%2B+V_%7Bk%7D\" alt=\"Z_{k} = H_{k}X_{k} + V_{k}\" eeimg=\"1\"/> </p><p>其中</p><p><img src=\"https://www.zhihu.com/equation?tex=%5CPhi_%7Bk%2Ck-1%7D\" alt=\"\\Phi_{k,k-1}\" eeimg=\"1\"/> 为 <img src=\"https://www.zhihu.com/equation?tex=t_%7Bk-1%7D\" alt=\"t_{k-1}\" eeimg=\"1\"/> 时刻至 <img src=\"https://www.zhihu.com/equation?tex=t_%7Bk%7D\" alt=\"t_{k}\" eeimg=\"1\"/> 时刻的一步转移阵</p><p><img src=\"https://www.zhihu.com/equation?tex=%5CGamma_%7Bk-1%7D\" alt=\"\\Gamma_{k-1}\" eeimg=\"1\"/> 为系统噪声驱动阵； <img src=\"https://www.zhihu.com/equation?tex=W_%7Bk-1%7D\" alt=\"W_{k-1}\" eeimg=\"1\"/> 为系统激励噪声序列</p><p><img src=\"https://www.zhihu.com/equation?tex=H_%7Bk%7D\" alt=\"H_{k}\" eeimg=\"1\"/> 为量测阵；<img src=\"https://www.zhihu.com/equation?tex=V_%7Bk%7D\" alt=\"V_{k}\" eeimg=\"1\"/> 为量测噪声序列</p><p>同时, <img src=\"https://www.zhihu.com/equation?tex=W_%7Bk%7D\" alt=\"W_{k}\" eeimg=\"1\"/> 和 <img src=\"https://www.zhihu.com/equation?tex=V_%7Bk%7D\" alt=\"V_{k}\" eeimg=\"1\"/> 满足:</p><p><img src=\"https://www.zhihu.com/equation?tex=E%5BW_%7Bk%7D%5D%3D0%2CCov%5BW_%7Bk%7D%2CW_%7Bj%7D%5D%3DE%5BW_%7Bk%7D%2CW_%7Bj%7D%5D%3DE%5BW_%7Bk%7DW_%7Bj%7D%5ET%5D%3DQ_%7Bk%7D%5Cdelta_%7Bkj%7D\" alt=\"E[W_{k}]=0,Cov[W_{k},W_{j}]=E[W_{k},W_{j}]=E[W_{k}W_{j}^T]=Q_{k}\\delta_{kj}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=E%5BV_%7Bk%7D%5D%3D0%2CCov%5BV_%7Bk%7D%2CV_%7Bj%7D%5D%3DE%5BV_%7Bk%7D%2CV_%7Bj%7D%5D%3DE%5BV_%7Bk%7DV_%7Bj%7D%5ET%5D%3DR_%7Bk%7D%5Cdelta_%7Bkj%7D\" alt=\"E[V_{k}]=0,Cov[V_{k},V_{j}]=E[V_{k},V_{j}]=E[V_{k}V_{j}^T]=R_{k}\\delta_{kj}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=Cov%5BW_%7Bk%7D%2CV_%7Bj%7D%5D%3DE%5BW_%7Bk%7DV_%7Bj%7D%5ET%5D%3D0\" alt=\"Cov[W_{k},V_{j}]=E[W_{k}V_{j}^T]=0\" eeimg=\"1\"/> </p><p>则卡尔曼滤波方程如下：</p><p>状态一步预测：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Chat+X_%7Bk%2Fk-1%7D+%3D+%5CPhi_%7Bk%2Ck-1%7D%5Chat+X_%7Bk-1%7D\" alt=\"\\hat X_{k/k-1} = \\Phi_{k,k-1}\\hat X_{k-1}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=P_%7Bk%2Fk-1%7D+%3D%5CPhi_%7Bk%2Ck-1%7DP_%7Bk%7D%5CPhi_%7Bk%2Fk-1%7D%5E%7BT%7D+%2B+%5CGamma_%7Bk-1%7DQ_%7Bk-1%7D%5CGamma_%7Bk-1%7D%5E%7BT%7D\" alt=\"P_{k/k-1} =\\Phi_{k,k-1}P_{k}\\Phi_{k/k-1}^{T} + \\Gamma_{k-1}Q_{k-1}\\Gamma_{k-1}^{T}\" eeimg=\"1\"/> 一步预测均方误差，对一步预测的优劣做了判断</p><p>状态估计：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Chat+X_%7Bk%7D%3D%5Chat+X_%7Bk%2Fk-1%7D+%2B+K_%7Bk%7D%28Z_%7Bk%7D-H_%7Bk%7D%5Chat+X_%7Bk%2Fk-1%7D%29\" alt=\"\\hat X_{k}=\\hat X_{k/k-1} + K_{k}(Z_{k}-H_{k}\\hat X_{k/k-1})\" eeimg=\"1\"/> </p><p>其中滤波增益 <img src=\"https://www.zhihu.com/equation?tex=K_%7Bk%7D%3DP_%7Bk%2Fk-1%7DH_%7Bk%7D%5ET%28H_%7Bk%7DP_%7Bk%2Fk-1%7DH_%7Bk%7D%5ET%2BR_%7Bk%7D%29%5E%7B-1%7D\" alt=\"K_{k}=P_{k/k-1}H_{k}^T(H_{k}P_{k/k-1}H_{k}^T+R_{k})^{-1}\" eeimg=\"1\"/> </p><p>估计均方误差 <img src=\"https://www.zhihu.com/equation?tex=P_%7Bk%7D%3D%28I-K_%7Bk%7DH_%7Bk%7D%29P_%7Bk%2Ck-1%7D\" alt=\"P_{k}=(I-K_{k}H_{k})P_{k,k-1}\" eeimg=\"1\"/> </p><p>以上方程可归纳为两个计算回路和两个更新过程：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-374310c7d80a18019d311160f8102c49_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1050\" data-rawheight=\"468\" class=\"origin_image zh-lightbox-thumb\" width=\"1050\" data-original=\"https://pic2.zhimg.com/v2-374310c7d80a18019d311160f8102c49_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1050&#39; height=&#39;468&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1050\" data-rawheight=\"468\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1050\" data-original=\"https://pic2.zhimg.com/v2-374310c7d80a18019d311160f8102c49_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-374310c7d80a18019d311160f8102c49_b.jpg\"/></figure><p>python代码如下：</p><div class=\"highlight\"><pre><code class=\"language-text\">&#39;&#39;&#39;\nKalman filter example demo in Python\n\n&#39;&#39;&#39;\n\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n\nplt.rcParams[&#39;figure.figsize&#39;] = (10,8)\n\n#inital parameters\n\nn_iter = 100\nsz = (n_iter,)\nx = 23.5    #真实温度\nz = np.random.normal(x,0.2,size=sz)  #测量值\n\n\n#allocate apace for arrays\nstate_kalman = np.zeros(sz)     # a posteri estimate of x 估计值\nstate_pre = np.zeros(sz)     # a priori estimate of x     预测值\nP = np.zeros(sz)             # a posteri error estimate  \nPminus = np.zeros(sz)        # a priori error estimate   系统误差\nK = np.zeros(sz)             # gain or blending factor\n\n\n\nR = 0.2**2                   #温度测量时的方差\nQ = 4e-4                     #温度预测时的的方差\n\nstate_kalman[0] = 25    # 温度初始值\nP[0] = 1.0               # 温度初始估计方差\n\n\nfor\tk in range(1,n_iter):\n\t#time update\n\tstate_pre[k] = state_kalman[k-1]    #根据上一个卡尔曼估计值，直接预测，就是原来的值保持不变\n\tPminus[k] = P[k-1] + Q              # 存在预测误差\n\n\t\n\tK[k] = Pminus[k]/(Pminus[k] + R)  # kalman 增益\t\n\tstate_kalman[k] = state_pre[k] + K[k]*(z[k] - state_pre[k])\t  #估计值（权重不一样）\n\tP[k] = (1-K[k])*Pminus[k]\n\t\n\nplt.figure()\nplt.plot(z,&#39;k+&#39;,label = &#39;noisy measurements&#39;)\nplt.plot(state_kalman,&#39;b-&#39;,label = &#39;a posteri estimate&#39;)\nplt.axhline(x,color = &#39;g&#39;,label = &#39;true value&#39;)\n\nplt.legend()\nplt.title(&#39;Estimate vs. iteration step&#39;,fontweight = &#39;bold&#39;)\nplt.xlabel(&#39;Iteration&#39;)\nplt.ylabel(&#39;Voltage&#39;)\n\n\n\nplt.figure()\nvalid_iter = range(1,n_iter)\nplt.plot(valid_iter,Pminus[valid_iter],label = &#39;a priori erroe estimate&#39;)\n\nplt.title(&#39;Estimate $\\it{\\mathbf{a \\ priori}}$ error vs. iteration step&#39;,fontweight = &#39;bold&#39;)\n\nplt.xlabel(&#39;Iteration&#39;)\nplt.ylabel(&#39;$(Voltage)^2$&#39;)\n\nplt.setp(plt.gca(),&#39;ylim&#39;,[0,.05])\nplt.show()\n```</code></pre></div><p>参考书籍：秦永元, 张洪钺, 汪叔华. 《卡尔曼滤波与组合导航原理》. 西北工业大学出版社, 2015.</p><p></p><p></p><p></p>", 
            "topic": [
                {
                    "tag": "大数据", 
                    "tagLink": "https://api.zhihu.com/topics/19740929"
                }, 
                {
                    "tag": "数据分析", 
                    "tagLink": "https://api.zhihu.com/topics/19559424"
                }, 
                {
                    "tag": "数据", 
                    "tagLink": "https://api.zhihu.com/topics/19554449"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/41962512", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 2, 
            "title": "从恒温控制里学PID", 
            "content": "<h2>概述</h2><p>用PID来实现恒温，最简单的PID控制之一，也是最能直观感受PID具体含义的例子之一。</p><p>所谓恒温控制，就是温度高了，让它低一点，低了让它高一点，始终保持目标温度恒定的控制。这在各种恒温设备里有广泛的应用，比如电饭煲，热水器，空调...等等。</p><p>本文则是通过实现简单的恒温控制，来初步学习PID控制。</p><h2>PID基本概念及特点</h2><p>PID控制器，就是在过程控制中，按偏差的比例（P）、积分（I）和微分（D）进行控制，是应用最为广泛的一种自动控制器。在这里，可以简单称为比例器，积分器和微分器，它们最终都要告诉cpu怎么去输出控制量。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-bbfb1cdd39768e4466f6c910926cd6b4_b.jpg\" data-size=\"normal\" data-rawwidth=\"552\" data-rawheight=\"218\" class=\"origin_image zh-lightbox-thumb\" width=\"552\" data-original=\"https://pic1.zhimg.com/v2-bbfb1cdd39768e4466f6c910926cd6b4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;552&#39; height=&#39;218&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"552\" data-rawheight=\"218\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"552\" data-original=\"https://pic1.zhimg.com/v2-bbfb1cdd39768e4466f6c910926cd6b4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-bbfb1cdd39768e4466f6c910926cd6b4_b.jpg\"/><figcaption>最基本的PID控制框图</figcaption></figure><p>基本公式：<img src=\"https://www.zhihu.com/equation?tex=G%28s%29+%3D+K_%7Bp%7D++%2B+%5Cfrac%7BK_%7BI%7D%7D%7BS%7D+%2B+K_%7BD%7DS+%3D+%5Cfrac%7BK_%7BD%7DS%5E%7B2%7D+%2B+K_%7BP%7DS+%2B+K_%7BI%7D%7D%7BS%7D\" alt=\"G(s) = K_{p}  + \\frac{K_{I}}{S} + K_{D}S = \\frac{K_{D}S^{2} + K_{P}S + K_{I}}{S}\" eeimg=\"1\"/> </p><p>控制器输入：目标信号和观测信号的偏差</p><p>控制器输出：驱动受控系统的控制量</p><p>所以PID是闭环控制算法，要实现PID算法，必须在硬件上具有闭环控制，这就得有反馈。比如控制一个温度，就得有一个测量温度的传感器，并将结果反馈到控制路线上，实现温度的控制。</p><p>它具有原理简单，易于实现，适用面广。虽然对于PID控制器，P、I、D的作用是互相补充、互相耦合的，但是好在各个参数对于控制器性能的影响程度有强有弱，所以控制参数相对独立，参数的选定比较简单等优点；而且在理论上可以证明，对于过程控制的典型对象──“一阶滞后+纯滞后”与“二阶滞后+纯滞后”的控制对象，PID控制器是一种最优控制。PID调节规律是连续系统动态品质校正的一种有效方法，它的参数整定方式简便，结构改变灵活（PI、PD、…）。</p><h2>温度控制</h2><p>温度控制框图如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b95705a89cf5b1db1e78b0cc1977e999_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1143\" data-rawheight=\"281\" class=\"origin_image zh-lightbox-thumb\" width=\"1143\" data-original=\"https://pic2.zhimg.com/v2-b95705a89cf5b1db1e78b0cc1977e999_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1143&#39; height=&#39;281&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1143\" data-rawheight=\"281\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1143\" data-original=\"https://pic2.zhimg.com/v2-b95705a89cf5b1db1e78b0cc1977e999_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-b95705a89cf5b1db1e78b0cc1977e999_b.jpg\"/></figure><p>可以说是最简单的PID控制模型。</p><p>一般而言，PID温度控制器的误差响应曲线如下所示：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-9e7d39ac22adf4b38bedfc4963065a7d_b.jpg\" data-size=\"normal\" data-rawwidth=\"697\" data-rawheight=\"349\" class=\"origin_image zh-lightbox-thumb\" width=\"697\" data-original=\"https://pic2.zhimg.com/v2-9e7d39ac22adf4b38bedfc4963065a7d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;697&#39; height=&#39;349&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"697\" data-rawheight=\"349\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"697\" data-original=\"https://pic2.zhimg.com/v2-9e7d39ac22adf4b38bedfc4963065a7d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-9e7d39ac22adf4b38bedfc4963065a7d_b.jpg\"/><figcaption>误差响应曲线</figcaption></figure><p>可以从该时域信号曲线看出，此温度控制分为两个阶段，第一阶段在温度远小于目标温度时不采用PID控制，即是PID调节前阶段，第二阶段开始用PID控制。</p><p>从中也提取一些表征PID控制性能的关键参数：</p><ol><li>上升时间 Rise Time<br/>误差第一次缩减到零所需时间，如图t1</li><li>过调量 Overshoot<br/>误差第一次过零点后，达到的峰值高度t2时</li><li>稳定时间 Settling Time<br/>当之后的误差绝对值在δ以内，说明系统达到稳态，第一次达到稳态所需的时间，如图t3</li><li>稳态误差 Steady-State Error<br/>系统稳态时与零偏移</li><li>动态偏差 Stability<br/>系统稳态时，误差的统计值IAE=sum(|error|)</li></ol><p>而P、I、D对于上述关键参数的影响如下：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1235c69960d8d4aeebf2c0bafd5ac5c8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"206\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-1235c69960d8d4aeebf2c0bafd5ac5c8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;206&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"206\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-1235c69960d8d4aeebf2c0bafd5ac5c8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-1235c69960d8d4aeebf2c0bafd5ac5c8_b.jpg\"/></figure><p>可以看到：</p><p>1、PID三个参数对于系统的影响是相互耦合的，没有哪个性能只受一个参数的影响；</p><p>2、PID三个参数的影响各有侧重点</p><p>总结如下：</p><p>a) Kp用于缩短系统上升时间；</p><p>b) Ki用于消除稳态误差；</p><p>c) Kd用于降低过冲和动态偏差；</p><h2>温度控制实现</h2><p>第一步，让PID离散化：</p><p><img src=\"https://www.zhihu.com/equation?tex=M_%7Bn%7D+%3D+K_%7Bp%7De_n+%2B+K_%7BI%7D%5Csum_%7B1%7D%5E%7Bn%7D%7Be%7D+%2B+K_%7BD%7D%28e_n+-+e_%7Bn-1%7D%29\" alt=\"M_{n} = K_{p}e_n + K_{I}\\sum_{1}^{n}{e} + K_{D}(e_n - e_{n-1})\" eeimg=\"1\"/> </p><p>其中 <img src=\"https://www.zhihu.com/equation?tex=e_%7Bn%7D\" alt=\"e_{n}\" eeimg=\"1\"/> 就是是输入的误差量，因此，上式可以改写成如下形式：</p><p><img src=\"https://www.zhihu.com/equation?tex=M_%7Bn%7D+%3D+K_%7BP%7D+%2A+%28SV+-+PV_%7Bn%7D%29++%2B+%28K_%7BI%7D%28SV-PV_%7Bn%7D%29%2BMX%29+%2B+K_%7BD%7D%28PV_%7Bn-1%7D+-+PV_%7Bn%7D%29\" alt=\"M_{n} = K_{P} * (SV - PV_{n})  + (K_{I}(SV-PV_{n})+MX) + K_{D}(PV_{n-1} - PV_{n})\" eeimg=\"1\"/> </p><p>其中</p><p><img src=\"https://www.zhihu.com/equation?tex=M_%7Bn%7D+%E5%9C%A8n%E6%97%B6%E5%88%BB%E9%87%87%E6%A0%B7%EF%BC%8CPID%E5%9B%9E%E8%B7%AF%E7%9A%84%E8%BE%93%E5%87%BA%E8%AE%A1%E7%AE%97%E5%80%BC\" alt=\"M_{n} 在n时刻采样，PID回路的输出计算值\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=SV+%E6%98%AFPID+%E5%9B%9E%E8%B7%AF%E8%AE%BE%E5%AE%9A%E5%80%BC+Set%7B+%7DValue\" alt=\"SV 是PID 回路设定值 Set{ }Value\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=PV_%7Bn%7D+%E6%98%AF%E7%AC%ACn%E9%87%87%E6%A0%B7%E6%97%B6%E5%88%BB%E8%BF%87%E7%A8%8B%E5%8F%98%E9%87%8F%E5%80%BC\" alt=\"PV_{n} 是第n采样时刻过程变量值\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=PV_%7Bn-1%7D%E7%AC%ACn-1%E9%87%87%E6%A0%B7%E6%97%B6%E5%88%BB%E8%BF%87%E7%A8%8B%E5%8F%98%E9%87%8F%E5%80%BC\" alt=\"PV_{n-1}第n-1采样时刻过程变量值\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=MX+%E6%98%AF%E7%A7%AF%E5%88%86%E5%89%8D%E9%A1%B9%E5%80%BC\" alt=\"MX 是积分前项值\" eeimg=\"1\"/> </p><p>这样我们很容易理解PID参数的各自含义。</p><p>P是比例，P越大，响应越快。</p><p>I是积分，每一次采样都会记录误差量，可以理解成快慢。</p><p>D是微分，关心的是变化率，要不要打提前量。</p><p>实现简码如下：</p><div class=\"highlight\"><pre><code class=\"language-c\"><span class=\"kt\">float</span> <span class=\"n\">temp</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>                   <span class=\"c1\">//传感器温度,全局变量\n</span><span class=\"c1\"></span><span class=\"kt\">void</span> <span class=\"nf\">PidTempControl</span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n    <span class=\"kt\">float</span> <span class=\"n\">ee</span><span class=\"p\">;</span>\n    <span class=\"kt\">float</span> <span class=\"n\">TempSet</span> <span class=\"o\">=</span> <span class=\"mf\">45.0f</span><span class=\"p\">;</span>           <span class=\"c1\">//目标温度\n</span><span class=\"c1\"></span>\n    <span class=\"kt\">float</span> <span class=\"n\">PidE0</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>\n    <span class=\"kt\">float</span> <span class=\"n\">PidKp</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">,</span><span class=\"n\">PidKi</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">,</span><span class=\"n\">PidKd</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>\n    <span class=\"kt\">float</span> <span class=\"n\">PidOut</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>\n    <span class=\"kt\">float</span> <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">,</span><span class=\"n\">I_out</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>\n    <span class=\"k\">static</span> <span class=\"kt\">float</span> <span class=\"n\">PidE1</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>                \n\n    <span class=\"n\">PidKp</span> <span class=\"o\">=</span> <span class=\"mf\">15.0f</span><span class=\"p\">;</span>\n    <span class=\"n\">PidKi</span> <span class=\"o\">=</span> <span class=\"mf\">25.0f</span><span class=\"p\">;</span>\n    <span class=\"n\">PidKd</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>                         <span class=\"c1\">//初始化参数\n</span><span class=\"c1\"></span>  \n    <span class=\"n\">PidE0</span> <span class=\"o\">=</span> <span class=\"n\">TempSet</span> <span class=\"o\">-</span> <span class=\"n\">temp</span><span class=\"p\">;</span>       <span class=\"c1\">//本次偏差\n</span><span class=\"c1\"></span>    <span class=\"n\">ee</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">PidE0</span> <span class=\"o\">-</span> <span class=\"n\">PidE1</span><span class=\"p\">);</span>        <span class=\"c1\">//计算一阶偏差\n</span><span class=\"c1\"></span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">ee</span> <span class=\"o\">&gt;</span> <span class=\"mf\">2.0f</span><span class=\"p\">)</span> <span class=\"n\">ee</span> <span class=\"o\">=</span> <span class=\"mf\">2.0f</span><span class=\"p\">;</span>\n    <span class=\"k\">else</span> <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">ee</span> <span class=\"o\">&lt;</span> <span class=\"o\">-</span><span class=\"mf\">2.0f</span><span class=\"p\">)</span> <span class=\"n\">ee</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"mf\">2.0f</span><span class=\"p\">;</span>\n\n    <span class=\"n\">PidSum</span> <span class=\"o\">+=</span> <span class=\"n\">PidE0</span><span class=\"p\">;</span>                               <span class=\"c1\">//偏差之和\n</span><span class=\"c1\"></span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidSum</span> <span class=\"o\">&gt;</span> <span class=\"mf\">5.0f</span><span class=\"p\">)</span> <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"mf\">5.0f</span><span class=\"p\">;</span>\n    <span class=\"k\">else</span> <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidSum</span> <span class=\"o\">&lt;</span> <span class=\"o\">-</span><span class=\"mf\">3.0f</span><span class=\"p\">)</span> <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"mf\">3.0f</span><span class=\"p\">;</span>\n\n    <span class=\"n\">PidOut</span> <span class=\"o\">=</span> <span class=\"n\">PidKp</span> <span class=\"o\">*</span> <span class=\"n\">PidE0</span> <span class=\"o\">+</span> <span class=\"n\">PidKd</span> <span class=\"o\">*</span> <span class=\"n\">ee</span><span class=\"p\">;</span>       <span class=\"c1\">//计算PID的比例和微分输出\n</span><span class=\"c1\"></span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">fabs</span><span class=\"p\">(</span><span class=\"n\">PidE0</span><span class=\"p\">)</span> <span class=\"o\">&lt;</span> <span class=\"mf\">3.0f</span><span class=\"p\">)</span>                     <span class=\"c1\">//如果温度相差小于3度则计入PID积分输出\n</span><span class=\"c1\"></span>    <span class=\"p\">{</span>\n        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidSum</span> <span class=\"o\">&gt;</span> <span class=\"mf\">5.0f</span><span class=\"p\">)</span> <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"mf\">5.0f</span><span class=\"p\">;</span>\n        <span class=\"k\">else</span> <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidSum</span> <span class=\"o\">&lt;</span> <span class=\"o\">-</span><span class=\"mf\">2.0f</span><span class=\"p\">)</span> <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"o\">-</span><span class=\"mf\">2.0f</span><span class=\"p\">;</span>\n\n        <span class=\"n\">I_out</span> <span class=\"o\">=</span> <span class=\"n\">PidKi</span> <span class=\"o\">*</span> <span class=\"n\">PidSum</span><span class=\"p\">;</span>                      <span class=\"c1\">//积分输出\n</span><span class=\"c1\"></span>\n\n        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">fabs</span><span class=\"p\">(</span><span class=\"n\">PidE0</span><span class=\"p\">)</span> <span class=\"o\">&lt;</span> <span class=\"o\">-</span><span class=\"mf\">1.0f</span><span class=\"p\">)</span>                       <span class=\"c1\">//当前温度高于设定温度0.5度时，累计积分限制\n</span><span class=\"c1\"></span>        <span class=\"p\">{</span>\n            <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidSum</span> <span class=\"o\">&gt;</span> <span class=\"mf\">5.5f</span><span class=\"p\">)</span> <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"mf\">5.5f</span><span class=\"p\">;</span>\n            <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidSum</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">)</span>    <span class=\"n\">I_out</span>  <span class=\"o\">-=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>               <span class=\"c1\">//当前温度高于设定温度0.5度时,消弱积分正输出\n</span><span class=\"c1\"></span>        <span class=\"p\">}</span> \n\n        <span class=\"n\">PidOut</span> <span class=\"o\">+=</span> <span class=\"n\">I_out</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">else</span>\n    <span class=\"p\">{</span>\n        <span class=\"n\">PidSum</span> <span class=\"o\">=</span> <span class=\"mf\">0.0f</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">PidOut</span> <span class=\"o\">*=</span> <span class=\"mi\">500</span><span class=\"p\">;</span>                                                 <span class=\"c1\">//与控制量的比例系数\n</span><span class=\"c1\"></span>    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidOut</span> <span class=\"o\">&gt;</span> <span class=\"mi\">2500</span><span class=\"p\">)</span> <span class=\"n\">PidOut</span> <span class=\"o\">=</span> <span class=\"mi\">2500</span><span class=\"p\">;</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidOut</span> <span class=\"o\">&lt;</span> <span class=\"mi\">0</span><span class=\"p\">)</span>    <span class=\"n\">PidOut</span> <span class=\"o\">=</span> <span class=\"mi\">400</span><span class=\"p\">;</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidE0</span> <span class=\"o\">&gt;</span> <span class=\"mf\">5.0f</span><span class=\"p\">)</span> <span class=\"n\">PidOut</span> <span class=\"o\">=</span> <span class=\"mi\">2500</span><span class=\"p\">;</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">PidE0</span> <span class=\"o\">&lt;</span> <span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"n\">PidOut</span> <span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span>\n\n    <span class=\"n\">HeaterSet</span><span class=\"p\">(</span><span class=\"n\">PidOut</span><span class=\"p\">);</span>                              <span class=\"c1\">//输出控制量\n</span><span class=\"c1\"></span>    <span class=\"n\">PidE1</span> <span class=\"o\">=</span> <span class=\"n\">PidE0</span><span class=\"p\">;</span>   \n<span class=\"p\">}</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p>参考文献：</p><p>【1】<a href=\"https://link.zhihu.com/?target=https%3A//www.baidu.com/link%3Furl%3DfabtQKkPx7wUHtAqC0ySOIOvGolOVMk8HJwRcobAW544u8ROmiKJ8h95o_AXx69OILc3XCWy_7HbNzGLNLwmC_%26wd%3D%26eqid%3Da58635cd000263cf000000025b979207\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">pid control system analysis design and technology</a></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>", 
            "topic": [
                {
                    "tag": "控制算法", 
                    "tagLink": "https://api.zhihu.com/topics/19685125"
                }, 
                {
                    "tag": "控制系统", 
                    "tagLink": "https://api.zhihu.com/topics/19589887"
                }, 
                {
                    "tag": "PID Controller PID控制", 
                    "tagLink": "https://api.zhihu.com/topics/20032309"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/50738318", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 2, 
            "title": "数据融合——高斯分布的特性", 
            "content": "<h2>高斯分布的概念：</h2><p>高斯分布（Gaussian distribution），又名正态分布（Normal distribution），也称“常态分布”，最早是由A.棣莫弗在求二项分布的渐近公式中得到。</p><p>C.F.高斯在研究测量误差时从另一个角度导出了它。P.S.拉普拉斯和高斯研究了它的性质。它是一个在数学、物理及工程等领域都非常重要的概率分布，在统计学的许多方面有着重大的影响力。</p><p>若随机变量X服从一个数学期望为 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu\" alt=\"\\mu\" eeimg=\"1\"/> 、方差为 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma%5E%7B2%7D\" alt=\"\\sigma^{2}\" eeimg=\"1\"/> 的正态分布，记为 <img src=\"https://www.zhihu.com/equation?tex=N%28%5Cmu%2C+%5Csigma%5E2%29\" alt=\"N(\\mu, \\sigma^2)\" eeimg=\"1\"/> 。其概率密度函数为正态分布的期望值 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu\" alt=\"\\mu\" eeimg=\"1\"/> 决定了其位置，其标准差 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma%5E2\" alt=\"\\sigma^2\" eeimg=\"1\"/> 决定了分布的幅度。当 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu%3D0%2C+%5Csigma%3D1\" alt=\"\\mu=0, \\sigma=1\" eeimg=\"1\"/> 时的正态分布是标准正态分布。</p><p>正态曲线呈钟型，两头低，中间高，左右对称因其曲线呈钟形，因此人们又经常称之为钟形曲线。</p><figure data-size=\"small\"><noscript><img src=\"https://pic1.zhimg.com/v2-ceed0c31ad0d550b53230d2a429420a0_b.jpg\" data-size=\"small\" data-rawwidth=\"883\" data-rawheight=\"658\" class=\"origin_image zh-lightbox-thumb\" width=\"883\" data-original=\"https://pic1.zhimg.com/v2-ceed0c31ad0d550b53230d2a429420a0_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;883&#39; height=&#39;658&#39;&gt;&lt;/svg&gt;\" data-size=\"small\" data-rawwidth=\"883\" data-rawheight=\"658\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"883\" data-original=\"https://pic1.zhimg.com/v2-ceed0c31ad0d550b53230d2a429420a0_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-ceed0c31ad0d550b53230d2a429420a0_b.jpg\"/><figcaption>高斯分布，均值和方差的关系</figcaption></figure><p>如果一个随机变量x服从高斯分布 <img src=\"https://www.zhihu.com/equation?tex=N%28%5Cmu_%2C+%5Csigma%29\" alt=\"N(\\mu_, \\sigma)\" eeimg=\"1\"/> ,那么他的概率密度函数为：</p><p><img src=\"https://www.zhihu.com/equation?tex=p%28x%29+%3D+%5Cfrac+%7B1%7D+%7B%5Csqrt%7B2%5Cpi+%7D%5Csigma%7De%5E%7B%5Cfrac%7B-%28x-%5Cmu%29%5E%7B2%7D%7D%7B2%5Csigma%5E%7B2%7D%7D%7D\" alt=\"p(x) = \\frac {1} {\\sqrt{2\\pi }\\sigma}e^{\\frac{-(x-\\mu)^{2}}{2\\sigma^{2}}}\" eeimg=\"1\"/> </p><p>其高维形式为：</p><p><img src=\"https://www.zhihu.com/equation?tex=p%28x%29+%3D+%5Cfrac+%7B1%7D+%7B%5Csqrt%7B%EF%BC%882%5Cpi%EF%BC%89%5E%7BN%7Ddet%28%5CSigma%29%7D%7Dexp%28-%5Cfrac%7B1%7D%7B2%7D%28x-%5Cmu%29%5ET%5CSigma%5E%7B-1%7D%28x-%5Cmu%29%29\" alt=\"p(x) = \\frac {1} {\\sqrt{（2\\pi）^{N}det(\\Sigma)}}exp(-\\frac{1}{2}(x-\\mu)^T\\Sigma^{-1}(x-\\mu))\" eeimg=\"1\"/> </p><p class=\"ztext-empty-paragraph\"><br/></p><h2>高斯分布的运算：</h2><p>线性：</p><p><img src=\"https://www.zhihu.com/equation?tex=x+%5Csim+N%28%5Cmu_%7Bx%7D%2C%5CSigma_%7Bxx%7D%29%2Cy%5Csim+N%28%5Cmu_%7By%7D%2C%5CSigma_%7Byy%7D%29%2C\" alt=\"x \\sim N(\\mu_{x},\\Sigma_{xx}),y\\sim N(\\mu_{y},\\Sigma_{yy}),\" eeimg=\"1\"/> </p><p>那么他们的和仍是高斯分布：</p><p><img src=\"https://www.zhihu.com/equation?tex=x+%2B+y+%5Csim+N%28%5Cmu_%7Bx%7D%2B%5Cmu_%7By%7D%2C%5CSigma_%7Bxx%7D+%2B+%5CSigma_%7Byy%7D%29.\" alt=\"x + y \\sim N(\\mu_{x}+\\mu_{y},\\Sigma_{xx} + \\Sigma_{yy}).\" eeimg=\"1\"/> </p><p>乘积：</p><p>设两个高斯分布的乘积满足 <img src=\"https://www.zhihu.com/equation?tex=p%28xy%29%3DN%28%5Cmu%2C%5CSigma%29%2C\" alt=\"p(xy)=N(\\mu,\\Sigma),\" eeimg=\"1\"/> 那么：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5CSigma%5E%7B-1%7D%3D%5CSigma_%7Bxx%7D%5E%7B-1%7D%2B%5CSigma_%7Byy%7D%5E%7B-1%7D\" alt=\"\\Sigma^{-1}=\\Sigma_{xx}^{-1}+\\Sigma_{yy}^{-1}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5CSigma+%5E%7B-1%7D%5Cmu+%3D+%5CSigma_%7Bxx%7D+%5E%7B-1%7D%5Cmu_%7Bx%7D+%2B+%5CSigma+_%7Byy%7D%5E%7B-1%7D%5Cmu_%7Bx%7D\" alt=\"\\Sigma ^{-1}\\mu = \\Sigma_{xx} ^{-1}\\mu_{x} + \\Sigma _{yy}^{-1}\\mu_{x}\" eeimg=\"1\"/> </p><p>复合运算</p><p>同样考虑 <img src=\"https://www.zhihu.com/equation?tex=x\" alt=\"x\" eeimg=\"1\"/> 和 <img src=\"https://www.zhihu.com/equation?tex=y\" alt=\"y\" eeimg=\"1\"/> ,若其不独立,则其复合分布为:</p><p><img src=\"https://www.zhihu.com/equation?tex=p%28x%2Cy%29%3DN%28%5Cbegin%7Bbmatrix%7D%5Cmu_%7Bx%7D%5C%5C%5Cmu_%7By%7D+%5Cend+%7Bbmatrix%7D%2C%5Cbegin%7Bbmatrix%7D%5CSigma_%7Bxx%7D+%5C+%5C+%5CSigma_%7Byy%7D%5C%5C%5CSigma_%7Byx%7D+%5C+%5C+%5CSigma_%7Byy%7D+%5Cend+%7Bbmatrix%7D%29\" alt=\"p(x,y)=N(\\begin{bmatrix}\\mu_{x}\\\\\\mu_{y} \\end {bmatrix},\\begin{bmatrix}\\Sigma_{xx} \\ \\ \\Sigma_{yy}\\\\\\Sigma_{yx} \\ \\ \\Sigma_{yy} \\end {bmatrix})\" eeimg=\"1\"/> </p><p>由条件分布展开式: <img src=\"https://www.zhihu.com/equation?tex=p%28x%2Cy%29%3Dp%28x%7Cy%29p%28y%29\" alt=\"p(x,y)=p(x|y)p(y)\" eeimg=\"1\"/> 可以推出</p><p><img src=\"https://www.zhihu.com/equation?tex=p%28x%7Cy%29%3DN%28%5Cmu_%7Bx%7D%2B%5CSigma_%7Bxy%7D%5CSigma_%7Byy%7D%5E%7B-1%7D%28y-%5Cmu_%7By%7D%29%2C%5CSigma_%7Bxx%7D-%5CSigma_%7Bxy%7D%5CSigma_%7Byy%7D%5E%7B-1%7D%5CSigma_%7Byx%7D%29\" alt=\"p(x|y)=N(\\mu_{x}+\\Sigma_{xy}\\Sigma_{yy}^{-1}(y-\\mu_{y}),\\Sigma_{xx}-\\Sigma_{xy}\\Sigma_{yy}^{-1}\\Sigma_{yx})\" eeimg=\"1\"/> </p><p>例子:</p><p>考虑随机变量 <img src=\"https://www.zhihu.com/equation?tex=x%5Csim+N%28%5Cmu_%7Bx%7D%2C%5CSigma_%7Bxx%7D%29+\" alt=\"x\\sim N(\\mu_{x},\\Sigma_{xx}) \" eeimg=\"1\"/> ,另一变量满足 <img src=\"https://www.zhihu.com/equation?tex=y%3DAx%2Bb%2Bw\" alt=\"y=Ax+b+w\" eeimg=\"1\"/> </p><p>其中A,b为线性变量的系数矩阵和偏移量,w为噪声,为均值为0的高斯分布: <img src=\"https://www.zhihu.com/equation?tex=w%5Csim+N%280%2CR%29\" alt=\"w\\sim N(0,R)\" eeimg=\"1\"/> </p><p>则y的分布为:</p><p><img src=\"https://www.zhihu.com/equation?tex=p%28y%29+%3D+N%28A%5Cmu_%7Bx%7D%2Bb%2CR%2BA%5CSigma_%7Bxx%7DA%5E%7BT%7D%29\" alt=\"p(y) = N(A\\mu_{x}+b,R+A\\Sigma_{xx}A^{T})\" eeimg=\"1\"/> </p><h2>两个高斯分布相乘仍为高斯分布的推导：</h2><p>假设 <img src=\"https://www.zhihu.com/equation?tex=f%28x%29\" alt=\"f(x)\" eeimg=\"1\"/> ~ <img src=\"https://www.zhihu.com/equation?tex=N%28%5Cmu_%7Bf%7D%2C+%5Csigma_%7Bf%7D+%5E%7B2%7D%29\" alt=\"N(\\mu_{f}, \\sigma_{f} ^{2})\" eeimg=\"1\"/> ， <img src=\"https://www.zhihu.com/equation?tex=g%28x%29\" alt=\"g(x)\" eeimg=\"1\"/> ~ <img src=\"https://www.zhihu.com/equation?tex=N%28%5Cmu_%7Bg%7D%2C+%5Csigma_%7Bg%7D+%5E%7B2%7D%29\" alt=\"N(\\mu_{g}, \\sigma_{g} ^{2})\" eeimg=\"1\"/> 都是高斯</p><p>即 <img src=\"https://www.zhihu.com/equation?tex=f%28x%29\" alt=\"f(x)\" eeimg=\"1\"/> 和 <img src=\"https://www.zhihu.com/equation?tex=g%28x%29\" alt=\"g(x)\" eeimg=\"1\"/>分别满足： </p><p><img src=\"https://www.zhihu.com/equation?tex=f%28x%29+%3D+%5Cfrac+%7B1%7D+%7B%5Csqrt%7B2%5Cpi+%7D%5Csigma_%7Bf%7D%7De%5E%7B%5Cfrac%7B-%28x-%5Cmu_%7Bf%7D%29%5E%7B2%7D%7D%7B2%5Csigma_%7Bf%7D%5E%7B2%7D%7D%7D\" alt=\"f(x) = \\frac {1} {\\sqrt{2\\pi }\\sigma_{f}}e^{\\frac{-(x-\\mu_{f})^{2}}{2\\sigma_{f}^{2}}}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=g%28x%29+%3D+%5Cfrac+%7B1%7D+%7B%5Csqrt%7B2%5Cpi+%7D%5Csigma_%7Bg%7D%7De%5E%7B%5Cfrac%7B-%28x-%5Cmu_%7Bg%7D%29%5E%7B2%7D%7D%7B2%5Csigma_%7Bg%7D%5E%7B2%7D%7D%7D\" alt=\"g(x) = \\frac {1} {\\sqrt{2\\pi }\\sigma_{g}}e^{\\frac{-(x-\\mu_{g})^{2}}{2\\sigma_{g}^{2}}}\" eeimg=\"1\"/> </p><p>他们的乘积是：</p><p><img src=\"https://www.zhihu.com/equation?tex=h%28x%29+%3D+f%28x%29g%28x%29%3D%5Cfrac+%7B1%7D+%7B%7B2%5Cpi+%5Csigma_%7Bf%7D%5Csigma%7Bg%7D%7D%7De%5E%7B-%28%5Cfrac%7B%28x-%5Cmu_%7Bf%7D%29%5E%7B2%7D%7D++%7B2%5Csigma_%7Bf%7D%5E%7B2%7D%7D+%2B+%5Cfrac%7B%28x-%5Cmu_%7Bg%7D%29%5E%7B2%7D%7D++%7B2%5Csigma_%7Bg%7D%5E%7B2%7D%7D+%29%7D+%281%29\" alt=\"h(x) = f(x)g(x)=\\frac {1} {{2\\pi \\sigma_{f}\\sigma{g}}}e^{-(\\frac{(x-\\mu_{f})^{2}}  {2\\sigma_{f}^{2}} + \\frac{(x-\\mu_{g})^{2}}  {2\\sigma_{g}^{2}} )} (1)\" eeimg=\"1\"/> </p><p class=\"ztext-empty-paragraph\"><br/></p><p>现在，我们对其做进一步化简，以期得到 <img src=\"https://www.zhihu.com/equation?tex=h%28x%29+\" alt=\"h(x) \" eeimg=\"1\"/> 的分布函数.</p><p>公式(1)的指数部分为：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbeta+%3D+%5Cfrac%7B%28x-%5Cmu_%7Bf%7D%29%5E2%7D%7B2%5Csigma_%7Bf%7D%5E%7B2%7D%7D+%2B+%5Cfrac%7B%28x-%5Cmu_%7Bg%7D%29%5E2%7D%7B2%5Csigma_%7Bg%7D%5E%7B2%7D%7D\" alt=\"\\beta = \\frac{(x-\\mu_{f})^2}{2\\sigma_{f}^{2}} + \\frac{(x-\\mu_{g})^2}{2\\sigma_{g}^{2}}\" eeimg=\"1\"/> </p><p>以x的幂项展开这两个二次方程得：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbeta+%3D+%5Cfrac%7B%28%5Csigma_%7Bf%7D%5E%7B2%7D+%2B+%5Csigma_%7Bg%7D%5E%7B2%7D%29x%5E2+-+2%28%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E%7B2%7D%29%2B%5Cmu_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5E2%5Csigma_%7Bf%7D%5E2%7D%7B2%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D\" alt=\"\\beta = \\frac{(\\sigma_{f}^{2} + \\sigma_{g}^{2})x^2 - 2(\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^{2})+\\mu_{f}^2\\sigma_{g}^2+\\mu_{g}^2\\sigma_{f}^2}{2\\sigma_{f}^2\\sigma_{g}^2}\" eeimg=\"1\"/> </p><p>考虑到标准正态分布方程可以写成如下形式：</p><p><img src=\"https://www.zhihu.com/equation?tex=P%28x%29+%3D+%5Cfrac+%7B1%7D+%7B%5Csqrt%7B2%5Cpi+%7D%5Csigma%7De%5E%7B%5Cfrac%7B-%28x-%5Cmu%29%5E%7B2%7D%7D%7B2%5Csigma%5E%7B2%7D%7D%7D%3D%5Cfrac+%7B1%7D+%7B%5Csqrt%7B2%5Cpi+%7D%5Csigma%7De%5E%7B-%5Cfrac%7B%28x%5E2-2%5Cmu+x%2B%5Cmu%5E2%29%7D%7B2%5Csigma%5E%7B2%7D%7D%7D\" alt=\"P(x) = \\frac {1} {\\sqrt{2\\pi }\\sigma}e^{\\frac{-(x-\\mu)^{2}}{2\\sigma^{2}}}=\\frac {1} {\\sqrt{2\\pi }\\sigma}e^{-\\frac{(x^2-2\\mu x+\\mu^2)}{2\\sigma^{2}}}\" eeimg=\"1\"/> </p><p>对比上式，我们将 <img src=\"https://www.zhihu.com/equation?tex=%5Cbeta\" alt=\"\\beta\" eeimg=\"1\"/> 作适当变形：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbeta%3D%5Cfrac%7Bx%5E2-2x%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%2B%28%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%29%5E2%7D%7B%5Cfrac%7B2%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%7B%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D%7D%2B%5Cfrac%7B%5Cfrac%7B%5Cmu_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5E2%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D-%28%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%29%5E2%7D%7B%5Cfrac%7B2%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%7B%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D%7D\" alt=\"\\beta=\\frac{x^2-2x\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2}+(\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2})^2}{\\frac{2\\sigma_{f}^2\\sigma_{g}^2}{(\\sigma_{f}^2+\\sigma_{g}^2)}}+\\frac{\\frac{\\mu_{f}^2\\sigma_{g}^2+\\mu_{g}^2\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2}-(\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2})^2}{\\frac{2\\sigma_{f}^2\\sigma_{g}^2}{(\\sigma_{f}^2+\\sigma_{g}^2)}}\" eeimg=\"1\"/> </p><p>化简可得：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbeta%3D%5Cfrac%7B%28x-%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%29%5E2%7D%7B2%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%7D+%2B%5Cfrac%7B%28%5Cmu_%7Bf%7D-%5Cmu_%7Bg%7D%29%5E2%7D%7B2%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D\" alt=\"\\beta=\\frac{(x-\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2})^2}{2\\frac{\\sigma_{f}^2\\sigma_{g}^2}{\\sigma_{f}^2+\\sigma_{g}^2}} +\\frac{(\\mu_{f}-\\mu_{g})^2}{2(\\sigma_{f}^2+\\sigma_{g}^2)}\" eeimg=\"1\"/> </p><p>令</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%3D%5Csqrt%7B%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%7D\" alt=\"\\sigma_{fg}=\\sqrt{\\frac{\\sigma_{f}^2\\sigma_{g}^2}{\\sigma_{f}^2+\\sigma_{g}^2}}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D%3D%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D\" alt=\"\\mu_{fg}=\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2}\" eeimg=\"1\"/> </p><p>化简可得：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cbeta%3D%5Cfrac%7B%28x-%5Cmu_%7Bfg%7D%29%5E2%7D%7B2%5Csigma_%7Bfg%7D%7D+%2B%5Cfrac%7B%28%5Cmu_%7Bf%7D-%5Cmu_%7Bg%7D%29%5E2%7D%7B2%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D\" alt=\"\\beta=\\frac{(x-\\mu_{fg})^2}{2\\sigma_{fg}} +\\frac{(\\mu_{f}-\\mu_{g})^2}{2(\\sigma_{f}^2+\\sigma_{g}^2)}\" eeimg=\"1\"/> </p><p>将 <img src=\"https://www.zhihu.com/equation?tex=%5Cbeta\" alt=\"\\beta\" eeimg=\"1\"/> 代回公式（1）：</p><p><img src=\"https://www.zhihu.com/equation?tex=h%28x%29+%3D+f%28x%29g%28x%29%3D%5Cfrac%7B1%7D%7B2%5Cpi%5Csigma_%7Bf%7D%5Csigma_%7Bg%7D%7Dexp%5B-%5Cfrac%7B%28x-%5Cmu_%7Bfg%7D%29%5E2%7D%7B2%5Csigma_%7Bfg%7D%5E2%7D%5Dexp%5B-%5Cfrac%7B%28%5Cmu_%7Bf%7D-%5Cmu_%7Bg%7D%29%5E2%7D%7B2%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D%5D\" alt=\"h(x) = f(x)g(x)=\\frac{1}{2\\pi\\sigma_{f}\\sigma_{g}}exp[-\\frac{(x-\\mu_{fg})^2}{2\\sigma_{fg}^2}]exp[-\\frac{(\\mu_{f}-\\mu_{g})^2}{2(\\sigma_{f}^2+\\sigma_{g}^2)}]\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%3D%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%7D%5Csigma_%7Bfg%7D%7Dexp%5B-%5Cfrac%7B%28x-%5Cmu_%7Bfg%7D%29%5E2%7D%7B2%5Csigma_%7Bfg%7D%5E2%7D%5D%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D%7Dexp%5B-%5Cfrac%7B%28%5Cmu_%7Bf%7D-%5Cmu_%7Bg%7D%29%5E2%7D%7B2%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bf%7D%5E2%29%7D%5D\" alt=\"=\\frac{1}{\\sqrt{2\\pi}\\sigma_{fg}}exp[-\\frac{(x-\\mu_{fg})^2}{2\\sigma_{fg}^2}]\\frac{1}{\\sqrt{2\\pi(\\sigma_{f}^2+\\sigma_{g}^2)}}exp[-\\frac{(\\mu_{f}-\\mu_{g})^2}{2(\\sigma_{f}^2+\\sigma_{f}^2)}]\" eeimg=\"1\"/> </p><p>所以 <img src=\"https://www.zhihu.com/equation?tex=h%28x%29\" alt=\"h(x)\" eeimg=\"1\"/> 也是一个高斯分布函数：</p><p><img src=\"https://www.zhihu.com/equation?tex=h%28x%29+%3D+%5Cfrac%7BS_%7Bfg%7D%7D%7B%5Csqrt%7B2%5Cpi%7D%5Csigma_%7Bfg%7D%7Dexp%5B-%5Cfrac%7B%28x-%5Cmu_%7Bfg%7D%29%5E2%7D%7B2%5Csigma_%7Bfg%7D%5E2%7D%5D\" alt=\"h(x) = \\frac{S_{fg}}{\\sqrt{2\\pi}\\sigma_{fg}}exp[-\\frac{(x-\\mu_{fg})^2}{2\\sigma_{fg}^2}]\" eeimg=\"1\"/> </p><p>其中 <img src=\"https://www.zhihu.com/equation?tex=S_%7Bfg%7D+%3D+%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%29%7D%7Dexp%5B-%5Cfrac%7B%28%5Cmu_%7Bf%7D-%5Cmu_%7Bg%7D%29%5E2%7D%7B2%28%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bf%7D%5E2%29%7D%5D\" alt=\"S_{fg} = \\frac{1}{\\sqrt{2\\pi(\\sigma_{f}^2+\\sigma_{g}^2)}}exp[-\\frac{(\\mu_{f}-\\mu_{g})^2}{2(\\sigma_{f}^2+\\sigma_{f}^2)}]\" eeimg=\"1\"/> </p><p>所以 <img src=\"https://www.zhihu.com/equation?tex=h%28x%29\" alt=\"h(x)\" eeimg=\"1\"/> 是符合均值为 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D\" alt=\"\\mu_{fg}\" eeimg=\"1\"/> 方差为 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E2\" alt=\"\\sigma_{fg}^2\" eeimg=\"1\"/> 的高斯分布 <img src=\"https://www.zhihu.com/equation?tex=N%28%5Cmu_%7Bfg%7D%2C+%5Csigma_%7Bfg%7D+%5E%7B2%7D%29\" alt=\"N(\\mu_{fg}, \\sigma_{fg} ^{2})\" eeimg=\"1\"/> 。</p><p>上述过程中，我们得到了<b>两个高斯分布相乘仍是高斯分布</b>的结论，且通过公式化简，求出了乘后分布的均值 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D\" alt=\"\\mu_{fg}\" eeimg=\"1\"/> 和方差 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E2\" alt=\"\\sigma_{fg}^2\" eeimg=\"1\"/> 。</p><p>若我们知道高斯分布相乘后仍是高斯分布，则可以通过求导的方法得到乘后分布的均值和方差，这样相对简单。</p><p>主要原理如下：</p><blockquote>正态分布是一个抛物线，开口向下。均值处获得峰值；故令 <img src=\"https://www.zhihu.com/equation?tex=h%28x%29%E2%80%B2%3D0\" alt=\"h(x)′=0\" eeimg=\"1\"/> ,可以的获得均值 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D\" alt=\"\\mu_{fg}\" eeimg=\"1\"/> ；<br/>曲线的弯曲程度由曲率决定，曲率公式: <img src=\"https://www.zhihu.com/equation?tex=%5Ckappa%3D%5Cfrac%7By%27%27%7D%7B%281%2By%27%29%5E%7B3%2F2%7D%7D\" alt=\"\\kappa=\\frac{y&#39;&#39;}{(1+y&#39;)^{3/2}}\" eeimg=\"1\"/> ,对于高斯分布，在均值处曲率越大意味着，均值处的弯曲程度越厉害，而弯曲越厉害则数据相对集中，方差越小。所以均值处曲率刚好和二次导成正比，则和方差成反比，即求出二次导即可。</blockquote><p>通过以上分析：</p><p><img src=\"https://www.zhihu.com/equation?tex=h%28x%29%27%3DC%2Aexp%5EL%2AL%27\" alt=\"h(x)&#39;=C*exp^L*L&#39;\" eeimg=\"1\"/> </p><p>即： <img src=\"https://www.zhihu.com/equation?tex=%5Cfrac%7B%28x-%5Cmu_%7Bf%7D%29%7D%7B%5Csigma_%7Bf%7D%5E2%7D%2B%5Cfrac%7B%28x-%5Cmu_%7Bg%7D%29%7D%7B%5Csigma_%7Bg%7D%5E2%7D+%3D+0\" alt=\"\\frac{(x-\\mu_{f})}{\\sigma_{f}^2}+\\frac{(x-\\mu_{g})}{\\sigma_{g}^2} = 0\" eeimg=\"1\"/> 所以 <img src=\"https://www.zhihu.com/equation?tex=x%3D%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D\" alt=\"x=\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=h%28x%29%27%E2%80%99%3D%28C%2Aexp%5EL%29%27%2AL%27+%2B+C%2Aexp%5EL%2AL%27%27\" alt=\"h(x)&#39;’=(C*exp^L)&#39;*L&#39; + C*exp^L*L&#39;&#39;\" eeimg=\"1\"/> 在均值处前一项为0</p><p>所以： <img src=\"https://www.zhihu.com/equation?tex=h%28x%29%27%E2%80%99%3Dc%2AL%27%27%3Dc%2A%28%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%29\" alt=\"h(x)&#39;’=c*L&#39;&#39;=c*(\\frac{\\sigma_{f}^2+\\sigma_{g}^2}{\\sigma_{f}^2\\sigma_{g}^2})\" eeimg=\"1\"/> 则 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E%7B-2%7D+%3D+%28%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%29\" alt=\"\\sigma_{fg}^{-2} = (\\frac{\\sigma_{f}^2+\\sigma_{g}^2}{\\sigma_{f}^2\\sigma_{g}^2})\" eeimg=\"1\"/> </p><h2>高斯分布与数据融合</h2><p>当证明完两个高斯分布相乘仍旧是高斯分布时，我们可以联想到一张图：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-08e51dbd4fac17f50e610c6f1ecdac9c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"810\" data-rawheight=\"151\" class=\"origin_image zh-lightbox-thumb\" width=\"810\" data-original=\"https://pic1.zhimg.com/v2-08e51dbd4fac17f50e610c6f1ecdac9c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;810&#39; height=&#39;151&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"810\" data-rawheight=\"151\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"810\" data-original=\"https://pic1.zhimg.com/v2-08e51dbd4fac17f50e610c6f1ecdac9c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-08e51dbd4fac17f50e610c6f1ecdac9c_b.jpg\"/></figure><p>相信对数据融合感兴趣的各位肯定都看到过这张图。</p><p>红色的高斯分布表示预测的小车位置；</p><p>蓝色的高斯分布表示观测的小车位置；</p><p>而融合后，就是绿色的位置；这里只是做了两个高斯分布的相乘，结果是高斯分布。</p><p>回顾一下乘后分布的均值和方差：</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D%3D%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D+%3D+%5Cmu_%7Bf%7D+%2B+%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%28%5Cmu_%7Bg%7D-%5Cmu_%7Bf%7D%29\" alt=\"\\mu_{fg}=\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2} = \\mu_{f} + \\frac{\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2}(\\mu_{g}-\\mu_{f})\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E2+%3D+%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%5Csigma_%7Bg%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D+%3D+%5Csigma_%7Bf%7D%5E2+-%5Cfrac%7B%5Csigma_%7Bf%7D%5E4%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D\" alt=\"\\sigma_{fg}^2 = \\frac{\\sigma_{f}^2\\sigma_{g}^2}{\\sigma_{f}^2+\\sigma_{g}^2} = \\sigma_{f}^2 -\\frac{\\sigma_{f}^4}{\\sigma_{f}^2+\\sigma_{g}^2}\" eeimg=\"1\"/> </p><p>有</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bf%7D%3C%5Cmu_%7Bfg%7D%3C%5Cmu_%7Bg%7D\" alt=\"\\mu_{f}&lt;\\mu_{fg}&lt;\\mu_{g}\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E2+%3C%5Csigma_%7Bf%7D%5E2+\" alt=\"\\sigma_{fg}^2 &lt;\\sigma_{f}^2 \" eeimg=\"1\"/> 且 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E2+%3C%5Csigma_%7Bg%7D%5E2+\" alt=\"\\sigma_{fg}^2 &lt;\\sigma_{g}^2 \" eeimg=\"1\"/> </p><p>是不是相当于用把估计的 <img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D\" alt=\"\\mu_{fg}\" eeimg=\"1\"/> 均值取了预测和观测之间的（权衡值），</p><p>且把估计的方差 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bfg%7D%5E2+\" alt=\"\\sigma_{fg}^2 \" eeimg=\"1\"/> 减小了，这不就是数据融合的主要目的么？</p><p> 此外，在感性的认知中，既然 <img src=\"https://www.zhihu.com/equation?tex=%5Csigma%5E2\" alt=\"\\sigma^2\" eeimg=\"1\"/> 越大，说明估计的值越不准，其实很容易想到用它的倒数来表示权重（越大，则占比越大...）这样和初中学并联电阻求阻值的时候有异曲同工之妙。</p><p><img src=\"https://www.zhihu.com/equation?tex=%5Cmu_%7Bfg%7D%3D%5Cfrac%7B%5Cfrac%7B1%7D%7B%5Csigma_%7Bg%7D%5E2%7D%7D%7B%5Cfrac%7B1%7D%7B%5Csigma_%7Bf%7D%5E2%7D+%2B%5Cfrac%7B1%7D%7B%5Csigma_%7Bg%7D%5E2%7D++%7D%5Cmu_%7Bg%7D+%2B+%5Cfrac%7B%5Cfrac%7B1%7D%7B%5Csigma_%7Bf%7D%5E2%7D%7D%7B%5Cfrac%7B1%7D%7B%5Csigma_%7Bf%7D%5E2%7D+%2B%5Cfrac%7B1%7D%7B%5Csigma_%7Bg%7D%5E2%7D++%7D%5Cmu_%7Bf%7D+++%3D%5Cfrac%7B%5Cmu_%7Bf%7D%5Csigma_%7Bg%7D%5E2%2B%5Cmu_%7Bg%7D%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D+%3D+%5Cmu_%7Bf%7D+%2B+%5Cfrac%7B%5Csigma_%7Bf%7D%5E2%7D%7B%5Csigma_%7Bf%7D%5E2%2B%5Csigma_%7Bg%7D%5E2%7D%28%5Cmu_%7Bg%7D-%5Cmu_%7Bf%7D%29\" alt=\"\\mu_{fg}=\\frac{\\frac{1}{\\sigma_{g}^2}}{\\frac{1}{\\sigma_{f}^2} +\\frac{1}{\\sigma_{g}^2}  }\\mu_{g} + \\frac{\\frac{1}{\\sigma_{f}^2}}{\\frac{1}{\\sigma_{f}^2} +\\frac{1}{\\sigma_{g}^2}  }\\mu_{f}   =\\frac{\\mu_{f}\\sigma_{g}^2+\\mu_{g}\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2} = \\mu_{f} + \\frac{\\sigma_{f}^2}{\\sigma_{f}^2+\\sigma_{g}^2}(\\mu_{g}-\\mu_{f})\" eeimg=\"1\"/> </p><p><img src=\"https://www.zhihu.com/equation?tex=%5Csigma_%7Bf%7D%5E2+%3D+%5Cfrac%7B%5Csigma_%7B1%7D%5E2%5Csigma_%7B2%7D%5E2%7D%7B%5Csigma_%7B1%7D%5E2%2B%5Csigma_%7B2%7D%5E2%7D+%3D+%5Csigma_%7B1%7D%5E2+-%5Cfrac%7B%5Csigma_%7B1%7D%5E4%7D%7B%5Csigma_%7B1%7D%5E2%2B%5Csigma_%7B2%7D%5E2%7D\" alt=\"\\sigma_{f}^2 = \\frac{\\sigma_{1}^2\\sigma_{2}^2}{\\sigma_{1}^2+\\sigma_{2}^2} = \\sigma_{1}^2 -\\frac{\\sigma_{1}^4}{\\sigma_{1}^2+\\sigma_{2}^2}\" eeimg=\"1\"/> </p><p></p><p></p><p></p><p></p><p></p>", 
            "topic": [
                {
                    "tag": "数据融合", 
                    "tagLink": "https://api.zhihu.com/topics/19920094"
                }, 
                {
                    "tag": "姿态解算", 
                    "tagLink": "https://api.zhihu.com/topics/20029625"
                }, 
                {
                    "tag": "无人驾驶车", 
                    "tagLink": "https://api.zhihu.com/topics/19653871"
                }
            ], 
            "comments": [
                {
                    "userName": "冰鋒", 
                    "userLink": "https://www.zhihu.com/people/39004bdb318f18c209fb716a2e8e6011", 
                    "content": "<p>高斯分布的乘积，可以直接在贝叶斯公式中体现，高斯分布的共轭先验也是高斯分布。所以，那个图也直接看成，加入先验知识后（蓝色看到的），小车的位置。</p>", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "土豆哥", 
                    "userLink": "https://www.zhihu.com/people/b22fdfc70b2b83ae176f8aec29a0f0c5", 
                    "content": "太牛了，顺便还把卡尔曼滤波器证明了一次。[赞][赞][赞]", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/41299359", 
            "userName": "legal high", 
            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
            "upvote": 10, 
            "title": "IMU使用概览", 
            "content": "<p>IMU（英文：Inertial measurement unit，简称 IMU）</p><h2>概述</h2><p>百科：测量物体三轴姿态角(或角速率)以及加速度的装置。一般情况下，一个IMU内会装有三轴的陀螺仪和三个方向的加速度计，分别用来测量物体在三维空间中的角速度和加速度，并以此解算出物体的姿态。为了提高可靠性，还可以为每个轴配备更多的传感器。一般而言IMU要安装在被测物体的重心上。</p><h2>原理</h2><p>官方文档：普通六轴IMU，包含三轴陀螺仪和三轴加速度计，一般还包括一个温度传感器</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-e4e52872a89dec47c80ab61532bc6be8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"556\" data-rawheight=\"270\" class=\"origin_image zh-lightbox-thumb\" width=\"556\" data-original=\"https://pic1.zhimg.com/v2-e4e52872a89dec47c80ab61532bc6be8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;556&#39; height=&#39;270&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"556\" data-rawheight=\"270\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"556\" data-original=\"https://pic1.zhimg.com/v2-e4e52872a89dec47c80ab61532bc6be8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-e4e52872a89dec47c80ab61532bc6be8_b.jpg\"/></figure><ul><li>加速度计基本原理就是高中学过的力学知识，力和加速度的方向一致。</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-5ca71f698f2567701f9a7d5457bb4d96_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"344\" data-rawheight=\"139\" class=\"content_image\" width=\"344\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;344&#39; height=&#39;139&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"344\" data-rawheight=\"139\" class=\"content_image lazy\" width=\"344\" data-actualsrc=\"https://pic3.zhimg.com/v2-5ca71f698f2567701f9a7d5457bb4d96_b.jpg\"/></figure><p>可以想象一个小球装在一个感应的小盒子里。水平放置的时候，重力使得小球与下表面接触，下表面会产生一个向上的力，与重力相抵消，则产生一个向上的加速度，大小为G。</p><p>（这样，我们假设IMU的测量范围是正负16G，则测得向上加速度为16个G的时候，真实物体向上的加速度只有15个G。反之，向下测得有16个G的时候，真实加速度有17个Ｇ。）</p><ul><li>陀螺仪的原理基本上用到了一个Coriolis force。</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-5271a8b144a77c6226f3301521ea6d71_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"278\" data-rawheight=\"127\" class=\"content_image\" width=\"278\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;278&#39; height=&#39;127&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"278\" data-rawheight=\"127\" class=\"content_image lazy\" width=\"278\" data-actualsrc=\"https://pic2.zhimg.com/v2-5271a8b144a77c6226f3301521ea6d71_b.jpg\"/></figure><p>这个物理概念在地理课上可能说过，这是为什么北半球的龙卷风及水漩涡的旋转方向都是逆时针旋转的原理。如果物体发生旋转，则一定会产生科里奥利力，通过微结构探测科里奥利力即可测得旋转角速度。</p><h2>使用范围</h2><p>IMU的使用范围非常广，从宇航，到汽车及消费电子都有IMU的身影。</p><p>借用<a href=\"https://zhuanlan.zhihu.com/p/32693377\" class=\"internal\">陈光：无人驾驶技术入门（四）| 百度无人车传感器 IMU 深入剖析</a>使用的这张图，我们可以清楚的看到不同级别的IMU价格和使用场景差别很大。对于自己产品的选型主要考虑的就是需求、性能、价格等方面，根据不同IMU的使用及价格分布，可以有个初步参考。</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a593302f1be625251485e41626d93cbd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"933\" data-rawheight=\"540\" class=\"origin_image zh-lightbox-thumb\" width=\"933\" data-original=\"https://pic2.zhimg.com/v2-a593302f1be625251485e41626d93cbd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;933&#39; height=&#39;540&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"933\" data-rawheight=\"540\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"933\" data-original=\"https://pic2.zhimg.com/v2-a593302f1be625251485e41626d93cbd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-a593302f1be625251485e41626d93cbd_b.jpg\"/></figure><p>考虑到大范围使用的应该都是低价产品，则在精度上可能会有所折扣。但可以通过利用其他传感器的数据对IMU数据做一个修正，便能达到较好的精度要求，比如常用的GPS、超声、视觉等常用定位传感器。</p><h2>使用方法</h2><p>IMU在使用上可以分为硬件和软件两个方面。</p><ul><li>硬件上就是配置寄存器。一般情况下，可以分别通过配置IMU寄存器，来选择加速度计和陀螺仪的量程，量程越大，则精度越差。也可以配置IMU与主机的通信方式，有I2C，也有SPI等。一般I2C比SPI的速率慢很多，对于实时性要求高的场景，可能会使用SPI通信。有些IMU还可以配置使用FIFO，配置使用数据频率，配置内部滤波等等。</li><li>软件上就是读取IMU数据之后的处理。一般来讲，加速度计积分的速度，速度积分得位置。对于普通IMU来说，二次积分后得位置偏移很大，且随时间增长，误差越大。陀螺仪输出得角速度积分得角度，为了避免万向角，一般使用四元素积分求姿态。</li></ul><p>此外，在使用IMU数据之前，一般会对IMU原始数据进行滤波。可以分为物理滤波和软件滤波，</p><p>物理滤波俗称减震。对于加速计而言，可以不用去及时反应物体得姿态变化，所以减震上就要求（软一点），但是对于陀螺仪而言就完全相反，要求（硬一点），这使得IMU的减震取舍是一个比较大的难题。</p><p>软件滤波就是使用巴特沃斯之类的滤波器，对于传感器数据的高频信号进行滤波，而滤波的频段，也是一个需要经验摸索的过程。</p><h2>数据处理</h2><p>IMU传感器能输出加速度和旋转角速度，一般怎么处理相关数据呢？</p><p>加速度的处理，我们很熟悉，用到的知识就是高中物理知识，如下：</p><p><img src=\"https://www.zhihu.com/equation?tex=S_%7B1%7D+%3D+S_%7B0%7D+%2B+vel+%2At+++\" alt=\"S_{1} = S_{0} + vel *t   \" eeimg=\"1\"/>            位置计算</p><p><img src=\"https://www.zhihu.com/equation?tex=vel_%7B1%7D+%3D+vel_%7B0%7D+%2B+a+%2At+\" alt=\"vel_{1} = vel_{0} + a *t \" eeimg=\"1\"/>          速度计算（使用到了加速度a）这里得注意在竖直方向上要将重力产生的加速度影响去掉。</p><p>陀螺仪的处理，一般是采用四元数的方法来进行更新,避免万向锁的困扰，四元数及欧拉角可以参考：</p><a href=\"https://zhuanlan.zhihu.com/p/52335076\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic2.zhimg.com/equation_ipico.jpg\" data-image-width=\"0\" data-image-height=\"0\" class=\"internal\">legal high：四元素、欧拉角及方向余弦矩阵的相互转化公式</a><p><img src=\"https://www.zhihu.com/equation?tex=Q+%3D+Q+%2B+%5Cfrac%7B%5Cpartial+Q+%7D%7B%5Cpartial+t%7D%2At+%3D+Q+%2B+%5Cfrac%7B1+%7D%7B2%7Dt%2A+QW%5E%7Bb%7D\" alt=\"Q = Q + \\frac{\\partial Q }{\\partial t}*t = Q + \\frac{1 }{2}t* QW^{b}\" eeimg=\"1\"/> </p><p>将角速度带入上述公式后，求得更新得四元数，由四元数求解姿态角。</p><p></p><p></p><p></p><p></p><p></p>", 
            "topic": [
                {
                    "tag": "自动化", 
                    "tagLink": "https://api.zhihu.com/topics/19574232"
                }, 
                {
                    "tag": "无人驾驶车", 
                    "tagLink": "https://api.zhihu.com/topics/19653871"
                }, 
                {
                    "tag": "惯性导航系统", 
                    "tagLink": "https://api.zhihu.com/topics/20036106"
                }
            ], 
            "comments": [
                {
                    "userName": "Deep Blue", 
                    "userLink": "https://www.zhihu.com/people/e5d629733380deb29f2e0cb32d079017", 
                    "content": "<p>是把每小段看成匀加速运动还是匀速运动，你在求速度的时候是看成匀加速运动，为什么算位置的时候又看成了匀速运动？？？？？</p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "legal high", 
                            "userLink": "https://www.zhihu.com/people/c9cf20e5e66d59ff2ded56fb1b2e9654", 
                            "content": "<p>在一步预测的时候，计算位置，忽略了加速度的影响，因为时间很小，二次量就忽略了</p>", 
                            "likes": 0, 
                            "replyToAuthor": "Deep Blue"
                        }
                    ]
                }, 
                {
                    "userName": "JInMuYaN", 
                    "userLink": "https://www.zhihu.com/people/35dbb27c2ff3c44fbfd98cff8678f5f4", 
                    "content": "万向角和四元素积分是什么", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/c_1050381620611215360"
}
