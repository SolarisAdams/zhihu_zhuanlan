{
    "title": "Sparkï¼Œä»å…¥é—¨åˆ°ç²¾é€š", 
    "description": "", 
    "followers": [
        "https://www.zhihu.com/people/ren-xiang-91", 
        "https://www.zhihu.com/people/feng-lei-80", 
        "https://www.zhihu.com/people/jeff-kit", 
        "https://www.zhihu.com/people/sonriku", 
        "https://www.zhihu.com/people/ding-chao-44-77", 
        "https://www.zhihu.com/people/superxiong", 
        "https://www.zhihu.com/people/wanggy0225", 
        "https://www.zhihu.com/people/ledinpak", 
        "https://www.zhihu.com/people/nai-men-mo-er-77", 
        "https://www.zhihu.com/people/xiao-wei-ba-52-37-29", 
        "https://www.zhihu.com/people/hu-zi-xian-sheng-95-75", 
        "https://www.zhihu.com/people/phenixsdad", 
        "https://www.zhihu.com/people/flymetothemars-58", 
        "https://www.zhihu.com/people/du-shan-qiao-ke", 
        "https://www.zhihu.com/people/liu-liu-96-83-32", 
        "https://www.zhihu.com/people/blackorwhite", 
        "https://www.zhihu.com/people/aktutuni", 
        "https://www.zhihu.com/people/windybruce", 
        "https://www.zhihu.com/people/jimmy-85-97-50", 
        "https://www.zhihu.com/people/yang-xue-ya", 
        "https://www.zhihu.com/people/da-mu-lang", 
        "https://www.zhihu.com/people/lenged2016", 
        "https://www.zhihu.com/people/wish-64-79", 
        "https://www.zhihu.com/people/deng-zi-wei-33", 
        "https://www.zhihu.com/people/yan-jian-76-38", 
        "https://www.zhihu.com/people/yang-huan-cheng-38", 
        "https://www.zhihu.com/people/luo-yi-28-86", 
        "https://www.zhihu.com/people/liu-yi-25-9", 
        "https://www.zhihu.com/people/Zhiwei1996", 
        "https://www.zhihu.com/people/luo-chen-74-42", 
        "https://www.zhihu.com/people/wook9615", 
        "https://www.zhihu.com/people/sadhen", 
        "https://www.zhihu.com/people/little-29", 
        "https://www.zhihu.com/people/hangpan", 
        "https://www.zhihu.com/people/jason-48-47-64", 
        "https://www.zhihu.com/people/zhao-bing-xin-42", 
        "https://www.zhihu.com/people/lin-zhong-yuan-60", 
        "https://www.zhihu.com/people/ke-xue-xia", 
        "https://www.zhihu.com/people/666677-13", 
        "https://www.zhihu.com/people/wu-yun-cheng-14", 
        "https://www.zhihu.com/people/hnyk", 
        "https://www.zhihu.com/people/rochestor", 
        "https://www.zhihu.com/people/zheng-chao-chao", 
        "https://www.zhihu.com/people/dang-chu-xiang", 
        "https://www.zhihu.com/people/liang-wu-92", 
        "https://www.zhihu.com/people/wht-buaa", 
        "https://www.zhihu.com/people/an-ye-71", 
        "https://www.zhihu.com/people/you-zhi-yu-san", 
        "https://www.zhihu.com/people/wu-xiao-bai-92", 
        "https://www.zhihu.com/people/YangGuoDong", 
        "https://www.zhihu.com/people/njuptcyd", 
        "https://www.zhihu.com/people/yang-troy-89", 
        "https://www.zhihu.com/people/anjun", 
        "https://www.zhihu.com/people/ke-xiao-le-94", 
        "https://www.zhihu.com/people/luxun-huang", 
        "https://www.zhihu.com/people/luther-47-2", 
        "https://www.zhihu.com/people/cai-ru-xin-10", 
        "https://www.zhihu.com/people/hopesfish", 
        "https://www.zhihu.com/people/roger-roger-36", 
        "https://www.zhihu.com/people/wen-rui-94-8", 
        "https://www.zhihu.com/people/uou123", 
        "https://www.zhihu.com/people/lwys-94", 
        "https://www.zhihu.com/people/rain-zou-80", 
        "https://www.zhihu.com/people/proser", 
        "https://www.zhihu.com/people/lifeissocool", 
        "https://www.zhihu.com/people/decli"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/47045762", 
            "userName": "MTé…±", 
            "userLink": "https://www.zhihu.com/people/28629950b8d6033df6b6f33fd0280e2a", 
            "upvote": 0, 
            "title": "ä»Spark MLlibåˆ°ç¾å›¾æœºå™¨å­¦ä¹ æ¡†æ¶å®è·µ", 
            "content": "<p>MLlib æ˜¯ Apache Spark çš„å¯æ‰©å±•æœºå™¨å­¦ä¹ åº“ï¼Œæ—¨åœ¨ç®€åŒ–æœºå™¨å­¦ä¹ çš„å·¥ç¨‹å®è·µå·¥ä½œï¼Œå¹¶æ–¹ä¾¿æ‰©å±•åˆ°æ›´å¤§è§„æ¨¡çš„æ•°æ®é›†ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><h2><b> / æœºå™¨å­¦ä¹ ç®€ä»‹</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨æ·±å…¥ä»‹ç» Spark MLlib ä¹‹å‰å…ˆäº†è§£æœºå™¨å­¦ä¹ ï¼Œæ ¹æ®ç»´åŸºç™¾ç§‘çš„ä»‹ç»ï¼Œæœºå™¨å­¦ä¹ æœ‰ä¸‹é¢å‡ ç§å®šä¹‰ï¼š</p><ul><li>æœºå™¨å­¦ä¹ æ˜¯ä¸€é—¨äººå·¥æ™ºèƒ½çš„ç§‘å­¦ï¼Œè¯¥é¢†åŸŸçš„ä¸»è¦ç ”ç©¶å¯¹è±¡æ˜¯äººå·¥æ™ºèƒ½ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•åœ¨<b>ç»éªŒ</b>å­¦ä¹ ä¸­æ”¹å–„å…·ä½“<b>ç®—æ³•</b>çš„<b>æ€§èƒ½</b>ï¼›</li><li>æœºå™¨å­¦ä¹ æ˜¯å¯¹èƒ½é€šè¿‡<b>ç»éªŒ</b>è‡ªåŠ¨æ”¹è¿›çš„è®¡ç®—æœº<b>ç®—æ³•</b>çš„ç ”ç©¶ï¼›</li><li>æœºå™¨å­¦ä¹ æ˜¯ç”¨æ•°æ®æˆ–ä»¥å¾€çš„<b>ç»éªŒ</b>ï¼Œä»¥æ­¤ä¼˜åŒ–è®¡ç®—æœºç¨‹åºçš„<b>æ€§èƒ½</b>æ ‡å‡†ï¼›</li><li>ä¸€ç§ç»å¸¸å¼•ç”¨çš„è‹±æ–‡å®šä¹‰æ˜¯ã€ŒA computer program is said to learn from <b>experience</b> E with respect to some class of tasks T and <b>performance measure</b> P, if its performance at tasks in T, as measured by P, improves with experience E.ã€ã€‚</li></ul><p><i>*åŠ ç²—çš„æ˜¯é‡ç‚¹/åŠ ç²—çš„æ˜¯é‡ç‚¹/åŠ ç²—çš„æ˜¯é‡ç‚¹</i></p><p class=\"ztext-empty-paragraph\"><br/></p><p>å…¶å®åœ¨ã€Œç¾å›¾æ•°æ®æŠ€æœ¯å›¢é˜Ÿã€ä¹‹å‰çš„ç§‘æ™®æ–‡ç« <b><u><a href=\"https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzU5ODU5MjM2Mw%3D%3D%26mid%3D2247484069%26idx%3D1%26sn%3D7676785c65bb99e17346908e6ec2b485%26chksm%3Dfe409ca1c93715b785168d1f94f57bc159f1cb9fa2d63caf94f31650eb2e8234feecee661c55%26scene%3D21%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è´å¶æ–¯æ¦‚ç‡æ¨¡å‹ä¸€è§ˆ</a></u></b>æ›¾ä»‹ç»è¿‡ï¼Œæœºå™¨å­¦ä¹ ç‹­ä¹‰ä¸Šæ˜¯æŒ‡ä»£ç»Ÿè®¡æœºå™¨å­¦ä¹ ï¼Œç»Ÿè®¡å­¦ä¹ æ ¹æ®ä»»åŠ¡ç±»å‹å¯ä»¥åˆ†ä¸ºç›‘ç£å­¦ä¹ ã€åŠç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ ã€å¢å¼ºå­¦ä¹ ç­‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-6faebec7b8b12c1761edc62ee1d48167_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"567\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-6faebec7b8b12c1761edc62ee1d48167_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;567&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"567\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-6faebec7b8b12c1761edc62ee1d48167_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-6faebec7b8b12c1761edc62ee1d48167_b.jpg\"/></figure><p>æœºå™¨å­¦ä¹ å¸¸ç”¨çš„ç®—æ³•å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ç§ç±»ï¼š</p><blockquote><b>1.æ„é€ é—´éš”ç†è®ºåˆ†å¸ƒï¼š</b>äººå·¥ç¥ç»ç½‘ç»œã€å†³ç­–æ ‘ã€æ„ŸçŸ¥å™¨ã€æ”¯æŒå‘é‡æœºã€é›†æˆå­¦ä¹  AdaBoostã€é™ç»´ä¸åº¦é‡å­¦ä¹ ã€èšç±»ã€è´å¶æ–¯åˆ†ç±»å™¨ï¼›<br/><b>2.æ„é€ æ¡ä»¶æ¦‚ç‡ï¼š</b>é«˜æ–¯è¿‡ç¨‹å›å½’ã€çº¿æ€§åˆ¤åˆ«åˆ†æã€æœ€è¿‘é‚»å±…æ³•ã€å¾„å‘åŸºå‡½æ•°æ ¸ï¼›<br/><b>3.é€šè¿‡å†ç”Ÿæ¨¡å‹æ„é€ æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼š</b>æœ€å¤§æœŸæœ›ç®—æ³•ã€æ¦‚ç‡å›¾æ¨¡å‹ï¼ˆè´å¶æ–¯ç½‘å’Œ Markov éšæœºåœºï¼‰ã€Generative Topographic Mappingï¼›<br/><b>4.è¿‘ä¼¼æ¨æ–­æŠ€æœ¯ï¼š</b>é©¬å°”å¯å¤«é“¾ã€è’™ç‰¹å¡ç½—æ–¹æ³•ã€å˜åˆ†æ³•ï¼›<br/><b>5.æœ€ä¼˜åŒ–ç®—æ³•ã€‚</b></blockquote><p class=\"ztext-empty-paragraph\"><br/></p><h2><b> / Spark MLlib</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨ä¸Šæ–‡æˆ‘ä»¬æ›¾æåˆ°æœºå™¨å­¦ä¹ çš„é‡ç‚¹ä¹‹ä¸€æ˜¯ã€Œç»éªŒã€ï¼Œè€Œå¯¹äºè®¡ç®—æœºè€Œè¨€ç»éªŒå¾€å¾€éœ€è¦ç»è¿‡å¤šè½®è¿­ä»£è®¡ç®—æ‰èƒ½å¾—åˆ°ï¼Œè€Œ Spark æ“…é•¿è¿­ä»£è®¡ç®—ï¼Œæ­£å¥½ç¬¦åˆæœºå™¨å­¦ä¹ è¿™ä¸€ç‰¹æ€§ã€‚åœ¨ Spark å®˜ç½‘ä¸Šå±•ç¤ºäº†é€»è¾‘å›å½’ç®—æ³•åœ¨ Spark å’Œ Hadoop ä¸Šè¿è¡Œæ€§èƒ½æ¯”è¾ƒï¼Œä»ä¸‹å›¾å¯ä»¥çœ‹å‡º MLlib æ¯” MapReduce å¿«äº† 100 å€ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-67a8fa8908a8d1c2d0abd4ed0721a57a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"250\" data-rawheight=\"129\" class=\"content_image\" width=\"250\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;250&#39; height=&#39;129&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"250\" data-rawheight=\"129\" class=\"content_image lazy\" width=\"250\" data-actualsrc=\"https://pic3.zhimg.com/v2-67a8fa8908a8d1c2d0abd4ed0721a57a_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>Spark MLlib ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ æ–¹é¢çš„å†…å®¹ï¼š</p><ul><li><b>å­¦ä¹ ç®—æ³•ï¼š</b>åˆ†ç±»ã€å›å½’ã€èšç±»å’ŒååŒè¿‡æ»¤ï¼›</li><li><b>ç‰¹å¾å¤„ç†ï¼š</b>ç‰¹å¾æå–ã€å˜æ¢ã€é™ç»´å’Œé€‰æ‹©ï¼›</li><li><b>ç®¡é“(Pipeline)ï¼š</b>ç”¨äºæ„å»ºã€è¯„ä¼°å’Œè°ƒæ•´æœºå™¨å­¦ä¹ ç®¡é“çš„å·¥å…·ï¼›</li><li><b>æŒä¹…æ€§ï¼š</b>ä¿å­˜å’ŒåŠ è½½ç®—æ³•ï¼Œæ¨¡å‹å’Œç®¡é“ï¼›</li><li><b>å®ç”¨å·¥å…·ï¼š</b>çº¿æ€§ä»£æ•°ï¼Œç»Ÿè®¡ï¼Œæœ€ä¼˜åŒ–ï¼Œè°ƒå‚ç­‰å·¥å…·ã€‚</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-4e40fe81738b173855dfe04a7f510fbf_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"469\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-4e40fe81738b173855dfe04a7f510fbf_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;469&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"469\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-4e40fe81738b173855dfe04a7f510fbf_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-4e40fe81738b173855dfe04a7f510fbf_b.jpg\"/></figure><p>ä¸Šè¡¨æ€»ç»“äº† Spark MLlib æ”¯æŒçš„åŠŸèƒ½ç»“æ„ï¼Œå¯ä»¥çœ‹å‡ºå®ƒæ‰€æä¾›çš„ç®—æ³•ä¸°å¯Œï¼Œä½†ç®—æ³•ç§ç±»è¾ƒå°‘å¹¶ä¸”è€æ—§ï¼Œå› æ­¤ Spark MLlib åœ¨ç®—æ³•ä¸Šæ”¯æŒä¸ kylin é¡¹ç›®æœ‰äº›è„±èŠ‚ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ›´å¤šæ˜¯ä¸ç‰¹å¾ç›¸å…³çš„ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>ML Pipelines</b></p><p>ä» Spark 2.0 å¼€å§‹åŸºäº RDD çš„ API è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼ŒSpark çš„ä¸»è¦æœºå™¨å­¦ä¹  API ç°åœ¨æ˜¯åŸºäº DataFrame çš„ API spark.mlï¼Œå€Ÿé‰´ Scikit-Learn çš„è®¾è®¡æä¾›äº† Pipeline å¥—ä»¶ï¼Œä»¥æ„å»ºæœºå™¨å­¦ä¹ å·¥ä½œæµã€‚ ML Pipelines æä¾›äº†ä¸€å¥—åŸºäº DataFrame æ„å»ºçš„ç»Ÿä¸€çš„é«˜çº§ API ï¼Œå¯å¸®åŠ©ç”¨æˆ·åˆ›å»ºå’Œè°ƒæ•´å®ç”¨çš„æœºå™¨å­¦ä¹ æµç¨‹ã€‚</p><p><i>*ã€ŒSpark MLã€ä¸æ˜¯å®˜æ–¹åç§°ï¼Œå¶å°”ç”¨äºæŒ‡ä»£åŸºäº MLlib DataFrame çš„ API</i></p><p class=\"ztext-empty-paragraph\"><br/></p><p>é¦–å…ˆäº†è§£ ML Pipelines å†…å‡ ä¸ªé‡è¦ç»„ä»¶ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>DataFrame</b></p><p>DataFrame è®© Spark å…·å¤‡äº†å¤„ç†å¤§è§„æ¨¡ç»“æ„åŒ–æ•°æ®çš„èƒ½åŠ›ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-76bb3c2a93152f2582f0492c5fca77eb_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"651\" data-rawheight=\"328\" class=\"origin_image zh-lightbox-thumb\" width=\"651\" data-original=\"https://pic4.zhimg.com/v2-76bb3c2a93152f2582f0492c5fca77eb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;651&#39; height=&#39;328&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"651\" data-rawheight=\"328\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"651\" data-original=\"https://pic4.zhimg.com/v2-76bb3c2a93152f2582f0492c5fca77eb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-76bb3c2a93152f2582f0492c5fca77eb_b.jpg\"/></figure><p>RDD æ˜¯åˆ†å¸ƒå¼  Java å¯¹è±¡çš„é›†åˆï¼Œå¯¹è±¡çš„å†…éƒ¨æ•°æ®ç»“æ„å¯¹äº RDD è€Œè¨€ä¸å¯çŸ¥ã€‚DataFrame æ˜¯ä¸€ç§ä»¥ RDD ä¸ºåŸºç¡€çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼ŒRDD ä¸­å­˜å‚¨äº† Row å¯¹è±¡ï¼ŒRow å¯¹è±¡æä¾›äº†è¯¦ç»†çš„ç»“æ„ä¿¡æ¯ï¼Œå³æ¨¡å¼ï¼ˆschemaï¼‰ï¼Œä½¿å¾— DataFrame å…·å¤‡äº†ç»“æ„åŒ–æ•°æ®çš„èƒ½åŠ›ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Transforme</b></p><p>Transformer é€šå¸¸æ˜¯ä¸€ä¸ªæ•°æ®/ç‰¹å¾å˜æ¢çš„ç±»ï¼Œæˆ–ä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹ã€‚</p><p>æ¯ä¸ª Transformer éƒ½æœ‰ transform å‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ª DataFrame è½¬æ¢ä¸ºå¦ä¸€ä¸ª DataFrame ã€‚ä¸€èˆ¬ transform çš„è¿‡ç¨‹æ˜¯åœ¨è¾“å…¥çš„ DataFrame ä¸Šæ·»åŠ ä¸€åˆ—æˆ–è€…å¤šåˆ— ï¼ŒTransformer.transformä¹Ÿæ˜¯æƒ°æ€§æ‰§è¡Œï¼Œåªä¼šç”Ÿæˆæ–°çš„ DataFrame å˜é‡ï¼Œè€Œä¸ä¼šå»æäº¤ job è®¡ç®— DataFrame ä¸­çš„å†…å®¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-cfcd4cf45e783ab25a00907cd93c8600_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"484\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-cfcd4cf45e783ab25a00907cd93c8600_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;484&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"484\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-cfcd4cf45e783ab25a00907cd93c8600_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-cfcd4cf45e783ab25a00907cd93c8600_b.jpg\"/></figure><p><b>Estimator</b></p><p>Estimator æŠ½è±¡äº†ä»è¾“å…¥æ•°æ®å­¦ä¹ æ¨¡å‹çš„è¿‡ç¨‹ï¼Œæ¯ä¸ª Estimator éƒ½å®ç°äº† fit æ–¹æ³•ï¼Œç”¨äºç»™å®š DataFrame å’Œ Params åï¼Œç”Ÿæˆä¸€ä¸ª Transformerï¼ˆå³è®­ç»ƒå¥½çš„æ¨¡å‹ï¼‰ï¼Œæ¯å½“è°ƒç”¨ Estimator.fit() åï¼Œéƒ½ä¼šäº§ç”Ÿ job å»è®­ç»ƒæ¨¡å‹ï¼Œå¾—åˆ°æ¨¡å‹å‚æ•°ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Param</b></p><p>å¯ä»¥é€šè¿‡è®¾ç½® Transformer æˆ– Estimator å®ä¾‹çš„å‚æ•°æ¥è®¾ç½®æ¨¡å‹å‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥ ParamMap å¯¹è±¡æ¥è®¾ç½®æ¨¡å‹å‚æ•°ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-8289d6f0c4264f42d7a92058eb5111c1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"701\" data-rawheight=\"121\" class=\"origin_image zh-lightbox-thumb\" width=\"701\" data-original=\"https://pic2.zhimg.com/v2-8289d6f0c4264f42d7a92058eb5111c1_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;701&#39; height=&#39;121&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"701\" data-rawheight=\"121\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"701\" data-original=\"https://pic2.zhimg.com/v2-8289d6f0c4264f42d7a92058eb5111c1_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-8289d6f0c4264f42d7a92058eb5111c1_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Pipeline</b></p><p>Pipeline å®šä¹‰äº†ä¸€ç»„æ•°æ®å¤„ç†æµç¨‹ï¼Œå¯ä»¥åœ¨ Pipeline ä¸­åŠ å…¥ Transformerã€Estimator æˆ–å¦ä¸€ä¸ª Pipelineã€‚Pipeline ç»§æ‰¿è‡ª Estimatorï¼Œè°ƒç”¨ Pipeline.fit æ–¹æ³•åè¿”å›ä¸€ä¸ª Transformerâ€”â€”PipelineModelï¼›PipelineModel ç»§æ‰¿è‡ª Transformerï¼Œç”¨äºå°†è¾“å…¥ç»è¿‡ Pipeline çš„å„ä¸ª Transformer çš„å˜æ¢åï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡ºã€‚</p><p>Spark MLlib å…¸å‹æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ„é€ è®­ç»ƒæ•°æ®é›†</li><li>æ„å»ºå„ä¸ª Stage</li><li>Stage ç»„æˆ Pipeline</li><li>å¯åŠ¨æ¨¡å‹è®­ç»ƒ</li><li>è¯„ä¼°æ¨¡å‹æ•ˆæœ</li><li>è®¡ç®—é¢„æµ‹ç»“æœ</li></ul><p>é€šè¿‡ä¸€ä¸ª Pipeline çš„æ–‡æœ¬åˆ†ç±»ç¤ºä¾‹æ¥åŠ æ·±ç†è§£ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">import org.apache.spark.ml.{Pipeline, PipelineModel}\nimport org.apache.spark.ml.classification.LogisticRegression\nimport org.apache.spark.ml.feature.{HashingTF, Tokenizer}\nimport org.apache.spark.ml.linalg.Vector\nimport org.apache.spark.sql.Row\n\n// Prepare training documents from a list of (id, text, label) tuples.\nval training = spark.createDataFrame(Seq(\n (0L, &#34;a b c d e spark&#34;, 1.0),\n (1L, &#34;b d&#34;, 0.0),\n (2L, &#34;spark f g h&#34;, 1.0),\n (3L, &#34;hadoop mapreduce&#34;, 0.0)\n)).toDF(&#34;id&#34;, &#34;text&#34;, &#34;label&#34;)\n\n// Configure an ML pipeline, which consists of three stages: tokenizer, hashingTF, and lr.\nval tokenizer = new Tokenizer()\n .setInputCol(&#34;text&#34;)\n .setOutputCol(&#34;words&#34;)\nval hashingTF = new HashingTF()\n .setNumFeatures(1000)\n .setInputCol(tokenizer.getOutputCol)\n .setOutputCol(&#34;features&#34;)\nval lr = new LogisticRegression()\n .setMaxIter(10)\n .setRegParam(0.001)\nval pipeline = new Pipeline()\n .setStages(Array(tokenizer, hashingTF, lr))\n\n// Fit the pipeline to training documents.\nval model = pipeline.fit(training)\n\n// Now we can optionally save the fitted pipeline to disk\nmodel.write.overwrite().save(&#34;/tmp/spark-logistic-regression-model&#34;)\n\n// We can also save this unfit pipeline to disk\npipeline.write.overwrite().save(&#34;/tmp/unfit-lr-model&#34;)\n\n// And load it back in during production\nval sameModel = PipelineModel.load(&#34;/tmp/spark-logistic-regression-model&#34;)\n\n// Prepare test documents, which are unlabeled (id, text) tuples.\nval test = spark.createDataFrame(Seq(\n (4L, &#34;spark i j k&#34;),\n (5L, &#34;l m n&#34;),\n (6L, &#34;spark hadoop spark&#34;),\n (7L, &#34;apache hadoop&#34;)\n)).toDF(&#34;id&#34;, &#34;text&#34;)\n\n// Make predictions on test documents.\nmodel.transform(test)\n .select(&#34;id&#34;, &#34;text&#34;, &#34;probability&#34;, &#34;prediction&#34;)\n .collect()\n .foreach { case Row(id: Long, text: String, prob: Vector, prediction: Double) =&gt;\n   println(s&#34;($id, $text) --&gt; prob=$prob, prediction=$prediction&#34;)\n }</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p><b>æ¨¡å‹é€‰æ‹©ä¸è°ƒå‚</b></p><p>Spark MLlib æä¾›äº† CrossValidator å’Œ TrainValidationSplit ä¸¤ä¸ªæ¨¡å‹é€‰æ‹©å’Œè°ƒå‚å·¥å…·ã€‚æ¨¡å‹é€‰æ‹©ä¸è°ƒå‚çš„ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶åˆ†åˆ«æ˜¯ Estimatorã€ParamGrid å’Œ Evaluatorï¼Œå…¶ä¸­ Estimator åŒ…æ‹¬ç®—æ³•æˆ–è€… Pipelineï¼›ParamGrid å³ ParamMap é›†åˆï¼Œæä¾›å‚æ•°æœç´¢ç©ºé—´ï¼›Evaluator å³è¯„ä»·æŒ‡æ ‡ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>CrossValidator</b></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-3b83d0320df049bafd28231211d94c9c_b.jpg\" data-size=\"normal\" data-rawwidth=\"742\" data-rawheight=\"905\" class=\"origin_image zh-lightbox-thumb\" width=\"742\" data-original=\"https://pic1.zhimg.com/v2-3b83d0320df049bafd28231211d94c9c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;742&#39; height=&#39;905&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"742\" data-rawheight=\"905\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"742\" data-original=\"https://pic1.zhimg.com/v2-3b83d0320df049bafd28231211d94c9c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-3b83d0320df049bafd28231211d94c9c_b.jpg\"/><figcaption>via https://github.com/JerryLead/blogs/blob/master/BigDataSystems/Spark/ML/Introduction%20to%20MLlib%20Pipeline.md</figcaption></figure><p>CrossValidator å°†æ•°æ®é›†æŒ‰ç…§äº¤å‰éªŒè¯æ•°åˆ‡åˆ†æˆ n ä»½ï¼Œæ¯æ¬¡ç”¨ n-1 ä»½ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„ä½œä¸ºæµ‹è¯•é›†ï¼Œè®­ç»ƒå¹¶è¯„ä¼°æ¨¡å‹ï¼Œé‡å¤ n æ¬¡ï¼Œå¾—åˆ° n ä¸ªè¯„ä¼°ç»“æœï¼Œæ±‚ n æ¬¡çš„å¹³å‡å€¼ä½œä¸ºè¿™æ¬¡äº¤å‰éªŒè¯çš„ç»“æœã€‚æ¥ç€å¯¹æ¯ä¸ªå€™é€‰ ParamMap é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œé€‰æ‹©æœ€ä¼˜çš„ ParamMap å¹¶é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œå¾—åˆ°æœ€ä¼˜å‚æ•°çš„æ¨¡å‹è¾“å‡ºã€‚</p><p><b>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼š</b></p><div class=\"highlight\"><pre><code class=\"language-text\">// We use a ParamGridBuilder to construct a grid of parameters to search over.\n// With 3 values for hashingTF.numFeatures and 2 values for lr.regParam,\n// this grid will have 3 x 2 = 6 parameter settings for CrossValidator to choose from.\nval paramGrid = new ParamGridBuilder()\n .addGrid(hashingTF.numFeatures, Array(10, 100, 1000))\n .addGrid(lr.regParam, Array(0.1, 0.01))\n .build()\n\n// We now treat the Pipeline as an Estimator, wrapping it in a CrossValidator instance.\n// This will allow us to jointly choose parameters for all Pipeline stages.\n// A CrossValidator requires an Estimator, a set of Estimator ParamMaps, and an Evaluator.\n// Note that the evaluator here is a BinaryClassificationEvaluator and its default metric\n// is areaUnderROC.\nval cv = new CrossValidator()\n .setEstimator(pipeline)\n .setEvaluator(new BinaryClassificationEvaluator)\n .setEstimatorParamMaps(paramGrid)\n .setNumFolds(2)  // Use 3+ in practice\n .setParallelism(2)  // Evaluate up to 2 parameter settings in parallel\n\n// Run cross-validation, and choose the best set of parameters.\nval cvModel = cv.fit(training)\n\n// Prepare test documents, which are unlabeled (id, text) tuples.\nval test = spark.createDataFrame(Seq(\n (4L, &#34;spark i j k&#34;),\n (5L, &#34;l m n&#34;),\n (6L, &#34;mapreduce spark&#34;),\n (7L, &#34;apache hadoop&#34;)\n)).toDF(&#34;id&#34;, &#34;text&#34;)\n\n// Make predictions on test documents. cvModel uses the best model found (lrModel).\ncvModel.transform(test)\n .select(&#34;id&#34;, &#34;text&#34;, &#34;probability&#34;, &#34;prediction&#34;)\n .collect()\n .foreach { case Row(id: Long, text: String, prob: Vector, prediction: Double) =&gt;\n   println(s&#34;($id, $text) --&gt; prob=$prob, prediction=$prediction&#34;)\n }</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p><b>TrainValidationSplit</b></p><p>TrainValidationSplit ä½¿ç”¨ trainRatio å‚æ•°å°†è®­ç»ƒé›†æŒ‰ç…§æ¯”ä¾‹åˆ‡åˆ†æˆè®­ç»ƒå’ŒéªŒè¯é›†ï¼Œå…¶ä¸­ trainRatio æ¯”ä¾‹çš„æ ·æœ¬ç”¨äºè®­ç»ƒï¼Œå‰©ä½™æ ·æœ¬ç”¨äºéªŒè¯ã€‚</p><p>ä¸ CrossValidator ä¸åŒçš„æ˜¯ï¼ŒTrainValidationSplit åªæœ‰ä¸€æ¬¡éªŒè¯è¿‡ç¨‹ï¼Œå¯ä»¥ç®€å•çœ‹æˆæ˜¯ CrossValidator çš„ n ä¸º 2 æ—¶çš„ç‰¹æ®Šç‰ˆæœ¬ã€‚</p><p><b>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼š</b></p><div class=\"highlight\"><pre><code class=\"language-text\">import org.apache.spark.ml.evaluation.RegressionEvaluator\nimport org.apache.spark.ml.regression.LinearRegression\nimport org.apache.spark.ml.tuning.{ParamGridBuilder, TrainValidationSplit}\n\n// Prepare training and test data.\nval data = spark.read.format(&#34;libsvm&#34;).load(&#34;data/mllib/sample_linear_regression_data.txt&#34;)\nval Array(training, test) = data.randomSplit(Array(0.9, 0.1), seed = 12345)\n\nval lr = new LinearRegression()\n   .setMaxIter(10)\n\n// We use a ParamGridBuilder to construct a grid of parameters to search over.\n// TrainValidationSplit will try all combinations of values and determine best model using\n// the evaluator.\nval paramGrid = new ParamGridBuilder()\n .addGrid(lr.regParam, Array(0.1, 0.01))\n .addGrid(lr.fitIntercept)\n .addGrid(lr.elasticNetParam, Array(0.0, 0.5, 1.0))\n .build()\n\n// In this case the estimator is simply the linear regression.\n// A TrainValidationSplit requires an Estimator, a set of Estimator ParamMaps, and an Evaluator.\nval trainValidationSplit = new TrainValidationSplit()\n .setEstimator(lr)\n .setEvaluator(new RegressionEvaluator)\n .setEstimatorParamMaps(paramGrid)\n // 80% of the data will be used for training and the remaining 20% for validation.\n .setTrainRatio(0.8)\n // Evaluate up to 2 parameter settings in parallel\n .setParallelism(2)\n\n// Run train validation split, and choose the best set of parameters.\nval model = trainValidationSplit.fit(training)\n\n// Make predictions on test data. model is the model with combination of parameters\n// that performed best.\nmodel.transform(test)\n .select(&#34;features&#34;, &#34;label&#34;, &#34;prediction&#34;)\n .show()</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p><b>å®ç°è‡ªå®šä¹‰ Transformer</b></p><p>ç»§æ‰¿è‡ª Transformer ç±»ï¼Œå®ç° transform æ–¹æ³•ï¼Œé€šå¸¸æ˜¯åœ¨è¾“å…¥çš„ DataFrame ä¸Šæ·»åŠ ä¸€åˆ—æˆ–å¤šåˆ—ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a8e3e083e269af62c988044f9084977e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"759\" data-rawheight=\"502\" class=\"origin_image zh-lightbox-thumb\" width=\"759\" data-original=\"https://pic3.zhimg.com/v2-a8e3e083e269af62c988044f9084977e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;759&#39; height=&#39;502&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"759\" data-rawheight=\"502\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"759\" data-original=\"https://pic3.zhimg.com/v2-a8e3e083e269af62c988044f9084977e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-a8e3e083e269af62c988044f9084977e_b.jpg\"/></figure><p>å¯¹äºå•è¾“å…¥åˆ—ï¼Œå•è¾“å‡ºåˆ—çš„ Transformer å¯ä»¥ç»§æ‰¿è‡ª UnaryTransformer ç±»ï¼Œå¹¶å®ç°å…¶ä¸­çš„ createTransformFunc æ–¹æ³•ï¼Œå®ç°å¯¹è¾“å…¥åˆ—æ¯ä¸€è¡Œçš„å¤„ç†ï¼Œå¹¶è¿”å›ç›¸åº”çš„è¾“å‡ºã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-1a3aa30342883bd52ee19299b2c66c86_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"810\" data-rawheight=\"333\" class=\"origin_image zh-lightbox-thumb\" width=\"810\" data-original=\"https://pic3.zhimg.com/v2-1a3aa30342883bd52ee19299b2c66c86_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;810&#39; height=&#39;333&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"810\" data-rawheight=\"333\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"810\" data-original=\"https://pic3.zhimg.com/v2-1a3aa30342883bd52ee19299b2c66c86_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-1a3aa30342883bd52ee19299b2c66c86_b.jpg\"/></figure><h2><b>/ è‡ªç ”æœºå™¨å­¦ä¹ æ¡†æ¶</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p>æœºå™¨å­¦ä¹ æŠ€æœ¯æ—¥æ–°æœˆå¼‚ï¼Œå´ç¼ºå°‘é«˜æ•ˆçµæ´»çš„æ¡†æ¶é™ä½æ–°æŠ€æœ¯çš„è°ƒç ”æˆæœ¬ï¼Œè€Œç»éªŒä¸æŠ€æœ¯å¾€å¾€éœ€è¦é€šè¿‡æ¡†æ¶å’Œå·¥å…·æ¥æ²‰æ·€ï¼Œå¹¶ä¸”ç®—æ³•äººå‘˜å¸¸å¸¸å—é™äºç®—åŠ›ï¼Œå¯¼è‡´ç¦»çº¿è¯æ˜æœ‰æ•ˆçš„æ¨¡å‹ï¼Œå› ä¸ºé¢„ä¼°æ—¶é—´å¤æ‚åº¦è¿‡é«˜è€Œæ— æ³•ä¸Šçº¿ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-163edaaacb126f51dca04c543795c8c5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"818\" data-rawheight=\"452\" class=\"origin_image zh-lightbox-thumb\" width=\"818\" data-original=\"https://pic2.zhimg.com/v2-163edaaacb126f51dca04c543795c8c5_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;818&#39; height=&#39;452&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"818\" data-rawheight=\"452\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"818\" data-original=\"https://pic2.zhimg.com/v2-163edaaacb126f51dca04c543795c8c5_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-163edaaacb126f51dca04c543795c8c5_b.jpg\"/></figure><p>æ®æ­¤ç¾å›¾æ•°æ®æŠ€æœ¯å›¢é˜Ÿä»¥ã€Œå¼€å‘ç®€å•çµæ´»çš„æœºå™¨å­¦ä¹ å·¥ä½œæµï¼Œé™ä½ç®—æ³•äººå‘˜çš„æ–°ç®—æ³•è°ƒç ”æˆæœ¬åŠå·¥ç¨‹äººå‘˜çš„ç»´æŠ¤æˆæœ¬ï¼Œå¹¶ä¸”æä¾›å¸¸ç”¨çš„é¢†åŸŸå†…è§£å†³æ–¹æ¡ˆï¼Œå°†ç»éªŒæ²‰æ·€ã€çš„ç›®æ ‡æ­å»ºäº†ä¸€å¥—é‡èº«å®šåˆ¶çš„æœºå™¨å­¦ä¹ æ¡†æ¶ç”¨ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå°¤å…¶æ˜¯è§£å†³åœ¨æ¨èç®—æ³•ç›¸å…³ä»»åŠ¡ä¸Šé‡åˆ°çš„é—®é¢˜ã€‚è¯¥æ¡†æ¶æ€»å…±åŒ…æ‹¬ 3 ä¸ªç»„ä»¶ï¼šSpark Featureã€Bamboo ä¸ Online Scorerã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Featureï¼šè®­ç»ƒæ ·æœ¬ç”Ÿäº§</b></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-516deb998df60e7da075471d8178117f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"770\" data-rawheight=\"134\" class=\"origin_image zh-lightbox-thumb\" width=\"770\" data-original=\"https://pic4.zhimg.com/v2-516deb998df60e7da075471d8178117f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;770&#39; height=&#39;134&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"770\" data-rawheight=\"134\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"770\" data-original=\"https://pic4.zhimg.com/v2-516deb998df60e7da075471d8178117f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-516deb998df60e7da075471d8178117f_b.jpg\"/></figure><p>è¯¥ç»„ä»¶ä¸»è¦ç”¨äºè®­ç»ƒæ ·æœ¬çš„ç”Ÿäº§ï¼Œå®ç°äº†çµæ´»é«˜æ•ˆçš„æ ·æœ¬ç‰¹å¾ç¼–ç ï¼Œå¯ä»¥å®ç°å°†ä»»æ„ç‰¹å¾é›†åˆæ”¾åœ¨åŒä¸€ä¸ªç©ºé—´è¿›è¡Œç¼–ç ï¼Œä¸åŒç‰¹å¾é›†åˆå…±äº«ç¼–ç ç©ºé—´ï¼›ä¸ºæ­¤æˆ‘ä»¬æå‡ºäº†ä¸¤ä¸ªæ¦‚å¿µï¼šç¬¬ä¸€ä¸ªæ˜¯ã€ŒåŸŸã€ï¼Œç”¨äºå®šä¹‰å…±äº«ç›¸åŒå»ºæ¨¡è¿‡ç¨‹çš„ä¸€ç»„ç‰¹å¾ï¼›ç¬¬äºŒä¸ªæ˜¯ã€Œç©ºé—´ã€ï¼Œç”¨äºå®šä¹‰å…±äº«ç›¸åŒç¼–ç ç©ºé—´çš„ä¸€ç»„åŸŸã€‚</p><p>ä¸Šå›¾ç¤ºä¾‹ä¸­çš„ã€ŒOldã€å±•ç¤ºäº†åœ¨æ²¡æœ‰â€œåŸŸâ€å’Œâ€œç©ºé—´â€æ¦‚å¿µä¸‹çš„æ ·æœ¬ç‰¹å¾ç¼–ç ï¼Œæ‰€æœ‰ç‰¹å¾ä» 1 å¼€å§‹ç¼–å·ï¼›ã€ŒNewã€å±•ç¤ºäº†å°† age å’Œ gender åˆ†åˆ«æ”¾åˆ° age åŸŸå’Œ gender åŸŸåï¼Œä¸¤ä¸ªåŸŸåˆ†åˆ«ä» 1 å¼€å§‹ç¼–ç ï¼Œäº’ä¸å½±å“ã€‚</p><p>Spark Feature æœ€ç»ˆé‡‡ç”¨ TFRecords ä½œä¸ºè®­ç»ƒæ ·æœ¬çš„å­˜å‚¨æ ¼å¼ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Bambooï¼šæ¨¡å‹å®šä¹‰ä¸è®­ç»ƒ</b></p><p>è¯¥ç»„ä»¶ä¸»è¦ä¸ºäº†å®ç°å¯æ‰©å±•ã€é«˜æ•ˆã€ç®€å•å¿«é€Ÿçš„æ¨¡å‹å®šä¹‰ä¸è®­ç»ƒã€‚ä¸ºæ­¤ï¼Œåœ¨è®¾è®¡ Bamboo æ—¶æˆ‘ä»¬éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p><p><b>1.</b>layer ä¹‹é—´é€šè¿‡ tensor è¿›è¡Œäº¤äº’ï¼Œlayer çš„è¾“å…¥æ˜¯ tensorï¼Œè¾“å‡ºä¹Ÿæ˜¯ tensorï¼›</p><p><b>2.</b>ä¸ºäº†æœ€å¤§é™åº¦åœ°æé«˜ç¦»çº¿ä¸åœ¨çº¿æ•ˆç‡ï¼Œæ²¡æœ‰é‡‡ç”¨å¤ªå¤šé«˜çº§ apiï¼Œå¦‚ kerasï¼Œå¤§å¤šæ•°æ¨¡å‹ä¸ç»„ä»¶åŸºäº Tensorflow åº•å±‚ api å¼€å‘ï¼Œå¹¶ä¸”æ ¹æ® Tensorflow å®˜æ–¹çš„æ€§èƒ½ä¼˜åŒ–æŒ‡å—å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼›</p><p><b>3.</b>æä¾› online-offline çš„å»ºæ¨¡æ¡†æ¶ï¼Œå¤æ‚è®¡ç®—æ”¾åˆ°ç¦»çº¿ï¼Œåœ¨çº¿åªè¿›è¡Œè½»é‡è®¡ç®—ï¼Œä½¿å¾—å¤æ‚æ¨¡å‹æ›´æ˜“ä¸Šçº¿ï¼›</p><p><b>4.</b>å°è£…æ•°æ®åŠ è½½ã€æ¨¡å‹è®­ç»ƒä¸å¯¼å‡ºã€æ•ˆæœè¯„ä¼°ä»¥åŠæä¾›äº†å„ç§è¾…åŠ©å·¥å…·ï¼Œç”¨æˆ·åªéœ€è¦å®šä¹‰å‰å‘æ¨ç†ç½‘ç»œï¼ŒåŒæ—¶å°è£…äº†å¤§é‡çš„å¸¸ç”¨ layerï¼Œæ¨¡å‹å®šä¹‰æ›´å¿«æ·ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-cb8577b3e4b15b2a60ca97fbfbc607f3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"322\" data-rawheight=\"987\" class=\"content_image\" width=\"322\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;322&#39; height=&#39;987&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"322\" data-rawheight=\"987\" class=\"content_image lazy\" width=\"322\" data-actualsrc=\"https://pic4.zhimg.com/v2-cb8577b3e4b15b2a60ca97fbfbc607f3_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Online Scorerï¼šåœ¨çº¿é¢„æµ‹æœåŠ¡</b></p><p>Online Scorerçš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç»Ÿä¸€ï¼Œé«˜æ•ˆçš„åœ¨çº¿æ¨ç†æœåŠ¡ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒtensorflowï¼Œpytorchï¼Œxgboostç­‰å„ç§ä¸»æµå»ºæ¨¡æ¡†æ¶å¯¼å‡ºçš„æ¨¡å‹ã€‚ç›®å‰è¿™å—å·¥ä½œè¿˜åœ¨è¿›è¡Œä¸­ï¼Œå…·ä½“å®ç°æ–¹æ¡ˆç»†èŠ‚ï¼Œæˆ‘ä»¬æ”¾åˆ°åé¢çš„ä¸“é¢˜æ–‡ç« ä»‹ç»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-3290ab0a423df06dfe406d9e69915c73_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"404\" data-rawheight=\"559\" class=\"content_image\" width=\"404\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;404&#39; height=&#39;559&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"404\" data-rawheight=\"559\" class=\"content_image lazy\" width=\"404\" data-actualsrc=\"https://pic4.zhimg.com/v2-3290ab0a423df06dfe406d9e69915c73_b.jpg\"/></figure><p>ä»¥ä¸Šå°±æ˜¯ç¾å›¾è‡ªç ”æœºå™¨å­¦ä¹ æ¡†æ¶çš„ç®€è¦ä»‹ç»ï¼Œæ¬¢è¿æŒç»­å…³æ³¨ã€Œç¾å›¾æ•°æ®æŠ€æœ¯å›¢é˜Ÿã€ï¼Œåç»­å°†å¸¦æ¥è¯¥å¹³å°çš„è¯¦ç»†ä»‹ç»ã€‚</p><p></p>", 
            "topic": [
                {
                    "tag": "å¤§æ•°æ®", 
                    "tagLink": "https://api.zhihu.com/topics/19740929"
                }, 
                {
                    "tag": "Spark", 
                    "tagLink": "https://api.zhihu.com/topics/19942170"
                }, 
                {
                    "tag": "æœºå™¨å­¦ä¹ ", 
                    "tagLink": "https://api.zhihu.com/topics/19559450"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/42196360", 
            "userName": "MTé…±", 
            "userLink": "https://www.zhihu.com/people/28629950b8d6033df6b6f33fd0280e2a", 
            "upvote": 8, 
            "title": "RDDåŸç†ä¸åŸºæœ¬æ“ä½œ | Sparkï¼Œä»å…¥é—¨åˆ°ç²¾é€š", 
            "content": "<blockquote>æ¬¢è¿é˜…è¯»ç¾å›¾æ•°æ®æŠ€æœ¯å›¢é˜Ÿçš„ã€ŒSparkï¼Œä»å…¥é—¨åˆ°ç²¾é€šã€ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« å°†ç”±æµ…å…¥æ·±ä¸ºå¤§å®¶ä»‹ç» Sparkï¼Œä»æ¡†æ¶å…¥é—¨åˆ°åº•å±‚æ¶æ„çš„å®ç°ï¼Œç›¸ä¿¡æ€»æœ‰ä¸€ç§å§¿åŠ¿é€‚åˆä½ ï¼Œæ¬¢è¿å¤§å®¶æŒç»­å…³æ³¨ï¼šï¼‰</blockquote><p class=\"ztext-empty-paragraph\"><br/></p><p>å¾€æœŸç›´é€šè½¦ï¼š</p><p><a href=\"https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzU5ODU5MjM2Mw%3D%3D%26mid%3D2247484147%26idx%3D2%26sn%3Dcca8dc960db221fb920bfb545d357ad9%26chksm%3Dfe409cf7c93715e1a2f76400f33e7b1e43b74d104bb73e2df5c2d66334708f2ab44affb32348%26scene%3D21%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Hello Spark! </a></p><p><a href=\"https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzU5ODU5MjM2Mw%3D%3D%26mid%3D2247484270%26idx%3D2%26sn%3Df287173c5d676625f11c7ef415b81cf4%26chksm%3Dfe409d6ac937147c2bd197104a3e4070c9d12786c9c37c17d699039a5d96858cafcc8eee53e5%26scene%3D21%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Spark on Yarn</a></p><h2><b>ä»€ä¹ˆæ˜¯ RDDï¼Ÿ</b></h2><p>ä¼ ç»Ÿçš„ MapReduce è™½ç„¶å…·æœ‰è‡ªåŠ¨å®¹é”™ã€å¹³è¡¡è´Ÿè½½å’Œå¯æ‹“å±•æ€§çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯å…¶æœ€å¤§ç¼ºç‚¹æ˜¯åœ¨è¿­ä»£è®¡ç®—å¼çš„æ—¶å€™ï¼Œè¦è¿›è¡Œå¤§é‡çš„ç£ç›˜ IO æ“ä½œï¼Œè€Œ RDD æ­£æ˜¯è§£å†³è¿™ä¸€ç¼ºç‚¹çš„æŠ½è±¡æ–¹æ³•ã€‚RDDï¼ˆResilient Distributed Datasetsï¼‰å³å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œä»åå­—è¯´èµ·ï¼š</p><p><b>å¼¹æ€§</b></p><p>å½“è®¡ç®—è¿‡ç¨‹ä¸­å†…å­˜ä¸è¶³æ—¶å¯åˆ·å†™åˆ°ç£ç›˜ç­‰å¤–å­˜ä¸Šï¼Œå¯ä¸å¤–å­˜åšçµæ´»çš„æ•°æ®äº¤æ¢ï¼›</p><p>RDD ä½¿ç”¨äº†ä¸€ç§â€œè¡€ç»Ÿâ€çš„å®¹é”™æœºåˆ¶ï¼Œåœ¨ç»“æ„æ›´æ–°å’Œä¸¢å¤±åå¯éšæ—¶æ ¹æ®è¡€ç»Ÿè¿›è¡Œæ•°æ®æ¨¡å‹çš„é‡å»ºï¼›</p><p><b>åˆ†å¸ƒå¼</b></p><p>å°±æ˜¯å¯ä»¥åˆ†å¸ƒåœ¨å¤šå°æœºå™¨ä¸Šè¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼›</p><p><b>æ•°æ®é›†</b></p><p>ä¸€ç»„åªè¯»çš„ã€å¯åˆ†åŒºçš„åˆ†å¸ƒå¼æ•°æ®é›†åˆï¼Œé›†åˆå†…åŒ…å«äº†å¤šä¸ªåˆ†åŒºã€‚åˆ†åŒºä¾ç…§ç‰¹å®šè§„åˆ™å°†å…·æœ‰ç›¸åŒå±æ€§çš„æ•°æ®è®°å½•æ”¾åœ¨ä¸€èµ·ï¼Œæ¯ä¸ªåˆ†åŒºç›¸å½“äºä¸€ä¸ªæ•°æ®é›†ç‰‡æ®µã€‚</p><p><b>RDD å†…éƒ¨ç»“æ„</b></p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-67adb3c3c97414b92323aaa959b9cf39_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"775\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-67adb3c3c97414b92323aaa959b9cf39_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;775&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"775\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-67adb3c3c97414b92323aaa959b9cf39_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-67adb3c3c97414b92323aaa959b9cf39_b.jpg\"/><figcaption>å›¾ 1</figcaption></figure><p>å›¾ 1 æ‰€ç¤ºæ˜¯ RDD çš„å†…éƒ¨ç»“æ„å›¾ï¼Œå®ƒæ˜¯ä¸€ä¸ªåªè¯»ã€æœ‰å±æ€§çš„æ•°æ®é›†ã€‚å®ƒçš„å±æ€§ç”¨æ¥æè¿°å½“å‰æ•°æ®é›†çš„çŠ¶æ€ï¼Œæ•°æ®é›†ç”±æ•°æ®çš„åˆ†åŒºï¼ˆpartitionï¼‰ç»„æˆï¼Œå¹¶ç”±ï¼ˆblockï¼‰æ˜ å°„æˆçœŸå®æ•°æ®ã€‚RDD çš„ä¸»è¦å±æ€§å¯ä»¥åˆ†ä¸º 3 ç±»ï¼šä¸å…¶ä»– RDD çš„å…³ç³»ï¼ˆparentsã€dependenciesï¼‰ï¼›æ•°æ®(partitionerã€checkpointã€storage levelã€iterator ç­‰)ï¼›RDD è‡ªèº«å±æ€§(sparkcontextã€sparkconf)ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ ¹æ®å±æ€§åˆ†ç±»æ¥æ·±å…¥ä»‹ç»å„ä¸ªç»„ä»¶ã€‚</p><p><b>RDD è‡ªèº«å±æ€§</b></p><p>ä»è‡ªèº«å±æ€§è¯´èµ·ï¼Œ<b>SparkContext</b> æ˜¯ Spark job çš„å…¥å£ï¼Œç”± Driver åˆ›å»ºåœ¨ client ç«¯ï¼ŒåŒ…æ‹¬é›†ç¾¤è¿æ¥ã€RDD IDã€ç´¯åŠ å™¨ã€å¹¿æ’­å˜é‡ç­‰ä¿¡æ¯ã€‚<b>SparkConf</b> æ˜¯å‚æ•°é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><b>Spark api</b>ï¼Œæ§åˆ¶å¤§éƒ¨åˆ†çš„åº”ç”¨ç¨‹åºå‚æ•°ï¼›</li><li><b>ç¯å¢ƒå˜é‡</b>ï¼Œé…ç½®IPåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ï¼›</li><li><b>æ—¥å¿—é…ç½®</b>ï¼Œé€šè¿‡ log4j.properties é…ç½®ã€‚</li></ul><p><b>æ•°æ®</b></p><p>RDD å†…éƒ¨çš„æ•°æ®é›†åˆåœ¨é€»è¾‘ä¸Šå’Œç‰©ç†ä¸Šè¢«åˆ’åˆ†æˆå¤šä¸ªå°å­é›†åˆï¼Œè¿™æ ·çš„æ¯ä¸€ä¸ªå­é›†åˆæˆ‘ä»¬å°†å…¶ç§°ä¸º<b>åˆ†åŒºï¼ˆPartitionsï¼‰</b>ï¼Œåˆ†åŒºçš„ä¸ªæ•°ä¼šå†³å®šå¹¶è¡Œè®¡ç®—çš„ç²’åº¦ï¼Œè€Œæ¯ä¸€ä¸ªåˆ†åŒºæ•°å€¼çš„è®¡ç®—éƒ½æ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤å¹¶è¡Œä»»åŠ¡çš„ä¸ªæ•°ä¹Ÿæ˜¯ç”± RDDåˆ†åŒºçš„ä¸ªæ•°å†³å®šçš„ã€‚ä½†äº‹å®ä¸Š RDD åªæ˜¯æ•°æ®é›†çš„æŠ½è±¡ï¼Œåˆ†åŒºå†…éƒ¨å¹¶ä¸ä¼šå­˜å‚¨å…·ä½“çš„æ•°æ®ã€‚Partition ç±»å†…åŒ…å«ä¸€ä¸ª index æˆå‘˜ï¼Œè¡¨ç¤ºè¯¥åˆ†åŒºåœ¨ RDD å†…çš„ç¼–å·ï¼Œé€šè¿‡ RDD  ç¼–å·+åˆ†åŒºç¼–å·å¯ä»¥ç¡®å®šè¯¥åˆ†åŒºå¯¹åº”çš„å”¯ä¸€å—ç¼–å·ï¼Œå†åˆ©ç”¨åº•å±‚æ•°æ®å­˜å‚¨å±‚æä¾›çš„æ¥å£å°±èƒ½ä»å­˜å‚¨ä»‹è´¨ï¼ˆå¦‚ï¼šHDFSã€Memoryï¼‰ä¸­æå–å‡ºåˆ†åŒºå¯¹åº”çš„æ•°æ®ã€‚</p><p>RDD çš„åˆ†åŒºæ–¹å¼ä¸»è¦åŒ…å«ä¸¤ç§ï¼šHash Partitioner å’Œ Range Partitionerï¼Œè¿™ä¸¤ç§åˆ†åŒºç±»å‹éƒ½æ˜¯é’ˆå¯¹ Key-Value ç±»å‹çš„æ•°æ®ï¼Œå¦‚æ˜¯é Key-Value ç±»å‹åˆ™åˆ†åŒºå‡½æ•°ä¸º Noneã€‚Hash æ˜¯ä»¥ Key ä½œä¸ºåˆ†åŒºæ¡ä»¶çš„æ•£åˆ—åˆ†å¸ƒï¼Œåˆ†åŒºæ•°æ®ä¸è¿ç»­ï¼Œæç«¯æƒ…å†µä¹Ÿå¯èƒ½æ•£åˆ—åˆ°å°‘æ•°å‡ ä¸ªåˆ†åŒºä¸Šå¯¼è‡´æ•°æ®ä¸å‡ç­‰ï¼›Range æŒ‰ Key çš„æ’åºå¹³è¡¡åˆ†å¸ƒï¼Œåˆ†åŒºå†…æ•°æ®è¿ç»­ï¼Œå¤§å°ä¹Ÿç›¸å¯¹å‡ç­‰ã€‚</p><p><b>Preferred Location</b> æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ª Partition çš„ä¼˜å…ˆä½ç½®ã€‚å¯¹äºæ¯ä¸ª HDFS æ–‡ä»¶æ¥è¯´ï¼Œè¿™ä¸ªåˆ—è¡¨ä¿å­˜çš„æ˜¯æ¯ä¸ª Partition æ‰€åœ¨çš„å—çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯¥æ–‡ä»¶çš„ã€Œåˆ’åˆ†ç‚¹ã€ã€‚</p><p><b>Storage Level </b>æ˜¯ RDD æŒä¹…åŒ–çš„å­˜å‚¨çº§åˆ«ï¼ŒRDD æŒä¹…åŒ–å¯ä»¥è°ƒç”¨ä¸¤ç§æ–¹æ³•ï¼šcache å’Œ persistï¼špersist æ–¹æ³•å¯ä»¥è‡ªç”±çš„è®¾ç½®å­˜å‚¨çº§åˆ«ï¼Œé»˜è®¤æ˜¯æŒä¹…åŒ–åˆ°å†…å­˜ï¼›cache æ–¹æ³•æ˜¯å°† RDD æŒä¹…åŒ–åˆ°å†…å­˜ï¼Œcache çš„å†…éƒ¨å®é™…ä¸Šæ˜¯è°ƒç”¨äº†persist æ–¹æ³•ï¼Œç”±äºæ²¡æœ‰å¼€æ”¾å­˜å‚¨çº§åˆ«çš„å‚æ•°è®¾ç½®ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥æŒä¹…åŒ–åˆ°å†…å­˜ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4811ef4ac9dc7e33b49990b9f9da105e_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"806\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-4811ef4ac9dc7e33b49990b9f9da105e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;806&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"806\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-4811ef4ac9dc7e33b49990b9f9da105e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-4811ef4ac9dc7e33b49990b9f9da105e_b.jpg\"/><figcaption>å›¾ 2</figcaption></figure><p>å¦‚å›¾ 2 æ‰€ç¤ºæ˜¯ Storage Level å„çº§åˆ«åˆ†å¸ƒï¼Œé‚£ä¹ˆå¦‚ä½•é€‰æ‹©ä¸€ç§æœ€åˆé€‚çš„æŒä¹…åŒ–ç­–ç•¥å‘¢ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œæ€§èƒ½æœ€é«˜çš„å½“ç„¶æ˜¯ MEMORY_ONLYï¼Œä½†å‰ææ˜¯ä½ çš„å†…å­˜å¿…é¡»è¶³å¤Ÿå¤§åˆ°å¯ä»¥ç»°ç»°æœ‰ä½™åœ°å­˜æ”¾ä¸‹æ•´ä¸ª RDD çš„æ‰€æœ‰æ•°æ®ã€‚å› ä¸ºä¸è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ“ä½œï¼Œå°±é¿å…äº†è¿™éƒ¨åˆ†çš„æ€§èƒ½å¼€é”€ï¼›å¯¹è¿™ä¸ªRDDçš„åç»­ç®—å­æ“ä½œï¼Œéƒ½æ˜¯åŸºäºçº¯å†…å­˜ä¸­çš„æ•°æ®çš„æ“ä½œï¼Œä¸éœ€è¦ä»ç£ç›˜æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæ€§èƒ½ä¹Ÿå¾ˆé«˜ï¼›è€Œä¸”ä¸éœ€è¦å¤åˆ¶ä¸€ä»½æ•°æ®å‰¯æœ¬ï¼Œå¹¶è¿œç¨‹ä¼ é€åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚ä½†æ˜¯è¿™é‡Œå¿…é¡»è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œææ€•èƒ½å¤Ÿç›´æ¥ç”¨è¿™ç§ç­–ç•¥çš„åœºæ™¯è¿˜æ˜¯æœ‰é™çš„ï¼Œå¦‚æœ RDD ä¸­æ•°æ®æ¯”è¾ƒå¤šæ—¶ï¼ˆæ¯”å¦‚å‡ åäº¿ï¼‰ï¼Œç›´æ¥ç”¨è¿™ç§æŒä¹…åŒ–çº§åˆ«ï¼Œä¼šå¯¼è‡´ JVM çš„ OOM å†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p><p>å¦‚æœä½¿ç”¨ MEMORY_ONLY çº§åˆ«æ—¶å‘ç”Ÿäº†å†…å­˜æº¢å‡ºï¼Œé‚£ä¹ˆå»ºè®®å°è¯•ä½¿ç”¨ MEMORY_ONLY_SER çº§åˆ«ã€‚è¯¥çº§åˆ«ä¼šå°† RDD æ•°æ®åºåˆ—åŒ–åå†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ­¤æ—¶æ¯ä¸ª partition ä»…ä»…æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„è€Œå·²ï¼Œå¤§å¤§å‡å°‘äº†å¯¹è±¡æ•°é‡ï¼Œå¹¶é™ä½äº†å†…å­˜å ç”¨ã€‚è¿™ç§çº§åˆ«æ¯” MEMORY_ONLY å¤šå‡ºæ¥çš„æ€§èƒ½å¼€é”€ä¸»è¦å°±æ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å¼€é”€ï¼Œä½†æ˜¯åç»­ç®—å­å¯ä»¥åŸºäºçº¯å†…å­˜è¿›è¡Œæ“ä½œï¼Œå› æ­¤æ€§èƒ½æ€»ä½“è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚ä½†å¯èƒ½å‘ç”Ÿ OOM  å†…å­˜æº¢å‡ºçš„å¼‚å¸¸ã€‚</p><p>å¦‚æœçº¯å†…å­˜çš„çº§åˆ«éƒ½æ— æ³•ä½¿ç”¨ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ MEMORY_AND_DISK_SER ç­–ç•¥ï¼Œè€Œä¸æ˜¯ MEMORY_AND_DISK ç­–ç•¥ã€‚å› ä¸ºæ—¢ç„¶åˆ°äº†è¿™ä¸€æ­¥ï¼Œå°±è¯´æ˜ RDD çš„æ•°æ®é‡å¾ˆå¤§ï¼Œå†…å­˜æ— æ³•å®Œå…¨æ”¾ä¸‹ï¼Œåºåˆ—åŒ–åçš„æ•°æ®æ¯”è¾ƒå°‘ï¼Œå¯ä»¥èŠ‚çœå†…å­˜å’Œç£ç›˜çš„ç©ºé—´å¼€é”€ã€‚åŒæ—¶è¯¥ç­–ç•¥ä¼šä¼˜å…ˆå°½é‡å°è¯•å°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜ç¼“å­˜ä¸ä¸‹æ‰ä¼šå†™å…¥ç£ç›˜ã€‚</p><p>é€šå¸¸ä¸å»ºè®®ä½¿ç”¨ DISK_ONLY å’Œåç¼€ä¸º_2 çš„çº§åˆ«ï¼šå› ä¸ºå®Œå…¨åŸºäºç£ç›˜æ–‡ä»¶è¿›è¡Œæ•°æ®çš„è¯»å†™ï¼Œä¼šå¯¼è‡´æ€§èƒ½æ€¥å‰§é™ä½ã€‚åç¼€ä¸º_2çš„çº§åˆ«ï¼Œå¿…é¡»å°†æ‰€æœ‰æ•°æ®éƒ½å¤åˆ¶ä¸€ä»½å‰¯æœ¬ï¼Œå¹¶å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œæ•°æ®å¤åˆ¶ä»¥åŠç½‘ç»œä¼ è¾“ä¼šå¯¼è‡´è¾ƒå¤§çš„æ€§èƒ½å¼€é”€ã€‚</p><p><b>Checkpoint </b>æ˜¯ Spark æä¾›çš„ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œå½“éœ€è¦è®¡ç®—ä¾èµ–é“¾éå¸¸é•¿åˆæƒ³é¿å…é‡æ–°è®¡ç®—ä¹‹å‰çš„ RDD æ—¶ï¼Œå¯ä»¥å¯¹ RDD åš Checkpoint å¤„ç†ï¼Œæ£€æŸ¥ RDD æ˜¯å¦è¢«ç‰©åŒ–æˆ–è®¡ç®—ï¼Œå¹¶å°†ç»“æœæŒä¹…åŒ–åˆ°ç£ç›˜æˆ– HDFS å†…ã€‚Checkpoint ä¼šæŠŠå½“å‰ RDD ä¿å­˜åˆ°ä¸€ä¸ªç›®å½•ï¼Œè¦è§¦å‘ action æ“ä½œçš„æ—¶å€™å®ƒæ‰ä¼šæ‰§è¡Œã€‚åœ¨ Checkpoint åº”è¯¥å…ˆåšæŒä¹…åŒ–ï¼ˆpersist æˆ–è€… cacheï¼‰æ“ä½œï¼Œå¦åˆ™å°±è¦é‡æ–°è®¡ç®—ä¸€éã€‚è‹¥æŸä¸ª RDD æˆåŠŸæ‰§è¡Œ checkpointï¼Œå®ƒå‰é¢çš„æ‰€æœ‰ä¾èµ–é“¾ä¼šè¢«é”€æ¯ã€‚</p><p>ä¸ Spark æä¾›çš„å¦ä¸€ç§ç¼“å­˜æœºåˆ¶ cache ç›¸æ¯”ï¼šcache ç¼“å­˜æ•°æ®ç”± executor ç®¡ç†ï¼Œè‹¥ executor æ¶ˆå¤±ï¼Œå®ƒçš„æ•°æ®å°†è¢«æ¸…é™¤ï¼ŒRDD éœ€è¦é‡æ–°è®¡ç®—ï¼›è€Œ checkpoint å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æˆ– HDFS å†…ï¼Œjob å¯ä»¥ä» checkpoint ç‚¹ç»§ç»­è®¡ç®—ã€‚Spark æä¾›äº† rdd.persist(StorageLevel.DISK_ONLY) è¿™æ ·çš„æ–¹æ³•ï¼Œç›¸å½“äº cache åˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·å¯ä»¥ä½¿ RDD ç¬¬ä¸€æ¬¡è¢«è®¡ç®—å¾—åˆ°æ—¶å°±å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼špersist è™½ç„¶å¯ä»¥å°† RDD çš„ partition æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä½†ä¸€æ—¦ä½œä¸šæ‰§è¡Œç»“æŸï¼Œè¢« cache åˆ°ç£ç›˜ä¸Šçš„ RDD ä¼šè¢«æ¸…ç©ºï¼›è€Œ checkpoint å°† RDD æŒä¹…åŒ–åˆ° HDFS æˆ–æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œå¦‚æœä¸è¢«æ‰‹åŠ¨ remove æ‰ï¼Œæ˜¯ä¸€ç›´å­˜åœ¨çš„ã€‚</p><p><b>Compute</b> å‡½æ•°å®ç°æ–¹å¼å°±æ˜¯å‘ä¸Šé€’å½’ã€Œè·å–çˆ¶ RDD åˆ†åŒºæ•°æ®è¿›è¡Œè®¡ç®—ã€ï¼Œç›´åˆ°é‡åˆ°æ£€æŸ¥ç‚¹ RDD è·å–æœ‰ç¼“å­˜çš„ RDDã€‚</p><p><b>Iterator</b> ç”¨æ¥æŸ¥æ‰¾å½“å‰ RDD Partition ä¸çˆ¶ RDD ä¸­ Partition çš„è¡€ç¼˜å…³ç³»ï¼Œå¹¶é€šè¿‡ Storage Level ç¡®å®šè¿­ä»£ä½ç½®ï¼Œç›´åˆ°ç¡®å®šçœŸå®æ•°æ®çš„ä½ç½®ã€‚å®ƒçš„å®ç°æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>è‹¥æ ‡è®°äº†æœ‰ç¼“å­˜ï¼Œåˆ™å–ç¼“å­˜ï¼Œå–ä¸åˆ°åˆ™è¿›è¡Œ computeOrReadCheckpoint(è®¡ç®—æˆ–è¯»æ£€æŸ¥ç‚¹)ã€‚å®Œäº†å†å­˜å…¥ç¼“å­˜ï¼Œä»¥å¤‡åç»­ä½¿ç”¨ã€‚ </li><li>è‹¥æœªæ ‡è®°æœ‰ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿›è¡Œ computeOrReadCheckpointã€‚ </li><li>computeOrReadCheckpoint è¿™ä¸ªè¿‡ç¨‹ä¹Ÿåšä¸¤ä¸ªåˆ¤æ–­ï¼šæœ‰åšè¿‡ checkpoint å’Œæ²¡æœ‰åšè¿‡ checkpointï¼Œåšè¿‡ checkpoint åˆ™å¯ä»¥è¯»å–åˆ°æ£€æŸ¥ç‚¹æ•°æ®è¿”å›ï¼Œæ²¡åšè¿‡åˆ™è°ƒè¯¥ RDD çš„å®ç°ç±»çš„ compute å‡½æ•°è®¡ç®—ã€‚</li></ul><p><b>è¡€ç»Ÿå…³ç³»</b></p><p>ä¸€ä¸ªä½œä¸šä»å¼€å§‹åˆ°ç»“æŸçš„è®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿäº†å¤šä¸ª RDDï¼ŒRDD ä¹‹é—´æ˜¯å½¼æ­¤ç›¸äº’ä¾èµ–çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ç§çˆ¶å­ä¾èµ–çš„å…³ç³»ç§°ä¹‹ä¸ºã€Œè¡€ç»Ÿã€ã€‚</p><p>RDD åªæ”¯æŒç²—é¢—ç²’å˜æ¢ï¼Œå³åªè®°å½•å•ä¸ªå—ï¼ˆåˆ†åŒºï¼‰ä¸Šæ‰§è¡Œçš„å•ä¸ªæ“ä½œï¼Œç„¶ååˆ›å»ºæŸä¸ª RDD çš„å˜æ¢åºåˆ—ï¼ˆè¡€ç»Ÿ lineageï¼‰å­˜å‚¨ä¸‹æ¥ã€‚</p><p>*å˜æ¢åºåˆ—æŒ‡æ¯ä¸ª RDD éƒ½åŒ…å«äº†å®ƒæ˜¯å¦‚ä½•ç”±å…¶ä»– RDD å˜æ¢è¿‡æ¥çš„ä»¥åŠå¦‚ä½•é‡å»ºæŸä¸€å—æ•°æ®çš„ä¿¡æ¯ã€‚</p><p>å› æ­¤ RDD çš„å®¹é”™æœºåˆ¶åˆç§°ã€Œè¡€ç»Ÿã€å®¹é”™ã€‚ è¦å®ç°è¿™ç§ã€Œè¡€ç»Ÿã€å®¹é”™æœºåˆ¶ï¼Œæœ€å¤§çš„éš¾é¢˜å°±æ˜¯å¦‚ä½•è¡¨è¾¾çˆ¶ RDD å’Œå­ RDD ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c77f3d4c8009d06c103a9a6518355d43_b.jpg\" data-size=\"normal\" data-rawwidth=\"768\" data-rawheight=\"546\" class=\"origin_image zh-lightbox-thumb\" width=\"768\" data-original=\"https://pic4.zhimg.com/v2-c77f3d4c8009d06c103a9a6518355d43_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;768&#39; height=&#39;546&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"768\" data-rawheight=\"546\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"768\" data-original=\"https://pic4.zhimg.com/v2-c77f3d4c8009d06c103a9a6518355d43_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-c77f3d4c8009d06c103a9a6518355d43_b.jpg\"/><figcaption>å›¾ 3</figcaption></figure><p>å¦‚å›¾ 3 æ‰€ç¤ºï¼Œçˆ¶ RDD çš„æ¯ä¸ªåˆ†åŒºæœ€å¤šåªèƒ½è¢«å­ RDD çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨ï¼Œç§°ä¸ºçª„ä¾èµ–ï¼ˆnarrow dependencyï¼‰ï¼›è‹¥çˆ¶ RDD çš„æ¯ä¸ªåˆ†åŒºå¯ä»¥è¢«å­ RDD çš„å¤šä¸ªåˆ†åŒºä½¿ç”¨ï¼Œç§°ä¸ºå®½ä¾èµ–ï¼ˆwide dependencyï¼‰ã€‚ç®€å•æ¥è®²ï¼Œçª„ä¾èµ–å°±æ˜¯çˆ¶å­RDDåˆ†åŒºé—´ã€Œä¸€å¯¹ä¸€ã€çš„å…³ç³»ï¼Œè€Œå®½ä¾èµ–å°±æ˜¯ã€Œä¸€å¯¹å¤šã€å…³ç³»ã€‚ä»å¤±è´¥æ¢å¤æ¥çœ‹ï¼Œçª„ä¾èµ–çš„å¤±è´¥æ¢å¤èµ·æ¥æ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒåªéœ€æ‰¾åˆ°çˆ¶ RDD çš„ä¸€ä¸ªå¯¹åº”åˆ†åŒºå³å¯ï¼Œè€Œä¸”å¯ä»¥åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šå¹¶è¡Œè®¡ç®—åšæ¢å¤ï¼›å®½ä¾èµ–ç‰µæ¶‰åˆ°çˆ¶ RDD çš„å¤šä¸ªåˆ†åŒºï¼Œéœ€è¦å¾—åˆ°æ‰€æœ‰ä¾èµ–çš„çˆ¶ RDD åˆ†åŒºçš„ shuffle ç»“æœï¼Œæ¢å¤èµ·æ¥ç›¸å¯¹å¤æ‚äº›ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b74c2d7a9e35f76d68fb677b0c8ce907_b.jpg\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"546\" class=\"origin_image zh-lightbox-thumb\" width=\"700\" data-original=\"https://pic4.zhimg.com/v2-b74c2d7a9e35f76d68fb677b0c8ce907_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;700&#39; height=&#39;546&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"546\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"700\" data-original=\"https://pic4.zhimg.com/v2-b74c2d7a9e35f76d68fb677b0c8ce907_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b74c2d7a9e35f76d68fb677b0c8ce907_b.jpg\"/><figcaption>å›¾ 4</figcaption></figure><p>æ ¹æ® RDD ä¹‹é—´çš„å®½çª„ä¾èµ–å…³ç³»å¼•ç”³å‡º Stage çš„æ¦‚å¿µï¼ŒStage æ˜¯ç”±ä¸€ç»„ RDD ç»„æˆçš„æ‰§è¡Œè®¡åˆ’ã€‚å¦‚æœ RDD çš„è¡ç”Ÿå…³ç³»éƒ½æ˜¯çª„ä¾èµ–ï¼Œåˆ™å¯æ”¾åœ¨åŒä¸€ä¸ª Stage ä¸­è¿è¡Œï¼Œè‹¥ RDD çš„ä¾èµ–å…³ç³»ä¸ºå®½ä¾èµ–ï¼Œåˆ™è¦åˆ’åˆ†åˆ°ä¸åŒçš„ Stageã€‚è¿™æ · Spark åœ¨æ‰§è¡Œä½œä¸šæ—¶ï¼Œä¼šæŒ‰ç…§ Stage çš„åˆ’åˆ†, ç”Ÿæˆä¸€ä¸ªæœ€ä¼˜ã€å®Œæ•´çš„æ‰§è¡Œè®¡åˆ’ã€‚<br/></p><h2><b>RDD çš„åˆ›å»ºæ–¹å¼ä¸åˆ†åŒºæœºåˆ¶</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p><b>RDD çš„åˆ›å»ºæ–¹å¼</b></p><p>RDD çš„åˆ›å»ºæ–¹å¼æœ‰å››ç§ï¼š</p><p><b>1.ä½¿ç”¨ç¨‹åºä¸­çš„é›†åˆåˆ›å»º RDD</b>ï¼ŒRDD çš„æ•°æ®æºæ˜¯ç¨‹åºä¸­çš„é›†åˆï¼Œé€šè¿‡ parallelize æˆ–è€… makeRDD å°†é›†åˆè½¬åŒ–ä¸º RDDï¼›</p><p>*ä¾‹</p><div class=\"highlight\"><pre><code class=\"language-text\">val num = Array(1,2,3,4,5)\n\nval rdd = sc.parallelize(num)</code></pre></div><p><b>2.ä½¿ç”¨æœ¬åœ°æ–‡ä»¶æˆ– HDFS åˆ›å»º RD</b>Dï¼ŒRDD çš„æ•°æ®æºæ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæˆ– HDFS çš„æ•°æ®ï¼Œä½¿ç”¨ textFile æ–¹æ³•åˆ›å»ºRDDã€‚</p><p>*ä¾‹</p><div class=\"highlight\"><pre><code class=\"language-text\">val rdd = sc.textFile(â€œhdfs://master:9000/rec/dataâ€)</code></pre></div><p><b>3.ä½¿ç”¨æ•°æ®æµåˆ›å»º RDD</b>ï¼Œä½¿ç”¨ Spark Streaming çš„ç›¸å…³ç±»ï¼Œæ¥æ”¶å®æ—¶çš„è¾“å…¥æ•°æ®æµåˆ›å»º RDDï¼ˆæ•°æ®æµæ¥æºå¯ä»¥æ˜¯ kafkaã€flume ç­‰ï¼‰ã€‚</p><p>*ä¾‹</p><div class=\"highlight\"><pre><code class=\"language-text\">val ssc = new StreamingContext(conf, Seconds(1))\n\nval lines = ssc.socketTextStream(â€œlocalhostâ€, 9999)\n\nval words = lines.flatMap(_.split(â€œ â€))</code></pre></div><p><b>4.ä½¿ç”¨å…¶ä»–æ–¹å¼åˆ›å»º RDD</b>ï¼Œä»å…¶ä»–æ•°æ®åº“ä¸Šåˆ›å»º RDDï¼Œä¾‹å¦‚ Hbaseã€MySQL ç­‰ã€‚</p><p>*ä¾‹</p><div class=\"highlight\"><pre><code class=\"language-text\">val sqlContext = new SQLContext(sc)\n\nval url = &#34;jdbc:mysql://ip:port/xxxx&#34;\n\nval prop = new Properties()\n\nval df = sqlContext.read.jdbc(url, â€œplay_timeâ€, prop)</code></pre></div><p><b>RDD çš„åˆ†åŒºæœºåˆ¶</b></p><p>RDD çš„åˆ†åŒºæœºåˆ¶æœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼šä¸€ä¸ªæ˜¯å…³é”®å‚æ•°ï¼Œå³ Spark çš„é»˜è®¤å¹¶å‘æ•° spark.default.parallelismï¼›å¦ä¸€ä¸ªæ˜¯å…³é”®åŸåˆ™ï¼ŒRDD åˆ†åŒºå°½å¯èƒ½ä½¿å¾—åˆ†åŒºçš„ä¸ªæ•°ç­‰äºé›†ç¾¤æ ¸å¿ƒæ•°ç›®ã€‚</p><p>å½“é…ç½®æ–‡ä»¶ spark-default.conf ä¸­æ˜¾å¼é…ç½®äº† spark.default.parallelismï¼Œé‚£ä¹ˆ spark.default.parallelism=é…ç½®çš„å€¼ï¼Œå¦åˆ™æŒ‰ç…§å¦‚ä¸‹è§„åˆ™è¿›è¡Œå–å€¼ï¼š</p><p><b>1.æœ¬åœ°æ¨¡å¼</b>ï¼ˆä¸ä¼šå¯åŠ¨ executorï¼Œç”± SparkSubmit è¿›ç¨‹ç”ŸæˆæŒ‡å®šæ•°é‡çš„çº¿ç¨‹æ•°æ¥å¹¶å‘ï¼‰</p><blockquote>spark-shell       spark.default.parallelism = 1<br/>spark-shell --master local[N] spark.default.parallelism = N ï¼ˆä½¿ç”¨ N ä¸ªæ ¸ï¼‰<br/>spark-shell --master local       spark.default.parallelism = 1</blockquote><p><b>2.ä¼ªé›†ç¾¤æ¨¡å¼</b>ï¼ˆx ä¸ºæœ¬æœºä¸Šå¯åŠ¨çš„ executor æ•°ï¼Œy ä¸ºæ¯ä¸ª executor ä½¿ç”¨çš„ core æ•°ï¼Œz ä¸ºæ¯ä¸ª executor ä½¿ç”¨çš„å†…å­˜ï¼‰</p><blockquote>spark-shell --master local-cluster[x,y,z] spark.default.parallelism = x * y</blockquote><p><b>3.Yarnã€standalone ç­‰æ¨¡å¼</b><br/></p><blockquote>spark.default.parallelism = max(æ‰€æœ‰ executor ä½¿ç”¨çš„ core æ€»æ•°ï¼Œ2)</blockquote><p><b>4.Mesos</b><br/></p><blockquote>spark.default.parallelism = 8</blockquote><p>spark.context ä¼šç”Ÿæˆä¸¤ä¸ªå‚æ•°ï¼Œç”± spark.default.parallelism æ¨å¯¼å‡ºè¿™ä¸¤ä¸ªå‚æ•°çš„å€¼ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">sc.defaultParallelism     = spark.default.parallelism\n\nsc.defaultMinPartitions  = min(spark.default.parallelism, 2)</code></pre></div><p>å½“ sc.defaultParallelism å’Œ sc.defaultMinPartitions ç¡®è®¤åï¼Œå°±å¯ä»¥æ¨ç®— RDD çš„åˆ†åŒºæ•°äº†ã€‚</p><ul><li>ä»¥ parallelize æ–¹æ³•ä¸ºä¾‹</li></ul><div class=\"highlight\"><pre><code class=\"language-text\">val rdd = sc.parallelize(1 to 10)</code></pre></div><p>å¦‚æœä½¿ç”¨ parallelize æ–¹æ³•æ—¶æ²¡æŒ‡å®šåˆ†åŒºæ•°ï¼Œ RDD çš„åˆ†åŒºæ•° = sc.defaultParallelism</p><ul><li>ä»¥ textFile æ–¹æ³•ä¸ºä¾‹</li></ul><div class=\"highlight\"><pre><code class=\"language-text\">val rdd = sc.textFile(â€œpath/fileâ€)</code></pre></div><p>åˆ†åŒºæœºåˆ¶åˆ†ä¸¤ç§æƒ…å†µï¼š</p><p>1.ä»æœ¬åœ°æ–‡ä»¶ç”Ÿæˆçš„ RDDï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤åˆ†åŒºæ•°è§„åˆ™ä¸º</p><blockquote>rdd çš„åˆ†åŒºæ•° = maxï¼ˆæœ¬åœ° file çš„åˆ†ç‰‡æ•°ï¼Œ sc.defaultMinPartitionsï¼‰</blockquote><p>2.ä» HDFS ç”Ÿæˆçš„ RDDï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤åˆ†åŒºæ•°è§„åˆ™ä¸ºï¼š</p><blockquote>rdd çš„åˆ†åŒºæ•° = maxï¼ˆhdfs æ–‡ä»¶çš„ block æ•°ç›®ï¼Œ sc.defaultMinPartitionsï¼‰</blockquote><h2><br/><b> RDD çš„å¸¸ç”¨æ“ä½œ </b></h2><p>RDD æ”¯æŒä¸¤ç§ç±»å‹çš„æ“ä½œï¼šè½¬æ¢ï¼ˆTransformationï¼‰å’ŒåŠ¨ä½œï¼ˆActionï¼‰ï¼Œè½¬æ¢æ“ä½œæ˜¯ä»å·²ç»å­˜åœ¨çš„æ•°æ®é›†ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè€ŒåŠ¨ä½œæ“ä½œæ˜¯åœ¨æ•°æ®é›†ä¸Šè¿›è¡Œè®¡ç®—åè¿”å›ç»“æœåˆ° Driverï¼Œæ—¢è§¦å‘ SparkContext æäº¤ Job ä½œä¸šã€‚è½¬æ¢æ“ä½œéƒ½å…·æœ‰ Lazy ç‰¹æ€§ï¼Œå³ Spark ä¸ä¼šç«‹åˆ»è¿›è¡Œå®é™…çš„è®¡ç®—ï¼Œåªä¼šè®°å½•æ‰§è¡Œçš„è½¨è¿¹ï¼Œåªæœ‰è§¦å‘è¡ŒåŠ¨æ“ä½œçš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šæ ¹æ® DAG å›¾çœŸæ­£æ‰§è¡Œã€‚</p><p>è½¬æ¢ä¸åŠ¨ä½œå…·ä½“åŒ…å«çš„æ“ä½œç§ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-0080758bf372c68bbc7cc9ff0c107578_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"653\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-0080758bf372c68bbc7cc9ff0c107578_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;653&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"653\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-0080758bf372c68bbc7cc9ff0c107578_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-0080758bf372c68bbc7cc9ff0c107578_b.jpg\"/><figcaption>å›¾ 5:è½¬æ¢æ“ä½œ</figcaption></figure><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e8a0367cc4af176d676bbe676906ca0f_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"544\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-e8a0367cc4af176d676bbe676906ca0f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;544&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"544\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-e8a0367cc4af176d676bbe676906ca0f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-e8a0367cc4af176d676bbe676906ca0f_b.jpg\"/><figcaption>å›¾ 6ï¼šåŠ¨ä½œæ“ä½œ</figcaption></figure><p>æœ€åæˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥çœ‹çœ‹å®ƒå…·ä½“çš„æ“ä½œï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4e9995a395bcadba3e0d2d5ae37b3966_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-4e9995a395bcadba3e0d2d5ae37b3966_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;561&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-4e9995a395bcadba3e0d2d5ae37b3966_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-4e9995a395bcadba3e0d2d5ae37b3966_b.jpg\"/></figure><p>è¿™æ®µä»£ç æ˜¯ç”¨æ¥è®¡ç®—æŸä¸ªè§†é¢‘è¢«ç”·æ€§æˆ–å¥³æ€§ç”¨æˆ·çš„æ’­æ”¾æ¬¡æ•°ï¼Œå…¶ä¸­ rdd_attr ç”¨æ¥è®°å½•ç”¨æˆ·æ€§åˆ«ï¼Œrdd_src æ˜¯ç”¨æˆ·å¯¹æŸä¸ªè§†é¢‘è¿›è¡Œæ’­æ”¾çš„è®°å½•ï¼Œè¿™ä¸¤ä¸ª RDD ä¼šè¿›è¡Œä¸€ä¸ª join æ“ä½œï¼Œæ¯”å¦‚è¿™æ˜¯æŸä¸ªç”·æ€§ç”¨æˆ·å¯¹æŸä¸ªè§†é¢‘è¿›è¡Œäº†æ’­æ”¾ï¼Œè¿›è¡Œ map æ“ä½œä¹‹åå¾—åˆ°è§†é¢‘ id å’Œæ€§åˆ«ä½œä¸º keyï¼Œæ ¹æ®è¿™ä¸ª key åš reduceByKey çš„æ“ä½œï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªè§†é¢‘è¢«ç”·æ€§/å¥³æ€§ç”¨æˆ·æ€»å…±æ’­æ”¾äº†å¤šå°‘æ¬¡çš„ RDDï¼Œç„¶åä½¿ç”¨ combineByKey åˆå¹¶åŒä¸€ä¸ªè§†é¢‘ id çš„å¤šä¸ªç»“æœï¼Œæœ€åä¿å­˜åˆ° HDFS ä¸Šã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>é™„ï¼šå‚è€ƒæ–‡ç« </b></p><blockquote>ã€ŠSparkä¹‹æ·±å…¥ç†è§£RDDç»“æ„ã€‹<br/><a href=\"https://link.zhihu.com/?target=https%3A//blog.csdn.net/u011094454/article/details/78992293\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">blog.csdn.net/u01109445</span><span class=\"invisible\">4/article/details/78992293</span><span class=\"ellipsis\"></span></a><br/>ã€ŠRDDçš„æ•°æ®ç»“æ„æ¨¡å‹ã€‹<br/><a href=\"https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/dd7c7243e7f9%3Ffrom%3Dsinglemessage\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://www.</span><span class=\"visible\">jianshu.com/p/dd7c7243e</span><span class=\"invisible\">7f9?from=singlemessage</span><span class=\"ellipsis\"></span></a><br/>ã€ŠSpark RDDè¯¦è§£ã€‹<br/><a href=\"https://link.zhihu.com/?target=https%3A//blog.csdn.net/wangxiaotongfan/article/details/51395769\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">blog.csdn.net/wangxiaot</span><span class=\"invisible\">ongfan/article/details/51395769</span><span class=\"ellipsis\"></span></a><br/>ã€ŠSpark RDDçš„é»˜è®¤åˆ†åŒºæ•°ï¼šï¼ˆspark 2.1.0ï¼‰ã€‹<br/><a href=\"https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/4b7d07e754fa\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://www.</span><span class=\"visible\">jianshu.com/p/4b7d07e75</span><span class=\"invisible\">4fa</span><span class=\"ellipsis\"></span></a><br/>ã€ŠSparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”åŸºç¡€ç¯‡ã€‹<br/><a href=\"https://link.zhihu.com/?target=https%3A//tech.meituan.com/spark_tuning_basic.html\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">tech.meituan.com/spark_</span><span class=\"invisible\">tuning_basic.html</span><span class=\"ellipsis\"></span></a></blockquote>", 
            "topic": [
                {
                    "tag": "MapReduce", 
                    "tagLink": "https://api.zhihu.com/topics/19621083"
                }, 
                {
                    "tag": "Spark", 
                    "tagLink": "https://api.zhihu.com/topics/19942170"
                }, 
                {
                    "tag": "Hadoop", 
                    "tagLink": "https://api.zhihu.com/topics/19563390"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/41151457", 
            "userName": "MTé…±", 
            "userLink": "https://www.zhihu.com/people/28629950b8d6033df6b6f33fd0280e2a", 
            "upvote": 11, 
            "title": "Spark on Yarn", 
            "content": "<p>æ¬¢è¿é˜…è¯»ç¾å›¾æ•°æ®æŠ€æœ¯å›¢é˜Ÿçš„ã€ŒSparkï¼Œä»å…¥é—¨åˆ°ç²¾é€šã€ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« å°†ç”±æµ…å…¥æ·±ä¸ºå¤§å®¶ä»‹ç» Sparkï¼Œä»æ¡†æ¶å…¥é—¨åˆ°åº•å±‚æ¶æ„çš„å®ç°ï¼Œç›¸ä¿¡æ€»æœ‰ä¸€ç§å§¿åŠ¿é€‚åˆä½ ï¼Œæ¬¢è¿å¤§å®¶æŒç»­å…³æ³¨ï¼šï¼‰</p><p>å¾€æœŸç›´é€šè½¦ï¼š<a href=\"https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzU5ODU5MjM2Mw%3D%3D%26mid%3D2247484147%26idx%3D2%26sn%3Dcca8dc960db221fb920bfb545d357ad9%26chksm%3Dfe409cf7c93715e1a2f76400f33e7b1e43b74d104bb73e2df5c2d66334708f2ab44affb32348%26scene%3D21%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Hello Spark! </a></p><h2><b>ä¸ºä»€ä¹ˆéœ€è¦ Yarnï¼Ÿ</b></h2><p>Yarn çš„å…¨ç§°æ˜¯ Yet Anther Resource Negotiatorï¼ˆå¦ä¸€ç§èµ„æºåå•†è€…ï¼‰ã€‚å®ƒä½œä¸º Hadoop çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®˜æ–¹å¯¹å®ƒçš„å®šä¹‰æ˜¯<b>ä¸€ä¸ªå·¥ä½œè°ƒåº¦å’Œé›†ç¾¤èµ„æºç®¡ç†çš„æ¡†æ¶</b>ã€‚</p><p>Yarn æœ€æ—©å‡ºç°äº Hadoop 0.23 åˆ†æ”¯ä¸­ï¼Œ0.23 åˆ†æ”¯æ˜¯ä¸€ä¸ªå®éªŒæ€§åˆ†æ”¯ï¼Œä¹‹åç»è¿‡äº†å‡ æ¬¡è¿­ä»£ï¼Œæœ€åå‘å¸ƒäº 2014 å¹´ 6 æœˆçš„ 0.23.11 ç‰ˆæœ¬(è¯¥åˆ†æ”¯çš„æœ€åä¸€ä¸ªç‰ˆæœ¬)ã€‚åœ¨ 0.23.0 å‘å¸ƒåä¸ä¹…çš„ 2011 å¹´ 12 æœˆï¼ŒHadoop çš„ 0.20 åˆ†æ”¯å‘å±•æˆäº† Hadoop1.0ï¼Œä¸€ç›´åˆ° 1.0 çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ 1.2.1-stable éƒ½æ²¡æœ‰å‡ºç° Yarn çš„èº«å½±ï¼Œè€Œåœ¨ Hadoop2.0 çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ 2.0.0-alphaï¼ŒYarn å·²ç»ä½œä¸ºä¸€ä¸ªæ­£å¼ç»„ä»¶åŠ å…¥ã€‚åœ¨ 2.0.2-alpha ç‰ˆæœ¬ï¼Œå®ƒå·²ç»æ”¯æŒäº† 2k å°æœºå™¨çš„é›†ç¾¤ï¼Œæ¥ç€åœ¨ 2.0.3-alpha ç‰ˆæœ¬ä¸­å·²ç»å¯ä»¥æ”¯æŒ 30k å°æœºå™¨çš„é›†ç¾¤ã€‚åœ¨ 2.0.3-alpha ç‰ˆæœ¬ä¸­åŒæ—¶è¿˜æ”¯æŒäº†å¤šç§èµ„æºï¼Œå¦‚ cpu&amp;memory çš„è°ƒåº¦å’Œ ResourceManager restartã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-9a05f0d8293b6fdb8fd26c121bbabafb_b.jpg\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"452\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic4.zhimg.com/v2-9a05f0d8293b6fdb8fd26c121bbabafb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;452&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"452\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic4.zhimg.com/v2-9a05f0d8293b6fdb8fd26c121bbabafb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-9a05f0d8293b6fdb8fd26c121bbabafb_b.jpg\"/><figcaption>å›¾ 1ï¼Œvia https://blog.csdn.net/suifeng3051/article/details/49364677</figcaption></figure><p>å¦‚å›¾ 1 æ‰€ç¤ºï¼Œ Hadoop1.0 çš„è¿ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><blockquote>1.å®¢æˆ·ç«¯æäº¤ä»»åŠ¡ç»™é›†ç¾¤ï¼›<br/>2.JobTracker æ¥æ”¶ Job è¯·æ±‚ï¼›<br/>3.JobTracker æ ¹æ® Job çš„è¾“å…¥å‚æ•°å‘ NameNode è¯·æ±‚åŒ…å«è¿™äº›æ–‡ä»¶æ•°æ®å—çš„ DataNode èŠ‚ç‚¹åˆ—è¡¨ï¼›<br/>4.JobTracker ç¡®å®š Job çš„æ‰§è¡Œè®¡åˆ’ï¼šç¡®è®¤ Mapã€Reduce çš„ Task æ•°é‡ï¼Œå¹¶åˆ†é… Task åˆ°ç¦»æ•°æ®å—æœ€è¿‘çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</blockquote><p>æœ€åˆï¼ŒHadoop1.0 èƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æ’‘å¤§æ•°æ®è®¡ç®—ï¼Œä½†æ˜¯éšç€è®¡ç®—è§„æ¨¡çš„æ‰©å¤§å’Œè®¡ç®—æ¨¡å‹çš„å¤šæ ·åŒ–ï¼Œå®ƒé€æ¸åŠ›ä¸ä»å¿ƒã€‚ä¼—æ‰€å‘¨çŸ¥å½“é›†ç¾¤æ€§èƒ½ä¸è¶³çš„æ—¶å€™å¯ä»¥ç®€å•ç²—æš´åœ°åŠ æœºå™¨ï¼Œä½† JobTracker åŒæ—¶éƒ¨ç½²å¤šä¸ªæ—¶åªæœ‰ä¸€ä¸ªæ˜¯å¤„äº active çŠ¶æ€ï¼Œå› æ­¤å—é™äºè¿™ä¸ª active JobTracker çš„è´Ÿè½½ä¸Šé™ï¼Œæ•´ä¸ªé›†ç¾¤èƒ½å¤Ÿå®¹çº³çš„æœºå™¨ä¹Ÿæœ‰é™ï¼Œæœ‰æ•°æ®æ˜¾ç¤ºæ•´ä¸ªé›†ç¾¤çš„ç®¡ç†ä¸Šé™çº¦ä¸º 4k å°æœºå™¨ã€‚åŒæ—¶åº”ç”¨ç¨‹åºç›¸å…³å’Œèµ„æºç®¡ç†ç›¸å…³çš„é€»è¾‘å…¨éƒ¨æ”¾åœ¨ JobTrackerä¸­ï¼Œå½“é›†ç¾¤è§„æ¨¡æ‰©å¤§çš„æ—¶å€™ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªç“¶é¢ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒMap-Reduce è®¡ç®—æ¨¡å‹ä¸ JobTracker çš„è€¦åˆè¿‡é«˜ï¼Œå…¶ä»–è®¡ç®—æ¨¡å‹éš¾ä»¥åœ¨ Hadoop1.0 ä¸Šè¿è¡Œã€‚</p><p>Yarn æ˜¯ Hadoop åŸºäºè¿™äº›é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥é€šè¿‡äº†è§£ Yarn çš„ç»„ä»¶ã€æ¶æ„ä»¥åŠè¿ä½œæœºåˆ¶æ¥åˆ†æ Yarn æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p><h2><b>Yarn æ˜¯ä»€ä¹ˆï¼Ÿ</b></h2><p><b>Yarn çš„ç»„ä»¶&amp;åŸºæœ¬æ¶æ„</b></p><p>å¦‚å›¾ 2 æ‰€ç¤º Yarn é‡‡ç”¨ Master/Slave ç»“æ„ï¼Œæ•´ä½“é‡‡ç”¨åŒå±‚è°ƒåº¦æ¶æ„ã€‚åœ¨ç¬¬ä¸€å±‚çš„è°ƒåº¦æ˜¯ ResourceManager å’Œ NodeManagerï¼šResourceManager æ˜¯ Master èŠ‚ç‚¹ï¼Œç›¸å½“äº JobTrackerï¼ŒåŒ…å« Scheduler å’ŒApp Manager ä¸¤ä¸ªç»„ä»¶ï¼Œåˆ†ç®¡èµ„æºè°ƒåº¦å’Œåº”ç”¨ç®¡ç†ï¼›NodeManager æ˜¯ Slave èŠ‚ç‚¹ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ç‹¬ç«‹çš„æœºå™¨ä¸Šï¼Œç”¨äºç®¡ç†æœºå™¨ä¸Šçš„èµ„æºã€‚NodeManager ä¼šå‘ ResourceManager æŠ¥å‘Šå®ƒçš„èµ„æºæ•°é‡ã€ä½¿ç”¨æƒ…å†µï¼Œå¹¶æ¥å— ResourceManager çš„èµ„æºè°ƒåº¦ã€‚</p><p>*ResourceManager åŒ JobTracker ä¸€æ ·å¯ä»¥å¤šæœºéƒ¨ç½²ï¼Œå¹¶ä¸”åªæœ‰ä¸€å°å¤„äº active çŠ¶æ€ã€‚ä½†æ˜¯åœ¨ ResourceManager ä¸­å°†è°ƒåº¦ç®¡ç†å’Œåº”ç”¨ç®¡ç†ä½œäº†æ‹†åˆ†ï¼Œä¸¤ä¸ªç»„ä»¶çš„åŠŸèƒ½æ›´ä¸“ä¸€ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-fe86a3a29c60321d7a2df62c5748a666_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"667\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-fe86a3a29c60321d7a2df62c5748a666_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;667&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"667\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-fe86a3a29c60321d7a2df62c5748a666_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-fe86a3a29c60321d7a2df62c5748a666_b.jpg\"/><figcaption>å›¾ 2</figcaption></figure><p>ç¬¬äºŒå±‚çš„è°ƒåº¦æŒ‡çš„æ˜¯ NodeManager å’Œ Containerã€‚NodeManager ä¼šå°† Cpu&amp;å†…å­˜ç­‰èµ„æºæŠ½è±¡æˆä¸€ä¸ªä¸ªçš„ Containerï¼Œå¹¶ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>é€šè¿‡é‡‡ç”¨åŒå±‚è°ƒåº¦ç»“æ„å°† Scheduler ç®¡ç†çš„èµ„æºç”±ç»†ç²’åº¦çš„ Cpu&amp;å†…å­˜å˜æˆäº†ç²—ç²’åº¦çš„ Containerï¼Œé™ä½äº†è´Ÿè½½ã€‚åœ¨ App Manager ç»„ä»¶ä¸­ä¹Ÿåªéœ€è¦ç®¡ç† App Masterï¼Œä¸éœ€è¦ç®¡ç†ä»»åŠ¡è°ƒåº¦æ‰§è¡Œçš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒæ ·é™ä½äº†è´Ÿè½½ã€‚é€šè¿‡é™ä½ ResourceManager çš„è´Ÿè½½ï¼Œå˜ç›¸åœ°æé«˜äº†é›†ç¾¤çš„æ‰©å±•æ€§ã€‚</p><p><b>Yarn è¿ä½œæµç¨‹</b></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-d0e4660fc4042cfc25a09b16c022bdf2_b.jpg\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic3.zhimg.com/v2-d0e4660fc4042cfc25a09b16c022bdf2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;356&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic3.zhimg.com/v2-d0e4660fc4042cfc25a09b16c022bdf2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-d0e4660fc4042cfc25a09b16c022bdf2_b.jpg\"/><figcaption>å›¾ 3ï¼Œvia https://blog.csdn.net/suifeng3051/article/details/49486927</figcaption></figure><p>å¦‚å›¾ 3 æ‰€ç¤º Yarn çš„è¿ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><blockquote>1.å®¢æˆ·ç«¯å‘ ResourceManager çš„ App Manager æäº¤åº”ç”¨å¹¶è¯·æ±‚ä¸€ä¸ª AppMaster å®ä¾‹ï¼›<br/>2.ResourceManager æ‰¾åˆ°å¯ä»¥è¿è¡Œä¸€ä¸ª Container çš„ NodeManagerï¼Œå¹¶åœ¨è¿™ä¸ª Container ä¸­å¯åŠ¨ AppMaster å®ä¾‹ï¼›<br/>3.App Master å‘ ResourceManager æ³¨å†Œï¼Œæ³¨å†Œä¹‹åï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æŸ¥è¯¢ ResourceManager è·å¾—è‡ªå·± App Master çš„è¯¦æƒ…ä»¥åŠç›´æ¥å’Œ App Master äº¤äº’ï¼›<br/>4.æ¥ç€ App Master å‘ Resource Manager è¯·æ±‚èµ„æºï¼Œå³ Containerï¼›<br/>5.è·å¾— Container åï¼ŒApp Master å¯åŠ¨ Containerï¼Œå¹¶æ‰§è¡Œ Taskï¼›<br/>6.Container æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæŠŠè¿è¡Œè¿›åº¦å’ŒçŠ¶æ€ç­‰ä¿¡æ¯å‘é€ç»™ AppMasterï¼›<br/>7.å®¢æˆ·ç«¯ä¸»åŠ¨å’Œ App Master äº¤æµåº”ç”¨çš„è¿è¡ŒçŠ¶æ€ã€è¿›åº¦æ›´æ–°ç­‰ä¿¡æ¯ï¼›<br/>8.æ‰€æœ‰å·¥ä½œå®Œæˆ App Master å‘ RM å–æ¶ˆæ³¨å†Œç„¶åå…³é—­ï¼ŒåŒæ—¶æ‰€æœ‰çš„ Container ä¹Ÿå½’è¿˜ç»™ç³»ç»Ÿã€‚</blockquote><p>é€šè¿‡è¿™ä¸ª Job çš„å¤„ç†è¿‡ç¨‹å¯ä»¥çœ‹åˆ° App Master æ˜¯ä½œä¸º Job çš„é©±åŠ¨è§’è‰²ï¼Œå®ƒé©±åŠ¨äº† Job ä»»åŠ¡çš„è°ƒåº¦æ‰§è¡Œã€‚åœ¨è¿™ä¸ªè¿ä½œæµç¨‹ä¸­ï¼ŒApp Manager åªéœ€è¦ç®¡ç† App Master çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠä¿å­˜å®ƒçš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œ App Master è¿™ä¸ªè§’è‰²çš„æŠ½è±¡ä½¿å¾—æ¯ç§ç±»å‹çš„åº”ç”¨éƒ½å¯ä»¥å®šåˆ¶è‡ªå·±çš„ App Masterï¼Œè¿™æ ·å…¶ä»–çš„è®¡ç®—æ¨¡å‹å°±å¯ä»¥ç›¸å¯¹å®¹æ˜“åœ°è¿è¡Œåœ¨ Yarn é›†ç¾¤ä¸Šã€‚</p><p><b>Yarn HAï¼ˆå®¹ç¾å¤‡æ´ï¼‰</b></p><p>æ¥ä¸‹æ¥ä»‹ç»çš„æ˜¯ Yarn é›†ç¾¤é«˜å¯ç”¨ä¸­å…³äºå®¹é”™å¤‡æ´çš„è®¾è®¡ã€‚æ ¹æ®å›¾ 3 æ‰€ç¤ºçš„ Yarn æ¶æ„å›¾ï¼Œå‡å¦‚ Container æ•…éšœ Resource Manager å¯ä»¥åˆ†é…å…¶ä»–çš„ Container ç»§ç»­æ‰§è¡Œï¼Œå½“è¿è¡Œ App Master çš„ Container æ•…éšœåä¹Ÿå°†åˆ†é…æ–°çš„ Containerï¼ŒApp Master å¯ä»¥ä» App Manager è·å–ä¿¡æ¯æ¢å¤ã€‚å½“ NodeManager æ•…éšœçš„æ—¶å€™ç³»ç»Ÿå¯ä»¥å…ˆæŠŠè¿™ä¸ªèŠ‚ç‚¹ç§»é™¤ï¼Œåœ¨å…¶ä»– NodeManager é‡å¯å†ç»§ç»­ä»»åŠ¡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-baa93cbd45b42782014c88c4b9e3d488_b.jpg\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic1.zhimg.com/v2-baa93cbd45b42782014c88c4b9e3d488_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;356&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic1.zhimg.com/v2-baa93cbd45b42782014c88c4b9e3d488_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-baa93cbd45b42782014c88c4b9e3d488_b.jpg\"/><figcaption>å›¾ 4ï¼Œvia https://www.cnblogs.com/sodawoods-blogs/p/8715231.html</figcaption></figure><p>é‚£ä¹ˆå½“ ResourceManager æ•…éšœçš„æ—¶å€™å‘¢ï¼Ÿå¦‚ä¸Šæ–‡æ‰€è¯´çš„åœ¨ Yarn é›†ç¾¤ä¸­ï¼ŒResourceManager å¯ä»¥å¯åŠ¨å¤šå°ï¼Œåªæœ‰å…¶ä¸­ä¸€å°æ˜¯ active çŠ¶æ€çš„ï¼Œå…¶ä»–éƒ½å¤„äºå¾…å‘½çŠ¶æ€ã€‚è¿™å° active çŠ¶æ€çš„ ResourceManager æ‰§è¡Œçš„æ—¶å€™ä¼šå‘ ZooKeeper é›†ç¾¤å†™å…¥å®ƒçš„çŠ¶æ€ï¼Œå½“å®ƒæ•…éšœçš„æ—¶å€™è¿™äº› RM é¦–å…ˆé€‰ä¸¾å‡ºå¦å¤–ä¸€å° leader å˜ä¸º active çŠ¶æ€ï¼Œç„¶åä» ZooKeeper é›†ç¾¤åŠ è½½ ResourceManager çš„çŠ¶æ€ã€‚åœ¨è½¬ç§»çš„è¿‡ç¨‹ä¸­å®ƒä¸æ¥æ”¶æ–°çš„ Jobï¼Œè½¬ç§»å®Œæˆåæ‰æ¥æ”¶æ–° Jobã€‚</p><h2><b>Spark on Yarn </b></h2><p>é¦–å…ˆä»‹ç» Spark çš„èµ„æºç®¡ç†æ¶æ„ã€‚Spark é›†ç¾¤è€ƒè™‘åˆ°äº†æœªæ¥å¯¹æ¥ä¸€äº›æ›´å¼ºå¤§çš„èµ„æºç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ Yarnã€Mesos ç­‰ï¼‰æ²¡æœ‰åœ¨èµ„æºç®¡ç†çš„è®¾è®¡ä¸Šå¯¹å¤–å°é—­ï¼Œæ‰€ä»¥Spark æ¶æ„è®¾è®¡æ—¶å°†èµ„æºç®¡ç†æŠ½è±¡å‡ºäº†ä¸€å±‚ï¼Œé€šè¿‡è¿™ç§æŠ½è±¡èƒ½å¤Ÿæ„å»ºä¸€ç§æ’ä»¶å¼çš„èµ„æºç®¡ç†æ¨¡å—ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-74cf18e2c2e27e657e2afcb73574cd0a_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"721\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-74cf18e2c2e27e657e2afcb73574cd0a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;721&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"721\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-74cf18e2c2e27e657e2afcb73574cd0a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-74cf18e2c2e27e657e2afcb73574cd0a_b.jpg\"/><figcaption>å›¾ 5ï¼Œvia http://shiyanjun.cn/archives/1545.html</figcaption></figure><p>å¦‚å›¾ 5 æ‰€ç¤ºæ˜¯ Spark çš„èµ„æºç®¡ç†æ¶æ„å›¾ã€‚Master æ˜¯ Spark çš„ ä¸»æ§èŠ‚ç‚¹ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ä¼šæœ‰å¤šä¸ª Masterï¼Œåªæœ‰ä¸€ä¸ª Master å¤„äº active çŠ¶æ€ã€‚Worker æ˜¯ Spark çš„å·¥ä½œèŠ‚ç‚¹ï¼Œå‘ Master æ±‡æŠ¥è‡ªèº«çš„èµ„æºã€Executeor æ‰§è¡ŒçŠ¶æ€çš„æ”¹å˜ï¼Œå¹¶æ¥å— Master çš„å‘½ä»¤å¯åŠ¨ Executor æˆ– Driverã€‚Driver æ˜¯åº”ç”¨ç¨‹åºçš„é©±åŠ¨ç¨‹åºï¼Œæ¯ä¸ªåº”ç”¨åŒ…æ‹¬è®¸å¤šå°ä»»åŠ¡ï¼ŒDriver è´Ÿè´£æ¨åŠ¨è¿™äº›å°ä»»åŠ¡çš„æœ‰åºæ‰§è¡Œã€‚Executor æ˜¯ Spark çš„å·¥ä½œè¿›ç¨‹ï¼Œç”± Worker ç›‘ç®¡ï¼Œè´Ÿè´£å…·ä½“ä»»åŠ¡çš„æ‰§è¡Œã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ Spark åœ¨èµ„æºç®¡ç†ä¸Šçš„æŠ½è±¡å‡ºæ¥çš„æ¶æ„ï¼Œè¿™ä¸ªæ¶æ„è·Ÿ Yarn çš„æ¶æ„ååˆ†ç›¸ä¼¼ï¼Œå› æ­¤ Spark å¾ˆå®¹æ˜“åœ°æ„å»ºäº Yarn ä¹‹ä¸Šã€‚åœ¨ Spark å’Œ Yarn ä¸¤è¾¹çš„è§’è‰²å¯¹æ¯”ä¸­ï¼šMaster å’Œ ResourceManager å¯¹åº”ï¼ŒWorker å’Œ NodeManager å¯¹åº”ï¼ŒDriver å’Œ App Master å¯¹åº”ï¼ŒExecutor å’Œ Container å¯¹åº”ã€‚</p><p>æ ¹æ® Spark éƒ¨ç½²æ¨¡å¼çš„ä¸åŒèµ„æºç®¡ç†æ¶æ„ä¹Ÿä¼šæœ‰ä¸åŒçš„å½¢æ€ã€‚Spark å¤§è‡´åŒ…æ‹¬å››ç§éƒ¨ç½²æ¨¡å¼ï¼š</p><ul><li><b>Local æ¨¡å¼</b>ï¼šéƒ¨ç½²åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸Šï¼Œåªæœ‰ Driver è§’è‰²ã€‚æ¥å—ä»»åŠ¡ååˆ›å»º Driver è´Ÿè´£åº”ç”¨çš„è°ƒåº¦æ‰§è¡Œï¼Œä¸æ¶‰åŠ Master å’Œ Workerï¼›</li><li><b>Local-Cluster æ¨¡å¼</b>ï¼šéƒ¨ç½²åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸Šï¼Œå­˜åœ¨ Master å’Œ Worker è§’è‰²ï¼Œå®ƒä»¬ä½œä¸ºç‹¬ç«‹çº¿ç¨‹å­˜åœ¨äºè¿™ä¸ªè¿›ç¨‹å†…ï¼›</li><li><b>Standalone æ¨¡å¼</b>ï¼šSpark çœŸæ­£çš„é›†ç¾¤æ¨¡å¼ï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ Master å’Œ Worker æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼›</li><li><b>ç¬¬ä¸‰æ–¹éƒ¨ç½²æ¨¡å¼</b>ï¼šæ„å»ºäº Yarn æˆ– Mesos ä¹‹ä¸Šï¼Œç”±å®ƒä»¬æä¾›èµ„æºç®¡ç†ã€‚</li></ul><p>æ¥ç€çœ‹çœ‹ Spark on Yarn å¯¹ Job çš„å¤„ç†è¿‡ç¨‹ã€‚å®¢æˆ·ç«¯æäº¤ä¸€ä¸ªä»»åŠ¡ç»™ Yarn ResourceManager åï¼ŒApp Manager æ¥å—ä»»åŠ¡å¹¶æ‰¾åˆ°ä¸€ä¸ª Container åˆ›å»ºApp Masterï¼Œæ­¤æ—¶ App Master ä¸Šè¿è¡Œçš„æ˜¯ Spark Driverã€‚ä¹‹å App Master ç”³è¯· Container å¹¶å¯åŠ¨ï¼ŒSpark Driver åœ¨ Container ä¸Šå¯åŠ¨ Spark Executorï¼Œå¹¶è°ƒåº¦ Spark Task åœ¨ Spark Executor ä¸Šè¿è¡Œï¼Œç­‰åˆ°æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå‘ App Manager å–æ¶ˆæ³¨å†Œå¹¶é‡Šæ”¾èµ„æºã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-5f62784bb2720742f616bf9c6e372b52_b.jpg\" data-size=\"normal\" data-rawwidth=\"620\" data-rawheight=\"493\" class=\"origin_image zh-lightbox-thumb\" width=\"620\" data-original=\"https://pic3.zhimg.com/v2-5f62784bb2720742f616bf9c6e372b52_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;620&#39; height=&#39;493&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"620\" data-rawheight=\"493\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"620\" data-original=\"https://pic3.zhimg.com/v2-5f62784bb2720742f616bf9c6e372b52_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-5f62784bb2720742f616bf9c6e372b52_b.jpg\"/><figcaption>å›¾ 6ï¼Œvia https://www.iteblog.com/archives/1223.html</figcaption></figure><p>å¯ä»¥çœ‹å‡ºè¿™ä¸ªæ‰§è¡Œæµç¨‹å’Œ Yarn å¯¹ä¸€ä¸ªä»»åŠ¡çš„å¤„ç†è¿‡ç¨‹å‡ ä¹ä¸€è‡´ï¼Œä¸åŒçš„æ˜¯åœ¨ Spark on Yarn çš„ Job å¤„ç†è¿‡ç¨‹ä¸­ App Masterã€Container æ˜¯äº¤ç”± Spark ç›¸å¯¹åº”çš„è§’è‰²å»å¤„ç†çš„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-bbe0f2c46ec8b51e2c28eafa07325edf_b.jpg\" data-size=\"normal\" data-rawwidth=\"620\" data-rawheight=\"493\" class=\"origin_image zh-lightbox-thumb\" width=\"620\" data-original=\"https://pic4.zhimg.com/v2-bbe0f2c46ec8b51e2c28eafa07325edf_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;620&#39; height=&#39;493&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"620\" data-rawheight=\"493\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"620\" data-original=\"https://pic4.zhimg.com/v2-bbe0f2c46ec8b51e2c28eafa07325edf_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-bbe0f2c46ec8b51e2c28eafa07325edf_b.jpg\"/><figcaption>å›¾ 7ï¼Œvia https://www.iteblog.com/archives/1223.html</figcaption></figure><p>Spark on Yarn è¿˜æœ‰å¦å¤–ä¸€ç§è¿è¡Œæ¨¡å¼ï¼šSpark on Yarn-Clientã€‚ä¸åŒäºä¸Šè¿°çš„ Spark on Yarn-Clusterï¼ŒSpark on Yarn-Client çš„å®¢æˆ·ç«¯åœ¨æäº¤å®Œä»»åŠ¡ä¹‹åä¸ä¼šå°† Spark Driver æ‰˜ç®¡ç»™ Yarnï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯è¿è¡Œã€‚App Master ç”³è¯·å®Œ Container ä¹‹ååŒæ ·ä¹Ÿæ˜¯ç”± Spark Driver å»å¯åŠ¨ Spark Executorï¼Œæ‰§è¡Œä»»åŠ¡ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆä½¿ç”¨ Yarn ä½œä¸º Spark çš„èµ„æºç®¡ç†å‘¢ï¼Ÿæˆ‘ä»¬æ¥å¯¹æ¯” Spark é›†ç¾¤æ¨¡å¼ Standalone å’Œ Spark on Yarn åœ¨èµ„æºè°ƒåº¦èƒ½åŠ›ä¸Šçš„åŒºåˆ«ï¼šSpark çš„ Standalone æ¨¡å¼åªæ”¯æŒ FIFO è°ƒåº¦å™¨ï¼Œå•ç”¨æˆ·ä¸²è¡Œï¼Œé»˜è®¤æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰èµ„æºå¯¹åº”ç”¨éƒ½æ˜¯å¯ç”¨çš„ï¼›è€Œ Yarn ä¸æ­¢æ”¯æŒ FIFO çš„èµ„æºè°ƒåº¦ï¼Œè¿˜æä¾›äº†å¼¹æ€§å’Œå…¬å¹³çš„èµ„æºåˆ†é…æ–¹å¼ã€‚</p><p>Yarn æ˜¯é€šè¿‡å°†èµ„æºåˆ†é…ç»™ queue æ¥è¿›è¡Œèµ„æºåˆ†é…çš„ï¼Œæ¯ä¸ª queue å¯ä»¥è®¾ç½®å®ƒçš„èµ„æºåˆ†é…æ–¹å¼ï¼Œæ¥ç€å±•å¼€ä»‹ç» Yarn çš„ä¸‰ç§èµ„æºåˆ†é…æ–¹å¼ã€‚</p><p><b>FIFO Scheduler</b></p><p>å¦‚æœæ²¡æœ‰é…ç½®ç­–ç•¥çš„è¯ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æäº¤åˆ°ä¸€ä¸ª default é˜Ÿåˆ—ï¼Œæ ¹æ®å®ƒä»¬çš„æäº¤é¡ºåºæ‰§è¡Œã€‚å¯Œè£•èµ„æºå°±æ‰§è¡Œä»»åŠ¡ï¼Œè‹¥èµ„æºä¸å¯Œè£•å°±ç­‰å¾…å‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åé‡Šæ”¾èµ„æºï¼Œè¿™å°±æ˜¯ FIFO Scheduler å…ˆå…¥å…ˆå‡ºçš„åˆ†é…æ–¹å¼ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-856db3c5d434f0d2f44c3bb9f205e1c4_b.jpg\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic1.zhimg.com/v2-856db3c5d434f0d2f44c3bb9f205e1c4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;356&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic1.zhimg.com/v2-856db3c5d434f0d2f44c3bb9f205e1c4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-856db3c5d434f0d2f44c3bb9f205e1c4_b.jpg\"/><figcaption>å›¾ 8ï¼Œvia https://blog.csdn.net/suifeng3051/article/details/49508261</figcaption></figure><p>å¦‚å›¾ 8 æ‰€ç¤ºï¼Œåœ¨ Job1 æäº¤æ—¶å ç”¨äº†æ‰€æœ‰çš„èµ„æºï¼Œä¸ä¹…å Job2æäº¤äº†ï¼Œä½†æ˜¯æ­¤æ—¶ç³»ç»Ÿä¸­å·²ç»æ²¡æœ‰èµ„æºå¯ä»¥åˆ†é…ç»™å®ƒäº†ã€‚åŠ å…¥ Job1 æ˜¯ä¸€ä¸ªå¤§ä»»åŠ¡ï¼Œé‚£ä¹ˆ Job2 å°±åªèƒ½ç­‰å¾…ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´æ‰èƒ½è·å¾—æ‰§è¡Œçš„èµ„æºã€‚æ‰€ä»¥å…ˆå…¥å…ˆå‡ºçš„åˆ†é…æ–¹å¼å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤§ä»»åŠ¡ä¼šå ç”¨å¾ˆå¤šèµ„æºï¼Œé€ æˆåé¢çš„å°ä»»åŠ¡ç­‰å¾…æ—¶é—´å¤ªé•¿è€Œé¥¿æ­»ï¼Œå› æ­¤ä¸€èˆ¬ä¸ä½¿ç”¨è¿™ä¸ªé»˜è®¤é…ç½®ã€‚</p><p><b>Capacity Scheduler</b></p><p>Capacity Scheduler æ˜¯ä¸€ç§å¤šç§Ÿæˆ·ã€å¼¹æ€§çš„åˆ†é…æ–¹å¼ã€‚æ¯ä¸ªç§Ÿæˆ·ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯ä»¥é…ç½®èƒ½ä½¿ç”¨çš„èµ„æºä¸Šé™ä¸ä¸‹é™ï¼ˆè­¬å¦‚ 50%ï¼Œè¾¾åˆ°è¿™ä¸ªä¸Šé™åå³ä½¿å…¶ä»–çš„èµ„æºç©ºç½®ç€ï¼Œä¹Ÿä¸å¯ä½¿ç”¨ï¼‰ï¼Œé€šè¿‡é…ç½®å¯ä»¥ä»¤é˜Ÿåˆ—è‡³å°‘æœ‰èµ„æºä¸‹é™é…ç½®çš„èµ„æºå¯ä½¿ç”¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-16e61b7b9a38b83d81f1eff0b57eb4be_b.jpg\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic3.zhimg.com/v2-16e61b7b9a38b83d81f1eff0b57eb4be_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;356&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic3.zhimg.com/v2-16e61b7b9a38b83d81f1eff0b57eb4be_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-16e61b7b9a38b83d81f1eff0b57eb4be_b.jpg\"/><figcaption>å›¾ 9ï¼Œvia https://blog.csdn.net/suifeng3051/article/details/49508261</figcaption></figure><p>å›¾ 9 ä¸­é˜Ÿåˆ— A å’Œé˜Ÿåˆ— B åˆ†é…äº†ç›¸äº’ç‹¬ç«‹çš„èµ„æºã€‚Job1 æäº¤ç»™é˜Ÿåˆ— A æ‰§è¡Œï¼Œå®ƒåªèƒ½ä½¿ç”¨é˜Ÿåˆ— A çš„èµ„æºã€‚æ¥ç€ Job2 æäº¤ç»™äº†é˜Ÿåˆ—B å°±ä¸å¿…ç­‰å¾… Job1 é‡Šæ”¾èµ„æºäº†ã€‚è¿™æ ·å°±å¯ä»¥å°†å¤§ä»»åŠ¡å’Œå°ä»»åŠ¡åˆ†é…åœ¨ä¸¤ä¸ªé˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—çš„èµ„æºç›¸äº’ç‹¬ç«‹ï¼Œå°±ä¸ä¼šé€ æˆå°ä»»åŠ¡é¥¿æ­»çš„æƒ…å†µäº†ã€‚</p><p><b>Fair Scheduler</b></p><p>Fair Scheduler æ˜¯ä¸€ç§å…¬å¹³çš„åˆ†é…æ–¹å¼ï¼Œæ‰€è°“çš„å…¬å¹³å°±æ˜¯é›†ç¾¤ä¼š<b>å°½å¯èƒ½åœ°æŒ‰é…ç½®çš„æ¯”ä¾‹åˆ†é…</b>èµ„æºç»™é˜Ÿåˆ—ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-5e115005916822ec8c25d945ec6cb693_b.jpg\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb\" width=\"648\" data-original=\"https://pic4.zhimg.com/v2-5e115005916822ec8c25d945ec6cb693_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;648&#39; height=&#39;356&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"648\" data-rawheight=\"356\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"648\" data-original=\"https://pic4.zhimg.com/v2-5e115005916822ec8c25d945ec6cb693_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-5e115005916822ec8c25d945ec6cb693_b.jpg\"/><figcaption>å›¾ 10ï¼Œvia https://blog.csdn.net/suifeng3051/article/details/49508261</figcaption></figure><p>å›¾ 10 ä¸­ Job1 æäº¤ç»™é˜Ÿåˆ— Aï¼Œå®ƒå ç”¨äº†é›†ç¾¤çš„æ‰€æœ‰èµ„æºã€‚æ¥ç€ Job2 æäº¤ç»™äº†é˜Ÿåˆ— Bï¼Œè¿™æ—¶ Job1 å°±éœ€è¦é‡Šæ”¾å®ƒçš„ä¸€åŠçš„èµ„æºç»™é˜Ÿåˆ— A ä¸­çš„ Job2 ä½¿ç”¨ã€‚æ¥ç€ Job3 ä¹Ÿæäº¤ç»™äº†é˜Ÿåˆ— Bï¼Œè¿™ä¸ªæ—¶å€™ Job2 å¦‚æœè¿˜æœªæ‰§è¡Œå®Œæ¯•çš„è¯ä¹Ÿå¿…é¡»é‡Šæ”¾ä¸€åŠçš„èµ„æºç»™ Job3ã€‚è¿™å°±æ˜¯å…¬å¹³çš„åˆ†é…æ–¹å¼ï¼Œåœ¨é˜Ÿåˆ—èŒƒå›´å†…æ‰€æœ‰ä»»åŠ¡äº«ç”¨åˆ°çš„èµ„æºéƒ½æ˜¯å‡åˆ†çš„ã€‚</p><h2><b>the Future of  Spark </b></h2><p>Mesos çš„èµ„æºè°ƒåº¦å’Œ Yarn ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæä¾›äº†ç²—ç²’åº¦å’Œç»†ç²’åº¦çš„ä¸¤ç§æ¨¡å¼ã€‚æ‰€è°“çš„ç²—ç²’åº¦å’Œç»†ç²’åº¦çš„å·®åˆ«åœ¨äºï¼šExecutor ç”³è¯·çš„èµ„æºæ˜¯åœ¨æ‰§è¡Œå‰ç”³è¯·ï¼Œè¿˜æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŒ‰éœ€ç”³è¯·ã€‚é›†ç¾¤èµ„æºç´§å¼ æ—¶å¯èƒ½æœ‰ä¸€ä¸ª Executor ç”³è¯·çš„èµ„æºåœ¨å½“æ—¶å¤„äºé—²ç½®çŠ¶æ€ï¼Œå¦‚æœå¤„äºç²—ç²’åº¦æ¨¡å¼ä¸‹ï¼Œè¿™äº›èµ„æºåœ¨å½“æ—¶å°±æµªè´¹äº†ã€‚ä½†æ˜¯åœ¨ç»†ç²’åº¦æ¨¡å¼ä¸‹ï¼ŒExecutor æ‰§è¡Œæ—¶æ‰€éœ€çš„èµ„æºæ˜¯æŒ‰ç…§å®ƒçš„éœ€æ±‚åˆ†é…çš„ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨èµ„æºé—²ç½®çš„æƒ…å†µäº†ã€‚</p><p>å› ä¸º Mesos çš„ Executor æ˜¯å¯ä»¥åŠ¨æ€è°ƒæ•´ï¼Œè€Œ Yarn ä½¿ç”¨çš„ Container æ˜¯ä¸å¯ä»¥åŠ¨æ€è°ƒæ•´çš„ï¼Œæ‰€ä»¥ç›®å‰ Yarn æ˜¯ä¸æ”¯æŒç»†ç²’åº¦çš„è°ƒåº¦æ¨¡å¼çš„ï¼Œä½† Yarn å·²ç»æœ‰è®¡åˆ’æ”¯æŒç»†ç²’åº¦çš„èµ„æºç®¡ç†æ–¹å¼ã€‚</p><p>é™¤æ­¤ä¹‹å¤–åœ¨ Hadoop3.1.0 ä¸­ Yarn æä¾›äº†å¯¹ gpu èµ„æºçš„æ”¯æŒï¼Œç›®å‰åªæ”¯æŒ Nvidia gpuã€‚æœŸå¾… Spark åœ¨å…¶ä»–æ–¹é¢çš„æ›´å¤šæ¢ç´¢ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å…·ä½“ä»‹ç» RDDï¼Œæ¬¢è¿æŒç»­å…³æ³¨ã€‚</p><p></p>", 
            "topic": [
                {
                    "tag": "Hadoop", 
                    "tagLink": "https://api.zhihu.com/topics/19563390"
                }, 
                {
                    "tag": "MapReduce", 
                    "tagLink": "https://api.zhihu.com/topics/19621083"
                }, 
                {
                    "tag": "Spark", 
                    "tagLink": "https://api.zhihu.com/topics/19942170"
                }
            ], 
            "comments": [
                {
                    "userName": "Ethanæ¥šç¿”", 
                    "userLink": "https://www.zhihu.com/people/d75b754b2ab16e3d90b87bb53f5899e4", 
                    "content": "<p>yarn-clusterä¸‹masterå’Œdriveræ˜¯ä¸€æ ·å—?</p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "å¤§èœèœ", 
                            "userLink": "https://www.zhihu.com/people/9d332a19dff96a82bb4bb9d44f612969", 
                            "content": "<p>ä¸ä¸€æ ·,masteræ˜¯ä¸€çº§èµ„æºè°ƒåº¦çš„æŠ½è±¡æ¦‚å¿µ,å¯¹åº”ç€yarnçš„RM,driveræ˜¯äºŒçº§è°ƒåº¦çš„æŠ½è±¡,åœ¨yarnä¸­æ›´åƒæ˜¯ApplicationManager</p>", 
                            "likes": 0, 
                            "replyToAuthor": "Ethanæ¥šç¿”"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/40698254", 
            "userName": "MTé…±", 
            "userLink": "https://www.zhihu.com/people/28629950b8d6033df6b6f33fd0280e2a", 
            "upvote": 11, 
            "title": "Spark Streaming VS Flink", 
            "content": "<blockquote><i>æœ¬æ–‡ä»ç¼–ç¨‹æ¨¡å‹ã€ä»»åŠ¡è°ƒåº¦ã€æ—¶é—´æœºåˆ¶ã€Kafka åŠ¨æ€åˆ†åŒºçš„æ„ŸçŸ¥ã€å®¹é”™åŠå¤„ç†è¯­ä¹‰ã€èƒŒå‹ç­‰å‡ ä¸ªæ–¹é¢å¯¹æ¯” Spark Streaming ä¸ Flinkï¼Œå¸Œæœ›å¯¹æœ‰å®æ—¶å¤„ç†éœ€æ±‚ä¸šåŠ¡çš„ä¼ä¸šç«¯ç”¨æˆ·åœ¨æ¡†æ¶é€‰å‹æœ‰æ‰€å¯å‘ã€‚æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œå»ºè®®å…ˆæ”¶è—ï½å¾®ä¿¡linkï¼š</i><a href=\"https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/jllAegJMYh_by95FhHt0jA\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Spark Streaming VS Flink</a></blockquote><h2><b>#ç¼–ç¨‹æ¨¡å‹å¯¹æ¯”</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p><b>è¿è¡Œè§’è‰²</b></p><p>Spark Streaming è¿è¡Œæ—¶çš„è§’è‰²(standalone æ¨¡å¼)ä¸»è¦æœ‰ï¼š</p><ul><li><b>Master</b>:ä¸»è¦è´Ÿè´£æ•´ä½“é›†ç¾¤èµ„æºçš„ç®¡ç†å’Œåº”ç”¨ç¨‹åºè°ƒåº¦ï¼›</li><li><b>Worker</b>:è´Ÿè´£å•ä¸ªèŠ‚ç‚¹çš„èµ„æºç®¡ç†ï¼Œdriver å’Œ executor çš„å¯åŠ¨ç­‰ï¼›</li><li><b>Driver</b>:ç”¨æˆ·å…¥å£ç¨‹åºæ‰§è¡Œçš„åœ°æ–¹ï¼Œå³ SparkContext æ‰§è¡Œçš„åœ°æ–¹ï¼Œä¸»è¦æ˜¯ DAG ç”Ÿæˆã€stage åˆ’åˆ†ã€task ç”ŸæˆåŠè°ƒåº¦ï¼›</li><li><b>Executor</b>:è´Ÿè´£æ‰§è¡Œ taskï¼Œåé¦ˆæ‰§è¡ŒçŠ¶æ€å’Œæ‰§è¡Œç»“æœã€‚</li></ul><p>Flink è¿è¡Œæ—¶çš„è§’è‰²(standalone æ¨¡å¼)ä¸»è¦æœ‰:</p><ul><li><b>Jobmanager</b>: åè°ƒåˆ†å¸ƒå¼æ‰§è¡Œï¼Œä»–ä»¬è°ƒåº¦ä»»åŠ¡ã€åè°ƒ checkpointsã€åè°ƒæ•…éšœæ¢å¤ç­‰ã€‚è‡³å°‘æœ‰ä¸€ä¸ª JobManagerã€‚é«˜å¯ç”¨æƒ…å†µä¸‹å¯ä»¥å¯åŠ¨å¤šä¸ª JobManagerï¼Œå…¶ä¸­ä¸€ä¸ªé€‰ä¸¾ä¸º leaderï¼Œå…¶ä½™ä¸º standbyï¼›</li><li><b>Taskmanager</b>: è´Ÿè´£æ‰§è¡Œå…·ä½“çš„ tasksã€ç¼“å­˜ã€äº¤æ¢æ•°æ®æµï¼Œè‡³å°‘æœ‰ä¸€ä¸ª TaskManagerï¼›</li><li><b>Slot</b>: æ¯ä¸ª task slot ä»£è¡¨ TaskManager çš„ä¸€ä¸ªå›ºå®šéƒ¨åˆ†èµ„æºï¼ŒSlot çš„ä¸ªæ•°ä»£è¡¨ç€ taskmanager å¯å¹¶è¡Œæ‰§è¡Œçš„ task æ•°ã€‚</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><p><b>ç”Ÿæ€</b></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-ae294c803fcf4b107783bfd14ef0f919_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic2.zhimg.com/v2-ae294c803fcf4b107783bfd14ef0f919_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;267&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic2.zhimg.com/v2-ae294c803fcf4b107783bfd14ef0f919_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-ae294c803fcf4b107783bfd14ef0f919_b.jpg\"/><figcaption>å›¾ 1ï¼šSpark Streaming ç”Ÿæ€ï¼Œvia Spark å®˜ç½‘</figcaption></figure><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-7e34c912b2ebce4674ce5f4f4064f3e7_b.jpg\" data-size=\"normal\" data-rawwidth=\"852\" data-rawheight=\"279\" class=\"origin_image zh-lightbox-thumb\" width=\"852\" data-original=\"https://pic4.zhimg.com/v2-7e34c912b2ebce4674ce5f4f4064f3e7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;852&#39; height=&#39;279&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"852\" data-rawheight=\"279\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"852\" data-original=\"https://pic4.zhimg.com/v2-7e34c912b2ebce4674ce5f4f4064f3e7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-7e34c912b2ebce4674ce5f4f4064f3e7_b.jpg\"/><figcaption>å›¾ 2ï¼šFlink ç”Ÿæ€ï¼Œvia Flinkå®˜ç½‘</figcaption></figure><p><b>è¿è¡Œæ¨¡å‹</b></p><p>Spark Streaming æ˜¯<b>å¾®æ‰¹å¤„ç†</b>ï¼Œè¿è¡Œçš„æ—¶å€™éœ€è¦æŒ‡å®šæ‰¹å¤„ç†çš„æ—¶é—´ï¼Œæ¯æ¬¡è¿è¡Œ job æ—¶å¤„ç†ä¸€ä¸ªæ‰¹æ¬¡çš„æ•°æ®ï¼Œæµç¨‹å¦‚å›¾ 3 æ‰€ç¤ºï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-39962f682cdd755f61295229b1bbdfca_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"182\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic3.zhimg.com/v2-39962f682cdd755f61295229b1bbdfca_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;182&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"182\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic3.zhimg.com/v2-39962f682cdd755f61295229b1bbdfca_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-39962f682cdd755f61295229b1bbdfca_b.jpg\"/><figcaption>å›¾ 3ï¼Œvia Spark å®˜ç½‘</figcaption></figure><p>Flink æ˜¯åŸºäº<b>äº‹ä»¶</b>é©±åŠ¨çš„ï¼Œäº‹ä»¶å¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯ã€‚äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºæ˜¯ä¸€ç§çŠ¶æ€åº”ç”¨ç¨‹åºï¼Œå®ƒä¼šä»ä¸€ä¸ªæˆ–è€…å¤šä¸ªæµä¸­æ³¨å…¥äº‹ä»¶ï¼Œé€šè¿‡è§¦å‘è®¡ç®—æ›´æ–°çŠ¶æ€ï¼Œæˆ–å¤–éƒ¨åŠ¨ä½œå¯¹æ³¨å…¥çš„äº‹ä»¶ä½œå‡ºååº”ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-35bce29d91c6405c1e496dd88e836e0f_b.jpg\" data-size=\"normal\" data-rawwidth=\"827\" data-rawheight=\"313\" class=\"origin_image zh-lightbox-thumb\" width=\"827\" data-original=\"https://pic4.zhimg.com/v2-35bce29d91c6405c1e496dd88e836e0f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;827&#39; height=&#39;313&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"827\" data-rawheight=\"313\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"827\" data-original=\"https://pic4.zhimg.com/v2-35bce29d91c6405c1e496dd88e836e0f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-35bce29d91c6405c1e496dd88e836e0f_b.jpg\"/><figcaption>å›¾ 4ï¼Œvia Fink å®˜ç½‘</figcaption></figure><h2><b>#ç¼–ç¨‹æ¨¡å‹å¯¹æ¯”</b></h2><p>ç¼–ç¨‹æ¨¡å‹å¯¹æ¯”ï¼Œä¸»è¦æ˜¯å¯¹æ¯” flink å’Œ Spark Streaming ä¸¤è€…åœ¨ä»£ç ç¼–å†™ä¸Šçš„åŒºåˆ«ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Streaming</b></p><p>Spark Streaming ä¸ kafka çš„ç»“åˆä¸»è¦æ˜¯ä¸¤ç§æ¨¡å‹ï¼š</p><ul><li>åŸºäº receiver dstreamï¼›</li><li>åŸºäº direct dstreamã€‚</li></ul><p>ä»¥ä¸Šä¸¤ç§æ¨¡å‹ç¼–ç¨‹æœºæ„è¿‘ä¼¼ï¼Œåªæ˜¯åœ¨ api å’Œå†…éƒ¨æ•°æ®è·å–æœ‰äº›åŒºåˆ«ï¼Œæ–°ç‰ˆæœ¬çš„å·²ç»å–æ¶ˆäº†åŸºäº receiver è¿™ç§æ¨¡å¼ï¼Œä¼ä¸šä¸­é€šå¸¸é‡‡ç”¨åŸºäº direct Dstream çš„æ¨¡å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">val Array(brokers, topics) = args//    åˆ›å»ºä¸€ä¸ªæ‰¹å¤„ç†æ—¶é—´æ˜¯2sçš„context    \n   val sparkConf = new SparkConf().setAppName(&#34;DirectKafkaWordCount&#34;)    \n   val ssc = new StreamingContext(sparkConf, Seconds(2))    \n   //    ä½¿ç”¨brokerå’Œtopicåˆ›å»ºDirectStream    \n   val topicsSet = topics.split(&#34;,&#34;).toSet    \n   val kafkaParams = Map[String, String](&#34;metadata.broker.list&#34; -&gt; brokers)    \n   val messages = KafkaUtils.createDirectStream[String, String]( ssc, LocationStrategies.PreferConsistent,    ConsumerStrategies.Subscribe[String, String](topicsSet, kafkaParams))  \n     // Get the lines, split them into words, count the words and print    \n   val lines = messages.map(_.value)    \n   val words = lines.flatMap(_.split(&#34; &#34;))    \n   val wordCounts = words.map(x =&gt; (x, 1L)).reduceByKey(_ + _)   \n    wordCounts.print()     //    å¯åŠ¨æµ    \n   ssc.start()    \n   ssc.awaitTermination()</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p>é€šè¿‡ä»¥ä¸Šä»£ç æˆ‘ä»¬å¯ä»¥ get åˆ°ï¼š</p><ul><li>è®¾ç½®æ‰¹å¤„ç†æ—¶é—´</li><li>åˆ›å»ºæ•°æ®æµ</li><li>ç¼–å†™transform</li><li>ç¼–å†™action</li><li>å¯åŠ¨æ‰§è¡Œ</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Flink</b></p><p>æ¥ä¸‹æ¥çœ‹ flink ä¸ kafka ç»“åˆæ˜¯å¦‚ä½•ç¼–å†™ä»£ç çš„ã€‚Flink ä¸ kafka ç»“åˆæ˜¯äº‹ä»¶é©±åŠ¨ï¼Œå¤§å®¶å¯èƒ½å¯¹æ­¤ä¼šæœ‰ç–‘é—®ï¼Œæ¶ˆè´¹ kafka çš„æ•°æ®è°ƒç”¨ poll çš„æ—¶å€™æ˜¯æ‰¹é‡è·å–æ•°æ®çš„(å¯ä»¥è®¾ç½®æ‰¹å¤„ç†å¤§å°å’Œè¶…æ—¶æ—¶é—´)ï¼Œè¿™å°±ä¸èƒ½å«åšäº‹ä»¶è§¦å‘äº†ã€‚è€Œå®é™…ä¸Šï¼Œflink å†…éƒ¨å¯¹ poll å‡ºæ¥çš„æ•°æ®è¿›è¡Œäº†æ•´ç†ï¼Œç„¶åé€æ¡ emitï¼Œå½¢æˆäº†äº‹ä»¶è§¦å‘çš„æœºåˆ¶ã€‚ ä¸‹é¢çš„ä»£ç æ˜¯ flink æ•´åˆ kafka ä½œä¸º data source å’Œ data sinkï¼š</p><div class=\"highlight\"><pre><code class=\"language-scala\"><span class=\"nc\">StreamExecutionEnvironment</span> <span class=\"n\">env</span> <span class=\"k\">=</span> <span class=\"nc\">StreamExecutionEnvironment</span><span class=\"o\">.</span><span class=\"n\">getExecutionEnvironment</span><span class=\"o\">();</span>\n   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">getConfig</span><span class=\"o\">().</span><span class=\"n\">disableSysoutLogging</span><span class=\"o\">();</span>\n   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">getConfig</span><span class=\"o\">().</span><span class=\"n\">setRestartStrategy</span><span class=\"o\">(</span><span class=\"nc\">RestartStrategies</span><span class=\"o\">.</span><span class=\"n\">fixedDelayRestart</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">,</span> <span class=\"mi\">10000</span><span class=\"o\">));</span>\n   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">enableCheckpointing</span><span class=\"o\">(</span><span class=\"mi\">5000</span><span class=\"o\">);</span> <span class=\"c1\">// create a checkpoint every 5 seconds\n</span><span class=\"c1\"></span>   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">getConfig</span><span class=\"o\">().</span><span class=\"n\">setGlobalJobParameters</span><span class=\"o\">(</span><span class=\"n\">parameterTool</span><span class=\"o\">);</span> <span class=\"c1\">// make parameters available in the web interface\n</span><span class=\"c1\"></span>   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">setStreamTimeCharacteristic</span><span class=\"o\">(</span><span class=\"nc\">TimeCharacteristic</span><span class=\"o\">.</span><span class=\"nc\">EventTime</span><span class=\"o\">);</span>    \n   <span class=\"c1\">//    ExecutionConfig.GlobalJobParameters\n</span><span class=\"c1\"></span>   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">getConfig</span><span class=\"o\">().</span><span class=\"n\">setGlobalJobParameters</span><span class=\"o\">(</span><span class=\"kc\">null</span><span class=\"o\">);</span>    <span class=\"nc\">DataStream</span><span class=\"o\">&lt;</span><span class=\"nc\">KafkaEvent</span><span class=\"o\">&gt;</span> <span class=\"n\">input</span> <span class=\"k\">=</span> <span class=\"n\">env</span>\n           <span class=\"o\">.</span><span class=\"n\">addSource</span><span class=\"o\">(</span>                <span class=\"k\">new</span> <span class=\"nc\">FlinkKafkaConsumer010</span><span class=\"o\">&lt;&gt;(</span>\n                   <span class=\"n\">parameterTool</span><span class=\"o\">.</span><span class=\"n\">getRequired</span><span class=\"o\">(</span><span class=\"s\">&#34;input-topic&#34;</span><span class=\"o\">),</span>                    <span class=\"k\">new</span> <span class=\"nc\">KafkaEventSchema</span><span class=\"o\">(),</span>\n                   <span class=\"n\">parameterTool</span><span class=\"o\">.</span><span class=\"n\">getProperties</span><span class=\"o\">())</span>\n               <span class=\"o\">.</span><span class=\"n\">assignTimestampsAndWatermarks</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"nc\">CustomWatermarkExtractor</span><span class=\"o\">())).</span><span class=\"n\">setParallelism</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">).</span><span class=\"n\">rebalance</span><span class=\"o\">()</span>\n           <span class=\"o\">.</span><span class=\"n\">keyBy</span><span class=\"o\">(</span><span class=\"s\">&#34;word&#34;</span><span class=\"o\">)</span>\n           <span class=\"o\">.</span><span class=\"n\">map</span><span class=\"o\">(</span><span class=\"k\">new</span> <span class=\"nc\">RollingAdditionMapper</span><span class=\"o\">()).</span><span class=\"n\">setParallelism</span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">);</span>\n   \n   <span class=\"n\">input</span><span class=\"o\">.</span><span class=\"n\">addSink</span><span class=\"o\">(</span>            <span class=\"k\">new</span> <span class=\"nc\">FlinkKafkaProducer010</span><span class=\"o\">&lt;&gt;(</span>\n                   <span class=\"n\">parameterTool</span><span class=\"o\">.</span><span class=\"n\">getRequired</span><span class=\"o\">(</span><span class=\"s\">&#34;output-topic&#34;</span><span class=\"o\">),</span>                    <span class=\"k\">new</span> <span class=\"nc\">KafkaEventSchema</span><span class=\"o\">(),</span>\n                   <span class=\"n\">parameterTool</span><span class=\"o\">.</span><span class=\"n\">getProperties</span><span class=\"o\">()));</span>\n   \n   <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"o\">(</span><span class=\"s\">&#34;Kafka 0.10 Example&#34;</span><span class=\"o\">);</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p>ä» Flink ä¸ kafka ç»“åˆçš„ä»£ç å¯ä»¥ get åˆ°ï¼š</p><ul><li>æ³¨å†Œæ•°æ® source</li><li>ç¼–å†™è¿è¡Œé€»è¾‘</li><li>æ³¨å†Œæ•°æ® sink</li><li>è°ƒç”¨ env.execute ç›¸æ¯”äº Spark Streaming å°‘äº†è®¾ç½®æ‰¹å¤„ç†æ—¶é—´ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¾è‘—çš„åŒºåˆ«æ˜¯ flink çš„æ‰€æœ‰ç®—å­éƒ½æ˜¯ lazy å½¢å¼çš„ï¼Œè°ƒç”¨ env.execute ä¼šæ„å»º jobgraphã€‚client ç«¯è´Ÿè´£ Jobgraph ç”Ÿæˆå¹¶æäº¤å®ƒåˆ°é›†ç¾¤è¿è¡Œï¼›è€Œ Spark Streamingçš„æ“ä½œç®—å­åˆ† action å’Œ transformï¼Œå…¶ä¸­ä»…æœ‰ transform æ˜¯ lazy å½¢å¼ï¼Œè€Œä¸” DAG ç”Ÿæˆã€stage åˆ’åˆ†ã€ä»»åŠ¡è°ƒåº¦æ˜¯åœ¨ driver ç«¯è¿›è¡Œçš„ï¼Œåœ¨ client æ¨¡å¼ä¸‹ driver è¿è¡Œäºå®¢æˆ·ç«¯å¤„ã€‚</li></ul><h2><b>#ä»»åŠ¡è°ƒåº¦åŸç†</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark ä»»åŠ¡è°ƒåº¦</b></p><p>Spark Streaming ä»»åŠ¡å¦‚ä¸Šæ–‡æåˆ°çš„æ˜¯åŸºäºå¾®æ‰¹å¤„ç†çš„ï¼Œå®é™…ä¸Šæ¯ä¸ªæ‰¹æ¬¡éƒ½æ˜¯ä¸€ä¸ª Spark Core çš„ä»»åŠ¡ã€‚å¯¹äºç¼–ç å®Œæˆçš„ Spark Core ä»»åŠ¡åœ¨ç”Ÿæˆåˆ°æœ€ç»ˆæ‰§è¡Œç»“æŸä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æ„å»º DAG å›¾ï¼›</li><li>åˆ’åˆ† stageï¼›</li><li>ç”Ÿæˆ tasksetï¼›</li><li>è°ƒåº¦ taskã€‚</li></ul><p>å…·ä½“å¯å‚è€ƒå›¾ 5ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c1896e93fd44cc86d748d16a667d2cf9_b.jpg\" data-size=\"normal\" data-rawwidth=\"599\" data-rawheight=\"321\" class=\"origin_image zh-lightbox-thumb\" width=\"599\" data-original=\"https://pic2.zhimg.com/v2-c1896e93fd44cc86d748d16a667d2cf9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;599&#39; height=&#39;321&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"599\" data-rawheight=\"321\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"599\" data-original=\"https://pic2.zhimg.com/v2-c1896e93fd44cc86d748d16a667d2cf9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-c1896e93fd44cc86d748d16a667d2cf9_b.jpg\"/><figcaption>å›¾ 5ï¼šSpark ä»»åŠ¡è°ƒåº¦</figcaption></figure><p>å¯¹äº job çš„è°ƒåº¦æ‰§è¡Œæœ‰ fifo å’Œ fair ä¸¤ç§æ¨¡å¼ï¼ŒTask æ˜¯æ ¹æ®<b>æ•°æ®æœ¬åœ°æ€§</b>è°ƒåº¦æ‰§è¡Œçš„ã€‚ å‡è®¾æ¯ä¸ª Spark Streaming ä»»åŠ¡æ¶ˆè´¹çš„ kafka topic æœ‰å››ä¸ªåˆ†åŒºï¼Œä¸­é—´æœ‰ä¸€ä¸ª transformæ“ä½œï¼ˆå¦‚ mapï¼‰å’Œä¸€ä¸ª reduce æ“ä½œï¼Œå¦‚å›¾ 6 æ‰€ç¤ºï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c7ba6fba5a0b842377d1048ec31c440f_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"467\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-c7ba6fba5a0b842377d1048ec31c440f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;467&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"467\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-c7ba6fba5a0b842377d1048ec31c440f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-c7ba6fba5a0b842377d1048ec31c440f_b.jpg\"/><figcaption>å›¾ 6 </figcaption></figure><p>å‡è®¾æœ‰ä¸¤ä¸ª executorï¼Œå…¶ä¸­æ¯ä¸ª executor ä¸‰ä¸ªæ ¸ï¼Œé‚£ä¹ˆæ¯ä¸ªæ‰¹æ¬¡ç›¸åº”çš„ task è¿è¡Œä½ç½®æ˜¯å›ºå®šçš„å—ï¼Ÿæ˜¯å¦èƒ½é¢„æµ‹ï¼Ÿ ç”±äºæ•°æ®æœ¬åœ°æ€§å’Œè°ƒåº¦ä¸ç¡®å®šæ€§ï¼Œæ¯ä¸ªæ‰¹æ¬¡å¯¹åº” kafka åˆ†åŒºç”Ÿæˆçš„ task è¿è¡Œä½ç½®å¹¶ä¸æ˜¯å›ºå®šçš„ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Flink ä»»åŠ¡è°ƒåº¦</b></p><p>å¯¹äº flink çš„æµä»»åŠ¡å®¢æˆ·ç«¯é¦–å…ˆä¼šç”Ÿæˆ StreamGraphï¼Œæ¥ç€ç”Ÿæˆ JobGraphï¼Œç„¶åå°† jobGraph æäº¤ç»™ Jobmanager ç”±å®ƒå®Œæˆ jobGraph åˆ° ExecutionGraph çš„è½¬å˜ï¼Œæœ€åç”± jobManager è°ƒåº¦æ‰§è¡Œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-905a0152ecec0d0ee47a5f5885aa2e12_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"524\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic3.zhimg.com/v2-905a0152ecec0d0ee47a5f5885aa2e12_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;524&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"524\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic3.zhimg.com/v2-905a0152ecec0d0ee47a5f5885aa2e12_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-905a0152ecec0d0ee47a5f5885aa2e12_b.jpg\"/><figcaption>å›¾ 7</figcaption></figure><p>å¦‚å›¾ 7 æ‰€ç¤ºæœ‰ä¸€ä¸ªç”± data sourceã€MapFunctionå’Œ ReduceFunction ç»„æˆçš„ç¨‹åºï¼Œdata source å’Œ MapFunction çš„å¹¶å‘åº¦éƒ½ä¸º 4ï¼Œè€Œ ReduceFunction çš„å¹¶å‘åº¦ä¸º 3ã€‚ä¸€ä¸ªæ•°æ®æµç”± Source-Map-Reduce çš„é¡ºåºç»„æˆï¼Œåœ¨å…·æœ‰ 2 ä¸ªTaskManagerã€æ¯ä¸ª TaskManager éƒ½æœ‰ 3 ä¸ª Task Slot çš„é›†ç¾¤ä¸Šè¿è¡Œã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>å¯ä»¥çœ‹å‡º flink çš„æ‹“æ‰‘ç”Ÿæˆæäº¤æ‰§è¡Œä¹‹åï¼Œé™¤éæ•…éšœï¼Œå¦åˆ™æ‹“æ‰‘éƒ¨ä»¶æ‰§è¡Œä½ç½®ä¸å˜ï¼Œå¹¶è¡Œåº¦ç”±æ¯ä¸€ä¸ªç®—å­å¹¶è¡Œåº¦å†³å®šï¼Œç±»ä¼¼äº stormã€‚è€Œ spark Streaming æ˜¯æ¯ä¸ªæ‰¹æ¬¡éƒ½ä¼šæ ¹æ®æ•°æ®æœ¬åœ°æ€§å’Œèµ„æºæƒ…å†µè¿›è¡Œè°ƒåº¦ï¼Œæ— å›ºå®šçš„æ‰§è¡Œæ‹“æ‰‘ç»“æ„ã€‚ flink æ˜¯æ•°æ®åœ¨æ‹“æ‰‘ç»“æ„é‡ŒæµåŠ¨æ‰§è¡Œï¼Œè€Œ Spark Streaming åˆ™æ˜¯å¯¹æ•°æ®ç¼“å­˜æ‰¹æ¬¡å¹¶è¡Œå¤„ç†ã€‚</p><h2><b>#æ—¶é—´æœºåˆ¶å¯¹æ¯”</b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p><b>æµå¤„ç†çš„æ—¶é—´</b></p><p>æµå¤„ç†ç¨‹åºåœ¨æ—¶é—´æ¦‚å¿µä¸Šæ€»å…±æœ‰ä¸‰ä¸ªæ—¶é—´æ¦‚å¿µï¼š</p><ul><li><b>å¤„ç†æ—¶é—´</b></li></ul><p>å¤„ç†æ—¶é—´æ˜¯æŒ‡<b>æ¯å°æœºå™¨çš„ç³»ç»Ÿæ—¶é—´</b>ï¼Œå½“æµç¨‹åºé‡‡ç”¨å¤„ç†æ—¶é—´æ—¶å°†ä½¿ç”¨è¿è¡Œå„ä¸ªè¿ç®—ç¬¦å®ä¾‹çš„æœºå™¨æ—¶é—´ã€‚å¤„ç†æ—¶é—´æ˜¯æœ€ç®€å•çš„æ—¶é—´æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒï¼Œå®ƒèƒ½æä¾›æœ€å¥½çš„æ€§èƒ½å’Œæœ€ä½å»¶è¿Ÿã€‚ç„¶è€Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥ç¯å¢ƒä¸­ï¼Œå¤„ç†æ—¶é—´ä¸èƒ½æä¾›æ¶ˆæ¯äº‹ä»¶çš„æ—¶åºæ€§ä¿è¯ï¼Œå› ä¸ºå®ƒå—åˆ°æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿï¼Œæ¶ˆæ¯åœ¨ç®—å­ä¹‹é—´æµåŠ¨çš„é€Ÿåº¦ç­‰æ–¹é¢åˆ¶çº¦ã€‚</p><ul><li><b>äº‹ä»¶æ—¶é—´</b></li></ul><p>äº‹ä»¶æ—¶é—´æ˜¯æŒ‡äº‹ä»¶åœ¨å…¶<b>è®¾å¤‡ä¸Šå‘ç”Ÿçš„æ—¶é—´</b>ï¼Œè¿™ä¸ªæ—¶é—´åœ¨äº‹ä»¶è¿›å…¥ flink ä¹‹å‰å·²ç»åµŒå…¥äº‹ä»¶ï¼Œç„¶å flink å¯ä»¥æå–è¯¥æ—¶é—´ã€‚åŸºäºäº‹ä»¶æ—¶é—´è¿›è¡Œå¤„ç†çš„æµç¨‹åºå¯ä»¥ä¿è¯äº‹ä»¶åœ¨å¤„ç†çš„æ—¶å€™çš„é¡ºåºæ€§ï¼Œä½†æ˜¯åŸºäºäº‹ä»¶æ—¶é—´çš„åº”ç”¨ç¨‹åºå¿…é¡»è¦ç»“åˆ watermark æœºåˆ¶ã€‚åŸºäºäº‹ä»¶æ—¶é—´çš„å¤„ç†å¾€å¾€æœ‰ä¸€å®šçš„æ»åæ€§ï¼Œå› ä¸ºå®ƒéœ€è¦ç­‰å¾…åç»­äº‹ä»¶å’Œå¤„ç†æ— åºäº‹ä»¶ï¼Œå¯¹äºæ—¶é—´æ•æ„Ÿçš„åº”ç”¨ä½¿ç”¨çš„æ—¶å€™è¦æ…é‡è€ƒè™‘ã€‚</p><ul><li><b>æ³¨å…¥æ—¶é—´</b></li></ul><p>æ³¨å…¥æ—¶é—´æ˜¯<b>äº‹ä»¶æ³¨å…¥åˆ° flink çš„æ—¶é—´</b>ã€‚äº‹ä»¶åœ¨ source ç®—å­å¤„è·å– source çš„å½“å‰æ—¶é—´ä½œä¸ºäº‹ä»¶æ³¨å…¥æ—¶é—´ï¼Œåç»­çš„åŸºäºæ—¶é—´çš„å¤„ç†ç®—å­ä¼šä½¿ç”¨è¯¥æ—¶é—´å¤„ç†æ•°æ®ã€‚</p><p>ç›¸æ¯”äºäº‹ä»¶æ—¶é—´ï¼Œæ³¨å…¥æ—¶é—´ä¸èƒ½å¤Ÿå¤„ç†æ— åºäº‹ä»¶æˆ–è€…æ»åäº‹ä»¶ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ— åºæŒ‡å®šå¦‚ä½•ç”Ÿæˆ watermarkã€‚åœ¨å†…éƒ¨æ³¨å…¥æ—¶é—´ç¨‹åºçš„å¤„ç†å’Œäº‹ä»¶æ—¶é—´ç±»ä¼¼ï¼Œä½†æ˜¯æ—¶é—´æˆ³åˆ†é…å’Œ watermark ç”Ÿæˆéƒ½æ˜¯è‡ªåŠ¨çš„ã€‚</p><p>å›¾ 8 å¯ä»¥æ¸…æ™°åœ°çœ‹å‡ºä¸‰ç§æ—¶é—´çš„åŒºåˆ«ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f66b5e339e2eb3ff506724f27b2a3f19_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"390\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic2.zhimg.com/v2-f66b5e339e2eb3ff506724f27b2a3f19_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;390&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"390\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic2.zhimg.com/v2-f66b5e339e2eb3ff506724f27b2a3f19_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-f66b5e339e2eb3ff506724f27b2a3f19_b.jpg\"/><figcaption>å›¾ 8</figcaption></figure><p><b>Spark æ—¶é—´æœºåˆ¶</b></p><p>Spark Streaming åªæ”¯æŒå¤„ç†æ—¶é—´ï¼ŒStructured streaming æ”¯æŒå¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ï¼ŒåŒæ—¶æ”¯æŒ watermark æœºåˆ¶å¤„ç†æ»åæ•°æ®ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Flink æ—¶é—´æœºåˆ¶</b></p><p>flink æ”¯æŒä¸‰ç§æ—¶é—´æœºåˆ¶ï¼šäº‹ä»¶æ—¶é—´ï¼Œæ³¨å…¥æ—¶é—´ï¼Œå¤„ç†æ—¶é—´ï¼ŒåŒæ—¶æ”¯æŒ watermark æœºåˆ¶å¤„ç†æ»åæ•°æ®ã€‚</p><h2><b>#kafka åŠ¨æ€åˆ†åŒºæ£€æµ‹ </b></h2><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Streaming</b></p><p>å¯¹äºæœ‰å®æ—¶å¤„ç†ä¸šåŠ¡éœ€æ±‚çš„ä¼ä¸šï¼Œéšç€ä¸šåŠ¡å¢é•¿æ•°æ®é‡ä¹Ÿä¼šåŒæ­¥å¢é•¿ï¼Œå°†å¯¼è‡´åŸæœ‰çš„ kafka åˆ†åŒºæ•°ä¸æ»¡è¶³æ•°æ®å†™å…¥æ‰€éœ€çš„å¹¶å‘åº¦ï¼Œéœ€è¦æ‰©å±• kafka çš„åˆ†åŒºæˆ–è€…å¢åŠ  kafka çš„ topicï¼Œè¿™æ—¶å°±è¦æ±‚å®æ—¶å¤„ç†ç¨‹åºï¼Œå¦‚ SparkStreamingã€flink èƒ½æ£€æµ‹åˆ° kafka æ–°å¢çš„ topic ã€åˆ†åŒºåŠæ¶ˆè´¹æ–°å¢åˆ†åŒºçš„æ•°æ®ã€‚</p><p>æ¥ä¸‹æ¥ç»“åˆæºç åˆ†æï¼ŒSpark Streaming å’Œ flink åœ¨ kafka æ–°å¢ topic æˆ– partition æ—¶èƒ½å¦åŠ¨æ€å‘ç°æ–°å¢åˆ†åŒºå¹¶æ¶ˆè´¹å¤„ç†æ–°å¢åˆ†åŒºçš„æ•°æ®ã€‚ Spark Streaming ä¸ kafka ç»“åˆæœ‰ä¸¤ä¸ªåŒºåˆ«æ¯”è¾ƒå¤§çš„ç‰ˆæœ¬ï¼Œå¦‚å›¾ 9 æ‰€ç¤ºæ˜¯å®˜ç½‘ç»™å‡ºçš„å¯¹æ¯”æ•°æ®ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b2f982a551e247f4bcab023bbf96441f_b.jpg\" data-size=\"normal\" data-rawwidth=\"949\" data-rawheight=\"401\" class=\"origin_image zh-lightbox-thumb\" width=\"949\" data-original=\"https://pic4.zhimg.com/v2-b2f982a551e247f4bcab023bbf96441f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;949&#39; height=&#39;401&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"949\" data-rawheight=\"401\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"949\" data-original=\"https://pic4.zhimg.com/v2-b2f982a551e247f4bcab023bbf96441f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b2f982a551e247f4bcab023bbf96441f_b.jpg\"/><figcaption>å›¾ 9</figcaption></figure><p>å…¶ä¸­ç¡®è®¤çš„æ˜¯ Spark Streaming ä¸ kafka 0.8 ç‰ˆæœ¬ç»“åˆä¸æ”¯æŒåŠ¨æ€åˆ†åŒºæ£€æµ‹ï¼Œä¸ 0.10 ç‰ˆæœ¬ç»“åˆæ”¯æŒï¼Œæ¥ç€é€šè¿‡æºç åˆ†æã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Streaming ä¸ kafka 0.8 ç‰ˆæœ¬ç»“åˆ</b></p><p>*æºç åˆ†æåªé’ˆå¯¹åˆ†åŒºæ£€æµ‹</p><p>å…¥å£æ˜¯ DirectKafkaInputDStream çš„ computeï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">override def compute(validTime: Time): Option[KafkaRDD[K, V, U, T, R]] = {//    æ”¹è¡Œä»£ç ä¼šè®¡ç®—è¿™ä¸ªjobï¼Œè¦æ¶ˆè´¹çš„æ¯ä¸ªkafkaåˆ†åŒºçš„æœ€å¤§åç§»\n   val untilOffsets = clamp(latestLeaderOffsets(maxRetries))//    æ„å»ºKafkaRDDï¼Œç”¨æŒ‡å®šçš„åˆ†åŒºæ•°å’Œè¦æ¶ˆè´¹çš„offsetèŒƒå›´\n   val rdd = KafkaRDD[K, V, U, T, R](\n     context.sparkContext, kafkaParams, currentOffsets, untilOffsets, messageHandler)    // Report the record number and metadata of this batch interval to InputInfoTracker.\n   val offsetRanges = currentOffsets.map { case (tp, fo) =&gt;\n     val uo = untilOffsets(tp)      OffsetRange(tp.topic, tp.partition, fo, uo.offset)\n   }    val description = offsetRanges.filter { offsetRange =&gt;\n     // Don&#39;t display empty ranges.\n     offsetRange.fromOffset != offsetRange.untilOffset\n   }.map { offsetRange =&gt;\n     s&#34;topic: ${offsetRange.topic}\\tpartition: ${offsetRange.partition}\\t&#34; +\n       s&#34;offsets: ${offsetRange.fromOffset} to ${offsetRange.untilOffset}&#34;\n   }.mkString(&#34;\\n&#34;)    // Copy offsetRanges to immutable.List to prevent from being modified by the user\n   val metadata = Map(      &#34;offsets&#34; -&gt; offsetRanges.toList,      StreamInputInfo.METADATA_KEY_DESCRIPTION -&gt; description)    val inputInfo = StreamInputInfo(id, rdd.count, metadata)\n   ssc.scheduler.inputInfoTracker.reportInfo(validTime, inputInfo)\n\n   currentOffsets = untilOffsets.map(kv =&gt; kv._1 -&gt; kv._2.offset)    Some(rdd)\n }</code></pre></div><p>ç¬¬ä¸€è¡Œå°±æ˜¯è®¡ç®—å¾—åˆ°è¯¥æ‰¹æ¬¡ç”Ÿæˆ KafkaRDD æ¯ä¸ªåˆ†åŒºè¦æ¶ˆè´¹çš„æœ€å¤§ offsetã€‚ æ¥ç€çœ‹ latestLeaderOffsets(maxRetries)</p><div class=\"highlight\"><pre><code class=\"language-text\">@tailrec  protected final def latestLeaderOffsets(retries: Int): Map[TopicAndPartition, LeaderOffset] = {//    å¯ä»¥çœ‹åˆ°çš„æ˜¯ç”¨æ¥æŒ‡å®šè·å–æœ€å¤§åç§»åˆ†åŒºçš„åˆ—è¡¨è¿˜æ˜¯åªæœ‰currentOffsetsï¼Œæ²¡æœ‰å‘ç°å…³äºæ–°å¢çš„åˆ†åŒºçš„å†…å®¹ã€‚\n   val o = kc.getLatestLeaderOffsets(currentOffsets.keySet)    // Either.fold would confuse @tailrec, do it manually\n   if (o.isLeft) {      val err = o.left.get.toString      if (retries &lt;= 0) {        throw new SparkException(err)\n     } else {\n       logError(err)        Thread.sleep(kc.config.refreshLeaderBackoffMs)\n       latestLeaderOffsets(retries - 1)\n     }\n   } else {\n     o.right.get\n   }\n }</code></pre></div><p>å…¶ä¸­ <code>protected var currentOffsets = fromOffsets</code>ï¼Œè¿™ä¸ªä»…ä»…æ˜¯åœ¨æ„å»º DirectKafkaInputDStream çš„æ—¶å€™åˆå§‹åŒ–ï¼Œå¹¶åœ¨ compute é‡Œé¢æ›´æ–°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">currentOffsets = untilOffsets.map(kv =&gt; kv._1 -&gt; kv._2.offset)</code></pre></div><p>ä¸­é—´æ²¡æœ‰æ£€æµ‹ kafka æ–°å¢ topic æˆ–è€…åˆ†åŒºçš„ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥ç¡®è®¤ Spark Streaming ä¸ kafka 0.8 çš„ç‰ˆæœ¬ç»“åˆä¸æ”¯æŒåŠ¨æ€åˆ†åŒºæ£€æµ‹ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Streaming ä¸ kafka 0.10 ç‰ˆæœ¬ç»“åˆ</b></p><p>å…¥å£åŒæ ·æ˜¯ DirectKafkaInputDStream çš„ compute æ–¹æ³•ï¼Œæ¡ä¸»è¦çš„éƒ¨åˆ†è¯´ï¼ŒCompute é‡Œç¬¬ä¸€è¡Œä¹Ÿæ˜¯è®¡ç®—å½“å‰ job ç”Ÿæˆ kafkardd è¦æ¶ˆè´¹çš„æ¯ä¸ªåˆ†åŒºçš„æœ€å¤§ offsetï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">//    è·å–å½“å‰ç”Ÿæˆjobï¼Œè¦ç”¨åˆ°çš„KafkaRDDæ¯ä¸ªåˆ†åŒºæœ€å¤§æ¶ˆè´¹åç§»å€¼\n   val untilOffsets = clamp(latestOffsets())</code></pre></div><p>å…·ä½“æ£€æµ‹ kafka æ–°å¢ topic æˆ–è€…åˆ†åŒºçš„ä»£ç åœ¨ <code>latestOffsets()</code></p><div class=\"highlight\"><pre><code class=\"language-text\">/**   \n* Returns the latest (highest) available offsets, taking new partitions into account.   */\n protected def latestOffsets(): Map[TopicPartition, Long] = {    val c = consumer\n   paranoidPoll(c)    // è·å–æ‰€æœ‰çš„åˆ†åŒºä¿¡æ¯\n   val parts = c.assignment().asScala    // make sure new partitions are reflected in currentOffsets\n   // åšå·®è·å–æ–°å¢çš„åˆ†åŒºä¿¡æ¯\n   val newPartitions = parts.diff(currentOffsets.keySet)    // position for new partitions determined by auto.offset.reset if no commit\n   // æ–°åˆ†åŒºæ¶ˆè´¹ä½ç½®ï¼Œæ²¡æœ‰è®°å½•çš„åŒ–æ˜¯ç”±auto.offset.resetå†³å®š\n   currentOffsets = currentOffsets ++ newPartitions.map(tp =&gt; tp -&gt; c.position(tp)).toMap    // don&#39;t want to consume messages, so pause\n   c.pause(newPartitions.asJava)    // find latest available offsets\n   c.seekToEnd(currentOffsets.keySet.asJava)\n   parts.map(tp =&gt; tp -&gt; c.position(tp)).toMap\n }</code></pre></div><p>è¯¥æ–¹æ³•å†…æœ‰è·å– kafka æ–°å¢åˆ†åŒºï¼Œå¹¶å°†å…¶æ›´æ–°åˆ° currentOffsets çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥éªŒè¯ Spark Streaming ä¸ kafka 0.10 ç‰ˆæœ¬ç»“åˆæ”¯æŒåŠ¨æ€åˆ†åŒºæ£€æµ‹ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Flink</b></p><p>å…¥å£ç±»æ˜¯ FlinkKafkaConsumerBaseï¼Œè¯¥ç±»æ˜¯æ‰€æœ‰ flink çš„ kafka æ¶ˆè´¹è€…çš„çˆ¶ç±»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-464dc72e929ddb03f056950515c6fd9f_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"357\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-464dc72e929ddb03f056950515c6fd9f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;357&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"357\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-464dc72e929ddb03f056950515c6fd9f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-464dc72e929ddb03f056950515c6fd9f_b.jpg\"/><figcaption>å›¾ 10</figcaption></figure><p>åœ¨ FlinkKafkaConsumerBase çš„ run æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº† kafkaFetcherï¼Œå®é™…ä¸Šå°±æ˜¯æ¶ˆè´¹è€…ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">this.kafkaFetcher = createFetcher(\n       sourceContext,\n       subscribedPartitionsToStartOffsets,\n       periodicWatermarkAssigner,\n       punctuatedWatermarkAssigner,\n       (StreamingRuntimeContext) getRuntimeContext(),\n       offsetCommitMode,\n       getRuntimeContext().getMetricGroup().addGroup(KAFKA_CONSUMER_METRICS_GROUP),\n       useMetrics);</code></pre></div><p>æ¥æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šå®šæœŸæ£€æµ‹ kafka æ–°å¢åˆ†åŒºï¼Œç„¶åå°†å…¶æ·»åŠ åˆ° kafkaFetcher é‡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-text\">if (discoveryIntervalMillis != PARTITION_DISCOVERY_DISABLED) {      final AtomicReference&lt;Exception&gt; discoveryLoopErrorRef = new AtomicReference&lt;&gt;();      this.discoveryLoopThread = new Thread(new Runnable() {        @Override\n       public void run() {          try {            // --------------------- partition discovery loop ---------------------\n\n           List&lt;KafkaTopicPartition&gt; discoveredPartitions;            // throughout the loop, we always eagerly check if we are still running before\n           // performing the next operation, so that we can escape the loop as soon as possible\n\n           while (running) {              if (LOG.isDebugEnabled()) {                LOG.debug(&#34;Consumer subtask {} is trying to discover new partitions ...&#34;, getRuntimeContext().getIndexOfThisSubtask());\n             }              try {\n               discoveredPartitions = partitionDiscoverer.discoverPartitions();\n             } catch (AbstractPartitionDiscoverer.WakeupException | AbstractPartitionDiscoverer.ClosedException e) {                // the partition discoverer may have been closed or woken up before or during the discovery;\n               // this would only happen if the consumer was canceled; simply escape the loop\n               break;\n             }              // no need to add the discovered partitions if we were closed during the meantime\n             if (running &amp;&amp; !discoveredPartitions.isEmpty()) {\n               kafkaFetcher.addDiscoveredPartitions(discoveredPartitions);\n             }              // do not waste any time sleeping if we&#39;re not running anymore\n             if (running &amp;&amp; discoveryIntervalMillis != 0) {                try {                  Thread.sleep(discoveryIntervalMillis);\n               } catch (InterruptedException iex) {                  // may be interrupted if the consumer was canceled midway; simply escape the loop\n                 break;\n               }\n             }\n           }\n         } catch (Exception e) {\n           discoveryLoopErrorRef.set(e);\n         } finally {            // calling cancel will also let the fetcher loop escape\n           // (if not running, cancel() was already called)\n           if (running) {\n             cancel();\n           }\n         }\n       }\n     }, &#34;Kafka Partition Discovery for &#34; + getRuntimeContext().getTaskNameWithSubtasks());\n\n     discoveryLoopThread.start();\n     kafkaFetcher.runFetchLoop();</code></pre></div><p>ä¸Šé¢å°±æ˜¯ flink åŠ¨æ€å‘ç° kafka æ–°å¢åˆ†åŒºçš„è¿‡ç¨‹ã€‚ä¸è¿‡ä¸ Spark æ— éœ€åšä»»ä½•é…ç½®ä¸åŒçš„æ˜¯ï¼Œflink åŠ¨æ€å‘ç° kafka æ–°å¢åˆ†åŒºï¼Œè¿™ä¸ªåŠŸèƒ½éœ€è¦è¢«ä½¿èƒ½çš„ã€‚ä¹Ÿå¾ˆç®€å•ï¼Œéœ€è¦å°† flink.partition-discovery.interval-millis è¯¥å±æ€§è®¾ç½®ä¸ºå¤§äº 0 å³å¯ã€‚</p><h2><b>#å®¹é”™æœºåˆ¶åŠå¤„ç†è¯­ä¹‰</b></h2><p>æœ¬èŠ‚å†…å®¹ä¸»è¦æ˜¯æƒ³å¯¹æ¯”ä¸¤è€…åœ¨æ•…éšœæ¢å¤åŠå¦‚ä½•ä¿è¯ä»…ä¸€æ¬¡çš„å¤„ç†è¯­ä¹‰ã€‚è¿™ä¸ªæ—¶å€™é€‚åˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼šå®æ—¶å¤„ç†çš„æ—¶å€™ï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä»…ä¸€æ¬¡å¤„ç†è¯­ä¹‰ï¼Ÿ</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Streaming ä¿è¯ä»…ä¸€æ¬¡å¤„ç†</b></p><p>å¯¹äº Spark Streaming ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® checkpointï¼Œç„¶åå‡å¦‚å‘ç”Ÿæ•…éšœå¹¶é‡å¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸Šæ¬¡ checkpoint ä¹‹å¤„æ¢å¤ï¼Œä½†æ˜¯è¿™ä¸ªè¡Œä¸ºåªèƒ½ä½¿å¾—æ•°æ®ä¸ä¸¢å¤±ï¼Œå¯èƒ½ä¼šé‡å¤å¤„ç†ï¼Œä¸èƒ½åšåˆ°æ°ä¸€æ¬¡å¤„ç†è¯­ä¹‰ã€‚</p><p>å¯¹äº Spark Streaming ä¸ kafka ç»“åˆçš„ direct Stream å¯ä»¥è‡ªå·±ç»´æŠ¤ offset åˆ° zookeeperã€kafka æˆ–ä»»ä½•å…¶å®ƒå¤–éƒ¨ç³»ç»Ÿï¼Œæ¯æ¬¡æäº¤å®Œç»“æœä¹‹åå†æäº¤ offsetï¼Œè¿™æ ·æ•…éšœæ¢å¤é‡å¯å¯ä»¥åˆ©ç”¨ä¸Šæ¬¡æäº¤çš„ offset æ¢å¤ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚ä½†æ˜¯å‡å¦‚æ•…éšœå‘ç”Ÿåœ¨æäº¤ç»“æœä¹‹åã€æäº¤ offset ä¹‹å‰ä¼šå¯¼è‡´æ•°æ®å¤šæ¬¡å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯å¤„ç†ç»“æœå¤šæ¬¡è¾“å‡ºä¸å½±å“æ­£å¸¸çš„ä¸šåŠ¡ã€‚</p><p>ç”±æ­¤å¯ä»¥åˆ†æï¼Œå‡è®¾è¦ä¿è¯æ•°æ®æ°ä¸€æ¬¡å¤„ç†è¯­ä¹‰ï¼Œé‚£ä¹ˆç»“æœè¾“å‡ºå’Œ offset æäº¤å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å®Œæˆã€‚åœ¨è¿™é‡Œæœ‰ä»¥ä¸‹ä¸¤ç§åšæ³•ï¼š</p><ul><li>repartition(1) Spark Streaming è¾“å‡ºçš„ action å˜æˆä»…ä¸€ä¸ª partitionï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨äº‹åŠ¡å»åšï¼š</li></ul><div class=\"highlight\"><pre><code class=\"language-text\">Dstream.foreachRDD(rdd=&gt;{\n   rdd.repartition(1).foreachPartition(partition=&gt;{    //    å¼€å¯äº‹åŠ¡\n       partition.foreach(each=&gt;{//        æäº¤æ•°æ®\n       })    //  æäº¤äº‹åŠ¡\n   })\n })</code></pre></div><ul><li>å°†ç»“æœå’Œ offset ä¸€èµ·æäº¤</li></ul><p>ä¹Ÿå°±æ˜¯ç»“æœæ•°æ®åŒ…å« offsetã€‚è¿™æ ·æäº¤ç»“æœå’Œæäº¤ offset å°±æ˜¯ä¸€ä¸ªæ“ä½œå®Œæˆï¼Œä¸ä¼šæ•°æ®ä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šé‡å¤å¤„ç†ã€‚æ•…éšœæ¢å¤çš„æ—¶å€™å¯ä»¥åˆ©ç”¨ä¸Šæ¬¡æäº¤ç»“æœå¸¦çš„ offsetã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Flink ä¸ kafka 0.11 ä¿è¯ä»…ä¸€æ¬¡å¤„ç†</b></p><p>è‹¥è¦ sink æ”¯æŒä»…ä¸€æ¬¡è¯­ä¹‰ï¼Œå¿…é¡»ä»¥äº‹åŠ¡çš„æ–¹å¼å†™æ•°æ®åˆ° Kafkaï¼Œè¿™æ ·å½“æäº¤äº‹åŠ¡æ—¶ä¸¤æ¬¡ checkpoint é—´çš„æ‰€æœ‰å†™å…¥æ“ä½œä½œä¸ºä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ã€‚è¿™ç¡®ä¿äº†å‡ºç°æ•…éšœæˆ–å´©æºƒæ—¶è¿™äº›å†™å…¥æ“ä½œèƒ½å¤Ÿè¢«å›æ»šã€‚</p><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ä¸”å«æœ‰å¤šä¸ªå¹¶å‘æ‰§è¡Œ sink çš„åº”ç”¨ä¸­ï¼Œä»…ä»…æ‰§è¡Œå•æ¬¡æäº¤æˆ–å›æ»šæ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæ‰€æœ‰ç»„ä»¶éƒ½å¿…é¡»å¯¹è¿™äº›æäº¤æˆ–å›æ»šè¾¾æˆå…±è¯†ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å¾—åˆ°ä¸€è‡´æ€§çš„ç»“æœã€‚Flink ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®ä»¥åŠé¢„æäº¤(pre-commit)é˜¶æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æœ¬ä¾‹ä¸­çš„ Flink åº”ç”¨å¦‚å›¾ 11 æ‰€ç¤ºåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li>ä¸€ä¸ªsourceï¼Œä»Kafkaä¸­è¯»å–æ•°æ®ï¼ˆå³KafkaConsumerï¼‰</li><li>ä¸€ä¸ªæ—¶é—´çª—å£åŒ–çš„èšä¼šæ“ä½œ</li><li>ä¸€ä¸ªsinkï¼Œå°†ç»“æœå†™å›åˆ°Kafkaï¼ˆå³KafkaProducerï¼‰</li></ul><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-6ddb9500ecbfe0162750902478dec4d7_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"447\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-6ddb9500ecbfe0162750902478dec4d7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;447&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"447\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-6ddb9500ecbfe0162750902478dec4d7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-6ddb9500ecbfe0162750902478dec4d7_b.jpg\"/><figcaption>å›¾ 11</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ä¸‹é¢è¯¦ç»†è®²è§£ flink çš„ä¸¤æ®µæäº¤æ€è·¯ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e1d8e4f58b402e81785682baae9df647_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"416\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-e1d8e4f58b402e81785682baae9df647_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;416&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"416\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-e1d8e4f58b402e81785682baae9df647_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-e1d8e4f58b402e81785682baae9df647_b.jpg\"/><figcaption>å›¾ 12</figcaption></figure><p>å¦‚å›¾ 12 æ‰€ç¤ºï¼ŒFlink checkpointing å¼€å§‹æ—¶ä¾¿è¿›å…¥åˆ° pre-commit é˜¶æ®µã€‚å…·ä½“æ¥è¯´ï¼Œä¸€æ—¦ checkpoint å¼€å§‹ï¼ŒFlink çš„ JobManager å‘è¾“å…¥æµä¸­å†™å…¥ä¸€ä¸ª checkpoint barrier ï¼Œå°†æµä¸­æ‰€æœ‰æ¶ˆæ¯åˆ†å‰²æˆå±äºæœ¬æ¬¡ checkpoint çš„æ¶ˆæ¯ä»¥åŠå±äºä¸‹æ¬¡ checkpoint çš„ï¼Œbarrier ä¹Ÿä¼šåœ¨æ“ä½œç®—å­é—´æµè½¬ã€‚å¯¹äºæ¯ä¸ª operator æ¥è¯´ï¼Œè¯¥ barrier ä¼šè§¦å‘ operator çŠ¶æ€åç«¯ä¸ºè¯¥ operator çŠ¶æ€æ‰“å¿«ç…§ã€‚data source ä¿å­˜äº† Kafka çš„ offsetï¼Œä¹‹åæŠŠ checkpoint barrier ä¼ é€’åˆ°åç»­çš„ operatorã€‚</p><p>è¿™ç§æ–¹å¼ä»…é€‚ç”¨äº operator ä»…æœ‰å®ƒçš„å†…éƒ¨çŠ¶æ€ã€‚å†…éƒ¨çŠ¶æ€æ˜¯æŒ‡ Flink state backends ä¿å­˜å’Œç®¡ç†çš„å†…å®¹ï¼ˆå¦‚ç¬¬äºŒä¸ª operator ä¸­ window èšåˆç®—å‡ºæ¥çš„ sumï¼‰ã€‚</p><p>å½“ä¸€ä¸ªè¿›ç¨‹ä»…æœ‰å®ƒçš„å†…éƒ¨çŠ¶æ€çš„æ—¶å€™ï¼Œé™¤äº†åœ¨ checkpoint ä¹‹å‰å°†éœ€è¦å°†æ•°æ®æ›´æ”¹å†™å…¥åˆ° state backendï¼Œä¸éœ€è¦åœ¨é¢„æäº¤é˜¶æ®µåšå…¶ä»–çš„åŠ¨ä½œã€‚åœ¨ checkpoint æˆåŠŸçš„æ—¶å€™ï¼ŒFlink ä¼šæ­£ç¡®çš„æäº¤è¿™äº›å†™å…¥ï¼Œåœ¨ checkpoint å¤±è´¥çš„æ—¶å€™ä¼šç»ˆæ­¢æäº¤ï¼Œè¿‡ç¨‹å¯è§å›¾ 13ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5bdfea49d752c7d6fcf264f18c96dbb0_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"468\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic1.zhimg.com/v2-5bdfea49d752c7d6fcf264f18c96dbb0_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;468&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"468\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic1.zhimg.com/v2-5bdfea49d752c7d6fcf264f18c96dbb0_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-5bdfea49d752c7d6fcf264f18c96dbb0_b.jpg\"/><figcaption>å›¾ 13</figcaption></figure><p>å½“ç»“åˆå¤–éƒ¨ç³»ç»Ÿçš„æ—¶å€™ï¼Œå¤–éƒ¨ç³»ç»Ÿå¿…é¡»è¦æ”¯æŒå¯ä¸ä¸¤é˜¶æ®µæäº¤åè®®æ†ç»‘ä½¿ç”¨çš„äº‹åŠ¡ã€‚æ˜¾ç„¶æœ¬ä¾‹ä¸­çš„ sink ç”±äºå¼•å…¥äº† kafka sinkï¼Œå› æ­¤åœ¨é¢„æäº¤é˜¶æ®µ data sink å¿…é¡»é¢„æäº¤å¤–éƒ¨äº‹åŠ¡ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-21006c748b180b34883a87518074e946_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"446\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic3.zhimg.com/v2-21006c748b180b34883a87518074e946_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;446&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"446\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic3.zhimg.com/v2-21006c748b180b34883a87518074e946_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-21006c748b180b34883a87518074e946_b.jpg\"/><figcaption>å›¾ 14</figcaption></figure><p>å½“ barrier åœ¨æ‰€æœ‰çš„ç®—å­ä¸­ä¼ é€’ä¸€éï¼Œå¹¶ä¸”è§¦å‘çš„å¿«ç…§å†™å…¥å®Œæˆï¼Œé¢„æäº¤é˜¶æ®µå®Œæˆã€‚æ‰€æœ‰çš„è§¦å‘çŠ¶æ€å¿«ç…§éƒ½è¢«è§†ä¸º checkpoint çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥è¯´ checkpoint æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„çŠ¶æ€å¿«ç…§ï¼ŒåŒ…æ‹¬é¢„æäº¤å¤–éƒ¨çŠ¶æ€ã€‚å‡ºç°æ•…éšœå¯ä»¥ä» checkpoint æ¢å¤ã€‚ä¸‹ä¸€æ­¥å°±æ˜¯é€šçŸ¥æ‰€æœ‰çš„æ“ä½œç®—å­ checkpoint æˆåŠŸã€‚è¯¥é˜¶æ®µ jobmanager ä¼šä¸ºæ¯ä¸ª operator å‘èµ· checkpoint å·²å®Œæˆçš„å›è°ƒé€»è¾‘ã€‚</p><p>æœ¬ä¾‹ä¸­ data source å’Œçª—å£æ“ä½œæ— å¤–éƒ¨çŠ¶æ€ï¼Œå› æ­¤è¯¥é˜¶æ®µï¼Œè¿™ä¸¤ä¸ªç®—å­æ— éœ€æ‰§è¡Œä»»ä½•é€»è¾‘ï¼Œä½†æ˜¯ data sink æ˜¯æœ‰å¤–éƒ¨çŠ¶æ€çš„ï¼Œå› æ­¤ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»æäº¤å¤–éƒ¨äº‹åŠ¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c25efe242c955d1cd3d1a6560eb7fe97_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"399\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-c25efe242c955d1cd3d1a6560eb7fe97_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;399&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"399\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic4.zhimg.com/v2-c25efe242c955d1cd3d1a6560eb7fe97_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-c25efe242c955d1cd3d1a6560eb7fe97_b.jpg\"/><figcaption>å›¾ 15</figcaption></figure><p>ä»¥ä¸Šå°±æ˜¯ flink å®ç°æ°ä¸€æ¬¡å¤„ç†çš„åŸºæœ¬é€»è¾‘ã€‚</p><h2><b>#Back pressure </b></h2><p>æ¶ˆè´¹è€…æ¶ˆè´¹çš„é€Ÿåº¦ä½äºç”Ÿäº§è€…ç”Ÿäº§çš„é€Ÿåº¦ï¼Œä¸ºäº†ä½¿åº”ç”¨æ­£å¸¸ï¼Œæ¶ˆè´¹è€…ä¼šåé¦ˆç»™ç”Ÿäº§è€…æ¥è°ƒèŠ‚ç”Ÿäº§è€…ç”Ÿäº§çš„é€Ÿåº¦ï¼Œä»¥ä½¿å¾—æ¶ˆè´¹è€…éœ€è¦å¤šå°‘ï¼Œç”Ÿäº§è€…ç”Ÿäº§å¤šå°‘ã€‚</p><blockquote>*back pressure åé¢ä¸€å¾‹ç§°ä¸ºèƒŒå‹ã€‚</blockquote><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Spark Streaming çš„èƒŒå‹</b><br/>Spark Streaming è·Ÿ kafka ç»“åˆæ˜¯å­˜åœ¨èƒŒå‹æœºåˆ¶çš„ï¼Œç›®æ ‡æ˜¯æ ¹æ®å½“å‰ job çš„å¤„ç†æƒ…å†µæ¥è°ƒèŠ‚åç»­æ‰¹æ¬¡çš„è·å– kafka æ¶ˆæ¯çš„æ¡æ•°ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼ŒSpark Streaming åœ¨åŸæœ‰çš„æ¶æ„ä¸ŠåŠ å…¥äº†ä¸€ä¸ª RateControllerï¼Œåˆ©ç”¨çš„ç®—æ³•æ˜¯ PIDï¼Œéœ€è¦çš„åé¦ˆæ•°æ®æ˜¯ä»»åŠ¡å¤„ç†çš„ç»“æŸæ—¶é—´ã€è°ƒåº¦æ—¶é—´ã€å¤„ç†æ—¶é—´ã€æ¶ˆæ¯æ¡æ•°ï¼Œè¿™äº›æ•°æ®æ˜¯é€šè¿‡ SparkListener ä½“ç³»è·å¾—ï¼Œç„¶åé€šè¿‡ PIDRateEsimator çš„ compute è®¡ç®—å¾—åˆ°ä¸€ä¸ªé€Ÿç‡ï¼Œè¿›è€Œå¯ä»¥è®¡ç®—å¾—åˆ°ä¸€ä¸ª offsetï¼Œç„¶åè·Ÿé™é€Ÿè®¾ç½®æœ€å¤§æ¶ˆè´¹æ¡æ•°æ¯”è¾ƒå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆè¦æ¶ˆè´¹çš„æ¶ˆæ¯æœ€å¤§ offsetã€‚</p><p>PIDRateEsimator çš„ compute æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">def compute(      time: Long, // in milliseconds\n     numElements: Long,      processingDelay: Long, // in milliseconds\n     schedulingDelay: Long // in milliseconds\n   ): Option[Double] = {\n   logTrace(s&#34;\\ntime = $time, # records = $numElements, &#34; +\n     s&#34;processing time = $processingDelay, scheduling delay = $schedulingDelay&#34;)    this.synchronized {      if (time &gt; latestTime &amp;&amp; numElements &gt; 0 &amp;&amp; processingDelay &gt; 0) {        val delaySinceUpdate = (time - latestTime).toDouble / 1000\n\n       val processingRate = numElements.toDouble / processingDelay * 1000\n\n       val error = latestRate - processingRate        val historicalError = schedulingDelay.toDouble * processingRate / batchIntervalMillis        // in elements/(second ^ 2)\n       val dError = (error - latestError) / delaySinceUpdate        val newRate = (latestRate - proportional * error -\n                                   integral * historicalError -\n                                   derivative * dError).max(minRate)\n       logTrace(s&#34;&#34;&#34;            | latestRate = $latestRate, error = $error            | latestError = $latestError, historicalError = $historicalError            | delaySinceUpdate = $delaySinceUpdate, dError = $dError            &#34;&#34;&#34;.stripMargin)\n\n       latestTime = time        if (firstRun) {\n         latestRate = processingRate\n         latestError = 0D\n         firstRun = false\n         logTrace(&#34;First run, rate estimation skipped&#34;)          None\n       } else {\n         latestRate = newRate\n         latestError = error\n         logTrace(s&#34;New rate = $newRate&#34;)          Some(newRate)\n       }\n     } else {\n       logTrace(&#34;Rate estimation skipped&#34;)        None\n     }\n   }\n }</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p><b>Flink çš„èƒŒå‹</b></p><p>ä¸ Spark Streaming çš„èƒŒå‹ä¸åŒçš„æ˜¯ï¼ŒFlink èƒŒå‹æ˜¯ jobmanager é’ˆå¯¹æ¯ä¸€ä¸ª task æ¯ 50ms è§¦å‘ 100 æ¬¡ Thread.getStackTrace() è°ƒç”¨ï¼Œæ±‚å‡ºé˜»å¡çš„å æ¯”ã€‚è¿‡ç¨‹å¦‚å›¾ 16 æ‰€ç¤ºï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-14c45bea98727bd6358e3c89412d4098_b.jpg\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb\" width=\"865\" data-original=\"https://pic1.zhimg.com/v2-14c45bea98727bd6358e3c89412d4098_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;865&#39; height=&#39;345&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"865\" data-rawheight=\"345\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"865\" data-original=\"https://pic1.zhimg.com/v2-14c45bea98727bd6358e3c89412d4098_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-14c45bea98727bd6358e3c89412d4098_b.jpg\"/><figcaption>å›¾ 16</figcaption></figure><p>é˜»å¡å æ¯”åœ¨ web ä¸Šåˆ’åˆ†äº†ä¸‰ä¸ªç­‰çº§ï¼š</p><ul><li><b>OK</b>: 0 &lt;= Ratio &lt;= 0.10ï¼Œè¡¨ç¤ºçŠ¶æ€è‰¯å¥½ï¼›</li><li><b>LOW</b>: 0.10 &lt; Ratio &lt;= 0.5ï¼Œè¡¨ç¤ºæœ‰å¾…è§‚å¯Ÿï¼›</li><li><b>HIGH</b>: 0.5 &lt; Ratio &lt;= 1ï¼Œè¡¨ç¤ºè¦å¤„ç†äº†ã€‚</li></ul><p>ï¼ˆå®Œï¼‰</p><h2><b>æ·±åœ³åœ°åŒºç¦åˆ©ï¼</b></h2><p>ç¾å›¾çš„å¤§æ•°æ®å›¢é˜Ÿåœ¨è¿‘å‡ å¹´çš„å‘å±•ä¸­ï¼Œé€æ­¥æ¼”è¿›å’Œå‘å±•å‡ºç¾å›¾çš„å¤§æ•°æ®ä½“ç³»ï¼Œä»¥åŠåœ¨ç¾å›¾ä¸šåŠ¡åœºæ™¯ä¸‹æ•°æ®æŠ€æœ¯åº”ç”¨çš„æœ€ä½³å®è·µã€‚8æœˆ11æ—¥æˆ‘ä»¬å°†åœ¨æ·±åœ³å¼€è®¾ä¸€åœºæŠ€æœ¯æ²™é¾™ï¼Œæˆ‘ä»¬é‚€è¯·äº†æ¥è‡ªç¾å›¾å…¬å¸çš„å¤§æ•°æ®è´Ÿè´£äººã€æ¶æ„å¸ˆã€é­…æ—å…¬å¸çš„æ•°æ®æŠ€æœ¯ä¸“å®¶ã€ä»¥åŠæ¥è‡ª Apache kylin çš„ PMCã€‚ç¾å›¾çš„å¤§æ•°æ®æŠ€æœ¯è´Ÿè´£äººå’Œæ¶æ„å¸ˆä¼šä¸ºå¤§å®¶åˆ†äº«ç¾å›¾åœ¨å¤§æ•°æ®æŠ€æœ¯ä¸Šçš„æ¢ç´¢ã€å¤§æ•°æ®çš„æ¶æ„ã€ä»¥åŠæ•°æ®æŠ€æœ¯çš„åº”ç”¨è½åœ°ã€‚é­…æ—çš„æ•°æ®æŠ€æœ¯ä¸“å®¶ä¼šä¸ºå¤§å®¶ä»‹ç»é­…æ—çš„ DMP ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ä»¥åŠç³»ç»Ÿçš„æ¼”è¿›å†ç¨‹ã€‚æ¥è‡ª Apache é¡¶çº§é¡¹ç›® kylin çš„æ¶æ„å¸ˆä¼šä¸ºå¤§å®¶åˆ†äº« kylin çš„æŠ€æœ¯åŸç†ä¸åº”ç”¨å®è·µã€‚å››ä½æŠ€æœ¯ä¸“å®¶ä¼šä»å¤šä¸ªè§’åº¦ä¸åŒå±‚æ¬¡ï¼Œä¸ºå¤§å®¶åˆ†äº«å„è‡ªåœ¨å¤§æ•°æ®æŠ€æœ¯ä¸Šçš„å®è·µç»éªŒã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>è¯¦æƒ…è§æŠ¥åé“¾æ¥ï¼š<a href=\"https://link.zhihu.com/?target=https%3A//www.bagevent.com/event/1106376%3Fpreview%3D1\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤§æ•°æ®æ¶æ„ä¸æ•°æ®æŠ€æœ¯åº”ç”¨å®è·µ -ç™¾æ ¼æ´»åŠ¨</a></p>", 
            "topic": [
                {
                    "tag": "Spark", 
                    "tagLink": "https://api.zhihu.com/topics/19942170"
                }, 
                {
                    "tag": "Flink", 
                    "tagLink": "https://api.zhihu.com/topics/20043072"
                }, 
                {
                    "tag": "å¤§æ•°æ®", 
                    "tagLink": "https://api.zhihu.com/topics/19740929"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/40340710", 
            "userName": "MTé…±", 
            "userLink": "https://www.zhihu.com/people/28629950b8d6033df6b6f33fd0280e2a", 
            "upvote": 8, 
            "title": "Hello Spark!", 
            "content": "<p>æ¬¢è¿é˜…è¯»ç¾å›¾æ•°æ®æŠ€æœ¯å›¢é˜Ÿçš„ã€ŒSparkï¼Œä»å…¥é—¨åˆ°ç²¾é€šã€ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« å°†ç”±æµ…å…¥æ·±ä¸ºå¤§å®¶ä»‹ç» Sparkï¼Œä»æ¡†æ¶å…¥é—¨åˆ°åº•å±‚æ¶æ„çš„å®ç°ï¼Œç›¸ä¿¡æ€»æœ‰ä¸€ç§å§¿åŠ¿é€‚åˆä½ ï¼Œæ¬¢è¿å¤§å®¶æŒç»­å…³æ³¨ï¼šï¼‰</p><h2><b>ä»€ä¹ˆæ˜¯Sparkï¼Ÿ</b></h2><p>Spark æ˜¯ UC Berkeley AMP lab æ‰€å¼€æºçš„ç±» Hadoop MapReduce çš„é€šç”¨å¹¶è¡Œæ¡†æ¶ï¼Œæ˜¯ä¸“ä¸ºå¤§è§„æ¨¡æ•°æ®å¤„ç†è€Œè®¾è®¡çš„å¿«é€Ÿé€šç”¨çš„å¤§æ•°æ®å¤„ç†å¼•æ“åŠè½»é‡çº§çš„å¤§æ•°æ®å¤„ç†ç»Ÿä¸€å¹³å°ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>å½“æˆ‘ä»¬åœ¨è°ˆ Spark çš„æ—¶å€™å¯èƒ½æ˜¯æŒ‡ä¸€ä¸ª Spark åº”ç”¨ç¨‹åºï¼Œæ›¿ä»£ MapReduce è¿è¡Œåœ¨ Yarnä¸Šï¼Œå­˜å‚¨åœ¨ HDFS ä¸Šçš„ä¸€ä¸ªå¤§æ•°æ®æ‰¹å¤„ç†ç¨‹åºï¼›ä¹Ÿå¯èƒ½æ˜¯æŒ‡ä½¿ç”¨åŒ…å« Spark sqlã€Spark streaming ç­‰å­é¡¹ç›®ï¼›ç”šè‡³ Tachyonã€Mesos ç­‰å¤§æ•°æ®å¤„ç†çš„ç»Ÿä¸€å¹³å°ï¼Œæˆ–è€…ç§°ä¸º Spark ç”Ÿæ€ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-871ae18c969e8b93c7e1bd7a68b2bceb_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"590\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-871ae18c969e8b93c7e1bd7a68b2bceb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;590&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"590\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-871ae18c969e8b93c7e1bd7a68b2bceb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-871ae18c969e8b93c7e1bd7a68b2bceb_b.jpg\"/><figcaption>å›¾ 1</figcaption></figure><p>å‘å±•è‡³ä»Šï¼ŒSpark å·²ä¸ä»…ä»…æ˜¯ MapReduce çš„æ›¿æ¢æ–¹æ¡ˆï¼Œå®ƒå·²ç»å‘å‡ºæˆäº†ä¸€ä¸ªåŒ…å«ä¼—å¤šå­é¡¹ç›®çš„ Spark ç”Ÿæ€ã€‚å¦‚å›¾ 1 æ‰€ç¤ºï¼ŒSpark ç”Ÿæ€å¯åˆ†ä¸ºå››å±‚ï¼š</p><ul><li>æ•°æ®å­˜å‚¨å±‚ï¼Œä»¥ HDFS ã€Tachyon ä¸ºä»£è¡¨çš„ä¸€äº›åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿæˆ–å„ç§æ•°æ®åº“ï¼›</li><li>èµ„æºç®¡ç†å±‚ï¼ŒYarnã€Mesos ç­‰èµ„æºç®¡ç†å™¨ï¼›</li><li>æ•°æ®å¤„ç†å¼•æ“ï¼›</li><li>åº”ç”¨å±‚ï¼Œä»¥ Spark ä¸ºåŸºç¡€äº§ç”Ÿçš„ä¼—å¤šé¡¹ç›®;<br/></li></ul><p>Spark SQL æä¾› HiveQLï¼ˆé€šè¿‡ Apache Hive çš„ SQL å˜ä½“ Hive æŸ¥è¯¢è¯­è¨€ï¼‰ä¸Spark è¿›è¡Œäº¤äº’çš„ APIã€‚æ¯ä¸ªæ•°æ®åº“è¡¨è¢«å½“åšä¸€ä¸ª RDDï¼ŒSpark SQL æŸ¥è¯¢è¢«è½¬æ¢ä¸º Spark æ“ä½œã€‚Spark Streaming å¯¹å®æ—¶æ•°æ®æµè¿›è¡Œå¤„ç†å’Œæ§åˆ¶ï¼Œå®ƒå…è®¸ç¨‹åºèƒ½å¤Ÿåƒæ™®é€š RDD ä¸€æ ·å¤„ç†å®æ—¶æ•°æ®ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>æ¥ä¸‹æ¥çš„ç³»åˆ—æ–‡ç« å°†ä¼šè¯¦ç»†ä»‹ç» Spark ç”Ÿæ€ä¸­çš„å…¶ä»–æ¨¡å—ä¸å„ä¸ªå­é¡¹ç›®ï¼Œæ¥ä¸‹æ¥å°†é€šè¿‡ä¸ MapReduce çš„å¯¹æ¯”æ¥ä»‹ç»æ•°æ®å¤„ç†å¼•æ“Sparkçš„ç‰¹ç‚¹åŠå…¶åŸç†ã€‚</p><h2><b>Sparkçš„ç‰¹ç‚¹</b></h2><p>æ ¹æ®è°·æ­Œå’Œç™¾åº¦çš„æœç´¢ç»“æœæ˜¾ç¤ºï¼ŒSpark çš„æœç´¢è¶‹åŠ¿å·²ä¸ Hadoop æŒå¹³ç”šè‡³èµ¶è¶…ï¼Œæ ‡å¿—ç€ Spark å·²ç»æˆä¸ºè®¡ç®—éƒ¨åˆ†çš„äº‹å®æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯è¯´å¤§æ•°æ®æŠ€æœ¯ç»•ä¸å¼€ Spark äº†ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨å¤§æ•°æ®çš„å­˜å‚¨ã€è®¡ç®—ã€èµ„æºè°ƒåº¦ä¸­ï¼ŒSpark ä¸»è¦è§£å†³è®¡ç®—é—®é¢˜ï¼Œå³ä¸»è¦æ›¿ä»£ Mapreduce çš„åŠŸèƒ½ï¼Œåº•å±‚å­˜å‚¨å’Œèµ„æºè°ƒåº¦å¾ˆå¤šå…¬å¸ä»ç„¶é€‰æ‹©ä½¿ç”¨ HDFSã€Yarn æ¥æ‰¿è½½ã€‚ä¸ºä»€ä¹ˆä¼—å¤šä¼ä¸šåœ¨ Hadoop ç”Ÿæ€æ¡†æ¶é‡Œéƒ½é€‰æ‹©ç”¨ Spark ä½œä¸ºå¤„ç†å¼•æ“ï¼Ÿè®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹å®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹ã€‚</p><p><b>1.é€Ÿåº¦å¿«</b>ã€‚Spark åŸºäºå†…å­˜è¿›è¡Œè®¡ç®—ï¼ˆ ä¹Ÿæœ‰éƒ¨åˆ†è®¡ç®—åŸºäºç£ç›˜ï¼‰ ï¼› </p><p><b>2.å®¹æ˜“ä¸Šæ‰‹å¼€å‘</b>ã€‚ Spark åŸºäº RDD çš„è®¡ç®—æ¨¡å‹ï¼Œ æ¯” Hadoop åŸºäº Map-Reduce çš„è®¡ç®—æ¨¡å‹è¦æ›´æ˜“äºç†è§£ã€æ˜“äºä¸Šæ‰‹å¼€å‘å®ç°å„ç§å¤æ‚åŠŸèƒ½ï¼Œå¦‚äºŒæ¬¡æ’åºã€ topN ç­‰å¤æ‚æ“ä½œæ—¶æ›´åŠ ä¾¿æ·ã€‚ï¼›</p><p><b>3.è¶…å¼ºçš„é€šç”¨æ€§</b>ã€‚ Spark æä¾›äº† Spark RDDã€ Spark SQLã€ Spark Streamingã€ Spark MLlibã€ Spark GraphX ç­‰æŠ€æœ¯ç»„ä»¶ï¼Œ å¯ä»¥ä¸€ç«™å¼åœ°å®Œæˆå¤§æ•°æ®é¢†åŸŸçš„ç¦»çº¿æ‰¹å¤„ç†ã€ äº¤äº’å¼æŸ¥è¯¢ã€ æµå¼è®¡ç®—ã€ æœºå™¨å­¦ä¹ ã€å›¾è®¡ç®—ç­‰å¸¸è§çš„ä»»åŠ¡ï¼›</p><p><b>4.é›†æˆ Hadoop</b>ã€‚ Spark å¯ä»¥å®Œç¾é›†æˆ Hadoopã€‚ Hadoop çš„ HDFSã€ Hiveã€HBase è´Ÿè´£å­˜å‚¨ï¼Œ Yarn è´Ÿè´£èµ„æºè°ƒåº¦ï¼Œ Spark è´Ÿè´£å¤§æ•°æ®è®¡ç®—æ˜¯æ¯”è¾ƒæµè¡Œçš„å¤§æ•°æ®è§£å†³æ–¹æ¡ˆã€‚ </p><p><b>4.æé«˜çš„æ´»è·ƒåº¦</b>ã€‚ Spark ç›®å‰æ˜¯ Apache åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ï¼Œ å…¨ä¸–ç•Œæœ‰å¤§é‡çš„ä¼˜ç§€å·¥ç¨‹å¸ˆæ˜¯ Spark çš„ committerï¼Œ å¹¶ä¸”ä¸–ç•Œä¸Šå¾ˆå¤šé¡¶çº§çš„ IT å…¬å¸éƒ½åœ¨å¤§è§„æ¨¡åœ°ä½¿ç”¨Sparkã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>çœ‹çœ‹åŒæ ·æ˜¯è´Ÿè´£è®¡ç®—é—®é¢˜çš„ MapReduceï¼Œå¦‚å›¾ 2 æ‰€ç¤ºæ˜¯ MapReduce è®¡ç®— WordCountã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-db90c9403a510ddaf4717488aabaf827_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"788\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-db90c9403a510ddaf4717488aabaf827_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;788&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"788\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-db90c9403a510ddaf4717488aabaf827_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-db90c9403a510ddaf4717488aabaf827_b.jpg\"/><figcaption>å›¾ 2</figcaption></figure><p>MapReduce è§£å†³äº†å¤§æ•°æ®å¤„ç†ä¸­å¤šç§åœºæ™¯é—®é¢˜ï¼Œä½†æ˜¯å®ƒçš„å±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p><ul><li>MapReduce åªæä¾› Map å’Œ Reduce ä¸¤ä¸ªæ“ä½œï¼Œæ¬ ç¼ºè¡¨è¾¾åŠ›ï¼Œå¤æ‚çš„è®¡ç®—éœ€è¦å¤§é‡çš„ Job æ‰èƒ½å®Œæˆã€‚</li><li>ä¸­é—´ç»“æœä¹Ÿæ”¾åœ¨ HDFS æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¿­ä»£è®¡ç®—çš„è¯æ•ˆç‡å¾ˆä½ã€‚</li><li>é€‚ç”¨ Batch æ•°æ®å¤„ç†ï¼Œå¯¹äºäº¤äº’å¼æ•°æ®å¤„ç†è€Œè¨€å®æ—¶æ•°æ®å¤„ç†çš„æ”¯æŒä¸å¤Ÿã€‚</li><li>éœ€è¦å†™å¾ˆå¤šåº•å±‚ä»£ç ï¼Œéš¾ä¸Šæ‰‹ã€‚å¦‚ä¸Šæ‰€ç¤ºçš„ WordCount ç¨‹åºè‡³å°‘éœ€è¦ä¸‰ä¸ª java ç±»ï¼šMap ç±»ã€Reduce ç±»ã€Job ç±»ï¼Œè¿™é‡Œä¸è¯¦ç»†åˆ—å‡ºã€‚</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><p>è®¸å¤šé¡¹ç›®é’ˆå¯¹å®ƒçš„å±€é™æ€§è¿›è¡Œäº†æ”¹è¿›ï¼ˆå¦‚ Tez ç­‰ï¼‰ï¼Œæ¥ç€çœ‹å›¾ 3 ä¸­ Spark çš„å…·ä½“æ“ä½œæµç¨‹ï¼š</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-807678a422802cc77eb5a85442150ab4_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"535\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-807678a422802cc77eb5a85442150ab4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;535&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"535\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-807678a422802cc77eb5a85442150ab4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-807678a422802cc77eb5a85442150ab4_b.jpg\"/><figcaption>å›¾ 3</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Spark æä¾›äº†ä¸°å¯Œçš„ç®—å­ï¼ˆtextFileã€FlatMapã€Mapã€ReduceByKey ç­‰ï¼‰ï¼Œåœ¨è®¡ç®—çš„ä¸­é—´ç»“æœä¹Ÿæ²¡æœ‰å­˜å‚¨åˆ° HDFS çš„æ“ä½œã€‚ç„¶åï¼Œå¯¹äºä¸Šå›¾çš„ WordCount ç¨‹åºï¼ŒSpark åªéœ€è¦å¦‚ä¸‹ä¸€è¡Œä»£ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-text\">sc.textFile(s&#34;${path}&#34;).flatMap(_.split(&#34; &#34;)).map(word =&gt; (word, 1)).reduceByKey(_ + _).saveAsTextFile(&#34;hdfs://xxx&#34;)</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><p>å›¾ 4 åˆ—ä¸¾äº† Spark å’Œ MapReduce ä½œä¸ºæ•°æ®å¤„ç†å¼•æ“çš„ä¸€äº›å¯¹æ¯”ã€‚å€¼å¾—ä¸€æçš„æ˜¯å…³äºæ•°æ®å¤„ç†çš„è§„æ¨¡ï¼ŒSpark åœ¨è¯ç”Ÿåï¼Œç¤¾åŒºé‡Œæœ‰å¾ˆå¤šè´¨ç–‘ Spark å¤„ç†æ•°æ®è§„æ¨¡çš„å£°éŸ³ï¼Œéšåå®˜æ–¹ç»™å‡ºäº†å¯¹äºä¸€ PB æ•°æ®æ’åºçš„å®éªŒï¼Œå¹¶ä¸”å¤„ç†æ—¶é—´æ‰“ç ´äº†å½“æ—¶çš„è®°å½•ã€‚ä½†æˆ‘ä»¬ä¹Ÿä¸èƒ½å¿½è§†ï¼Œåœ¨å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¢å¯¹çš„ä¸æ˜¯ä¸€ä¸ªç¨‹åºæˆ–è€…ä¸€ä¸ªä»»åŠ¡ï¼Œåœ¨åŒä¸€ä¸ªé›†ç¾¤ï¼Œå¦‚æœæœ‰å¾ˆå¤šçš„ Spark ç¨‹åºæ²¡æœ‰å¾—åˆ°å¾ˆå¥½çš„ä¼˜åŒ–ï¼Œä¼šæµªè´¹å¤§é‡çš„å†…å­˜ï¼Œä»è€Œè®©ä¸€äº›ç¨‹åºéœ€è¦æ’é˜Ÿç­‰å¾…ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSpark å¤„ç†çš„æ•°æ®è§„æ¨¡å¯èƒ½ä¼šå°äº MapReduce å¤„ç†çš„æ•°æ®è§„æ¨¡ã€‚ï¼ˆä¹‹åçš„ç³»åˆ—æ–‡ç« ä¹Ÿä¼šä»‹ç»å…³äº Spark å†…å­˜è°ƒä¼˜çš„ç›¸å…³å†…å®¹ï¼‰</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-6bb8a2150d60ffe12a1a6df8d0b7abbc_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"727\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-6bb8a2150d60ffe12a1a6df8d0b7abbc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;727&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"727\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-6bb8a2150d60ffe12a1a6df8d0b7abbc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-6bb8a2150d60ffe12a1a6df8d0b7abbc_b.jpg\"/><figcaption>å›¾ 4</figcaption></figure><p>å…³äºæœ€åä¸€ç‚¹å®¹é”™æ€§ï¼ŒMapReduce ä¸­æ¯ä¸€æ­¥æ“ä½œçš„ç»“æœéƒ½ä¼šè¢«å­˜å…¥ç£ç›˜ï¼Œåœ¨è®¡ç®—å‡ºç°é”™è¯¯æ—¶å¯ä»¥å¾ˆå¥½çš„ä»ç£ç›˜è¿›è¡Œæ¢å¤ï¼›Spark åˆ™éœ€è¦æ ¹æ® RDD ä¸­çš„ä¿¡æ¯è¿›è¡Œæ•°æ®çš„é‡æ–°è®¡ç®—ï¼Œä¼šè€—è´¹ä¸€å®šçš„èµ„æºã€‚Spark æä¾›ä¸¤ç§æ–¹å¼è¿›è¡Œæ•…éšœæ¢å¤ï¼šé€šè¿‡æ•°æ®çš„è¡€ç¼˜å…³ç³»å†æ‰§è¡Œä¸€éå‰é¢çš„å¤„ç†ï¼›Checkpoint å°†æ•°æ®é›†å­˜å‚¨åˆ°æŒä¹…å­˜å‚¨ä¸­ã€‚ç†è®ºä¸Šå¦‚æœé€‰æ‹©åœ¨æ¯ä¸ªå®Œæˆçš„å°æ­¥éª¤ä¸ŠåŠ  CheckPointï¼ŒSpark çš„å®¹é”™æ€§èƒ½å¯ä»¥å’Œ MR è¾¾åˆ°ä¸€æ ·çš„ç¨³å¥ã€‚å½“ç„¶ï¼Œå¾ˆå°‘æœ‰äººä¼šè¿™ä¹ˆåšã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>æˆ‘ä»¬é€šè¿‡ Spark ä¸ MapReduce å¯¹æ¯”ã€‚çœ‹åˆ°äº† Spark å¯¹ MapReduce å±€é™æ€§çš„æ”¹è¿›ï¼Œè¿˜æœ‰å®ƒå¿«é€Ÿã€é€šç”¨çš„ç‰¹ç‚¹ã€‚æ¥ä¸‹æ¥å°†é€šè¿‡ Spark çš„è®¾è®¡æ€æƒ³å’Œæ‰§è¡Œè¿‡ç¨‹æ¥è¯´æ˜å®ƒä¸ºä»€ä¹ˆå¯ä»¥åšåˆ°è¿™äº›ç‰¹ç‚¹ã€‚</p><h2><b>Spark çš„åŸºæœ¬åŸç† </b></h2><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-3c14e44ee58ad5e39166a312a8989792_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"792\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-3c14e44ee58ad5e39166a312a8989792_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;792&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"792\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-3c14e44ee58ad5e39166a312a8989792_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-3c14e44ee58ad5e39166a312a8989792_b.jpg\"/><figcaption>å›¾ 5</figcaption></figure><p>å¦‚å›¾ 5 æ‰€ç¤ºï¼Œåœ¨ Spark é›†ç¾¤ä¸­ç”±ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸º driver ç«¯åˆ›å»º SparkContextã€‚Spark åº”ç”¨ç¨‹åºçš„å…¥å£è´Ÿè´£è°ƒåº¦å„ä¸ªè¿ç®—èµ„æºï¼Œåè°ƒå„ä¸ª Worker Nodeä¸Š çš„ Executorã€‚æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å‚æ•°ä¼šäº§ç”Ÿè‹¥å¹²ä¸ª workrï¼Œworkr èŠ‚ç‚¹è¿è¡Œè‹¥å¹²ä¸ª executorï¼Œä¸€ä¸ª executor æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿è¡Œå„è‡ªçš„ taskï¼Œæ¯ä¸ª task æ‰§è¡Œç›¸åŒçš„ä»£ç æ®µå¤„ç†ä¸åŒçš„æ•°æ®ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-db12a135bd9e4586773fcba892ec4a13_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"818\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-db12a135bd9e4586773fcba892ec4a13_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;818&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"818\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-db12a135bd9e4586773fcba892ec4a13_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-db12a135bd9e4586773fcba892ec4a13_b.jpg\"/><figcaption>å›¾ 6</figcaption></figure><p>å¦‚å›¾ 6 æ‰€ç¤ºæ˜¯ Spark çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹ï¼Œclient æäº¤ä½œä¸šï¼Œé€šè¿‡åå°„ invoke æ‰§è¡Œç”¨æˆ·ä»£ç  main å‡½æ•°ï¼Œä¹‹åå¼€å§‹å¯åŠ¨ CoarseGrainedExecutorBackend å’Œåˆå§‹åŒ– SparkContextã€‚</p><blockquote>*SparkContext åˆå§‹åŒ–åŒ…æ‹¬åˆå§‹åŒ–ç›‘æ§é¡µé¢ SparkUIã€æ‰§è¡Œç¯å¢ƒ SparkEnvã€å®‰å…¨ç®¡ç†å™¨ SecurityManagerã€stage åˆ’åˆ†åŠè°ƒåº¦å™¨ DAGSchedulerã€task ä½œä¸šè°ƒåº¦å™¨ TaskSchedulerImpl ã€ä¸ Executor é€šä¿¡çš„è°ƒåº¦ç«¯ CoarseGrainedSchedulerBackendã€‚</blockquote><p class=\"ztext-empty-paragraph\"><br/></p><p>DAG Scheduler å°†ä½œä¸šåˆ’åˆ†åï¼Œä¾æ¬¡æäº¤ stage å¯¹åº”çš„ taskSet ç»™ TaskSchedulerImplï¼ŒTaskSchedulerImpl ä¼š submit taskset ç»™ driver ç«¯çš„ CoarseGrainedSchedulerBackend åç«¯ï¼Œæ¥ç€ CoarseGrainedSchedulerBackend ä¼šä¸€ä¸ªä¸€ä¸ªçš„ LaunchTaskã€‚åœ¨è¿œç«¯çš„ CoarseGrainedExecutorBackend æ¥æ”¶åˆ° task æäº¤ event åï¼Œä¼šè°ƒç”¨ Executor æ‰§è¡Œ taskï¼Œæœ€ç»ˆ task æ˜¯åœ¨ TaskRunner çš„ run æ–¹æ³•å†…è¿è¡Œã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>é‚£ä¹ˆåœ¨è¿‡ç¨‹ 4 ä¸­ DAG Scheduler å¦‚ä½•åˆ’åˆ†ä½œä¸šï¼Ÿå¦‚æœäº§ç”Ÿ stageã€task ç­‰ç»™ Executor æ‰§è¡Œå‘¢ï¼Ÿæ¥ç€æˆ‘ä»¬çœ‹ä½œä¸šåˆ’åˆ†æ‰§è¡Œçš„ç¤ºä¾‹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-6f144c658ca181e926c20939386e7dc0_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"783\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-6f144c658ca181e926c20939386e7dc0_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;783&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"783\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-6f144c658ca181e926c20939386e7dc0_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-6f144c658ca181e926c20939386e7dc0_b.jpg\"/><figcaption>å›¾ 7</figcaption></figure><p>å›¾ 7 æè¿°äº†ä¸€ä¸ª Spark ç¨‹åºï¼Œä» HDFS ä¸Šè¯»å–æ•°æ®äº§ç”Ÿ RDD-A ç„¶å flatmap æ“ä½œåˆ° RDD-Bï¼Œè¯»å–å¦ä¸€éƒ¨åˆ†æ•°æ®çš„åˆ°RDD-Cï¼Œç„¶å map æ“ä½œçš„åˆ° RDD-Dï¼ŒRDD-D èšåˆæ“ä½œ RDD-Eï¼ŒRDD-B å’Œ RDD-E åŠ å…¥åå¾—åˆ° RDD-Fï¼Œç„¶åå†å°†ç»“æœå­˜å‚¨åˆ° HDFS ä¸Šã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>Spark æ ¹æ® RDD ä¹‹é—´çš„ä¸åŒç‚¹ä¾èµ–å…³ç³»åˆ‡åˆ†æˆä¸åŒçš„é˜¶æ®µï¼ˆStageï¼‰ï¼Œé€”ä¸­æœ‰å››ä¸ªé˜¶æ®µï¼Œå…¶ä¸­ Stage0 å’Œ Stage2 ç”±äºæ²¡æœ‰ä¾èµ–å…³ç³»æ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ã€‚ä½†Stage2éœ€è¦ç­‰å¾…Stage1æ‰§è¡Œå®Œæ¯•ã€‚RDD-D åˆ° RDD- F çš„èšåˆæ“ä½œä»¥åŠ Stage0 å’Œ Stage2 å¾—åˆ°çš„ RDD- B å’Œ RDD-E joinåœ¨ä¸€èµ·çš„åˆ° RDD-Fï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿ shaffleã€‚æ²¡æœ‰ä¾èµ–å…³ç³»çš„Stageæ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä½†æ˜¯å¯¹äºjobï¼ŒSparkæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¦‚æœæƒ³è¦å¹¶è¡Œæ‰§è¡ŒJobï¼Œå¯ä»¥åœ¨Sparkç¨‹åºä¸­è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨è¿™ä¸ª DAG å›¾ä¸­ï¼ŒSpark èƒ½å¤Ÿå……åˆ†äº†è§£æ•°æ®ä¹‹é—´çš„è¡€ç¼˜å…³ç³»ï¼Œè¿™æ ·æŸäº›ä»»åŠ¡å¤±è´¥åå¯ä»¥æ ¹æ®è¡€ç¼˜å…³ç³»é‡æ–°æ‰§è¡Œè®¡ç®—è·å–å¤±è´¥äº†çš„ RDDã€‚</p><blockquote>*<b>å®½ä¾èµ–å’Œçª„ä¾èµ–</b><br/>çª„ä¾èµ–æ˜¯æŒ‡çˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºåªè¢«å­RDDçš„ä¸€ä¸ªåˆ†åŒºæ‰€ä½¿ç”¨ï¼Œå­RDDåˆ†åŒºé€šå¸¸å¯¹åº”å¸¸æ•°ä¸ªçˆ¶RDDåˆ†åŒºï¼›<br/>å®½ä¾èµ–æ˜¯æŒ‡çˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºéƒ½å¯èƒ½è¢«å¤šä¸ªå­RDDåˆ†åŒºæ‰€ä½¿ç”¨ï¼Œå­RDDåˆ†åŒºé€šå¸¸å¯¹åº”æ‰€æœ‰çš„çˆ¶RDDåˆ†åŒºã€‚è¿™ä¸ªæ¦‚å¿µåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä¼šæ¶‰åŠã€‚<br/><br/>Spark æä¾›äº†ä¸°å¯Œçš„ç®—å­ï¼Œæ“ä½œä¹Ÿæ›´åŠ é€šç”¨ã€‚é‚£ä¹ˆè¿™ç§åˆ’åˆ†ä½œä¸šã€æ‰§è¡Œå¹¶è¡Œè®¡ç®—çš„æ–¹æ¡ˆå¦‚ä½•ä½¿ Spark äº§ç”ŸåŸºäºå†…å­˜è®¡ç®—çš„å¿«é€Ÿæ•ˆæœå‘¢ï¼Ÿéƒ½è¯´ Spark æ“…é•¿è¿­ä»£è®¡ç®—ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç»å…¸çš„è¿­ä»£é—®é¢˜ PageRank ç®—æ³•æ¥ä¸ MapReduce æ¯”è¾ƒä¸€ä¸‹ã€‚</blockquote><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-94cab2f4054f5cfab5b5f371721656a3_b.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"527\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-94cab2f4054f5cfab5b5f371721656a3_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;527&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"527\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-94cab2f4054f5cfab5b5f371721656a3_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-94cab2f4054f5cfab5b5f371721656a3_b.jpg\"/><figcaption>å›¾ 8ï¼Œvia http://www.jos.org.cn/jos/ch/reader/create_pdf.aspx?file_no=5557&amp;amp;amp;amp;amp;amp;amp;journal_id=jos</figcaption></figure><p>å›¾ 8 æ˜¯ MapReduce è¿›è¡Œ pagerank ç®—æ³•çš„ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç°è‰²çš„éƒ¨åˆ†éƒ½æ˜¯éœ€è¦å­˜å‚¨åˆ°ç£ç›˜çš„æ•°æ®ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-218f82dff8245a8752f346d88e4a8f20_b.jpg\" data-size=\"normal\" data-rawwidth=\"792\" data-rawheight=\"487\" class=\"origin_image zh-lightbox-thumb\" width=\"792\" data-original=\"https://pic1.zhimg.com/v2-218f82dff8245a8752f346d88e4a8f20_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;792&#39; height=&#39;487&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"792\" data-rawheight=\"487\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"792\" data-original=\"https://pic1.zhimg.com/v2-218f82dff8245a8752f346d88e4a8f20_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-218f82dff8245a8752f346d88e4a8f20_b.jpg\"/><figcaption>å›¾ 9 ï¼Œvia http://www.jos.org.cn/jos/ch/reader/create_pdf.aspx?file_no=5557&amp;amp;amp;amp;amp;amp;amp;journal_id=jos</figcaption></figure><p>å›¾ 9 æ‰€ç¤ºæ˜¯ Spark æ‰§è¡Œ pageRank ç®—æ³•çš„ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ï¼Œç›¸è¾ƒäº MapReduce åšäº†å¾ˆå¤šæ”¹è¿›ã€‚é¦–å…ˆåœ¨å†…å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹ Spark å…è®¸ç”¨æˆ·å°†å¸¸ç”¨çš„æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­,åŠ å¿«äº†ç³»ç»Ÿçš„è¿è¡Œé€Ÿåº¦ï¼›å…¶æ¬¡ Spark å¯¹æ•°æ®ä¹‹é—´çš„ä¾èµ–å…³ç³»æœ‰äº†æ˜ç¡®çš„åˆ’åˆ†ï¼Œæ ¹æ®å®½ä¾èµ–ä¸çª„ä¾èµ–å…³ç³»è¿›è¡Œä»»åŠ¡çš„è°ƒåº¦ï¼Œå¯ä»¥å®ç°ç®¡é“åŒ–æ“ä½œï¼Œä½¿ç³»ç»Ÿçµæ´»æ€§å¾—ä»¥æé«˜ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-fc81922055990879d69ed130e74e4814_b.jpg\" data-size=\"normal\" data-rawwidth=\"792\" data-rawheight=\"380\" class=\"origin_image zh-lightbox-thumb\" width=\"792\" data-original=\"https://pic1.zhimg.com/v2-fc81922055990879d69ed130e74e4814_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;792&#39; height=&#39;380&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"792\" data-rawheight=\"380\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"792\" data-original=\"https://pic1.zhimg.com/v2-fc81922055990879d69ed130e74e4814_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-fc81922055990879d69ed130e74e4814_b.jpg\"/><figcaption>å›¾ 10ï¼šMapReduce è¿›è¡Œ pagerank ç®—æ³•çš„äºŒæ¬¡è¿­ä»£ï¼Œvia http://www.jos.org.cn/jos/ch/reader/create_pdf.aspx?file_no=5557&amp;amp;amp;amp;amp;amp;amp;journal_id=jos</figcaption></figure><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1068b67a6e9d874b5a8bd10233e89b5c_b.jpg\" data-size=\"normal\" data-rawwidth=\"772\" data-rawheight=\"418\" class=\"origin_image zh-lightbox-thumb\" width=\"772\" data-original=\"https://pic1.zhimg.com/v2-1068b67a6e9d874b5a8bd10233e89b5c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;772&#39; height=&#39;418&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"772\" data-rawheight=\"418\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"772\" data-original=\"https://pic1.zhimg.com/v2-1068b67a6e9d874b5a8bd10233e89b5c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-1068b67a6e9d874b5a8bd10233e89b5c_b.jpg\"/><figcaption>å›¾ 11ï¼šSpark è¿›è¡Œ pagerank ç®—æ³•çš„äºŒæ¬¡è¿­ä»£ï¼Œvia http://www.jos.org.cn/jos/ch/reader/create_pdf.aspx?file_no=5557&amp;amp;amp;amp;amp;amp;amp;journal_id=jos</figcaption></figure><p>å¦‚å›¾æ‰€ç¤º Spark å¯ä»¥å°†å…·æœ‰çª„ä¾èµ–å…³ç³»çš„ RDD åˆ†åŒºåˆ†é…åˆ°ä¸€ä¸ªä»»åŠ¡ä¸­,è¿›è¡Œç®¡é“åŒ–æ“ä½œï¼Œä»»åŠ¡å†…éƒ¨æ•°æ®æ— éœ€é€šè¿‡ç½‘ç»œä¼ è¾“ä¸”ä»»åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼Œå› æ­¤ Spark ä¸¤æ¬¡è¿­ä»£åªæœ‰ä¸‰æ¬¡ shuffleã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>åœ¨ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­ï¼ŒMapReduce ä¸ Spark åœ¨æ€§èƒ½ä¸Šå¯èƒ½å¹¶æ²¡æœ‰å¾ˆå¤§çš„å·®åˆ«ï¼Œä½†æ˜¯éšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ ï¼Œä¸¤è€…çš„å·®è·é€æ¸æ˜¾ç°å‡ºæ¥ã€‚Spark æ ¹æ®ä¾èµ–å…³ç³»é‡‡ç”¨çš„ä»»åŠ¡è°ƒåº¦ç­–ç•¥ä½¿å¾— shuffle æ¬¡æ•°ç›¸è¾ƒäº MapReduce æœ‰äº†æ˜¾è‘—é™ä½ï¼Œå› æ­¤ Spark çš„è®¾è®¡ååˆ†é€‚åˆè¿›è¡Œè¿­ä»£è¿ç®—ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>å›é¡¾æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¾æ¬¡ä»æ¦‚å¿µã€ç‰¹ç‚¹åŠåŸç†ä¸‰ä¸ªè§’åº¦åˆæ­¥ä»‹ç»äº† Sparkï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å…·ä½“ä»‹ç» Spark on Yarn çš„è¿ä½œæµç¨‹ä¸æœºåˆ¶ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><hr/><h2><b>å·å¤–ï¼</b></h2><p>ç¾å›¾çš„å¤§æ•°æ®å›¢é˜Ÿåœ¨è¿‘å‡ å¹´çš„å‘å±•ä¸­ï¼Œé€æ­¥æ¼”è¿›å’Œå‘å±•å‡ºç¾å›¾çš„å¤§æ•°æ®ä½“ç³»ï¼Œä»¥åŠåœ¨ç¾å›¾ä¸šåŠ¡åœºæ™¯ä¸‹æ•°æ®æŠ€æœ¯åº”ç”¨çš„æœ€ä½³å®è·µã€‚8æœˆ11æ—¥æˆ‘ä»¬å°†åœ¨æ·±åœ³å¼€è®¾ä¸€åœºæŠ€æœ¯æ²™é¾™ï¼Œæˆ‘ä»¬é‚€è¯·äº†æ¥è‡ªç¾å›¾å…¬å¸çš„å¤§æ•°æ®è´Ÿè´£äººã€æ¶æ„å¸ˆã€é­…æ—å…¬å¸çš„æ•°æ®æŠ€æœ¯ä¸“å®¶ã€ä»¥åŠæ¥è‡ª Apache kylin çš„ PMCã€‚ç¾å›¾çš„å¤§æ•°æ®æŠ€æœ¯è´Ÿè´£äººå’Œæ¶æ„å¸ˆä¼šä¸ºå¤§å®¶åˆ†äº«ç¾å›¾åœ¨å¤§æ•°æ®æŠ€æœ¯ä¸Šçš„æ¢ç´¢ã€å¤§æ•°æ®çš„æ¶æ„ã€ä»¥åŠæ•°æ®æŠ€æœ¯çš„åº”ç”¨è½åœ°ã€‚é­…æ—çš„æ•°æ®æŠ€æœ¯ä¸“å®¶ä¼šä¸ºå¤§å®¶ä»‹ç»é­…æ—çš„ DMP ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ä»¥åŠç³»ç»Ÿçš„æ¼”è¿›å†ç¨‹ã€‚æ¥è‡ª Apache é¡¶çº§é¡¹ç›® kylin çš„æ¶æ„å¸ˆä¼šä¸ºå¤§å®¶åˆ†äº« kylin çš„æŠ€æœ¯åŸç†ä¸åº”ç”¨å®è·µã€‚å››ä½æŠ€æœ¯ä¸“å®¶ä¼šä»å¤šä¸ªè§’åº¦ä¸åŒå±‚æ¬¡ï¼Œä¸ºå¤§å®¶åˆ†äº«å„è‡ªåœ¨å¤§æ•°æ®æŠ€æœ¯ä¸Šçš„å®è·µç»éªŒã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><p>è¯¦æƒ…è§æŠ¥åé“¾æ¥ï¼š<a href=\"https://link.zhihu.com/?target=https%3A//www.bagevent.com/event/1106376%3Fpreview%3D1\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤§æ•°æ®æ¶æ„ä¸æ•°æ®æŠ€æœ¯åº”ç”¨å®è·µ -ç™¾æ ¼æ´»åŠ¨</a></p><hr/><p><b>é™„ï¼šSpark ç›¸å…³æœ¯è¯­è¡¨</b></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-03a8393cca783b579324997030f506a7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"812\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-03a8393cca783b579324997030f506a7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;812&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"812\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-03a8393cca783b579324997030f506a7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-03a8393cca783b579324997030f506a7_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "Spark", 
                    "tagLink": "https://api.zhihu.com/topics/19942170"
                }, 
                {
                    "tag": "å¤§æ•°æ®", 
                    "tagLink": "https://api.zhihu.com/topics/19740929"
                }, 
                {
                    "tag": "Hadoop", 
                    "tagLink": "https://api.zhihu.com/topics/19563390"
                }
            ], 
            "comments": [
                {
                    "userName": "Gordon", 
                    "userLink": "https://www.zhihu.com/people/9ee253ddd77e5be540155b84eeb00edd", 
                    "content": "<p>å¾ˆå¥½å¥‡å›¾è¡¨æ˜¯ç”¨ä»€ä¹ˆç”»çš„å•Š~</p><a class=\"comment_sticker\" href=\"https://pic4.zhimg.com/v2-db92f653a2ec17ea3ff309d6d56e8507.gif\" data-width=\"\" data-height=\"\">[åƒç“œ]</a>", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "Gordon", 
                    "userLink": "https://www.zhihu.com/people/9ee253ddd77e5be540155b84eeb00edd", 
                    "content": "<p></p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/50/v2-bb280e2d6e7c2b57c924c9db9ab46400_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1005\" data-rawheight=\"239\" class=\"origin_image zh-lightbox-thumb\" width=\"1005\" data-original=\"https://pic1.zhimg.com/50/v2-bb280e2d6e7c2b57c924c9db9ab46400_r.jpg\"></figure><p>å“‡ï¼Œéå¸¸å–œæ¬¢è¿™ä¸ªå›¾è¡¨ï¼Œæ±‚æ•™æ˜¯æ€ä¹ˆç”»çš„ã€‚æœ‰ä¸ªå°ç¬”è¯¯å‘¦~</p>", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/c_216887134"
}
