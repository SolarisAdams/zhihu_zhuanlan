{
    "title": "大数据获取与分析", 
    "description": "", 
    "followers": [
        "https://www.zhihu.com/people/ealias", 
        "https://www.zhihu.com/people/su-han-yu-8", 
        "https://www.zhihu.com/people/zhang-wei-lan-88-61", 
        "https://www.zhihu.com/people/yangyang-liu-11", 
        "https://www.zhihu.com/people/yan-yue-99-14", 
        "https://www.zhihu.com/people/li-ke-97", 
        "https://www.zhihu.com/people/scofield-57", 
        "https://www.zhihu.com/people/mr-fang-64", 
        "https://www.zhihu.com/people/wei-lv-6", 
        "https://www.zhihu.com/people/alex-xu-68-57", 
        "https://www.zhihu.com/people/xu-xu-16-99-37", 
        "https://www.zhihu.com/people/guan-nan", 
        "https://www.zhihu.com/people/xujun_thu", 
        "https://www.zhihu.com/people/nuo-nuo-38-76-26", 
        "https://www.zhihu.com/people/wo-xiang-hui-hao-qi-lai-de", 
        "https://www.zhihu.com/people/mu-xi-luo-chen", 
        "https://www.zhihu.com/people/tang-zhao-15-5", 
        "https://www.zhihu.com/people/luozhongbin", 
        "https://www.zhihu.com/people/hou-de-zai-wu-90-96", 
        "https://www.zhihu.com/people/yan-jin-34", 
        "https://www.zhihu.com/people/juxiu-liu", 
        "https://www.zhihu.com/people/yin-xin-dong", 
        "https://www.zhihu.com/people/william-zhu-82", 
        "https://www.zhihu.com/people/lan-lan-lan-lan-96-82", 
        "https://www.zhihu.com/people/he-ye-52", 
        "https://www.zhihu.com/people/mr-yue-18", 
        "https://www.zhihu.com/people/dan-dan-zai-zhe-li-98", 
        "https://www.zhihu.com/people/bu-ke-si-yi-mao", 
        "https://www.zhihu.com/people/duck26", 
        "https://www.zhihu.com/people/sunrise-99-81", 
        "https://www.zhihu.com/people/yunzhongke", 
        "https://www.zhihu.com/people/wang-tong-hui", 
        "https://www.zhihu.com/people/liu-fei-94-95", 
        "https://www.zhihu.com/people/wangle-nlp", 
        "https://www.zhihu.com/people/hu-yi-89-42-68", 
        "https://www.zhihu.com/people/keny-29", 
        "https://www.zhihu.com/people/bu-cheng-49-54", 
        "https://www.zhihu.com/people/ai-you-ge-ge-bu-cuo-la", 
        "https://www.zhihu.com/people/luo-chen-74-2", 
        "https://www.zhihu.com/people/IrisYe123", 
        "https://www.zhihu.com/people/a-li-yun-96", 
        "https://www.zhihu.com/people/luping-tang", 
        "https://www.zhihu.com/people/adream-lc", 
        "https://www.zhihu.com/people/song-zhi-bo-56", 
        "https://www.zhihu.com/people/maxwell-43", 
        "https://www.zhihu.com/people/wangcheny91", 
        "https://www.zhihu.com/people/shang-guan-zhi-chun", 
        "https://www.zhihu.com/people/xuan-lu-80-62", 
        "https://www.zhihu.com/people/da-da-da-zhang-yu-zhou-mei-mao", 
        "https://www.zhihu.com/people/feng-xin-zi-25-15", 
        "https://www.zhihu.com/people/qiu-tian-10"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/31473161", 
            "userName": "Xuefeng", 
            "userLink": "https://www.zhihu.com/people/ae0a7fa72b1da4f4bc4e263a4d4c44ba", 
            "upvote": 21, 
            "title": "在线图书推荐系统的实现含源码（协同过滤）", 
            "content": "<h2>项目简介</h2><ul><li>源码地址 <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%3A//github.com/XuefengHuang/RecommendationSystem\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">https://github.com/XuefengHuang/RecommendationSystem</a></li><li>基于Spark, Python Flask, 和 <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www2.informatik.uni-freiburg.de/~cziegler/BX/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Book-Crossing Dataset</a> 的在线图书推荐系统。</li><li>该图书推荐系统参考<a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%3A//github.com/jadianes/spark-movie-lens\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">https://github.com/jadianes/spark-movie-lens</a>。</li><li>修改数据处理部分，使其支持<a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www2.informatik.uni-freiburg.de/~cziegler/BX/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Book-Crossing Dataset</a>。</li><li>适合初学者学习如何搭建一个推荐系统，本文底下附有其他数据，可供参考学习。</li></ul><h2>基于模型的<a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%3A//xuefenghuang.github.io/collaborate-filter/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">协同过滤</a>应用---图书推荐</h2><p>本文实现对用户推荐图书的简单应用。</p><ul></ul><ol><li>推荐算法：</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><p>在我们的在线图书推荐系统中，我们借用Spark的ALS算法的训练和预测函数，每次收到新的数据后，将其更新到训练数据集中，然后更新ALS训练得到的模型。</p><p>假设我们有一组用户，他们表现出了对一组图书的喜好。用户对一本图书的喜好程度越高，就会给其更高的评分，范围是从1到5。我们来通过一个矩阵来展示它，行代表用户，列代表图书。用户对图书的评分。所有的评分范围从1到5，5代表喜欢程度最高。第一个用户（行1）对第一个图书（列1）的评分是4。空的单元格代表用户未给图书评价。</p><p class=\"ztext-empty-paragraph\"><br/></p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-61374b3670a57846659aa949a6b85809_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"453\" data-rawheight=\"444\" class=\"origin_image zh-lightbox-thumb\" width=\"453\" data-original=\"https://pic2.zhimg.com/v2-61374b3670a57846659aa949a6b85809_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;453&#39; height=&#39;444&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"453\" data-rawheight=\"444\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"453\" data-original=\"https://pic2.zhimg.com/v2-61374b3670a57846659aa949a6b85809_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-61374b3670a57846659aa949a6b85809_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>用户图书评分表.png</p><p>矩阵因子分解（如奇异值分解，奇异值分解+ +）将项和用户都转化成了相同的潜在空间，它所代表了用户和项之间的潜相互作用。矩阵分解背后的原理是潜在特征代表了用户如何给项进行评分。给定用户和项的潜在描述，我们可以预测用户将会给还未评价的项多少评分。</p><p class=\"ztext-empty-paragraph\"><br/></p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-a1c3b2c7fe92911d966b5d108e667f05_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"257\" class=\"origin_image zh-lightbox-thumb\" width=\"700\" data-original=\"https://pic2.zhimg.com/v2-a1c3b2c7fe92911d966b5d108e667f05_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;700&#39; height=&#39;257&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"257\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"700\" data-original=\"https://pic2.zhimg.com/v2-a1c3b2c7fe92911d966b5d108e667f05_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-a1c3b2c7fe92911d966b5d108e667f05_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>矩阵因子分解.png</p><ul></ul><ol><li>数据描述：<br/>评分数据文件:</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><p><code>&#34;User-ID&#34;;&#34;ISBN&#34;;&#34;Book-Rating&#34;</code></p><div class=\"highlight\"><pre><code class=\"language-text\">&#34;276725&#34;;&#34;034545104X&#34;;&#34;0&#34;\n&#34;276726&#34;;&#34;0155061224&#34;;&#34;5&#34;\n&#34;276727&#34;;&#34;0446520802&#34;;&#34;0&#34;\n&#34;276729&#34;;&#34;052165615X&#34;;&#34;3&#34;\n&#34;276729&#34;;&#34;0521795028&#34;;&#34;6&#34;\n&#34;276733&#34;;&#34;2080674722&#34;;&#34;0&#34;\n&#34;276736&#34;;&#34;3257224281&#34;;&#34;8&#34;\n</code></pre></div><p>图书数据文件:</p><p><code>&#34;ISBN&#34;;&#34;Book-Title&#34;;&#34;Book-Author&#34;;&#34;Year-Of-Publication&#34;;&#34;Publisher&#34;;&#34;Image-URL-S&#34;;&#34;Image-URL-M&#34;;&#34;Image-URL-L&#34;</code></p><div class=\"highlight\"><pre><code class=\"language-text\">&#34;0195153448&#34;;&#34;Classical Mythology&#34;;&#34;Mark P. O. Morford&#34;;&#34;2002&#34;;&#34;Oxford University Press&#34;;&#34;http://images.amazon.com/images/P/0195153448.01.THUMBZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0195153448.01.MZZZZZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0195153448.01.LZZZZZZZ.jpg&#34;\n&#34;0002005018&#34;;&#34;Clara Callan&#34;;&#34;Richard Bruce Wright&#34;;&#34;2001&#34;;&#34;HarperFlamingo Canada&#34;;&#34;http://images.amazon.com/images/P/0002005018.01.THUMBZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0002005018.01.MZZZZZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0002005018.01.LZZZZZZZ.jpg&#34;\n&#34;0060973129&#34;;&#34;Decision in Normandy&#34;;&#34;Carlo D&#39;Este&#34;;&#34;1991&#34;;&#34;HarperPerennial&#34;;&#34;http://images.amazon.com/images/P/0060973129.01.THUMBZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0060973129.01.MZZZZZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0060973129.01.LZZZZZZZ.jpg&#34;\n&#34;0374157065&#34;;&#34;Flu: The Story of the Great Influenza Pandemic of 1918 and the Search for the Virus That Caused It&#34;;&#34;Gina Bari Kolata&#34;;&#34;1999&#34;;&#34;Farrar Straus Giroux&#34;;&#34;http://images.amazon.com/images/P/0374157065.01.THUMBZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0374157065.01.MZZZZZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0374157065.01.LZZZZZZZ.jpg&#34;\n&#34;0393045218&#34;;&#34;The Mummies of Urumchi&#34;;&#34;E. J. W. Barber&#34;;&#34;1999&#34;;&#34;W. W. Norton &amp;amp; Company&#34;;&#34;http://images.amazon.com/images/P/0393045218.01.THUMBZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0393045218.01.MZZZZZZZ.jpg&#34;;&#34;http://images.amazon.com/images/P/0393045218.01.LZZZZZZZ.jpg&#34;\n</code></pre></div><ul></ul><ol><li>数据处理细节：</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><p>由于该数据中ISBN为string格式，spark的ALS默认product id为int格式，因此对该ISBN号进行计算hash处理并取前8位防止整数越界。详细代码如下：</p><div class=\"highlight\"><pre><code class=\"language-text\">dataset_path = os.path.join(&#39;datasets&#39;, &#39;BX-CSV-Dump&#39;)\nsc = SparkContext(&#34;local[*]&#34;, &#34;Test&#34;)\nratings_file_path = os.path.join(dataset_path, &#39;BX-Book-Ratings.csv&#39;)\nratings_raw_RDD = sc.textFile(ratings_file_path)\nratings_raw_data_header = ratings_raw_RDD.take(1)[0]\nratings_RDD = ratings_raw_RDD.filter(lambda line: line!=ratings_raw_data_header)\\\n            .map(lambda line: line.split(&#34;;&#34;)).map(lambda tokens: (int(tokens[0][1:-1]), abs(hash(tokens[1][1:-1])) % (10 ** 8),float(tokens[2][1:-1]))).cache()\n\nbooks_file_path = os.path.join(dataset_path, &#39;BX-Books.csv&#39;)\nbooks_raw_RDD = sc.textFile(books_file_path)\nbooks_raw_data_header = books_raw_RDD.take(1)[0]\nbooks_RDD = books_raw_RDD.filter(lambda line: line!=books_raw_data_header)\\\n    .map(lambda line: line.split(&#34;;&#34;))\\\n    .map(lambda tokens: (abs(hash(tokens[0][1:-1])) % (10 ** 8), tokens[1][1:-1], tokens[2][1:-1], tokens[3][1:-1], tokens[4][1:-1], tokens[5][1:-1])).cache()\nbooks_titles_RDD = books_RDD.map(lambda x: (int(x[0]), x[1], x[2], x[3], x[4], x[5])).cache()\n</code></pre></div><ul></ul><ol><li>选择模型参数：</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">from pyspark.mllib.recommendation import ALS\nimport math\n\nseed = 5L\niterations = 10\nregularization_parameter = 0.1\nranks = [4, 8, 12]\nerrors = [0, 0, 0]\nerr = 0\ntolerance = 0.02\n\nmin_error = float(&#39;inf&#39;)\nbest_rank = -1\nbest_iteration = -1\nfor rank in ranks:\n    model = ALS.train(training_RDD, rank, seed=seed, iterations=iterations,\n                      lambda_=regularization_parameter)\n    predictions = model.predictAll(validation_for_predict_RDD).map(lambda r: ((r[0], r[1]), r[2]))\n    rates_and_preds = validation_RDD.map(lambda r: ((int(r[0]), int(r[1])), float(r[2]))).join(predictions)\n    error = math.sqrt(rates_and_preds.map(lambda r: (r[1][0] - r[1][1])**2).mean())\n    errors[err] = error\n    err += 1\n    print &#39;For rank %s the RMSE is %s&#39; % (rank, error)\n    if error &lt; min_error:\n        min_error = error\n        best_rank = rank\n\nprint &#39;The best model was trained with rank %s&#39; % best_rank\n</code></pre></div><ul></ul><ol><li>模型保存</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">from pyspark.mllib.recommendation import MatrixFactorizationModel\n\nmodel_path = os.path.join(&#39;..&#39;, &#39;models&#39;, &#39;book_als&#39;)\n\n# Save and load model\nmodel.save(sc, model_path)\nsame_model = MatrixFactorizationModel.load(sc, model_path)\n</code></pre></div><ul></ul><ol><li>运行说明：</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">virtualenv book\npip install -r requirements.txt\npython server.py\n</code></pre></div><ul></ul><ol><li>API:</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">GET: /&lt;int:user_id&gt;/ratings/top/&lt;int:count&gt; 获取用户图书推荐top N信息\nGET: /&lt;int:user_id&gt;/ratings/&lt;string:book_id&gt; 获取该用户对某个图书的评价信息\nPOST: /&lt;int:user_id&gt;/ratings 新增图书评价信息\n</code></pre></div><ul></ul><ol><li>接口调用示例：</li></ol><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">GET: /276729/ratings/top/3 获取用户ID为276729的图书推荐top3信息\n返回信息：\n\n[\n  {\n    &#34;Count&#34;: 30,\n    &#34;Rating&#34;: 8.781754720405482,\n    &#34;Author&#34;: &#34;MARJANE SATRAPI&#34;,\n    &#34;URL&#34;: &#34;http://images.amazon.com/images/P/0375422307.01.THUMBZZZ.jpg&#34;,\n    &#34;Publisher&#34;: &#34;Pantheon&#34;,\n    &#34;Title&#34;: &#34;Persepolis : The Story of a Childhood (Alex Awards (Awards))&#34;,\n    &#34;Year&#34;: &#34;2003&#34;\n  },\n  {\n    &#34;Count&#34;: 31,\n    &#34;Rating&#34;: 7.093566643463471,\n    &#34;Author&#34;: &#34;Stephen King&#34;,\n    &#34;URL&#34;: &#34;http://images.amazon.com/images/P/067081458X.01.THUMBZZZ.jpg&#34;,\n    &#34;Publisher&#34;: &#34;Viking Books&#34;,\n    &#34;Title&#34;: &#34;The Eyes of the Dragon&#34;,\n    &#34;Year&#34;: &#34;1987&#34;\n  },\n  {\n    &#34;Count&#34;: 25,\n    &#34;Rating&#34;: 7.069147186199548,\n    &#34;Author&#34;: &#34;Jean Sasson&#34;,\n    &#34;URL&#34;: &#34;http://images.amazon.com/images/P/0967673747.01.THUMBZZZ.jpg&#34;,\n    &#34;Publisher&#34;: &#34;Windsor-Brooke Books&#34;,\n    &#34;Title&#34;: &#34;Princess: A True Story of Life Behind the Veil in Saudi Arabia&#34;,\n    &#34;Year&#34;: &#34;2001&#34;\n  }\n]\n\nGET: /276729/ratings/0446520802 获取用户276729对图书(ISBN:0446520802)的评价信息\n返回信息：\n\n[\n  {\n    &#34;Count&#34;: 116,\n    &#34;Rating&#34;: 1.4087434932956826,\n    &#34;Author&#34;: &#34;Nicholas Sparks&#34;,\n    &#34;URL&#34;: &#34;http://images.amazon.com/images/P/0446520802.01.THUMBZZZ.jpg&#34;,\n    &#34;Publisher&#34;: &#34;Warner Books&#34;,\n    &#34;Title&#34;: &#34;The Notebook&#34;,\n    &#34;Year&#34;: &#34;1996&#34;\n  }\n]\n</code></pre></div><h2>其他数据集推荐（参考<a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%3A//gist.github.com/entaroadun/1653794\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">https://gist.github.com/entaroadun/1653794</a>）</h2><p>以下数据可以提供给初学者学习如何训练推荐算法模型</p><p><b>电影数据</b>:</p><ul><li><i>MovieLens</i> - Movie Recommendation Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.grouplens.org/node/73\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www.grouplens.org/node/73</a></li><li><i>Yahoo!</i> - Movie, Music, and Images Ratings Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//webscope.sandbox.yahoo.com/catalog.php%3Fdatatype%3Dr\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://webscope.sandbox.yahoo.com/catalog.php?datatype=r</a></li><li><i>Cornell University</i> - Movie-review data for use in sentiment-analysis experiments <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.cs.cornell.edu/people/pabo/movie-review-data/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www.cs.cornell.edu/people/pabo/movie-review-data/</a></li></ul><p><b>音乐数据</b>:</p><ul><li><i>Last.fm</i> - Music Recommendation Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.dtic.upf.edu/~ocelma/MusicRecommendationDataset/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www.dtic.upf.edu/~ocelma/MusicRecommendationDataset/index.html</a></li><li><i>Yahoo!</i> - Movie, Music, and Images Ratings Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//webscope.sandbox.yahoo.com/catalog.php%3Fdatatype%3Dr\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://webscope.sandbox.yahoo.com/catalog.php?datatype=r</a></li><li><i>Audioscrobbler</i> - Music Recommendation Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www-etud.iro.umontreal.ca/~bergstrj/audioscrobbler_data.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www-etud.iro.umontreal.ca/~bergstrj/audioscrobbler_data.html</a></li><li><i>Amazon</i> - Audio CD recommendations <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//131.193.40.52/data/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://131.193.40.52/data/</a></li></ul><p><b>图书数据</b>:</p><ul><li><i>Institut für Informatik, Universität Freiburg</i> - Book Ratings Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.informatik.uni-freiburg.de/~cziegler/BX/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www.informatik.uni-freiburg.de/~cziegler/BX/</a></li></ul><p><b>美食数据</b>:</p><ul><li><i>Chicago Entree</i> - Food Ratings Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//archive.ics.uci.edu/ml/datasets/Entree%2BChicago%2BRecommendation%2BData\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://archive.ics.uci.edu/ml/datasets/Entree+Chicago+Recommendation+Data</a></li></ul><p><b>商品数据</b>:</p><ul><li><i>Amazon</i> - Product Recommendation Data Sets <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//131.193.40.52/data/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://131.193.40.52/data/</a></li></ul><p><b>健康数据</b>:</p><ul><li><i>Nursing Home</i> - Provider Ratings Data Set <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//data.medicare.gov/dataset/Nursing-Home-Compare-Provider-Ratings/mufm-vy8d\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://data.medicare.gov/dataset/Nursing-Home-Compare-Provider-Ratings/mufm-vy8d</a></li><li><i>Hospital Ratings</i> - Survey of Patients Hospital Experiences <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//data.medicare.gov/dataset/Survey-of-Patients-Hospital-Experiences-HCAHPS-/rj76-22dk\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://data.medicare.gov/dataset/Survey-of-Patients-Hospital-Experiences-HCAHPS-/rj76-22dk</a></li></ul><p><b>相亲数据</b>:</p><ul><li><i><a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.libimseti.cz\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">www.libimseti.cz</a></i> - Dating website recommendation (collaborative filtering) <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.occamslab.com/petricek/data/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www.occamslab.com/petricek/data/</a></li></ul><p><b>学术文章推荐</b>:</p><ul><li><i>National University of Singapore</i> - Scholarly Paper Recommendation <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//www.comp.nus.edu.sg/~sugiyama/SchPaperRecData.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://www.comp.nus.edu.sg/~sugiyama/SchPaperRecData.html</a></li></ul>", 
            "topic": [
                {
                    "tag": "推荐系统实现", 
                    "tagLink": "https://api.zhihu.com/topics/19567531"
                }
            ], 
            "comments": [
                {
                    "userName": "知乎用户", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "<p>这个BX数据集比ml-10m还大，电脑跑不动。。。</p>", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/31532470", 
            "userName": "Xuefeng", 
            "userLink": "https://www.zhihu.com/people/ae0a7fa72b1da4f4bc4e263a4d4c44ba", 
            "upvote": 1, 
            "title": "利用Python对链家网北京主城区二手房进行数据分析", 
            "content": "<ul><li>本文主要讲述如何通过pandas对爬虫下来的链家数据进行相应的二手房数据分析，主要分析内容包括各个行政区，各个小区的房源信息情况。</li><li>数据来源: 该<a href=\"https://link.zhihu.com/?target=https%3A//github.com/XuefengHuang/lianjia-scrawler\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">repo</a>提供了python程序进行链家网爬虫，并从中提取二手房价格、面积、户型和二手房关注度等数据。</li><li>本文所用到的代码放在本人的<a href=\"https://link.zhihu.com/?target=https%3A//github.com/XuefengHuang/lianjia-scrawler/blob/master/data/lianjia.ipynb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Github</a>上，便于下载学习。</li><li>分析方法参考 <a href=\"https://link.zhihu.com/?target=http%3A//www.jianshu.com/p/44f261a62c0f\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://www.</span><span class=\"visible\">jianshu.com/p/44f261a62</span><span class=\"invisible\">c0f</span><span class=\"ellipsis\"></span></a></li><li>该数据已经应用在北京二手房数据网<a href=\"https://link.zhihu.com/?target=http%3A//www.ershoufangdata.com\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">www.ershoufangdata.com</a>。</li></ul><h2>导入链家网二手房在售房源的文件（数据更新时间2017-11-29）</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">import</span> <span class=\"nn\">pandas</span> <span class=\"kn\">as</span> <span class=\"nn\">pd</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"kn\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"kn\">as</span> <span class=\"nn\">plt</span>\n<span class=\"kn\">from</span> <span class=\"nn\">sklearn.cluster</span> <span class=\"kn\">import</span> <span class=\"n\">KMeans</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n\n<span class=\"n\">stdout</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span>\n<span class=\"nb\">reload</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"p\">)</span>\n<span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">setdefaultencoding</span><span class=\"p\">(</span><span class=\"s1\">&#39;utf-8&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span> <span class=\"o\">=</span> <span class=\"n\">stdout</span>\n\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">rcParams</span><span class=\"p\">[</span><span class=\"s1\">&#39;font.sans-serif&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;SimHei&#39;</span><span class=\"p\">]</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">rcParams</span><span class=\"p\">[</span><span class=\"s1\">&#39;axes.unicode_minus&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">False</span>\n\n<span class=\"c1\">#所有在售房源信息</span>\n<span class=\"n\">house</span><span class=\"o\">=</span><span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"s1\">&#39;houseinfo.csv&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># 所有小区信息</span>\n<span class=\"n\">community</span><span class=\"o\">=</span><span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"s1\">&#39;community.csv&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># 合并小区信息和房源信息表，可以获得房源更详细的地理位置</span>\n<span class=\"n\">community</span><span class=\"p\">[</span><span class=\"s1\">&#39;community&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">community</span><span class=\"p\">[</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">]</span>\n<span class=\"n\">house_detail</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">merge</span><span class=\"p\">(</span><span class=\"n\">house</span><span class=\"p\">,</span> <span class=\"n\">community</span><span class=\"p\">,</span> <span class=\"n\">on</span><span class=\"o\">=</span><span class=\"s1\">&#39;community&#39;</span><span class=\"p\">)</span></code></pre></div><h2>将数据从字符串提取出来</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"c1\"># 将字符串转换成数字</span>\n<span class=\"k\">def</span> <span class=\"nf\">data_adj</span><span class=\"p\">(</span><span class=\"n\">area_data</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>       \n    <span class=\"k\">if</span> <span class=\"nb\">str</span> <span class=\"ow\">in</span> <span class=\"n\">area_data</span> <span class=\"p\">:</span>        \n        <span class=\"k\">return</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">area_data</span><span class=\"p\">[</span><span class=\"mi\">0</span> <span class=\"p\">:</span> <span class=\"n\">area_data</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">)])</span>    \n    <span class=\"k\">else</span> <span class=\"p\">:</span>        \n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n<span class=\"c1\"># 处理房屋面积数据</span>\n<span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"nb\">apply</span><span class=\"p\">(</span><span class=\"n\">data_adj</span><span class=\"p\">,</span><span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;平米&#39;</span><span class=\"p\">)</span></code></pre></div><h2>删除车位信息</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">car</span><span class=\"o\">=</span><span class=\"n\">house</span><span class=\"p\">[</span><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">housetype</span><span class=\"o\">.</span><span class=\"nb\">str</span><span class=\"o\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s1\">&#39;车位&#39;</span><span class=\"p\">)]</span>\n<span class=\"k\">print</span> <span class=\"s1\">&#39;记录中共有车位</span><span class=\"si\">%d</span><span class=\"s1\">个&#39;</span><span class=\"o\">%</span><span class=\"n\">car</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">drop</span><span class=\"p\">(</span><span class=\"n\">car</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">,</span><span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n<span class=\"k\">print</span> <span class=\"s1\">&#39;现在还剩下</span><span class=\"si\">%d</span><span class=\"s1\">条记录&#39;</span><span class=\"o\">%</span><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"err\">记录中共有车位</span><span class=\"mi\">32</span><span class=\"err\">个</span>\n<span class=\"err\">现在还剩下</span><span class=\"mi\">16076</span><span class=\"err\">条记录</span></code></pre></div><h2>价格最高的5个别墅</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">bieshu</span><span class=\"o\">=</span><span class=\"n\">house</span><span class=\"p\">[</span><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">housetype</span><span class=\"o\">.</span><span class=\"nb\">str</span><span class=\"o\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s1\">&#39;别墅&#39;</span><span class=\"p\">)]</span>\n<span class=\"k\">print</span> <span class=\"s1\">&#39;记录中共有别墅</span><span class=\"si\">%d</span><span class=\"s1\">栋&#39;</span><span class=\"o\">%</span><span class=\"n\">bieshu</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"n\">bieshu</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"s1\">&#39;totalPrice&#39;</span><span class=\"p\">,</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)[</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">()</span>\n<span class=\"err\">记录中共有别墅</span><span class=\"mi\">50</span><span class=\"err\">栋</span>\n\n<span class=\"mi\">8020</span>       <span class=\"err\">香山清琴二期独栋别墅，毛坯房原始户型，花园</span><span class=\"mi\">1200</span><span class=\"err\">平米</span>\n<span class=\"mi\">102</span>               <span class=\"err\">千尺独栋</span> <span class=\"err\">北入户</span> <span class=\"err\">红顶商人金融界入住社区</span>\n<span class=\"mi\">2729</span>    <span class=\"err\">临湖独栋别墅</span> <span class=\"err\">花园半亩</span> <span class=\"err\">观景湖面和绿化</span> <span class=\"err\">满五年有车库房主自荐</span>\n<span class=\"mi\">3141</span>           <span class=\"err\">银湖别墅</span> <span class=\"err\">独栋</span> <span class=\"err\">望京公园旁</span> <span class=\"err\">五环里</span> <span class=\"err\">封闭式社区</span>\n<span class=\"mi\">4112</span>           <span class=\"err\">首排别墅</span> <span class=\"err\">位置好</span> <span class=\"err\">全景小区绿化和人工湖</span> <span class=\"err\">有车库</span>\n<span class=\"n\">Name</span><span class=\"p\">:</span> <span class=\"n\">title</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"nb\">object</span></code></pre></div><h2>删除别墅信息</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">drop</span><span class=\"p\">(</span><span class=\"n\">bieshu</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">,</span><span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n<span class=\"k\">print</span> <span class=\"s1\">&#39;现在还剩下</span><span class=\"si\">%d</span><span class=\"s1\">条记录&#39;</span><span class=\"o\">%</span><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"err\">现在还剩下</span><span class=\"mi\">16026</span><span class=\"err\">条记录</span></code></pre></div><h2>获取总价前五的房源信息</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"s1\">&#39;totalPrice&#39;</span><span class=\"p\">,</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)[</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n<span class=\"mi\">8571</span>      <span class=\"err\">中关村创业大街对过</span> <span class=\"err\">有名的公司入驻其中正规写字楼</span>\n<span class=\"mi\">11758</span>    <span class=\"err\">中关村创业大街对过</span> <span class=\"err\">有名的公司入驻其中正规一层底商</span>\n<span class=\"mi\">2480</span>       <span class=\"err\">西山别墅区拥有</span><span class=\"mi\">900</span><span class=\"err\">平大花园纯独栋社区房主自荐</span>\n<span class=\"mi\">14492</span>         <span class=\"err\">盘古大观</span> <span class=\"err\">大平层</span> <span class=\"err\">观景房</span> <span class=\"err\">格局可塑性强！</span>\n<span class=\"mi\">10154</span>       <span class=\"err\">朝阳公园内建筑，视野好，可以俯视朝阳公园美景</span>\n<span class=\"n\">Name</span><span class=\"p\">:</span> <span class=\"n\">title</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"nb\">object</span></code></pre></div><h2>获取户型数量分布信息</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">housetype</span> <span class=\"o\">=</span> <span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;housetype&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">value_counts</span><span class=\"p\">()</span>\n<span class=\"n\">housetype</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">8</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s1\">&#39;housetype&#39;</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"s1\">&#39;size&#39;</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"s1\">&#39;户型数量分布&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;数量&#39;</span><span class=\"p\">])</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a96541909cdd081f33bf613d2a57277a_b.jpg\" data-size=\"normal\" data-rawwidth=\"379\" data-rawheight=\"284\" class=\"content_image\" width=\"379\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;379&#39; height=&#39;284&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"379\" data-rawheight=\"284\" class=\"content_image lazy\" width=\"379\" data-actualsrc=\"https://pic3.zhimg.com/v2-a96541909cdd081f33bf613d2a57277a_b.jpg\"/><figcaption>户型数量分布</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>关注人数最多5套房子</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;guanzhu&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;followInfo&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"nb\">apply</span><span class=\"p\">(</span><span class=\"n\">data_adj</span><span class=\"p\">,</span><span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;人关注&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"s1\">&#39;guanzhu&#39;</span><span class=\"p\">,</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)[</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n<span class=\"mi\">47</span>                   <span class=\"err\">弘善家园南向开间，满两年，免增值税</span>\n<span class=\"mi\">2313</span>         <span class=\"err\">四惠东</span> <span class=\"err\">康家园</span> <span class=\"err\">南向一居室</span> <span class=\"err\">地铁</span><span class=\"mi\">1</span><span class=\"err\">号线出行房主自荐</span>\n<span class=\"mi\">990</span>     <span class=\"err\">远见名苑</span>  <span class=\"err\">东南两居</span>  <span class=\"err\">满五年家庭唯一住房</span> <span class=\"err\">诚心出售房主自荐</span>\n<span class=\"mi\">2331</span>               <span class=\"err\">荣丰二期朝南复式无遮挡全天采光房主自荐</span>\n<span class=\"mi\">915</span>             <span class=\"err\">通州万达北苑地铁站</span> <span class=\"err\">天时名苑</span> <span class=\"err\">大两居可改</span><span class=\"mi\">3</span><span class=\"err\">居</span>\n<span class=\"n\">Name</span><span class=\"p\">:</span> <span class=\"n\">title</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"nb\">object</span></code></pre></div><h2>户型和关注人数分布</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">fig</span><span class=\"p\">,</span> <span class=\"n\">ax1</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplots</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">)</span>    \n<span class=\"n\">type_interest_group</span> <span class=\"o\">=</span> <span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;guanzhu&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;housetype&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">agg</span><span class=\"p\">([(</span><span class=\"s1\">&#39;户型&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;count&#39;</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"s1\">&#39;关注人数&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;sum&#39;</span><span class=\"p\">)])</span>    \n<span class=\"c1\">#取户型&gt;50的数据进行可视化</span>\n<span class=\"n\">ti_sort</span> <span class=\"o\">=</span> <span class=\"n\">type_interest_group</span><span class=\"p\">[</span><span class=\"n\">type_interest_group</span><span class=\"p\">[</span><span class=\"s1\">&#39;户型&#39;</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">50</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"n\">by</span><span class=\"o\">=</span><span class=\"s1\">&#39;户型&#39;</span><span class=\"p\">)</span>    \n<span class=\"n\">ti_sort</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;barh&#39;</span><span class=\"p\">,</span> <span class=\"n\">alpha</span><span class=\"o\">=</span><span class=\"mf\">0.7</span><span class=\"p\">,</span> <span class=\"n\">grid</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">,</span> <span class=\"n\">ax</span><span class=\"o\">=</span><span class=\"n\">ax1</span><span class=\"p\">)</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">title</span><span class=\"p\">(</span><span class=\"s1\">&#39;二手房户型和关注人数分布&#39;</span><span class=\"p\">)</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;户型&#39;</span><span class=\"p\">)</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-17a864dc324da093eb109292520bf9be_b.jpg\" data-size=\"normal\" data-rawwidth=\"412\" data-rawheight=\"262\" class=\"content_image\" width=\"412\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;412&#39; height=&#39;262&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"412\" data-rawheight=\"262\" class=\"content_image lazy\" width=\"412\" data-actualsrc=\"https://pic3.zhimg.com/v2-17a864dc324da093eb109292520bf9be_b.jpg\"/><figcaption>二手房户型和关注人数分布</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>面积分布</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">fig</span><span class=\"p\">,</span><span class=\"n\">ax2</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplots</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">)</span>    \n<span class=\"n\">area_level</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"mi\">150</span><span class=\"p\">,</span> <span class=\"mi\">200</span><span class=\"p\">,</span> <span class=\"mi\">250</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"mi\">500</span><span class=\"p\">]</span>    \n<span class=\"n\">label_level</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;小于50&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;50-100&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;100-150&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;150-200&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;200-250&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;250-300&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;300-350&#39;</span><span class=\"p\">]</span>    \n<span class=\"n\">area_cut</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">cut</span><span class=\"p\">(</span><span class=\"n\">house</span><span class=\"p\">[</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">],</span> <span class=\"n\">area_level</span><span class=\"p\">,</span> <span class=\"n\">labels</span><span class=\"o\">=</span><span class=\"n\">label_level</span><span class=\"p\">)</span>        \n<span class=\"n\">area_cut</span><span class=\"o\">.</span><span class=\"n\">value_counts</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span> <span class=\"n\">rot</span><span class=\"o\">=</span><span class=\"mi\">30</span><span class=\"p\">,</span> <span class=\"n\">alpha</span><span class=\"o\">=</span><span class=\"mf\">0.4</span><span class=\"p\">,</span> <span class=\"n\">grid</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"s1\">&#39;small&#39;</span><span class=\"p\">,</span> <span class=\"n\">ax</span><span class=\"o\">=</span><span class=\"n\">ax2</span><span class=\"p\">)</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">title</span><span class=\"p\">(</span><span class=\"s1\">&#39;二手房面积分布&#39;</span><span class=\"p\">)</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;面积&#39;</span><span class=\"p\">)</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;数量&#39;</span><span class=\"p\">])</span>    \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-0154be9f1b975c2f959d5591ac8541c0_b.jpg\" data-size=\"normal\" data-rawwidth=\"380\" data-rawheight=\"288\" class=\"content_image\" width=\"380\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;380&#39; height=&#39;288&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"380\" data-rawheight=\"288\" class=\"content_image lazy\" width=\"380\" data-actualsrc=\"https://pic1.zhimg.com/v2-0154be9f1b975c2f959d5591ac8541c0_b.jpg\"/><figcaption>二手房面积分布</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>聚类分析</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"c1\"># 缺失值处理:直接将缺失值去掉    </span>\n<span class=\"n\">cluster_data</span> <span class=\"o\">=</span> <span class=\"n\">house</span><span class=\"p\">[[</span><span class=\"s1\">&#39;guanzhu&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;totalPrice&#39;</span><span class=\"p\">]]</span><span class=\"o\">.</span><span class=\"n\">dropna</span><span class=\"p\">()</span>    \n<span class=\"c1\">#将簇数设为3    </span>\n<span class=\"n\">K_model</span> <span class=\"o\">=</span> <span class=\"n\">KMeans</span><span class=\"p\">(</span><span class=\"n\">n_clusters</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>    \n<span class=\"n\">alg</span> <span class=\"o\">=</span> <span class=\"n\">K_model</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">cluster_data</span><span class=\"p\">)</span>    \n<span class=\"s1\">&#39;------聚类中心------&#39;</span>   \n<span class=\"n\">center</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">(</span><span class=\"n\">alg</span><span class=\"o\">.</span><span class=\"n\">cluster_centers_</span><span class=\"p\">,</span> <span class=\"n\">columns</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;关注人数&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;面积&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;房价&#39;</span><span class=\"p\">])</span>    \n<span class=\"n\">cluster_data</span><span class=\"p\">[</span><span class=\"s1\">&#39;label&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">alg</span><span class=\"o\">.</span><span class=\"n\">labels_</span> \n<span class=\"n\">center</span></code></pre></div><figure data-size=\"small\"><noscript><img src=\"https://pic1.zhimg.com/v2-46ce87c5182febed23805e8b5580d314_b.jpg\" data-size=\"small\" data-rawwidth=\"726\" data-rawheight=\"280\" class=\"origin_image zh-lightbox-thumb\" width=\"726\" data-original=\"https://pic1.zhimg.com/v2-46ce87c5182febed23805e8b5580d314_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;726&#39; height=&#39;280&#39;&gt;&lt;/svg&gt;\" data-size=\"small\" data-rawwidth=\"726\" data-rawheight=\"280\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"726\" data-original=\"https://pic1.zhimg.com/v2-46ce87c5182febed23805e8b5580d314_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-46ce87c5182febed23805e8b5580d314_b.jpg\"/><figcaption>聚类分析</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><p class=\"ztext-empty-paragraph\"><br/></p><h2>北京市在售面积最小二手房</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">iloc</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,:]</span>\n<span class=\"n\">houseID</span>                                            <span class=\"mi\">101102324602</span>\n<span class=\"n\">title</span>                                      <span class=\"err\">智德北巷（北河沿大街）</span><span class=\"o\">+</span><span class=\"err\">小户型一居</span><span class=\"o\">+</span><span class=\"err\">南向</span>\n<span class=\"n\">link</span>          <span class=\"n\">https</span><span class=\"p\">:</span><span class=\"o\">//</span><span class=\"n\">bj</span><span class=\"o\">.</span><span class=\"n\">lianjia</span><span class=\"o\">.</span><span class=\"n\">com</span><span class=\"o\">/</span><span class=\"n\">ershoufang</span><span class=\"o\">/</span><span class=\"mf\">101102324602.</span><span class=\"o\">..</span>\n<span class=\"n\">community</span>                                                  <span class=\"err\">智德北巷</span>\n<span class=\"n\">years</span>                                          <span class=\"err\">中楼层</span><span class=\"p\">(</span><span class=\"err\">共</span><span class=\"mi\">6</span><span class=\"err\">层</span><span class=\"p\">)</span><span class=\"mi\">1985</span><span class=\"err\">年建板楼</span>\n<span class=\"n\">housetype</span>                                                  <span class=\"mi\">1</span><span class=\"err\">室</span><span class=\"mi\">0</span><span class=\"err\">厅</span>\n<span class=\"n\">square</span>                                                    <span class=\"mf\">15.29</span>\n<span class=\"n\">direction</span>                                                     <span class=\"err\">南</span>\n<span class=\"n\">floor</span>                                          <span class=\"err\">中楼层</span><span class=\"p\">(</span><span class=\"err\">共</span><span class=\"mi\">6</span><span class=\"err\">层</span><span class=\"p\">)</span><span class=\"mi\">1985</span><span class=\"err\">年建板楼</span>\n<span class=\"n\">taxtype</span>                                          <span class=\"err\">距离</span><span class=\"mi\">5</span><span class=\"err\">号线灯市口站</span><span class=\"mi\">1113</span><span class=\"err\">米</span>\n<span class=\"n\">totalPrice</span>                                                  <span class=\"mi\">220</span>\n<span class=\"n\">unitPrice</span>                                                <span class=\"mi\">143885</span>\n<span class=\"n\">followInfo</span>                               <span class=\"mi\">56</span><span class=\"err\">人关注</span> <span class=\"o\">/</span> <span class=\"err\">共</span><span class=\"mi\">2</span><span class=\"err\">次带看</span> <span class=\"o\">/</span> <span class=\"mi\">8</span><span class=\"err\">天以前发布</span>\n<span class=\"n\">validdate</span>                                   <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">23</span><span class=\"p\">:</span><span class=\"mi\">16</span>\n<span class=\"n\">guanzhu</span>                                                      <span class=\"mi\">56</span>\n<span class=\"n\">Name</span><span class=\"p\">:</span> <span class=\"mi\">15260</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"nb\">object</span></code></pre></div><h2>北京市在售面积最大二手房</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">,</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">iloc</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,:]</span>\n<span class=\"n\">houseID</span>                                            <span class=\"mi\">101102105035</span>\n<span class=\"n\">title</span>                                  <span class=\"err\">中关村创业大街对过</span> <span class=\"err\">有名的公司入驻其中正规写字楼</span>\n<span class=\"n\">link</span>          <span class=\"n\">https</span><span class=\"p\">:</span><span class=\"o\">//</span><span class=\"n\">bj</span><span class=\"o\">.</span><span class=\"n\">lianjia</span><span class=\"o\">.</span><span class=\"n\">com</span><span class=\"o\">/</span><span class=\"n\">ershoufang</span><span class=\"o\">/</span><span class=\"mf\">101102105035.</span><span class=\"o\">..</span>\n<span class=\"n\">community</span>                                                  <span class=\"err\">银科大厦</span>\n<span class=\"n\">years</span>                                         <span class=\"err\">低楼层</span><span class=\"p\">(</span><span class=\"err\">共</span><span class=\"mi\">22</span><span class=\"err\">层</span><span class=\"p\">)</span><span class=\"mi\">2004</span><span class=\"err\">年建塔楼</span>\n<span class=\"n\">housetype</span>                                                 <span class=\"mi\">1</span><span class=\"err\">房间</span><span class=\"mi\">0</span><span class=\"err\">卫</span>\n<span class=\"n\">square</span>                                                  <span class=\"mf\">2623.28</span>\n<span class=\"n\">direction</span>                                               <span class=\"err\">东</span> <span class=\"err\">南</span> <span class=\"err\">西</span> <span class=\"err\">北</span>\n<span class=\"n\">floor</span>                                         <span class=\"err\">低楼层</span><span class=\"p\">(</span><span class=\"err\">共</span><span class=\"mi\">22</span><span class=\"err\">层</span><span class=\"p\">)</span><span class=\"mi\">2004</span><span class=\"err\">年建塔楼</span>\n<span class=\"n\">taxtype</span>                                     <span class=\"err\">距离</span><span class=\"mi\">10</span><span class=\"err\">号线苏州街站</span><span class=\"mi\">898</span><span class=\"err\">米房本满五年</span>\n<span class=\"n\">totalPrice</span>                                                <span class=\"mi\">12000</span>\n<span class=\"n\">unitPrice</span>                                                 <span class=\"mi\">45745</span>\n<span class=\"n\">followInfo</span>                               <span class=\"mi\">1</span><span class=\"err\">人关注</span> <span class=\"o\">/</span> <span class=\"err\">共</span><span class=\"mi\">0</span><span class=\"err\">次带看</span> <span class=\"o\">/</span> <span class=\"mi\">2</span><span class=\"err\">个月以前发布</span>\n<span class=\"n\">validdate</span>                                   <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mo\">07</span><span class=\"p\">:</span><span class=\"mi\">32</span>\n<span class=\"n\">guanzhu</span>                                                       <span class=\"mi\">1</span>\n<span class=\"n\">Name</span><span class=\"p\">:</span> <span class=\"mi\">8571</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"nb\">object</span></code></pre></div><h2>各个行政区房源均价</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">house_unitprice_perdistrict</span> <span class=\"o\">=</span> <span class=\"n\">house_detail</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;district&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()[</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">]</span>\n<span class=\"n\">house_unitprice_perdistrict</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s1\">&#39;district&#39;</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"s1\">&#39;各个行政区房源均价&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;均价&#39;</span><span class=\"p\">])</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1ca3a0791caa7a421d3df886ae54f900_b.jpg\" data-size=\"normal\" data-rawwidth=\"389\" data-rawheight=\"286\" class=\"content_image\" width=\"389\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;389&#39; height=&#39;286&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"389\" data-rawheight=\"286\" class=\"content_image lazy\" width=\"389\" data-actualsrc=\"https://pic1.zhimg.com/v2-1ca3a0791caa7a421d3df886ae54f900_b.jpg\"/><figcaption>各个行政区房源均价</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>各个区域房源数量排序</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">bizcircle_count</span><span class=\"o\">=</span><span class=\"n\">house_detail</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;bizcircle&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"n\">bizcircle_count</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s1\">&#39;bizcircle&#39;</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"s1\">&#39;size&#39;</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"s1\">&#39;各个区域房源数量分布&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;数量&#39;</span><span class=\"p\">])</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-06be2f8ef775d5510db8c4ecebbc2199_b.jpg\" data-size=\"normal\" data-rawwidth=\"374\" data-rawheight=\"316\" class=\"content_image\" width=\"374\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;374&#39; height=&#39;316&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"374\" data-rawheight=\"316\" class=\"content_image lazy\" width=\"374\" data-actualsrc=\"https://pic2.zhimg.com/v2-06be2f8ef775d5510db8c4ecebbc2199_b.jpg\"/><figcaption>各个区域房源数量分布</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>各个区域均价排序</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">bizcircle_unitprice</span><span class=\"o\">=</span><span class=\"n\">house_detail</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;bizcircle&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()[</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"n\">bizcircle_unitprice</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s1\">&#39;bizcircle&#39;</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"s1\">&#39;各个区域均价分布&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;均价&#39;</span><span class=\"p\">])</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-ce9d20e063508b220b5e91baef89708c_b.jpg\" data-size=\"normal\" data-rawwidth=\"389\" data-rawheight=\"306\" class=\"content_image\" width=\"389\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;389&#39; height=&#39;306&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"389\" data-rawheight=\"306\" class=\"content_image lazy\" width=\"389\" data-actualsrc=\"https://pic1.zhimg.com/v2-ce9d20e063508b220b5e91baef89708c_b.jpg\"/><figcaption>各个区域均价分布</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>各个区域小区数量</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">bizcircle_community</span><span class=\"o\">=</span><span class=\"n\">community</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;bizcircle&#39;</span><span class=\"p\">)[</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"n\">bizcircle_community</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s1\">&#39;bizcircle&#39;</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"s1\">&#39;size&#39;</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"s1\">&#39;各个区域小区数量分布&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;数量&#39;</span><span class=\"p\">])</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-a0c701a7cb401eb255f966eb208681e0_b.jpg\" data-size=\"normal\" data-rawwidth=\"374\" data-rawheight=\"326\" class=\"content_image\" width=\"374\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;374&#39; height=&#39;326&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"374\" data-rawheight=\"326\" class=\"content_image lazy\" width=\"374\" data-actualsrc=\"https://pic1.zhimg.com/v2-a0c701a7cb401eb255f966eb208681e0_b.jpg\"/><figcaption>各个区域小区数量分布</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>按小区均价排序</h2><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">community_unitprice</span> <span class=\"o\">=</span> <span class=\"n\">house</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;community&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()[</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">sort_values</span><span class=\"p\">(</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"n\">community_unitprice</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">15</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s1\">&#39;community&#39;</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"s1\">&#39;各个小区均价分布&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"s1\">&#39;均价&#39;</span><span class=\"p\">])</span> \n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span></code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-ff39e4d0806749fb1b1b217dcd183ca9_b.jpg\" data-size=\"normal\" data-rawwidth=\"389\" data-rawheight=\"336\" class=\"content_image\" width=\"389\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;389&#39; height=&#39;336&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"389\" data-rawheight=\"336\" class=\"content_image lazy\" width=\"389\" data-actualsrc=\"https://pic2.zhimg.com/v2-ff39e4d0806749fb1b1b217dcd183ca9_b.jpg\"/><figcaption>各个小区均价分布</figcaption></figure><p></p>", 
            "topic": [
                {
                    "tag": "数据分析", 
                    "tagLink": "https://api.zhihu.com/topics/19559424"
                }, 
                {
                    "tag": "Python", 
                    "tagLink": "https://api.zhihu.com/topics/19552832"
                }, 
                {
                    "tag": "链家", 
                    "tagLink": "https://api.zhihu.com/topics/19676226"
                }
            ], 
            "comments": [
                {
                    "userName": "Kismet", 
                    "userLink": "https://www.zhihu.com/people/f37f793c211b98b125f0fb06301f8e6e", 
                    "content": "<p>你好，你是用的python2.7吗，我是3.6的版本，运行的时候好多报错</p>", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "YY800820", 
                    "userLink": "https://www.zhihu.com/people/4f83ae248e59ea7e2cb93fe6d846359d", 
                    "content": "<p>什么时候能出合肥的啊，超级期待</p><a class=\"comment_sticker\" href=\"https://pic3.zhimg.com/v2-00ee32c36ff2add684bbd42f0649aa4e.gif\" data-width=\"\" data-height=\"\">[超开心]</a>", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/31472899", 
            "userName": "Xuefeng", 
            "userLink": "https://www.zhihu.com/people/ae0a7fa72b1da4f4bc4e263a4d4c44ba", 
            "upvote": 11, 
            "title": "链家房源爬虫（含源码）", 
            "content": "<p>链家APP上有很多在售房源信息以及成交房源信息，如果可以把这些信息爬下来，可以得到很多有价值的信息。因此本文将讲一讲如何爬取这些数据，并保存下来供以后分析。<br/>本文将介绍以下几个方面：</p><ul><li>程序介绍</li><li>使用教程</li><li>实现思路</li><li>数据存储</li><li>可视化分析(Pandas分析请参考<a href=\"https://zhuanlan.zhihu.com/p/31532470\" class=\"internal\"><span class=\"invisible\">https://</span><span class=\"visible\">zhuanlan.zhihu.com/p/31</span><span class=\"invisible\">532470</span><span class=\"ellipsis\"></span></a>)</li></ul><h2>程序介绍</h2><ul><li>该程序支持爬取链家在线二手房数据，历史成交数据，在线租房数据和指定城市所有小区数据。</li><li>数据存储目前支持三种数据库格式（mysql，postgreSql, Sqlite3)。</li><li>由于链家网采取对IP限流设置，所以该程序没有采取多线程爬取，并且限制了爬取速度来防止被封。</li><li>提供mysql数据转到ES的解决方案，方便进行数据可视化分析。</li><li>该数据已经应用在北京二手房数据网<a href=\"https://link.zhihu.com/?target=http%3A//www.ershoufangdata.com\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">www.ershoufangdata.com</a>。</li></ul><h2>使用教程</h2><ul><li>源码地址 <a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%3A//github.com/XuefengHuang/lianjia-scrawler\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">https://github.com/XuefengHuang/lianjia-scrawler</a> 如果喜欢，请给个star支持一下，谢谢！</li><li>下载源码并安装依赖包</li></ul><div class=\"highlight\"><pre><code class=\"language-bash\"><span class=\"m\">1</span>. git clone https://github.com/XuefengHuang/lianjia-scrawler.git\n<span class=\"m\">2</span>. <span class=\"nb\">cd</span> lianjia-scrawler\n<span class=\"c1\"># If you&#39;d like not to use [virtualenv](https://virtualenv.pypa.io/en/stable/), please skip step 3 and 4.</span>\n<span class=\"m\">3</span>. virtualenv lianjia\n<span class=\"m\">4</span>. <span class=\"nb\">source</span> lianjia/bin/activate\n<span class=\"m\">5</span>. pip install -r requirements.txt\n</code></pre></div><ul><li>设置数据库信息以及爬取城市行政区信息（支持三种数据库格式）</li></ul><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">DBENGINE</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;mysql&#39;</span> <span class=\"c1\">#ENGINE OPTIONS: mysql, sqlite3, postgresql</span>\n<span class=\"n\">DBNAME</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;test&#39;</span>\n<span class=\"n\">DBUSER</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;root&#39;</span>\n<span class=\"n\">DBPASSWORD</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span>\n<span class=\"n\">DBHOST</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;127.0.0.1&#39;</span>\n<span class=\"n\">DBPORT</span> <span class=\"o\">=</span> <span class=\"mi\">3306</span>\n<span class=\"n\">CITY</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;bj&#39;</span> <span class=\"c1\"># only one, shanghai=sh shenzhen=sh......</span>\n<span class=\"n\">REGIONLIST</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"sa\">u</span><span class=\"s1\">&#39;chaoyang&#39;</span><span class=\"p\">,</span> <span class=\"sa\">u</span><span class=\"s1\">&#39;xicheng&#39;</span><span class=\"p\">]</span> <span class=\"c1\"># 只支持拼音</span>\n</code></pre></div><ul><li>运行 <code>python scrawl.py</code>! (请注释14行如果已爬取完所想要的小区信息)</li><li>可以修改<code>scrawl.py</code>来只爬取在售房源信息或者成交房源信息或者租售房源信息</li></ul><h2>实现思路</h2><ul><li>开始抓取前先观察下目标页面或网站的结构，其中比较重要的是URL的结构。链家网的二手房列表页面共有100个，URL结构为<a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttp%3A//bj.lianjia.com/ershoufang/pg9/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">http://bj.lianjia.com/ershoufang/pg9/</a>，其中bj表示城市，/ershoufang/是频道名称，pg9是页面码。我们要抓取的是北京的二手房频道，所以前面的部分不会变，属于固定部分，后面的页面码需要在1-100间变化，属于可变部分。将URL分为两部分，前面的固定部分赋值给url，后面的可变部分使用for循环。我们以根据小区名字搜索二手房出售情况为例：</li></ul><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">BASE_URL</span> <span class=\"o\">=</span> <span class=\"sa\">u</span><span class=\"s2\">&#34;http://bj.lianjia.com/&#34;</span>\n<span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">BASE_URL</span> <span class=\"o\">+</span> <span class=\"sa\">u</span><span class=\"s2\">&#34;ershoufang/rs&#34;</span> <span class=\"o\">+</span> <span class=\"n\">urllib2</span><span class=\"o\">.</span><span class=\"n\">quote</span><span class=\"p\">(</span><span class=\"n\">communityname</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">&#39;utf8&#39;</span><span class=\"p\">))</span> <span class=\"o\">+</span> <span class=\"s2\">&#34;/&#34;</span>\n<span class=\"n\">total_pages</span> <span class=\"o\">=</span> <span class=\"n\">misc</span><span class=\"o\">.</span><span class=\"n\">get_total_pages</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">)</span> <span class=\"o\">//</span><span class=\"err\">获取总页数信息</span>\n<span class=\"k\">for</span> <span class=\"n\">page</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">total_pages</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">page</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"n\">url_page</span> <span class=\"o\">=</span> <span class=\"n\">BASE_URL</span> <span class=\"o\">+</span> <span class=\"sa\">u</span><span class=\"s2\">&#34;ershoufang/pg</span><span class=\"si\">%d</span><span class=\"s2\">rs</span><span class=\"si\">%s</span><span class=\"s2\">/&#34;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">page</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">urllib2</span><span class=\"o\">.</span><span class=\"n\">quote</span><span class=\"p\">(</span><span class=\"n\">communityname</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">&#39;utf8&#39;</span><span class=\"p\">)))</span>\n\n<span class=\"o\">//</span><span class=\"err\">获取总页数信息代码</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_total_pages</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">):</span>\n    <span class=\"n\">source_code</span> <span class=\"o\">=</span> <span class=\"n\">get_source_code</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">)</span>\n    <span class=\"n\">soup</span> <span class=\"o\">=</span> <span class=\"n\">BeautifulSoup</span><span class=\"p\">(</span><span class=\"n\">source_code</span><span class=\"p\">,</span> <span class=\"s1\">&#39;lxml&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">total_pages</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">page_info</span> <span class=\"o\">=</span> <span class=\"n\">soup</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s1\">&#39;div&#39;</span><span class=\"p\">,{</span><span class=\"s1\">&#39;class&#39;</span><span class=\"p\">:</span><span class=\"s1\">&#39;page-box house-lst-page-box&#39;</span><span class=\"p\">})</span>\n    <span class=\"k\">except</span> <span class=\"ne\">AttributeError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"n\">page_info</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">page_info</span> <span class=\"o\">==</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n    <span class=\"n\">page_info_str</span> <span class=\"o\">=</span> <span class=\"n\">page_info</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;page-data&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;,&#39;</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>  <span class=\"c1\">#&#39;{&#34;totalPage&#34;:5,&#34;curPage&#34;:1}&#39;</span>\n    <span class=\"n\">total_pages</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">page_info_str</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n    <span class=\"k\">return</span> <span class=\"n\">total_pages</span>\n</code></pre></div><ul><li>页面抓取完成后无法直接阅读和进行数据提取，还需要进行页面解析。我们使用BeautifulSoup对页面进行解析。</li></ul><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">soup</span> <span class=\"o\">=</span> <span class=\"n\">BeautifulSoup</span><span class=\"p\">(</span><span class=\"n\">source_code</span><span class=\"p\">,</span> <span class=\"s1\">&#39;lxml&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">nameList</span> <span class=\"o\">=</span> <span class=\"n\">soup</span><span class=\"o\">.</span><span class=\"n\">findAll</span><span class=\"p\">(</span><span class=\"s2\">&#34;li&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;clear&#34;</span><span class=\"p\">})</span>\n</code></pre></div><ul><li>完成页面解析后就可以对页面中的关键信息进行提取了。下面我们分别对房源各个信息进行提取。</li></ul><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">nameList</span><span class=\"p\">:</span> <span class=\"c1\"># per house loop</span>\n    <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n    <span class=\"n\">info_dict</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">housetitle</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;title&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">:</span><span class=\"n\">housetitle</span><span class=\"o\">.</span><span class=\"n\">get_text</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;link&#39;</span><span class=\"p\">:</span><span class=\"n\">housetitle</span><span class=\"o\">.</span><span class=\"n\">a</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;href&#39;</span><span class=\"p\">)})</span>\n\n        <span class=\"n\">houseaddr</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;address&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">info</span> <span class=\"o\">=</span> <span class=\"n\">houseaddr</span><span class=\"o\">.</span><span class=\"n\">div</span><span class=\"o\">.</span><span class=\"n\">get_text</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;|&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;community&#39;</span><span class=\"p\">:</span><span class=\"n\">info</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;housetype&#39;</span><span class=\"p\">:</span><span class=\"n\">info</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;square&#39;</span><span class=\"p\">:</span><span class=\"n\">info</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;direction&#39;</span><span class=\"p\">:</span><span class=\"n\">info</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n\n        <span class=\"n\">housefloor</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;flood&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">floor_all</span> <span class=\"o\">=</span> <span class=\"n\">housefloor</span><span class=\"o\">.</span><span class=\"n\">div</span><span class=\"o\">.</span><span class=\"n\">get_text</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;-&#39;</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;floor&#39;</span><span class=\"p\">:</span><span class=\"n\">floor_all</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;years&#39;</span><span class=\"p\">:</span><span class=\"n\">floor_all</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n\n        <span class=\"n\">followInfo</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;followInfo&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;followInfo&#39;</span><span class=\"p\">:</span><span class=\"n\">followInfo</span><span class=\"o\">.</span><span class=\"n\">get_text</span><span class=\"p\">()})</span>\n\n        <span class=\"n\">tax</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;tag&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;taxtype&#39;</span><span class=\"p\">:</span><span class=\"n\">tax</span><span class=\"o\">.</span><span class=\"n\">get_text</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()})</span>\n\n        <span class=\"n\">totalPrice</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;totalPrice&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;totalPrice&#39;</span><span class=\"p\">:</span><span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">totalPrice</span><span class=\"o\">.</span><span class=\"n\">span</span><span class=\"o\">.</span><span class=\"n\">get_text</span><span class=\"p\">())})</span>\n\n        <span class=\"n\">unitPrice</span> <span class=\"o\">=</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">&#34;div&#34;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&#34;class&#34;</span><span class=\"p\">:</span><span class=\"s2\">&#34;unitPrice&#34;</span><span class=\"p\">})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;unitPrice&#39;</span><span class=\"p\">:</span><span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">unitPrice</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;data-price&#39;</span><span class=\"p\">))})</span>\n        <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"sa\">u</span><span class=\"s1\">&#39;houseID&#39;</span><span class=\"p\">:</span><span class=\"n\">unitPrice</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;data-hid&#39;</span><span class=\"p\">)})</span>\n    <span class=\"k\">except</span><span class=\"p\">:</span>\n        <span class=\"k\">continue</span>\n</code></pre></div><ul><li>提取完后，为了之后数据分析，要存进之前配置的数据库中。</li></ul><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">Houseinfo</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">info_dict</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">upsert</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">()</span>\n<span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">Hisprice</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">houseID</span><span class=\"o\">=</span><span class=\"n\">info_dict</span><span class=\"p\">[</span><span class=\"s1\">&#39;houseID&#39;</span><span class=\"p\">],</span> <span class=\"n\">totalPrice</span><span class=\"o\">=</span><span class=\"n\">info_dict</span><span class=\"p\">[</span><span class=\"s1\">&#39;totalPrice&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">upsert</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">()</span>\n</code></pre></div><h2>数据存储</h2><ul><li>可支持数据库：mysql，postgreSql, Sqlite3</li><li>数据库信息：</li></ul><div class=\"highlight\"><pre><code class=\"language-bash\">Community小区信息（id, title, link, district, bizcurcle, taglist）\n\nHouseinfo在售房源信息（houseID, title, link, community, years, housetype, square, direction, floor, taxtype, totalPrice, unitPrice, followInfo, validdate<span class=\"o\">)</span>\n\nHisprice历史成交信息（houseID，totalPrice，date）\n\nSellinfo成交房源信息<span class=\"o\">(</span>houseID, title, link, community, years, housetype, square, direction, floor, status, source,, totalPrice, unitPrice, dealdate, updatedate<span class=\"o\">)</span>\n\nRentinfo租售房源信息 <span class=\"o\">(</span>houseID, title, link, region, zone, meters, other, subway, decoration, heating, price, pricepre, updatedate<span class=\"o\">)</span>\n\n</code></pre></div><h2>可视化分析</h2><ul><li>首先需要同步mysql数据到ES里，然后利用kibana进行数据分析。同步的部分可以利用该<a href=\"https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%3A//github.com/siddontang/go-mysql-elasticsearch\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">工具</a></li><li>截图示例：</li></ul><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-32af6ac25cfb49cac070494b27ff2efa_b.jpg\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"365\" class=\"origin_image zh-lightbox-thumb\" width=\"700\" data-original=\"https://pic3.zhimg.com/v2-32af6ac25cfb49cac070494b27ff2efa_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;700&#39; height=&#39;365&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"365\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"700\" data-original=\"https://pic3.zhimg.com/v2-32af6ac25cfb49cac070494b27ff2efa_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-32af6ac25cfb49cac070494b27ff2efa_b.jpg\"/><figcaption>房源信息</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-46f375956f87476726936351acbe9bbd_b.jpg\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"391\" class=\"origin_image zh-lightbox-thumb\" width=\"700\" data-original=\"https://pic2.zhimg.com/v2-46f375956f87476726936351acbe9bbd_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;700&#39; height=&#39;391&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"700\" data-rawheight=\"391\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"700\" data-original=\"https://pic2.zhimg.com/v2-46f375956f87476726936351acbe9bbd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-46f375956f87476726936351acbe9bbd_b.jpg\"/><figcaption>房源信息json格式数据</figcaption></figure><p class=\"ztext-empty-paragraph\"><br/></p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f53bca63d68a5a1907b4c10ece0dcdb9_b.jpg\" data-size=\"normal\" data-rawwidth=\"1236\" data-rawheight=\"910\" class=\"origin_image zh-lightbox-thumb\" width=\"1236\" data-original=\"https://pic2.zhimg.com/v2-f53bca63d68a5a1907b4c10ece0dcdb9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1236&#39; height=&#39;910&#39;&gt;&lt;/svg&gt;\" data-size=\"normal\" data-rawwidth=\"1236\" data-rawheight=\"910\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1236\" data-original=\"https://pic2.zhimg.com/v2-f53bca63d68a5a1907b4c10ece0dcdb9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-f53bca63d68a5a1907b4c10ece0dcdb9_b.jpg\"/><figcaption>房源地区分布图</figcaption></figure><p></p><p></p>", 
            "topic": [
                {
                    "tag": "python爬虫", 
                    "tagLink": "https://api.zhihu.com/topics/20086364"
                }, 
                {
                    "tag": "网页爬虫", 
                    "tagLink": "https://api.zhihu.com/topics/19794679"
                }, 
                {
                    "tag": "链家", 
                    "tagLink": "https://api.zhihu.com/topics/19676226"
                }
            ], 
            "comments": [
                {
                    "userName": "icekoor", 
                    "userLink": "https://www.zhihu.com/people/a7f7ae4fbc11b35ff8e48386d5639a2e", 
                    "content": "厉害，早就想做一个了", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "赵海潮", 
                    "userLink": "https://www.zhihu.com/people/6cb232f3be3a8fad8450b154dea8d86f", 
                    "content": "<p>学习了，现在链家更新前端代码了。当然数据差不多就够用了。</p>", 
                    "likes": 0, 
                    "childComments": []
                }, 
                {
                    "userName": "知乎用户", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "爬一次要多久？", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/c_157990354"
}
