{
    "title": "å¤œæ›‰å®¸", 
    "description": "", 
    "followers": [
        "https://www.zhihu.com/people/zhang-hao-jie-10", 
        "https://www.zhihu.com/people/jetdancer", 
        "https://www.zhihu.com/people/cai-hui-6", 
        "https://www.zhihu.com/people/login-16", 
        "https://www.zhihu.com/people/jack-pan-23", 
        "https://www.zhihu.com/people/liwei-xie-50", 
        "https://www.zhihu.com/people/wisdommm", 
        "https://www.zhihu.com/people/qiangzhao", 
        "https://www.zhihu.com/people/luoxiaohui", 
        "https://www.zhihu.com/people/snap-39", 
        "https://www.zhihu.com/people/shi-lei-81-5", 
        "https://www.zhihu.com/people/__code__", 
        "https://www.zhihu.com/people/Ccsk", 
        "https://www.zhihu.com/people/qi-qi-deyi", 
        "https://www.zhihu.com/people/person", 
        "https://www.zhihu.com/people/cai-niao-98-80", 
        "https://www.zhihu.com/people/shui-guai-66-38", 
        "https://www.zhihu.com/people/roshanca", 
        "https://www.zhihu.com/people/ji-xu-shan-31", 
        "https://www.zhihu.com/people/yao-yao-56-13-29", 
        "https://www.zhihu.com/people/yi-wen-7-31", 
        "https://www.zhihu.com/people/cui-jiang-hong-54", 
        "https://www.zhihu.com/people/xin-yang-78-2", 
        "https://www.zhihu.com/people/evawa-wa-4", 
        "https://www.zhihu.com/people/wang-xiang-zhong-5", 
        "https://www.zhihu.com/people/zhu-zi-zhuan-shu", 
        "https://www.zhihu.com/people/xi-feng-wu-ding-14", 
        "https://www.zhihu.com/people/bug8bug", 
        "https://www.zhihu.com/people/cubesugarZhang", 
        "https://www.zhihu.com/people/csp1223", 
        "https://www.zhihu.com/people/promisezhang", 
        "https://www.zhihu.com/people/123456-36-71", 
        "https://www.zhihu.com/people/zhu-jiang-50-89", 
        "https://www.zhihu.com/people/CedricChan", 
        "https://www.zhihu.com/people/guo-fan-70", 
        "https://www.zhihu.com/people/chen-shi-meng-89", 
        "https://www.zhihu.com/people/fyh-47-23", 
        "https://www.zhihu.com/people/kk-kk-48-76", 
        "https://www.zhihu.com/people/mokiliy", 
        "https://www.zhihu.com/people/58fe", 
        "https://www.zhihu.com/people/chi-ruo-28", 
        "https://www.zhihu.com/people/leohxj", 
        "https://www.zhihu.com/people/alanzeng-69", 
        "https://www.zhihu.com/people/mo-yao-99", 
        "https://www.zhihu.com/people/wumingli", 
        "https://www.zhihu.com/people/ygnid", 
        "https://www.zhihu.com/people/liu-ji-16-2", 
        "https://www.zhihu.com/people/wo-you-bu-luan-lai-54-70", 
        "https://www.zhihu.com/people/wu-xin-ren-91", 
        "https://www.zhihu.com/people/gaozhongguoliu", 
        "https://www.zhihu.com/people/gou-dong-shan", 
        "https://www.zhihu.com/people/song-yang-17-25", 
        "https://www.zhihu.com/people/li-mu-41", 
        "https://www.zhihu.com/people/ping-ping-41-52", 
        "https://www.zhihu.com/people/deng-lei-87", 
        "https://www.zhihu.com/people/chen-guang-61-55", 
        "https://www.zhihu.com/people/mei-you-gu-shi-82-37", 
        "https://www.zhihu.com/people/zhang-qiang-24-82-46", 
        "https://www.zhihu.com/people/dou-dou-80-58-46", 
        "https://www.zhihu.com/people/qing-niao-93-12", 
        "https://www.zhihu.com/people/xu-yi-xin-98-59", 
        "https://www.zhihu.com/people/reed-84-49", 
        "https://www.zhihu.com/people/andy-34-46", 
        "https://www.zhihu.com/people/shi-kong-19-16", 
        "https://www.zhihu.com/people/interjc", 
        "https://www.zhihu.com/people/fuping", 
        "https://www.zhihu.com/people/stephen-34-51", 
        "https://www.zhihu.com/people/jiang-qi-zheng-18", 
        "https://www.zhihu.com/people/likelxl", 
        "https://www.zhihu.com/people/luo-sheng-men-14", 
        "https://www.zhihu.com/people/sophiehui-64", 
        "https://www.zhihu.com/people/dreamhuan", 
        "https://www.zhihu.com/people/xu-ming-ming-78-15", 
        "https://www.zhihu.com/people/raise-guo", 
        "https://www.zhihu.com/people/heyang-36", 
        "https://www.zhihu.com/people/li-xu-94-13", 
        "https://www.zhihu.com/people/xu-qiang-29-78", 
        "https://www.zhihu.com/people/bao-gong-li", 
        "https://www.zhihu.com/people/chen-yi-liang-64-71", 
        "https://www.zhihu.com/people/zhang-zhi-hao-61", 
        "https://www.zhihu.com/people/Zuckjet", 
        "https://www.zhihu.com/people/ping-ping-34-66-66", 
        "https://www.zhihu.com/people/jsupot", 
        "https://www.zhihu.com/people/liu-min-72-21", 
        "https://www.zhihu.com/people/xie-yong-heng-15", 
        "https://www.zhihu.com/people/mello-55", 
        "https://www.zhihu.com/people/alexzhanghc", 
        "https://www.zhihu.com/people/alandong2016", 
        "https://www.zhihu.com/people/zhou-shuai-chao", 
        "https://www.zhihu.com/people/su-ze-lei", 
        "https://www.zhihu.com/people/knowledge-seeking", 
        "https://www.zhihu.com/people/cheng-xun-ri", 
        "https://www.zhihu.com/people/jason-59-32-47-12", 
        "https://www.zhihu.com/people/cang-hai-sang-tian-75-62", 
        "https://www.zhihu.com/people/huang-hun-20", 
        "https://www.zhihu.com/people/yuan-dai-ma-96-13", 
        "https://www.zhihu.com/people/jorden-chang", 
        "https://www.zhihu.com/people/SecondaryMarquis", 
        "https://www.zhihu.com/people/zyg666", 
        "https://www.zhihu.com/people/xiao-ma-que-icknnnn", 
        "https://www.zhihu.com/people/lin-hao-48-12", 
        "https://www.zhihu.com/people/li-zi-an-72", 
        "https://www.zhihu.com/people/jello-chen", 
        "https://www.zhihu.com/people/leng-chu-li-81", 
        "https://www.zhihu.com/people/su-jin-30-42", 
        "https://www.zhihu.com/people/syrxw", 
        "https://www.zhihu.com/people/longfangsong", 
        "https://www.zhihu.com/people/feng-xiao-li", 
        "https://www.zhihu.com/people/yh-ding", 
        "https://www.zhihu.com/people/su-ge-30-5", 
        "https://www.zhihu.com/people/dementia-dang", 
        "https://www.zhihu.com/people/yang-chao-3247", 
        "https://www.zhihu.com/people/ptos", 
        "https://www.zhihu.com/people/yuyesoup", 
        "https://www.zhihu.com/people/JeffJing", 
        "https://www.zhihu.com/people/da-da-83-97", 
        "https://www.zhihu.com/people/jacky-47-49-69"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/88170668", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 0, 
            "title": "è¯»ã€ŠJavaScript è½»é‡çº§å‡½æ•°å¼ç¼–ç¨‹ã€‹", 
            "content": "<p></p><a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic3.zhimg.com/v2-4dad71953b4f3a5c60f78f9d15539666_180x120.jpg\" data-image-width=\"640\" data-image-height=\"512\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤œæ›‰å®¸</a><h2>è¯»åæ„Ÿ</h2><p>å¾ˆä¹…ä¹‹å‰ï¼Œç»„å†…åˆ†äº«è¿‡å‡½æ•°å¼ç¼–ç¨‹çš„ç›¸å…³å†…å®¹ï¼Œå¬å®Œä¹‹åçš„æ„Ÿå—å°±æ˜¯å’Œæ²¡å¬æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸­æœ‰è®¸å¤šæ¦‚å¿µï¼Œå¯¹äºç†Ÿæ‚‰å’Œè§æƒ¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„äººæ¥è¯´ï¼Œä¸€æ—¶åŠä¼šä¸èƒ½å¤Ÿæ¶ˆåŒ–ã€‚è€Œä¸”ï¼Œå°±è¿å€¼å’Œå¼•ç”¨ã€é—­åŒ…ç­‰æ¦‚å¿µéƒ½åˆ†ä¸æ¸…çš„äººï¼Œå¯¹JavaScript å‡½æ•°å¼ç¼–ç¨‹çš„å…¥é—¨æ›´æ˜¯å›°éš¾é‡é‡ã€‚<a href=\"https://link.zhihu.com/?target=https%3A//github.com/getify/Functional-Light-JS\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ã€ŠFunctional-Light JavaScriptã€‹</a>ï¼ˆä¸­æ–‡ç¿»è¯‘ç‰ˆ<a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E8%25AF%25BB%25E3%2580%258AJavaScript-%25E8%25BD%25BB%25E9%2587%258F%25E7%25BA%25A7%25E5%2587%25BD%25E6%2595%25B0%25E5%25BC%258F%25E7%25BC%2596%25E7%25A8%258B%25E3%2580%258B/%23more\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ã€ŠJavaScript è½»é‡çº§å‡½æ•°å¼ç¼–ç¨‹ã€‹</a>ï¼‰è‡ªç§°æ˜¯è½»é‡çº§çš„ï¼ŒæŠ›å¼€äº†æ¦‚å¿µçš„è®²è§£ï¼Œä»ä¸ºä»€ä¹ˆç”¨ï¼Œæ€ä¹ˆç”¨ï¼Œæœ€ç»ˆå‘ˆç°ä»€ä¹ˆç­‰å‡ ä¸ªæ–¹é¢å¸¦æˆ‘ä»¬é‡æ–°è®¤è¯†äº†å‡½æ•°è¿™ä¸ªåŸºç¡€ä¸”é‡è¦çš„æ¦‚å¿µã€‚</p><h2>ä¸ºä»€ä¹ˆå‡½æ•°å¼ç¼–ç¨‹</h2><p>å½“ä¸‹æœ‰ä¸‰ç§ç¼–ç¨‹èŒƒå¼ï¼Œç»“æ„åŒ–ç¼–ç¨‹ã€é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹ã€‚è™½ç„¶å‡½æ•°å¼ç¼–ç¨‹æ˜¯è¿‘äº›å¹´æ‰é‡‡ç”¨çš„ç¼–ç¨‹èŒƒå¼ï¼Œä½†æ˜¯å®ƒçš„å‘æ˜å´æ˜¯æœ€æ—©çš„ã€‚å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µæ˜¯åŸºäº ğ›Œ æ¼”ç®—çš„ç›´æ¥è¡ç”Ÿç‰©ï¼Œğ›Œ æ¼”ç®—æ³•çš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³æ˜¯ä¸å˜æ€§ã€‚æ•…ï¼Œç†è®ºä¸Šè®²ï¼Œåœ¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­åº”è¯¥ä¸å­˜åœ¨èµ‹å€¼è¯­å¥çš„ã€‚</p><p>å‡½æ•°å¼ç¼–ç¨‹çš„åŸåˆ™å¯ä»¥ä½¿å¾—æˆ‘ä»¬å†™å‡ºçš„ä»£ç æ˜¯å¯è¯»ã€å¯ä¿¡ä»»çš„ï¼Œä½†è¿™å¹¶ä¸ä»£è¡¨å®ƒæ˜¯å®¹æ˜“ç†è§£çš„ã€‚å£°æ˜å¼çš„é£æ ¼å¯ä»¥è®©æˆ‘ä»¬çŸ¥é“ç¨‹åºæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œä½†æ˜¯è¦å†™å‡ºè¿™æ ·çš„ç¨‹åºå´ä¸æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œèµ·ç å¯¹äºåˆšæ¥è§¦å‡½æ•°å¼ç¼–ç¨‹çš„äººæ¥è¯´ã€‚</p><p>åœ¨ç»´æŠ¤ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†æ—¶é—´æ˜¯ç”¨æ¥é˜…è¯»å’Œç†è§£ä»£ç ã€‚æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°å¿ƒç¿¼ç¿¼åœ°é˜…è¯»æ¯ä¸€è¡Œä»£ç ï¼Œç”Ÿæ€•æŸä¸€ä¸ªä¸ä¸ºäººçŸ¥çš„éªšæ“ä½œä¼šå¼•å‘äº†ä¸€äº›åˆ—çš„ bugï¼›æœ‰æ—¶å€™ä¹Ÿéœ€è¦åœ¨ä¸åŒå‡½æ•°è°ƒç”¨ä¸­äº†è§£ç¨‹åºçš„æ„å›¾ã€‚æ€»ä¹‹ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›åŸåˆ™å¯ä»¥è®©æˆ‘ä»¬å†™å‡ºå¯è¯»æ€§é«˜ã€å¯éªŒè¯çš„ä»£ç ã€‚å½“ç„¶ï¼Œå³ä¾¿æŒæ¡äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œä¹Ÿå¹¶ä¸æ„å‘³ç€ä½ ä¸€å®šå¾—ç”¨å®ƒã€‚</p><blockquote> æœ€å¥½çš„ä»£ç æ˜¯å¯è¯»æ€§é«˜çš„ä»£ç ï¼Œå› ä¸ºå®ƒåœ¨æ­£ç¡®çš„ï¼ˆç†æƒ³ä¸»ä¹‰ï¼‰å’Œå¿…ç„¶çš„ï¼ˆæ­£ç¡®çš„ï¼‰ä¹‹é—´å¯»æ±‚åˆ°äº†æ°åˆ°å¥½å¤„çš„å¹³è¡¡ã€‚</blockquote><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-ca6de801be90f4a205bab730d992814d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"611\" data-rawheight=\"376\" class=\"origin_image zh-lightbox-thumb\" width=\"611\" data-original=\"https://pic2.zhimg.com/v2-ca6de801be90f4a205bab730d992814d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;611&#39; height=&#39;376&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"611\" data-rawheight=\"376\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"611\" data-original=\"https://pic2.zhimg.com/v2-ca6de801be90f4a205bab730d992814d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-ca6de801be90f4a205bab730d992814d_b.jpg\"/></figure><h2>å‡½æ•°åŸºç¡€</h2><p>åœ¨æ•°å­¦ä¸­ï¼Œå‡½æ•°æ€»æ˜¯è·å–ä¸€äº›è¾“å…¥å€¼ï¼Œç„¶åè¿”å›ä¸€ä¸ªè¾“å‡ºå€¼ï¼Œè¾“å…¥å€¼å’Œè¾“å‡ºå€¼å­˜åœ¨æŸç§å…³ç³»çš„æ˜ å°„ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ä½¿ç”¨çš„å°±æ˜¯æ•°å­¦æ„ä¹‰ä¸Šçš„å‡½æ•°ï¼Œæ¥å—è¾“å…¥å€¼ï¼Œæ˜ç¡® <code>return</code> å€¼ã€‚</p><p>å‡½æ•°é€šå¸¸æ˜¯è¿™ä¸ªæ¨¡æ ·ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">foo</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"p\">,</span> <span class=\"nx\">z</span><span class=\"p\">){</span>\n    <span class=\"c1\">//  ...\n</span><span class=\"c1\"></span>    <span class=\"p\">}</span>\n<span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">length</span>  <span class=\"c1\">// 3\n</span><span class=\"c1\"></span><span class=\"nx\">foo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">);</span>\n</code></pre></div><p><code>foo.length</code> æ˜¯å‡½æ•°æœŸæœ›çš„å‚æ•°ä¸ªæ•°ï¼Œé€šå¸¸å°±æ˜¯å½¢åƒä¸ªæ•°ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸è¦æ±‚å®å‚å’Œå½¢åƒçš„ä¸ªæ•°ç›¸åŒï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥é€šè¿‡ <code>arguments</code> æŸ¥çœ‹æ‰€æœ‰å…¥åƒï¼ˆç®­å¤´å‡½æ•°æ— æ­¤å‚æ•°ï¼‰ã€‚</p><p>ä½¿ç”¨ ES6 ä¸­çš„è§£æ„å¯ä»¥è½»æ¾ç»™å˜é‡ç»‘å®šå…¥åƒçš„å€¼ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">foo</span><span class=\"p\">([</span><span class=\"nx\">x</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"p\">,</span> <span class=\"p\">...</span><span class=\"nx\">args</span><span class=\"p\">])</span> <span class=\"p\">{</span>\n    <span class=\"c1\">//  ...\n</span><span class=\"c1\"></span>    <span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">foo</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">params</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"nx\">params</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">args</span> <span class=\"o\">=</span> <span class=\"nx\">params</span><span class=\"p\">.</span><span class=\"nx\">slice</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n    <span class=\"c1\">//  ...\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n</code></pre></div><p>ç”±ä»¥ä¸Šå¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå£°æ˜å¼ä»£ç é€šå¸¸æ¯”å‘½ä»¤å¼ä»£ç æ›´å¹²å‡€ã€‚æ‰€ä»¥åªè¦æœ‰å¯èƒ½ï¼Œè¿˜æ˜¯å°½å¯èƒ½ä½¿ç”¨å£°æ˜å¼å’Œè‡ªè§£é‡Šçš„ä»£ç ã€‚</p><p>æœ‰æ—¶å€™å‡½æ•°ä¼šæ ¹æ®ä¸åŒçš„è¾“å…¥å€¼æ¥é‡è½½ä¸åŒçš„åŠŸèƒ½ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">foo</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">,</span><span class=\"nx\">y</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">x</span> <span class=\"o\">==</span> <span class=\"s2\">&#34;number&#34;</span> <span class=\"o\">&amp;&amp;</span> <span class=\"k\">typeof</span> <span class=\"nx\">y</span> <span class=\"o\">==</span> <span class=\"s2\">&#34;number&#34;</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"nx\">x</span> <span class=\"o\">*</span> <span class=\"nx\">y</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">else</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"nx\">x</span> <span class=\"o\">+</span> <span class=\"nx\">y</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>è¿™ç§è®¾è®¡è™½ç„¶æš‚æ—¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¯¹ä»¥åçš„åŠŸèƒ½æ·»åŠ æˆ–ä¿®æ”¹ä¼šå¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ã€‚</p><p>åœ¨ä¸Šé¢å·²ç»æåˆ°å‡½æ•°è¦æœ‰æ˜ç¡®çš„ <code>return</code> å€¼ï¼Œå¦‚æœå‡½æ•°å†…éƒ¨æ”¹å˜äº†å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡æˆ–å¼•ç”¨ç±»å‹çš„å…¥åƒï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æœ‰äº†å‰¯ä½œç”¨çš„ï¼Œå¯¹è¯¥å‡½æ•°å¤–çš„ç¯å¢ƒé€ æˆäº†æ±¡æŸ“ã€‚æˆ‘ä»¬å¸Œæœ›å‡½æ•°æ˜¯ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå³çº¯å‡½æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">sum</span><span class=\"p\">(</span><span class=\"nx\">list</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">])</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n\n        <span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"nx\">total</span> <span class=\"o\">+</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"k\">return</span> <span class=\"nx\">total</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">nums</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">27</span><span class=\"p\">,</span> <span class=\"p\">,</span> <span class=\"mi\">84</span> <span class=\"p\">];</span>\n\n<span class=\"nx\">sum</span><span class=\"p\">(</span> <span class=\"nx\">nums</span> <span class=\"p\">);</span>            <span class=\"c1\">// 124\n</span></code></pre></div><p>å‡½æ•°å¯ä»¥æ¥å—å¹¶è¿”å›ä»»ä½•ç±»å‹çš„å€¼ï¼Œå½“è¿™ç§ç±»å‹çš„å€¼æ°å¥½æ˜¯å‡½æ•°æ—¶ï¼Œå®ƒå°±å«é«˜é˜¶å‡½æ•°ã€‚è€ŒçœŸæ­£é«˜é˜¶çš„ç”¨æ³•ï¼Œå°±æ˜¯é—­åŒ…ï¼Œå®ƒå¯ä»¥è®°å½•å¹¶ä¸”è®¿é—®ä½œç”¨äºå¤–çš„å˜é‡ï¼Œç”šè‡³è¯¥å‡½æ•°åœ¨ä¸åŒä½œç”¨åŸŸä¸­è¢«æ‰§è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">runningCounter</span><span class=\"p\">(</span><span class=\"nx\">start</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">val</span> <span class=\"o\">=</span> <span class=\"nx\">start</span><span class=\"p\">;</span>\n\n    <span class=\"k\">return</span> <span class=\"kd\">function</span> <span class=\"nx\">current</span><span class=\"p\">(</span><span class=\"nx\">increment</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">){</span>\n        <span class=\"nx\">val</span> <span class=\"o\">=</span> <span class=\"nx\">val</span> <span class=\"o\">+</span> <span class=\"nx\">increment</span><span class=\"p\">;</span>\n        <span class=\"k\">return</span> <span class=\"nx\">val</span><span class=\"p\">;</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">score</span> <span class=\"o\">=</span> <span class=\"nx\">runningCounter</span><span class=\"p\">(</span> <span class=\"mi\">0</span> <span class=\"p\">);</span>\n\n<span class=\"nx\">score</span><span class=\"p\">();</span>                <span class=\"c1\">// 1\n</span><span class=\"c1\"></span><span class=\"nx\">score</span><span class=\"p\">();</span>                <span class=\"c1\">// 2\n</span><span class=\"c1\"></span><span class=\"nx\">score</span><span class=\"p\">(</span> <span class=\"mi\">13</span> <span class=\"p\">);</span>            <span class=\"c1\">// 15\n</span></code></pre></div><p>é—­åŒ…ä¸­ä¿å­˜çš„å˜é‡å¹¶ä¸ä¼šåœ¨å‡½æ•°æ‰§è¡Œåè‡ªåŠ¨é”€æ¯ï¼Œåªè¦å†…éƒ¨å‡½æ•°ä¾ç„¶å­˜åœ¨å¯¹å˜é‡çš„å¼•ç”¨ï¼Œå˜é‡å°±ä¼šä¸€ç›´ä¿ç•™ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œé—­åŒ…æ˜¯æœ€é‡è¦çš„åŸºç¡€ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ¦‚å¿µä¸€å®šè¦ç†è§£ã€‚</p><p>è¿˜æœ‰çš„å‡½æ•°æ˜¯æ²¡æœ‰åå­—çš„ï¼Œè¿™ç§å‡½æ•°ç§°ä¹‹ä¸ºåŒ¿åå‡½æ•°ï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯ç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(){</span>\n\n    <span class=\"c1\">// æˆ‘æ˜¯ IIFE!\n</span><span class=\"c1\"></span>\n<span class=\"p\">})();</span>\n</code></pre></div><p>å‘½åå‡½æ•°çš„å¥½å¤„æœ‰å¾ˆå¤šï¼Œå¯ä»¥åœ¨å †æ ˆä¸­æ–¹ä¾¿è°ƒè¯•ï¼Œå¯ä»¥é€šè¿‡åå­—å¼•ç”¨è‡ªèº«ç­‰ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‡½æ•°éƒ½å¯ä»¥å‘½åçš„ï¼Œç®­å¤´å‡½æ•°å¯ä»¥è¯´æ˜¯ååˆ†ç®€æ´ï¼Œå¯ä»¥ä½¿ç”¨æœ€ç®€å•çš„ç¬¦å·æ¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">people</span><span class=\"p\">.</span><span class=\"nx\">map</span><span class=\"p\">(</span> <span class=\"nx\">person</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">person</span><span class=\"p\">.</span><span class=\"nx\">nicknames</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">||</span> <span class=\"nx\">person</span><span class=\"p\">.</span><span class=\"nx\">firstName</span> <span class=\"p\">);</span>\n</code></pre></div><p>ç®­å¤´å‡½æ•°é™¤äº†å†™æ³•ç®€æ´ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯ä»¥ç§°ä¹‹ä¸ºå¥½å¤„çš„ä¾¿æ˜¯ <code>this</code>ã€‚ç®­å¤´å‡½æ•°ä¸­çš„ <code>this</code> æ˜¯åŸºäºä½œç”¨åŸŸçš„ï¼Œæ˜¯å¯ä»¥é¢„æµ‹çš„ã€‚è€Œå¯¹äºæ™®é€šå‡½æ•°ï¼Œ<code>this</code> æ˜¯åŠ¨æ€ç»‘å®šçš„ï¼Œæ˜¯åŸºäºè°ƒç”¨è€…çš„ã€‚ä¸ç®¡æ˜¯å“ªä¸€ç§ <code>this</code>ï¼Œ æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›èƒ½å¤Ÿæ˜¾å¼åœ°è¡¨ç¤ºä¸Šä¸‹æ–‡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">sum</span><span class=\"p\">(</span><span class=\"nx\">ctx</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">ctx</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">+</span> <span class=\"nx\">ctx</span><span class=\"p\">.</span><span class=\"nx\">y</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n    <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mi\">2</span>\n<span class=\"p\">};</span>\n\n<span class=\"nx\">sum</span><span class=\"p\">(</span> <span class=\"nx\">context</span> <span class=\"p\">);</span>\n</code></pre></div><h2>å‡½æ•°çš„è¾“å…¥</h2><p>åœ¨ç¨‹åºä¸­å¾€å¾€å°†ä¸å˜çš„å°è£…èµ·æ¥ï¼Œå˜åŒ–çš„éš”ç¦»å¼€æ¥ã€‚å¾ˆå¤šæ—¶å€™ä¸å˜çš„åŒ…æ‹¬ä¸€äº›é¢„è®¾çš„å‚æ•°ã€‚</p><p>é¦–å…ˆå°è£…ä¸€ä¸ªè¯·æ±‚å‡½æ•°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ­¥éª¤ä¸€ï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">ajax</span><span class=\"p\">(</span><span class=\"nx\">url</span><span class=\"p\">,</span><span class=\"nx\">data</span><span class=\"p\">,</span><span class=\"nx\">callback</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// ..\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n</code></pre></div><p>å¯¹äºä¸åŒçš„è¯·æ±‚ï¼Œæœ‰ä¸åŒçš„ url æˆ–å‚æ•°ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ­¥éª¤äºŒï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">getPerson</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">,</span><span class=\"nx\">cb</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">ajax</span><span class=\"p\">(</span> <span class=\"s2\">&#34;http://some.api/person&#34;</span><span class=\"p\">,</span> <span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"nx\">cb</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">getOrder</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">,</span><span class=\"nx\">cb</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">ajax</span><span class=\"p\">(</span> <span class=\"s2\">&#34;http://some.api/order&#34;</span><span class=\"p\">,</span> <span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"nx\">cb</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>url å°±æ˜¯é¢„è®¾çš„å‚æ•°ï¼Œè€Œå‰©ä½™çš„å‚æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ä¼ å…¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ­¥éª¤ä¸‰ï¼š\n</span><span class=\"c1\"></span><span class=\"nx\">getPerson</span><span class=\"p\">(</span> <span class=\"p\">{</span> <span class=\"nx\">user</span><span class=\"o\">:</span> <span class=\"nx\">CURRENT_USER_ID</span> <span class=\"p\">},</span> <span class=\"nx\">cb</span> <span class=\"p\">);</span>\n</code></pre></div><p>ä»”ç»†è§‚å¯Ÿæ­¥éª¤äºŒï¼Œä»£ç ä¼¼ä¹è¿˜å¯ä»¥æç‚¼ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ­¥éª¤äºŒï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">partial</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">fn</span><span class=\"p\">,</span> <span class=\"p\">...</span><span class=\"nx\">presetArgs</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n                <span class=\"p\">(...</span><span class=\"nx\">laterArgs</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> \n                    <span class=\"nx\">fn</span><span class=\"p\">(...</span><span class=\"nx\">presetArgs</span><span class=\"p\">,</span> <span class=\"p\">...</span><span class=\"nx\">laterArgs</span><span class=\"p\">);</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">getPerson</span> <span class=\"o\">=</span> <span class=\"nx\">partial</span><span class=\"p\">(</span><span class=\"nx\">ajax</span><span class=\"p\">,</span> <span class=\"s2\">&#34;http://some.api/person&#34;</span><span class=\"p\">);</span>\n<span class=\"kd\">var</span> <span class=\"nx\">getOrder</span> <span class=\"o\">=</span> <span class=\"nx\">partial</span><span class=\"p\">(</span><span class=\"nx\">ajax</span><span class=\"p\">,</span> <span class=\"s2\">&#34;http://some.api/order&#34;</span><span class=\"p\">);</span>\n</code></pre></div><p>æ­¥éª¤äºŒçš„è½¬æ¢å°±æ˜¯åå‡½æ•°çš„åº”ç”¨ï¼Œå®ƒæ˜¯é€šè¿‡é¢„è®¾å‚æ•°çš„æ–¹å¼æ¥å‡å°‘å…¥åƒçš„æ•°é‡ã€‚å¦‚æœé¢ å€’å…¥åƒçš„é¡ºåºï¼Œå°±æˆäº†å³åå‡½æ•°ã€‚</p><p>åŒæ ·æ˜¯å¯¹å‡½æ•°è¾“å…¥ç®¡ç†çš„æŠ€æœ¯ï¼Œå³æŸ¯é‡ŒåŒ–ï¼Œè¯¥æŠ€æœ¯å°†ä¸€ä¸ªæ¥å—å¤šä¸ªå®å‚çš„å‡½æ•°æ‹†è§£æˆè¿ç»­çš„é“¾å¼å‡½æ•°ï¼Œæ¯ä¸ªé“¾å¼å‡½æ•°æ¥å—å•ä¸€å®å‚å¹¶è¿”å›æ¥å—ä¸‹ä¸€ä¸ªå®å‚çš„å‡½æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">sum</span><span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">sum</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">args</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">sum</span> <span class=\"o\">+=</span> <span class=\"nx\">args</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">sum</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">sum</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span> <span class=\"p\">);</span> \n\n<span class=\"c1\">// æŸ¯é‡ŒåŒ–\n</span><span class=\"c1\"></span>\n<span class=\"kd\">var</span> <span class=\"nx\">curry</span> <span class=\"o\">=</span>\n    <span class=\"p\">(</span><span class=\"nx\">fn</span><span class=\"p\">,</span> <span class=\"nx\">arity</span> <span class=\"o\">=</span> <span class=\"nx\">fn</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">,</span> <span class=\"nx\">nextCurried</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n        <span class=\"p\">(</span><span class=\"nx\">nextCurried</span> <span class=\"o\">=</span> <span class=\"nx\">prevArgs</span> <span class=\"p\">=&gt;</span>\n            <span class=\"nx\">nextArg</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n                <span class=\"kd\">var</span> <span class=\"nx\">args</span> <span class=\"o\">=</span> <span class=\"nx\">prevArgs</span><span class=\"p\">.</span><span class=\"nx\">concat</span><span class=\"p\">(</span> <span class=\"p\">[</span><span class=\"nx\">nextArg</span><span class=\"p\">]</span> <span class=\"p\">);</span>\n                <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">args</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">&gt;=</span> <span class=\"nx\">arity</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n                    <span class=\"k\">return</span> <span class=\"nx\">fn</span><span class=\"p\">(</span> <span class=\"p\">...</span><span class=\"nx\">args</span> <span class=\"p\">);</span>\n                <span class=\"p\">}</span>\n                <span class=\"k\">else</span> <span class=\"p\">{</span>\n                    <span class=\"k\">return</span> <span class=\"nx\">nextCurried</span><span class=\"p\">(</span> <span class=\"nx\">args</span> <span class=\"p\">);</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">)(</span> <span class=\"p\">[]</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// (5 ç”¨æ¥æŒ‡å®šéœ€è¦é“¾å¼è°ƒç”¨çš„æ¬¡æ•°)\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">curriedSum</span> <span class=\"o\">=</span> <span class=\"nx\">curry</span><span class=\"p\">(</span> <span class=\"nx\">sum</span><span class=\"p\">,</span> <span class=\"mi\">5</span> <span class=\"p\">);</span>\n<span class=\"nx\">curriedSum</span><span class=\"p\">(</span> <span class=\"mi\">1</span> <span class=\"p\">)(</span> <span class=\"mi\">2</span> <span class=\"p\">)(</span> <span class=\"mi\">3</span> <span class=\"p\">)(</span> <span class=\"mi\">4</span> <span class=\"p\">)(</span> <span class=\"mi\">5</span> <span class=\"p\">);</span>\n</code></pre></div><p>ä»ä»¥ä¸Šçš„ä»£ç å¯ä»¥å‘ç°ï¼Œæ— è®ºæ˜¯åå‡½æ•°è¿˜æ˜¯æŸ¯é‡ŒåŒ–ï¼Œéƒ½æ˜¯æ”¶é½æ‰€æœ‰çš„å®å‚åæ‰æ‰§è¡ŒåŸå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡å¿…è¦ä¸€æ¬¡æ€§ä¼ å…¥æ‰€æœ‰çš„å‚æ•°ï¼Œè€Œä¸”æŸ¯é‡ŒåŒ–è¿™ç§åªæ¥å—å•ä¸€å‚æ•°çš„ç‰¹æ€§åœ¨åé¢çš„ç»„åˆå‡½æ•°ä¸­ä¹Ÿèµ·ç€å¾ˆé‡è¦çš„ä½œç”¨ã€‚</p><p>å‡½æ•°å¼ç¼–ç¨‹å¯ä»¥è¯´åœ¨å‚æ•°ä¸Šä¸‹äº†å¾ˆå¤§çš„åŠŸå¤«ï¼Œç”šè‡³è¿˜æœ‰ç§ç§°ä¹‹ä¸ºæ— å½¢åƒçš„é£æ ¼ï¼Œå…¶ç›®çš„å°±æ˜¯ç§»é™¤éå¿…è¦çš„å½¢åƒåˆ°å®å‚ä¹‹é—´çš„æ˜ å°„ã€‚æ— å½¢åƒé£æ ¼æ˜¯å¦æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œæœ‰æ²¡æœ‰å¿…è¦ä½¿ç”¨æ— å½¢åƒé£æ ¼ï¼Œè¿˜éœ€è¦ä½ è‡ªå·±å»å®šå¤ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"kr\">double</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">x</span> <span class=\"o\">*</span> <span class=\"mi\">2</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">].</span><span class=\"nx\">map</span><span class=\"p\">(</span> <span class=\"kd\">function</span> <span class=\"nx\">mapper</span><span class=\"p\">(</span><span class=\"nx\">v</span><span class=\"p\">){</span>\n    <span class=\"k\">return</span> <span class=\"kr\">double</span><span class=\"p\">(</span> <span class=\"nx\">v</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// æ— å½¢åƒé£æ ¼ï¼›\n</span><span class=\"c1\"></span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">].</span><span class=\"nx\">map</span><span class=\"p\">(</span> <span class=\"kr\">double</span> <span class=\"p\">);</span>\n</code></pre></div><h2>ç»„åˆå‡½æ•°</h2><p>å‡½æ•°ç»„åˆï¼Œå°±æ˜¯æŠŠä¸Šä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºå€¼ä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥å€¼ï¼Œå¹¶ä»¥æ­¤æŒç»­ä¸‹å»ã€‚</p><p>çœ‹ä¸ªä¾‹å­ï¼Œå°†ä¸€å¥è¯æ‹†åˆ†ä¸ºå•è¯æ•°ç»„ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// è½¬å°å†™ï¼Œè¿‡è™‘å‡ºå•è¯ï¼›\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">words</span><span class=\"p\">(</span><span class=\"nx\">str</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nb\">String</span><span class=\"p\">(</span> <span class=\"nx\">str</span> <span class=\"p\">)</span>\n        <span class=\"p\">.</span><span class=\"nx\">toLowerCase</span><span class=\"p\">()</span>\n        <span class=\"p\">.</span><span class=\"nx\">split</span><span class=\"p\">(</span> <span class=\"sr\">/\\s|\\b/</span> <span class=\"p\">)</span>\n        <span class=\"p\">.</span><span class=\"nx\">filter</span><span class=\"p\">(</span> <span class=\"kd\">function</span> <span class=\"nx\">alpha</span><span class=\"p\">(</span><span class=\"nx\">v</span><span class=\"p\">){</span>\n            <span class=\"k\">return</span> <span class=\"sr\">/^[\\w]+$/</span><span class=\"p\">.</span><span class=\"nx\">test</span><span class=\"p\">(</span> <span class=\"nx\">v</span> <span class=\"p\">);</span>\n        <span class=\"p\">}</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// å»é‡ï¼›\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">unique</span><span class=\"p\">(</span><span class=\"nx\">list</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">uniqList</span> <span class=\"o\">=</span> <span class=\"p\">[];</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"c1\">// value not yet in the new list?\n</span><span class=\"c1\"></span>        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">uniqList</span><span class=\"p\">.</span><span class=\"nx\">indexOf</span><span class=\"p\">(</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"p\">)</span> <span class=\"o\">===</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"nx\">uniqList</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"p\">);</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"k\">return</span> <span class=\"nx\">uniqList</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"kd\">var</span> <span class=\"nx\">text</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;To compose two functions together, pass the \\\n</span><span class=\"s2\">output of the first function call as the input of the \\\n</span><span class=\"s2\">second function call.&#34;</span><span class=\"p\">;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">uniqueWords</span><span class=\"p\">(</span><span class=\"nx\">str</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">unique</span><span class=\"p\">(</span> <span class=\"nx\">words</span><span class=\"p\">(</span> <span class=\"nx\">str</span> <span class=\"p\">)</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">wordsUsed</span> <span class=\"o\">=</span> <span class=\"nx\">uniqueWords</span><span class=\"p\">(</span><span class=\"nx\">text</span><span class=\"p\">);</span>\n<span class=\"c1\">// [&#34;to&#34;,&#34;compose&#34;,&#34;two&#34;,&#34;functions&#34;,&#34;together&#34;,&#34;pass&#34;,\n</span><span class=\"c1\">// &#34;the&#34;,&#34;output&#34;,&#34;of&#34;,&#34;first&#34;,&#34;function&#34;,&#34;call&#34;,&#34;as&#34;,\n</span><span class=\"c1\">// &#34;input&#34;,&#34;second&#34;]\n</span></code></pre></div><p>æ•°æ®çš„æµå‘ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">wordsUsed</span> <span class=\"o\">&lt;--</span> <span class=\"nx\">unique</span> <span class=\"o\">&lt;--</span> <span class=\"nx\">words</span> <span class=\"o\">&lt;--</span> <span class=\"nx\">text</span>\n</code></pre></div><p>ä½†æ˜¯å‡½æ•°å¼ç¼–ç¨‹å–œæ¬¢å£°æ˜å¼é£æ ¼ï¼Œå…³æ³¨ç‚¹åœ¨æ˜¯ä»€ä¹ˆè€Œä¸æ˜¯æ€ä¹ˆåšï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚æˆ‘ä»¬å¸Œæœ›æ˜¯è¿™æ ·çš„ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å‘½ä»¤å¼\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">shorterWords</span><span class=\"p\">(</span><span class=\"nx\">text</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">skipLongWords</span><span class=\"p\">(</span> <span class=\"nx\">unique</span><span class=\"p\">(</span> <span class=\"nx\">words</span><span class=\"p\">(</span> <span class=\"nx\">text</span> <span class=\"p\">)</span> <span class=\"p\">)</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// å£°æ˜å¼\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">shorterWords</span> <span class=\"o\">=</span> <span class=\"nx\">compose</span><span class=\"p\">(</span> <span class=\"nx\">skipLongWords</span><span class=\"p\">,</span> <span class=\"nx\">unique</span><span class=\"p\">,</span> <span class=\"nx\">words</span> <span class=\"p\">);</span>\n</code></pre></div><p>å¦‚ä½•å®ç°å‡½æ•° <code>compose</code> ï¼Ÿ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å†™æ³•ä¸€ï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">compose</span> <span class=\"o\">=</span>\n    <span class=\"p\">(...</span><span class=\"nx\">fns</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n        <span class=\"nx\">result</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n            <span class=\"kd\">var</span> <span class=\"nx\">list</span> <span class=\"o\">=</span> <span class=\"nx\">fns</span><span class=\"p\">.</span><span class=\"nx\">slice</span><span class=\"p\">();</span>\n\n            <span class=\"k\">while</span> <span class=\"p\">(</span><span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n                <span class=\"c1\">// å°†æœ€åä¸€ä¸ªå‡½æ•°ä»åˆ—è¡¨å°¾éƒ¨æ‹¿å‡º\n</span><span class=\"c1\"></span>                <span class=\"c1\">// å¹¶æ‰§è¡Œå®ƒ\n</span><span class=\"c1\"></span>                <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">pop</span><span class=\"p\">()(</span> <span class=\"nx\">result</span> <span class=\"p\">);</span>\n            <span class=\"p\">}</span>\n\n            <span class=\"k\">return</span> <span class=\"nx\">result</span><span class=\"p\">;</span>\n        <span class=\"p\">};</span>\n\n<span class=\"c1\">// å†™æ³•äºŒï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">compose</span> <span class=\"o\">=</span>\n    <span class=\"p\">(...</span><span class=\"nx\">fns</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n        <span class=\"nx\">fns</span><span class=\"p\">.</span><span class=\"nx\">reverse</span><span class=\"p\">().</span><span class=\"nx\">reduce</span><span class=\"p\">(</span> <span class=\"p\">(</span><span class=\"nx\">fn1</span><span class=\"p\">,</span><span class=\"nx\">fn2</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n            <span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n                <span class=\"nx\">fn2</span><span class=\"p\">(</span> <span class=\"nx\">fn1</span><span class=\"p\">(</span> <span class=\"p\">...</span><span class=\"nx\">args</span> <span class=\"p\">)</span> <span class=\"p\">)</span>\n        <span class=\"p\">);</span>\n\n<span class=\"c1\">// å†™æ³•ä¸‰ï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">compose</span> <span class=\"o\">=</span>\n    <span class=\"p\">(...</span><span class=\"nx\">fns</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"c1\">// æ‹¿å‡ºæœ€åä¸¤ä¸ªå‚æ•°\n</span><span class=\"c1\"></span>        <span class=\"kd\">var</span> <span class=\"p\">[</span> <span class=\"nx\">fn1</span><span class=\"p\">,</span> <span class=\"nx\">fn2</span><span class=\"p\">,</span> <span class=\"p\">...</span><span class=\"nx\">rest</span> <span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">fns</span><span class=\"p\">.</span><span class=\"nx\">reverse</span><span class=\"p\">();</span>\n\n        <span class=\"kd\">var</span> <span class=\"nx\">composedFn</span> <span class=\"o\">=</span>\n            <span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span>\n                <span class=\"nx\">fn2</span><span class=\"p\">(</span> <span class=\"nx\">fn1</span><span class=\"p\">(</span> <span class=\"p\">...</span><span class=\"nx\">args</span> <span class=\"p\">)</span> <span class=\"p\">);</span>\n\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">rest</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">composedFn</span><span class=\"p\">;</span>\n\n        <span class=\"k\">return</span> <span class=\"nx\">compose</span><span class=\"p\">(</span> <span class=\"p\">...</span><span class=\"nx\">rest</span><span class=\"p\">.</span><span class=\"nx\">reverse</span><span class=\"p\">(),</span> <span class=\"nx\">composedFn</span> <span class=\"p\">);</span>\n    <span class=\"p\">};</span>\n</code></pre></div><h2>å‰¯ä½œç”¨å’Œå€¼çš„ä¸å¯å˜æ€§</h2><p><code>const</code> æ˜¯ç”¨æ¥å£°æ˜ä¸€ä¸ªå¸¸é‡çš„ï¼Œè€Œå¸¸é‡å°±æ˜¯ä¸å…è®¸è¢«é‡æ–°èµ‹å€¼çš„å˜é‡ã€‚åœ¨æ’æŸ¥é—®é¢˜çš„æ—¶ï¼Œæˆ‘ä»¬å¾ˆå°‘å°†æ³¨æ„åŠ›æ”¾åœ¨ç”± const å£°æ˜çš„å˜é‡ä¸Šï¼Œæ¯•ç«Ÿå®ƒå°±æ˜¯ä¸€ä¸ªæ— å…³ç—›ç—’çš„å¸¸é‡ã€‚å¦‚æœæœ€ç»ˆå°±æ˜¯å› ä¸ºè¿™ä¸ªå¸¸é‡å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šä¸ä¼šå¾ˆåˆºæ¿€ï¼Ÿï¼è™½ç„¶ const å£°æ˜çš„æ˜¯å¸¸é‡ï¼Œä½†æ˜¯å¯¹äºå¼•ç”¨ç±»å‹çš„å€¼ï¼Œç¨‹åºè¿˜æ˜¯å…è®¸å®ƒæ”¹å˜çš„ã€‚å› ä¸º const çš„ä¸é è°±ï¼Œæˆ‘ä»¬ä¸å¾—ä¸é‡æ–°å…³æ³¨ç”±å®ƒå£°æ˜çš„å¸¸é‡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"mi\">2</span> <span class=\"p\">];</span>\n<span class=\"nx\">x</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">3</span><span class=\"p\">;</span>\n</code></pre></div><p>æ•°æ®çš„çªå˜å¼•å‘äº†ä¸€ç³»åˆ—æ„æƒ³ä¸åˆ°çš„ bugï¼Œç©¶å…¶åŸå› ï¼Œæ˜¯å˜é‡è¢«å…±äº«æˆ–æœ‰ç€ä¸åŒçš„ç”¨å¤„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">var</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n\n<span class=\"nx\">foo</span><span class=\"p\">();</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span> <span class=\"nx\">x</span> <span class=\"p\">);</span>\n\n<span class=\"nx\">bar</span><span class=\"p\">();</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span> <span class=\"nx\">x</span> <span class=\"p\">);</span>\n\n<span class=\"nx\">baz</span><span class=\"p\">();</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span> <span class=\"nx\">x</span> <span class=\"p\">);</span>\n</code></pre></div><p>å½“å˜é‡è¢«å…±äº«æ—¶ï¼ˆåœ¨å‡½æ•° <code>foo()</code>ã€<code>bar()</code>ã€<code>baz()</code> ä¸­ï¼Œä»»ä½•ä¸€ä¸ªå‡½æ•°éƒ½æœ‰å¯èƒ½æ”¹å˜å˜é‡ xï¼‰ï¼Œæœ€ç»ˆæˆ‘ä»¬æ— æ³•ç¡®è®¤ x åˆ°åº•æ˜¯ä»€ä¹ˆå€¼ï¼Œä¸ºäº†è¿½è¸ªå˜é‡ x çš„å˜åŒ–ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä»”ç»†é€ä¸ªé˜…è¯»å‡½æ•° <code>foo()</code>ã€<code>bar()</code>ã€<code>baz()</code>ã€‚æ˜¾è€Œæ˜“è§ï¼Œè¿™ç»™æˆ‘ä»¬é˜…è¯»ç†è§£ä»£ç å¸¦æ¥äº†å¾ˆå¤§çš„éº»çƒ¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">sum</span><span class=\"p\">(</span><span class=\"nx\">list</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">])</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n\n        <span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"nx\">total</span> <span class=\"o\">+</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"k\">return</span> <span class=\"nx\">total</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">nums</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">27</span><span class=\"p\">,</span> <span class=\"p\">,</span> <span class=\"mi\">84</span> <span class=\"p\">];</span>\n\n<span class=\"nx\">sum</span><span class=\"p\">(</span> <span class=\"nx\">nums</span> <span class=\"p\">);</span>            <span class=\"c1\">// 124\n</span><span class=\"c1\"></span>\n<span class=\"nx\">sums</span><span class=\"p\">;</span>    <span class=\"c1\">//[1, 3, 9, 27, 0, 84]\n</span></code></pre></div><p>è€Œå¯¹äºå¼•ç”¨åŒä¸€å¯¹è±¡çš„ä¸åŒå˜é‡ï¼Œå¯¹è±¡çš„æ”¹å˜ä¹Ÿæ˜¯åŒæ­¥çš„ï¼Œè¿™ç§æ”¹å˜å¾€å¾€æ˜¯ä¸æ˜“å¯Ÿè§‰çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºå¼•ç”¨ç±»å‹çš„ç‰¹æ®Šæ€§ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„ã€‚</p><p>å½’çº³ä¸€ä¸‹ï¼Œä»€ä¹ˆæ ·çš„å˜é‡è¢«å…±äº«æ—¶éœ€è¦é¢å¤–ä¸Šå¿ƒçš„ï¼Œå¤–å±‚ä½œç”¨åŸŸé‡Œçš„å˜é‡å’Œå¼•ç”¨ç±»å‹çš„å˜é‡ã€‚</p><p>å¦‚ä½•é¿å…è¿™ç§æ•°æ®çªå˜å¸¦æ¥çš„çŠ¶æ€ç´Šä¹±çš„ï¼Ÿå¯ä»¥æƒ³åˆ°çš„æ˜¯å°†å˜é‡å˜æˆåªè¯»çš„æˆ–é‡æ–°æ‹·è´ä¸€ä»½ä»¥ä½œåŒºåˆ«ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">var</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">freeze</span><span class=\"p\">(</span> <span class=\"p\">[</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">]</span> <span class=\"p\">]</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// ä¸å…è®¸æ”¹å˜ï¼š\n</span><span class=\"c1\"></span><span class=\"nx\">x</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">42</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// oopsï¼Œä»ç„¶å…è®¸æ”¹å˜ï¼š\n</span><span class=\"c1\"></span><span class=\"nx\">x</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">42</span><span class=\"p\">;</span>\n</code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Object.freeze</code> ç­‰ API å°†æ•°æ®è½¬ä¸ºä¸å¯å˜ï¼Œä½†æ˜¯è¿™ç§ API çš„è¿˜æ˜¯æœ‰å±€é™æ€§çš„ï¼Œåªèƒ½æµ…å±‚é™åˆ¶ä¸å¯å˜ã€‚è¦æƒ³ä½¿å¾—ä¸€ä¸ªæ·±å±‚åµŒå¥—çš„å¯¹è±¡ä¸å¯å˜ï¼Œå°±éœ€è¦æ·±åº¦éå†å¯¹æ¯ä¸ªå±æ€§ä½¿ç”¨ <code>Object.freeze</code> ç­‰ APIã€‚</p><p>å¦ä¸€ç§æ€è·¯å°±æ˜¯æ‹·è´ä¸€ä»½æ•°æ®ï¼Œè¿™æ ·çš„è¯ï¼Œå†æ€ä¹ˆæŠ˜è…¾å‰¯æœ¬éƒ½ä¸ä¼šå½±å“åˆ°æºæ•°æ®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">addValue</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">newArr</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"p\">...</span><span class=\"nx\">arr</span><span class=\"p\">,</span> <span class=\"mi\">4</span> <span class=\"p\">];</span>\n    <span class=\"k\">return</span> <span class=\"nx\">newArr</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">addValue</span><span class=\"p\">(</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">]</span> <span class=\"p\">);</span>    <span class=\"c1\">// [1,2,3,4]\n</span></code></pre></div><p>åœ¨æ­¤ï¼Œæˆ‘ä»¬ä¸ç”±åœ°æƒ³èµ·å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒ â€”â€” ä¸å˜æ€§ã€‚æˆ‘ä»¬çœ‹åˆ°äº†å˜åŒ–çš„æ•°æ®ç»™ç¨‹åºé€ æˆçš„å¯è¯»æ€§å·®ã€çŠ¶æ€ç´Šä¹±ç­‰åå¤„ï¼Œè‡ªç„¶æˆ‘ä»¬å°±æƒ³åˆ°æ•°æ®ä¸å˜æ€§ä¼šè®©ç¨‹åºæ›´åŠ å‹å¥½ã€‚ä½†å€¼çš„ä¸å˜æ€§å¹¶ä¸æ„å‘³ç€å€¼ä»£è¡¨çš„çŠ¶æ€ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥å°±æœ‰äº†å€¼çš„æ‹·è´ã€‚è¿™ç§ä¸å˜æ€§æ˜¯æŒ‡ï¼Œå½“éœ€è¦æ”¹å˜ç¨‹åºä¸­æŸä¸ªçŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½æ”¹å˜æºæ•°æ®ï¼Œè€Œæ˜¯æ‹·è´è·Ÿè¸ªå®ƒçš„å‰¯æœ¬ã€‚æ‹·è´ä¹Ÿæœ‰æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç‹¬ç«‹äºæºæ•°æ®çš„å‰¯æœ¬ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">updateLastLogin</span><span class=\"p\">(</span><span class=\"nx\">user</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">newUserRecord</span> <span class=\"o\">=</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">assign</span><span class=\"p\">(</span> <span class=\"p\">{},</span> <span class=\"nx\">user</span> <span class=\"p\">);</span>\n    <span class=\"nx\">newUserRecord</span><span class=\"p\">.</span><span class=\"nx\">lastLogin</span> <span class=\"o\">=</span> <span class=\"nb\">Date</span><span class=\"p\">.</span><span class=\"nx\">now</span><span class=\"p\">();</span>\n    <span class=\"k\">return</span> <span class=\"nx\">newUserRecord</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">user</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// ..\n</span><span class=\"c1\"></span><span class=\"p\">};</span>\n\n<span class=\"nx\">user</span> <span class=\"o\">=</span> <span class=\"nx\">updateLastLogin</span><span class=\"p\">(</span> <span class=\"nx\">user</span> <span class=\"p\">);</span>\n</code></pre></div><p>ç„¶è€Œï¼Œæ‹·è´ä¹Ÿä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ã€‚çªç„¶å¤šå‡ºæ¥çš„å‰¯æœ¬ï¼Œå¤šå°‘ä¼šå½±å“åˆ°æ€§èƒ½ã€‚æˆ‘ä»¬å¸Œæœ›æœ‰ç§æ–¹å¼å¯ä»¥å‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜æ€§èƒ½ã€‚å®ƒä½¿å¾—ä¸åŒå˜é‡æŒ‡å‘åŒä¸€ä¸ªæ•°æ®æºåŒæ—¶æœ‰ç€ä¸åŒç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®äº’ä¸å½±å“ï¼Œè¿™æœ‰ç‚¹åƒ git çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œè¿™æ ·çš„è¯ï¼Œå€¼çš„ä¸å˜æ€§è¿™ä¸ªè¯­ä¹‰ä¹Ÿå¾—ä»¥ä¿ç•™ã€‚å…¶å®å·²ç»æœ‰ä¸€äº›åº“å®ç°äº†ç±»ä¼¼çš„ä¼˜åŒ–ï¼Œå¦‚ Immutable.js ç­‰ã€‚</p><p>å¦‚æœç”¨ä¸¤ä¸ªå­—æ€»ç»“ä»¥ä¸Šçš„å†…å®¹ï¼Œæ— ç–‘ï¼Œå°±æ˜¯ã€Œå¹²æ‰°ã€äº†ï¼Œè¿™ç§å¹²æ‰°æ¥è‡ªäºéé¢„æœŸçš„æ•°æ®å˜åŒ–ã€‚</p><p>ä½œä¸ºå‡½æ•°å¼ç¼–ç¨‹çš„ä¸»è§’ â€”â€” å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªç„¶ä¹Ÿä¼šå¸Œæœ›å‡½æ•°å†…éƒ¨ä¸ä¼šé€ æˆæ•°æ®çš„çªå˜ï¼Œä¸€åˆ‡ç»“æœæ˜¯å¯é¢„æµ‹çš„ï¼Œæ›´å¤šçš„å¸Œæœ›å®ƒèƒ½å¤Ÿç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒ â€”â€” ä¸å˜æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–ç çš„è¿‡ç¨‹ä¸­è¦å‡å°‘å‡½æ•°çš„å‰¯ä½œç”¨ã€‚</p><p>é™¤äº†ä»¥ä¸Šæ‰€è¯´çš„æ•°æ®å…±äº«ï¼Œå‰¯ä½œç”¨è¿˜åŒ…æ‹¬éšæœºæ€§ ï¼ˆ<code>Math.random()</code>ï¼‰ã€IO æ“ä½œã€ç«æ€é—®é¢˜ç­‰ã€‚å‰¯ä½œç”¨æ˜¯å¤šç§å¤šæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨çº¯å‡½æ•°æ¥å‡å°‘è¿™ç§å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œä¸çº¯å‡½æ•°ç›¸è¿èƒŒçš„ï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥è®¤ä¸ºæ˜¯å‰¯ä½œç”¨ã€‚</p><p>ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Ÿæœ‰è¯´çº¯å‡½æ•°å°±æ˜¯å¹‚ç­‰å‡½æ•°ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„çº¯å‡½æ•°éƒ½æ˜¯æ•°å­¦æ¦‚å¿µä¸Šçš„å¹‚ç­‰ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">var</span> <span class=\"nx\">hist</span> <span class=\"o\">=</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">getElementById</span><span class=\"p\">(</span> <span class=\"s2\">&#34;orderHistory&#34;</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// å¹‚ç­‰çš„ï¼š\n</span><span class=\"c1\"></span><span class=\"nx\">hist</span><span class=\"p\">.</span><span class=\"nx\">innerHTML</span> <span class=\"o\">=</span> <span class=\"nx\">order</span><span class=\"p\">.</span><span class=\"nx\">historyText</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// éå¹‚ç­‰çš„ï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">update</span> <span class=\"o\">=</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">createTextNode</span><span class=\"p\">(</span> <span class=\"nx\">order</span><span class=\"p\">.</span><span class=\"nx\">latestUpdate</span> <span class=\"p\">);</span>\n<span class=\"nx\">hist</span><span class=\"p\">.</span><span class=\"nx\">appendChild</span><span class=\"p\">(</span> <span class=\"nx\">update</span> <span class=\"p\">);</span>\n\n<span class=\"c1\">// éå¹‚ç­‰çš„ï¼š\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">calculateAverage</span><span class=\"p\">(</span><span class=\"nx\">list</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">sum</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">sum</span> <span class=\"o\">+=</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">sum</span> <span class=\"o\">/</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">calculateAverage</span><span class=\"p\">(</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"mi\">16</span><span class=\"p\">,</span><span class=\"mi\">22</span><span class=\"p\">]</span> <span class=\"p\">);</span>            <span class=\"c1\">// 9\n</span></code></pre></div><p>å¦ä¸€ç§å®šä¹‰å‡½æ•°çš„æ–¹æ³•æ˜¯ï¼Œç»™å®šç›¸åŒçš„è¾“å…¥ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ï¼Œå®ƒæ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">PI</span> <span class=\"o\">=</span> <span class=\"mf\">3.141592</span><span class=\"p\">;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">circleArea</span><span class=\"p\">(</span><span class=\"nx\">radius</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">PI</span> <span class=\"o\">*</span> <span class=\"nx\">radius</span> <span class=\"o\">*</span> <span class=\"nx\">radius</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>è¿˜æœ‰ä¸€ç§å®šä¹‰å°±æ˜¯ï¼Œå³çº¯å‡½æ•°å…·æœ‰å¼•ç”¨é€æ˜æ€§ã€‚</p><blockquote> å¼•ç”¨é€æ˜æ€§æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¯ä»¥è¢«å®ƒçš„è¾“å‡ºå€¼æ‰€ä»£æ›¿ï¼Œå¹¶ä¸”æ•´ä¸ªç¨‹åºçš„è¡Œä¸ºä¸ä¼šæ”¹å˜ã€‚æ¢å¥è¯è¯´ï¼Œä¸å¯èƒ½ä»ç¨‹åºçš„æ‰§è¡Œä¸­åˆ†è¾¨å‡ºå‡½æ•°è°ƒç”¨æ˜¯è¢«æ‰§è¡Œçš„ï¼Œè¿˜æ˜¯å®ƒçš„è¿”å›å€¼æ˜¯åœ¨å‡½æ•°è°ƒç”¨çš„ä½ç½®ä¸Šå†…è”çš„ã€‚<br/> </blockquote><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">calculateAverage</span><span class=\"p\">(</span><span class=\"nx\">list</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">sum</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">sum</span> <span class=\"o\">+=</span> <span class=\"nx\">list</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">sum</span> <span class=\"o\">/</span> <span class=\"nx\">list</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">nums</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"mi\">16</span><span class=\"p\">,</span><span class=\"mi\">22</span><span class=\"p\">];</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">avg</span> <span class=\"o\">=</span> <span class=\"nx\">calculateAverage</span><span class=\"p\">(</span> <span class=\"nx\">nums</span> <span class=\"p\">);</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span> <span class=\"s2\">&#34;The average is:&#34;</span><span class=\"p\">,</span> <span class=\"nx\">avg</span> <span class=\"p\">);</span>        <span class=\"c1\">// The average is: 9\n</span><span class=\"c1\"></span>\n<span class=\"kd\">var</span> <span class=\"nx\">avg</span> <span class=\"o\">=</span> <span class=\"mi\">9</span><span class=\"p\">;</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span> <span class=\"s2\">&#34;The average is:&#34;</span><span class=\"p\">,</span> <span class=\"nx\">avg</span> <span class=\"p\">);</span>        <span class=\"c1\">// The average is: 9\n</span></code></pre></div><p>ä»£ç çš„å‰¯ä½œç”¨é™ä½äº†ç¨‹åºçš„è´¨é‡ï¼ŒåŒæ—¶ä¹ŸåŠ å¤§äº†æˆ‘ä»¬å¯¹ä»£ç çš„é˜…è¯»éš¾åº¦ã€‚æ²¡æœ‰å‰¯ä½œç”¨çš„ç¨‹åºæ˜¯ä¸å­˜åœ¨çš„ï¼Œæˆ‘ä»¬åªæ˜¯é€šè¿‡é‡æ„ä¸çº¯çš„å‡½æ•°æˆ–å°è£…å‰¯ä½œç”¨ç­‰æ–¹å¼æ¥é¿å…å‰¯ä½œç”¨çš„äº§ç”Ÿã€‚</p><h2>é—­åŒ…å’Œå¯¹è±¡</h2><p>é¦–å…ˆç”¨ä¸¤æ®µä»£ç æ¥æè¿°åŒä¸€ä¸ªä¸œè¥¿ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// é—­åŒ…æ–¹å¼\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">,</span><span class=\"nx\">age</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">happyBirthday</span><span class=\"p\">(){</span>\n        <span class=\"nx\">age</span><span class=\"o\">++</span><span class=\"p\">;</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span>\n            <span class=\"s2\">&#34;Happy &#34;</span> <span class=\"o\">+</span> <span class=\"nx\">age</span> <span class=\"o\">+</span> <span class=\"s2\">&#34;th Birthday, &#34;</span> <span class=\"o\">+</span> <span class=\"nx\">name</span> <span class=\"o\">+</span> <span class=\"s2\">&#34;!&#34;</span>\n        <span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">var</span> <span class=\"nx\">birthdayBoy</span> <span class=\"o\">=</span> <span class=\"nx\">person</span><span class=\"p\">(</span> <span class=\"s2\">&#34;Kyle&#34;</span><span class=\"p\">,</span> <span class=\"mi\">36</span> <span class=\"p\">);</span>\n<span class=\"nx\">birthdayBoy</span><span class=\"p\">();</span>            <span class=\"c1\">// Happy 37th Birthday, Kyle!\n</span><span class=\"c1\"></span>\n<span class=\"c1\">// å¯¹è±¡æ–¹å¼\n</span><span class=\"c1\"></span><span class=\"kd\">var</span> <span class=\"nx\">birthdayBoy</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s2\">&#34;Kyle&#34;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">36</span><span class=\"p\">,</span>\n    <span class=\"nx\">happyBirthday</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">age</span><span class=\"o\">++</span><span class=\"p\">;</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span>\n            <span class=\"s2\">&#34;Happy &#34;</span> <span class=\"o\">+</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">age</span> <span class=\"o\">+</span> <span class=\"s2\">&#34;th Birthday, &#34;</span> <span class=\"o\">+</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">+</span> <span class=\"s2\">&#34;!&#34;</span>\n        <span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">};</span>\n<span class=\"nx\">birthdayBoy</span><span class=\"p\">.</span><span class=\"nx\">happyBirthday</span><span class=\"p\">();</span>\n<span class=\"c1\">// Happy 37th Birthday, Kyle!\n</span></code></pre></div><p>å¯ä»¥å‘ç°é—­åŒ…å’Œå¯¹è±¡å°±æ˜¯å¯¹åŒä¸€äº‹ç‰©çš„ä¸¤ç§è¡¨è¾¾æ–¹å¼ã€‚</p><p>å…³äºé—­åŒ…å’Œå¯¹è±¡æœ‰ç€ä»¥ä¸‹çš„è®ºè°ƒï¼š 1. ä¸€ä¸ªæ²¡æœ‰é—­åŒ…çš„ç¼–ç¨‹è¯­è¨€å¯ä»¥ç”¨å¯¹è±¡æ¥æ¨¡æ‹Ÿé—­åŒ…ã€‚ 2. ä¸€ä¸ªæ²¡æœ‰å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å¯ä»¥ç”¨è¡¨æŠ¥æ¨¡æ‹Ÿå¯¹è±¡ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ JavaScript ä¸­ç”¨å¯¹è±¡æ¨¡æ‹Ÿé—­åŒ…ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">outer</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n\n    <span class=\"k\">return</span> <span class=\"kd\">function</span> <span class=\"nx\">inner</span><span class=\"p\">(){</span>\n        <span class=\"k\">return</span> <span class=\"nx\">x</span><span class=\"p\">;</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>é¦–å…ˆè¦è§£å†³ <code>outer()</code> æ‰§è¡Œåï¼Œ<code>x</code> å˜é‡æ²¡æœ‰è¢«é”€æ¯ã€‚åœ¨åˆ›å»ºå‡½æ•° <code>outer</code> æ—¶ï¼Œæœ‰ä¸ªå¯¹è±¡ä¼šä¿å­˜è¯¥ä½œç”¨åŸŸä¸‹çš„æ‰€æœ‰å˜é‡:</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">scopeOfOuter</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span>\n<span class=\"p\">};</span>\n</code></pre></div><p>åœ¨åˆ›å»ºå‡½æ•° <code>inner</code> æ—¶ï¼Œä¹Ÿä¼šç”Ÿæˆä¸€ä¸ª <code>scopeOfInner</code> çš„ä½œç”¨åŸŸå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„åŸå‹æŒ‡å‘ <code>scopeOfOuter</code>ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">scopeOfInner</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">setPrototypeOf</span><span class=\"p\">(</span> <span class=\"nx\">scopeOfInner</span><span class=\"p\">,</span> <span class=\"nx\">scopeOfOuter</span> <span class=\"p\">);</span>\n</code></pre></div><p>æ‰€ä»¥åœ¨è®¿é—® x å˜é‡æ—¶ï¼Œæ›´åƒæ˜¯åœ¨è®¿é—® scopeOfInner.xï¼Œç„¶åæ²¿åŸå‹é“¾æŸ¥æ‰¾ã€‚</p><p>ä»¥ä¸Šåªæ˜¯äº›å‡è®¾ï¼ŒçœŸå®çš„æƒ…å†µè‚¯å®šæ¯”è¿™å¤æ‚ã€‚è¿™é‡Œåªæ˜¯è®ºè¯å¯ä»¥ä½¿ç”¨å¯¹è±¡å®ç°é—­åŒ…ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é—­åŒ…å®ç°å¯¹è±¡ã€‚</p><h2>é€’å½’</h2><p>é€’å½’å¯ä»¥è¯´æ˜¯å¾ˆå‡½æ•°å¼ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯æ›´å…·æœ‰å£°æ˜è¡Œï¼Œç®€æ´æ˜“è¯»ï¼Œä½†æœ€å¤§çš„å¼Šç«¯è¿˜æ˜¯å†…å­˜å ç”¨æ–¹é¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">foo</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">z</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;foo!&#34;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">bar</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;bar!&#34;</span><span class=\"p\">;</span>\n    <span class=\"nx\">foo</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">baz</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;baz!&#34;</span><span class=\"p\">;</span>\n    <span class=\"nx\">bar</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">baz</span><span class=\"p\">();</span>\n</code></pre></div><p>æ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½å°†å¼€è¾Ÿå‡ºä¸€å°å—ç§°ä¸ºå †æ ˆå¸§çš„å†…å­˜ã€‚å †æ ˆå¸§ä¸­åŒ…å«äº†å‡½æ•°è¯­å¥å½“å‰çŠ¶æ€çš„æŸäº›é‡è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»»æ„å˜é‡çš„å€¼ã€‚ä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸ºä¸€ä¸ªå‡½æ•°æš‚åœå»æ‰§è¡Œå¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œè€Œå¦å¤–ä¸€ä¸ªå‡½æ•°è¿è¡Œç»“æŸåï¼Œå¼•æ“éœ€è¦è¿”å›åˆ°ä¹‹å‰æš‚åœæ—¶å€™çš„çŠ¶æ€ç»§ç»­æ‰§è¡Œã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-f91c46736c058476295d437120d02590_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"603\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb\" width=\"603\" data-original=\"https://pic1.zhimg.com/v2-f91c46736c058476295d437120d02590_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;603&#39; height=&#39;267&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"603\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"603\" data-original=\"https://pic1.zhimg.com/v2-f91c46736c058476295d437120d02590_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-f91c46736c058476295d437120d02590_b.jpg\"/></figure><p>ä½†æ˜¯å¯¹äºé€’å½’æ¥è¯´ï¼Œå¯èƒ½ä¼šç”Ÿæˆä¸Šä¸‡çš„å †æ ˆï¼Œæœ€ç»ˆä¼šå¯¼è‡´çˆ†æ ˆã€‚</p><p>æˆ‘ä»¬å¸Œæœ›å†…å±‚å‡½æ•°åœ¨å‡½æ•°åº•éƒ¨è°ƒç”¨æ—¶ï¼Œå¤–éƒ¨å‡½æ•°çš„å †æ ˆç›´æ¥å¼¹å‡ºã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-5a84778d82954ae0d1ed98201f03e0f9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"603\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb\" width=\"603\" data-original=\"https://pic2.zhimg.com/v2-5a84778d82954ae0d1ed98201f03e0f9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;603&#39; height=&#39;267&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"603\" data-rawheight=\"267\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"603\" data-original=\"https://pic2.zhimg.com/v2-5a84778d82954ae0d1ed98201f03e0f9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-5a84778d82954ae0d1ed98201f03e0f9_b.jpg\"/></figure><p>è¿™ç§æŠ€æœ¯å«åšå°¾è°ƒç”¨ä¼˜åŒ–ã€‚</p><p>å‡å°‘å†…å­˜çš„æ–¹æ³•è¿˜åŒ…æ‹¬åç»§ä¼ é€’é£æ ¼ï¼ˆCPSï¼‰å’Œ Trampoline ç­‰ã€‚</p><blockquote> åˆ©ç”¨CPSå˜æ¢ï¼ŒæŠŠä»»æ„é€’å½’å‡½æ•°æ”¹å†™æˆå°¾è°ƒç”¨å½¢å¼ï¼Œä»¥ continuation é“¾çš„å½¢å¼ï¼Œå°†é€’å½’å ç”¨çš„æ ˆç©ºé—´è½¬ç§»åˆ°å †ä¸Šï¼Œé¿å…çˆ†æ ˆçš„æ‚²å‰§ã€‚ï¼ˆ<a href=\"https://www.zhihu.com/question/28458981\" class=\"internal\">CPSå˜æ¢å¯ä»¥ç”¨æ¥å°†æ™®é€šé€’å½’è½¬å˜ä¸ºå°¾é€’å½’ï¼Ÿï¼Ÿ</a>ï¼‰<br/>åœ¨ç¼ºä¹å°¾è°ƒç”¨ä¼˜åŒ–çš„è¯­è¨€ä¸­ï¼Œå¹¶ä¸çŸ¥æ™“å‡½æ•°ä¸ä¼šè¿”å›ï¼ŒçŠ¶æ€ã€å‚æ•°å‹æ ˆä¾æ—§ä¼šå‘ç”Ÿï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å¼ºåˆ¶å¼¹å‡ºä¸‹ä¸€å±‚è°ƒç”¨çš„å‡½æ•°ï¼Œç¦æ­¢è§£é‡Šå™¨çš„å‹æ ˆè¡Œä¸ºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„Trampolineã€‚ </blockquote><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ–æ³¢é‚£å¥‘\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">fib</span><span class=\"p\">(</span><span class=\"nx\">n</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">n</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">n</span><span class=\"p\">;</span>\n    <span class=\"k\">return</span> <span class=\"nx\">fib</span><span class=\"p\">(</span> <span class=\"nx\">n</span> <span class=\"o\">-</span> <span class=\"mi\">2</span> <span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"nx\">fib</span><span class=\"p\">(</span> <span class=\"nx\">n</span> <span class=\"o\">-</span> <span class=\"mi\">1</span> <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">//  CPS\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">fib</span><span class=\"p\">(</span><span class=\"nx\">n</span><span class=\"p\">,</span><span class=\"nx\">cont</span> <span class=\"o\">=</span> <span class=\"nx\">r</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">r</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">n</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">cont</span><span class=\"p\">(</span> <span class=\"nx\">n</span> <span class=\"p\">);</span>\n    <span class=\"k\">return</span> <span class=\"nx\">fib</span><span class=\"p\">(</span>\n        <span class=\"nx\">n</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"p\">,</span>\n        <span class=\"nx\">n2</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">fib</span><span class=\"p\">(</span>\n            <span class=\"nx\">n</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n            <span class=\"nx\">n1</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">cont</span><span class=\"p\">(</span> <span class=\"nx\">n2</span> <span class=\"o\">+</span> <span class=\"nx\">n1</span> <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">trampoline</span><span class=\"p\">(</span><span class=\"nx\">fn</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"kd\">function</span> <span class=\"nx\">trampolined</span><span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"kd\">var</span> <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">fn</span><span class=\"p\">(</span> <span class=\"p\">...</span><span class=\"nx\">args</span> <span class=\"p\">);</span>\n\n        <span class=\"k\">while</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">result</span> <span class=\"o\">==</span> <span class=\"s2\">&#34;function&#34;</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">result</span><span class=\"p\">();</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"k\">return</span> <span class=\"nx\">result</span><span class=\"p\">;</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// trampoline åŒ–\n</span><span class=\"c1\"></span><span class=\"nx\">trampoline</span><span class=\"p\">(</span><span class=\"nx\">fib</span><span class=\"p\">(</span><span class=\"nx\">n</span><span class=\"p\">,</span><span class=\"nx\">cont</span> <span class=\"o\">=</span> <span class=\"nx\">r</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">r</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">n</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">cont</span><span class=\"p\">(</span> <span class=\"nx\">n</span> <span class=\"p\">);</span>\n    <span class=\"k\">return</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">fib</span><span class=\"p\">(</span>\n        <span class=\"nx\">n</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"p\">,</span>\n        <span class=\"nx\">n2</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">fib</span><span class=\"p\">(</span>\n            <span class=\"nx\">n</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n            <span class=\"nx\">n1</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">cont</span><span class=\"p\">(</span> <span class=\"nx\">n2</span> <span class=\"o\">+</span> <span class=\"nx\">n1</span> <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">);</span>\n<span class=\"p\">})</span>\n</code></pre></div><h2>æ–‡æœ«</h2><p>ä¹¦ä¸­è¿˜æœ‰å…¶å®ƒç« èŠ‚ï¼Œå¤§éƒ¨åˆ†å±äºå®æ“ï¼ŒæŒ‰ä¸‹ä¸è¡¨ã€‚å¯¹äº JavaScript å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨ï¼Œæœ¬ä¹¦å€’æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‡½æ•°å¼ç¼–ç¨‹", 
                    "tagLink": "https://api.zhihu.com/topics/19585411"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }
            ], 
            "comments": [
                {
                    "userName": "leshao", 
                    "userLink": "https://www.zhihu.com/people/ca274241d95e0c5b7a2d7da8c3d981ac", 
                    "content": "å‡½æ•°é—­åŒ…ä½œä¸ºå‡½æ•°å¼ç¼–ç¨‹çš„ä¾‹å­ä¸æ˜¯å¾ˆå¥½ã€‚ä½œä¸ºå‡½æ•°ç»™å®šç¡®å®šçš„è¾“å…¥å°±åº”è¯¥æœ‰ç¡®å®šçš„è¾“å‡ºã€‚è¿™ä¸ªä¾‹å­ä¸­scoreï¼ˆï¼‰æ¯æ¬¡è¿è¡Œè¾“å‡ºéƒ½ä¸åŒã€‚", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<p>æ‡‚ä½ ï¼Œå¯é—­åŒ…æ˜¯ä½œä¸ºå‡½æ•°åŸºç¡€çš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œåªæ˜¯å•çº¯è®²è¿°é—­åŒ…çš„æ¦‚å¿µã€‚è€Œä¸”ä¸‹æ–‡ä¹Ÿæœ‰å±•å¼€è¯´æ˜å‰¯ä½œç”¨å’Œçº¯å‡½æ•°çš„æ¦‚å¿µã€‚</p>", 
                            "likes": 0, 
                            "replyToAuthor": "leshao"
                        }
                    ]
                }, 
                {
                    "userName": "leshao", 
                    "userLink": "https://www.zhihu.com/people/ca274241d95e0c5b7a2d7da8c3d981ac", 
                    "content": "ç”¨ä¸€äº›ç»å…¸çš„ä¾‹å­è§£é‡Šé—­åŒ…ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚å¾ªç¯å»¶æ—¶å‡½æ•°èµ‹å€¼çš„é—®é¢˜<br>for(var i=0;i&lt;5;i++){<br>  setTimeout(alert(i),1000);<br>}<br>è¿™ä¸ªä¼šå¼¹5æ¬¡5ï¼Œå¦‚æœè¦å¼¹01234å°±è¦ç”¨é—­åŒ…äº†ã€‚å½“ç„¶ç°åœ¨ES6ç›´æ¥ç”¨letè§£å†³äº†ï¼Œä¸è¿‡å®ƒä½œä¸ºä¸€ä¸ªé—­åŒ…çš„ä¾‹å­è¿˜æ˜¯æŒºå¥½çš„ã€‚", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<p>ä½ æƒ³è¯´çš„æ˜¯ <br>for(var i=0;i&lt;5;i++){<br>setTimeout(() =&gt; alert(i),1000);<br>} å§ï¼Œ<br>æ˜¯çš„ï¼Œé—­åŒ…å°±æ˜¯ä½œç”¨åŸŸçš„äº§ç‰©ï¼Œå‡½æ•°å†…éƒ¨å…¨éƒ¨æŒ‡å‘äº†åŒä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥æ›´æ–°ä¹Ÿæ˜¯åŒæ­¥çš„ã€‚</p>", 
                            "likes": 0, 
                            "replyToAuthor": "leshao"
                        }, 
                        {
                            "userName": "leshao", 
                            "userLink": "https://www.zhihu.com/people/ca274241d95e0c5b7a2d7da8c3d981ac", 
                            "content": "å—¯ï¼Œæ‰‹æœºæ‰“å­—ä¸æ–¹ä¾¿ã€‚", 
                            "likes": 0, 
                            "replyToAuthor": "æ›‰å®¸"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/85836269", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 10, 
            "title": "JavaScript å¼•æ“åŸç†ï¼ˆä¸‰ï¼‰", 
            "content": "<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼<b>æŸ¥çœ‹å¤§å›¾</b></p><a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic3.zhimg.com/v2-4dad71953b4f3a5c60f78f9d15539666_180x120.jpg\" data-image-width=\"640\" data-image-height=\"512\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤œæ›‰å®¸</a><a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/user/57f1dbf5bf22ec00645dfc31/posts\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ›‰å®¸ çš„ä¸ªäººä¸»é¡µ - ä¸“æ  - æ˜é‡‘</a><h2>å‰è¨€</h2><p>æœ¬æ–‡æ˜¯æ ¹æ®è‡ªå·±çš„ç†è§£ç¿»è¯‘è€Œæ¥ï¼Œå¦‚æœ‰ç–‘æƒ‘å¯æŸ¥çœ‹åŸæ–‡ <a href=\"https://link.zhihu.com/?target=https%3A//v8.dev/blog/react-cliff\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The story of a V8 performance cliff in React</a>ã€‚</p><p>æœ¬æ¬¡æš‚å®šç¿»è¯‘ä¸‰ç¯‡æ–‡ç« ï¼š </p><p>1. <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/shapes-ics\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: Shapes and Inline Caches</a>(Published 14th June 2018) </p><p>2. <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/prototypes\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: optimizing prototypes</a>(Published 16th August 2018)</p><p> 3. <a href=\"https://link.zhihu.com/?target=https%3A//v8.dev/blog/react-cliff\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The story of a V8 performance cliff in React</a>(Published 28 August 2019)</p><h2>JavaScript types</h2><p>åœ¨ JavaScript ä¸­ï¼Œå€¼æœ‰ 8 æ€»ç±»å‹ï¼ˆå½“å‰ï¼‰ï¼š<code>Number</code>ï¼Œ<code>String</code>ï¼Œ<code>Symbol</code>ï¼Œ<code>BigInt</code>ï¼Œ<code>Boolean</code>ï¼Œ<code>Undefined</code>ï¼Œ<code>Null</code>ï¼Œ<code>Object</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-38fe4de60875923053a105d3a1374bd8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"913\" data-rawheight=\"497\" class=\"origin_image zh-lightbox-thumb\" width=\"913\" data-original=\"https://pic1.zhimg.com/v2-38fe4de60875923053a105d3a1374bd8_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;913&#39; height=&#39;497&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"913\" data-rawheight=\"497\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"913\" data-original=\"https://pic1.zhimg.com/v2-38fe4de60875923053a105d3a1374bd8_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-38fe4de60875923053a105d3a1374bd8_b.jpg\"/></figure><p>é™¤äº†ä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å¤–ï¼Œè¿™äº›ç±»å‹éƒ½å¯ä»¥ç”¨ <code>typeof</code> ç›´æ¥æŸ¥çœ‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">typeof</span> <span class=\"mi\">42</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;number&#39;\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;string&#39;\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"nx\">Symbol</span><span class=\"p\">(</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">);</span>\n<span class=\"c1\">// â†’ &#39;symbol&#39;\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"mi\">42</span><span class=\"nx\">n</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;bigint&#39;\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"kc\">true</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;boolean&#39;\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"kc\">undefined</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;undefined&#39;\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"kc\">null</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;object&#39; ğŸ¤”\n</span><span class=\"c1\"></span><span class=\"k\">typeof</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">42</span> <span class=\"p\">};</span>\n<span class=\"c1\">// â†’ &#39;object&#39;\n</span></code></pre></div><p><code>typeof null</code> è¿”å›çš„æ˜¯ <code>&#39;object&#39;</code>ï¼Œè€Œä¸æ˜¯ <code>&#39;null&#39;</code>ï¼Œè¦äº†è§£ä¸ºä»€ä¹ˆï¼Œé¦–å…ˆè¦æŠŠæ‰€æœ‰çš„ JavaScript ç±»å‹åˆ†æˆä¸¤ç»„ï¼š</p><ul><li>objects(å³ï¼Œå¯¹è±¡ç±»å‹)</li><li>primitives(å³ï¼Œéå¯¹è±¡ç±»å‹)</li></ul><p>ç…§æ­¤æ¥è¯´ï¼Œ<code>null</code> è¡¨ç¤ºã€Œæ²¡æœ‰å¯¹è±¡ã€ï¼Œè€Œ <code>undefined</code> è¡¨ç¤º ã€Œæ²¡æœ‰å€¼ã€ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-725b67b9a5865c3f3a09d8843cfae2bc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"384\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-725b67b9a5865c3f3a09d8843cfae2bc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;384&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"384\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-725b67b9a5865c3f3a09d8843cfae2bc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-725b67b9a5865c3f3a09d8843cfae2bc_b.jpg\"/></figure><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼ŒBrendan Eich åœ¨è®¾è®¡ JavaScript æ—¶ï¼Œå—åˆ° Java çš„å½±å“ï¼Œä½¿å¾—å³æ‰‹è¾¹çš„å€¼æ‰§è¡Œ <code>typeof</code> åéƒ½è¿”å› <code>object</code>ã€‚å› æ­¤ï¼Œå³ä¾¿è§„èŒƒé‡Œæœ‰ <code>Null</code> ç±»å‹ï¼Œ<code>typeof null === &#39;object&#39;</code> ä¾ç„¶æˆç«‹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-bc07a11af54b5cd7bffec708e3cf8b2d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"384\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic2.zhimg.com/v2-bc07a11af54b5cd7bffec708e3cf8b2d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;384&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"384\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic2.zhimg.com/v2-bc07a11af54b5cd7bffec708e3cf8b2d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-bc07a11af54b5cd7bffec708e3cf8b2d_b.jpg\"/></figure><h2>Value representation</h2><p>JavaScript å¼•æ“èƒ½å¤Ÿåœ¨å†…å­˜ä¸­è¡¨ç¤ºä»»æ„çš„ JavaScript å€¼ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒJavaScript å¼•æ“åœ¨å†…å­˜ä¸­å€¼ç±»å‹çš„è¡¨ç°å½¢å¼æ˜¯ä¸åŒäº JavaScript ä¸­çš„ç±»å‹æè¿°ã€‚</p><p>ä¾‹å¦‚ï¼Œ42ï¼Œåœ¨ JavaScript ä¸­æ˜¯ <code>number</code> ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">typeof</span> <span class=\"mi\">42</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ &#39;number&#39;\n</span></code></pre></div><p>åœ¨å†…å­˜ä¸­æœ‰å¥½å¤šç§æ–¹å¼è¡¨ç¤ºæ•´æ•°ï¼Œä¾‹å¦‚ 42:</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-2490e3fb325d3fcb9ed1d5b185056034_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1384\" data-rawheight=\"814\" class=\"origin_image zh-lightbox-thumb\" width=\"1384\" data-original=\"https://pic1.zhimg.com/v2-2490e3fb325d3fcb9ed1d5b185056034_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1384&#39; height=&#39;814&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1384\" data-rawheight=\"814\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1384\" data-original=\"https://pic1.zhimg.com/v2-2490e3fb325d3fcb9ed1d5b185056034_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-2490e3fb325d3fcb9ed1d5b185056034_b.jpg\"/></figure><p>ECMAScript å°†æ•°å­—æ ‡å‡†åŒ–ä¸º 64 ä½æµ®ç‚¹å€¼ï¼Œä¹Ÿç§°ä¸ºåŒç²¾åº¦æµ®ç‚¹æˆ– Float64ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ JavaScript å¼•æ“æ€»æ˜¯ä»¥ Float64 çš„å½¢å¼å­˜å‚¨æ•°å­— â€”â€” è¿™ä¹ˆåšä¼šå¾ˆä½æ•ˆã€‚å¼•æ“ä¼šé€‰æ‹©å…¶å®ƒçš„å†…éƒ¨è¡¨ç°å½¢å¼ï¼Œé™¤éè§‚æµ‹åˆ°çš„è¡Œä¸ºå®Œå…¨åŒ¹é… Float64ã€‚</p><p>åœ¨çœŸå®çš„ JavaScript åº”ç”¨ä¸­ï¼Œå¤§å¤šæ•°æ•°å­—éƒ½æ˜¯åˆæ³•çš„ ECMAScript <a href=\"https://link.zhihu.com/?target=https%3A//tc39.es/ecma262/%23array-index\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ•°ç»„ç´¢å¼•</a>ï¼Œå³ï¼Œå±äº 0 ~ 2Â³Â²âˆ’2 èŒƒå›´å†…çš„æ•´æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span> <span class=\"c1\">// Smallest possible array index.\n</span><span class=\"c1\"></span><span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"mi\">42</span><span class=\"p\">];</span>\n<span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">];</span> <span class=\"c1\">// Greatest possible array index.\n</span></code></pre></div><p>JavaScript å¼•æ“ä¼šä¸ºæ•°å­—é€‰æ‹©æœ€ä¼˜å­˜å‚¨çš„è¡¨è¾¾å½¢å¼ä»¥æ­¤ä¼˜åŒ–æ•°ç»„å…ƒç´ çš„è®¿é—®æ•ˆç‡ã€‚å¯¹äºå¤„ç†å™¨çš„å†…å­˜è®¿é—®æ“ä½œï¼Œæ•°ç»„ç´¢å¼•å¿…é¡»æ˜¯äºŒè¿›åˆ¶è¡¥ç çš„å½¢å¼ã€‚ç”¨ Float64 è¡¨ç¤ºæ•°ç»„æ˜¯ä¸€ç§å¾ˆè´¹æ€§èƒ½çš„è¡Œä¸ºï¼Œå› ä¸ºæ¯æ¬¡è®¿é—®æ•°ç»„å…ƒç´ å¼•æ“éƒ½éœ€è¦åœ¨ Float64 å’ŒäºŒè¿›åˆ¶è¡¥ç ä¹‹é—´è½¬æ¢ã€‚</p><p>32 ä½çš„äºŒè¿›åˆ¶è¡¥ç è¡¨è¾¾å½¢å¼å¯¹æ•°ç»„æ“ä½œæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚é€šå¸¸æ¥è¯´ï¼Œå¤„ç†å™¨æ‰§è¡Œæ•´å‹æ“ä½œæ¯”æ‰§è¡Œæµ®ç‚¹å‹æ“ä½œè¦å¿«å¾—å¤šã€‚æ‰€ä»¥è¯´ï¼Œä¸‹é¢çš„ä¾‹å­ï¼Œç¬¬ä¸€ä¸ªå¾ªç¯æ¯”ç¬¬äºŒä¸ªå¾ªç¯å¿«ä¸¤å€ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">1000</span><span class=\"p\">;</span> <span class=\"o\">++</span><span class=\"nx\">i</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"c1\">// fast ğŸš€\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n\n<span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mf\">0.1</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mf\">1000.1</span><span class=\"p\">;</span> <span class=\"o\">++</span><span class=\"nx\">i</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"c1\">// slow ğŸŒ\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n</code></pre></div><p>æ“ä½œç¬¦ä¹Ÿæ˜¯ä¸€æ ·ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ¨¡è¿ç®—ç¬¦çš„æ€§èƒ½å–å†³äºå¤„ç†çš„æ˜¯å¦æ˜¯æ•´æ•°ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">remainder</span> <span class=\"o\">=</span> <span class=\"nx\">value</span> <span class=\"o\">%</span> <span class=\"nx\">divisor</span><span class=\"p\">;</span>\n<span class=\"c1\">// Fast ğŸš€ if `value` and `divisor` are represented as integers,\n</span><span class=\"c1\">// slow ğŸŒ otherwise.\n</span></code></pre></div><p>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯æ•´æ•°çš„å½¢å¼ï¼ŒCPU å°±å¯ä»¥é«˜æ•ˆåœ°è®¡ç®—å‡ºç»“æœã€‚å¦‚æœé™¤æ•°æ˜¯ 2 çš„å€æ•°ï¼ŒV8 è¿˜ä¼šæœ‰é¢å¤–çš„æ·å¾„ã€‚å¯¹äºå€¼æ˜¯æµ®ç‚¹å‹çš„å½¢å¼ï¼Œè®¡ç®—è¿‡ç¨‹ä¼šå˜å¾—å¤æ‚è€—æ—¶ã€‚</p><p>å› ä¸ºæ•´å‹æ“ä½œçš„æ‰§è¡Œé€Ÿåº¦é€šå¸¸æ¯”æµ®ç‚¹å‹è¦å¿«å¾ˆå¤šï¼Œæ‰€ä»¥ï¼Œå¼•æ“å°±åº”è¯¥ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç æ¥è¡¨ç¤ºæ‰€æœ‰çš„æ•´å‹å’Œæ•´å‹æ“ä½œçš„ç»“æœã€‚é—æ†¾çš„æ˜¯ï¼Œé‚£æ˜¯æœ‰æ‚–äº ECMAScript è§„èŒƒçš„ï¼ECMAScript é‡‡ç”¨äº† Float64ï¼ŒæŸäº›æ•´æ•°è¿ç®—å®é™…ä¸Šäº§ç”Ÿçš„æ˜¯æµ®ç‚¹å‹ã€‚åœ¨ä¸‹é¢è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºèƒ½å¤Ÿäº§ç”Ÿæ­£ç¡®çš„ç»“æœå¾ˆé‡è¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Float64 has a safe integer range of 53 bits. Beyond that range,\n</span><span class=\"c1\">// you must lose precision.\n</span><span class=\"c1\"></span><span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">53</span> <span class=\"o\">===</span> <span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">53</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ true\n</span><span class=\"c1\"></span>\n<span class=\"c1\">// Float64 supports negative zeros, so -1 * 0 must be -0, but\n</span><span class=\"c1\">// thereâ€™s no way to represent negative zero in twoâ€™s complement.\n</span><span class=\"c1\"></span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"o\">*</span><span class=\"mi\">0</span> <span class=\"o\">===</span> <span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ true\n</span><span class=\"c1\"></span>\n<span class=\"c1\">// Float64 has infinities which can be produced through division\n</span><span class=\"c1\">// by zero.\n</span><span class=\"c1\"></span><span class=\"mi\">1</span><span class=\"o\">/</span><span class=\"mi\">0</span> <span class=\"o\">===</span> <span class=\"kc\">Infinity</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ true\n</span><span class=\"c1\"></span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"o\">/</span><span class=\"mi\">0</span> <span class=\"o\">===</span> <span class=\"o\">-</span><span class=\"kc\">Infinity</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ true\n</span><span class=\"c1\"></span>\n<span class=\"c1\">// Float64 also has NaNs.\n</span><span class=\"c1\"></span><span class=\"mi\">0</span><span class=\"o\">/</span><span class=\"mi\">0</span> <span class=\"o\">===</span> <span class=\"kc\">NaN</span><span class=\"p\">;</span>\n</code></pre></div><p>å·¦è¾¹çš„å€¼éƒ½æ˜¯æ•´å‹ï¼Œè€Œå³è¾¹çš„å´æ˜¯æµ®ç‚¹å‹ã€‚ä»¥ä¸Šçš„æ“ä½œåœ¨ä½¿ç”¨ 32 ä½äºŒè¿›åˆ¶è¡¥ç çš„å½¢å¼æ˜¯æ²¡æ³•æ­£ç¡®æ‰§è¡Œçš„ã€‚JavaScript å¼•æ“å¿…é¡»ç¡®ä¿æ•´å‹æ“ä½œè¢«åˆç†åœ°å¤„ç†ä»¥ç”Ÿæˆæƒ³è¦çš„ Float64 ç»“æœã€‚</p><p>å¯¹äºåœ¨ 31 ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´å†…çš„å°æ•´æ•°ï¼ŒV8 æœ‰ç‰¹æ®Šçš„è¡¨ç¤ºå½¢å¼ï¼Œç§°ä¸º Smiã€‚å¯¹äºé Smi çš„æ•°å€¼ä¼šè¢«è¡¨ç¤ºä¸º HeapObjectï¼Œå®ƒæ˜¯å†…å­˜ä¸­æŸäº›å®ä½“çš„åœ°å€ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„ HeapObjectï¼Œå³æ‰€è°“çš„ HeapNumberï¼Œæ¥è¡¨ç¤ºè¶…å‡º Smi èŒƒå›´çš„æ•°å­—ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"o\">-</span><span class=\"kc\">Infinity</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span><span class=\"o\">-</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">30</span><span class=\"p\">)</span><span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span>  <span class=\"o\">-</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">30</span><span class=\"p\">)</span> <span class=\"c1\">// Smi\n</span><span class=\"c1\"></span>       <span class=\"o\">-</span><span class=\"mi\">42</span> <span class=\"c1\">// Smi\n</span><span class=\"c1\"></span>        <span class=\"o\">-</span><span class=\"mi\">0</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span>         <span class=\"mi\">0</span> <span class=\"c1\">// Smi\n</span><span class=\"c1\"></span>       <span class=\"mf\">4.2</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span>        <span class=\"mi\">42</span> <span class=\"c1\">// Smi\n</span><span class=\"c1\"></span>   <span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">30</span><span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"c1\">// Smi\n</span><span class=\"c1\"></span>     <span class=\"mi\">2</span><span class=\"o\">**</span><span class=\"mi\">30</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span>  <span class=\"kc\">Infinity</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span>       <span class=\"kc\">NaN</span> <span class=\"c1\">// HeapNumber\n</span></code></pre></div><p>å¦‚ä¸Šæ‰€ç¤ºï¼ŒæŸäº›æ•°å­—è¢«è¡¨ç¤ºä¸º Smiï¼Œå…¶å®ƒæ•°å­—è¢«è¡¨ç¤ºä¸º HeapNumberã€‚V8 å¯¹ Smi ä¸“é—¨ä¼˜åŒ–ï¼Œå› ä¸ºåœ¨çœŸå®çš„ JavaScript ç¼–ç¨‹ä¸­ï¼Œå°çš„æ•´æ•°æ˜¯éå¸¸æ™®éçš„ã€‚Smi æ²¡å¿…è¦åœ¨å†…å­˜ä¸­åˆ†é…ä¸“ç”¨çš„å®ä½“ï¼Œè€Œä¸”å¯ä»¥ç´ å¿«é€Ÿåœ°æ•´å‹æ“ä½œã€‚</p><h2>Smi vs. HeapNumber vs. MutableHeapNumber</h2><p>æœ‰ä»¥ä¸‹å¯¹è±¡ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">o</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">42</span><span class=\"p\">,</span>  <span class=\"c1\">// Smi\n</span><span class=\"c1\"></span>  <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mf\">4.2</span><span class=\"p\">,</span> <span class=\"c1\">// HeapNumber\n</span><span class=\"c1\"></span><span class=\"p\">};</span>\n</code></pre></div><p>x çš„å€¼ 42 è¢«ç¼–ç¨‹ä¸º Smiï¼Œå› æ­¤å®ƒè¢«å­˜å‚¨åœ¨å¯¹è±¡é‡Œã€‚å¦ä¸€æ–¹é¢å€¼ 4.2 éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼ˆç©ºé—´ï¼‰æ¥ä¿å­˜è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡ä¼šæŒ‡å‘è¿™ä¸ªå®ä½“ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-2826084ee57a9032abc3c667d4c9eeb4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"287\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-2826084ee57a9032abc3c667d4c9eeb4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;287&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"287\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-2826084ee57a9032abc3c667d4c9eeb4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-2826084ee57a9032abc3c667d4c9eeb4_b.jpg\"/></figure><p>è¿è¡Œä»¥ä¸‹ JavaScript ä»£ç ç‰‡æ®µï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">+=</span> <span class=\"mi\">10</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ o.x is now 52\n</span><span class=\"c1\"></span><span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ o.y is now 5.2\n</span></code></pre></div><p>è¿™ç§æƒ…å†µä¸‹ï¼Œx çš„å€¼å¯ä»¥å°±åœ°æ›´æ–°ï¼Œå› ä¸ºæ–°çš„å€¼ 52 ä¹Ÿåœ¨ Smi çš„èŒƒå›´å†…ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-210d5d43a0c13034357dc3cfa9b54223_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"301\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-210d5d43a0c13034357dc3cfa9b54223_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;301&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"301\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-210d5d43a0c13034357dc3cfa9b54223_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-210d5d43a0c13034357dc3cfa9b54223_b.jpg\"/></figure><p>ç„¶è€Œï¼Œæ–°çš„å€¼ <code>y=5.2</code> ä¸åœ¨ Smi èŒƒå›´å†…ä¸”ä¸åŒäºä¹‹å‰çš„å€¼ 4.2ï¼Œå› æ­¤ V8 ä¸º y é‡æ–°åˆ†é…äº†æ–°çš„ HeapNumber å®ä½“ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a3f6a6d0201cc42c0f1253c789a40c2a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"375\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic3.zhimg.com/v2-a3f6a6d0201cc42c0f1253c789a40c2a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;375&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"375\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic3.zhimg.com/v2-a3f6a6d0201cc42c0f1253c789a40c2a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-a3f6a6d0201cc42c0f1253c789a40c2a_b.jpg\"/></figure><p>HeapNumber æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒä½¿å¾—æŸäº›ä¼˜åŒ–æˆä¸ºå¯èƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æŠŠ y èµ‹å€¼ç»™ xï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">y</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ o.x is now 5.2\n</span></code></pre></div><p>æˆ‘ä»¬åªéœ€è¦æŠŠå®ƒè¿æ¥åˆ°åŒä¸€ä¸ª HeapNumber ä¸Šè€Œä¸æ˜¯é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„å®ä½“ï¼ˆç©ºé—´ï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-0bceea689a4685f36b76c7fbf6fb7ccf_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"411\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-0bceea689a4685f36b76c7fbf6fb7ccf_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;411&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"411\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-0bceea689a4685f36b76c7fbf6fb7ccf_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-0bceea689a4685f36b76c7fbf6fb7ccf_b.jpg\"/></figure><p>HeapNumber ä¸å¯å˜ä¹Ÿå­˜åœ¨ç¼ºç‚¹ï¼Œå¦‚æœæ›´æ–°çš„å€¼ç»å¸¸ä¸åœ¨ Smi çš„èŒƒå›´å†…ï¼Œå®ƒå°±ä¼šå˜æ…¢ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Create a `HeapNumber` instance.\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">o</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mf\">0.1</span> <span class=\"p\">};</span>\n\n<span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">5</span><span class=\"p\">;</span> <span class=\"o\">++</span><span class=\"nx\">i</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"c1\">// Create an additional `HeapNumber` instance.\n</span><span class=\"c1\"></span>  <span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>ç¬¬ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ª HeapNumber å®ä¾‹ï¼Œå…¶åˆå§‹å€¼ä¸º 0.1ã€‚åœ¨å¾ªç¯ä½“ä¸­å€¼ä» 1.1ï¼Œ2.1ï¼Œ3.1ï¼Œ4.2 å˜åˆ° 5.1ï¼Œä¸€å…±åˆ›å»ºäº† 6 ä¸ª HeapNumber å®ä¾‹ï¼Œå…¶ä¸­ 5 ä¸ªä¼šåœ¨å¾ªç¯ç»“æŸåå˜æ²¡æœ‰ä»»ä½•ç”¨å¤„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-aa3d4c792fe8a7a9ef6b9573cfe5fc1e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"432\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic3.zhimg.com/v2-aa3d4c792fe8a7a9ef6b9573cfe5fc1e_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;432&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"432\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic3.zhimg.com/v2-aa3d4c792fe8a7a9ef6b9573cfe5fc1e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-aa3d4c792fe8a7a9ef6b9573cfe5fc1e_b.jpg\"/></figure><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½œä¸ºä¼˜åŒ–ï¼ŒV8 æä¾›äº†å°±åœ°æ›´æ–°é Smi æ•°å€¼çš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªå­—æ®µå¯¹åº”ç€é Smi çš„æ•°å€¼ï¼ŒV8 ä¼šåœ¨ shape ä¸Šå°†è¿™ä¸ªå­—æ®µæ ‡è®°ä¸º Doubleï¼Œå¹¶åˆ†é…ä¸€ä¸ªä¿å­˜ Float64 çš„ MutableHeapNumber å®ä½“ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-d648058b07ef88ce657421e79dc9b6eb_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"518\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-d648058b07ef88ce657421e79dc9b6eb_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;518&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"518\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-d648058b07ef88ce657421e79dc9b6eb_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-d648058b07ef88ce657421e79dc9b6eb_b.jpg\"/></figure><p>å½“å­—æ®µé‡Œçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒV8 ä¸å¿…åˆ†é…ä¸€ä¸ªæ–°çš„ HeapNumberï¼Œè€Œæ˜¯åœ¨ MutableHeapNumber å®ä½“ä¸­å°±åœ°æ›´æ–°ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-be5a4567408b16d6b7673c11ce89d53b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"500\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-be5a4567408b16d6b7673c11ce89d53b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;500&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"500\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic4.zhimg.com/v2-be5a4567408b16d6b7673c11ce89d53b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-be5a4567408b16d6b7673c11ce89d53b_b.jpg\"/></figure><p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMutableHeapNumber ä¸­çš„å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œæ‰€ä»¥å€¼ä¸åº”è¯¥ä¼ æ¥ä¼ å»çš„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-34ff06182216f5c4f217ea5b441b5c1a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"513\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic3.zhimg.com/v2-34ff06182216f5c4f217ea5b441b5c1a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;513&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"513\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic3.zhimg.com/v2-34ff06182216f5c4f217ea5b441b5c1a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-34ff06182216f5c4f217ea5b441b5c1a_b.jpg\"/></figure><p> ä¾‹å¦‚ï¼Œä½ æŠŠ <code>o.x</code> èµ‹å€¼ç»™å˜é‡ yï¼Œä½ ä¸å¸Œæœ› y ä¼šéšç€ <code>o.x</code> çš„æ”¹å˜è€Œæ”¹å˜ï¼æ‰€ä»¥åœ¨ç»™ y èµ‹å€¼å‰ï¼Œå¿…é¡»å°† <code>o.x</code> çš„å€¼é‡æ–°åŒ…è£…æˆ HeapNumberã€‚</p><p>å¯¹äºæµ®ç‚¹å‹ï¼ŒV8 å·²ç»é»˜é»˜åœ°åŒ…è£…äº†ä¸€ä¸‹ã€‚ä½†æ˜¯ï¼Œå¯¹äºå°çš„æ•´æ•°ä¹Ÿé‡‡ç”¨å’Œ MutableHeapNumber ç›¸åŒçš„æ–¹æ³•ï¼Œå°±ä¼šæ˜¾å¾—æµªè´¹ï¼Œå› ä¸º Smi æœ¬å°±æ˜¯ä¸€ç§æ›´é«˜æ•ˆçš„è¡¨ç°å½¢å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"p\">};</span>\n<span class=\"c1\">// â†’ no â€œboxingâ€ for `x` in object\n</span><span class=\"c1\"></span>\n<span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ update the value of `x` inside object\n</span></code></pre></div><p>ä¸ºäº†é¿å…ä½æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šåœ¨ shape ä¸Šä¸ºå°æ•´æ•°å¯¹åº”çš„å­—æ®µä¸Šæ ‡è®° Smiï¼Œå¹¶ä¸”ä¼šåŸåœ°æ›´æ–°æ•°å€¼ï¼Œåªè¦è¿™ä¸ªæ•°å€¼åœ¨ Smi èŒƒå›´å†…ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b14f87e0036a662f09ea7024562bef8c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"424\" class=\"origin_image zh-lightbox-thumb\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-b14f87e0036a662f09ea7024562bef8c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;960&#39; height=&#39;424&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"960\" data-rawheight=\"424\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"960\" data-original=\"https://pic1.zhimg.com/v2-b14f87e0036a662f09ea7024562bef8c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b14f87e0036a662f09ea7024562bef8c_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>Shape deprecations and migrations</h2><p>å¦‚æœä¸€ä¸ªå­—æ®µé‡ŒåŒ…å«çš„å€¼åœ¨ Smi èŒƒå›´å†…ï¼Œä¹‹ååˆä¸å±äº Smi èŒƒå›´ï¼Œè¿™ä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç°æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬çš„ x å±æ€§å€¼éƒ½æ˜¯ Smi è¡¨ç¤ºå½¢å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"p\">};</span>\n<span class=\"k\">const</span> <span class=\"nx\">b</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"p\">};</span>\n<span class=\"c1\">// â†’ objects have `x` as `Smi` field now\n</span><span class=\"c1\"></span>\n<span class=\"nx\">b</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mf\">0.2</span><span class=\"p\">;</span>\n<span class=\"c1\">// â†’ `b.x` is now represented as a `Double`\n</span><span class=\"c1\"></span>\n<span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"nx\">a</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span>\n</code></pre></div><p>è¿™ä¸¤ä¸ªå¯¹è±¡éƒ½æŒ‡å‘åŒä¸€ä¸ª shapeï¼Œx å±æ€§ç‰¹æ€§ Representation è¢«æ ‡è®°ä¸º Smiï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-a4ed44e7df85af2cc6708d24cf805bdc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-a4ed44e7df85af2cc6708d24cf805bdc_b.jpg\"/></figure><p>å½“ <code>b.x</code> å˜æˆ Double å½¢å¼ï¼ŒV8 ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ shapeï¼Œå±æ€§ x çš„ Representation è¢«æ ‡è®°ä¸º Double ä¸”æŒ‡å‘ä¹‹å‰çš„ç©º shapeã€‚V8 ä¹Ÿä¼šä¸ºå±æ€§ x åˆ†é…ä¸€ä¸ª MutableHeapNumber å®ä½“ç”¨æ¥ä¿å­˜å€¼ 0.2ã€‚ç„¶åè®©å¯¹è±¡ b æŒ‡å‘æ–°åˆ›å»ºçš„ shape å¹¶ä¸”å†…éƒ¨åç§»é‡ä¸º 0 çš„ä½ç½®æŒ‡å‘åˆšåˆ†é…çš„ MutableHeapNumber å®ä½“ã€‚æœ€åï¼Œæˆ‘ä»¬æŠŠæ—§çš„ shape æ ‡è®°ä¸ºåºŸå¼ƒçš„ï¼Œå¹¶æ–­å¼€ä¸è¿‡æ¸¡æ ‘ï¼ˆtransition treeï¼‰çš„é“¾æ¥ã€‚è¿™å°±å®Œæˆäº†ä»ç©º shape åˆ°æ–° shape çš„è¿‡æ¸¡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-5abadd26ab81e21fc6dd0dbc096df84d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-5abadd26ab81e21fc6dd0dbc096df84d_b.jpg\"/></figure><p>æˆ‘ä»¬ä¸èƒ½åŒæ—¶å®Œå…¨åˆ é™¤æ—§ shapeï¼Œå› ä¸ºå¯¹è±¡ a è¿˜åœ¨ä½¿ç”¨ï¼Œè€Œä¸”çŸ­æ—¶é—´æ‰¾åˆ°æ‰€æœ‰é“¾æ¥åˆ°æ—§ shape çš„å¯¹è±¡å¹¶æ›´æ–°å®ƒä»¬ï¼Œå¯¹ V8 æ¥è¯´æ˜¯ç¬”å¾ˆå¤§çš„å¼€é”€ã€‚ç›¸åï¼ŒV8 ä¸æ€¥ç€å¤„ç†ï¼šåªæœ‰åœ¨æ”¹å˜å¯¹è±¡ a çš„æ—¶å€™æ‰å¼€å§‹è¿ç§»åˆ°æ–°çš„ shapeã€‚æœ€ç»ˆï¼Œæ ‡è®°ä¸ºåºŸå¼ƒçš„ shape ä¼šæ…¢æ…¢æ·¡å‡ºè§†é‡å¹¶è¢«åƒåœ¾å›æ”¶æœºåˆ¶æŠ¹é™¤ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4dd78bf41858fe5600d91eff5117f62a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-4dd78bf41858fe5600d91eff5117f62a_b.jpg\"/></figure><p>æ›´æ£˜æ‰‹çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸Šå±æ€§ç‰¹æ€§ Representation å‘ç”Ÿå˜åŒ–çš„å±æ€§ä¸æ˜¯ shape é“¾ä¸Šçš„æœ€åä¸€ä¸ªï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-86e96781fd2d1b4c301f8c35bc1b6b14_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-86e96781fd2d1b4c301f8c35bc1b6b14_b.jpg\"/></figure><p>ä»äº§ç”Ÿåˆ†æ”¯çš„ shape å¼€å§‹ï¼Œæˆ‘ä»¬ä¸ºå±æ€§ y åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è¿‡æ¸¡é“¾ä¸” y è¢«æ ‡è®°ä¸º Doubleã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨æ–°çš„è¿‡æ¸¡é“¾æ—¶ï¼Œä¹Ÿå°±æ„å‘³ç€æ—§çš„è¿‡æ¸¡é“¾å°†è¢«åºŸå¼ƒã€‚åœ¨æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬æŠŠå®ä¾‹ o è¿ç§»åˆ°æ–°çš„ shape å¹¶ç”¨ MutableHeapNumber ä¿å­˜ y çš„å€¼ã€‚å°±è¿™æ ·ï¼Œæ–°å¯¹è±¡ä¸å†ä½¿ç”¨è€çš„é‚£ä¸€å¥—ï¼Œä¸€æ—¦æ—§çš„ shape ä¸Šçš„é“¾æ¥éƒ½è¢«ç§»é™¤æ‰ï¼Œæ—§ shape ä¹Ÿä¼šä»è¿‡æ¸¡æ ‘ä¸Šæ¶ˆå¤±ã€‚</p><h2>Extensibility and integrity-level transitions</h2><p><code>Object.preventExtensions()</code> é˜²æ­¢å°†æ–°å±æ€§æ·»åŠ åˆ°å¯¹è±¡ä¸­ã€‚å¦‚æœä½ è¿™ä¹ˆåšäº†ï¼Œå®ƒå°†ä¼šæŠ›å¼‚å¸¸ã€‚ï¼ˆå¦‚æœæ˜¯åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå®ƒä¸ä¼šæŠ›å¼‚å¸¸è€Œæ˜¯é»˜è®¤ä»€ä¹ˆéƒ½ä¸åšã€‚ï¼‰</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"p\">};</span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">preventExtensions</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">);</span>\n<span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">;</span>\n<span class=\"c1\">// TypeError: Cannot add property y;\n</span><span class=\"c1\">//            object is not extensible\n</span></code></pre></div><p><code>Object.seal</code> ä¸ <code>Object.preventExtensions</code> ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä¼šæŠŠæ‰€æœ‰çš„å±æ€§æ ‡è®°ä¸ºä¸å¯é…ç½®ï¼Œè¿™å°±æ„å‘³ç€ä½ ä¸èƒ½åˆ é™¤å®ƒä»¬ï¼Œæˆ–æ”¹å˜ä»–ä»¬çš„å¯æšä¸¾æ€§ï¼Œå¯é…ç½®æ€§ï¼Œå¯å†™æ€§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"p\">};</span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">seal</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">);</span>\n<span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">;</span>\n<span class=\"c1\">// TypeError: Cannot add property y;\n</span><span class=\"c1\">//            object is not extensible\n</span><span class=\"c1\"></span><span class=\"k\">delete</span> <span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span>\n<span class=\"c1\">// TypeError: Cannot delete property x\n</span></code></pre></div><p><code>Object.freeze</code> ä¸ <code>Object.seal</code> ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒå°†æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºä¸å¯å†™ä»¥é˜²æ­¢å±æ€§å€¼è¢«ä¿®æ”¹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"p\">};</span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">freeze</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">);</span>\n<span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">;</span>\n<span class=\"c1\">// TypeError: Cannot add property y;\n</span><span class=\"c1\">//            object is not extensible\n</span><span class=\"c1\"></span><span class=\"k\">delete</span> <span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span>\n<span class=\"c1\">// TypeError: Cannot delete property x\n</span><span class=\"c1\"></span><span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">3</span><span class=\"p\">;</span>\n<span class=\"c1\">// TypeError: Cannot assign to read-only property x\n</span></code></pre></div><p>è®©æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæœ‰ä¸¤ä¸ªéƒ½åªæœ‰å±æ€§ y çš„å¯¹è±¡ï¼Œå¹¶é˜»æ­¢ç¬¬äºŒä¸ªå¯¹è±¡æœ‰ä»»ä½•çš„æ‰©å±•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"p\">};</span>\n<span class=\"k\">const</span> <span class=\"nx\">b</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"p\">};</span>\n\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">preventExtensions</span><span class=\"p\">(</span><span class=\"nx\">b</span><span class=\"p\">);</span>\n</code></pre></div><p>å°±å¦‚æˆ‘ä»¬æ‰€çŸ¥çš„ï¼Œä»ç©ºçš„ shape è¿‡æ¸¡åˆ°ä¸€ä¸ªæœ‰å±æ€§ x ï¼ˆè¢«æ ‡è®°ä¸º Smiï¼‰çš„æ–° shape ä¸Šã€‚å½“æˆ‘ä»¬é˜»æ­¢ b çš„æ‰©å±•æ—¶ï¼Œæˆ‘ä»¬ä¼šè¿‡æ¸¡åˆ°æ ‡è®°ä¸ºä¸å¯æ‰©å±•çš„æ–° shape ä¸Šã€‚è¿™ä¸ªæ–° shape æ²¡æœ‰ä»»ä½•å±æ€§ï¼Œä»…ä»…ä½œä¸ºä¸€ä¸ªæ ‡è¯†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-ce126f620ca66ae139fd5b27d984ff63_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-ce126f620ca66ae139fd5b27d984ff63_b.jpg\"/></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½å°±åœ°æ›´æ–°æœ‰ x çš„ shapeï¼Œå› ä¸ºå¯¹è±¡ a ä¾ç„¶æ˜¯å¯æ‰©å±•çš„ã€‚</p><h2>The React performance issue</h2><p>è®©æˆ‘ä»¬ç”¨ä»¥ä¸Šå­¦åˆ°çš„çŸ¥è¯†æ¥è§£æä¸‹ <a href=\"https://link.zhihu.com/?target=https%3A//github.com/facebook/react/issues/14365\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">the recent React issue #14365</a>ã€‚ç®€å•é‡ç°è¿™ä¸ª bugï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">o</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"p\">};</span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">preventExtensions</span><span class=\"p\">(</span><span class=\"nx\">o</span><span class=\"p\">);</span>\n<span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mf\">0.2</span><span class=\"p\">;</span>\n</code></pre></div><p>æœ‰ä¸€ä¸ªæ‹¥æœ‰ä¸¤ä¸ªå­—æ®µçš„å¯¹è±¡ï¼Œè€Œä¸”å®ƒä»¬çš„å±æ€§ç‰¹æ€§ Representation è¢«æ ‡è®°ä¸º Smiã€‚æˆ‘ä»¬é˜»æ­¢å¯¹è±¡çš„è¿›ä¸€æ­¥æ‰©å±•ï¼Œä½†æœ€ç»ˆæˆ‘ä»¬è¿˜æ˜¯å¼ºåˆ¶æ”¹å˜ç¬¬äºŒå­—æ®µçš„å±æ€§ç‰¹æ€§ Representation çš„å€¼ï¼ˆDoubleï¼‰ã€‚</p><p>å°±å¦‚ä¹‹å‰å­¦åˆ°çš„ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-270009120e3e14335c7578ad12f9e4d4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-270009120e3e14335c7578ad12f9e4d4_b.jpg\"/></figure><p>æ¯ä¸ªå±æ€§çš„ç‰¹æ€§ Representation éƒ½è¢«æ ‡è®°ä¸º Smiï¼Œå¹¶æœ€ç»ˆè¿‡æ¸¡åˆ°è¢«æ ‡è®°ä¸ºä¸å¯æ‰©å±•çš„ shape ä¸Šã€‚</p><p>æˆ‘ä»¬éœ€è¦å°† y çš„å±æ€§ç‰¹æ€§ Representation æ ‡è®°ä¸º Doubleï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä»å¼•å…¥ y å±æ€§ä¹‹å‰çš„ shape å¼€å§‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±æ˜¯å¼•å…¥ x å±æ€§çš„é‚£ä¸ª shapeã€‚ä½†æ˜¯ï¼Œ V8 ä¼šå¾ˆå›°æƒ‘ï¼Œå› ä¸ºå½“å‰çš„ shape æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œè€Œæ‰¾åˆ°çš„ shape å´æ˜¯å¯æ‰©å±•çš„ã€‚V8 ä¸çŸ¥é“æ€ä¹ˆå»å¤„ç†è¿™ä¸ªè¿‡æ¸¡æ ‘ã€‚å› æ­¤ï¼ŒV8 ä¸å†è¯•å›¾ææ¸…æ¥šè¿™äº›å…³ç³»ï¼Œè€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„ shapeï¼Œè¿™ä¸ª shape å’Œå…ˆå‰çš„è¿‡æ¸¡æ ‘æ²¡æœ‰ä»»ä½•å…³è”ï¼Œè€Œä¸”ä¹Ÿä¸è¢«ä»»ä½•å…¶å®ƒå¯¹è±¡å…±äº«ã€‚å¯ä»¥æŠŠå®ƒå½“ä½œå­¤ç«‹çš„ shapeï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-9b74b507117fb4f9e3af3b9237d78607_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-9b74b507117fb4f9e3af3b9237d78607_b.jpg\"/></figure><p>ä½ å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæœ‰å¾ˆå¤šå¯¹è±¡çš„è¯ï¼Œè¿™æ ·ä¼šå˜å¾—å¾ˆç³Ÿç³•ï¼Œå› ä¸ºæ•´ä¸ª shape ç³»ç»Ÿå·²ç»å¤±å»ä»·å€¼ã€‚</p><p>åœ¨ React çš„æ¡ˆä¾‹ä¸­ï¼Œå½“å¼€å§‹åˆ†ææ•°æ®æ—¶ï¼ŒFiberNode ä¸Šçš„ä¸€äº›å­—æ®µéœ€è¦è®°å½•æ—¶é—´æˆ³ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">FiberNode</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">actualStartTime</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">preventExtensions</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">node1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">FiberNode</span><span class=\"p\">();</span>\n<span class=\"k\">const</span> <span class=\"nx\">node2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">FiberNode</span><span class=\"p\">();</span>\n</code></pre></div><p>è¿™äº›å­—æ®µï¼ˆæ¯”å¦‚ï¼ŒactualStartTimeï¼‰åˆå§‹åŒ–å€¼æ˜¯ 0 æˆ– -1ï¼Œå› æ­¤å±æ€§ç‰¹æ€§ Representation ä¸º Smiã€‚ä½†æ˜¯ï¼Œä¹‹åç”± <code>performance.now()</code> ç”Ÿæˆçš„æµ®ç‚¹å‹æ•°å€¼è¢«ä¿å­˜åœ¨è¿™äº›å­—æ®µä¸­ï¼Œå› æ­¤å±æ€§ç‰¹æ€§ Representation è¢«æ ‡è®°ä¸º Doubleã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒReact è¿˜é˜»æ­¢ FiberNode å®ä¾‹æ‰©å±•å±æ€§ã€‚</p><p>åˆšå¼€å§‹çš„çŠ¶å†µå¦‚ä¸‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c0e1a02da5a1af81137e6cdf2e53e071_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-c0e1a02da5a1af81137e6cdf2e53e071_b.jpg\"/></figure><p>å¦‚é¢„æœŸï¼Œä¸¤ä¸ªå®ä¾‹å…±äº«ç€ shape æ ‘ã€‚ä½†æ˜¯ä¹‹åï¼Œä¸€æ—¦ä½ å­˜å‚¨äº†çœŸå®çš„æ—¶é—´æˆ³ï¼ŒV8 å°±ä¼šæ— ä»ä¸‹æ‰‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-33868351931ebbcb33d93746554a256d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-33868351931ebbcb33d93746554a256d_b.jpg\"/></figure><p>V8 å…ˆåç»™ node1ï¼Œnode2 åˆ†åˆ«åˆ†é…äº†ç‹¬ç«‹çš„ shapeï¼Œä¸”å®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³è”ã€‚çœŸå®ä¸­çš„ React åº”ç”¨æœ‰ç€æ•°ä¸‡ä¸ªè¿™æ ·çš„ FiberNodeã€‚ä½ å¯ä»¥æƒ³è±¡ï¼Œè¿™ç§æƒ…å†µå°†ä¼šä¸¥é‡å½±å“åˆ° V8 çš„æ€§èƒ½ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ª<a href=\"https://link.zhihu.com/?target=https%3A//chromium-review.googlesource.com/c/v8/v8/%2B/1442640/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">é—®é¢˜</a>åœ¨ <a href=\"https://link.zhihu.com/?target=https%3A//v8.dev/blog/v8-release-74\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">V8 v7.4</a> ä¸­è§£å†³äº†ã€‚ç ”å‘äººå‘˜æ‰¾åˆ°äº†æ”¹å˜å±æ€§ç‰¹æ€§ Representation çš„æ–¹æ³•ï¼ŒV8 ç»ˆäºçŸ¥é“å®ƒè¯¥æ€ä¹ˆåšäº†ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-13b1354caa53ea1136300a224fdde1e1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-13b1354caa53ea1136300a224fdde1e1_b.jpg\"/></figure><p>ä¸¤ä¸ª FiberNode å®ä¾‹æŒ‡å‘ä¸å¯æ‰©å±•çš„ shapeï¼Œshape ä¸­çš„ <code>actualStartTime</code> è¢«æ ‡è®°ä¸º Smiã€‚å½“ <code>node1.actualStartTime</code> è¢«åˆ†é…æ–°çš„å€¼æ—¶ï¼Œå°†ä¼šç”Ÿæˆä¸€æ¡æ–°çš„è¿‡æ¸¡é“¾ï¼Œè€Œä¸”ä¹‹å‰çš„è¿‡æ¸¡é“¾ä¼šè¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b7ed39130d9988935331454b7539a8a9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-b7ed39130d9988935331454b7539a8a9_b.jpg\"/></figure><p>å¯ä»¥æ³¨æ„åˆ°ï¼Œç°åœ¨çš„è¿‡æ¸¡é“¾å¯ä»¥æ­£ç¡®çš„è¿‡æ¸¡è½¬ç§»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-8da573484ee0f07adddb8fe55fe6e60f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-8da573484ee0f07adddb8fe55fe6e60f_b.jpg\"/></figure><p>å½“ <code>node2.actualStartTime</code> ä¹Ÿè¢«é‡æ–°åˆ†é…æ—¶ï¼Œæ‰€æœ‰çš„é“¾æ¥éƒ½æŒ‡å‘äº†æ–°çš„ shapeï¼Œè¿‡æ¸¡æ ‘ä¸­åºŸå¼ƒçš„éƒ¨åˆ†å°†ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤ã€‚</p><p>React å›¢é˜Ÿå°† FiberNode æ‰€æœ‰å…³äºæ—¶é—´çš„å­—æ®µéƒ½æ”¹æˆäº† Double å½¢å¼ä»è€Œç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">FiberNode</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// Force `Double` representation from the start.\n</span><span class=\"c1\"></span>    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">actualStartTime</span> <span class=\"o\">=</span> <span class=\"nb\">Number</span><span class=\"p\">.</span><span class=\"kc\">NaN</span><span class=\"p\">;</span>\n    <span class=\"c1\">// Later, you can still initialize to the value you want:\n</span><span class=\"c1\"></span>    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">actualStartTime</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">preventExtensions</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">node1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">FiberNode</span><span class=\"p\">();</span>\n<span class=\"k\">const</span> <span class=\"nx\">node2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">FiberNode</span><span class=\"p\">();</span>\n</code></pre></div><p>ç”± React å…·ä½“çš„ Bug å¼•å‡ºäº† V8 ç‰¹æœ‰çš„é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´ï¼Œå¼€å‘è€…ä¸å¿…å¯¹æŸä¸ªç‰ˆæœ¬çš„ JavaScript å¼•æ“åšä¼˜åŒ–ã€‚ä¸è¿‡ï¼Œå½“æ—¶äº‹æƒ…å‘ä¸å¥½çš„æ–¹å‘å‘å±•æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šæŸæ‰‹æ— ç­–ã€‚</p><p>è¦çŸ¥é“ JavaScript å¼•æ“åœ¨å¹•ååšäº†å¾ˆå¤šäº‹ï¼Œå°½å¯èƒ½çš„ä¸è¦å»æ··åˆç±»å‹ã€‚ä¾‹å¦‚ï¼Œç»™ä¸€ä¸ªæ•°å­—å­—æ®µåˆå§‹åŒ–ä¸º nullï¼Œè¿™æ ·åšçš„è¯ä¼šä½¿å¾—ä¸€äº›ä¼˜åŒ–åŒ–ä¸ºæ³¡å½±ï¼Œè€Œä¸”å¯è¯»æ€§é™ä½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Donâ€™t do this!\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Point</span> <span class=\"p\">{</span>\n  <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"p\">;</span>\n  <span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">p</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Point</span><span class=\"p\">();</span>\n<span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mf\">0.1</span><span class=\"p\">;</span>\n<span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">402</span><span class=\"p\">;</span>\n</code></pre></div><p>æ¢å¥è¯è¯´ï¼Œå†™å¯è¯»æ€§ä»£ç ï¼Œæ€§èƒ½è‡ªç„¶ä¼šç´§è·Ÿå…¶åï¼</p><h2>Take-aways</h2><p>æœ¬æ–‡è¦†ç›–äº†ä¸€ä¸‹å‡ ç‚¹ï¼š</p><ol><li>JavaScript åŒºåˆ†äº† primitives å’Œ objectsï¼Œè€Œä¸” typeof ä¸é è°±ã€‚</li><li>å³ä½¿æ˜¯ç›¸åŒç±»å‹çš„å€¼ä¹Ÿä¼šæœ‰ä¸åŒçš„è¡¨è¾¾å½¢å¼ã€‚</li><li>JavaScript å¼•æ“ä¼šä¸ºæ¯ä¸ªå±æ€§æ‰¾åˆ°æœ€ä¼˜çš„è¡¨è¾¾å½¢å¼ã€‚</li><li>è®¨è®ºäº† V8 å¤„ç† shape çš„åºŸå¼ƒï¼Œè¿ç§»å’Œå¯æ‰©å±•ã€‚</li></ol><p>åŸºäºä»¥ä¸Šçš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº› JavaScript ç¼–ç¨‹æŠ€å·§æ¥æå‡æ€§èƒ½ï¼š</p><ol><li>ä»¥ç›¸åŒçš„æ–¹å¼åˆå§‹åŒ–å¯¹è±¡ç±»å‹ï¼Œè¿™æ · shape ç³»ç»Ÿä¼šæ›´é«˜æ•ˆã€‚</li><li>ä¸ºä½ çš„å­—æ®µé€‰æ‹©åˆç†çš„å€¼ï¼ˆã€ŒRepresentationã€ï¼šSmi æˆ– é Smiï¼‰ã€‚</li></ol>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "JavaScript å¼•æ“", 
                    "tagLink": "https://api.zhihu.com/topics/19856435"
                }, 
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }
            ], 
            "comments": [
                {
                    "userName": "é‚µä¸æƒ…", 
                    "userLink": "https://www.zhihu.com/people/58bfe3eddab3851c21d547d277f3a5bb", 
                    "content": "è¯·é—®æ˜¯ä»€ä¹ˆå·¥å…·ç”»çš„è¿™ä¹ˆæ¼‚äº®çš„å›¾ï¼Ÿ", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "è¿™æ˜¯ç¿»è¯‘è¿‡æ¥çš„ï¼Œä¸çŸ¥é“è¯¶", 
                            "likes": 0, 
                            "replyToAuthor": "é‚µä¸æƒ…"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/85836157", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 6, 
            "title": "JavaScript å¼•æ“åŸç†ï¼ˆäºŒï¼‰", 
            "content": "<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼<b>æŸ¥çœ‹å¤§å›¾</b></p><a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic3.zhimg.com/v2-4dad71953b4f3a5c60f78f9d15539666_180x120.jpg\" data-image-width=\"640\" data-image-height=\"512\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤œæ›‰å®¸</a><a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/user/57f1dbf5bf22ec00645dfc31/posts\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ›‰å®¸ çš„ä¸ªäººä¸»é¡µ - ä¸“æ  - æ˜é‡‘</a><h2>å‰è¨€</h2><p>æœ¬æ–‡æ˜¯æ ¹æ®è‡ªå·±çš„ç†è§£ç¿»è¯‘è€Œæ¥ï¼Œå¦‚æœ‰ç–‘æƒ‘å¯æŸ¥çœ‹åŸæ–‡  <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/prototypes\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: optimizing prototypes</a>ã€‚</p><p>æœ¬æ¬¡æš‚å®šç¿»è¯‘ä¸‰ç¯‡æ–‡ç« ï¼š</p><p> 1. <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/shapes-ics\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: Shapes and Inline Caches</a>(Published 14th June 2018)</p><p> 2. <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/prototypes\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: optimizing prototypes</a>(Published 16th August 2018) </p><p>3. <a href=\"https://link.zhihu.com/?target=https%3A//v8.dev/blog/react-cliff\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The story of a V8 performance cliff in React</a>(Published 28 August 2019)</p><h2>Optimization tiers and execution trade-offs</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/shapes-ics\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä¸Šä¸€ç¯‡æ–‡ç« </a>å·²ç»è®¨è®ºäº†ç°ä»£ JavaScript å¼•æ“çš„å·¥ä½œæµç¨‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b0ba818f33199baff3d6d697b1e5c269_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-b0ba818f33199baff3d6d697b1e5c269_b.jpg\"/></figure><p>æˆ‘ä»¬ä¹ŸæŒ‡å‡ºäº†å¼•æ“é—´çš„ç›¸åŒä¹‹å¤„å’Œç¼–è¯‘ç¯èŠ‚ä¸­çš„å·®å¼‚ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿä¸ºä»€ä¹ˆä¸€äº›å¼•æ“çš„ç¼–è¯‘å™¨æ¯”å…¶ä»–å¼•æ“å¤šï¼Ÿç»“è®ºæ˜¯åŸºäºæ›´å¿«åœ°ç”Ÿæˆä»£ç å’Œç”Ÿæˆæ›´å¥½çš„ä»£ç ä¸¤è€…é—´çš„è€ƒé‡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-795faf39e9708c9048ae58e69c15b911_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-795faf39e9708c9048ae58e69c15b911_b.jpg\"/></figure><p>è§£é‡Šå™¨å¯ä»¥å¾ˆå¿«åœ°ç”Ÿæˆå­—èŠ‚ç ï¼Œä½†æ˜¯å­—èŠ‚ç çš„æ•ˆç‡ä¸é«˜ã€‚å¦ä¸€æ–¹é¢ï¼Œä¼˜åŒ–ç¼–è¯‘å™¨è™½ç„¶ä¼šç¨å¾®èŠ±è´¹äº›æ—¶é—´ï¼Œå´å¯ä»¥ç”Ÿæˆæ•ˆç‡æ›´é«˜çš„æœºå™¨ç ã€‚</p><p>ä¸‹å›¾æ˜¯ V8 æ¨¡å‹ï¼ŒV8 çš„è§£é‡Šå™¨ç§°ä¸º Ignitionï¼Œæ˜¯æ‰€æœ‰å¼•æ“ä¸­æœ€å¿«çš„è§£é‡Šå™¨ï¼ˆä»åŸå§‹å­—èŠ‚ç æ‰§è¡Œé€Ÿåº¦çš„è§’åº¦ï¼‰ã€‚V8 çš„ä¼˜åŒ–ç¼–è¯‘å™¨ç§°ä¸º TurboFanï¼Œå®ƒæœ€ç»ˆä¼šç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„æœºå™¨ç ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-bad5e6f142b102b3ee2c16235b876057_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-bad5e6f142b102b3ee2c16235b876057_b.jpg\"/></figure><p>å¯åŠ¨é€Ÿåº¦å’Œæ‰§è¡Œé€Ÿåº¦æ˜¯ä¸€äº› JavaScript å¼•æ“é€‰æ‹©æ·»åŠ ä¼˜åŒ–å±‚çš„ç†ç”±ã€‚æ¯”å¦‚ï¼ŒSpiderMonkey å°±åœ¨è§£é‡Šå™¨å’Œ IonMonkey ç¼–è¯‘å™¨é—´æ·»åŠ äº† Baseline å±‚ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-2fe0dc4cdd0ae2ce403bddcb0bdccb34_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-2fe0dc4cdd0ae2ce403bddcb0bdccb34_b.jpg\"/></figure><p>è§£é‡Šå™¨å¯ä»¥å¿«é€Ÿç”Ÿæˆå­—èŠ‚ç ï¼Œä½†æ˜¯å­—èŠ‚ç æ‰§è¡Œçš„é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚Baseline ä¼šèŠ±äº›æ—¶é—´ç”Ÿæˆä»£ç ï¼Œä½†åŒæ ·ä¼šæä¾›æ€§èƒ½æ›´å¥½çš„ä»£ç ã€‚æœ€åï¼ŒIonMonkey ä¼šèŠ±æ›´é•¿çš„æ—¶é—´å»ç”Ÿæˆæœºå™¨ç ï¼Œå¹¶èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°æ‰§è¡Œã€‚</p><p>æ¥ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œçœ‹çœ‹ä¸åŒå¼•æ“ä¹‹é—´çš„å¤„ç†å·®å¼‚ã€‚åœ¨è¿™ä¸ªå¾ªç¯é‡Œï¼Œä¸€äº›ä»£ç é‡å¤æ‰§è¡Œã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">4242424242</span><span class=\"p\">;</span> <span class=\"o\">++</span><span class=\"nx\">i</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">result</span> <span class=\"o\">+=</span> <span class=\"nx\">i</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">result</span><span class=\"p\">);</span>\n</code></pre></div><p>åœ¨ Ignition è§£é‡Šå™¨ä¸­ï¼ŒV8 å¼€å§‹æ‰§è¡Œå­—èŠ‚ç ã€‚åœ¨æŸä¸ªæ—¶åˆ»å¼•æ“æµ‹å®šä»£ç æ˜¯ hot çš„ï¼Œå°±ä¼šå¯åŠ¨ <code>TurboFan frontend</code>, <code>TurboFan frontend</code> æ˜¯è´Ÿè´£æ•´åˆåˆ†ææ•°æ®ï¼ˆprofiling dataï¼‰å¹¶æ„å»ºä»£ç çš„åˆçº§æœºå™¨ç è¡¨ç°å½¢å¼ã€‚è¿™äº›ä¸œè¥¿ä¼šè¢«é€åˆ°å¤„åœ¨å…¶ä»–çº¿ç¨‹çš„ <code>TurboFan</code> ä¼˜åŒ–ç¨‹åºä¸­ä½œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-7516fbc0d7b31bc1d92208fe6591a6e2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-7516fbc0d7b31bc1d92208fe6591a6e2_b.jpg\"/></figure><p>å½“ä¼˜åŒ–ç¨‹åºè¿›è¡Œæ—¶ï¼ŒV8 ç»§ç»­æ‰§è¡Œå­—èŠ‚ç ã€‚åœ¨æŸä¸ªæ—¶åˆ»ï¼Œä¼˜åŒ–ç¨‹åºç”Ÿæˆå¯æ‰§è¡Œä»£ç åï¼Œæµç¨‹ä¼šæ¥ç€æ‰§è¡Œä¸‹å»ã€‚</p><p>åŒæ ·ï¼ŒSpiderMonkey ä¹Ÿæ˜¯åœ¨è§£é‡Šå™¨ä¸­å¼€å§‹æ‰§è¡Œå­—èŠ‚ç ã€‚ä½†æ˜¯å®ƒæœ‰ <code>Baseline</code> å±‚ï¼Œhot ä»£ç ä¼šè¢«é€åˆ°è¿™é‡Œã€‚ä¸€æ—¦ <code>Baseline</code> ç¼–è¯‘å™¨ç”Ÿæˆäº† <code>Baseline</code> ä»£ç ï¼Œæµç¨‹ä¼šæ¥ç€æ‰§è¡Œä¸‹å»ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-e9a85bd81431941877b50b091691362f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-e9a85bd81431941877b50b091691362f_b.jpg\"/></figure><p><code>Baseline</code> ä»£ç è¿è¡Œä¸€æ®µæ—¶é—´åï¼ŒSpiderMonkey æœ€ç»ˆä¼šå¯åŠ¨ <code>IonMonkey frontend</code> å’Œ ä¼˜åŒ–ç¨‹åºï¼ˆç±»ä¼¼äº V8ï¼‰ã€‚IonMonkey åœ¨ä¼˜åŒ–æ—¶ï¼Œ<code>Baseline</code> ä¹Ÿä¼šä¿æŒç€è¿è¡ŒçŠ¶æ€ã€‚å½“ä¼˜åŒ–å®Œæˆåï¼Œå·²ä¼˜åŒ–çš„ä»£ç å°†å–ä»£ <code>Baseline</code> ä»£ç è¢«æ‰§è¡Œã€‚</p><p>Chakra çš„æ¶æ„å’Œ SpiderMonkey å¾ˆç›¸ä¼¼ã€‚Chakra å°è¯•å¹¶è¡Œåšå¾ˆå¤šäº‹æƒ…åŒæ—¶åˆä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚Chakra ä¼šå°†å­—èŠ‚ç å’Œç¼–è¯‘å™¨å¯èƒ½éœ€è¦çš„åˆ†ææ•°æ®å¤åˆ¶å‡ºæ¥ï¼Œå¹¶å‘å¾€ç¼–è¯‘å™¨ä¸“ç”¨è¿›ç¨‹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a94ab728ec2e4579f84061a6bf8f5552_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-a94ab728ec2e4579f84061a6bf8f5552_b.jpg\"/></figure><p>å½“ä»£ç å‡†å¤‡å¦¥å½“åï¼Œå¼•æ“å¼€å§‹æ‰§è¡Œ SimpleJIT ä»£ç ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºå¤åˆ¶æ‰€åœç•™çš„æ—¶é—´è¿œè¿œå°äºç¼–è¯‘å™¨ï¼ˆ ç¼–è¯‘å™¨ frontendï¼‰æ‰€ç”¨çš„æ—¶é—´ã€‚ç¼ºç‚¹å°±æ˜¯ï¼Œè¿™ç§å¯å‘å¼å¤åˆ¶ï¼ˆcopy heuristicï¼‰ä¼šä½¿å¾—æŸç§ä¼˜åŒ–æ‰€å¿…é¡»çš„ä¿¡æ¯ä¸¢å¤±ï¼Œå› æ­¤è¿™æ˜¯åœ¨ç”¨ä»£ç è´¨é‡æ¢å–æ—¶é—´ã€‚</p><p>åœ¨ JavaScriptCoreï¼Œæ‰€æœ‰çš„ä¼˜åŒ–ç¼–è¯‘å™¨å’Œä¸»çº¿ç¨‹å¹¶å‘è¿è¡Œï¼›ä¸»çº¿ç¨‹åªæ˜¯è§¦å‘äº†å¦ä¸€ä¸ªçº¿ç¨‹çš„ç¼–è¯‘ä»»åŠ¡ã€‚ç„¶åç¼–è¯‘å™¨é€šè¿‡å¤æ‚çš„åŠ é”ä»ä¸»çº¿ç¨‹è·å–åˆ†ææ•°æ®ï¼ˆprofiling dataï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-91ad0be9899345ce5689a41678d97b6c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-91ad0be9899345ce5689a41678d97b6c_b.jpg\"/></figure><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å‡å°‘äº†å›  JavaScript ä¼˜åŒ–å¼•å‘çš„éº»çƒ¦ã€‚ç¼ºç‚¹å°±æ˜¯éœ€è¦å¤„ç†å¤æ‚çš„å¤šçº¿ç¨‹é—®é¢˜å’Œå„ç§æ“ä½œæ‰€å¸¦æ¥çš„åŠ é”æˆæœ¬ã€‚</p><p>æˆ‘ä»¬è®¨è®ºäº†å¿«é€Ÿç”Ÿæˆä»£ç ï¼Œä¹Ÿè®¨è®ºäº†ç”Ÿæˆå¿«é€Ÿçš„ä»£ç ã€‚ä½†æ˜¯ï¼Œè¿˜è¦æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šå†…å­˜çš„ä½¿ç”¨ï¼ä¸ºäº†è§£é‡Šè¿™ä¸ªï¼Œè¿™é‡Œæœ‰ä¸ªä¸¤æ•°å­—ç›¸åŠ çš„ä¾‹å­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">x</span> <span class=\"o\">+</span> <span class=\"nx\">y</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">);</span>\n</code></pre></div><p>ä»¥ä¸‹æ˜¯ V8 çš„ Ignition ç¼–è¯‘å™¨ç”Ÿæˆçš„å­—èŠ‚ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">StackCheck</span>\n<span class=\"nx\">Ldar</span> <span class=\"nx\">a1</span>\n<span class=\"nx\">Add</span> <span class=\"nx\">a0</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"nx\">Return</span>\n</code></pre></div><p>ä¸è¦åœ¨æ„å­—èŠ‚ç çš„ç»†èŠ‚ï¼Œé‡ç‚¹æ˜¯çŸ¥é“å®ƒåªæœ‰ 4 ä¸ªæŒ‡ä»¤ï¼</p><p>å½“ä»£ç ç¼–ç¨‹ hot æ—¶ï¼ŒTurboFan ä¼šç”Ÿæˆä»¥ä¸‹é«˜åº¦ä¼˜åŒ–è¿‡çš„æœºå™¨ç ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">leaq</span> <span class=\"nx\">rcx</span><span class=\"p\">,[</span><span class=\"nx\">rip</span><span class=\"o\">+</span><span class=\"mh\">0x0</span><span class=\"p\">]</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rcx</span><span class=\"p\">,[</span><span class=\"nx\">rcx</span><span class=\"o\">-</span><span class=\"mh\">0x37</span><span class=\"p\">]</span>\n<span class=\"nx\">testb</span> <span class=\"p\">[</span><span class=\"nx\">rcx</span><span class=\"o\">+</span><span class=\"mh\">0xf</span><span class=\"p\">],</span><span class=\"mh\">0x1</span>\n<span class=\"nx\">jnz</span> <span class=\"nx\">CompileLazyDeoptimizedCode</span>\n<span class=\"nx\">push</span> <span class=\"nx\">rbp</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rbp</span><span class=\"p\">,</span><span class=\"nx\">rsp</span>\n<span class=\"nx\">push</span> <span class=\"nx\">rsi</span>\n<span class=\"nx\">push</span> <span class=\"nx\">rdi</span>\n<span class=\"nx\">cmpq</span> <span class=\"nx\">rsp</span><span class=\"p\">,[</span><span class=\"nx\">r13</span><span class=\"o\">+</span><span class=\"mh\">0xe88</span><span class=\"p\">]</span>\n<span class=\"nx\">jna</span> <span class=\"nx\">StackOverflow</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rax</span><span class=\"p\">,[</span><span class=\"nx\">rbp</span><span class=\"o\">+</span><span class=\"mh\">0x18</span><span class=\"p\">]</span>\n<span class=\"nx\">test</span> <span class=\"nx\">al</span><span class=\"p\">,</span><span class=\"mh\">0x1</span>\n<span class=\"nx\">jnz</span> <span class=\"nx\">Deoptimize</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rbx</span><span class=\"p\">,[</span><span class=\"nx\">rbp</span><span class=\"o\">+</span><span class=\"mh\">0x10</span><span class=\"p\">]</span>\n<span class=\"nx\">testb</span> <span class=\"nx\">rbx</span><span class=\"p\">,</span><span class=\"mh\">0x1</span>\n<span class=\"nx\">jnz</span> <span class=\"nx\">Deoptimize</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rdx</span><span class=\"p\">,</span><span class=\"nx\">rbx</span>\n<span class=\"nx\">shrq</span> <span class=\"nx\">rdx</span><span class=\"p\">,</span> <span class=\"mi\">32</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rcx</span><span class=\"p\">,</span><span class=\"nx\">rax</span>\n<span class=\"nx\">shrq</span> <span class=\"nx\">rcx</span><span class=\"p\">,</span> <span class=\"mi\">32</span>\n<span class=\"nx\">addl</span> <span class=\"nx\">rdx</span><span class=\"p\">,</span><span class=\"nx\">rcx</span>\n<span class=\"nx\">jo</span> <span class=\"nx\">Deoptimize</span>\n<span class=\"nx\">shlq</span> <span class=\"nx\">rdx</span><span class=\"p\">,</span> <span class=\"mi\">32</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rax</span><span class=\"p\">,</span><span class=\"nx\">rdx</span>\n<span class=\"nx\">movq</span> <span class=\"nx\">rsp</span><span class=\"p\">,</span><span class=\"nx\">rbp</span>\n<span class=\"nx\">pop</span> <span class=\"nx\">rbp</span>\n<span class=\"nx\">ret</span> <span class=\"mh\">0x18</span>\n</code></pre></div><p>å’Œå­—èŠ‚ç ç›¸æ¯”è¾ƒï¼Œè¿™é‡Œçš„ä»£ç ä¼šæ˜¾å¾—å¾ˆå¤šï¼é€šå¸¸æ¥è¯´ï¼Œå­—èŠ‚ç ä¼šæ¯”æœºå™¨ç ç´§å‡‘å¾—å¤šï¼Œå°¤å…¶å¯¹æ¯”é«˜åº¦ä¼˜åŒ–è¿‡çš„æœºå™¨ç ã€‚å¦ä¸€æ–¹é¢ï¼Œå­—èŠ‚ç éœ€è¦è§£é‡Šå™¨æ¥è¿è¡Œï¼Œè€Œä¼˜åŒ–è¿‡çš„ä»£ç åˆ™å¯ä»¥è¢«å¤„ç†å™¨ç›´æ¥æ‰§è¡Œã€‚</p><p>è¿™æ˜¯ JavaScript å¼•æ“ä¸ã€Œä¼˜åŒ–ä¸€åˆ‡ã€çš„åŸå› ä¹‹ä¸€ï¼ˆä»…ä¼˜åŒ– ã€Œhot functionã€ï¼‰ã€‚æ­£å¦‚æˆ‘ä»¬æ—©å…ˆçœ‹åˆ°çš„ï¼Œç”Ÿæˆä¼˜åŒ–è¿‡çš„æœºå™¨ç ä¼šç”¨å¾ˆé•¿çš„æ—¶é—´ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬åˆšæ‰ä¹ŸçŸ¥é“äº†ä¼˜åŒ–è¿‡çš„æœºå™¨ç ä¼šå ç”¨ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-7062fcda99fe7eea61220460b7106515_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-7062fcda99fe7eea61220460b7106515_b.jpg\"/></figure><h2>Optimizing prototype property access</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/shapes-ics%23optimizing-property-access\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å…ˆå‰çš„æ–‡ç« </a>é˜è¿°äº† JavaScript å¼•æ“ä½¿ç”¨ Shapes å’Œ Inline Caches ä¼˜åŒ–å¯¹è±¡å±æ€§çš„è®¿é—®ã€‚å†æ¬¡è¯´æ˜ï¼Œå¼•æ“å°†å¯¹è±¡çš„ Shape å’Œå¯¹è±¡çš„å€¼åˆ†å¼€å­˜å‚¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-27eb85d2c68fb606e64aebe861ca351b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-27eb85d2c68fb606e64aebe861ca351b_b.jpg\"/></figure><p>ç»“åˆ Shapes å’Œ Inline Caches å¯ä»¥åŠ å¿«ä»£ç ä¸­åŒä¸€ä½ç½®çš„å±æ€§é‡å¤æ€§è®¿é—®ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1c91ac23d7062ba313c122374b20f74c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-1c91ac23d7062ba313c122374b20f74c_b.jpg\"/></figure><h3>Classes and prototype-based programming</h3><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•å¿«é€Ÿè®¿é—® JavaScript å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ JavaScript æœ€è¿‘æ–°å¢çš„ç‰¹æ€§ï¼šç±»ã€‚ä¸‹é¢æ˜¯ JavaScript ä¸­ç±»çš„è¯­æ³•ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Bar</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">x</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"nx\">getX</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>çœ‹ä¼¼æ˜¯ä¸ªæ–°æ¦‚å¿µï¼Œå…¶å®å°±æ˜¯åŸºäºåŸå‹çš„è¯­æ³•ç³–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">x</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">Bar</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">getX</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"nx\">getX</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span>\n<span class=\"p\">};</span>\n</code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç»™ <code>Bar.prototype</code> è¿™ä¸ªå¯¹è±¡æ·»åŠ å±æ€§ <code>getX</code>ï¼Œè¿™å’Œå…¶å®ƒæ™®é€šå¯¹è±¡æ·»åŠ å±æ€§æ²¡æœ‰åŒºåˆ«ï¼Œå› ä¸ºåœ¨ JavaScriptä¸­ï¼Œ åŸå‹ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼åƒ JavaScript è¿™ç§åŸºäºåŸå‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ–¹æ³•å¯ä»¥é€šè¿‡åŸå‹å…±äº«ï¼Œè€Œå­—æ®µåˆ™å­˜å‚¨åœ¨å®ä¾‹ä¸­ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹é€šè¿‡ Bar åˆ›å»ºå®ä¾‹ foo ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">foo</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n</code></pre></div><p>åˆ›å»ºå‡ºæ¥çš„å®ä¾‹ï¼ˆfooï¼‰æ‹¥æœ‰ä¸€ä¸ªåªåŒ…å«å±æ€§ <code>&#39;x&#39;</code> çš„ shapeã€‚foo çš„åŸå‹æŒ‡å‘ <code>Bar.prototype</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1f3697648c446b5e95fc944c20f242c8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-1f3697648c446b5e95fc944c20f242c8_b.jpg\"/></figure><p><code>Bar.prototype</code> ä¹Ÿæœ‰å±äºè‡ªå·±çš„ shapeï¼Œå®ƒåŒ…å«ä¸€ä¸ª <code>getX</code> å±æ€§ï¼Œè¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä¸ªè¿”å› <code>this.x</code> çš„å‡½æ•°ï¼ˆ<code>getX</code>ï¼‰ã€‚<code>Bar.prototype</code> çš„åŸå‹æ˜¯ <code>Object.prototype</code>ã€‚<code>Object.prototype</code> æ˜¯åŸå‹é“¾çš„æ ¹æºï¼Œå› æ­¤å®ƒçš„åŸå‹æ˜¯ <code>null</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-564867ee7e672fc40c3d80d8df7dd5dd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-564867ee7e672fc40c3d80d8df7dd5dd_b.jpg\"/></figure><p>å¦‚æœä½ ç”¨åŒä¸€ä¸ªç±»åˆåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå®ä¾‹å°†å…±äº« shapeï¼Œä¸¤ä¸ªå®ä¾‹ä¹Ÿä¼šæŒ‡å‘åŒä¸€ä¸ª <code>Bar.prototype</code>ã€‚</p><h3>Prototype property access</h3><p>okï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å®šä¹‰ä¸€ä¸ªç±»å¹¶ç”¨ç±»åˆ›å»ºå®ä¾‹çš„è¿‡ç¨‹ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨å®ä¾‹ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Bar</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">x</span><span class=\"p\">;</span> <span class=\"p\">}</span>\n    <span class=\"nx\">getX</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span> <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">foo</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">();</span>\n<span class=\"c1\">//        ^^^^^^^^^^\n</span></code></pre></div><p>ä½ å¯ä»¥è®¤ä¸ºæ–¹æ³•çš„è°ƒç”¨åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">();</span>\n\n<span class=\"c1\">// is actually two steps:\n</span><span class=\"c1\"></span>\n<span class=\"k\">const</span> <span class=\"nx\">$getX</span> <span class=\"o\">=</span> <span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">;</span>\n<span class=\"k\">const</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">$getX</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"nx\">foo</span><span class=\"p\">);</span>\n</code></pre></div><p>æ­¥éª¤ 1ï¼šåŠ è½½æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªä¸è¿‡æ˜¯åŸå‹ä¸Šçš„å±æ€§ï¼ˆè€Œå®ƒæ°å¥½æ˜¯ä¸ªå‡½æ•°ï¼‰ã€‚æ­¥éª¤ 2ï¼šç”¨å®ä¾‹å»è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆé‡æ–°ç»‘å®š <code>this</code>ï¼‰ã€‚å…ˆçœ‹æ­¥éª¤ 1ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-ca8090aaf71640c2cfeb6f8e11aee973_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-ca8090aaf71640c2cfeb6f8e11aee973_b.jpg\"/></figure><p>å¼€å§‹æ—¶ï¼Œå¼•æ“ä»å®ä¾‹ foo ä¸ŠæŸ¥æ‰¾å¹¶å‘ç° foo çš„ shape ä¸Šæ²¡æœ‰ <code>getX</code> å±æ€§ï¼Œäºæ˜¯å®ƒä¸å¾—ä¸æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ã€‚åˆ°è¾¾ <code>Bar.prototype</code> åï¼Œå¼€å§‹æŸ¥æ‰¾å®ƒçš„ shape å¹¶æ‰¾åˆ°äº† <code>getX</code> å±æ€§ã€‚ç„¶åæ ¹æ® <code>getX</code> çš„å±æ€§ä¿¡æ¯ï¼ˆOffsetï¼š0ï¼‰åœ¨ <code>Bar.prototype</code> ä¸Šæ‰¾åˆ°äº† <code>getX</code> å‡½æ•°ã€‚</p><p>JavaScript çš„çµæ´»æ€§ä½¿å¾—åŸå‹é“¾å¯èƒ½ä¼šçªå˜ï¼Œä¾‹å¦‚ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">foo</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n<span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">();</span>\n<span class=\"c1\">// â†’ true\n</span><span class=\"c1\"></span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">setPrototypeOf</span><span class=\"p\">(</span><span class=\"nx\">foo</span><span class=\"p\">,</span> <span class=\"kc\">null</span><span class=\"p\">);</span>\n<span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">();</span>\n<span class=\"c1\">// â†’ Uncaught TypeError: foo.getX is not a function\n</span></code></pre></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>foo.getX()</code> è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½ä¼šæœ‰ä¸åŒçš„å«ä¹‰ï¼Œä¸åŒçš„ç»“æœã€‚æ‰€ä»¥è¯´ï¼Œå°½ç®¡åŸå‹åœ¨ JavaScript ä¸­åªæ˜¯ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯æå‡åŸå‹å±æ€§çš„è®¿é—®é€Ÿåº¦ä¾ç„¶æ¯”å¸¸è§„å¯¹è±¡æ›´å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒåŸå‹å±æ€§çš„åŠ è½½æ˜¯ä¸ªéå¸¸é¢‘ç¹çš„æ“ä½œï¼šæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šå»åŠ è½½å±æ€§ï¼</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Bar</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">x</span><span class=\"p\">;</span> <span class=\"p\">}</span>\n    <span class=\"nx\">getX</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span> <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">foo</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">();</span>\n<span class=\"c1\">//        ^^^^^^^^^^\n</span></code></pre></div><p>ä¹‹å‰ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä½¿ç”¨ Shapes å’Œ ICs ä¼˜åŒ–å¸¸è§„å¯¹è±¡çš„å±æ€§è®¿é—®ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½å¦ä½¿ç”¨ç›¸åŒçš„ç­–ç•¥å»ä¼˜åŒ–åŸå‹å±æ€§çš„é‡å¤æ€§è®¿é—®å‘¢ï¼Ÿä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å±æ€§æ˜¯å¦‚ä½•åŠ è½½çš„ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4181ce5836e1a042cce5bae669868cd6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-4181ce5836e1a042cce5bae669868cd6_b.jpg\"/></figure><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œä¸ºäº†æé«˜é‡å¤åŠ è½½çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸‰ä»¶äº‹ï¼š</p><ol><li>foo çš„ shape ä¸åŒ…å« <code>getX</code> ä¸”æ²¡æœ‰æ”¹å˜è¿‡ã€‚è¿™æ„å‘³ç€ foo æ²¡æœ‰æ·»åŠ ã€åˆ é™¤å±æ€§ï¼Œæˆ–æ”¹å˜å±æ€§ç‰¹æ€§ã€‚</li><li>foo çš„åŸå‹ä¾ç„¶æ˜¯ <code>Bar.prototype</code>ã€‚è¿™æ„å‘³ç€ï¼Œfoo çš„åŸå‹æ²¡æœ‰é€šè¿‡ <code>Object.setPrototypeOf()</code> æˆ– <code>__proto__</code> çš„æ–¹å¼æ”¹å˜è¿‡ã€‚</li><li><code>Bar.prototype</code> çš„ shape åŒ…å« <code>getX</code> ä¸”æ²¡æœ‰æ”¹å˜è¿‡ã€‚è¿™æ„å‘³ç€ <code>Bar.prototype</code> æ²¡æœ‰æ·»åŠ ã€åˆ é™¤å±æ€§ï¼Œæˆ–æ”¹å˜å±æ€§ç‰¹æ€§ã€‚</li></ol><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ£€æŸ¥ 1 éå®ä¾‹æœ¬èº«ï¼Œè¿˜æœ‰å› æ¯å¢åŠ ä¸€ä¸ªåŸå‹å°±å°±è¦å¢åŠ çš„ 2 éæ£€æŸ¥ç›´åˆ°æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„å±æ€§ã€‚<code>1+2N</code>ï¼ˆN è¡¨ç¤ºåŸå‹é“¾ä¸Šç›´åˆ°æ‰¾åˆ°å­˜åœ¨å±æ€§çš„åŸå‹çš„åŸå‹æ•°é‡ï¼‰ éçš„æ£€æŸ¥çœ‹ä¸Šå»è¿˜ä¸æ˜¯ç‰¹åˆ«ç³Ÿç³•ï¼Œå› ä¸ºè¿™æ—¶çš„åŸå‹é“¾è¿˜æ¯”è¾ƒçŸ­ â€”â€” ä½†æ˜¯å¼•æ“ä¼šç»å¸¸å¤„ç†æœ‰ç€å¾ˆé•¿åŸå‹é“¾çš„å¯¹è±¡ï¼Œå°±æ¯”å¦‚å¸¸è§çš„ DOM ç±»ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">anchor</span> <span class=\"o\">=</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">createElement</span><span class=\"p\">(</span><span class=\"s1\">&#39;a&#39;</span><span class=\"p\">);</span>\n<span class=\"c1\">// â†’ HTMLAnchorElement\n</span><span class=\"c1\"></span>\n<span class=\"k\">const</span> <span class=\"nx\">title</span> <span class=\"o\">=</span> <span class=\"nx\">anchor</span><span class=\"p\">.</span><span class=\"nx\">getAttribute</span><span class=\"p\">(</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">);</span>\n</code></pre></div><p>ç°æœ‰ä¸ª <code>HTMLAnchorElement</code> å¹¶è°ƒç”¨ <code>getAttribute()</code> æ–¹æ³•ã€‚è¿™ç®€å•çš„ anchor å…ƒç´ æ¶‰åŠåˆ° 6 ä¸ªåŸå‹ï¼<code>getAttribute()</code> ä¸æ˜¯ <code>HTMLAnchorElement</code> åŸå‹ä¸Šçš„æ–¹æ³•ï¼Œè€Œæ˜¯åŸå‹é“¾ä¸Šé è¿‘é¡¶éƒ¨çš„åŸå‹ä¸Šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-fe72a860d2834e45d64ab132812a4ae7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-fe72a860d2834e45d64ab132812a4ae7_b.jpg\"/></figure><p><code>getAttribute()</code> æ˜¯åœ¨ <code>Element.prototype</code> ä¸Šå‘ç°çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ¯æ¬¡è°ƒç”¨ <code>anchor.getAttribute()</code> æ—¶ï¼Œéƒ½éœ€è¦åšä»¥ä¸‹è¿™äº›äº‹ï¼š</p><ol><li>æ£€æµ‹åˆ° <code>getAttribute</code> ä¸å­˜åœ¨äº <code>anchor</code> å¯¹è±¡æœ¬èº«;</li><li>æ£€æµ‹åˆ° <code>anchor</code> çš„åŸå‹æ˜¯ <code>HTMLAnchorElement.prototype</code>;</li><li>ç¡®è®¤æ²¡æœ‰ <code>getAttribute</code> å±æ€§ï¼›</li><li>æ£€æµ‹åˆ°ä¸‹ä¸€ä¸ªåŸå‹æ˜¯ <code>HTMLElement.prototype</code>;</li><li>ç¡®è®¤æ²¡æœ‰ <code>getAttribute</code> å±æ€§ï¼›</li><li>ç»§ç»­æ£€æµ‹ä¸‹ä¸€ä¸ªåŸå‹ <code>Element.prototype</code>;</li><li>æ‰¾åˆ° <code>getAttribute</code>ã€‚</li></ol><p>ä¸€å…±éœ€è¦ 7 æ¬¡æ£€æµ‹ï¼è€Œè¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œäºæ˜¯å¼•æ“æƒ³æ–¹è®¾æ³•å»å‡å°‘å±æ€§ï¼ˆåŸå‹ä¸Šï¼‰åŠ è½½æ—¶çš„æ£€æŸ¥æ¬¡æ•°ã€‚</p><p>å›åˆ°æ›´æ—©çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬ä» foo è®¿é—® <code>getX</code> æ—¶ï¼Œå…±åšäº† 3 æ¬¡æ£€æŸ¥ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Bar</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">x</span><span class=\"p\">;</span> <span class=\"p\">}</span>\n    <span class=\"nx\">getX</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span> <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">foo</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">$getX</span> <span class=\"o\">=</span> <span class=\"nx\">foo</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">;</span>\n</code></pre></div><p>åœ¨æŸ¥æ‰¾å±æ€§çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç‰µæ¶‰åˆ°çš„åŸå‹éƒ½éœ€è¦åšç¼ºå¤±æ£€æŸ¥ï¼ˆç¡®è®¤å±æ€§æ˜¯å¦å­˜åœ¨ï¼‰ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåœ¨å±æ€§ç¡®è®¤çš„æ­¥éª¤é‡ŒåŒæ—¶æ£€æµ‹åŸå‹é“¾ï¼Œé‚£å°†ä¼šå‡å°‘æ€»çš„æ£€æŸ¥æ¬¡æ•°ã€‚å¼•æ“ä¹Ÿæ­£æ˜¯è¿™ä¹ˆåšçš„ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-64be0b127e38187ea944d0c1fab69963_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-64be0b127e38187ea944d0c1fab69963_b.jpg\"/></figure><p>æ¯ä¸ª shape éƒ½æŒ‡å‘äº†åŸå‹ï¼Œè¿™æ„å‘³ç€ foo çš„åŸå‹æ”¹å˜æ—¶ï¼Œå¼•æ“ä¼šè‡ªåŠ¨è¿‡æ¸¡åˆ°æ–°çš„ shapeã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥å¯¹è±¡çš„ shape å°±å¯ä»¥åŒæ—¶æ£€æµ‹å±æ€§æ˜¯å¦å­˜åœ¨ä»¥åŠåŸå‹é“¾çš„å¯¼å‘ã€‚</p><p>é‰´äºæ­¤ï¼Œç”±äºæ£€æŸ¥çš„æ¬¡æ•°ä» <code>1+2N</code> é™ä½åˆ° <code>1+N</code>ï¼Œæ‰€ä»¥åŸå‹ä¸Šå±æ€§çš„è®¿é—®é€Ÿåº¦ä¹Ÿå˜å¿«äº†ã€‚ç”±äºåœ¨åŸå‹é“¾ä¸ŠæŸ¥æ‰¾å±æ€§çš„æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œæ‰€ä»¥ä¾ç„¶è¿˜æ˜¯å¾ˆè€—æ—¶çš„ã€‚å¼•æ“ä½¿ç”¨äº†ä¸åŒçš„æ–¹æ³•è®©æ£€æŸ¥çš„æ¬¡æ•°è¶‹äºå¸¸é‡ï¼Œå°¤å…¶æ˜¯åŒä¸€å±æ€§çš„è¿ç»­åŠ è½½ï¼ˆè®¿é—®ï¼‰ã€‚</p><h3>Validity cells</h3><p>ä¸ºæ­¤ï¼ŒV8 ç‰¹åˆ«å¤„ç†äº†åŸå‹çš„ shapesã€‚æ¯ä¸ªåŸå‹éƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ shapeï¼Œè¿™ä¸ª shape ä¸ä¼šè¢«å…¶å®ƒçš„å¯¹è±¡å…±äº«ï¼ˆç‰¹åˆ«æ˜¯å…¶å®ƒçš„åŸå‹å¯¹è±¡ï¼‰ï¼Œæ¯ä¸€ä¸ªåŸå‹çš„ shape éƒ½æœ‰ä¸ä¹‹å…³è”çš„ <code>ValidityCell</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-c6784c46f4009039bab3d8000418e6e8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-c6784c46f4009039bab3d8000418e6e8_b.jpg\"/></figure><p>å¦‚æœä¸ä¹‹å…³è”çš„åŸå‹è¢«ä¿®æ”¹ï¼Œæˆ–è¯¥åŸå‹çš„ä¸Šæ¸¸ï¼ˆåŸå‹çš„åŸå‹ï¼ŒåŸå‹çš„åŸå‹çš„åŸå‹â€¦â€¦ï¼‰è¢«ä¿®æ”¹ï¼Œ<code>ValidityCell</code> éƒ½ä¼šè¢«æ ‡è®°ä¸ºæ— æ•ˆã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯åˆ°åº•æ€ä¹ˆä¸€å›äº‹ï¼Ÿ</p><p>ä¸ºäº†åŠ å¿«åŸå‹ä¸Šåç»­çš„å±æ€§åŠ è½½ï¼ŒV8 ä½¿ç”¨ ICs ä¿å­˜ç€ 4 ä¸ªå­—æ®µï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-d558e2681585822defc4e0d6c43968f5_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-d558e2681585822defc4e0d6c43968f5_b.jpg\"/></figure><p>ä»£ç ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼ŒICs å¼€å§‹å·¥ä½œäº†ï¼Œå®ƒè¦ç¼“å­˜å±æ€§åœ¨åŸå‹ä¸Šçš„åç§»é‡ ã€Œ<code>Offset</code>ã€ï¼Œå±æ€§æ‰€åœ¨çš„åŸå‹ ã€Œ<code>Prototype</code>ã€ï¼ˆæœ¬ä¾‹ä¸­çš„ <code>Bar.prototype</code>ï¼‰ï¼Œå®ä¾‹çš„ shape ã€ŒShapeã€ï¼ˆæœ¬ä¾‹ä¸­ foo çš„ shapeï¼‰,è¿˜æœ‰å°±æ˜¯ä¸åŸå‹çš„ shape ç›¸å…³è”çš„ <code>ValidityCell</code> ã€Œ<code>ValidityCell</code>ã€ï¼Œè¿™ä¸ªåŸå‹æ˜¯å®ä¾‹ shape ç›´æ¥é“¾æ¥çš„é‚£ä¸ªåŸå‹ï¼ˆæœ¬ä¾‹ä¸­çš„ <code>Bar.prototype</code>ï¼‰ã€‚</p><p>è‹¥åœ¨ä¸‹ä¸€æ¬¡ ICs å‘½ä¸­æ—¶ï¼Œå¼•æ“ä¼šæ£€æŸ¥ shape ï¼ˆå®ä¾‹çš„ shapeï¼‰å’Œ <code>ValidityCell</code>ã€‚å¦‚æœè¿˜æœ‰æ•ˆï¼Œå¼•æ“ä¼šç›´æ¥ä» ICs ä¸­æå–ä¿¡æ¯ï¼Œæ ¹æ® <code>Prototype</code> å’Œ <code>Offset</code> å­—æ®µè·å–å±æ€§ä¿¡æ¯ï¼Œè¿™æ ·å°±è·³è¿‡äº†ä¹‹å‰ç¹ççš„æŸ¥æ‰¾æ­¥éª¤ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-0c675d7223aefdc98da6151a92a01a27_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-0c675d7223aefdc98da6151a92a01a27_b.jpg\"/></figure><p>å½“åŸå‹å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸€ä¸ªæ–°çš„ shape å°†ä¼šç”Ÿæˆï¼ŒåŒæ—¶å…ˆå‰çš„ <code>ValidityCell</code> å°†ä¼šå¤±æ•ˆã€‚å› æ­¤åœ¨ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ŒICs å°†ä¸ä¼šèµ·ä½œç”¨ï¼Œæ€§èƒ½è‡ªç„¶ä¸ä¼šå¥½ã€‚</p><p>å›è¿‡å¤´æ¥å†çœ‹çœ‹ä¹‹å‰çš„ DOMï¼Œä¾‹å¦‚ï¼Œ<code>Object.prototype</code> å‘ç”Ÿå˜åŒ–åï¼Œå½±å“çš„å°†ä¸ä»…ä»…æ˜¯è‡ªèº«ï¼Œè¿˜åŒ…æ‹¬é“¾çš„ä¸‹æ¸¸ <code>EventTarget.prototype</code>ã€<code>Node.prototype</code>ã€<code>Element.prototype</code>ï¼Œç›´åˆ° <code>HTMLAnchorElement.prototype</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-792a7feebfdb1913cb655f261197c4cd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-792a7feebfdb1913cb655f261197c4cd_b.jpg\"/></figure><p>äº‹å®ä¸Šï¼Œå½“ä½ åœ¨ä»£ç ä¸­ä¿®æ”¹äº† <code>Object.prototype</code>ï¼Œå°±æ„å‘³ç€å°†æ€§èƒ½å¼ƒä¹‹ä¸é¡¾ã€‚æ‰€ä»¥ï¼Œä¸è¦é‚£æ ·åšï¼</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæœ‰ä¸€ä¸ª Bar ç±»ï¼Œå®ƒæœ‰ <code>loadX</code> æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç±»çš„å®ä¾‹è°ƒç”¨ <code>loadX</code> è‹¥å¹²æ¬¡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Bar</span> <span class=\"p\">{</span> <span class=\"cm\">/* â€¦ */</span> <span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">loadX</span><span class=\"p\">(</span><span class=\"nx\">bar</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">bar</span><span class=\"p\">.</span><span class=\"nx\">getX</span><span class=\"p\">();</span> <span class=\"c1\">// IC for &#39;getX&#39; on `Bar` instances.\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n\n<span class=\"nx\">loadX</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">));</span>\n<span class=\"nx\">loadX</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Bar</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">));</span>\n<span class=\"c1\">// IC in `loadX` now links the `ValidityCell` for\n</span><span class=\"c1\">// `Bar.prototype`.\n</span><span class=\"c1\"></span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">newMethod</span> <span class=\"o\">=</span> <span class=\"nx\">y</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">y</span><span class=\"p\">;</span>\n<span class=\"c1\">// The `ValidityCell` in the `loadX` IC is invalid\n</span><span class=\"c1\">// now, because `Object.prototype` changed.\n</span></code></pre></div><p>æ­¤æ—¶ï¼ŒICs ä¸­ä¼šè®°å½•è°ƒç”¨ <code>loadX</code> åçš„ç›¸å…³ä¿¡æ¯ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹äº† <code>Object.prototype</code> â€”â€” æ‰€æœ‰åŸå‹çš„æ ¹æº â€”â€” <code>ValidityCell</code> ä¼šè¢«æ ‡è®°ä¸ºæ— æ•ˆçš„ï¼ŒICs ä¸ä¼šåœ¨ä¸‹æ¬¡æ‰§è¡Œæ—¶å‘½ä¸­ï¼Œæ€§èƒ½ä¹Ÿä¼šå˜å¾—ç³Ÿç³•ã€‚</p><p>æ”¹å˜ <code>Object.prototype</code> æ˜¯ä¸€ä¸ªä¸å¥½çš„è¡Œä¸ºï¼Œå®ƒä½¿å¾—åŸå‹é“¾ä¸‹æ¸¸æ‰€æœ‰çš„ ICs å¤±å»ä½œç”¨ã€‚è¿™æœ‰å¦ä¸€ä¸ªä¸æ¨èçš„è¡Œä¸ºã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">foo</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"cm\">/* â€¦ */</span> <span class=\"p\">};</span>\n\n<span class=\"c1\">// Run critical code:\n</span><span class=\"c1\"></span><span class=\"nx\">someObject</span><span class=\"p\">.</span><span class=\"nx\">foo</span><span class=\"p\">();</span>\n<span class=\"c1\">// End of critical code.\n</span><span class=\"c1\"></span>\n<span class=\"k\">delete</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">foo</span><span class=\"p\">;</span>\n</code></pre></div><p>æˆ‘ä»¬æ‹“å±•äº† <code>Object.prototype</code>ï¼Œå®ƒä½¿å¾—åŸå‹é“¾ä¸‹æ¸¸çš„æ‰€æœ‰ ICs å¤±æ•ˆã€‚ç„¶åè°ƒç”¨åŸå‹ä¸Šçš„æ–°æ–¹æ³•ï¼Œå¼•æ“ä¾¿ä»å¤´å¼€å§‹ä¸ºåŸå‹å±æ€§çš„è®¿é—®æ„å»ºæ–°çš„ ICsã€‚æœ€åï¼Œæˆ‘ä»¬åˆ é™¤äº†ä¹‹å‰æ·»åŠ çš„æ–¹æ³•ã€‚</p><p>æ¸…é™¤ï¼Œå¬ç€æŒºä¸é”™çš„ï¼Œå…¶å®åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªä¼šæ›´ç³Ÿã€‚åˆ é™¤ <code>Object.prototype</code> ä¸Šçš„å±æ€§å°±æ„å‘³ç€ä¿®æ”¹ <code>Object.prototype</code>ï¼Œæ‰€æœ‰çš„ ISc å°†å†ä¸€æ¬¡å¤±æ•ˆï¼Œå¼•æ“ä¹Ÿå°†ä¼šå†ä¸€æ¬¡åœ°é‡å¤´å¼€å§‹æ„å»º ICsã€‚</p><h2>Take-aways</h2><p>æˆ‘ä»¬çŸ¥é“äº† JavaScript å¼•æ“æ˜¯å¦‚ä½•å­˜å‚¨å¯¹è±¡å’Œç±»çš„ï¼Œä¹ŸçŸ¥é“äº† Shapesã€Inline Caches å’Œ ValidityCells æ˜¯å¦‚ä½•å¸®åŠ©ä¼˜åŒ–åŸå‹æ“ä½œçš„ã€‚åŸºäºè¿™äº›çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº› JavaScript ç¼–ç¨‹æŠ€å·§æ¥æå‡æ€§èƒ½ï¼š<b>ä¸è¦ä¹±åŠ¨åŸå‹</b>ï¼ˆå¦‚æœä½ çœŸçš„ï¼ŒçœŸçš„éœ€è¦è¿™ä¹ˆå¹²ï¼Œé‚£ä¹ˆï¼Œè‡³å°‘è¦åœ¨ä»£ç è¿è¡Œå‰ï¼‰ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "JavaScript å¼•æ“", 
                    "tagLink": "https://api.zhihu.com/topics/19856435"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }
            ], 
            "comments": [
                {
                    "userName": "å¶é›¨æ£®", 
                    "userLink": "https://www.zhihu.com/people/5d2f808c757b0f4e9d38684f7a9d54be", 
                    "content": "åŸæ–‡ä¸‹é¢å·²ç»æœ‰ä¸­æ–‡ç¿»è¯‘çš„é“¾æ¥äº†", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<p>æ˜¯çš„ï¼Œå°±æ˜¯å› ä¸ºçœ‹çš„è´¹åŠ›æ‰€ä»¥æ‰è‡ªå·±ç¿»è¯‘çš„</p>", 
                            "likes": 0, 
                            "replyToAuthor": "å¶é›¨æ£®"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/85833603", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 3, 
            "title": "JavaScript å¼•æ“åŸç†ï¼ˆä¸€ï¼‰", 
            "content": "<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼<b>æŸ¥çœ‹å¤§å›¾</b></p><a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic3.zhimg.com/v2-4dad71953b4f3a5c60f78f9d15539666_180x120.jpg\" data-image-width=\"640\" data-image-height=\"512\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å¤œæ›‰å®¸</a><a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/user/57f1dbf5bf22ec00645dfc31/posts\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ›‰å®¸ çš„ä¸ªäººä¸»é¡µ - ä¸“æ  - æ˜é‡‘</a><h2>å‰è¨€</h2><p>æœ¬æ–‡æ˜¯æ ¹æ®è‡ªå·±çš„ç†è§£ç¿»è¯‘è€Œæ¥ï¼Œå¦‚æœ‰ç–‘æƒ‘å¯æŸ¥çœ‹åŸæ–‡ <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/shapes-ics\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: Shapes and Inline Caches</a>ã€‚</p><p>æœ¬æ¬¡æš‚å®šç¿»è¯‘ä¸‰ç¯‡æ–‡ç« ï¼š </p><p>1. <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/shapes-ics\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: Shapes and Inline Caches</a>(Published 14th June 2018)</p><p> 2. <a href=\"https://link.zhihu.com/?target=https%3A//mathiasbynens.be/notes/prototypes\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JavaScript engine fundamentals: optimizing prototypes</a>(Published 16th August 2018) </p><p>3. <a href=\"https://link.zhihu.com/?target=https%3A//v8.dev/blog/react-cliff\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">The story of a V8 performance cliff in React</a>(Published 28 August 2019)</p><h2>JavaScript å¼•æ“å·¥ä½œæµ</h2><p>ä¸€åˆ‡ä»ä½ å†™çš„ JavaScript ä»£ç å¼€å§‹ã€‚JavaScript å¼•æ“ä¼šè§£ææºç å¹¶å°†å…¶è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚åŸºäº ASTï¼Œè§£é‡Šå™¨ï¼ˆinterpreterï¼‰ä¼šè¿›ä¸€æ­¥åœ°ç”Ÿæˆå­—èŠ‚ç ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b0ba818f33199baff3d6d697b1e5c269_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-b0ba818f33199baff3d6d697b1e5c269_b.jpg\"/></figure><p>ä¸ºäº†èƒ½å¤Ÿè¿è¡Œå¾—æ›´å¿«ï¼Œå­—èŠ‚ç å¯èƒ½ä¼šå’Œåˆ†ææ•°æ®ï¼ˆprofiling dataï¼‰ä¸€åŒå‘ç»™ä¼˜åŒ–ç¼–è¯‘å™¨ï¼ˆthe optimizing compilerï¼‰ã€‚ä¼˜åŒ–ç¼–è¯‘å™¨ä¼šæ ¹æ®è¿™äº›åˆ†ææ•°æ®ä½œå‡ºæŸäº›å‡è®¾ä»¥æ­¤ç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„æœºå™¨ç ã€‚</p><p>å¦‚æœæŸä¸ªæ—¶åˆ»ï¼ŒæŸç§å‡è®¾è¢«è¯æ˜æ˜¯é”™è¯¯çš„ï¼Œä¼˜åŒ–ç¼–è¯‘å™¨å°†å»ä¼˜åŒ–å¹¶å›æ»šåˆ°è§£é‡Šå™¨éƒ¨åˆ†ã€‚</p><h2>JavaScript å¼•æ“ä¸­çš„è§£é‡Šå™¨/ç¼–è¯‘å™¨æµç¨‹</h2><p>ç°åœ¨æ¥å…³æ³¨ä¸‹ JavaScript ä»£ç è¢«è§£é‡Šå’Œä¼˜åŒ–çš„åœ°æ–¹ï¼Œå¹¶é‡æ¸©ä¸‹ä¸»æµ JavaScript å¼•æ“ä¹‹é—´çš„ä¸åŒä¹‹å¤„ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨è¿è¡Œ JavaScript ä»£ç è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰è§£é‡Šå™¨å’Œä¼˜åŒ–ç¼–è¯‘å™¨çš„å‚ä¸ã€‚è§£é‡Šå™¨ä¼šå¿«é€Ÿåœ°ç”Ÿæˆå°šæœªä¼˜åŒ–çš„å­—èŠ‚ç ï¼Œè€Œä¼˜åŒ–ç¼–è¯‘å™¨ä¼šè€—è´¹ä¸€äº›æ—¶é—´ç”¨æ¥ç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„æœºå™¨ç ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-b37f5c21142f4abd5423e7b064a6afb2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-b37f5c21142f4abd5423e7b064a6afb2_b.jpg\"/></figure><p>ä¸Šé¢çš„æµç¨‹å’Œ V8 åœ¨æµè§ˆå™¨å’Œ Node ç¯å¢ƒä¸‹çš„å·¥ä½œæµç¨‹åŠå…¶ç›¸ä¼¼ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-f49f95c1725c99cd9ef8bbfb6b68949a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-f49f95c1725c99cd9ef8bbfb6b68949a_b.jpg\"/></figure><p>V8 å¼•æ“çš„è§£é‡Šå™¨è¢«ç§°ä½œ Ignitionï¼Œä¸»è¦è´Ÿè´£ç”Ÿæˆå’Œæ‰§è¡Œå­—èŠ‚ç ã€‚å½“å­—èŠ‚ç è¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨ä¼šæ”¶é›†åˆ†ææ•°æ®ï¼Œè¿™äº›æ•°æ®ä¹‹åå¯èƒ½ä¼šè¢«ç”¨æ¥æå‡æ‰§è¡Œé€Ÿåº¦ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ç»å¸¸è¢«è°ƒç”¨ï¼Œå³ hotï¼Œé‚£ä¹ˆï¼Œç»è¿‡è§£é‡Šå™¨è½¬æ¢æ¥çš„å­—èŠ‚ç å’Œæ”¶é›†åˆ°çš„åˆ†ææ•°æ®ä¼šä¼ ç»™ TurboFanï¼ˆV8 çš„ä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ï¼Œè¿›ä¸€æ­¥è¢«åŠ å·¥æˆé«˜åº¦ä¼˜åŒ–çš„æœºå™¨ç ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b2958b3d925429226b4f0a50b125bf77_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-b2958b3d925429226b4f0a50b125bf77_b.jpg\"/></figure><p>SpiderMonkeyï¼ŒMozilla çš„ JavaScript å¼•æ“ï¼Œæ‹¥æœ‰ä¸¤ä¸ªä¼˜åŒ–ç¼–è¯‘å™¨ï¼ŒBaseline å’Œ IonMonkeyã€‚è§£é‡Šå™¨å°†è½¬æ¢åçš„ä»£ç ä¼ ç»™ Baseline ç¼–è¯‘å™¨ï¼ŒBaseline ç¼–è¯‘å™¨ä¼šå°†å…¶åŠ å·¥æˆéƒ¨åˆ†ä¼˜åŒ–çš„ä»£ç ã€‚å†åŠ ä¸Šæ”¶é›†åˆ°çš„åˆ†ææ•°æ®ï¼ŒIonMonkey ç¼–è¯‘å™¨å¯ä»¥ç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„ä»£ç ã€‚å¦‚æœåŸºäºå‡è®¾çš„ä¼˜åŒ–ä¸æˆç«‹ï¼ŒIonMonkey ä¼šå°†ä»£ç ä¼šæ»šåˆ° Baseline éƒ¨åˆ†ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-70fb093f0e695bee3c088741037e7b5d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-70fb093f0e695bee3c088741037e7b5d_b.jpg\"/></figure><p>Chakraï¼ŒMicrosoft çš„ JavaScript å¼•æ“ï¼Œä¹Ÿæœ‰ç€ç±»ä¼¼çš„ä¸¤ä¸ªä¼˜åŒ–ç¼–è¯‘å™¨ï¼ŒSimpleJIT å’Œ FullJITã€‚è§£é‡Šå™¨å°†è½¬æ¢åçš„ä»£ç ä¼ ç»™ SimpleJITï¼ˆJITï¼ŒJust-In-Timeï¼‰ï¼ŒSimpleJIT ä¼šå°†å…¶åŠ å·¥æˆéƒ¨åˆ†ä¼˜åŒ–çš„ä»£ç ã€‚å†åŠ ä¸Šæ”¶é›†åˆ°çš„åˆ†ææ•°æ®ï¼ŒFullJIT å¯ä»¥ç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„ä»£ç ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-f83168b6c2a97549d9f83642fe8e0d75_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-f83168b6c2a97549d9f83642fe8e0d75_b.jpg\"/></figure><p>JavaScriptCoreï¼ˆJSCï¼‰ï¼ŒApple çš„ JavaScript å¼•æ“ï¼Œæ›´æ˜¯å‘æŒ¥åˆ°äº†æè‡´ï¼Œä½¿ç”¨äº†ä¸‰ä¸ªä¸åŒçš„ä¼˜åŒ–ç¼–è¯‘å™¨ï¼ŒBaselineã€DFG å’Œ FTLã€‚ä½çº§è§£é‡Šå™¨ï¼ˆLLIntï¼‰å°†è½¬æ¢åçš„ä»£ç ä¼ ç»™ Baseline ç¼–è¯‘å™¨ï¼Œç»å…¶åŠ å·¥åä¼ ç»™ DFGï¼ˆData Flow Graphï¼‰ ç¼–è¯‘å™¨ï¼Œè¿›ä¸€æ­¥åŠ å·¥åï¼Œä¼ ç»™ FTLï¼ˆFaster Than Lightï¼‰ ç¼–è¯‘å™¨ã€‚</p><p>ä¸ºä»€ä¹ˆæœ‰äº›å¼•æ“çš„ä¼˜åŒ–ç¼–è¯‘å™¨ä¼šæ¯”å…¶ä»–å¼•æ“çš„å¤šï¼Ÿè¿™å®Œå…¨æ˜¯å–èˆé—®é¢˜ã€‚è§£é‡Šå™¨å¯ä»¥å¾ˆå¿«åœ°ç”Ÿæˆå­—èŠ‚ç ï¼Œä½†æ˜¯å­—èŠ‚ç çš„æ•ˆç‡ä¸é«˜ã€‚ä¼˜åŒ–ç¼–è¯‘å™¨è™½ç„¶ä¼šèŠ±æ›´é•¿çš„æ—¶é—´ï¼Œä½†æ˜¯ç”Ÿæˆçš„æœºå™¨ç æ›´ä¸ºé«˜æ•ˆã€‚æ˜¯æ›´å¿«åœ°å»æ‰§è¡Œä»£ç ï¼Œè¿˜æ˜¯èŠ±äº›æ—¶é—´å»æ‰§è¡Œæ›´ä¼˜çš„ä»£ç ï¼Œè¿™éƒ½æ˜¯éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚æœ‰äº›å¼•æ“æ·»åŠ å¤šç§ä¸åŒç‰¹ç‚¹ï¼ˆçœæ—¶æˆ–é«˜æ•ˆï¼‰çš„ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œè™½ç„¶è¿™ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œä½†å´å¯ä»¥å¯¹ä»¥ä¸Šçš„å–èˆæœ‰ç€æ›´ç»†ç²’åº¦åœ°æ§åˆ¶ã€‚è¿˜æœ‰ä¸€ç‚¹éœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œå†…å­˜çš„ä½¿ç”¨ã€‚</p><p>ä»¥ä¸Šåªæ˜¯å¼ºè°ƒäº†ä¸åŒ JavaScript å¼•æ“çš„è§£æå™¨/ç¼–è¯‘å™¨çš„åŒºåˆ«ã€‚æŠ›å¼€è¿™äº›ä¸è°ˆï¼Œä»æ›´é«˜çš„å±‚é¢æ¥çœ‹ï¼Œæ‰€æœ‰çš„ JavaScript å¼•æ“æœ‰ç€ç›¸åŒçš„æ¶æ„ï¼šä¸€ä¸ªè§£æå™¨å’Œä¸€äº›è§£é‡Šå™¨/ç¼–è¯‘å™¨ã€‚</p><h2>JavaScript å¯¹è±¡æ¨¡å‹</h2><p>å†æ¥çœ‹çœ‹ï¼Œåœ¨æŸäº›å…·ä½“å®ç°ä¸Šï¼ŒJavaScript å¼•æ“ä¹‹é—´è¿˜æœ‰å“ªäº›ç›¸åŒä¹‹å¤„ã€‚</p><p>ä¾‹å¦‚ï¼ŒJavaScript å¼•æ“æ˜¯å¦‚ä½•å®ç° JavaScript å¯¹è±¡æ¨¡å‹çš„ï¼Ÿå®ƒä»¬åˆæ˜¯å¦‚ä½•æå‡å¯¹è±¡å±æ€§è®¿é—®é€Ÿåº¦çš„ï¼Ÿäº‹å®è¯æ˜ï¼Œæ‰€æœ‰ä¸»æµçš„å¼•æ“åœ¨è¿™ç‚¹å®ç°ä¸Šéƒ½éå¸¸å¾—ç›¸ä¼¼ã€‚</p><p>ECMAScript è§„èŒƒæŠŠæ‰€æœ‰çš„å¯¹è±¡å®šä¹‰ä¸ºè¯å…¸ï¼Œå°†å­—ç¬¦ä¸²é”®æ˜ å°„åˆ°å±æ€§ç‰¹æ€§ï¼ˆ<a href=\"https://link.zhihu.com/?target=https%3A//tc39.es/ecma262/%23sec-property-attributes\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">property attributes</a>ï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-5c1a47f088917fc91c727abc06177306_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-5c1a47f088917fc91c727abc06177306_b.jpg\"/></figure><p>é™¤äº† <code>[[Value]]</code>ï¼Œ è§„èŒƒè¿˜å®šä¹‰äº†ä¸€ä¸‹å±æ€§ï¼š</p><ul><li><code>[[Writable]]</code> å®šä¹‰æ˜¯å¦å¯å†™ã€‚</li><li><code>[[Enumerable]]</code> å®šä¹‰æ˜¯å¦å¯æšä¸¾ã€‚</li><li><code>[[Configurable]]</code> å®šä¹‰æ˜¯å¦å¯é…ç½®ã€‚</li></ul><p><code>[[åŒä¸­æ‹¬å·]]</code> æ˜¯ç”¨æ¥æè¿°ä¸èƒ½ç›´æ¥æš´éœ²ç»™ JavaScript çš„å±æ€§ã€‚ä¸è¿‡ä½ ä¾ç„¶å¯ä»¥é€šè¿‡ <code>Object.getOwnPropertyDescriptor</code> è·å–æŸä¸ªå¯¹è±¡ä¸Šçš„ä»¥ä¸Šå±æ€§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">foo</span><span class=\"o\">:</span> <span class=\"mi\">42</span> <span class=\"p\">};</span>\n<span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">getOwnPropertyDescriptor</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">,</span> <span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">);</span>\n<span class=\"c1\">// â†’ { value: 42, writable: true, enumerable: true, configurable: true }\n</span></code></pre></div><p>okï¼Œè¿™æ˜¯ JavaScript å¦‚ä½•å®šä¹‰å¯¹è±¡çš„ã€‚é‚£ä¹ˆï¼Œæ•°ç»„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥è®¤ä¸ºæ•°ç»„æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ã€‚ä¸€ä¸ªä¸åŒç‚¹æ˜¯ï¼Œæ•°ç»„ä¼šå¯¹æ•°ç»„ç´¢å¼•ç‰¹æ®Šå¤„ç†ã€‚æ•°ç»„ç´¢å¼•æ˜¯ JavaScript è§„èŒƒä¸­çš„ä¸€ä¸ªç‰¹æ®Šæœ¯è¯­ã€‚æ•°ç»„ç´¢å¼•æ˜¯æŸä¸ªèŒƒå›´å†…çš„ä»»ä½•æœ‰æ•ˆç´¢å¼•ï¼Œå³åœ¨ 0 ï½ 2Â³Â²âˆ’2 èŒƒå›´å†…çš„ä»»ä½•ä¸€ä¸ªæ•´æ•°ã€‚</p><p>å¦ä¸€ä¸ªä¸åŒç‚¹æ˜¯ï¼Œæ•°ç»„è¿˜æœ‰ä¸€ä¸ª <code>length</code> å±æ€§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">array</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;a&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;b&#39;</span><span class=\"p\">];</span>\n<span class=\"nx\">array</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"c1\">// â†’ 2\n</span><span class=\"c1\"></span><span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;c&#39;</span><span class=\"p\">;</span>\n<span class=\"nx\">array</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"c1\">// â†’ 3\n</span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæ•°ç»„åˆ›å»ºå¥½åï¼Œ<code>&#39;length&#39;</code> å€¼ä¸º 2ã€‚å½“æˆ‘ä»¬ç»™æ•°ç»„ç´¢å¼•ä¸º 2 çš„ä½ç½®èµ‹å€¼æ—¶ï¼Œæ•°ç»„çš„ <code>&#39;length&#39;</code> ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p><p>åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„çš„å®šä¹‰å’Œå¯¹è±¡å¾ˆç›¸ä¼¼ã€‚ä¾‹å¦‚ï¼Œæ•°ç»„çš„æ‰€æœ‰çš„é”®ï¼ˆåŒ…æ‹¬æ•°ç»„ç´¢å¼•ï¼‰éƒ½æ˜¯å­—ç¬¦ä¸²è¡¨ç¤ºã€‚æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å­˜åœ¨é”®å€¼ä¸º <code>&#39;0&#39;</code> çš„åœ°æ–¹ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-83d4c3e3506edaaf415d5d4a3a267807_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-83d4c3e3506edaaf415d5d4a3a267807_b.jpg\"/></figure><p>å¦ä¸€ä¸ªå±æ€§æ˜¯ <code>&#39;length&#39;</code> å±æ€§ï¼Œè¯¥å±æ€§ä¸å¯æšä¸¾ä¸å¯é…ç½®ã€‚</p><p>ä¸€æ—¦æ•°ç»„æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ŒJavaScript ä¼šè‡ªåŠ¨æ›´æ–° <code>&#39;length&#39;</code>å±æ€§ä¸Šçš„  <code>[[Value]]</code> å€¼ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-2ee3bc1232aeec503eec8e8df1135564_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-2ee3bc1232aeec503eec8e8df1135564_b.jpg\"/></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ•°ç»„çš„è¡Œä¸ºä¹Ÿæ˜¯å’Œå¯¹è±¡éå¸¸ç›¸ä¼¼ã€‚</p><h2>ä¼˜åŒ–å±æ€§çš„è®¿é—®</h2><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“åœ¨ JavaScript ä¸­å¦‚ä½•å®šä¹‰å¯¹è±¡çš„ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ·±å…¥äº†è§£ JavaScript å¼•æ“æ˜¯å¦‚ä½•é«˜æ•ˆåœ°å¤„ç†å¯¹è±¡çš„ã€‚</p><p>å±æ€§è®¿é—®æ˜¯æœ€å¸¸è§çš„ä¸€ä¸ªæ“ä½œï¼Œå¯¹ JavaScript å¼•æ“æ¥è¯´ï¼Œæå‡è®¿é—®é€Ÿåº¦äº‹ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">foo</span><span class=\"o\">:</span> <span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">baz</span><span class=\"o\">:</span> <span class=\"s1\">&#39;qux&#39;</span><span class=\"p\">,</span>\n<span class=\"p\">};</span>\n\n<span class=\"c1\">// Here, weâ€™re accessing the property `foo` on `object`:\n</span><span class=\"c1\"></span><span class=\"nx\">doSomething</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">foo</span><span class=\"p\">);</span>\n<span class=\"c1\">//          ^^^^^^^^^^\n</span></code></pre></div><h3>å¤–å½¢ï¼ˆShapesï¼‰</h3><p>åœ¨ JavaScript ç¨‹åºä¸­ï¼Œæœ‰ç›¸åŒé”®çš„å¯¹è±¡å¾ˆå¤šï¼Œå®ƒä»¬æœ‰ç›¸åŒçš„ <code>Shape</code>ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object1</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"p\">};</span>\n<span class=\"k\">const</span> <span class=\"nx\">object2</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"p\">};</span>\n<span class=\"c1\">// `object1` and `object2` have the same shape.\n</span></code></pre></div><p>æœ‰ç€ç›¸åŒ <code>Shape</code> çš„å¯¹è±¡ï¼Œè‡ªç„¶ä¼šè®¿é—®ç›¸åŒçš„å±æ€§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">logX</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">);</span>\n    <span class=\"c1\">//          ^^^^^^^^\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">object1</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"p\">};</span>\n<span class=\"k\">const</span> <span class=\"nx\">object2</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"nx\">y</span><span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"p\">};</span>\n\n<span class=\"nx\">logX</span><span class=\"p\">(</span><span class=\"nx\">object1</span><span class=\"p\">);</span>\n<span class=\"nx\">logX</span><span class=\"p\">(</span><span class=\"nx\">object2</span><span class=\"p\">);</span>\n</code></pre></div><p>è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼ŒJavaScript å¼•æ“å¯ä»¥åŸºäº å¯¹è±¡çš„ <code>Shape</code> æ¥ä¼˜åŒ–å¯¹è±¡å±æ€§çš„è®¿é—®é€Ÿåº¦ã€‚</p><p>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªå¯¹è±¡æœ‰ xã€y å±æ€§ï¼Œä¸”ç”¨ç€å­—å…¸è¿™ç§æ•°æ®ç»“æ„ï¼šå®ƒåŒ…å«å­—ç¬¦ä¸²è¡¨ç¤ºçš„é”®ï¼Œå¹¶ä¸”é”®æŒ‡å‘å„è‡ªçš„å±æ€§ç‰¹æ€§ï¼ˆproperty attributesï¼‰ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-5c1a47f088917fc91c727abc06177306_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-5c1a47f088917fc91c727abc06177306_b.jpg\"/></figure><p>å¦‚æœè¦è®¿é—®ä¸€ä¸ªå±æ€§ï¼Œä¾‹å¦‚ <code>object.y</code>ï¼ŒJavaScript å¼•æ“ä¼šåœ¨ <code>JSObject</code> ä¸­æŸ¥æ‰¾ <code>y</code>ï¼Œç„¶ååŠ è½½å¯¹åº”çš„å±æ€§ç‰¹æ€§ï¼Œæœ€åè¿”å› <code>[[Value]]</code>ã€‚</p><p>ä½†æ˜¯åœ¨å†…å­˜ä¸­ï¼Œè¿™äº›å±æ€§ç‰¹æ€§è¦å­˜å‚¨åœ¨å“ªå„¿å‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥æŠŠå®ƒä»¬å½“ä½œ <code>JSObject</code> çš„ä¸€éƒ¨åˆ†å­˜å‚¨å—ï¼Ÿå‡è®¾ä¹‹åä¼šæœ‰æ›´å¤šçš„æ‹¥æœ‰ç›¸åŒ <code>Shape</code> çš„å¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ <code>JSObject</code> ä¸Šå­˜å‚¨ä¸€ä¸ªåŒ…å«å±æ€§åç§°å’Œå±æ€§ç‰¹æ€§çš„å®Œæ•´å­—å…¸çš„è¯ï¼Œé‚£æ˜¾ç„¶ä¼šæ˜¯ä¸€ç§æµªè´¹ã€‚å› ä¸ºæ‹¥æœ‰ç›¸åŒ <code>Shape</code> çš„å¯¹è±¡ï¼Œå®ƒä»¬çš„å±æ€§åç§°ä¼šé‡å¤ã€‚è¿™å›é€ æˆå¤§é‡é‡å¤å’Œä¸å¿…è¦çš„å†…å­˜ä½¿ç”¨ã€‚ä½œä¸ºä¼˜åŒ–ï¼Œå¼•æ“å°†å¯¹è±¡çš„ <code>Shape</code> å•ç‹¬åœ°å­˜å‚¨ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-3a5eeb521a25d5ea0038fa4e38b76d76_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-3a5eeb521a25d5ea0038fa4e38b76d76_b.jpg\"/></figure><p><code>Shape</code> åŒ…å«æ‰€æœ‰çš„å±æ€§åç§°å’Œå±æ€§ç‰¹æ€§ï¼Œé™¤äº† <code>[[Value]]</code>ã€‚ä¸è¿‡ï¼Œ<code>Shape</code> åŒ…å«äº† <code>[[Value]]</code> åœ¨ <code>JSObject</code> ä¸Šçš„åç§»é‡ï¼Œå› æ­¤ JavaScript å¼•æ“çŸ¥é“å»å“ªé‡Œæ‰¾åˆ°ç›¸åº”çš„å€¼ã€‚ æ¯ä¸ªæ‹¥æœ‰ç›¸åŒ <code>Shape</code> çš„ <code>JSObject</code> éƒ½æŒ‡å‘åŒä¸€ä¸ª <code>Shape</code> å®ä¾‹ã€‚ç°åœ¨ï¼Œæ¯ä¸ª <code>JSObject</code> åªéœ€å­˜å‚¨å¯¹è±¡çš„å€¼å³å¯ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-27eb85d2c68fb606e64aebe861ca351b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-27eb85d2c68fb606e64aebe861ca351b_b.jpg\"/></figure><p>å½“æˆ‘ä»¬æœ‰å¾ˆå¤šä¸ªå¯¹è±¡æ—¶ï¼Œå¥½å¤„ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ä¸ç®¡æœ‰å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªè¦æœ‰ç›¸åŒçš„ <code>Shape</code>ï¼Œ<code>Shape</code> å’Œå±æ€§ä¿¡æ¯åªéœ€è¦å­˜å‚¨ä¸€æ¬¡ã€‚</p><p>æ‰€æœ‰çš„ JavaScript å¼•æ“éƒ½ç”¨ Shapes æ¥ä¼˜åŒ–ï¼Œä½†å«æ³•å´ä¸åŒï¼š</p><ul><li>å­¦æœ¯è®ºæ–‡ç§°ä¹‹ä¸º Hidden Classesï¼ˆå®¹æ˜“å’Œ JavaScript ä¸­çš„ Class æ··æ·†ï¼‰</li><li>V8 ç§°ä¹‹ä¸º Mapsï¼ˆå®¹æ˜“å’Œ JavaScript ä¸­çš„ Map æ··æ·†ï¼‰</li><li>Chakra ç§°ä¹‹ä¸º Typesï¼ˆå®¹æ˜“å’Œ JavaScript ä¸­çš„åŠ¨æ€ç±»å‹ä¸ typeof æ··æ·†ï¼‰</li><li>JavaScriptCore ç§°ä¹‹ä¸º Structures</li><li>SpiderMonkey ç§°ä¹‹ä¸º Shapes</li></ul><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­ç§°ä¹‹ä¸º Shapesã€‚</p><h3>è¿‡æ¸¡é“¾ä¸æ ‘ï¼ˆTransition chains and treesï¼‰</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰äº†ä¸€ä¸ªç¡®å®šçš„ <code>Shape</code>,ç„¶ååˆæ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œè¿™ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼ŸJavaScript å¼•æ“å¦‚ä½•æ‰¾åˆ°æ”¹å˜åçš„æ–° <code>Shape</code>ï¼Ÿ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n<span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">5</span><span class=\"p\">;</span>\n<span class=\"nx\">object</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">6</span><span class=\"p\">;</span>\n</code></pre></div><p>åœ¨ JavaScript å¼•æ“ä¸­ï¼Œè¿™ç§ Shapes ç»“æ„ç§°ä¹‹ä¸ºè¿‡æ¸¡é“¾ã€‚å¦‚ä¸‹ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-3d87fd5e9abbd81384051598ac65c51b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-3d87fd5e9abbd81384051598ac65c51b_b.jpg\"/></figure><p>å¯¹è±¡å¼€å§‹æ—¶æ²¡æœ‰ä»»ä½•å±æ€§ï¼Œå› æ­¤å®ƒä¼šæŒ‡å‘ä¸€ä¸ªç©ºçš„ <code>Shape</code>ã€‚ä¸‹ä¸€æ¡è¯­å¥å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªå±æ€§ <code>&#39;x&#39;</code>ï¼Œå±æ€§å€¼ä¸º 5ï¼Œå› æ­¤å¯¹è±¡æŒ‡å‘åŒ…å«å±æ€§ <code>&#39;x&#39;</code> çš„ <code>Shape</code>ï¼Œä¸”åœ¨ <code>JSObject</code> ä¸­åç§»é‡ä¸º 0 çš„ä½ç½®æ·»åŠ  5ã€‚ä¸‹ä¸€æ¡è¯­å¥å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªå±æ€§ <code>&#39;y&#39;</code>ï¼Œå±æ€§å€¼ä¸º 5ï¼Œå› æ­¤å¯¹è±¡æŒ‡å‘åŒ…å«å±æ€§ <code>&#39;x&#39;</code> å’Œ <code>&#39;y&#39;</code> çš„ <code>Shape</code>ï¼Œä¸”åœ¨ <code>JSObject</code> ä¸­åç§»é‡ä¸º 1 çš„ä½ç½®æ·»åŠ  6ã€‚</p><blockquote> æ³¨æ„ï¼š å±æ€§çš„æ·»åŠ é¡ºåºä¼šå½±å“ <code>Shape</code>ã€‚ä¾‹å¦‚ï¼Œ<code>{x: 4, y: 5}</code> å’Œ <code>{y: 5, x: 4}</code> æœ‰ä¸åŒçš„ <code>Shape</code>ã€‚<br/> </blockquote><p>æˆ‘ä»¬æ²¡æœ‰å¿…è¦è®©æ¯ä¸ª <code>Shape</code> éƒ½å­˜å‚¨å®Œæ•´çš„å±æ€§è¡¨ã€‚ç›¸åï¼Œæ¯ä¸ª <code>Shape</code> åªéœ€è¦çŸ¥é“æ–°å¼•å…¥çš„å±æ€§å³å¯ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦åœ¨æœ€åä¸€ä¸ª <code>Shape</code> ä¸­å­˜å‚¨å±æ€§ <code>&#39;x&#39;</code> çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨é“¾çš„ä¸Šæ¸¸ä¸­è¢«æŸ¥æ‰¾åˆ°ã€‚è¦è¾¾æ­¤ç›®çš„ï¼Œæ¯ä¸ª <code>Shape</code> éƒ½ä¼šå’Œå…ˆå‰çš„ <code>Shape</code> é“¾æ¥ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-960c873169af5b76834b9c0495c2bc58_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-960c873169af5b76834b9c0495c2bc58_b.jpg\"/></figure><p>å¦‚æœä½ åœ¨ JavaScript ä»£ç ä¸­å†™äº† <code>o.x</code>ï¼ŒJavaScript å¼•æ“ä¼šæ²¿ç€è¿‡æ¸¡é“¾æŸ¥æ‰¾å±æ€§ <code>&#39;x&#39;</code>ï¼Œç›´åˆ°å‘ç°å¼•å…¥ <code>&#39;x&#39;</code> çš„ <code>Shape</code>ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæ²¡æ³•åˆ›å»ºè¿‡æ¸¡é“¾å‘¢ï¼Ÿä¾‹å¦‚ï¼Œç»™ä¸¤ä¸ªç©ºå¯¹è±¡æ·»åŠ ä¸åŒçš„å±æ€§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object1</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n<span class=\"nx\">object1</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">5</span><span class=\"p\">;</span>\n<span class=\"k\">const</span> <span class=\"nx\">object2</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n<span class=\"nx\">object2</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">6</span><span class=\"p\">;</span>\n</code></pre></div><p>è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å¾—ä¸è¿›è¡Œåˆ†æ”¯å¤„ç†ï¼Œç”¨è¿‡æ¸¡æ ‘ï¼ˆtransition treeï¼‰å–ä»£è¿‡æ¸¡é“¾ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-f7d30794cfd645de8d2f9fb0681b6037_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-f7d30794cfd645de8d2f9fb0681b6037_b.jpg\"/></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ <code>a</code>å¹¶ç»™å®ƒæ·»åŠ äº†å±æ€§ <code>&#39;x&#39;</code>ã€‚æœ€ç»ˆå¾—åˆ°ä»¥ä¸€ä¸ªåŒ…å«å•ä¸ªå€¼çš„ <code>JSObject</code>å’Œä¸¤ç§ <code>Shape</code>ï¼ˆç©ºçš„ <code>Shape</code> å’Œä»…æœ‰å±æ€§ <code>&#39;x&#39;</code> çš„ <code>Shape</code>ï¼‰ã€‚</p><p>ç¬¬äºŒä¸ªä¾‹å­ä¹Ÿæ˜¯ä»¥ä¸€ä¸ªç©ºå¯¹è±¡ <code>b</code> å¼€å§‹ï¼Œä½†æ˜¯æ·»åŠ çš„æ˜¯å±æ€§ <code>&#39;y&#39;</code>ã€‚æœ€ç»ˆå¾—åˆ°ä¸¤æ¡ <code>Shape</code> é“¾å’Œä¸‰ä¸ª <code>Shape</code>ã€‚</p><p>è¿™æ˜¯å¦æ„å‘³ç€æ€»æ˜¯ä»¥ç©º <code>Shape</code> å¼€å¤´å‘¢ï¼Ÿä¸ä¸€å®šã€‚</p><p>å¼•æ“å¯¹å·²ç»å­˜åœ¨å±æ€§çš„å¯¹è±¡å­—é¢ä¸¤åšäº†ä¼˜åŒ–ã€‚æ¥çœ‹ä¸¤ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ˜¯ä»ç©ºçš„å¯¹è±¡å¼€å§‹æ·»åŠ å±æ€§ <code>&#39;x&#39;</code>ï¼Œä¸€ä¸ªæ˜¯å·²ç»å­˜åœ¨å±æ€§ <code>&#39;x&#39;</code> çš„å¯¹è±¡å­—é¢é‡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">object1</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n<span class=\"nx\">object1</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">5</span><span class=\"p\">;</span>\n<span class=\"k\">const</span> <span class=\"nx\">object2</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"mi\">6</span> <span class=\"p\">};</span>\n</code></pre></div><p>ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»ç©ºçš„ <code>Shape</code> è¿‡æ¸¡åˆ°åŒ…å«å±æ€§ <code>&#39;x&#39;</code> çš„ <code>Shape</code>ï¼Œå°±å¦‚ä¹‹å‰æ‰€çœ‹åˆ°çš„é‚£æ ·ã€‚</p><p>å¯¹äº <code>object2</code>ï¼Œå®ƒç›´æ¥ç”ŸæˆåŒ…å«å±æ€§ <code>&#39;x&#39;</code> çš„å¯¹è±¡è€Œä¸æ˜¯ä»ç©ºå¯¹è±¡å¼€å§‹è¿‡æ¸¡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-3c15706e96421406e5194122ef1b15a4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-3c15706e96421406e5194122ef1b15a4_b.jpg\"/></figure><p>è¿™ä¸ªåŒ…å«å±æ€§ <code>&#39;x&#39;</code> çš„å¯¹è±¡ï¼Œä»¥åŒ…å« <code>&#39;x&#39;</code> çš„ <code>Shape</code> å¼€å¤´ï¼Œçœå»äº†ç©º <code>Shape</code> è¿™ä¸ªæ­¥éª¤ã€‚è‡³å°‘ V8 å’Œ SpiderMonkey æ˜¯è¿™ä¹ˆåšçš„ã€‚è¿™ç§ä¼˜åŒ–ç¼©çŸ­äº†è¿‡æ¸¡é“¾ï¼Œä½¿å¾—åˆ›å»ºå¯¹è±¡æ›´åŠ é«˜æ•ˆã€‚</p><p>Benedikt çš„æ–‡ç«  <a href=\"https://link.zhihu.com/?target=https%3A//medium.com/%40bmeurer/surprising-polymorphism-in-react-applications-63015b50abc\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">surprising polymorphism in React applications</a> è®¨è®ºäº†è¿™äº›å¾®å¦™ä¹‹å¤„æ˜¯å¦‚ä½•å½±å“åˆ°å®é™…æ€§èƒ½çš„ã€‚</p><p>è¿™æœ‰ä¸€ä¸ªæ‹¥æœ‰å±æ€§ <code>&#39;x&#39;ã€</code>&#39;y&#39;<code>ã€</code>&#39;z&#39;` çš„ä¸‰ç»´ç‚¹å¯¹è±¡çš„ä¾‹å­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">point</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n<span class=\"nx\">point</span><span class=\"p\">.</span><span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"mi\">4</span><span class=\"p\">;</span>\n<span class=\"nx\">point</span><span class=\"p\">.</span><span class=\"nx\">y</span> <span class=\"o\">=</span> <span class=\"mi\">5</span><span class=\"p\">;</span>\n<span class=\"nx\">point</span><span class=\"p\">.</span><span class=\"nx\">z</span> <span class=\"o\">=</span> <span class=\"mi\">6</span><span class=\"p\">;</span>\n</code></pre></div><p>å°±å¦‚ä¹‹å‰æ‰€å­¦åˆ°çš„ï¼Œåœ¨å†…å­˜ä¸Šï¼Œè¿™å›åˆ›å»ºæœ‰ä¸‰ä¸ª <code>Shape</code> çš„å¯¹è±¡ï¼ˆç©º <code>Shape</code> ä¸è®¡å…¥ï¼‰ã€‚è®¿é—®å¯¹è±¡çš„å±æ€§ <code>&#39;x&#39;</code>ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ç¨‹åºä¸­å†™ä¸‹äº† <code>point.x</code>ï¼ŒJavaScript å¼•æ“ä¼šé¡ºç€é“¾è¡¨ï¼šå®ƒä¼šä»åº•éƒ¨çš„ <code>Shape</code> å¼€å§‹ï¼Œä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°å‘ç°å¼•å…¥ <code>&#39;x&#39;</code> çš„é‚£ä¸ª <code>Shape</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-4fd2790d86d616a81eda2c2d1c6d23f7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-4fd2790d86d616a81eda2c2d1c6d23f7_b.jpg\"/></figure><p>å¦‚æœè¿™ç§æ“ä½œå¾ˆé¢‘ç¹ï¼Œå°±ä¼šæ˜¾å¾—å¾ˆæ…¢ï¼Œå°¤å…¶æ˜¯ä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šå±æ€§æ—¶ã€‚æ£€ç´¢åˆ°éœ€è¦çš„å±æ€§æ‰€èŠ±æ—¶é—´æ˜¯ Oï¼ˆnï¼‰ï¼Œå³çº¿æ€§çš„ã€‚ä¸ºäº†æé«˜æ£€ç´¢é€Ÿåº¦ï¼ŒJavaScript å¼•æ“åŠ å…¥äº† <code>ShapeTable</code> æ•°æ®ç»“æ„ã€‚<code>ShapeTable</code> æ˜¯ä¸ªå­—å…¸ï¼Œå®ƒå°†å±æ€§å’Œå¼•å…¥è¯¥å±æ€§çš„ <code>Shape</code> å…³è”èµ·æ¥ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-85fec2dc7849c2395e236b5f31be7019_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-85fec2dc7849c2395e236b5f31be7019_b.jpg\"/></figure><p>ä¸”æ…¢ï¼Œæˆ‘ä»¬åˆå›åˆ°äº†å­—å…¸æŸ¥æ‰¾â€¦â€¦è¿™ä¸å°±æ˜¯æˆ‘ä»¬åœ¨å¼•å…¥ Shapes ä¹‹å‰çš„æ–¹å¼å—ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬éè¦æ•´å‡ºä¸ª Shapesï¼Ÿ</p><p>åŸå› æ˜¯ Shapes å¯ä»¥å®ç°å¦ä¸€ç§ç§°ä¹‹ä¸ºå†…è”ç¼“å­˜çš„ä¼˜åŒ–ã€‚</p><h3>å†…è”ç¼“å­˜ï¼ˆInline Caches (ICs)ï¼‰</h3><p>ICs æ˜¯ JavaScript å¿«é€Ÿè¿è¡Œçš„å…³é”®å› ç´ ã€‚JavaScript å¼•æ“å¯ä»¥åˆ©ç”¨ ICs ç¼“å­˜å¯¹è±¡çš„å±æ€§ä¿¡æ¯ï¼Œä»è€Œå‡å°‘å±æ€§æŸ¥æ‰¾çš„å¼€é”€ã€‚</p><p>æœ‰ä¸ªå‡½æ•° <code>getX</code> ï¼Œæ¥å—ä¸€ä¸ªå¯¹è±¡å¹¶åŠ è½½è¯¥å¯¹è±¡ä¸Šçš„å±æ€§ <code>x</code>ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">getX</span><span class=\"p\">(</span><span class=\"nx\">o</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">o</span><span class=\"p\">.</span><span class=\"nx\">x</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>å¦‚æœæˆ‘ä»¬åœ¨ JSCï¼ˆJavaScriptCoreï¼‰ ä¸­è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¼šç”Ÿæˆä»¥ä¸‹çš„å­—èŠ‚ç ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-1c7d7e8e714d6143499603d043b98b6f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic4.zhimg.com/v2-1c7d7e8e714d6143499603d043b98b6f_b.jpg\"/></figure><p>ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼ˆ<code>get_by_id</code>ï¼‰æ˜¯ä»å‚æ•° <code>arg1</code> ä¸­åŠ è½½å±æ€§ <code>x</code>ï¼Œå¹¶å°†å…¶å€¼å­˜å‚¨åˆ° <code>loc0</code> ä¸­ã€‚ç¬¬äºŒæ¡æŒ‡ä»¤æ˜¯è¿”å› <code>loc0</code> ä¸­å­˜å‚¨çš„å€¼ã€‚</p><p>JSC è¿˜åœ¨ <code>get_by_id</code> æŒ‡ä»¤ä¸­åµŒå…¥äº†å†…è”ç¼“å­˜ï¼Œå®ƒæ˜¯ç”±ä¸¤ä¸ªæœªåˆå§‹åŒ–çš„æ’æ§½ç»„æˆã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-9ad219bf2dadbab8cb3ac05269cff018_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-9ad219bf2dadbab8cb3ac05269cff018_b.jpg\"/></figure><p>ç°åœ¨ç»™å‡½æ•° <code>getX</code> ä¼ å…¥å¯¹è±¡ <code>{ x: &#39;a&#39; }</code>ã€‚å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªåŒ…å«å±æ€§ <code>x</code> çš„ <code>Shape</code>ï¼Œè¿™ä¸ª <code>Shape</code> å­˜å‚¨äº†å±æ€§ <code>x</code> çš„åç§»é‡å’Œç‰¹æ€§ã€‚å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡Œå‡½æ•°æ—¶ï¼Œ<code>get_by_id</code> æŒ‡ä»¤ä¼šæŸ¥æ‰¾å±æ€§ <code>x</code> å¹¶æ£€ç´¢åˆ°å€¼è¢«å­˜å‚¨åœ¨åç§»é‡ä¸º <code>0</code> ä½ç½®ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-77dcd0127b51c4a4aa350f478df8e645_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-77dcd0127b51c4a4aa350f478df8e645_b.jpg\"/></figure><p>åµŒåœ¨ <code>get_by_id</code> æŒ‡ä»¤ä¸­çš„å†…è”ç¼“å­˜ä¼šè®°ä½ <code>Shape</code> å’Œå±æ€§çš„åç§»é‡ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1c91ac23d7062ba313c122374b20f74c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-1c91ac23d7062ba313c122374b20f74c_b.jpg\"/></figure><p>åœ¨ä¸‹æ¬¡å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå†…è”ç¼“å­˜ä¼šå¯¹æ¯” <code>Shape</code>ï¼Œå¦‚æœä¸ä¹‹å‰çš„ <code>Shape</code> ç›¸åŒï¼Œå°±åªéœ€è¦é€šè¿‡ç¼“å­˜çš„åç§»é‡åŠ è½½å€¼ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœ JavaScript å¼•æ“å‘ç°å¯¹è±¡çš„ <code>Shape</code> å’Œä¹‹å‰è®°å½•çš„ <code>Shape</code> ä¸€æ ·ï¼Œé‚£ä¹ˆå®ƒå°±å†ä¹Ÿä¸éœ€è¦å»æŸ¥æ‰¾å±æ€§ä¿¡æ¯äº† â€”â€”  å±æ€§ä¿¡æ¯çš„æŸ¥æ‰¾å°±å¯ä»¥å®Œå…¨è·³è¿‡ã€‚ç›¸æ¯”æ¯æ¬¡éƒ½å»æŸ¥æ‰¾å±æ€§ä¿¡æ¯ï¼Œè¿™æ ·çš„æ“ä½œä¼šæ˜¾è‘—åœ°æå‡é€Ÿåº¦ã€‚</p><h3>é«˜æ•ˆå­˜å‚¨æ•°ç»„ï¼ˆStoring arrays efficientlyï¼‰</h3><p>å¯¹äºæ•°ç»„ï¼Œä½¿ç”¨æ•°ç»„ç´¢å¼•ä½œä¸ºæ•°ç»„çš„å±æ€§æ˜¯å¾ˆå¸¸è§çš„ï¼Œå±æ€§å¯¹åº”çš„å€¼ç§°ä¹‹ä¸ºæ•°ç»„å…ƒç´ ã€‚ä¸ºæ¯ä¸ªæ•°ç»„çš„æ¯ä¸ªæ•°ç»„å…ƒç´ å­˜å‚¨å±æ€§ç‰¹æ€§æ˜¯ä¸€ç§é“ºå¼ æµªè´¹çš„è¡Œä¸ºã€‚åœ¨ JavaScript å¼•æ“ä¸­ï¼Œæ•°ç»„çš„ç´¢å¼•å±æ€§é»˜è®¤æ˜¯å¯è¯»ã€å¯æšä¸¾å’Œå¯é…ç½®çš„ï¼Œä¸”æ•°ç»„å…ƒç´ æ˜¯ä¸å‘½åå±æ€§åˆ†å¼€å­˜å‚¨çš„ã€‚</p><p>æ€è€ƒä»¥ä¸‹è¿™ä¸ªæ•°ç»„ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">array</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"s1\">&#39;#jsconfeu&#39;</span><span class=\"p\">,</span>\n<span class=\"p\">];</span>\n</code></pre></div><p>å¼•æ“å­˜å‚¨äº†ä¸€ä¸ªæ•°ç»„é•¿åº¦ä¸º 1 çš„æ•°ç»„ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªåŒ…å«åç§»é‡å’Œ <code>length</code> ç‰¹æ€§çš„ <code>Shape</code>ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-3b2d708e5a1a348504d8cfc525b761d8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic1.zhimg.com/v2-3b2d708e5a1a348504d8cfc525b761d8_b.jpg\"/></figure><p>è¿™ä¸ªä¹‹å‰è§è¿‡çš„å¾ˆç›¸ä¼¼â€¦â€¦ ä½†æ˜¯æ•°ç»„å…ƒç´ çš„å€¼å­˜åœ¨å“ªå‘¢ï¼Ÿ</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c06665091660920d4a8550174607fb09_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic2.zhimg.com/v2-c06665091660920d4a8550174607fb09_b.jpg\"/></figure><p>æ¯ä¸ªæ•°ç»„éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å…ƒç´ å¤‡ä»½å­˜å‚¨ï¼ˆelements backing storeï¼‰ï¼ŒåŒ…å«ç€æ‰€æœ‰ç´¢å¼•å±æ€§å¯¹åº”çš„å€¼ã€‚JavaScript å¼•æ“ä¸å¿…ä¸ºæ•°ç»„å…ƒç´ å­˜å‚¨å±æ€§ç‰¹æ€§ï¼Œå› ä¸ºä»–ä»¬é€šå¸¸æ˜¯å¯å†™ã€å¯æšä¸¾å’Œå¯é…ç½®çš„ï¼Œä¸”æ•°ç»„ç´¢å¼•å¯ä»¥æ›¿ä»£åç§»é‡çš„ä½œç”¨ã€‚</p><p>å¦‚æœæ˜¯ä¸å¯»å¸¸çš„æƒ…å†µä¼šæ€æ ·å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæ”¹å˜æ•°ç»„å…ƒç´ çš„å±æ€§ç‰¹æ€§ï¼ˆproperty attributesï¼‰ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Please donâ€™t ever do this!\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">array</span> <span class=\"o\">=</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">defineProperty</span><span class=\"p\">(</span>\n    <span class=\"p\">[],</span>\n    <span class=\"s1\">&#39;0&#39;</span><span class=\"p\">,</span>\n    <span class=\"p\">{</span>\n        <span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"s1\">&#39;Oh noes!!1&#39;</span><span class=\"p\">,</span>\n        <span class=\"nx\">writable</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n        <span class=\"nx\">enumerable</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n        <span class=\"nx\">configurable</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">);</span>\n</code></pre></div><p>ä¸Šé¢çš„è¿™ä¸ªä»£ç ç‰‡æ®µæ˜¯ç»™å¯¹è±¡å±æ€§ <code>&#39;0&#39;</code> çš„ç‰¹æ€§è®¾ç½®æˆéé»˜è®¤å€¼ã€‚</p><p>åƒè¿™ç§æƒ…å†µï¼ŒJavaScript å¼•æ“ä¼šå°†æ•´ä¸ªå…ƒç´ å¤‡ä»½å­˜å‚¨è¡¨ç¤ºä¸ºä¸€ä¸ªå­—å…¸ï¼ŒæŠŠæ•°ç»„ç´¢å¼•å’Œå±æ€§ç‰¹æ€§å…³è”èµ·æ¥ã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-e0f6ebf0b1d2918c55962b29bf7417c2_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image\" width=\"267\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;267&#39; height=&#39;150&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"267\" data-rawheight=\"150\" class=\"content_image lazy\" width=\"267\" data-actualsrc=\"https://pic3.zhimg.com/v2-e0f6ebf0b1d2918c55962b29bf7417c2_b.jpg\"/></figure><p>å³ä½¿æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ çš„å±æ€§ç‰¹æ€§æ˜¯éé»˜è®¤å€¼ï¼Œå…ƒç´ å¤‡ä»½å­˜å‚¨ä¹Ÿä¼šè¿›å…¥ç¼“æ…¢ä½æ•ˆçš„æ¨¡å¼ï¼ˆä» Elements æ¨¡å¼ åˆ° Dictionary Elements æ¨¡å¼ï¼‰ã€‚é¿å…ç”¨ <code>Object.defineProperty</code> æ”¹å˜æ•°ç»„ç´¢å¼•ï¼</p><h2>çœ‹ç‚¹ï¼ˆTake-awaysï¼‰</h2><p>åŸºäºä»¥ä¸Šçš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº› JavaScript ç¼–ç¨‹æŠ€å·§æ¥æå‡æ€§èƒ½ï¼š</p><ol><li>å§‹ç»ˆä»¥ç›¸åŒçš„æ–¹å¼åˆå§‹åŒ–å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥å¤ç”¨ <code>Shape</code>ã€‚</li><li>ä¸è¦æ²¡äº‹çæŠ˜è…¾æ•°ç»„å…ƒç´ çš„å±æ€§ç‰¹æ€§ï¼Œå®ƒä»¬æœ¬å¯ä»¥é«˜æ•ˆåœ°å·¥ä½œã€‚</li></ol>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "JavaScript å¼•æ“", 
                    "tagLink": "https://api.zhihu.com/topics/19856435"
                }, 
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/82438631", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 7, 
            "title": "å‰ç«¯æ¶æ„ç¢ç¢å¿µ", 
            "content": "<h2>å‰è¨€</h2><p>æœ€è¿‘çœ‹äº†ä¸€äº›å…³äºå‰ç«¯æ¶æ„ç›¸å…³çš„ä¹¦ç±å’Œåšå®¢ï¼Œè§‰å¾—æœ‰ç‚¹è‡ªæˆ‘è†¨èƒ€äº†ï¼Œç«Ÿç„¶æƒ³å¯¹ç€å‰ç«¯æ¶æ„è¿™ä¸€è¯´æ³•æŒ‡æŒ‡ç‚¹ç‚¹ã€‚ä»è·¨å…¥è¿™ä¸ªè¡Œä¸šå¼€å§‹ï¼Œå°±è§‰å¾—æ¶æ„å¸ˆå°±æ˜¯ä½äºæŠ€æœ¯é‡‘å­—å¡”çš„é¡¶ç«¯çš„é‚£æ‹¨äººï¼Œæ˜¯å¼•å¯¼è¡Œä¸šæˆ–å›¢é˜ŸæŠ€æœ¯èµ°å‘çš„é‚£æ‹¨äººã€‚ç„¶è€Œä»è¡Œä¸šä¸Šå¯¹å‰ç«¯æ¶æ„çš„å®šä¹‰å’Œå¿…å¤‡çš„æŠ€èƒ½æ¥çœ‹ï¼Œè§‰å¾—å‰ç«¯æ¶æ„å°±æ˜¯ä¸€ä¸ªä¼ªæ¦‚å¿µï¼Œåˆæˆ–æ˜¯æ‹”é«˜è‡ªå·±èº«ä»½çš„å¹Œå­ã€‚</p><p>ç±»æ¯”äºå»ºæˆ¿å­ï¼Œè€ƒè™‘åˆ°äººæ–‡å› ç´ ï¼Œä¼šæœ‰ä¸­è¥¿é£æ ¼ï¼›è€ƒè™‘åˆ°åœ°ç†ä½ç½®ï¼Œä¼šæœ‰å—åŒ—ä¹‹åˆ†ï¼›è€ƒè™‘åˆ°ç®€æ˜“æ–¹ä¾¿ï¼Œè¿˜ä¼šæœ‰ç»„åˆå¼é›†è£…ç®±æˆ¿å±‹ã€‚è®¾è®¡å¸ˆä¼šè¿ç”¨è‡ªå·±ä¸“ä¸šçŸ¥è¯†å¹¶é›†åˆå„ç§å› ç´ ï¼Œè®¾è®¡å‡ºç¬¦åˆå½“å‰ç¯å¢ƒçš„æˆ¿å±‹ã€‚è€Œæ¶æ„å¸ˆä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä»–ä»¬éœ€è¦ä»ä¸šåŠ¡ã€æŠ€æœ¯ç­‰è§’åº¦æ„é€ å‡ºåˆç†çš„ç»„ç»‡æ¶æ„ã€‚å‰ç«¯æŠ€æœ¯ä¸æ–­å‘å±•æ¼”è¿›ï¼Œä»æ¨¡å—åŒ–çš„æ‘¸ç´¢ï¼Œåˆ° MV* çš„å®è·µï¼Œå†åˆ°å½“ä»Šç»„ä»¶åŒ–çš„ç››è¡Œã€‚è¿™äº›æŠ€æœ¯äººä¸æ–­æŠ˜è…¾ï¼Œä¸æ–­æ”¹è¿›å‰ç«¯æ¶æ„ï¼Œä½¿ä¹‹æ›´ç¬¦åˆè¿™ä¸ªæ—¶ä»£ã€‚åœ¨å¸‚åœºçš„ç­›é€‰ä¸‹ï¼Œæœ€ç»ˆä¹Ÿç•™ä¸‹äº†æœ€é€‚åˆå½“å‰çš„å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œå¤§éƒ¨åˆ†å‰ç«¯æ¶æ„å¸ˆå¹¶ä¸å…·å¤‡è¿™ç§èƒ½åŠ›ï¼Œå……å…¶é‡å°±æ˜¯ç»éªŒä¸°å¯Œçš„åŒ…å·¥å¤´ï¼ŒæŸç§å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆçš„è·µè¡Œè€…ã€‚</p><p>è®¾è®¡å¸ˆæ€ä¹ˆç»ƒæˆçš„ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ã€‚ä½†æ˜¯ç±»æ¯”åŒ…å·¥å¤´ï¼Œæˆ‘ä»¬è¿˜æ˜¯çŸ¥é“å‰ç«¯ Leader åº”è¯¥åšä»€ä¹ˆã€‚</p><h2>å¼€å·¥å‰çš„å‰æœŸå‡†å¤‡</h2><p>è¿™é‡Œçš„å‰æœŸå‡†å¤‡ï¼ŒæŒ‡çš„æ˜¯ä»é›¶å¯åŠ¨ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å‡†å¤‡å·¥ä½œã€‚è€Œæœ€èƒ½ä½“ç°æ•´ä¸ªé¡¹ç›®çš„æŠ€æœ¯å«é‡çš„æ´»ä¼°è®¡æœ‰å¤§åŠåœ¨è¿™é‡Œäº†ã€‚ä½œä¸ºä¸€ä¸ªåŒ…å·¥å¤´ï¼Œä¸æ˜¯è¯´æˆ‘èƒ½æŠŠç –ç Œå¾—æœ‰å¤šå¥½ï¼Œè€Œæ˜¯è¶³å¤Ÿäº†è§£ç°æœ‰çš„èµ„æºå’Œå·¥ä½œæµï¼Œå¹¶æ­å»ºå¥½åŸºç¡€è®¾æ–½ï¼Œä¸ºæ—¥åé¡¹ç›®é«˜æ•ˆæ¨è¿›èµ·ä¸ªå¥½å¤´ã€‚</p><p>åœ¨å¾ˆæ—©ä»¥å‰ï¼Œæ•°æ®å’Œè§†å›¾è€¦åˆï¼Œé‚£æ—¶å€™æ²¡æœ‰å‰ç«¯çš„ä»€ä¹ˆäº‹ï¼Œæœ€å¤šä½œä¸ºé¡µé¢ä»”ä¸ºåç«¯æä¾›æ¨¡æ¿ï¼Œæˆ–è€…è¯´ç”»å‡ ä¸ªå±•ç¤ºç”¨çš„é™æ€é¡µé¢ã€‚ä¹‹å ajax çš„å…´èµ·ï¼Œè®©æ•°æ®å’Œè§†å›¾çš„å…³ç³»å¼€å§‹æ¾ç»‘ï¼Œå‰ç«¯åœ¨æ•°æ®çš„èµ‹èƒ½ä¸‹ï¼Œè¿æ¥äº†ä¸€æ¬¡å¤§å‘å±•ã€‚äººè¦ä¸æ•°æ®äº¤äº’ï¼Œå¿…ç„¶è¦é€šè¿‡æŸä¸ªåª’ä»‹ï¼Œè€Œå‰ç«¯åœ¨è·å–éƒ¨åˆ†æ•°æ®çš„æƒé™åï¼Œåˆåè¿‡æ¥ä¿ƒè¿›äº†äººä¸æ•°æ®çš„äº’åŠ¨å…³ç³»ã€‚å³ä½¿åé¢çš„ Nodeï¼Œæˆ‘ä¹Ÿè®¤ä¸ºæ˜¯å‰ç«¯ä¸ºäº‰å–æ“ä½œæ•°æ®æƒé™è€Œåšçš„åŠªåŠ›ã€‚æ¯•ç«Ÿï¼Œè¿™ä¸ªå¹´ä»£æ•°æ®æ‰æ˜¯ç‹é“ã€‚</p><p>è§†å›¾æ€ä¹ˆè·å–æ•°æ®ï¼Ÿè§†å›¾æ€ä¹ˆå±•ç¤ºæ•°æ®ï¼Ÿè§†å›¾æ€ä¹ˆæ›´å¥½å¾—è·å–æ•°æ®ï¼Ÿè§†å›¾æ€ä¹ˆæ›´å¥½å¾—å±•ç¤ºæ•°æ®ï¼Ÿï¼ˆ...æ²¡æƒ³é‚£ä¹ˆå¤š...ï¼‰</p><h3>æ¶æ„è®¾è®¡</h3><p>ä»æ—©æœŸçš„æœåŠ¡ç«¯ç›´å‡ºåˆ°ç°åœ¨çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè§†å›¾çš„æ¸²æŸ“å…œå…œè½¬è½¬è²Œä¼¼åˆå›åˆ°çš„èµ·ç‚¹ã€‚ä½†æ­¤éå½¼ï¼Œä¸å¯åŒæ—¥è€Œè¯­ã€‚ajax è¢« Google ä½¿ç”¨åï¼Œéšä¹‹è€Œæ¥çš„æ˜¯å‰åç«¯çš„åˆ†ç¦»ã€‚å‰ç«¯åº”ç”¨ä¹Ÿæ˜¯è·Ÿéšæ—¶ä»£è€Œå‘ˆç°ä¸åŒçš„æ¶æ„è®¾è®¡ï¼Œæ¯”å¦‚å¤šé¡µé¢åº”ç”¨ã€å•é¡µé¢åº”ç”¨ã€åŒæ„æ¸²æŸ“ã€å¾®å‰ç«¯ç­‰ã€‚å®ƒä»¬çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³æŸäº›é—®é¢˜è€Œç»™å‡ºçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ‰€ä»¥è¯´å³ä½¿è¿‡æ—¶ï¼Œå´ä¾ç„¶æœ‰å…¶ä»·å€¼ã€‚</p><p>å¤šé¡µé¢åº”ç”¨ï¼Œç›¸å¯¹æ¥è¯´ï¼Œæ¯”è¾ƒç®€å•ã€‚ç®€å•çš„å¤šé¡µé¢åº”ç”¨ï¼Œæ¯”å¦‚é™æ€é¡µé¢ï¼Œè¿™é‡Œå¯èƒ½å‹æ ¹æ²¡ JS çš„äº‹ã€‚å¤æ‚ç‚¹çš„å¤šé¡µé¢åº”ç”¨ï¼Œå¯èƒ½è¦å¼•å…¥æ¨¡æ¿å¼•æ“ï¼Œè·¯ç”±ç­‰ã€‚è¦æ˜¯è§‰å¾—åŸç”Ÿæ“ä½œ DOM ä¸æ–¹ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨ jQueryã€‚å¤šé¡µé¢åº”è¯¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåŠ è½½éœ€è¦çš„èµ„æºï¼Œç”±äºæµè§ˆå™¨ç¼“å­˜ç­–ç•¥ï¼Œç¬¬äºŒæ¬¡åŠ è½½ç›¸åŒçš„èµ„æºæ—¶ï¼Œå¯èƒ½å°±ä¸éœ€è¦é‡å¤è¯·æ±‚äº†ã€‚åœ¨ç»“åˆä¸€ç‚¹ MV* æ¨¡å¼ï¼Œå¿«å’Œå•é¡µé¢åº”ç”¨æ²¡ä»€ä¹ˆåŒºåˆ«äº†ã€‚åªæ˜¯ç°åœ¨æµè¡Œçš„å•é¡µé¢ä¸éœ€è¦ç›´æ¥æ“ä½œ DOM ï¼Œè€Œæ˜¯äº¤ç»™æ¡†æ¶åº•å±‚å¤„ç†äº†ã€‚</p><p>ä»¥ä¸Šçš„åº”ç”¨è¯´æ¥è¯´å»å¯èƒ½éƒ½æ˜¯åŒä¸€ä¸ªåº”ç”¨ï¼Œåœ¨æŸäº›åœºæ™¯ï¼Œå°±éœ€è¦èšåˆå¤šä¸ªå‰ç«¯åº”ç”¨ï¼Œæœ‰è·¯ç”±åˆ†å‘çš„æ–¹æ¡ˆï¼Œæœ‰ iframe ä½œä¸ºå®¹å™¨çš„æ–¹æ¡ˆç­‰ã€‚</p><h3>å‰ç«¯è§„èŒƒ</h3><p>ã€Œä¹¦åŒæ–‡ï¼Œè½¦åŒè½¨ã€</p><p>æ—¢ç„¶æ˜¯åŒ…å·¥å¤´ï¼Œè‡ªç„¶ä¸å¤§å¯èƒ½æ˜¯ä¸€ä¸ªå…‰æ†å¸ä»¤ã€‚åˆ¶å®šè§„èŒƒï¼Œä¸ä»…å¯ä»¥ä½¿æˆå‘˜ä»£ç é£æ ¼è¶‹äºç»Ÿä¸€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿æ–°æ‰‹å…»æˆè‰¯å¥½çš„ç¼–ç ä¹ æƒ¯ã€‚å¯¹äºå‰ç«¯æ¥è¯´ï¼ŒHTMLã€CSSã€JS åˆ†åˆ«ä»£è¡¨äº†ç»“æ„å±‚ã€è¡¨ç°å±‚å’Œè¡Œä¸ºå±‚ã€‚åœ¨ä»£ç å±‚æ¬¡ä¸Šï¼Œå®ƒä»¬éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—æ ‡å‡†ï¼Œå¯ä»¥ç»“åˆå„è‡ª lintå·¥å…· + Prettier è½»æ¾è§„èŒƒä»£ç ã€‚ä»ç»„ä»¶è§„èŒƒè§’åº¦ï¼Œè¿˜åŒ…æ‹¬ UI ç»„ä»¶è§„èŒƒã€æ¨¡å—åŒ–è§„èŒƒã€é¡¹ç›®ç»„ä»¶åŒ–è®¾è®¡æ–¹æ¡ˆç­‰ã€‚</p><p>ç¼–è¾‘å™¨æœ€å¥½ä¹Ÿèƒ½å¤Ÿç»Ÿä¸€ä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿæ‘¸ç´¢å‡ºèƒ½å¤Ÿæé«˜æ•ˆç‡çš„ä¸€ç³»åˆ—ä½¿ç”¨æ–¹æ³•ï¼ŒåŒæ­¥ç»™å…¨ç»„æˆå‘˜å°±æ›´å¥½äº†ã€‚</p><h3>è‡ªåŠ¨åŒ–æ„å»º</h3><p>éƒ½ 9102 å¹´ï¼Œè‡ªåŠ¨åŒ–æ„å»ºå·²æˆä¸ºç°ä»£å‰ç«¯å·¥ç¨‹ä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªç¯èŠ‚ã€‚è‡ªåŠ¨åŒ–æ„å»ºå¯ä»¥åšå¾ˆå¤šäº‹ï¼Œæ¯”å¦‚æ–‡ä»¶ç¼–è¯‘ï¼Œèµ„æºåˆå¹¶ï¼Œå‹ç¼©ä¼˜åŒ–ç­‰ã€‚æ„å»ºå·¥å…·å¾ˆå¤šï¼Œä½†æ‰€åšçš„äº‹åŸºæœ¬ä¸Šæ˜¯å·®ä¸å¤šçš„ï¼Œè¯»å–å…¥å£é…ç½®æ–‡ä»¶ â¡ ç”Ÿæˆæ¨¡å—ä¾èµ–å›¾ â¡ åŠ è½½æ¨¡å— â¡ æ¨¡å—æ–‡ä»¶ç¼–è¯‘å¤„ç† â¡ï¸ æ¨¡å—æ–‡ä»¶åˆå¹¶ â¡ï¸ æ–‡ä»¶èµ„æºä¼˜åŒ– â¡ è¾“å‡ºæœ€ç»ˆèµ„æºã€‚</p><p>ä¸è®ºæ˜¯ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯å¼€å‘ç¯å¢ƒï¼Œéƒ½éœ€è¦æ„å»ºå·¥å…·çš„å‚ä¸ã€‚ç”Ÿäº§ç¯å¢ƒä¾§é‡äºæ€§èƒ½ï¼Œæ¯”å¦‚æ–‡ä»¶å‹ç¼©ä¼˜åŒ–ï¼Œå»é™¤æ— ç”¨ä»£ç æ³¨é‡Šç­‰ã€‚æµ‹è¯•ç¯å¢ƒä¾§é‡äºå¼€å‘ä½“éªŒï¼Œæ¯”å¦‚æ¨¡å—çƒ­æ›¿æ¢ï¼Œç”Ÿæˆ sourcemap ç­‰ã€‚åƒä¹‹å‰çš„ä»£ç è§„èŒƒï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©æ„å»ºå·¥å…·è‡ªåŠ¨åŒ–æ ¼å¼åŒ–ä»£ç ï¼Œæˆ–æç¤ºé”™è¯¯ã€‚</p><h3>é¡¹ç›®ä»£ç ç¤ºä¾‹</h3><p>é¡¹ç›®åœ¨æ­£æ˜¯å¯åŠ¨ä¹‹å‰ï¼Œéœ€è¦éªŒè¯ç¨‹åºæ˜¯å¦æŒ‰ç…§è‡ªå·±çš„é¢„æœŸå»æ‰§è¡Œã€‚éªŒè¯å¯è¡Œåï¼Œå¹¶æŒ‰ç…§è‡ªå·±å®šä¹‰çš„ä¸€ç³»åˆ—è§„èŒƒç¼–å†™ç¤ºä¾‹ä»£ç ï¼Œè¿™æ ·æœ‰åŠ©äºå…¶ä»–æˆå‘˜äº†è§£è¯¥é¡¹ç›®çš„è§„èŒƒã€‚åŒæ—¶ï¼Œå¯¹å†…ç»„ç»‡æŠ€æœ¯åŸ¹è®­ï¼Œä»‹ç»ç³»ç»Ÿçš„æ¶æ„å’Œæ³¨æ„äº‹é¡¹ã€‚</p><p>å…¶å®ï¼ŒæŠ€æœ¯éªŒè¯çš„è¿‡ç¨‹ä¸åº”è¯¥æ”¾åœ¨æ•´ä¸ªå¼€å‘æµç¨‹ä¸­ã€‚å·¥ä½œä¹‹ä½™ï¼Œæˆ‘ä»¬å¯ä»¥å¤šæ¥è§¦æ–°çš„æŠ€æœ¯å’Œå°è¯•æ–°çš„æ¶æ„è®¾è®¡ã€‚åœ¨æœªçŸ¥çš„é¢†åŸŸï¼Œæˆ‘ä»¬æ— æ³•å‡†ç¡®è¯„ä¼°æ—¶é—´ï¼Œä¸´æ—¶ç£¨æªå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡¹ç›®çš„å»¶æœŸã€‚</p><h2>å¼€å·¥</h2><p>æŠ€æœ¯æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡çš„ï¼Œé¡¹ç›®å¯åŠ¨äº†ï¼Œæ„å‘³ç€å¼€å§‹å¿è¿˜ä¸šåŠ¡å€ºäº†ã€‚è€Œå‰ç«¯ Leader èŒè´£ä¹Ÿå¼€å§‹å‘ç”Ÿå˜åŒ–ï¼Œä¸ä»…ä»…ä»äº‹æŠ€æœ¯æ´»ï¼Œè¿˜è¦å‚ä¸åˆ°å›¢é˜Ÿç®¡ç†ã€é¡¹ç›®ç®¡ç†ç­‰éæŠ€æœ¯æ´»ã€‚é¡¹ç›®è¿›å…¥æ­£è½¨åï¼Œäººäººéƒ½æˆä¸ºäº†èºä¸å·¥ï¼ŒæŠ€æœ¯ä¸Šçš„éš¾é¢˜åŸºæœ¬ä¸Šå¾ˆå°‘å†ä¼šé‡åˆ°ã€‚ä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¼šå˜å¾—ä¸€å¸†é£é¡ºã€‚</p><h3>æ²Ÿé€šåè°ƒ</h3><p>ã€Œå‡¡äº‹æœ‰äº¤ä»£ï¼Œä»¶ä»¶æœ‰ç€è½ï¼Œäº‹äº‹æœ‰å›éŸ³ã€</p><p>ä¸ç®¡æ˜¯æ™®é€šæˆå‘˜ï¼Œè¿˜æ˜¯å›¢é˜Ÿ Leaderï¼Œéƒ½åº”è¯¥å…·å¤‡è¿™æ ·çš„åšäº‹é£æ ¼ï¼Œå¯¹è‡ªå·±å’Œåˆ«äººéƒ½æœ‰ä¸ªäº¤ä»£ã€‚</p><p>å‰ç«¯åœ¨æ•´ä¸ªç ”å‘é˜Ÿä¼ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå°´å°¬çš„å­˜åœ¨ã€‚å°¤å…¶åœ¨æ¯”è¾ƒé‡è§†ä¸šåŠ¡çš„å›¢é˜Ÿé‡Œï¼Œå¥½äº‹æ²¡æåˆ°ï¼Œéº»çƒ¦äº‹å´ä¸æ–­æ‰¾ä¸Šé—¨ã€‚æ¯”å¦‚é¡µé¢æŠ›å¼‚å¸¸ï¼Œæµ‹è¯•ä¼™ä¼´ç¬¬ä¸€ä¸ªå°±æ‰¾å‰ç«¯ã€‚äº§å“ä¼™ä¼´ä¸é è°±ï¼Œé¢‘ç¹æ‰¾å‰ç«¯ã€‚é‡åˆ°ä¸é è°±çš„åç«¯å°ä¼™ä¼´ï¼Œè”è°ƒæµ‹è¯•æ—¶ä¹Ÿä¼šè·‘æ¥è´¨ç–‘å‰ç«¯ã€‚æœ€åå¯èƒ½é¢†å¯¼è·‘æ¥æ‰¾ä½ è°ˆè¯ï¼Œè¯´ä½ ä»¬å‰ç«¯å›¢é˜Ÿæ€ä¹ˆè€æ˜¯å‡ºé—®é¢˜ã€‚è®²çœŸï¼Œè¿™è¯æ²¡æ³•æ¥ã€‚æ„Ÿè§‰å‰ç«¯å°±æ˜¯ä¸€ä¸ªæ¥é”…ä¾ ï¼Œæ—¶é—´é•¿äº†ï¼Œå¯¹å›¢é˜Ÿå£«æ°”æœ‰å¾ˆå¤§çš„å½±å“ï¼Œè¿™ä¹Ÿæ˜¯å‰ç«¯ Leader éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</p><p>å¯¹äºäº§å“ï¼Œéœ€æ±‚è¯„å®¡ä¸¥æ ¼æŠŠå…³ï¼Œå¯¹äºä¸åˆç†æˆ–ä¸ç´§æ€¥çš„éœ€æ±‚ï¼Œå»¶è¿Ÿæˆ–é™ä½å…¶ä¼˜å…ˆçº§ã€‚å¯¹äºæµ‹è¯•ä¼™ä¼´ï¼Œå¯¹å…¶è¿›è¡ŒæŠ€æœ¯åŸ¹è®­ï¼Œäº†è§£å¼€å‘è€…å·¥å…·çš„ç®€å•ä½¿ç”¨ï¼Œå’Œå¸¸è§å¼‚å¸¸æŠ¥é”™åˆ†æç§‘æ™®ã€‚å¯¹äºåç«¯ï¼Œåˆ¶å®šç›¸å…³çº¦æŸã€‚ä»¥ä¸Šè§„èŒƒè¦å½¢æˆæ–‡æ¡£ä¿å­˜ï¼Œæ–¹ä¾¿åæ¥è€…ã€‚</p><p>å½“ç„¶è¯¸å¦‚æ­¤ç±»çš„é—®é¢˜ä¼šæœ‰å¾ˆå¤šï¼Œå¯¹äºé—®é¢˜è¦æ•æ„Ÿå¹¶åŠæ—¶å‘ç°ï¼Œåˆ†æå¯¼è‡´é—®é¢˜çš„æ ¹æºï¼Œæœ€åå¯¹ç—‡ä¸‹è¯é€æ­¥è§£å†³é—®é¢˜ã€‚äº‹æƒ…è¯´å¾—å¾ˆç®€å•ï¼Œä½†äº‹å®ä¸Šï¼Œäººä»¬ä¹ æƒ¯äºå­˜åœ¨é—®é¢˜çš„ç°çŠ¶è€Œä¸è‡ªçŸ¥æˆ–å‘ç°é—®é¢˜å´ä¹ æƒ¯äºæœ‰é—®é¢˜çš„ç°çŠ¶ã€‚</p><h3>æå‡å›¢é˜Ÿèƒ½åŠ›</h3><p>ä¼—äººæ‹¾æŸ´ç«ç„°é«˜ï¼Œåªæœ‰å¤§ä¼™å„¿åŠ›å¾€ä¸€å¤„ä½¿ï¼Œæ‰èƒ½äº§ç”Ÿ 1 + 1 &gt; 2 çš„æ•ˆæœã€‚å¯æ˜¯ç¼–ç å¹¶ä¸æ˜¯åŠ›æ°”æ´»ï¼Œæˆå‘˜çš„å‚å·®ä¸é½ï¼Œå¾ˆå¤§çš„ç¨‹åº¦ä¸Šä¼šæ‹–å›¢é˜Ÿçš„åé€€ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ–°æ‰‹çš„ä»£ç æäº¤ä¸è§„èŒƒï¼Œå¾ˆå¯èƒ½å¯¼è‡´æŸäº›äººçš„å“€åšã€‚</p><p>ä»£ç å®¡æŸ¥ï¼Œæ˜¯ä¸€ä¸ªæé«˜è‡ªå·±ç¼–ç èƒ½åŠ›çš„å¥½æœºä¼šã€‚ä¹‹å‰çš„ Lint è§„åˆ™å¯ä»¥å¾ˆå¥½åœ°æ ¡æ­£ä»£ç é£æ ¼ï¼Œè€Œåœ¨ä»£ç å®¡æŸ¥ä¸­ï¼Œå°±å¯ä»¥å‘ç°é€»è¾‘ä¸Šçš„é—®é¢˜æˆ–çŸ¥é“å¯ä»¥è®©ä»£ç æ›´å‡ºå½©çš„æ–¹æ³•ã€‚</p><p>ä»£ç é‡æ„ç®—æ˜¯ä¸€ç§æå‡ç¼–ç¨‹èƒ½åŠ›çš„æ–¹å¼ï¼Œä¸è¿‡æœ‰å¾ˆå¤šäººå¯¹ä»£ç é‡æ„æœ‰ç€å¾ˆå¤§çš„è¯¯è§£ï¼Œä¹Ÿä¸è§å¾—é¡¹ç›®ä¸­å¯¹é‡æ„çš„é‡è§†ã€‚é‡æ„å¯ä»¥æœ¬ç€å°æ­¥å¿«èµ°çš„åŸåˆ™ï¼Œå¢åŠ ç¨‹åºçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä½•æ—¶å»é‡æ„ï¼Ÿéœ€è¦é‡æ„çš„æ ‡å‡†çš„æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœç¨‹åºå†—é•¿å•°å—¦çœ‹ä¸æ‡‚ï¼Œé‚£å°±é‡æ„å®ƒã€‚å¦‚æœä¸€æ®µç¨‹åºè¿‡åˆ†ä¾èµ–äºæ³¨é‡Šï¼Œé‚£å°±é‡æ„å®ƒã€‚å¦‚æœä½ æƒ³æ·»åŠ æ–°åŠŸèƒ½ï¼Œå´æ— ä»ä¸‹æ‰‹ï¼Œé‚£å°±é‡æ„å®ƒã€‚åªè¦æ˜¯å¯è¯»æ€§å·®ï¼Œå¯ç»´æŠ¤æ€§å·®ï¼Œä½ éƒ½æœ‰ç†ç”±å»é‡æ„å®ƒã€‚</p><p>ä»£ç å®¡æŸ¥è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†Ÿæ‚‰ä¸šåŠ¡ã€‚å¦‚æœé¡¹ç›®ä¸šåŠ¡å¾ˆå¤æ‚ï¼Œè‡³å°‘è¦ä¿è¯æœ‰ä¸¤ä¸ªäººå¯¹åŒä¸€æ¨¡å—æœ‰è¶³å¤Ÿçš„äº†è§£ã€‚</p><p>æ–°äººåŸ¹è®­å’ŒæŠ€æœ¯åˆ†äº«ï¼Œæ–°äººåˆšæ¥å…¥é¡¹ç›®æ—¶ï¼Œæœ‰å¿…è¦å¯¹å…¶è¿›è¡ŒåŸºç¡€çš„æŠ€æœ¯åŸ¹è®­ï¼Œå¦‚ä¸šåŠ¡åŸ¹è®­ã€æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†åŸ¹è®­ã€è°ƒè¯•èƒ½åŠ›åŸ¹è®­ç­‰ï¼Œè¿™äº›éƒ½è¦æœ‰ç›¸å…³çš„æ–‡æ¡£ã€‚è¿™äº›çœ‹ç€æ— å…³ç´§è¦çš„åŸ¹è®­ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¾€å¾€æ˜¯ä¸€å¤§åŠ©åŠ›ã€‚</p><p>æŠ€æœ¯åˆ†äº«ï¼Œå¹¶ä¸æŒ‡æœ›ä¸€æ¬¡ç®€å•çš„åˆ†äº«å°±è®©æ‰€æœ‰çš„æˆå‘˜å­¦ä¼šä¸€é¡¹æŠ€èƒ½ï¼Œä¸è¿‡è¿™å¯¹å›¢é˜Ÿçš„æŠ€æœ¯è§†é‡å’Œå›¢é˜ŸæŠ€æœ¯æ°›å›´ä¼šæœ‰å¾ˆå¤§å¸®åŠ©ã€‚å¯¹äºæŠ€æœ¯åˆ†äº«çš„äººï¼Œæœ‰ä¸åŒçš„è¯´æ³•ï¼Œæœ‰äººä¸»å¼ æ–°äººä¸»æŒåˆ†äº«ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æ–°äººèå…¥å›¢é˜Ÿï¼Œè€äººä¹Ÿå¯ä»¥ä¸€æ—è¡¥å……è¯´æ˜ã€‚è€Œæœ‰äº›äººï¼Œåˆ™è®¤ä¸ºè®©æœ€æ“…é•¿çš„äººå»åšæ“…é•¿çš„äº‹ã€‚ä¸çŸ¥é“å­°å¥½å­°åï¼Œä¸äºˆç½®è¯„ã€‚</p><p>æˆ‘è®¤ä¸ºå›¢é˜Ÿèƒ½åŠ›è¿˜åº”è¯¥åŒ…æ‹¬å­˜ç»­èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å³ä¾¿æˆå‘˜æµåŠ¨å¿«ï¼Œæ–°åˆ°ä½çš„æˆå‘˜ä¹Ÿèƒ½å¾ˆå¿«æ¥å…¥é¡¹ç›®ã€‚è¿™å°±éœ€è¦å„ç§æ–‡æ¡£è®°å½•ï¼Œæ–°äººåŸ¹è®­æ–‡æ¡£ï¼ŒæŠ€æœ¯æ¶æ„æ–‡æ¡£ï¼Œä¸šåŠ¡æ–‡æ¡£ï¼ŒæŠ€æœ¯åˆ†äº«æ–‡æ¡£ï¼Œå¼€å‘è§„èŒƒæ–‡æ¡£ï¼Œå·¥ä½œäº¤æ¥æ–‡æ¡£ç­‰ã€‚</p><h3>å‰åç«¯è”è°ƒ</h3><p>åç«¯ç”±æœ¬åœ°å¼€å‘ç¯å¢ƒéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒï¼ŒæŒ‰æ­£å¸¸çš„èŠ‚å¥æ¥ï¼Œå‰åç«¯è”è°ƒä¼šå¾ˆé¡ºåˆ©ã€‚ç„¶è€Œï¼Œå®é™…å¼€å‘ä¸­ï¼Œè”è°ƒçš„å æ¯”ä¼šå¾ˆå¤§ã€‚ä¸»è¦çš„åŸå› æœ‰ï¼Œ</p><ol><li>å‰åç«¯æ²Ÿé€šæ•ˆç‡ä½ï¼Œæœ‰é—®é¢˜ç›¸äº’è´¨ç–‘ã€‚</li><li>åç«¯è‡ªæµ‹åŠ›åº¦ä¸å¤Ÿï¼Œè€ƒè™‘ä¸å‘¨å…¨ã€‚</li><li>æ¥å£åè®®å˜åŠ¨é¢‘ç¹ã€‚</li><li>æ¥å£æ–‡æ¡£ä¸è¯¦å®ã€‚ ...</li></ol><p>æœ€ç®€å•ç²—æš´çš„æ–¹æ³•å°±æ˜¯å¼•å…¥æ¥å£ç®¡ç†å¹³å°ï¼Œå¼•å…¥ç»©æ•ˆè€ƒæ ¸åˆ¶åº¦ã€‚</p><h3>æŒç»­åŒ–é›†æˆ æŒç»­åŒ–äº¤ä»˜ æŒç»­åŒ–éƒ¨ç½²</h3><p>è¿™ä¸€å—å°±ä¸æ˜¯å‰ç«¯è‡ªå·±èƒ½å¤Ÿå†³å®šçš„äº‹æƒ…äº†ï¼Œæœ‰æ¡ä»¶çš„è¯å¯ä»¥è‡ªå·±æ­å»ºä»£ç æ‰˜ç®¡å¹³å°ï¼Œä½¿ç”¨ gitlab ï¼Œç°åœ¨äººå®¶æä¾›ä¸€æ¡é¾™æœåŠ¡ï¼Œå¯ä»¥å°è¯•ä¸€æ³¢ã€‚</p><h2>ç»“è¯­</h2><p>å’Œä»£ç æ‰“äº¤é“ä¸å¯æ€•ï¼Œå’Œäººæ‰“äº¤é“ä¹Ÿä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯è¿™ä¸ªå‰ç«¯ Leader æœ‰æƒ³æ³•ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }
            ], 
            "comments": [
                {
                    "userName": "å¤§æ±Ÿå±±å²š", 
                    "userLink": "https://www.zhihu.com/people/36ddf904e3fcc0c5204532632326d63b", 
                    "content": "è¯·é—®å…³äºå‰ç«¯æ¶æ„æ–¹é¢æœ‰å“ªäº›ä¹¦ç±å’Œåšå®¢å¯ä»¥æ¨èå‘¢", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "æ²¡æœ‰å‘¢ï¼Œä¸ç„¶ä¹Ÿä¸ä¼šå†™è¿™ä¸ªåšæ–‡äº†[æ‚è„¸]ï¼ŒçœŸè¦çœ‹æ¶æ„å°±ä¸èƒ½å±€é™äºå‰ç«¯äº†", 
                            "likes": 0, 
                            "replyToAuthor": "å¤§æ±Ÿå±±å²š"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/80764292", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 2, 
            "title": "ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢æ­£å", 
            "content": "<a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/%25E4%25B8%25BA%25E5%25BC%25BA%25E5%2588%25B6%25E7%25B1%25BB%25E5%259E%258B%25E8%25BD%25AC%25E6%258D%25A2%25E6%25AD%25A3%25E5%2590%258D/\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic3.zhimg.com/v2-4dad71953b4f3a5c60f78f9d15539666_180x120.jpg\" data-image-width=\"640\" data-image-height=\"512\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢æ­£å</a><h2>å¼•å­</h2><blockquote>å¼ºåˆ¶ç±»å‹è½¬æ¢æ˜¯JavaScriptå¼€å‘äººå‘˜æœ€å¤´ç–¼çš„é—®é¢˜ä¹‹ä¸€, å®ƒå¸¸è¢«è¯Ÿç—…ä¸ºè¯­è¨€è®¾è®¡ä¸Šçš„ä¸€ä¸ªç¼ºé™·, å¤ªå±é™©, åº”è¯¥æŸä¹‹é«˜é˜.</blockquote><p>ä½œä¸ºå¼€å‘äººå‘˜, å¾€å¾€ä¼šé‡åˆ°æˆ–å†™è¿‡æ¶‰åŠåˆ°ç±»å‹è½¬æ¢çš„ä»£ç , åªæ˜¯æˆ‘ä»¬ä»æ¥æ²¡æœ‰æ„è¯†åˆ°.</p><p><b>çŒœçŒœçœ‹</b>ğŸ˜:</p><ol><li>ä½œä¸ºåŸºæœ¬ç±»å‹å€¼, ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸å…³çš„å±æ€§æˆ–æ–¹æ³•? eg: <code>&#39;hello&#39;.charAt(0)</code> (å‚è§(#å†…ç½®ç±»å‹å’Œå†…å»ºå‡½æ•°çš„å…³ç³»))</li><li><code>a &amp;&amp; (b || c)</code> è¿™æ³¢æ“ä½œæˆ‘ä»¬çŸ¥é“, é‚£ä¹ˆ <code>if (a &amp;&amp; (b || c))</code>, è¿™é‡Œåˆåšäº†å“ªäº›æ“ä½œ? (å‚è§(#æ¡ä»¶åˆ¤æ–­))</li><li><code>if (a == 1 &amp;&amp; a== 2) { dosomething }</code>, <b>dosomething</b> ç«Ÿç„¶æ‰§è¡Œäº†, ä»€ä¹ˆé¬¼? (å‚è§(#ToPrimitive))</li><li><code>[] == ![]</code> =&gt; true ?; <code>false == []</code> =&gt; true ?; <code>&#34;0&#34; == false</code> =&gt; true ?(å‚è§(#æŠ½è±¡ç›¸ç­‰))</li><li><code>if (~indexOf(&#39;a&#39;))</code>, è¿™æ³¢æ“ä½œç†Ÿæ‚‰ä¸? (å‚è§(#éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢))</li><li>åœ¨<b>String</b> , <b>Number</b> , <b>Boolean</b> ç±»å‹ä¹‹é—´æ¯”è¾ƒæ—¶, è¿›è¡Œçš„å¼ºåˆ¶ç±»å‹è½¬æ¢åˆéµå¾ªäº†å“ªäº›è§„åˆ™? (å‚è§(#æŠ½è±¡æ“ä½œ))</li></ol><p>æŒæ¡äº†JavaScriptå¼ºåˆ¶ç±»å‹è½¬æ¢çš„æŠ½è±¡æ“ä½œ, ä»¥ä¸Šçš„é—®é¢˜éƒ½æ˜¯å°å„¿ç§‘.</p><p>æ»‘è‡³æ–‡ç« åº•éƒ¨å¯ç›´æ¥çœ‹æ —å­ğŸŒ°. <i>æ˜é‡‘Markdownéƒ¨åˆ†è¯­æ³•ä¸æ”¯æŒ, å¯ç‚¹æ­¤é˜…è¯»<a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E4%25B8%25BA%25E5%25BC%25BA%25E5%2588%25B6%25E7%25B1%25BB%25E5%259E%258B%25E8%25BD%25AC%25E6%258D%25A2%25E6%25AD%25A3%25E5%2590%258D/%23more\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åŸæ–‡</a>.</i></p><p><i>(ä»¥ä¸‹å†…å®¹æ˜¯ä»¥ã€Šä½ ä¸çŸ¥é“çš„JavaScriptã€‹å¼ºåˆ¶ç±»å‹è½¬æ¢éƒ¨åˆ†ä¸ºå¤§çº², å¹¶å‚ç…§</i> <i><code></code></i>r<i>ef</i>=&#34;<a href=\"https://link.zhihu.com/?target=https%3A//www.ecma-international.org/ecma-262/5.1/\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://www.</span><span class=\"visible\">ecma-international.org/</span><span class=\"invisible\">ecma-262/5.1/</span><span class=\"ellipsis\"></span></a>&#34;&gt;ecma è§„èŒƒ <i>æ’°å†™.)</i></p><hr/><h2>ç±»å‹</h2><h3>å†…ç½®ç±»å‹</h3><p>JavaScript æœ‰ä¸ƒç§å†…ç½®ç±»å‹. <b>ç©ºå€¼</b>: null, <b>æœªå®šä¹‰</b>: undefined, <b>å¸ƒå°”å€¼</b>: boolean, <b>æ•°å­—</b>: number, <b>å­—ç¬¦ä¸²</b>: string, <b>å¯¹è±¡</b>: object, <b>ç¬¦å·</b>: symbol. é™¤ <b>å¯¹è±¡</b>:object, ä¸ºå¤æ‚æ•°æ®ç±»å‹, å…¶å®ƒå‡ä¸ºåŸºæœ¬æ•°æ®ç±»å‹.</p><h3>å†…å»ºå‡½æ•°</h3><p>å¸¸ç”¨çš„å†…å»ºå‡½æ•°: <b>String()</b>, <b>Number()</b>, <b>Boolean()</b>, <b>Array()</b>, <b>Object()</b>, <b>Function()</b>, <b>RegExp()</b>, <b>Date()</b>, <b>Error()</b>, <b>Symbol()</b>.</p><h3>å†…ç½®ç±»å‹å’Œå†…å»ºå‡½æ•°çš„å…³ç³»</h3><p>ä¸ºäº†ä¾¿äºæ“ä½œåŸºæœ¬ç±»å‹å€¼, JavaScriptæä¾›äº†å°è£…å¯¹è±¡(å†…å»ºå‡½æ•°), å®ƒä»¬å…·æœ‰å„è‡ªçš„åŸºæœ¬ç±»å‹ç›¸åº”çš„ç‰¹æ®Šè¡Œä¸º. å½“è¯»å–ä¸€ä¸ªåŸºæœ¬ç±»å‹å€¼çš„æ—¶å€™, JavaScriptå¼•æ“ä¼šè‡ªåŠ¨å¯¹è¯¥å€¼è¿›è¡Œå°è£…(åˆ›å»ºä¸€ä¸ªç›¸åº”ç±»å‹çš„å¯¹è±¡åŒ…è£…å®ƒ)ä»è€Œèƒ½å¤Ÿè°ƒç”¨ä¸€äº›æ–¹æ³•å’Œå±æ€§æ“ä½œæ•°æ®. è¿™å°±è§£é‡Šäº† <i><b><code>é—®é¢˜ 1</code></b></i> .</p><h3>ç±»å‹æ£€æµ‹</h3><p><i><b>typeof</b></i> =&gt; åŸºæœ¬ç±»å‹çš„æ£€æµ‹å‡æœ‰åŒåçš„ä¸ä¹‹å¯¹åº”. <b>null</b> é™¤å¤–, nullæ˜¯å‡å€¼, ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªtypeofæ£€æµ‹ä¼šè¿”å› <code>&#39;object&#39;</code> çš„åŸºæœ¬æ•°æ®ç±»å‹å€¼.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">typeof</span> <span class=\"kc\">null</span> <span class=\"c1\">// &#34;object&#34;\n</span><span class=\"c1\"></span>\n<span class=\"kd\">let</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"p\">;</span>\n<span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">a</span> <span class=\"o\">&amp;&amp;</span> <span class=\"k\">typeof</span> <span class=\"nx\">a</span> <span class=\"o\">===</span> <span class=\"s1\">&#39;object&#39;</span><span class=\"p\">)</span> <span class=\"c1\">// true\n</span></code></pre></div><p>å¤æ‚æ•°æ®ç±»å‹typeofæ£€æµ‹è¿”å› <code>&#39;object&#39;</code>, function(å‡½æ•°)é™¤å¤–. å‡½æ•°å› å†…éƒ¨å±æ€§[[Call]]ä½¿å…¶å¯è¢«è°ƒç”¨, å…¶å®å±äºå¯è°ƒç”¨å¯¹è±¡.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">typeof</span> <span class=\"kd\">function</span><span class=\"p\">(){}</span> <span class=\"c1\">// &#34;function&#34;\n</span></code></pre></div><p><i><b>Object.prototype.toString</b></i> =&gt; é€šè¿‡typeofæ£€æµ‹è¿”å›<code>&#39;object&#39;</code>çš„å¯¹è±¡ä¸­è¿˜å¯ä»¥ç»†åˆ†ä¸ºå¥½å¤šç§, ä»å†…å»ºå‡½æ•°å°±å¯ä»¥çŸ¥é“.å®ƒä»¬éƒ½åŒ…å«ä¸€ä¸ªå†…éƒ¨å±æ€§[[Class]], ä¸€èˆ¬é€šè¿‡Object.prototype.toString(...)æ¥æŸ¥çœ‹.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">str</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">String</span><span class=\"p\">(</span><span class=\"s1\">&#39;hello&#39;</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">num</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Number</span><span class=\"p\">(</span><span class=\"mi\">123</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">arr</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Array</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">);</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"nx\">str</span><span class=\"p\">))</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"nx\">num</span><span class=\"p\">))</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">))</span>\n\n<span class=\"c1\">// [object String]\n</span><span class=\"c1\">// [object Number]\n</span><span class=\"c1\">// [object Array]\n</span></code></pre></div><hr/><h2>æŠ½è±¡æ“ä½œ</h2><p>åœ¨æ•°æ®ç±»å‹è½¬æ¢æ—¶, å¤„ç†ä¸åŒçš„æ•°æ®è½¬æ¢éƒ½æœ‰å¯¹åº”çš„æŠ½è±¡æ“ä½œ(ä»…ä¾›å†…éƒ¨ä½¿ç”¨çš„æ“ä½œ), åœ¨è¿™é‡Œç”¨åˆ°çš„åŒ…æ‹¬ <b>ToPrimitive</b>, <b>ToString</b>, <b>ToNumber</b>, <b>ToBoolean</b> (è¯¦è§ <code>ecma</code> è§„èŒƒ). è¿™äº›æŠ½è±¡æ“ä½œå®šä¹‰äº†ä¸€äº›è½¬æ¢è§„åˆ™, ä¸è®ºæ˜¯æ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬æ¢, è¿˜æ˜¯éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢, æ— ä¸€ä¾‹å¤–éƒ½éµå¾ªäº†è¿™äº›è§„åˆ™. è¿™é‡Œå°±è§£é‡Šäº† <b><code><i>é—®é¢˜ 5</i></code></b> å’Œ <b><code><i>é—®é¢˜ 6</i></code></b> .</p><h3>ToPrimitive</h3><p>è¯¥æŠ½è±¡æ“ä½œæ˜¯å°†ä¼ å…¥çš„å‚æ•°è½¬æ¢ä¸ºéå¯¹è±¡çš„æ•°æ®. å½“ä¼ å…¥çš„å‚æ•°ä¸º Object æ—¶, å®ƒä¼šè°ƒç”¨å†…éƒ¨æ–¹æ³•<code>[[DefaultValue]]</code> éµå¾ªä¸€å®šè§„åˆ™è¿”å›éå¤æ‚æ•°æ®ç±»å‹, è§„åˆ™ <b>è¯¦è§(</b> <code><b>ecma</b></code> <b>è§„èŒƒ: DefaultValue)</b>. æ•… <b>ToString</b>, <b>ToNumber</b>, <b>ToBoolean</b>åœ¨å¤„ç†Objectæ—¶, ä¼šå…ˆç»è¿‡<b>ToPrimitive</b>å¤„ç†è¿”å›åŸºæœ¬ç±»å‹å€¼.</p><p><b><code>[[DefaultValue]](hint)</code>è¯­æ³•:</b></p><p><code>[[DefaultValue]]</code>çš„è§„åˆ™ä¼šä¾èµ–äºä¼ å…¥çš„å‚æ•°<code>hint</code>, <b>ToString</b>ä¼ å…¥çš„ <code>hint</code> å€¼ä¸º <code>String</code>, <b>ToNumber</b>ä¼ å…¥çš„ <code>hint</code> å€¼ä¸º <code>Number</code>.</p><ol><li><code>[[DefaultValue]](String)</code> =&gt; è‹¥ <code>toString</code> å¯è°ƒç”¨, ä¸” <code>toString(Obj)</code> ä¸ºåŸºæœ¬ç±»å‹å€¼, åˆ™è¿”å›è¯¥åŸºæœ¬ç±»å‹å€¼. å¦åˆ™, è‹¥ <code>valueOf</code> å¯è°ƒç”¨, ä¸” <code>valueOf(Obj)</code> ä¸ºåŸºæœ¬ç±»å‹å€¼, åˆ™è¿”å›è¯¥åŸºæœ¬ç±»å‹å€¼. è‹¥ä»¥ä¸Šå¤„ç†è¿˜æœªå¾—åˆ°åŸºæœ¬ç±»å‹å€¼, åˆ™æŠ›å‡º <code>TypeError</code>.</li><li><code>[[DefaultValue]](Number)</code> =&gt; è¯¥è§„åˆ™æ­£å¥½å’Œä¸Šè§„åˆ™è°ƒç”¨ <code>toString</code>, <code>valueOf</code> çš„é¡ºåºç›¸å. è‹¥ <code>valueOf</code> å¯è°ƒç”¨, ä¸” <code>valueOf(Obj)</code> ä¸ºåŸºæœ¬ç±»å‹å€¼, åˆ™è¿”å›è¯¥åŸºæœ¬ç±»å‹å€¼. å¦åˆ™, è‹¥ <code>toString</code> å¯è°ƒç”¨, ä¸” <code>toString(Obj)</code> ä¸ºåŸºæœ¬ç±»å‹å€¼, åˆ™è¿”å›è¯¥åŸºæœ¬ç±»å‹å€¼. è‹¥ä»¥ä¸Šå¤„ç†è¿˜æœªå¾—åˆ°åŸºæœ¬ç±»å‹å€¼, åˆ™æŠ›å‡º <code>TypeError</code>.</li><li><code>[[DefaultValue]]()</code> =&gt; æœªä¼ å‚æ—¶, æŒ‰ç…§ <code>hint</code>å€¼ä¸º <code>Number</code> å¤„ç†. <code>Date</code> å¯¹è±¡é™¤å¤–, æŒ‰ç…§<code>hint</code>å€¼ä¸º <code>String</code> å¤„ç†.</li></ol><p>ç°åœ¨æˆ‘ä»¬å°±ç”¨ä»¥ä¸Šçš„çŸ¥è¯†ç‚¹æ¥è§£é‡Š <i><b><code>é—®é¢˜ 3</code></b></i> æ˜¯ä»€ä¹ˆé¬¼.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"nb\">Number</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">valueOf</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">i</span><span class=\"o\">++</span>\n<span class=\"p\">};</span>\n<span class=\"kd\">let</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Number</span><span class=\"p\">(</span><span class=\"s2\">&#34;0&#34;</span><span class=\"p\">);</span> <span class=\"c1\">// å­—ç¬¦ä¸²å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—ç±»å‹æ˜¯ä¸æ‰§è¡ŒToprimitiveæŠ½è±¡æ“ä½œçš„.\n</span><span class=\"c1\"></span><span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;a_1:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">a</span><span class=\"p\">);</span>\n<span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">a</span> <span class=\"o\">==</span> <span class=\"mi\">1</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">a</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;a==1 &amp; a==2&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;i:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">i</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// a==1 &amp; a==2 i: 3\n</span></code></pre></div><p>æˆ‘ä»¬æ”¹å†™äº†å†…å»ºå‡½æ•° <i><b>Number</b></i> åŸå‹ä¸Šçš„ <code>valueOf</code> æ–¹æ³•, å¹¶ä½¿å¾—ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆ <i><b>Number</b></i> å¯¹è±¡, ç¬¬ä¸€æ¬¡ <i><b>Object</b></i> ç±»å‹å’Œ <i><b>Number</b></i> ç±»å‹åšæ¯”è¾ƒæ—¶, <i><b>Object</b></i> ç±»å‹å°†è¿›è¡Œ <i><b>ToPrimitive</b></i> å¤„ç†(å‚è§(#æŠ½è±¡ç›¸ç­‰)), å†…éƒ¨è°ƒç”¨äº† <i><b>valueOf</b></i>, è¿”å› <i><b>2</b></i>. ç¬¬äºŒæ¬¡åŒæ ·çš„å¤„ç†æ–¹å¼, è¿”å› <i><b>3</b></i>.</p><h3>ToString</h3><p>è¯¥æŠ½è±¡æ“ä½œè´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢.</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-8b8725a0b7f0285d2f4ce64d82b0654a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1804\" data-rawheight=\"642\" class=\"origin_image zh-lightbox-thumb\" width=\"1804\" data-original=\"https://pic3.zhimg.com/v2-8b8725a0b7f0285d2f4ce64d82b0654a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1804&#39; height=&#39;642&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1804\" data-rawheight=\"642\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1804\" data-original=\"https://pic3.zhimg.com/v2-8b8725a0b7f0285d2f4ce64d82b0654a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-8b8725a0b7f0285d2f4ce64d82b0654a_b.jpg\"/></figure><h3>ToNumber</h3><p>è¯¥æŠ½è±¡æ“ä½œè´Ÿè´£å¤„ç†éæ•°å­—åˆ°æ•°å­—çš„è½¬æ¢.</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b07fd26dcf30aedc625fba429b146bef_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1806\" data-rawheight=\"642\" class=\"origin_image zh-lightbox-thumb\" width=\"1806\" data-original=\"https://pic4.zhimg.com/v2-b07fd26dcf30aedc625fba429b146bef_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1806&#39; height=&#39;642&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1806\" data-rawheight=\"642\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1806\" data-original=\"https://pic4.zhimg.com/v2-b07fd26dcf30aedc625fba429b146bef_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b07fd26dcf30aedc625fba429b146bef_b.jpg\"/></figure><p><b>å¸¸è§çš„å­—ç¬¦ä¸²è½¬æ¢æ•°å­—:</b></p><ol><li>å­—ç¬¦ä¸²æ˜¯ç©ºçš„ =&gt; è½¬æ¢ä¸º0.</li><li>å­—ç¬¦ä¸²åªåŒ…å«æ•°å­— =&gt; è½¬æ¢ä¸ºåè¿›åˆ¶æ•°å€¼.</li><li>å­—ç¬¦ä¸²åŒ…å«æœ‰æ•ˆçš„æµ®ç‚¹æ ¼å¼ =&gt; è½¬æ¢ä¸ºå¯¹åº”çš„æµ®ç‚¹æ•°å€¼.</li><li>å­—ç¬¦ä¸²ä¸­åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶æ ¼å¼ =&gt; è½¬æ¢ä¸ºç›¸åŒå¤§å°çš„åè¿›åˆ¶æ•´æ•°å€¼.</li><li>å­—ç¬¦ä¸²ä¸­åŒ…å«é™¤ä»¥ä¸Šæ ¼å¼ä¹‹å¤–çš„ç¬¦å· =&gt; è½¬æ¢ä¸º NaN.</li></ol><h3>ToBoolean</h3><p>è¯¥æŠ½è±¡æ“ä½œè´Ÿè´£å¤„ç†éå¸ƒå°”å€¼åˆ°å¸ƒå°”å€¼è½¬æ¢.</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-dfdc7390cb587faf6bf3cafa01897b6b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1804\" data-rawheight=\"640\" class=\"origin_image zh-lightbox-thumb\" width=\"1804\" data-original=\"https://pic4.zhimg.com/v2-dfdc7390cb587faf6bf3cafa01897b6b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1804&#39; height=&#39;640&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1804\" data-rawheight=\"640\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1804\" data-original=\"https://pic4.zhimg.com/v2-dfdc7390cb587faf6bf3cafa01897b6b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-dfdc7390cb587faf6bf3cafa01897b6b_b.jpg\"/></figure><p><b>çœŸå€¼</b> &amp; <b>å‡å€¼</b></p><p>å‡å€¼(å¼ºåˆ¶ç±»å‹è½¬æ¢<b>false</b>çš„å€¼) =&gt; <code>undefined</code>, <code>null</code>, <code>false</code>, <code>+0</code>, <code>-0</code>, <code>NaN</code>, <code>&#34;&#34;</code>. çœŸå€¼(å¼ºåˆ¶ç±»å‹è½¬æ¢<b>true</b>çš„å€¼) =&gt; é™¤äº†å‡å€¼, éƒ½æ˜¯çœŸå€¼.</p><p><i><b>ç‰¹æ®Šçš„å­˜åœ¨</b></i></p><p>å‡å€¼å¯¹è±¡ =&gt; documen.all ç­‰. eg: <code>Boolean(window.all)</code> // false</p><hr/><h2>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢</h2><h3>+/-/!/~</h3><ol><li><b><code>+/- ä¸€å…ƒè¿ç®—ç¬¦</code></b> =&gt; è¿ç®—ç¬¦ä¼šå°†æ“ä½œæ•°è¿›è¡ŒToNumberå¤„ç†.</li><li><b><code>!</code></b> =&gt; ä¼šå°†æ“ä½œæ•°è¿›è¡ŒToBooleanå¤„ç†.</li><li><b><code>~</code></b> =&gt; (~x)ç›¸å½“äº -(x + 1) eg: ~(-1) ==&gt; 0; ~(0) ==&gt; 1; åœ¨if (...)ä¸­ä½œç±»å‹è½¬æ¢æ—¶, åªæœ‰<code>-1</code>æ—¶, æ‰ä¸ºå‡å€¼.</li><li><b><code>+åŠ å·è¿ç®—ç¬¦</code></b> =&gt; è‹¥æ“ä½œæ•°æœ‰Stringç±»å‹, åˆ™éƒ½è¿›è¡ŒToStringå¤„ç†, å­—ç¬¦ä¸²æ‹¼æ¥. å¦åˆ™è¿›è¡ŒToNumberå¤„ç†, æ•°å­—åŠ æ³•.</li></ol><h3>æ¡ä»¶åˆ¤æ–­</h3><ol><li><code>if (...)</code>, <code>for(;;;)</code>, <code>while(...)</code>, <code>do...while(...)</code>ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼.</li><li><code>? :</code> ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼.</li><li><code>||</code> å’Œ <code>&amp;&amp;</code> ä¸­çš„ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼.</li></ol><p>ä»¥ä¸Šéµå¾ª <i><b>ToBoolean</b></i> è§„åˆ™.</p><h3>||å’Œ&amp;&amp;</h3><ol><li>è¿”å›å€¼æ˜¯ä¸¤ä¸ªæ“ä½œæ•°çš„ä¸­çš„ä¸€ä¸ª(ä¸”ä»…ä¸€ä¸ª). é¦–å…ˆå¯¹ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ¡ä»¶åˆ¤æ–­, è‹¥ä¸ºéå¸ƒå°”å€¼åˆ™è¿›è¡ŒToBooleanå¼ºåˆ¶ç±»å‹è½¬æ¢.å†æ¡ä»¶åˆ¤æ–­.</li><li><b><code>||</code></b> =&gt; æ¡ä»¶åˆ¤æ–­ä¸ºtrue, åˆ™è¿”å›ç¬¬ä¸€ä¸ªæ“ä½œæ•°; å¦åˆ™, è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°. ç›¸å½“äº a ? a : b;</li><li><b><code>&amp;&amp;</code></b> =&gt; æ¡ä»¶åˆ¤æ–­ä¸ºtrue, åˆ™è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°; å¦åˆ™, è¿”å›ç¬¬ä¸€ä¸ªæ“ä½œæ•°, ç›¸å½“äº a ? b : a;</li></ol><p>ç»“åˆæ¡ä»¶åˆ¤æ–­, è§£é‡Šä¸‹ <i><b><code>é—®é¢˜ 2</code></b></i></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">;</span>\n<span class=\"kd\">let</span> <span class=\"nx\">b</span> <span class=\"o\">=</span> <span class=\"kc\">undefined</span><span class=\"p\">;</span>\n<span class=\"kd\">let</span> <span class=\"nx\">c</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;hello&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">a</span> <span class=\"o\">&amp;&amp;</span> <span class=\"p\">(</span><span class=\"nx\">b</span> <span class=\"o\">||</span> <span class=\"nx\">c</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n    <span class=\"nx\">dosomething</span><span class=\"p\">()</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">a</span> <span class=\"o\">&amp;&amp;</span> <span class=\"p\">(</span><span class=\"nx\">b</span> <span class=\"o\">||</span> <span class=\"nx\">c</span><span class=\"p\">)</span> <span class=\"nx\">è¿”å›</span> <span class=\"s1\">&#39;hello&#39;</span><span class=\"p\">,</span> <span class=\"nx\">ifè¯­å¥ä¸­ç»Tobooleanå¤„ç†å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºtrue</span><span class=\"p\">.</span>\n</code></pre></div><h3>æŠ½è±¡ç›¸ç­‰</h3><p>è¿™é‡Œçš„çŸ¥è¯†ç‚¹æ˜¯ç”¨æ¥è§£é‡Š <i><b>é—®é¢˜ 4</b></i> çš„, ä¹Ÿæ˜¯è€ƒéªŒäººå“çš„åœ°æ–¹. è¿™ä¸‹æˆ‘ä»¬è¦é å®åŠ›æ‹¼è¿æ°”.</p><ol><li>åŒç±»å‹çš„æ¯”è¾ƒ.+0 == -0 // true null == null // true undefined == undefined // true NaN == NaN // false, å”¯ä¸€ä¸€ä¸ªéè‡ªåçš„å€¼</li><li><i><b>null</b></i> å’Œ <i><b>undefined</b></i> çš„æ¯”è¾ƒ.null == undefined // true undefined == null // true</li><li><i><b>Number</b></i> ç±»å‹å’Œ <i><b>String</b></i> ç±»å‹çš„æ¯”è¾ƒ. =&gt; <i><b>String</b></i> ç±»å‹è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º <i><b>Number</b></i> ç±»å‹, å³ <i><b>ToNumber(String)</b></i> .(å‚è§(#ToNumber))</li><li><i><b>Boolean</b></i> ç±»å‹å’Œå…¶å®ƒç±»å‹çš„æ¯”è¾ƒ. =&gt; <i><b>Boolean</b></i> ç±»å‹è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º <i><b>Number</b></i> ç±»å‹, å³ <i><b>ToNumber(Boolean)</b></i> .(å‚è§(#ToNumber))</li><li><i><b>Object</b></i> ç±»å‹å’Œ <i><b>String</b></i> ç±»å‹æˆ– <i><b>Number</b></i> ç±»å‹. =&gt; <i><b>Object</b></i> ç±»å‹è¦å¼ºåˆ¶è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹å€¼, å³ <i><b>ToPrimitive(Object)</b></i> .(å‚è§(#ToPrimitive))</li><li>å…¶å®ƒæƒ…å†µ, <i><b>false</b></i>.</li></ol><p>å›å¤´çœ‹çœ‹ <i><b>é—®é¢˜ 4</b></i> ä¸­çš„ç­‰å¼. <code>[] == ![]</code>, <code>false == []</code>, <code>&#34;0&#34; == false</code>. <code>[] == ![]</code> =&gt; <code>!</code> æ“ä½œç¬¦ä¼šå¯¹æ“ä½œæ•°è¿›è¡Œ <i><b>ToBoolean</b></i> å¤„ç†, <code>[]</code> æ˜¯çœŸå€¼, <code>!true</code> åˆ™ä¸º <i><b>false</b></i>. å†éµå¾ªç¬¬ <i><b>4</b></i> ç‚¹, <i><b>Boolean</b></i> ç±»å‹ç»è¿‡ <i><b>ToNumber</b></i> è½¬æ¢ä¸º <i><b>Number</b></i> ç±»å‹, åˆ™ä¸ºæ•°å€¼ <code>0</code>. å†éµå¾ªç¬¬ <i><b>5</b></i> ç‚¹, å¯¹ <code>[]</code> è¿›è¡Œ <i><b>ToPrimitive</b></i> æ“ä½œ, å…ˆåè°ƒç”¨ <code>valueOf()</code>, <code>toString()</code>ç›´åˆ°è¿”å›åŸºæœ¬ç±»å‹, ç›´åˆ°è¿”å› <code>&#34;&#34;</code>. <i>(å…ˆ[].valueOf() =&gt; [], éåŸºæœ¬ç±»å‹å€¼; å†[].toString() =&gt; &#34;&#34;, åŸºæœ¬ç±»å‹å€¼, è¿”å›è¯¥åŸºæœ¬ç±»å‹å€¼.)</i>. å†éµå¾ªç¬¬ <i><b>3</b></i> ç‚¹, å¯¹ <code>&#34;&#34;</code> è¿›è¡Œ <i><b>ToNumber</b></i> å¤„ç†, åˆ™ä¸ºæ•°å€¼ <code>0</code>. åˆ°æ­¤, <code>0 == 0</code>, å†éµå¾ªç¬¬ <i><b>1</b></i> ç‚¹(å…¶å®æ²¡å†™å…¨ğŸ˜Œ, è¯¦è§(è¯¦è§ <code>ecma</code> è§„èŒƒ: The Abstract Equality Comparison Algorithm)), return true, å®Œç¾!ğŸ˜. <code>false == []</code> =&gt; åŒç† <code>[] == ![]</code>. <code>&#34;0&#34; == false</code> =&gt; åŒç† <code>[] == ![]</code>.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"p\">[]</span> <span class=\"o\">==</span> <span class=\"o\">!</span><span class=\"p\">[]</span>   <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"kc\">false</span> <span class=\"o\">==</span> <span class=\"p\">[]</span> <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"s2\">&#34;0&#34;</span> <span class=\"o\">==</span> <span class=\"kc\">false</span>    <span class=\"c1\">// true\n</span></code></pre></div><hr/><p>over!</p>", 
            "topic": [
                {
                    "tag": "åŸç”Ÿ JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19691834"
                }, 
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/76620620", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 7, 
            "title": "å°ç¨‹åºäº‘å¼€å‘ä¹‹å§‹æœ«", 
            "content": "<h2>å‰è¨€</h2><p>åœ¨å­¦ä¹ å°ç¨‹åºå¼€å‘æ—¶ï¼Œå€’æ˜¯æ²¡è§‰å¾—æœ‰ä»€ä¹ˆé˜»ç¢ï¼Œæ¯•ç«Ÿå‰ç«¯çš„æœ€æµè¡Œçš„æ¡†æ¶å·²ç»æµè¡Œäº†é‚£ä¹ˆå¤šå¹´äº†ï¼Œä»æŸäº›æ–¹é¢ï¼Œå®ƒä»¬æ˜¯ç›¸ä¼¼çš„ã€‚æœ¬æ¬¡æ‰€å¼€å‘çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯å°±æ•´ä¸ªæµç¨‹æ¥è¯´å´æ˜¯å¾ˆæ¼«é•¿çš„ï¼Œç”±äºæ˜¯ä»é›¶å¼€å§‹å¼€å‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶é—´è¿˜æ˜¯èŠ±åœ¨äº†äº§å“çš„æ„æ€ä¸Šå’Œå°ç¨‹åºä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ä¸Šã€‚è€Œä¸”ï¼Œè¿™æ¬¡çš„å¼€å‘åªå®Œæˆäº†äº§å“é¢„æƒ³çš„ 50% å·¦å³ï¼Œæ ¸å¿ƒçš„éƒ¨åˆ†åŸºæœ¬æ²¡æœ‰å»åšã€‚æœ€å¤§çš„åŸå› å¯èƒ½å°±æ˜¯å¼€å‘ä½“éªŒä¸å¥½ï¼Œæµªè´¹æ—¶é—´ã€‚</p><h2>å°ç¨‹åºäº‘å¼€å‘</h2><p>å¯¹äºä¸ªäººå¼€å‘äººå‘˜æ¥è¯´ï¼Œå°ç¨‹åºäº‘å¼€å‘é™ä½äº†å¼€å‘é—¨æ§›ï¼Œå°¤å…¶æ˜¯å‰ç«¯äººå‘˜çš„é—¨æ§›ã€‚åŸºäºäº‘å¼€å‘ï¼Œå‰ç«¯äººå‘˜å¯ä»¥å®Œæˆä»å‰ç«¯åˆ°åå°çš„æ‰€æœ‰ä»»åŠ¡ã€‚å°ç¨‹åºäº‘å¹³å°æœ‰ç€ Nodeç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆåŸºäº node çš„åå°ç¯å¢ƒã€‚ ä»¥çˆ¬è™«ä¸ºä¾‹ï¼Œé¦–å…ˆåœ¨ cloudfunctions æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ crawlerï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹é¢åœ¨åˆ›å»ºåˆ›å»ºç›¸åº” <code>crawler.js</code> ã€<code>package.json</code> æ–‡ä»¶ï¼Œå‰©ä¸‹å°±å¯ä»¥å†™äº›é€»è¾‘äº†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// äº‘å‡½æ•°å…¥å£æ–‡ä»¶\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">cloud</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">&#39;wx-server-sdk&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">const</span> <span class=\"nx\">Crawler</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s2\">&#34;crawler&#34;</span><span class=\"p\">);</span>\n<span class=\"nx\">cloud</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">()</span>\n<span class=\"k\">const</span> <span class=\"nx\">uriArray</span> <span class=\"o\">=</span> <span class=\"p\">[{</span> <span class=\"nx\">uri</span><span class=\"o\">:</span> <span class=\"s1\">&#39;http://www.nows.fun/&#39;</span><span class=\"p\">,</span> <span class=\"nx\">selector</span><span class=\"o\">:</span> <span class=\"s1\">&#39;#sentence&#39;</span> <span class=\"p\">},</span> \n<span class=\"p\">{</span> <span class=\"nx\">uri</span><span class=\"o\">:</span> <span class=\"s1\">&#39;https://www.nihaowua.com/&#39;</span><span class=\"p\">,</span> <span class=\"nx\">selector</span><span class=\"o\">:</span> <span class=\"s1\">&#39;body &gt; div &gt; section &gt; div&#39;</span> <span class=\"p\">},</span> \n<span class=\"p\">{</span> <span class=\"nx\">uri</span><span class=\"o\">:</span> <span class=\"s1\">&#39;https://www.nihaowua.com/home.html&#39;</span><span class=\"p\">,</span> <span class=\"nx\">selector</span><span class=\"o\">:</span> <span class=\"s1\">&#39;body &gt; div &gt; section &gt; div&#39;</span> <span class=\"p\">}];</span>\n\n<span class=\"kd\">let</span> <span class=\"nx\">crawler</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Crawler</span><span class=\"p\">();</span>\n<span class=\"kd\">let</span> <span class=\"nx\">canClick</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">;</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">crawlerWebPage</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">canClick</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"p\">;</span>\n  <span class=\"nx\">canClick</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"p\">;</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">index</span> <span class=\"o\">=</span> <span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">floor</span><span class=\"p\">(</span><span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">random</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mi\">3</span><span class=\"p\">);</span>\n  <span class=\"kd\">let</span> <span class=\"p\">{</span> <span class=\"nx\">uri</span><span class=\"p\">,</span> <span class=\"nx\">selector</span> <span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"nx\">uriArray</span><span class=\"p\">[</span><span class=\"nx\">index</span><span class=\"p\">];</span>\n  <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nb\">Promise</span><span class=\"p\">((</span><span class=\"nx\">resolve</span><span class=\"p\">,</span> <span class=\"nx\">reject</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">crawler</span><span class=\"p\">.</span><span class=\"nx\">direct</span><span class=\"p\">({</span>\n      <span class=\"nx\">uri</span><span class=\"o\">:</span> <span class=\"nx\">uri</span><span class=\"p\">,</span>\n      <span class=\"nx\">retries</span><span class=\"o\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n      <span class=\"nx\">timeout</span><span class=\"o\">:</span> <span class=\"mi\">5000</span><span class=\"p\">,</span>\n      <span class=\"nx\">skipEventRequest</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n      <span class=\"nx\">callback</span><span class=\"o\">:</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">,</span> <span class=\"nx\">response</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">canClick</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">;</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n          <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span>\n        <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n          <span class=\"kd\">var</span> <span class=\"nx\">$</span> <span class=\"o\">=</span> <span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">$</span><span class=\"p\">;</span>\n          <span class=\"kd\">var</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"nx\">$</span><span class=\"p\">(</span><span class=\"nx\">selector</span><span class=\"p\">).</span><span class=\"nx\">text</span><span class=\"p\">();</span>\n          <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;index&#39;</span><span class=\"p\">,</span> <span class=\"nx\">index</span><span class=\"p\">)</span>\n          <span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">content</span><span class=\"p\">);</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">})</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">};</span>\n\n<span class=\"nx\">exports</span><span class=\"p\">.</span><span class=\"nx\">main</span> <span class=\"o\">=</span> <span class=\"kr\">async</span> <span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"k\">const</span> <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">crawlerWebPage</span><span class=\"p\">();</span>\n  <span class=\"k\">return</span> <span class=\"nx\">result</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>äº‘å‡½æ•°åˆ›å»ºå¥½äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯åœ¨å°ç¨‹åºä¸­å»è°ƒç”¨äº†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">refresh</span><span class=\"o\">:</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">obj</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">canClick</span><span class=\"p\">)</span> <span class=\"k\">return</span><span class=\"p\">;</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">setData</span><span class=\"p\">({</span>\n      <span class=\"nx\">canClick</span><span class=\"o\">:</span> <span class=\"kc\">false</span>\n    <span class=\"p\">})</span>\n    <span class=\"nx\">wx</span><span class=\"p\">.</span><span class=\"nx\">showLoading</span><span class=\"p\">({</span>\n      <span class=\"nx\">title</span><span class=\"o\">:</span> <span class=\"s1\">&#39;åŠ è½½ä¸­&#39;</span><span class=\"p\">,</span>\n    <span class=\"p\">})</span>\n    <span class=\"nx\">wx</span><span class=\"p\">.</span><span class=\"nx\">cloud</span><span class=\"p\">.</span><span class=\"nx\">callFunction</span><span class=\"p\">({</span>\n      <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s2\">&#34;crawler&#34;</span><span class=\"p\">,</span>\n      <span class=\"nx\">success</span><span class=\"o\">:</span> <span class=\"nx\">res</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"nx\">wx</span><span class=\"p\">.</span><span class=\"nx\">hideLoading</span><span class=\"p\">();</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">setData</span><span class=\"p\">({</span>\n          <span class=\"nx\">soup</span><span class=\"o\">:</span> <span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nx\">result</span><span class=\"p\">,</span>\n          <span class=\"nx\">canClick</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n        <span class=\"p\">})</span>\n      <span class=\"p\">},</span>\n      <span class=\"nx\">fail</span><span class=\"o\">:</span> <span class=\"nx\">err</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"nx\">wx</span><span class=\"p\">.</span><span class=\"nx\">hideLoading</span><span class=\"p\">();</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">setData</span><span class=\"p\">({</span>\n          <span class=\"nx\">soup</span><span class=\"o\">:</span> <span class=\"s2\">&#34;é¸¡æ±¤è¦ä¸€å£ä¸€å£å–ï¼Œä½ å¤ªæ€¥å•¦&#34;</span><span class=\"p\">,</span>\n          <span class=\"nx\">canClick</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n        <span class=\"p\">})</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">error</span><span class=\"p\">(</span><span class=\"s1\">&#39;[äº‘å‡½æ•°] [crawler] templateMessage.send è°ƒç”¨å¤±è´¥ï¼š&#39;</span><span class=\"p\">,</span> <span class=\"nx\">err</span><span class=\"p\">)</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">})</span>\n  <span class=\"p\">}</span>\n</code></pre></div><h2>å°ç¨‹åºä¸­çš„ç»„ä»¶</h2><p>åˆšå¼€å§‹æ¥è§¦å°ç¨‹åºæ—¶ï¼Œç»™æˆ‘çš„æ„Ÿè§‰åƒæ˜¯åœ¨å¼€å‘ä¸€ä¸ªå¤šé¡µé¢åº”ç”¨ã€‚åœ¨å¼€å‘æ„æ€çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å†™çš„é€»è¾‘è¶Šæ¥è¶Šå¤šã€‚äºæ˜¯å°±æƒ³ç€æŠŠè¿™ä¹ˆå¤šçš„ä¸œè¥¿æ‹†å¼€ï¼Œç¿»äº†ä¸‹æ–‡æ¡£ï¼Œå‘ç°å°ç¨‹åºæåˆ°è‡ªå®šä¹‰ç»„ä»¶æ¯”è¾ƒé€‚åˆã€‚ é¦–å…ˆåœ¨çˆ¶ç»„ä»¶ä¸­é…ç½®æ–‡ä»¶ä¸­é…ç½®å­ç»„ä»¶è·¯å¾„ï¼Œç„¶åè‡ªç»„ä»¶ä¹Ÿè¦é…ç½®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-json\"><span class=\"err\">//</span> <span class=\"err\">father.json</span>\n<span class=\"p\">{</span>\n  <span class=\"nt\">&#34;usingComponents&#34;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">&#34;type-year&#34;</span><span class=\"p\">:</span> <span class=\"s2\">&#34;../../component/type-year/type-year&#34;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&#34;type-month&#34;</span><span class=\"p\">:</span> <span class=\"s2\">&#34;../../component/type-month/type-month&#34;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&#34;type-date&#34;</span><span class=\"p\">:</span> <span class=\"s2\">&#34;../../component/type-date/type-date&#34;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"err\">//</span> <span class=\"err\">children.json</span>\n<span class=\"p\">{</span>\n  <span class=\"nt\">&#34;component&#34;</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n<span class=\"p\">}</span></code></pre></div><p>å‰©ä¸‹çš„å°±å’Œ Reactã€Vue ä¸­çš„è‡ªå®šä¹‰ç»„ä»¶å·®ä¸å¤šã€‚</p><p>ä»¥ä¸Šä¹Ÿåªæ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œå¹³æ—¶è¿˜ä¼šæ¥è§¦åˆ°ç¬¬ä¸‰æ–¹çš„ç»„ä»¶ï¼Œæ¯”å¦‚å¸¸ç”¨çš„ UI ç»„ä»¶ã€‚é€šå¸¸ç¬¬ä¸‰æ–¹ç»„ä»¶éƒ½æ˜¯ä½¿ç”¨ npm åŒ…ï¼Œä½†æ˜¯å°ç¨‹åºçš„ç¯å¢ƒæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä¸æ˜¯ Node ç¯å¢ƒï¼Œæ‰€ä»¥åŸºäº Node ç¯å¢ƒçš„ npm åŒ…ä¹Ÿè¦ç‰¹æ®Šå¤„ç†æ‰èƒ½å¤Ÿåœ¨å°ç¨‹åºåªèƒ½å¤Ÿä½¿ç”¨ã€‚å°½ç®¡å°ç¨‹åºå®˜æ–¹æä¾›äº† npm åŒ…è½¬æ¢çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ä¾ç„¶ä¼šæœ‰å¾ˆå¤šåŒ…ä¸èƒ½åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ï¼Œå…·ä½“å¯è§å®˜æ–¹å°ç¨‹åºå¼€å‘æ–‡æ¡£ã€‚</p><h2>å°ç¨‹åºä¸­æ“ä½œèŠ‚ç‚¹</h2><p>å°ç¨‹åºçš„æ¸²æŸ“å±‚å’Œé€»è¾‘å±‚åˆ†åˆ«ç”±2ä¸ªçº¿ç¨‹ç®¡ç†ï¼Œè¿™å’Œæµè§ˆå™¨çš„ç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¦æƒ³æ“ä½œèŠ‚ç‚¹éœ€è¦ä½¿ç”¨å°ç¨‹åºæä¾›çš„APIï¼Œä¸è¿‡åœ¨è·¨ç»„ä»¶è·å–èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">onLoad</span><span class=\"o\">:</span> <span class=\"kd\">function</span> <span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">height</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">yearChartHeight</span><span class=\"p\">,</span><span class=\"nx\">monthChartHeight</span><span class=\"p\">,</span><span class=\"nx\">componentHeight</span><span class=\"p\">;</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">query</span> <span class=\"o\">=</span> <span class=\"nx\">wx</span><span class=\"p\">.</span><span class=\"nx\">createSelectorQuery</span><span class=\"p\">().</span><span class=\"k\">in</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">);</span> <span class=\"c1\">// Note: æ“ä½œèŠ‚ç‚¹\n</span><span class=\"c1\"></span>  <span class=\"nx\">query</span><span class=\"p\">.</span><span class=\"nx\">selectAll</span><span class=\"p\">(</span><span class=\"s1\">&#39;#little_target, #target_type, #target_content&#39;</span><span class=\"p\">).</span><span class=\"nx\">boundingClientRect</span><span class=\"p\">(</span>\n    <span class=\"nx\">res</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n      <span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nx\">map</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"nx\">height</span><span class=\"p\">[</span><span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">id</span><span class=\"si\">}</span><span class=\"sb\">_height`</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">height</span><span class=\"p\">;</span>\n      <span class=\"p\">})</span>\n      <span class=\"nx\">yearChartHeight</span> <span class=\"o\">=</span> <span class=\"nx\">height</span><span class=\"p\">.</span><span class=\"nx\">little_target_height</span> <span class=\"o\">-</span> <span class=\"nx\">height</span><span class=\"p\">.</span><span class=\"nx\">target_content_height</span> <span class=\"o\">-</span> <span class=\"nx\">height</span><span class=\"p\">.</span><span class=\"nx\">target_type_height</span><span class=\"p\">;</span>\n\n      <span class=\"nx\">componentHeight</span> <span class=\"o\">=</span> <span class=\"nx\">monthChartHeight</span> <span class=\"o\">=</span> <span class=\"nx\">height</span><span class=\"p\">.</span><span class=\"nx\">little_target_height</span> <span class=\"o\">-</span> <span class=\"nx\">height</span><span class=\"p\">.</span><span class=\"nx\">target_type_height</span> <span class=\"o\">-</span> <span class=\"mi\">48</span><span class=\"p\">;</span>\n      <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">setData</span><span class=\"p\">({</span>\n        <span class=\"nx\">yearHeight</span><span class=\"o\">:</span> <span class=\"nx\">yearChartHeight</span><span class=\"p\">,</span>\n        <span class=\"nx\">monthHeight</span><span class=\"o\">:</span> <span class=\"nx\">monthChartHeight</span>\n      <span class=\"p\">})</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">).</span><span class=\"nx\">exec</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>ä¸Šé¢ä»£ç å°±æ˜¯é€šè¿‡ç›¸å…³çš„ API è·å–ä¸‰ä¸ªèŠ‚ç‚¹çš„æ•°æ®ã€‚</p><h2>å°ç¨‹åºä¸­ä½¿ç”¨ echarts</h2><p>å¯¹æ¯”äº† F2 å’Œ echartsï¼Œ å‘ç° echarts æä¾›çš„å›¾è¡¨æ›´å¤šä¸€äº›ã€‚è¿™ä¸¤ä¸ªå›¾è¡¨åº“çš„ä½¿ç”¨çš„æ–¹å¼ä¹Ÿä¸åŒï¼ŒF2 æ˜¯ npm åŒ…ï¼Œéœ€è¦è½¬æ¢å¯¼å…¥ä½¿ç”¨ã€‚echarts ä½¿ç”¨èµ·æ¥å°±ç›¸å¯¹ç®€å•ä¸€äº›ï¼Œå’Œä¸Šé¢æåˆ°çš„è‡ªå®šä¹‰ç»„ä»¶ä¸€æ ·ï¼Œè€Œä¸” echarts è¿˜å¯ä»¥è‡ªå®šä¹‰é€‰æ‹©éœ€è¦å›¾è¡¨å¯¼å‡ºï¼Œè¿™æ ·å°±å‡å°åŒ…çš„ä½“ç§¯ã€‚ åœ¨ä½¿ç”¨è¿™äº›å›¾è¡¨åº“æ—¶ï¼Œæ‰æ˜ç™½ä»€ä¹ˆå«åšè°ƒåƒå·¥ç¨‹å¸ˆï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­çœŸçš„æ˜¯è¾¹çœ‹æ–‡æ¡£è¾¹è°ƒæ•´å‚æ•°ã€‚åœ¨ä½¿ç”¨ echarts çš„è¿‡ç¨‹ä¸­ï¼Œæœ¬ä»¥ä¸ºcanvas å¯ä»¥æ’‘å¼€ç›’å­ï¼Œç»“æœå‘ç°éœ€è¦çˆ¶å…ƒç´ éœ€è¦æœ‰é«˜åº¦ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸Šé¢åŠ¨æ€è®¡ç®—ç›’å­é«˜åº¦ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c\">&lt;!--</span> <span class=\"nx\">init</span> <span class=\"mi\">1</span> <span class=\"o\">--&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"nx\">view</span> <span class=\"k\">class</span><span class=\"o\">=</span><span class=\"s2\">&#34;chart_wrap&#34;</span> <span class=\"nx\">style</span><span class=\"o\">=</span><span class=\"s2\">&#34;height:{{chartHeight}}px&#34;</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"nx\">ec</span><span class=\"o\">-</span><span class=\"nx\">canvas</span> <span class=\"nx\">id</span><span class=\"o\">=</span><span class=\"s2\">&#34;mychart-dom-bar&#34;</span> <span class=\"nx\">canvas</span><span class=\"o\">-</span><span class=\"nx\">id</span><span class=\"o\">=</span><span class=\"s2\">&#34;mychart-bar&#34;</span> <span class=\"nx\">ec</span><span class=\"o\">=</span><span class=\"s2\">&#34;{{ ec }}&#34;</span><span class=\"o\">&gt;&lt;</span><span class=\"err\">/ec-canvas&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">/view&gt;</span>\n<span class=\"c\">&lt;!--</span> \n<span class=\"nx\">data</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"nx\">ec</span><span class=\"o\">:</span> <span class=\"p\">{</span> <span class=\"nx\">onInit</span><span class=\"o\">:</span> <span class=\"nx\">initChart</span> <span class=\"p\">}</span>\n  <span class=\"p\">},</span>\n   <span class=\"o\">--&gt;</span>\n\n<span class=\"c\">&lt;!--</span> <span class=\"nx\">init</span> <span class=\"mi\">2</span><span class=\"o\">--&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"nx\">view</span> <span class=\"k\">class</span><span class=\"o\">=</span><span class=\"s2\">&#34;chart_wrap&#34;</span> <span class=\"nx\">style</span><span class=\"o\">=</span><span class=\"s2\">&#34;height:{{chartHeight}}px&#34;</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"nx\">ec</span><span class=\"o\">-</span><span class=\"nx\">canvas</span> <span class=\"nx\">id</span><span class=\"o\">=</span><span class=\"s2\">&#34;mychart-dom-bar&#34;</span> <span class=\"nx\">canvas</span><span class=\"o\">-</span><span class=\"nx\">id</span><span class=\"o\">=</span><span class=\"s2\">&#34;mychart-bar&#34;</span> <span class=\"nx\">ec</span><span class=\"o\">=</span><span class=\"s2\">&#34;{{ ec }}&#34;</span> <span class=\"nx\">bind</span><span class=\"o\">:</span><span class=\"nx\">init</span><span class=\"o\">=</span><span class=\"s2\">&#34;echartInit&#34;</span><span class=\"o\">&gt;&lt;</span><span class=\"err\">/ec-canvas&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">/view&gt;</span>\n</code></pre></div><p>åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œåˆå§‹åŒ–çš„æ–¹å¼å¹¶ä¸æƒŸä¸€ï¼Œç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p><h2>å°ç¨‹åºçš„å¼€å‘ä½“éªŒ</h2><p>å°ç¨‹åºçš„å¼€å‘å·¥å…·çœŸå¿ƒä¸æ€ä¹ˆæ ·ï¼Œä»æ—¥å¸¸ chrome å¼€å‘è€…å·¥å…·å†åˆ°å°ç¨‹åºçš„å¼€å‘è€…å·¥å…·ï¼Œè¿™å…¶ä¸­çš„å·®è·è¿˜æ˜¯å¾ˆå¤§ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬ä¸èƒ½æ–¹ä¾¿éšæ„åœ°ä½¿ç”¨ npm åŒ…ï¼Œè¿™åœ¨å°ç¨‹åºä¸­é™åˆ¶å¾ˆæ˜æ˜¾ã€‚ åæ­£é—®é¢˜å¾ˆå¤šã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-5189d8dac558db30c993b3b2570b378a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"258\" data-rawheight=\"258\" class=\"content_image\" width=\"258\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;258&#39; height=&#39;258&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"258\" data-rawheight=\"258\" class=\"content_image lazy\" width=\"258\" data-actualsrc=\"https://pic3.zhimg.com/v2-5189d8dac558db30c993b3b2570b378a_b.jpg\"/></figure><p>overï¼</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å°ç¨‹åºå¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/20182216"
                }
            ], 
            "comments": [
                {
                    "userName": "è…¾è®¯äº‘äº‘å¼€å‘", 
                    "userLink": "https://www.zhihu.com/people/67fe9e3c8edd72b7a4f2d4a69b10ce9b", 
                    "content": "<p>å¼€å‘è€…å·¥å…·ç¡®å®ä½“éªŒä¸å¤§å¥½ï¼Œä¸è¿‡ç›¸æ¯”ä¸€å¹´å‰ï¼Œå·²ç»å¥½ç”¨äº†å¤ªå¤šï¼Œç°åœ¨ä¹Ÿåœ¨ä¸æ–­å®Œå–„ã€‚å¸Œæœ›æœ‰æ›´å¤šäººä½¿ç”¨å°ç¨‹åºçš„äº‘å¼€å‘ï¼Œäº«å—æŠ€æœ¯åˆ›é€ çš„å¿«æ„Ÿ~</p><a class=\"comment_sticker\" href=\"https://pic1.zhimg.com/v2-12562ad40366818a1ea39bcecb2599a0.gif\" data-width=\"\" data-height=\"\">[å®³ç¾]</a>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<a class=\"comment_sticker\" href=\"https://pic4.zhimg.com/v2-fa3cb6bc9ec57da84ab53a60f48d0c6f.gif\" data-width=\"\" data-height=\"\">[æ£’]</a>", 
                            "likes": 0, 
                            "replyToAuthor": "è…¾è®¯äº‘äº‘å¼€å‘"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/76619611", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 9, 
            "title": "Nodeçˆ¬è™«", 
            "content": "<h2>å‰è¨€</h2><p>æœ€è¿‘ä¸€æ®µæ—¶é—´åœ¨å­¦ä¹ å°ç¨‹åºï¼Œæ–‡æ¡£å¾ˆé•¿ï¼Œä½†æ˜¯å¯¹äºå‰ç«¯å¼€å‘è€…æ¥è¯´ï¼Œå¹¶ä¸æ˜¯å¾ˆéš¾ã€‚ç„¶è€Œåœ¨å‡†å¤‡å®è·µçš„æ—¶å€™ï¼Œå´çŠ¯éš¾äº†ã€‚è™½ç„¶åªæ˜¯ç»ƒæ‰‹ï¼Œä½†èµ·ç è¦åšä¸€ä¸ªæœ‰æ„ä¹‰çš„ä¸œè¥¿ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€æ—¶é—´ï¼Œå°±æƒ³åˆ°åˆ©ç”¨çˆ¬è™«æ¥çˆ¬å–è‡ªå·±æƒ³è¦çš„å†…å®¹ã€‚åœ¨æ‰“ç®—å®è·µæ—¶ï¼Œå´ä¹Ÿå‘ç°ï¼Œç”±äºå°ç¨‹åºçš„çš„ä¸€äº›é™åˆ¶ï¼Œè¦æƒ³å®ç°æˆ‘çš„æƒ³æ³•ï¼Œå¤ªéº»çƒ¦ï¼Œå¯¹äºæˆ‘æ¥è¯´ï¼Œæœ‰ç‚¹æµªè´¹æ—¶é—´ã€‚ä¸è¿‡ï¼Œæ—¢ç„¶éƒ½æƒ³åˆ°è¿‡çˆ¬è™«äº†ï¼Œå°±è¶è¿™æ¬¡æœºä¼šç»ƒç»ƒæ‰‹ã€‚</p><p>é€šè¿‡æœ¬æ¬¡çš„ç²—æµ…çš„å®è·µï¼Œå¯ä»¥å°†çˆ¬è™«çš„è¿‡ç¨‹æ€»ç»“ä¸ºï¼Œè·å–é™æ€é¡µé¢æˆ–è·å–æ¥å£æ•°æ® =&gt; åˆ†æé¡µé¢ç»“æ„æˆ–åˆ†ææ¥å£æ•°æ® =&gt; æå–æ•°æ®ä¿å­˜ã€‚åŸºäºNodeçš„çˆ¬è™«æ–¹å¼ï¼Œè¦ä¹ˆæ˜¯åŠ è½½é¡µé¢ï¼Œè¦ä¹ˆæ˜¯è¯·æ±‚APIï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´éƒ½å¾ˆå®¹æ˜“å®ç°ã€‚</p><h2>puppeteer</h2><p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/GoogleChrome/puppeteer\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">puppeteer</a> åº”è¯¥ç®—æ˜¯æœ€ç®€å•çš„æ–¹å¼äº†ï¼Œé€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·çš„è¡Œä¸ºä¸æµè§ˆå™¨äº¤äº’ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ†æé¡µé¢æŠ“å»éœ€è¦çš„ä¿¡æ¯ã€‚puppeteer æ–‡æ¡£å¾ˆè¯¦å®ï¼Œè€Œä¸”æ‰‹æŠŠæ‰‹æ•™å­¦ï¼Œä½ æƒ³è¦çš„åŠŸèƒ½åŸºæœ¬ä¸Šéƒ½èƒ½åœ¨å®ƒçš„ github ä¸Šæ‰¾åˆ°ç›¸åº”çš„ä¾‹å­ã€‚</p><p>puppeteer æ˜¯åŸºäº Chromium çš„ï¼Œåœ¨å®‰è£… puppeteeræ—¶ï¼Œä¼šåŒæ—¶å®‰è£… Chromiumã€‚è€Œå› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„ç¼˜æ•…ï¼Œæ•´ä¸ªå®‰è£…çš„è¿‡ç¨‹å¹¶ä¸æ˜¯å¾ˆé¡ºåˆ©ï¼Œæ–‡æ¡£é‡Œæä¾›äº†ä¸å®‰è£… Chromium çš„æ–¹æ³•ï¼Œä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ·˜å®çš„é•œåƒæ¥åŠ å¿«å®‰è£…æ—¶é—´ã€‚</p><div class=\"highlight\"><pre><code class=\"language-powershell\"><span class=\"n\">npm</span> <span class=\"n\">config</span> <span class=\"n\">set</span> <span class=\"n\">puppeteer_download_host</span> <span class=\"n\">https</span><span class=\"err\">:</span><span class=\"p\">//</span><span class=\"n\">npm</span><span class=\"p\">.</span><span class=\"n\">taobao</span><span class=\"p\">.</span><span class=\"n\">org</span><span class=\"p\">/</span><span class=\"n\">mirrors</span></code></pre></div><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªæ‰“å¡ğŸŒ°æ¥ä½¿ç”¨ puppeteer,</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">login</span> <span class=\"o\">=</span> <span class=\"kr\">async</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"k\">const</span> <span class=\"nx\">browser</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">puppeteer</span><span class=\"p\">.</span><span class=\"nx\">launch</span><span class=\"p\">({</span> <span class=\"nx\">headless</span><span class=\"o\">:</span> <span class=\"kc\">false</span> <span class=\"p\">});</span>  <span class=\"c1\">// é»˜è®¤trueã€‚ç½®ä¸º falseï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹å¯è§†\n</span><span class=\"c1\"></span>  <span class=\"k\">const</span> <span class=\"nx\">page</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">browser</span><span class=\"p\">.</span><span class=\"nx\">newPage</span><span class=\"p\">();</span>\n  <span class=\"kr\">await</span> <span class=\"nx\">page</span><span class=\"p\">.</span><span class=\"kr\">goto</span><span class=\"p\">(</span><span class=\"nx\">logURL</span><span class=\"p\">);</span>  <span class=\"c1\">// è·³è½¬ç›®æ ‡ç½‘é¡µlogURLï¼Œé»˜è®¤ load äº‹ä»¶è§¦å‘\n</span><span class=\"c1\"></span>  <span class=\"kr\">await</span> <span class=\"nx\">page</span><span class=\"p\">.</span><span class=\"nx\">type</span><span class=\"p\">(</span><span class=\"s1\">&#39;#member_number&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;123456&#39;</span><span class=\"p\">)</span>  <span class=\"c1\">// è¾“å…¥å¡å·\n</span><span class=\"c1\"></span>  <span class=\"kr\">await</span> <span class=\"nx\">page</span><span class=\"p\">.</span><span class=\"nx\">click</span><span class=\"p\">(</span><span class=\"s1\">&#39;#btn_member_number&#39;</span><span class=\"p\">)</span>  <span class=\"c1\">// ç‚¹å‡»ç¡®å®š\n</span><span class=\"c1\"></span>  <span class=\"kr\">await</span> <span class=\"nx\">page</span><span class=\"p\">.</span><span class=\"nx\">waitForSelector</span><span class=\"p\">(</span><span class=\"s1\">&#39;#check_in&#39;</span><span class=\"p\">)</span>  <span class=\"c1\">// ç­‰å¾…ç­¾åˆ° Dom æ¸²æŸ“å®Œæˆ\n</span><span class=\"c1\"></span>  <span class=\"kr\">await</span> <span class=\"nx\">page</span><span class=\"p\">.</span><span class=\"nx\">click</span><span class=\"p\">(</span><span class=\"s1\">&#39;#check_in&#39;</span><span class=\"p\">)</span>  <span class=\"c1\">// ç‚¹å‡»ç­¾åˆ°æŒ‰é’®\n</span><span class=\"c1\"></span>  <span class=\"kr\">await</span> <span class=\"nx\">browser</span><span class=\"p\">.</span><span class=\"nx\">close</span><span class=\"p\">()</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>ä»£ç æµç¨‹å’Œç”¨æˆ·æ“ä½œæµè§ˆå™¨çš„æµç¨‹ä¸€è‡´ï¼Œè¿™ç§æ–¹å¼ç›¸æ¯”æ¥ä¸‹æ¥è¦è¯´çš„æ–¹å¼ï¼Œå¯ä»¥è¯´æ˜¯å‚»ç“œå¼æ“ä½œäº†ã€‚å½“ç„¶ puppeteer è¿˜å¯ä»¥ç”Ÿæˆæˆªå›¾ï¼Œæ€§èƒ½åˆ†æç­‰ã€‚</p><h2>æ¥å£è¯·æ±‚</h2><p>ä¸ç®¡æ˜¯é™æ€è¿˜æ˜¯åŠ¨æ€é¡µé¢çš„è·å–ï¼Œéƒ½æ˜¯é€šè¿‡æ¥å£è¯·æ±‚æ¥å®ç°çš„ï¼Œå³é€šè¿‡urlå‘åç«¯æœåŠ¡è¯·æ±‚ç›¸åº”çš„æ•°æ®ã€‚æŒ‰ç…§ä¹‹å‰çš„çˆ¬å–æµç¨‹ï¼Œè¦åšçš„å°±æ˜¯æ•°æ®çš„è¯·æ±‚å’Œæ•°æ®çš„åˆ†æã€‚å¦‚æœéœ€è¦ä¿å­˜çš„è¯ï¼Œå°±è¦ä½¿ç”¨å­˜å‚¨å·¥å…·å‚¨å­˜æ•°æ®ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ Node ç¯å¢ƒä¸­è¯·æ±‚æ•°æ®ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å°è£…å¥½çš„ htttp åº“ï¼Œæ¯”å¦‚ requestï¼Œaxiosç­‰ã€‚é‚£ä¹ˆåˆ†ææ•°æ®å‘¢ï¼Ÿè¿™å°±è¦çœ‹æƒ…å†µäº†ï¼Œå¦‚æœçˆ¬å–çš„æ˜¯é™æ€é¡µé¢ï¼Œè¿”å›çš„æ˜¯ HTMLï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å€ŸåŠ© Cheerio æˆ– JSDOM æ¥åˆ†æé¡µé¢ç»“æ„ã€‚å¦‚æœè¿”å›çš„æ˜¯å¸¸è§çš„ JSONï¼Œé‚£å°±å¾ˆç®€å•äº†ã€‚</p><p>ä¸è¿‡æœ¬æ¬¡å®è·µæ²¡æœ‰é€šè¿‡ä»¥ä¸Šçš„æ–¹å¼ï¼Œè€Œæ˜¯åœ¨ github æœç´¢ç›¸å…³ä¿¡æ¯æ—¶ï¼Œæ°å·§çœ‹åˆ°äº† <a href=\"https://link.zhihu.com/?target=https%3A//github.com/bda-research/node-crawler\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">crawler</a>ã€‚åŸç†ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œä¸”å®ƒä¹Ÿé›†æˆäº† Cheerioã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">Crawler</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s2\">&#34;crawler&#34;</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">crawlerWebPage</span> <span class=\"o\">=</span> <span class=\"nx\">obj</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"kd\">let</span> <span class=\"p\">{</span><span class=\"nx\">uri</span><span class=\"p\">,</span> <span class=\"nx\">selector</span><span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"nx\">obj</span><span class=\"p\">;</span>  <span class=\"c1\">// uri è¯·æ±‚çš„uriï¼Œselector é€‰æ‹©å™¨ï¼›\n</span><span class=\"c1\"></span>  <span class=\"nx\">crawler</span><span class=\"p\">.</span><span class=\"nx\">direct</span><span class=\"p\">({</span>\n    <span class=\"nx\">uri</span><span class=\"o\">:</span> <span class=\"nx\">uri</span><span class=\"p\">,</span>\n    <span class=\"nx\">skipEventRequest</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n    <span class=\"nx\">callback</span><span class=\"o\">:</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">,</span> <span class=\"nx\">response</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span>\n        <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n          <span class=\"kd\">var</span> <span class=\"nx\">$</span> <span class=\"o\">=</span> <span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">$</span><span class=\"p\">;</span>\n          <span class=\"kd\">var</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"nx\">$</span><span class=\"p\">(</span><span class=\"nx\">selector</span><span class=\"p\">).</span><span class=\"nx\">text</span><span class=\"p\">();</span>\n            <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">statusCode</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">,</span> <span class=\"nx\">uri</span><span class=\"p\">);</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">})</span>\n</code></pre></div><p>ä¸Šé¢è¿™ä¸ªä¹Ÿåªæ˜¯ crawler çš„ç®€å•ç”¨æ³•ã€‚</p><h2>node-schedule</h2><p>è™½ç„¶å¯ä»¥çˆ¬å–äº†ï¼Œä½†æ˜¯æ•°æ®å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œæ‰€ä»¥ï¼Œæ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å®šæ—¶é‡å¤çˆ¬å–ç½‘é¡µã€‚ <a href=\"https://link.zhihu.com/?target=https%3A//github.com/node-schedule/node-schedule\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">node-schedule</a> å°±æ˜¯ç”¨æ¥å®šä¹‰å®šæ—¶ä»»åŠ¡çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">schedule</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">&#39;node-schedule&#39;</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">loginSchedule</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"nx\">schedule</span><span class=\"p\">.</span><span class=\"nx\">scheduleJob</span><span class=\"p\">({</span>\n    <span class=\"nx\">start</span><span class=\"o\">:</span> <span class=\"nx\">startTime</span><span class=\"p\">,</span>\n    <span class=\"nx\">endTime</span><span class=\"o\">:</span> <span class=\"nx\">endTime</span><span class=\"p\">,</span>\n    <span class=\"nx\">rule</span><span class=\"o\">:</span> <span class=\"nx\">config</span><span class=\"p\">.</span><span class=\"nx\">schedule</span><span class=\"p\">.</span><span class=\"nx\">login</span><span class=\"p\">[</span><span class=\"nx\">loginIndex</span><span class=\"p\">]</span>\n  <span class=\"p\">},</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">now</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">();</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">loginLog</span> <span class=\"o\">=</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">now</span><span class=\"si\">}</span><span class=\"sb\"> login successed! /r/n`</span><span class=\"p\">;</span>\n    <span class=\"k\">try</span> <span class=\"p\">{</span>\n      <span class=\"nx\">login</span><span class=\"p\">();</span>\n      <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">appendFileSync</span><span class=\"p\">(</span><span class=\"s1\">&#39;log.txt&#39;</span><span class=\"p\">,</span> <span class=\"nx\">loginLog</span><span class=\"p\">)</span>\n    <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"kd\">let</span> <span class=\"nx\">loginErrorLog</span> <span class=\"o\">=</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">now</span><span class=\"si\">}</span><span class=\"sb\"> - </span><span class=\"si\">${</span><span class=\"nx\">logURL</span><span class=\"si\">}</span><span class=\"sb\"> login failed: </span><span class=\"si\">${</span><span class=\"nx\">error</span><span class=\"p\">.</span><span class=\"nx\">message</span><span class=\"si\">}</span><span class=\"sb\">! /r/n`</span><span class=\"p\">;</span>\n      <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">appendFileSync</span><span class=\"p\">(</span><span class=\"s1\">&#39;log.txt&#39;</span><span class=\"p\">,</span> <span class=\"nx\">loginErrorLog</span><span class=\"p\">)</span>\n      <span class=\"k\">throw</span> <span class=\"nx\">error</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>å®šä¹‰å¥½ç›¸å…³çš„è§„åˆ™åï¼Œä»»åŠ¡å°±å¯ä»¥æŒ‰åˆ¶å®šçš„è§„åˆ™æ‰§è¡Œã€‚</p><h2>pm2</h2><p>ä»¥ä¸Šçš„ä»»åŠ¡æ˜¯å¯ä»¥æ‰§è¡Œäº†ï¼Œå¯æ˜¯å…³é—­äº†å‘½ä»¤çª—å£ï¼Œè¿›ç¨‹ä¸­æ–­ï¼Œé‚£ä¹ˆåŠŸå¤«ç™½è´¹ã€‚è¿™æ—¶å€™å°±éœ€è¦ä¸€ä¸ªå·¥å…·æ¥ç®¡ç† node è¿›ç¨‹ï¼Œ<a href=\"https://link.zhihu.com/?target=http%3A//pm2.keymetrics.io/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">pm2</a>å€’æ˜¯ä¸€ä¸ªå¥½å·¥å…·ã€‚pm2 ä¸ä»…æ”¯æŒçƒ­åŠ è½½ï¼Œè¿˜å¯ä»¥ç›‘æ§ç­‰åŠŸèƒ½ï¼Œå¾ˆæ–¹ä¾¿å¾ˆå¼ºå¤§ã€‚</p><div class=\"highlight\"><pre><code class=\"language-powershell\"><span class=\"c\"># å®‰è£…</span>\n<span class=\"n\">npm</span> <span class=\"n\">install</span> <span class=\"n\">pm2</span> <span class=\"n\">-g</span>\n\n<span class=\"c\"># å¯åŠ¨ã€ç›‘å¬ app.js</span>\n<span class=\"n\">pm2</span> <span class=\"n\">start</span> <span class=\"n\">app</span><span class=\"p\">.</span><span class=\"n\">js</span>  <span class=\"p\">-</span><span class=\"n\">-watch</span>\n\n<span class=\"c\"># ç›‘æ§</span>\n<span class=\"n\">pm2</span> <span class=\"n\">monit</span>\n\n<span class=\"c\"># ç»ˆæ­¢</span>\n<span class=\"n\">pm2</span> <span class=\"n\">stop</span>\n\n<span class=\"p\">......</span></code></pre></div><h2>debug</h2><p>åœ¨å†™ Node åº”ç”¨æ—¶ï¼Œéš¾å…ç£•ç£•ç»Šç»Šï¼Œå­¦ä¼šè°ƒè¯•ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æœ¬æ¬¡é¡¹ç›®å¾ˆç®€å•ï¼Œæ‰€ä»¥æ‰€ä½¿ç”¨çš„è°ƒè¯•æŠ€å·§ä¹Ÿå¾ˆç²—æµ…ã€‚</p><ul><li>ä½¿ç”¨ VSCode æä¾›çš„è°ƒè¯•å·¥å…·ã€‚</li><li>åœ¨é¡¹ç›®ä¸­åŠ å…¥ <code>debugger</code>ï¼Œæ‰§è¡Œ <code>node debug --inspect app.js</code>,å¼€å¯è°ƒè¯•æ¨¡å¼ã€‚</li><li>å€ŸåŠ©å…¶ä»–è°ƒè¯•å·¥å…·ã€‚</li></ul><p><b>over</b></p>", 
            "topic": [
                {
                    "tag": "Node.js", 
                    "tagLink": "https://api.zhihu.com/topics/19569535"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }
            ], 
            "comments": [
                {
                    "userName": "çŸ¥ä¹ç”¨æˆ·", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "<p>ç™»å½•è¿™ä¸ªç¯èŠ‚å…¶å®å¯ä»¥çœç•¥çš„ã€‚æ‹¿åˆ° cookie å°±å¥½äº†</p>", 
                    "likes": 1, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "[èµåŒ]ç™»é™†åæ‹¿åˆ° cookie åï¼Œå°±å¯ä»¥ä¸ç”¨é‡å¤è¿™ä¸ªæ­¥éª¤äº†ã€‚ä¸è¿‡æˆ‘æ¨¡æ‹Ÿçš„æ˜¯æ‰“å¡ç­¾åˆ°çš„æµç¨‹ï¼Œæ¯æ¬¡éƒ½è¦ç™»å½•", 
                            "likes": 0, 
                            "replyToAuthor": "çŸ¥ä¹ç”¨æˆ·"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/74558865", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 2, 
            "title": "å­¦ä¹ ä¹‹é“æœ‰æ„Ÿ", 
            "content": "<blockquote>æˆ‘æ„è¯†åˆ°è‡ªå·±æœ€æ“…é•¿çš„æ—¢ä¸æ˜¯è±¡æ£‹ä¹Ÿä¸æ˜¯å¤ªæï¼Œæˆ‘æœ€æ“…é•¿çš„æ˜¯å­¦ä¹ ä¹‹é“ã€‚</blockquote><p>å¶ç„¶é—´å¬åˆ°äº†ã€Šå­¦ä¹ ä¹‹é“ã€‹è¿™æœ¬ä¹¦ï¼Œå¸å¼•æˆ‘çš„å¹¶ä¸æ˜¯è¿™ä¹ˆéœ¸æ°”çš„ä¹¦åï¼Œè€Œæ˜¯ä¹¦é‡Œè¯´çš„ä¸€äº›è§‚å¿µå¾ˆæ˜¯å¥‘åˆã€‚å¥½å¥‡ä¹‹ä¸‹ï¼Œä¹°æœ¬çœ‹çœ‹ã€‚ä¹¦ä¸­æè¿°çš„æ˜¯ä½œè€…ä¼ å¥‡èˆ¬çš„ç»å†ï¼Œä¸å…¶è¯´æ˜¯ä¼ æˆä»–çš„å­¦ä¹ ä¹‹é“ï¼Œå€’ä¸å¦‚è¯´æŠŠä»–ç»å†çš„ç‚¹ç‚¹æ»´æ»´è®²è¿°ç»™å¤§å®¶å¬ã€‚</p><p>ä¹¦ä¸­å¹¶æ²¡æœ‰æå‡ºé€Ÿæˆçš„æ–¹æ³•ï¼Œåªæ˜¯äº‹æ— å·¨ç»†çš„è®²è¿°è‡ªå·±çš„ç»å†å’Œæ„Ÿæ‚Ÿã€‚è€Œè¿™äº›å´æ˜¯æœ¬ä¹¦æœ€é‡è¦çš„ï¼Œä½œä¸ºä¸€ä¸ªä¼ å¥‡äººç‰©ï¼Œä»–çš„ç»å†æ˜¯å¾ˆæœ‰å‚è€ƒä»·å€¼çš„ï¼Œå°±ç®—åªæ˜¯æè¿°æ—¥å¸¸ç”Ÿæ´»çš„æµæ°´è´¦ã€‚æ­¤æ—¶ï¼Œèƒ½å¦ä»ä¹¦ä¸­å—ç›Šï¼Œä¸å†å–å†³äºä¹¦çš„å†…å®¹ï¼Œè€Œæ˜¯è¯»è€…å¦‚ä½•çœ‹å¾…è¿™æœ¬ä¹¦ã€‚è€Œæœ€è®©æˆ‘æ•¬ä½©çš„æ˜¯ï¼Œä½œè€…èƒ½å¤Ÿä½“å¯Ÿå…¥å¾®ï¼Œæ¢ç©¶å…¶èƒŒåçš„çœŸç›¸ã€‚</p><blockquote>ä¸Šå£«é—»é“ï¼Œå‹¤è€Œè¡Œä¹‹ï¼›ä¸­å£«é—»é“ï¼Œè‹¥å­˜è‹¥äº¡ï¼›ä¸‹å£«é—»é“ï¼Œå¤§ç¬‘ä¹‹ï¼Œä¸ç¬‘ä¸è¶³ä»¥ä¸ºé“</blockquote><p>åœ¨è¯»ä¹¦çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ‰çŸ¥é“ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¼šè¢«è¿™æœ¬ä¹¦å¸å¼•ã€‚åŸæ¥ï¼Œä½œè€…ä¹Ÿæ˜¯ã€Šé“å¾·ç»ã€‹çš„è¯»è€…ï¼Œå’Œæˆ‘è¿™ä¸ªåŠåŠå­ï¼Œä¹Ÿç®—æ˜¯å¿—åŒé“åˆäº†ã€‚çœ‹å®Œè¿™æœ¬ä¹¦ï¼Œæˆ‘å°±é¢„æ–™ï¼Œèƒ½å¤Ÿè¯»æ‡‚è¿™ä¹¦çš„åŠ¿å¿…èµä¸ç»å£ï¼Œè¯»ä¸æ‡‚æ­¤ä¹¦çš„ä¹Ÿä¼šè§‰å¾—å‘³åŒåš¼èœ¡ï¼Œç´¢ç„¶æ— å‘³ã€‚è€Œæˆ‘ä¸ªäººè§‚ç‚¹åˆ™æ˜¯ï¼Œä½œè€…æŠŠè‡ªå·±æ„Ÿæ‚Ÿèå…¥äº†ç”Ÿæ´»ä¹‹ä¸­ï¼Œåœ¨æè¿°ä¸ªäººç»å†çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯åœ¨è¯ é‡Šä»€ä¹ˆæ˜¯å­¦ä¹ ä¹‹é“ã€‚è¿™ä¹Ÿæ˜¯æˆ‘è§‰å¾—ä½œè€…å¾ˆå‰å®³çš„åŸå› ï¼Œå¤å½’è‡ªç„¶ã€‚</p><blockquote>é“ä¹‹å‡ºå£ï¼Œæ·¡ä¹å…¶æ— å‘³ï¼Œè§†ä¹‹ä¸è¶³è§ï¼Œå¬ä¹‹ä¸è¶³é—»</blockquote><p>ç”Ÿæ´»ä¸­å¤„å¤„é€ç€å¤§é“ç†ï¼Œå¯æ˜¯çœ‹ä¸åˆ°ï¼Œæ‘¸ä¸ç€ï¼Œå¬ä¸è§ï¼Œä¸ç•™ç—•è¿¹ã€‚å°±å¦‚ä¾¦æ¢å°è¯´é‡Œè¯´ï¼Œä¹‹æ‰€ä»¥ä¸»äººå…¬èƒ½å¤Ÿå‘ç°ä¸€äº›çº¿ç´¢è¿›è€Œç ´è§£æ¡ˆä»¶ï¼Œæ˜¯å› ä¸ºå‘ç°äº†ä¸åˆç†çš„åœ°æ–¹ã€‚è€Œé“æ³•è‡ªç„¶ï¼Œæˆ‘ä»¬åœ¨è¿™ç§ç¯å¢ƒä¸‹æˆé•¿ï¼Œä¹Ÿä¼šè§‰å¾—ä¸€åˆ‡è‡ªç„¶è€Œç„¶ã€‚æˆ‘ä»¬ç”Ÿæ°”ä¹Ÿæ˜¯è‡ªç„¶ï¼Œæˆ‘ä»¬å¼€å¿ƒä¹Ÿæ˜¯è‡ªç„¶ï¼Œä»¥è‡³äºæˆ‘ä»¬ä»æ¥ä¸è¿½ç©¶çœ‹ä¼¼è‡ªç„¶çš„èƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>è€Œä½œè€…è¿˜æ˜¯ä¸ªå­©ç«¥æ—¶ï¼Œè¡¥å……ä¸€ä¸‹ï¼Œä½œè€…å¾ˆå°çš„æ—¶å€™å°±å·²ç»è¿‡ç€å¼€æŒ‚çš„äººç”Ÿäº†ï¼Œåœ¨ç»å†æŒ«æŠ˜æ—¶ï¼ŒåŠæ—¶å‘ç°è‡ªèº«å¤„å¢ƒï¼Œå¹¶ä»ä¸­è·ç›Šã€‚æˆ‘ä»¬ä»Šå¤©èƒ½å¤Ÿæœ‰å¹¸çœ‹åˆ°è¿™æœ¬ä¹¦ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºä½œè€…æ•é”å¾—è§‚å¯Ÿèƒ½åŠ›ã€‚</p><blockquote>çŸ¥äººè€…æ™ºï¼Œè‡ªçŸ¥è€…æ˜ã€‚èƒœäººè€…æœ‰åŠ›ï¼Œè‡ªèƒœè€…å¼º</blockquote><p>åœ¨å½“ä»Šè¿™ä¸ªç¤¾ä¼šï¼Œäººä»¬è¢«å¿«èŠ‚å¥çš„ç”Ÿæ´»å‹åœ°å–˜ä¸è¿‡æ°”æ¥ã€‚æˆ‘è®¤ä¸ºæ‰€è°“çš„è‡ªçŸ¥ï¼Œä¸ä»…ä»…æŒ‡çš„æ˜¯ä¸ªäººçš„èƒ½åŠ›ï¼Œè¿˜åº”è¯¥åŒ…æ‹¬æƒ…ç»ªç­‰ã€‚å¾ˆå¤šäººè¢«æƒ…ç»ªæ§åˆ¶è€Œä¸è‡ªçŸ¥ï¼Œè€Œç”±æƒ…ç»ªå¸¦æ¥çš„è´Ÿé¢å½±å“åˆå°†äººå¸¦å‘æ›´åçš„å¤„å¢ƒã€‚</p><p>å†¥æƒ³ï¼Œä½œä¸ºç¼“è§£å‹åŠ›çš„è¿åŠ¨ï¼Œåœ¨å½“ä»Šç¤¾ä¼šå¾ˆæµè¡Œã€‚åœ¨å†¥æƒ³æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ„Ÿå—è‡ªèº«è‚Œè‚‰çš„æƒ…å†µï¼Œç„¶åä¸æ–­å»è°ƒèŠ‚æ”¾æ¾ã€‚å¾ˆå¤šåˆå­¦è€…åœ¨åˆšå¼€å§‹å†¥æƒ³æ—¶ï¼Œå‹æ ¹ä¸çŸ¥é“è‡ªå·±çš„è‚Œè‚‰åˆ°åº•æ˜¯å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚äººçš„æƒ…ç»ªä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ—¶åˆ»å…³æ³¨è‡ªå·±æƒ…ç»ªçš„å˜åŒ–ï¼Œæœ€ç»ˆä¹Ÿå¯ä»¥åšåˆ°æŒæ§æƒ…ç»ªã€‚è€Œä½œè€…ä¹Ÿå¤šæ¬¡åœ¨å¯¹å±€ä¸­ï¼Œå…‹æœæ¶ˆææƒ…ç»ªï¼Œæœ€åæ‹¿ä¸‹å† å†›ã€‚</p><p>ç”Ÿæ°”ä¹Ÿå¥½ï¼Œå¼€å¿ƒä¹Ÿç½¢ï¼Œè¿™äº›éƒ½ä¸é‡è¦ã€‚é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æ¥çº³è‡ªå·±æƒ…ç»ªï¼Œä¸æŠµè§¦ã€‚å¦‚æœæ”¾åœ¨å­¦ä¹ é‡Œï¼Œé‚£å°±æ˜¯æ”¾ä¸‹æˆ‘ä»¬çš„ç•éš¾æƒ…ç»ªã€‚å…¶å®ï¼Œé˜»æ­¢æˆ‘ä»¬å‰è¡Œçš„ä¸€ç›´éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜è¦åšåˆ°é™å¦‚å¤„å­ï¼ŒåŠ¨å¦‚è„±å…”ï¼ŒæŠŠè‡ªå·±çš„æ³¨æ„åŠ›ç”¨åœ¨å®ƒè¢«éœ€è¦çš„åœ°æ–¹ã€‚</p><blockquote>å¤©ä¸‹éš¾äº‹å¿…ä½œäºæ˜“ï¼Œå¤©ä¸‹å¤§äº‹å¿…ä½œäºç»†</blockquote><p>çœ‹ä¼¼ç®€å•çš„äº‹ç‰©ï¼Œä¹Ÿä»…ä»…æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³ç®€å•äº†ã€‚<code>ä¸å‡ºæˆ·ï¼ŒçŸ¥å¤©ä¸‹ï¼›ä¸çª¥ç‰–ï¼Œè§å¤©é“</code>ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œç”Ÿæ´»ä¸­å¤„å¤„é€ç€å¤§é“ç†ï¼Œçœ‹ä¼¼ç®€å•çš„äº‹æƒ…ï¼Œåšå¤šäº†åšé€äº†ï¼Œä¹Ÿå¯ä»¥ä½œå‡ºä¸€ç•ªæˆç»©ã€‚è€Œæˆ‘ä»¬å¸¸å¸¸è§‚å¯Ÿä¸åˆ°ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬çš„æƒ³æ³•å¤ªå¤šï¼Œæ‚å¿µå¤ªå¤šï¼Œæœ‰å¤ªå¤šçš„ç†æ‰€å½“ç„¶ã€‚</p><blockquote>äº”è‰²ä»¤äººç›®ç›²ï¼Œäº”éŸ³ä»¤äººè€³è‹ï¼Œäº”å‘³ä»¤äººå£çˆ½ï¼Œé©°éª‹ç•‹çŒä»¤äººå¿ƒå‘ç‹‚ï¼Œéš¾å¾—ä¹‹è´§ä»¤äººè¡Œå¦¨</blockquote><p>åœ¨å¤æ—¶å€™ï¼Œäººä»¬è¿˜æƒ³ç€ä¿®å¿ƒå…»æ€§ã€‚åœ¨è¿™ä¸ªç‰©æ¬²æ¨ªæµçš„ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ›´åº”è¯¥å¦‚æ­¤ï¼Œå—è¯±æƒ‘çš„ä¸œè¥¿å¤ªå¤šï¼Œå¾€å¾€å¯¼è‡´æˆ‘ä»¬æ— æ³•è¿½å¯»æœ¬æºã€‚ä½ å‘†çš„è¶Šèˆ’é€‚ï¼Œä½ å°±è¶Šè§‰å¾—ç†æ‰€å½“ç„¶ï¼Œä¹Ÿå°±è¶Šä¸èƒ½å‘ç°å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚ã€‚</p><p>ä¹‹å‰çœ‹è¿‡ä¸€ä¸ªæœ‰è¶£çš„æŠ¥é“ï¼Œäººæœ‰æ„è¯†å’Œæ½œæ„è¯†ä¹‹è¯´ã€‚åœ¨äººä¼‘æ¯å‘å‘†çš„æ—¶å€™ï¼Œäººçš„æ½œæ„è¯†å¼€å§‹è¿›è¡ŒçŸ¥è¯†æ•´åˆã€‚è¿™ä¹Ÿæ˜¯å¥½å¤šäººåœ¨çŸ¥è¯†å‚¨å¤‡è¶³å¤Ÿçš„æ—¶å€™ä¼šæœ‰çµå…‰ä¸€ç°çš„è¯´æ³•ã€‚è€Œç°åœ¨çš„ç§‘æŠ€å‘è¾¾ï¼Œå¤ªå¤šçš„ç§‘æŠ€äº§å“å ç”¨äº†æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Œè¿™ä¹Ÿç ´åäº†åŸæœ‰çš„æ•´åˆæœºåˆ¶ã€‚æœ€åæŠ¥é“ç»™å‡ºçš„ç»“è®ºæ˜¯ï¼Œåœ¨è¿™ç§ç¯å¢ƒä¸‹ï¼Œäººç±»ä¼šå˜å¾—è¶Šæ¥è¶Šç¬¨ã€‚è¯´çš„è²Œä¼¼æŒºæœ‰é“ç†çš„ï¼Œæ‰€ä»¥è¯´ç©æ‰‹æœºè¦é€‚åº¦ã€‚</p><p>ä½œè€…è¿˜æåˆ°ï¼Œå†…åŒ–å’Œå¼ºåŒ–è®­ç»ƒã€‚å°±æ˜¯ä¸æ–­é’ˆå¯¹è‡ªå·±ä¸ç†Ÿæ‚‰çš„é¢†åŸŸå»å¼ºåŒ–ï¼Œè¿›è€Œä½¿å…¶æˆä¸ºèº«ä½“æƒ¯æ€§ã€‚è®²çœŸï¼Œå†™åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘å·²ç»ä¸è®°å¾—ä¹¦ä¸­çš„ç»†èŠ‚äº†ï¼Œè™½ç„¶æ‰åˆšçœ‹å®Œã€‚ä¹¦ä¸­çš„å†…å®¹å¯ä»¥è¯´æ˜¯å¹²è´§æ»¡æ»¡ï¼Œæ¯•ç«Ÿä½œè€…æ˜¯ä»¥è‡ªå·±çš„è¡ŒåŠ¨å»å®è·µå¹¶å–å¾—äº†å¾ˆå¤§çš„æˆå°±ã€‚ä¹Ÿå¯ä»¥è¯´è¿™æœ¬ä¹¦ä»€ä¹ˆéƒ½æ²¡è¯´ï¼Œå†…å®¹å®½æ³›ï¼Œæ›´åƒå¿ƒç†æŒ‡å¯¼ã€‚</p><p>æœ€åç”¨ä¸€å¥è¯æ€»ç»“ï¼Œ<b>é¢ä¸´å±æœºï¼Œå¦ç„¶æ¥å—ç—›è‹¦ï¼Œç›´è‡³ä»å®¹ï¼Œé—²åº­ä¿¡æ­¥</b>ã€‚</p>", 
            "topic": [
                {
                    "tag": "é«˜æ•ˆå­¦ä¹ ", 
                    "tagLink": "https://api.zhihu.com/topics/19580586"
                }, 
                {
                    "tag": "é“å¾·ç»", 
                    "tagLink": "https://api.zhihu.com/topics/20170172"
                }, 
                {
                    "tag": "é˜…è¯»", 
                    "tagLink": "https://api.zhihu.com/topics/19550564"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/74506841", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 2, 
            "title": "å‰–ææ’åºç®—æ³•", 
            "content": "<h2>å‰è¨€</h2><p>æ’åºæ˜¯è®¡ç®—æœºä¸­å¯¹å­˜å‚¨çš„æ•°æ®æ‰§è¡Œæœ€å¸¸è§çš„æ“ä½œä¹‹ä¸€ã€‚åœ¨æ’åºç®—æ³•ä¸­ç»•ä¸å¼€çš„æ˜¯å¾ªç¯ï¼Œåªæœ‰åœ¨æ·±å…¥å­¦ä¹ æ’åºç®—æ³•æ—¶ï¼Œæ‰å‘ç°å¹³æ—¶ä¸èµ·çœ¼çš„å¾ªç¯è¯­å¥ä¸å¯å°è§‘ã€‚</p><p>æ‹¿æœ€ç®€å•çš„å†’æ³¡æ’åºæ¥è¯´ï¼Œé“ç†æˆ‘éƒ½æ‡‚ï¼Œå¯ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°ä¸¤å±‚åµŒå¥—çš„å¾ªç¯è¯­å¥ï¼Ÿä¸ºä»€ä¹ˆä¸¤å±‚å¾ªç¯è¯­å¥çš„æ¡ä»¶ä¼šæœ‰æ‰€ä¸åŒï¼Ÿä¸¤å±‚å¾ªç¯çš„å…³è”é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿå¾ªç¯åœ¨å†’æ³¡ä¸­æ‰®æ¼”ç€ä»€ä¹ˆè§’è‰²ï¼Ÿå¾ªç¯æ˜¯é€šè¿‡æ€æ ·çš„é€»è¾‘å®Œæˆå†’æ³¡çš„ï¼Ÿç­‰ç­‰ã€‚è¿™äº›é—®é¢˜çš„èƒŒåï¼Œéƒ½å€¼å¾—æˆ‘ä»¬å»æ¢ç©¶ã€‚</p><h2>å¾ªç¯</h2><p>åœ¨è¯´æ­£é¢˜ä¹‹å‰ï¼Œéœ€è¦è¯´ä¸€ä¸ªå°æ’æ›²ã€‚ç”±äºäº’è”ç½‘å¯’å†¬ï¼Œç¨‹åºå‘˜ä»¬éƒ½æœ‰ä¸€ç§å±æœºæ„Ÿã€‚åœ¨è¿™åœºå±æœºä¸­ï¼Œç¨‹åºå‘˜çš„ç­›é€‰æ¡ä»¶ä¹Ÿå˜å¾—æ›´åŠ è‹›åˆ»ã€‚æ— è®ºæ˜¯å‰ç«¯è¿˜æ˜¯åç«¯ï¼Œéƒ½æœ€å¥½èƒ½å¤Ÿç†Ÿæ‚‰æŒæ¡ä¸€äº›åŸºç¡€ç®—æ³•ã€‚æ‰€ä»¥è¯´ï¼Œåˆ·ç®—æ³•é¢˜ï¼Œä¹Ÿåœ¨ç¨‹åºå‘˜é—´æµè¡Œèµ·æ¥äº†ã€‚æˆ‘æ—è¾¹çš„ä¸€åŒäº‹ï¼Œå°±åˆ·åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„ç®—æ³•ï¼Œè¯´æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå°±è®©æˆ‘ä¹Ÿå°è¯•ä¸€ä¸‹ã€‚è®²çœŸï¼Œä½œä¸ºä¸€ä¸ªå‰ç«¯ï¼Œé™¤äº†ç®€å•å¤„ç†ä¸€ä¸‹æ¥å£æ•°æ®ï¼Œè¿˜çœŸæ²¡æœ‰è®­ç»ƒè¿‡åº”è¯•èˆ¬çš„ç®—æ³•ã€‚</p><p>é¢˜ç›®å¤§è‡´æ˜¯è¿™æ ·çš„ï¼Œåœ¨ n*n çš„å¹³é¢ä¸­ï¼Œä»¥ä¸€åŠçš„ç©ºé—´èºæ—‹æœ‰åºæ’æ»¡ä»¥1èµ·å§‹è‹¥å¹²æ•°å­—ã€‚ ç”»å›¾å¦‚ä¸‹ï¼š</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-c21767cd2b1e9a65662c417a3b7fd18b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"254\" data-rawheight=\"339\" class=\"content_image\" width=\"254\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;254&#39; height=&#39;339&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"254\" data-rawheight=\"339\" class=\"content_image lazy\" width=\"254\" data-actualsrc=\"https://pic4.zhimg.com/v2-c21767cd2b1e9a65662c417a3b7fd18b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>éšç€æ€è€ƒçš„æ·±å…¥ï¼Œçªç„¶å‘ç°ï¼Œè¿™tmä¸å°±æ˜¯ä¸€é“æ•°å­¦é¢˜ä¹ˆï¼Ÿï¼ˆåŸè°…æˆ‘è¯´ç²—è¯äº†ï¼‰ æ‰¾å‡ºå·²çŸ¥ï¼Œåˆ—å‡ºæœªçŸ¥ï¼Œå…³è”å·²çŸ¥æœªçŸ¥ï¼Œå°±å·®åˆ— xã€y äº†ã€‚</p><p>ä»¥ä¸‹ä»¥ 5*5 ä¸ºä¾‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">var</span> <span class=\"nx\">arr</span> <span class=\"o\">=</span> <span class=\"nb\">Array</span><span class=\"p\">.</span><span class=\"nx\">from</span><span class=\"p\">({</span><span class=\"nx\">length</span><span class=\"o\">:</span> <span class=\"mi\">5</span><span class=\"p\">}).</span><span class=\"nx\">map</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"p\">=&gt;</span> <span class=\"p\">([]));</span>\n<span class=\"kd\">var</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"kd\">function</span> <span class=\"nx\">Sort</span><span class=\"p\">(</span><span class=\"nx\">init</span><span class=\"p\">,</span> <span class=\"nx\">length</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">m</span> <span class=\"o\">=</span> <span class=\"nx\">init</span><span class=\"p\">,</span> <span class=\"nx\">n</span><span class=\"o\">=</span> <span class=\"nx\">init</span><span class=\"p\">;</span>\n    <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">m</span> <span class=\"o\">&lt;</span> <span class=\"nx\">length</span><span class=\"p\">){</span>\n        <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">m</span><span class=\"o\">++</span><span class=\"p\">][</span><span class=\"nx\">init</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"o\">--</span><span class=\"nx\">m</span><span class=\"p\">;</span>\n    <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">n</span> <span class=\"o\">&lt;</span> <span class=\"nx\">length</span> <span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"o\">--</span><span class=\"nx\">m</span><span class=\"p\">][</span><span class=\"o\">++</span><span class=\"nx\">n</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"o\">--</span><span class=\"nx\">n</span><span class=\"p\">;</span>\n    <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">n</span> <span class=\"o\">&gt;</span> <span class=\"nx\">init</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">m</span><span class=\"p\">][</span><span class=\"nx\">n</span><span class=\"o\">--</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">length</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">3</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n    <span class=\"nx\">Sort</span><span class=\"p\">(</span><span class=\"nx\">n</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">length</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">Sort</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">),</span> <span class=\"nx\">arr</span><span class=\"p\">)</span>\n</code></pre></div><p>å˜åŠ¨çš„å°±æ˜¯æœªçŸ¥ï¼Œæ‰¾å‡ºå¾ªç¯æ¡ä»¶ï¼Œå…³è”å·²çŸ¥ï¼Œè¿™æ ·ç­‰å¼å°±ç®—åˆ—å‡ºæ¥äº†ã€‚åœ¨è¿™é‡Œæˆ‘æŠŠå¹³é¢æƒ³åƒæˆå¹³é¢åæ ‡ï¼Œmã€n å½“ä½œ xã€y è½´ï¼Œæ•°ç»„å°±æ˜¯åæ ‡ç‚¹çš„é›†åˆï¼Œæ•°å­—èºæ—‹æŠ˜è½¬çš„æ¡ä»¶ä½œä¸ºå¾ªç¯é€’å½’æ¡ä»¶ï¼Œå°±è¿™æ ·ï¼Œä¸€ä¸ªç²—ç³™çš„ç®—æ³•ç®—æ˜¯å®Œæˆäº†ã€‚</p><p>è™½ç„¶è¿™å’Œæœ¬æ¬¡ä¸»é¢˜çš„å…³ç³»ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯å¾ˆå—å¯å‘ï¼Œè®©æˆ‘è§‰å¾—ç¨‹åºå’Œæ•°å­¦æœç„¶å­˜åœ¨ç€ç´§å¯†çš„å…³ç³»ã€‚å›åˆ°è¿™ä¸€å°èŠ‚ï¼Œä»¥æœ€ç®€å•çš„ for å¾ªç¯ä¸ºä¾‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">arr</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">];</span>\n<span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){}</span>\n</code></pre></div><p>ä»¥ä¸Šå°±æ˜¯æœ€ç®€å•çš„ for å¾ªç¯å†™æ³•ï¼Œä»è¿™ä¸ªç®€å•çš„ for è¯­å¥ï¼Œæˆ‘ä»¬èƒ½å¤ŸçŸ¥é“çš„æ˜¯ï¼Œç¬¬å‡ æ¬¡å¾ªç¯<code>i</code>ï¼ˆå³å½“å‰ï¼‰ï¼Œå¾ªç¯çš„æ¬¡æ•°<code>arr.length</code>åŠå¾ªç¯çš„é©±åŠ¨<code>i++</code>ã€‚å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯ï¼Œ<code>i</code> æ˜¯éšç€å¾ªç¯é€’å¢çš„ã€‚å¾ªç¯å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå…¶ä»–é­”åŠ›ã€‚</p><p>åœ¨æ’åºç®—æ³•ä¸­ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„ï¼Œé‚£å°±æ˜¯æ•°ç»„ã€‚åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å…ƒç´ åœ¨å†…å­˜ä¸­å¹¶ä¸æ˜¯è¿ç»­çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•æ¥å¼•ç”¨ç›¸åº”ä½ç½®çš„å…ƒç´ ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬é€šå¸¸æ“ä½œæ•°ç»„å…ƒç´ çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æ“ä½œæ•°ç»„å…ƒç´ æœ¬èº«ï¼Œè€Œæ˜¯è¯¥ä½ç½®ä¸Šçš„å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡æˆï¼Œæ¯ä¸€ä¸ªç´¢å¼•ä½ç½®éƒ½æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡ç»™å˜é‡èµ‹å€¼æ•°ç»„å…ƒç´ ã€‚</p><p>å¾ªç¯å’Œæ•°ç»„ï¼Œå¦‚æœå•ç‹¬ä½¿ç”¨å€’ä¹Ÿæ²¡ä»€ä¹ˆã€‚å¦‚æœä¸¤è€…ç»“åˆï¼Œä½ å°±ä¼šå‘ç°ï¼Œéšç€å¾ªç¯çš„æ¬¡æ•°å¢åŠ ï¼Œæ•°ç»„ç´¢å¼•ä¹Ÿä¼šé€’å¢ï¼Œå†ç»“åˆä¸€äº›é€»è¾‘ï¼Œå°±å¯ä»¥æŠŠæŸäº›å…ƒç´ ç§»åŠ¨åˆ°åˆ¶å®šçš„ä½ç½®ã€‚</p><p>é‚£ä¹ˆï¼Œéƒ½ç»“åˆæ€æ ·çš„é€»è¾‘å‘¢ï¼Ÿ</p><h2>å†’æ³¡æ’åº</h2><p>å†’æ³¡æ’åºé€»è¾‘ï¼Œé€šè¿‡ä¸¤ä¸¤æ¯”è¾ƒï¼ŒæŠŠè¾ƒå¤§çš„å…ƒç´ èµ‹å€¼ç»™å½“å‰ä½ç½®ç´¢å¼•çš„åä¸€ç´¢å¼•ä½ç½®ï¼Œç„¶åéšç€å¾ªç¯å¢åŠ ï¼Œå½“å‰ç´¢å¼•ä¹Ÿä¼šé€’å¢ï¼Œæœ€ç»ˆä¼šæŠŠæœ€å¤§å€¼æ¨åˆ°æœ«å°¾ã€‚ç„¶åæŠŠè¿™ä¸ªè¿‡ç¨‹å¾ªç¯å¤šæ¬¡ï¼Œæœ€ç»ˆæŠŠå€’æ•°ç¬¬äºŒå¤§ã€å€’æ•°ç¬¬ä¸‰å¤§...ç§»åˆ°æŒ‡å®šä½ç½®ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"826\" data-rawheight=\"257\" data-thumbnail=\"https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"826\" data-original=\"https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;826&#39; height=&#39;257&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"826\" data-rawheight=\"257\" data-thumbnail=\"https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"826\" data-original=\"https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">bubbleSort</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){</span>\n        <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">j</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">j</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span> <span class=\"o\">-</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"nx\">i</span><span class=\"p\">;</span> <span class=\"nx\">j</span><span class=\"o\">++</span><span class=\"p\">){</span>    <span class=\"c1\">// é€’å¢æ›´æ¢å½“å‰å…ƒç´ ï¼›\n</span><span class=\"c1\"></span>            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">]){</span>    <span class=\"c1\">// ç›¸é‚»å…ƒç´ æ¯”è¾ƒï¼›\n</span><span class=\"c1\"></span>                <span class=\"p\">[</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">],</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">],</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">]];</span>    <span class=\"c1\">// ä½ç½®äº’æ¢ï¼›\n</span><span class=\"c1\"></span>            <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>é€‰æ‹©æ’åº</h2><p>é€‰æ‹©æ’åºé€»è¾‘ï¼Œæ¯”è¾ƒå½“å‰æ•°ç»„å…ƒç´ ï¼Œæ‰¾å‡ºæœ€å°å…ƒç´ çš„ç´¢å¼•ï¼Œå°†è¯¥ä½ç½®çš„å…ƒç´ ç§»åŠ¨æŒ‡å®šä½ç½®ã€‚ç„¶åå¤šæ¬¡å¾ªç¯éå†ï¼Œæœ€ç»ˆå°†å‰©ä¸‹æ•°ç»„å…ƒç´ ä¸­ç¬¬äºŒå°å…ƒç´ ã€ç¬¬ä¸‰å°å…ƒç´ ...ç§»åˆ°æŒ‡å®šä½ç½®ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-1c7e20f306ddc02eb4e3a50fa7817ff4_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"811\" data-rawheight=\"248\" data-thumbnail=\"https://pic1.zhimg.com/v2-1c7e20f306ddc02eb4e3a50fa7817ff4_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"811\" data-original=\"https://pic1.zhimg.com/v2-1c7e20f306ddc02eb4e3a50fa7817ff4_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;811&#39; height=&#39;248&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"811\" data-rawheight=\"248\" data-thumbnail=\"https://pic1.zhimg.com/v2-1c7e20f306ddc02eb4e3a50fa7817ff4_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"811\" data-original=\"https://pic1.zhimg.com/v2-1c7e20f306ddc02eb4e3a50fa7817ff4_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-1c7e20f306ddc02eb4e3a50fa7817ff4_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">selectionSort</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){</span>\n        <span class=\"kd\">let</span> <span class=\"nx\">minIndex</span> <span class=\"o\">=</span> <span class=\"nx\">i</span><span class=\"p\">;</span>\n        <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">j</span> <span class=\"o\">=</span> <span class=\"nx\">i</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"nx\">j</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span><span class=\"p\">;</span> <span class=\"nx\">j</span> <span class=\"o\">++</span><span class=\"p\">){</span>    <span class=\"c1\">// é€’å¢æ›¿æ¢å½“å‰å…ƒç´ ï¼›\n</span><span class=\"c1\"></span>            <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">]</span> <span class=\"o\">&lt;</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">minIndex</span><span class=\"p\">]){</span>\n                <span class=\"nx\">minIndex</span> <span class=\"o\">=</span> <span class=\"nx\">j</span><span class=\"p\">;</span>    <span class=\"c1\">// æ›´æ–°æœ€å°å…ƒç´ ç´¢å¼•ï¼›\n</span><span class=\"c1\"></span>            <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n        <span class=\"p\">[</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">minIndex</span><span class=\"p\">],</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">],</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">minIndex</span><span class=\"p\">]];</span>    <span class=\"c1\">// ä¸æœ€å°å…ƒç´ äº’æ¢ä½ç½®ï¼›\n</span><span class=\"c1\"></span>    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>æ’å…¥æ’åº</h2><p>æ’å…¥æ’åºé€»è¾‘ï¼Œå°†å½“å‰çš„æ•°ç»„å…ƒç´ ä¸ä¹‹å‰çš„æ•°ç»„å…ƒç´ æ¯”è¾ƒï¼Œå¹¶å°†å…¶æ’å…¥åˆ°é€‚å½“ä½ç½®ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-91b76e8e4dab9b0cad9a017d7dd431e2_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"811\" data-rawheight=\"505\" data-thumbnail=\"https://pic3.zhimg.com/v2-91b76e8e4dab9b0cad9a017d7dd431e2_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"811\" data-original=\"https://pic3.zhimg.com/v2-91b76e8e4dab9b0cad9a017d7dd431e2_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;811&#39; height=&#39;505&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"811\" data-rawheight=\"505\" data-thumbnail=\"https://pic3.zhimg.com/v2-91b76e8e4dab9b0cad9a017d7dd431e2_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"811\" data-original=\"https://pic3.zhimg.com/v2-91b76e8e4dab9b0cad9a017d7dd431e2_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-91b76e8e4dab9b0cad9a017d7dd431e2_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">insertionSort</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){</span>\n        <span class=\"kd\">let</span> <span class=\"nx\">temp</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n        <span class=\"kd\">let</span> <span class=\"nx\">preIndex</span> <span class=\"o\">=</span> <span class=\"nx\">i</span> <span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">;</span>\n        <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">preIndex</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preIndex</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"nx\">temp</span><span class=\"p\">){</span>\n            <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preIndex</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preIndex</span><span class=\"o\">--</span><span class=\"p\">];</span>    <span class=\"c1\">// è¯¥ä½ç½®å…ƒç´ è‹¥å°äºå½“å‰å…ƒç´ ï¼Œåˆ™å°†å…¶åç§»åŠ¨ï¼›\n</span><span class=\"c1\"></span>        <span class=\"p\">}</span>\n        <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preIndex</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">temp</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>å¸Œå°”æ’åº</h2><p>å¸Œå°”æ’åºç®—æ˜¯æ’å…¥æ’åºçš„å‡çº§ç‰ˆæœ¬ï¼Œæ’å…¥æ’åºæ˜¯ä¸ä¹‹å‰çš„æ•°ç»„å…ƒç´ æŒ¨ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œè€Œå¸Œå°”æ’åºæ˜¯ä»¥ç‰¹å®šé—´éš”è¿›è¡Œå¤šæ¬¡åˆ†ç»„æ¯”è¾ƒï¼Œæ‰€ä»¥è¯´åœ¨ä»£ç ä¸Šå¾ˆç›¸ä¼¼ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-671bd19a44faf77479d68805a083892c_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"665\" data-rawheight=\"290\" data-thumbnail=\"https://pic1.zhimg.com/v2-671bd19a44faf77479d68805a083892c_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"665\" data-original=\"https://pic1.zhimg.com/v2-671bd19a44faf77479d68805a083892c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;665&#39; height=&#39;290&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"665\" data-rawheight=\"290\" data-thumbnail=\"https://pic1.zhimg.com/v2-671bd19a44faf77479d68805a083892c_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"665\" data-original=\"https://pic1.zhimg.com/v2-671bd19a44faf77479d68805a083892c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-671bd19a44faf77479d68805a083892c_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">shellSort</span><span class=\"p\">(</span><span class=\"nx\">gap</span><span class=\"p\">,</span> <span class=\"nx\">arr</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">gap</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){</span>    <span class=\"c1\">// ä»¥ä¸åŒé—´éš”åˆ†ç»„æ¯”è¾ƒï¼›\n</span><span class=\"c1\"></span>        <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">j</span> <span class=\"o\">=</span> <span class=\"nx\">gap</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span> <span class=\"nx\">j</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span><span class=\"p\">;</span> <span class=\"nx\">j</span><span class=\"o\">++</span><span class=\"p\">){</span>    <span class=\"c1\">// ä»¥é—´éš”çš„ä¸‹ä¸€ç´¢å¼•ä½ç½®èµ·å§‹ï¼›\n</span><span class=\"c1\"></span>            <span class=\"kd\">let</span> <span class=\"nx\">temp</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">];</span>\n            <span class=\"kd\">let</span> <span class=\"nx\">preGapIndex</span> <span class=\"o\">=</span> <span class=\"nx\">j</span> <span class=\"o\">-</span> <span class=\"nx\">gap</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n            <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">preGapIndex</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preGapIndex</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"nx\">temp</span><span class=\"p\">){</span>    <span class=\"c1\">// å½“å‰å…ƒç´ ä¸ä¹‹å‰å›ºå®šé—´éš”ç´¢å¼•ä½ç½®å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼›\n</span><span class=\"c1\"></span>                <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preGapIndex</span> <span class=\"o\">+</span> <span class=\"nx\">gap</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preGapIndex</span><span class=\"p\">];</span>\n                <span class=\"nx\">preGapIndex</span> <span class=\"o\">=</span> <span class=\"nx\">preGapIndex</span> <span class=\"o\">-</span> <span class=\"nx\">gap</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">];</span>\n            <span class=\"p\">}</span>\n            <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">preGapIndex</span> <span class=\"o\">+</span> <span class=\"nx\">gap</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"nx\">temp</span><span class=\"p\">;</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>å½’å¹¶æ’åº</h2><p>å½’å¹¶æ’åºé€»è¾‘ï¼Œä½¿ç”¨é€’å½’çš„æ–¹å¼å°†æ•°ç»„åˆ’åˆ†ä¸ºæ›´å°çš„æ•°ç»„å¯¹ï¼Œé€šè¿‡æ¯”è¾ƒé‡æ–°åˆæˆå®Œæ•´çš„æ•°ç»„ã€‚æœ¬æ–‡é‡‡ç”¨çš„æ˜¯è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åºï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªåº•å‘ä¸Šçš„å½’å¹¶æ’åºã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-cdda3f11c6efbc01577f5c29a9066772_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"811\" data-rawheight=\"505\" data-thumbnail=\"https://pic3.zhimg.com/v2-cdda3f11c6efbc01577f5c29a9066772_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"811\" data-original=\"https://pic3.zhimg.com/v2-cdda3f11c6efbc01577f5c29a9066772_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;811&#39; height=&#39;505&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"811\" data-rawheight=\"505\" data-thumbnail=\"https://pic3.zhimg.com/v2-cdda3f11c6efbc01577f5c29a9066772_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"811\" data-original=\"https://pic3.zhimg.com/v2-cdda3f11c6efbc01577f5c29a9066772_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-cdda3f11c6efbc01577f5c29a9066772_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">mergeSort</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">len</span> <span class=\"o\">&lt;</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">middle</span> <span class=\"o\">=</span> <span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">floor</span><span class=\"p\">(</span><span class=\"nx\">len</span><span class=\"o\">/</span><span class=\"mi\">2</span><span class=\"p\">);</span>    <span class=\"c1\">// åˆ†ç»„ï¼›\n</span><span class=\"c1\"></span>    <span class=\"kd\">let</span> <span class=\"nx\">left</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">slice</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"nx\">middle</span><span class=\"p\">);</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">right</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">slice</span><span class=\"p\">(</span><span class=\"nx\">middle</span><span class=\"p\">);</span>\n    <span class=\"k\">return</span> <span class=\"nx\">merge</span><span class=\"p\">(</span><span class=\"nx\">mergeSort</span><span class=\"p\">(</span><span class=\"nx\">left</span><span class=\"p\">),</span> <span class=\"nx\">mergeSort</span><span class=\"p\">(</span><span class=\"nx\">right</span><span class=\"p\">));</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">function</span> <span class=\"nx\">merge</span><span class=\"p\">(</span><span class=\"nx\">left</span><span class=\"p\">,</span> <span class=\"nx\">right</span><span class=\"p\">){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">left</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">+</span> <span class=\"nx\">right</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"p\">[],</span> <span class=\"nx\">m</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"nx\">n</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n    <span class=\"nx\">left</span><span class=\"p\">[</span><span class=\"nx\">left</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">Infinity</span><span class=\"p\">;</span>\n    <span class=\"nx\">right</span><span class=\"p\">[</span><span class=\"nx\">right</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">Infinity</span><span class=\"p\">;</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){</span>    <span class=\"c1\">// å¾ªç¯çš„æ¬¡æ•°ä¸ºæ–°æ•°ç»„çš„é•¿åº¦ï¼›\n</span><span class=\"c1\"></span>        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">left</span><span class=\"p\">[</span><span class=\"nx\">m</span><span class=\"p\">]</span> <span class=\"o\">&lt;=</span> <span class=\"nx\">right</span><span class=\"p\">[</span><span class=\"nx\">n</span><span class=\"p\">]){</span>    <span class=\"c1\">// æ¯”è¾ƒå·¦å³æ•°ç»„å…ƒç´ é‡æ–°æ’åˆ—ç»„åˆæˆæ–°çš„æ•°ç»„ï¼›\n</span><span class=\"c1\"></span>            <span class=\"nx\">result</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">left</span><span class=\"p\">[</span><span class=\"nx\">m</span><span class=\"p\">];</span>\n            <span class=\"nx\">m</span><span class=\"o\">++</span><span class=\"p\">;</span>\n        <span class=\"p\">}</span><span class=\"k\">else</span><span class=\"p\">{</span>\n            <span class=\"nx\">result</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">right</span><span class=\"p\">[</span><span class=\"nx\">n</span><span class=\"p\">];</span>\n            <span class=\"nx\">n</span><span class=\"o\">++</span><span class=\"p\">;</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">result</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>å¿«é€Ÿæ’åº</h2><p>å¿«é€Ÿæ’åºé€»è¾‘ï¼Œä»æ•°ç»„ä¸­é€‰å‡ºåŸºå‡†å€¼ï¼Œå°†å¤§äºåŸºå‡†å€¼çš„å…ƒç´ ç§»åˆ°å³ä¾§æ•°ç»„ï¼Œå°†å°äºåŸºå‡†å€¼çš„å…ƒç´ ç§»åˆ°å·¦ä¾§æ•°ç»„ï¼Œé€’å½’å¾ªç¯æ­¤æ“ä½œç›´åˆ°æ•°ç»„ä¸ºç©ºã€‚ç„¶ååˆå¹¶å„ç»„æ•°ç»„ï¼Œæœ€ç»ˆå¾—åˆ°æ’åºåçš„æ–°æ•°ç»„ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-da6f8e4afb8b9c8adf9567fd2fefca55_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"591\" data-rawheight=\"458\" class=\"origin_image zh-lightbox-thumb\" width=\"591\" data-original=\"https://pic2.zhimg.com/v2-da6f8e4afb8b9c8adf9567fd2fefca55_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;591&#39; height=&#39;458&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"591\" data-rawheight=\"458\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"591\" data-original=\"https://pic2.zhimg.com/v2-da6f8e4afb8b9c8adf9567fd2fefca55_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-da6f8e4afb8b9c8adf9567fd2fefca55_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">quickSort</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">){</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">&lt;</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"k\">return</span> <span class=\"nx\">arr</span><span class=\"p\">;</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">pivot</span> <span class=\"o\">=</span> <span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span>    <span class=\"c1\">// è®¾ç½®åŸºå‡†å€¼ï¼›\n</span><span class=\"c1\"></span>    <span class=\"kd\">let</span> <span class=\"nx\">lesser</span> <span class=\"o\">=</span> <span class=\"p\">[],</span> <span class=\"nx\">greater</span> <span class=\"o\">=</span> <span class=\"p\">[];</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">){</span>\n        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]</span> <span class=\"o\">&lt;</span> <span class=\"nx\">pivot</span><span class=\"p\">){</span>\n            <span class=\"nx\">lesser</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]);</span>    <span class=\"c1\">// å°†å°äºåŸºå‡†å€¼æ¨è‡³å·¦ä¾§ï¼›\n</span><span class=\"c1\"></span>        <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n            <span class=\"nx\">greater</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span><span class=\"nx\">arr</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]);</span>    <span class=\"c1\">// å°†å¤§äºåŸºå‡†å€¼æ¨è‡³å³ä¾§ï¼›\n</span><span class=\"c1\"></span>        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">return</span> <span class=\"nx\">quickSort</span><span class=\"p\">(</span><span class=\"nx\">lesser</span><span class=\"p\">).</span><span class=\"nx\">concat</span><span class=\"p\">(</span><span class=\"nx\">pivot</span><span class=\"p\">,</span> <span class=\"nx\">quickSort</span><span class=\"p\">(</span><span class=\"nx\">greater</span><span class=\"p\">));</span>\n<span class=\"p\">}</span>\n</code></pre></div><p><b>overï¼</b></p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "ç®—æ³•", 
                    "tagLink": "https://api.zhihu.com/topics/19553510"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/73773366", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 1, 
            "title": "MVCç®€å•å®ç°ï¼ˆDEMOï¼‰", 
            "content": "<p>ç»è¿‡ä¹‹å‰çš„<a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/post/5c4d37c351882546660d3718\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åœ¨JavaScriptä¸­ç†è§£ç­–ç•¥æ¨¡å¼</a>ã€<a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/post/5c53f218f265da2de4504b42\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åœ¨JavaScriptä¸­ç†è§£ç»„åˆæ¨¡å¼</a>ã€<a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/post/5c596ced6fb9a049a71243eb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æµ…è°ˆMVC/MVP/MVVMæ¨¡å¼ï¼ˆæ¦‚è¿°ï¼‰</a> å’Œ è¾ƒæ—©ä¹‹å‰çš„<a href=\"https://link.zhihu.com/?target=https%3A//juejin.im/post/5bfd552e518825773a2ecca0\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è¿›å‡»çš„è§‚å¯Ÿè€…æ¨¡å¼</a>ç­‰æ–‡ç« çš„é“ºå«ï¼Œç»ˆäºå¯ä»¥æŠŠè¿™äº›ç†è®ºçš„ä¸œè¥¿ç”¨äºå®è·µäº†ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´å¥”ä¸»é¢˜ã€‚</p><p>(ä»¥ä¸‹ä»£ç å¯è§<a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E5%2585%25B3%25E4%25BA%258EMVC%25E6%25A8%25A1%25E5%25BC%258F%25E7%25AE%2580%25E5%258D%2595%25E4%25BB%25A3%25E7%25A0%2581%25E5%25AE%259E%25E7%258E%25B0/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åšå®¢åŸæ–‡</a> æˆ– <a href=\"https://link.zhihu.com/?target=https%3A//codepen.io/yexiaochen/pen/aXWLRz\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ™®é€šå®ç°â€”codepen</a>ã€<a href=\"https://link.zhihu.com/?target=https%3A//codepen.io/yexiaochen/pen/MLErQa\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">MVCå®ç°-codepen</a>ã€‚ï¼‰</p><blockquote>GoF å¹¶ä¸å°† MVC å¼•è¿°ä¸ºä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œè€Œæ˜¯æŠŠå®ƒçœ‹åšæ˜¯æ„å»ºä¸€ä¸ªç”¨æˆ·ç•Œé¢çš„ç±»çš„é›†åˆã€‚æŒ‰ç…§ä»–ä»¬çš„è§‚ç‚¹ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸‰ç§ç»å…¸è®¾è®¡æ¨¡å¼çš„å˜å¼‚ç»„åˆï¼šè§‚å¯Ÿè€…æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼å’Œç»„åˆæ¨¡å¼ã€‚ä¾èµ–äºæ¡†æ¶ä¸­çš„ MVC å¦‚ä½•å®ç°ï¼Œå®ƒä¹Ÿå¯èƒ½ä¼šä½¿ç”¨å·¥å‚å’Œæ¨¡æ¿æ¨¡å¼ã€‚GoF Book æåˆ°è¿™äº›æ¨¡å¼åœ¨ä½¿ç”¨ MVC å·¥ä½œæ—¶æ˜¯éå¸¸æœ‰ç”¨çš„é™„åŠ åŠŸèƒ½ã€‚</blockquote><p>åŠŸèƒ½ç¤ºæ„:</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-1f3e94eb31357c669c11fde4ec3a983a_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"744\" data-rawheight=\"401\" data-thumbnail=\"https://pic3.zhimg.com/v2-1f3e94eb31357c669c11fde4ec3a983a_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"744\" data-original=\"https://pic3.zhimg.com/v2-1f3e94eb31357c669c11fde4ec3a983a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;744&#39; height=&#39;401&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"744\" data-rawheight=\"401\" data-thumbnail=\"https://pic3.zhimg.com/v2-1f3e94eb31357c669c11fde4ec3a983a_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"744\" data-original=\"https://pic3.zhimg.com/v2-1f3e94eb31357c669c11fde4ec3a983a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-1f3e94eb31357c669c11fde4ec3a983a_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>ç”±ä¸€ç»„æ•°æ®å±•ç¤ºä¸‰ç±»è¡¨æ ¼ï¼Œåˆ†åˆ«æ˜¯ã€stuffï¼Œscaleã€‘ã€ã€stuffï¼Œsalaryã€‘ã€ã€stuffï¼Œscaleï¼Œsalaryã€‘ä¸‰ç»„è§†å›¾ã€‚å¦å¤–å¯ä»¥ä¿®æ”¹æŒ‡å®š stuff çš„ scale æˆ– salary ä¿¡æ¯ã€‚</p><p>stuffs ä¿¡æ¯ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">stuffs</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n  <span class=\"p\">{</span>\n    <span class=\"nx\">stuff</span><span class=\"o\">:</span> <span class=\"s1\">&#39;person_1&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">scale</span><span class=\"o\">:</span> <span class=\"s1\">&#39;ç”²&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">salary</span><span class=\"o\">:</span> <span class=\"s1\">&#39;6000&#39;</span>\n  <span class=\"p\">},</span>\n  <span class=\"p\">{</span>\n    <span class=\"nx\">stuff</span><span class=\"o\">:</span> <span class=\"s1\">&#39;person_2&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">scale</span><span class=\"o\">:</span> <span class=\"s1\">&#39;ä¹™&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">salary</span><span class=\"o\">:</span> <span class=\"s1\">&#39;5000&#39;</span>\n  <span class=\"p\">},</span>\n  <span class=\"p\">{</span>\n    <span class=\"nx\">stuff</span><span class=\"o\">:</span> <span class=\"s1\">&#39;person_3&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">scale</span><span class=\"o\">:</span> <span class=\"s1\">&#39;ä¸™&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">salary</span><span class=\"o\">:</span> <span class=\"s1\">&#39;9000&#39;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">];</span>\n</code></pre></div><p>å¸¸è§„çš„å†™æ³•å¯ä»¥è¿™ä¹ˆæ¥ï¼š</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-dccfbd13e182b4d7077f50a4c16c065d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2312\" data-rawheight=\"1634\" class=\"origin_image zh-lightbox-thumb\" width=\"2312\" data-original=\"https://pic2.zhimg.com/v2-dccfbd13e182b4d7077f50a4c16c065d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;2312&#39; height=&#39;1634&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2312\" data-rawheight=\"1634\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"2312\" data-original=\"https://pic2.zhimg.com/v2-dccfbd13e182b4d7077f50a4c16c065d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-dccfbd13e182b4d7077f50a4c16c065d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>èŒè´£åˆ†é…</h2><p>æ—¢ç„¶è¯´äº† MVC æœ‰é‚£ä¹ˆå¤šå¥½å¤„ï¼Œæˆ‘ä»¬å°±ç”¨ MVC çš„æ¨¡å¼æ¥æ”¹é€ ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆåˆ’åˆ†ä¸‹èŒè´£ã€‚</p><p>Model è´Ÿè´£å¯¹æ•°æ®çš„å¤„ç†å¹¶è¿”å›ç›®æ ‡æ•°æ®ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹æ˜¯ç­›é€‰ stuffã€ä¿®æ”¹stuff ç­‰èŒè´£ã€‚</p><p>View è´Ÿè´£å¯¹ç›®æ ‡æ•°æ®çš„æ¸²æŸ“å’Œå¤„ç†ç”¨æˆ·çš„å“åº”ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹æ˜¯å„ä¸ªè¡¨æ ¼çš„æ¸²æŸ“ã€change äº‹ä»¶çš„å§”æ‰˜ç­‰èŒè´£ã€‚</p><p>Control è´Ÿè´£åè°ƒ Model å’Œ Viewï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹æ˜¯å¤„ç†å§”æ‰˜ã€å¤„ç†æ•°æ®ç­‰èŒè´£ã€‚</p><p><b>æ­¤å¤„çš„ MVC å®ç°æ˜¯é’ˆå¯¹ä¸€ä¸ª Model å¯¹åº”å¤šä¸ª View çš„ä»£ç å®ç°</b>ï¼Œ ä¹Ÿæ˜¯ä¸ºäº†æŠŠè§‚å¯Ÿè€…æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼å’Œç»„åˆæ¨¡å¼æ¨¡å¼éƒ½ç”¨èµ·æ¥ã€‚</p><h2>View</h2><p>ã€stuffï¼Œscaleã€‘ã€ã€stuffï¼Œsalaryã€‘ã€ã€stuffï¼Œscaleï¼Œsalaryã€‘ä¸‰ç»„è§†å›¾å°±æ˜¯ä¸‰ä¸ª Viewï¼Œæ¯ä¸ª View éƒ½å¯ä»¥ç‹¬ç«‹æ¸²æŸ“è‡ªå·±çš„ä¸€ç»„è§†å›¾ã€‚ç»“åˆç»„åˆæ¨¡å¼ï¼Œæˆ‘ä»¬æˆ‘ä»¬é€ äº›è§†å›¾çš„å¶å¯¹è±¡å’Œåˆ†æ”¯å¯¹è±¡ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-179ba61a8a9a8100731dfa7709b67f46_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1790\" data-rawheight=\"1026\" class=\"origin_image zh-lightbox-thumb\" width=\"1790\" data-original=\"https://pic3.zhimg.com/v2-179ba61a8a9a8100731dfa7709b67f46_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1790&#39; height=&#39;1026&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1790\" data-rawheight=\"1026\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1790\" data-original=\"https://pic3.zhimg.com/v2-179ba61a8a9a8100731dfa7709b67f46_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-179ba61a8a9a8100731dfa7709b67f46_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-html\"><span class=\"p\">&lt;</span><span class=\"nt\">html</span><span class=\"p\">&gt;</span>\n  <span class=\"p\">&lt;</span><span class=\"nt\">head</span><span class=\"p\">&gt;&lt;/</span><span class=\"nt\">head</span><span class=\"p\">&gt;</span>\n  <span class=\"p\">&lt;</span><span class=\"nt\">body</span><span class=\"p\">&gt;</span>\n    <span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">id</span><span class=\"o\">=</span><span class=\"s\">&#34;app&#34;</span><span class=\"p\">&gt;&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>\n  <span class=\"p\">&lt;/</span><span class=\"nt\">body</span><span class=\"p\">&gt;</span>\n<span class=\"p\">&lt;/</span><span class=\"nt\">html</span><span class=\"p\">&gt;</span>\n<span class=\"p\">&lt;</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span>\n    <span class=\"k\">const</span> <span class=\"nx\">$APP</span> <span class=\"o\">=</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">getElementById</span><span class=\"p\">(</span><span class=\"s1\">&#39;app&#39;</span><span class=\"p\">);</span>\n<span class=\"p\">&lt;/</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span></code></pre></div><p>å¶å¯¹è±¡ï¼ˆæ­¤å¤„æœ‰ä¸¤ç±»è§†å›¾ï¼‰ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">leafView_1</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n<span class=\"k\">const</span> <span class=\"nx\">renderTable</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">return</span> <span class=\"p\">{</span>\n        <span class=\"nx\">render</span><span class=\"o\">:</span> <span class=\"nx\">renderTable</span><span class=\"p\">()</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">leafView_2</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">Control</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"nx\">$ONE</span> <span class=\"o\">=</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">getElementById</span><span class=\"p\">(</span><span class=\"s1\">&#39;one&#39;</span><span class=\"p\">);</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">$SCALE</span><span class=\"p\">;</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">$SALARY</span><span class=\"p\">;</span>\n    <span class=\"k\">const</span> <span class=\"nx\">renderSearchTable</span> <span class=\"o\">=</span> <span class=\"nx\">params</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">handleModify</span> <span class=\"o\">=</span> <span class=\"nx\">e</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">bindEvent</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">return</span> <span class=\"p\">{</span>\n        <span class=\"nx\">render</span><span class=\"o\">:</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...}</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>åˆ†æ”¯å¯¹è±¡ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">branchView</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">Control</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">$SEARCH</span><span class=\"p\">,</span> <span class=\"nx\">$ALL</span><span class=\"p\">;</span>\n    <span class=\"k\">const</span> <span class=\"nx\">Views</span> <span class=\"o\">=</span> <span class=\"p\">[];</span>\n    <span class=\"k\">const</span> <span class=\"nx\">addView</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">render</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">handleSearch</span> <span class=\"o\">=</span> <span class=\"nx\">event</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">bindEvent</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...}</span>\n    <span class=\"k\">const</span> <span class=\"nx\">initDOM</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"nx\">initDOM</span><span class=\"p\">();</span>\n    <span class=\"k\">return</span> <span class=\"p\">{</span>\n        <span class=\"nx\">render</span><span class=\"p\">,</span>\n        <span class=\"nx\">addView</span><span class=\"p\">,</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">};</span>\n</code></pre></div><h2>Model</h2><p>Model ä¸»è¦æ˜¯å°†æ•°æ®å¤„ç†æˆç›®æ ‡æ•°æ®ï¼Œå¹¶æä¾› View æ³¨å†Œé€šçŸ¥æ¥å£ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">Model</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">stuffData</span> <span class=\"o\">=</span> <span class=\"p\">[];</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">filterData</span> <span class=\"o\">=</span> <span class=\"p\">[];</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">Views</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">ajaxFun</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">[...];</span> <span class=\"c1\">// æ¨¡æ‹Ÿåå°è·å–æ•°æ®ï¼›\n</span><span class=\"c1\"></span>    <span class=\"k\">const</span> <span class=\"nx\">setStuffData</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">filterStuff</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">setFilterStuff</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">findStuff</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">modifyStuffData</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">register</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">notify</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">return</span> <span class=\"p\">{</span>\n        <span class=\"nx\">setStuffData</span><span class=\"p\">,</span>\n        <span class=\"nx\">setFilterStuff</span><span class=\"p\">,</span>\n        <span class=\"nx\">modifyStuffData</span>\n        <span class=\"nx\">register</span><span class=\"p\">,</span>\n        <span class=\"nx\">notify</span><span class=\"p\">,</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>Control</h2><p>é‰´äºæ­¤å¤„æœ‰å¤šç±»è§†å›¾ï¼ŒModel å’Œ View ä¹‹é—´ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å‘å¸ƒè®¢é˜…æ¨¡å¼è€Œä¸æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚Model éœ€è¦æ”¶é›† Viewï¼Œç„¶ååœ¨æ•°æ®æ”¹å˜æ—¶å€™æ›´æ–°è§†å›¾ã€‚åŒæ—¶ï¼ŒView æ³¨å…¥äº† Control äº†ï¼Œæ„å‘³ç€ä¸åŒçš„ Control å°±æ˜¯ä¸åŒçš„ç­–ç•¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">Control</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"nx\">ModelInstance</span> <span class=\"o\">=</span> <span class=\"nx\">Model</span><span class=\"p\">();</span>\n    <span class=\"k\">const</span> <span class=\"nx\">View_1</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">View_2</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">init</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"p\">()</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">filter</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">const</span> <span class=\"nx\">modifyStuffInfo</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{...};</span>\n    <span class=\"k\">return</span> <span class=\"p\">{</span>\n        <span class=\"nx\">init</span><span class=\"p\">,</span>\n        <span class=\"nx\">filter</span><span class=\"p\">,</span>\n        <span class=\"nx\">modifyStuffInfo</span>\n    <span class=\"p\">};</span>\n<span class=\"p\">};</span>\n</code></pre></div><p>MVC ä»£ç å®ç°ï¼š</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-020fbd8984e66bdcc3940d6a8e7e98c6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1904\" data-rawheight=\"600\" class=\"origin_image zh-lightbox-thumb\" width=\"1904\" data-original=\"https://pic3.zhimg.com/v2-020fbd8984e66bdcc3940d6a8e7e98c6_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1904&#39; height=&#39;600&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1904\" data-rawheight=\"600\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1904\" data-original=\"https://pic3.zhimg.com/v2-020fbd8984e66bdcc3940d6a8e7e98c6_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-020fbd8984e66bdcc3940d6a8e7e98c6_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>åè¯</h2><p>å°±è¿™ä¹ˆç®€å•çš„ä¸€ä¸ªéœ€æ±‚ï¼Œæ”¹æˆ MVC æ¨¡å¼åå°±å¤šäº† 100 å¤šè¡Œä»£ç ã€‚å°±å¦‚ä¸Šç¯‡æ–‡ç« æ‰€è¯´ä¸€æ ·ï¼Œå¦‚æœæ˜¯ç®€å•çš„éœ€æ±‚å‹æ ¹æ²¡å¿…è¦è¿™ä¹ˆæŠ˜è…¾ã€‚ä¸è¿‡ï¼Œæ”¹æˆ MVC åï¼Œå®ƒä»¬å„è‡ªèŒè´£ä¹Ÿå°±æ›´åŠ æ¸…æ™°äº†ï¼Œå¯¹ä»¥åçš„ç»´æŠ¤ä¹Ÿä¼šå¥½äº›ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "MVC", 
                    "tagLink": "https://api.zhihu.com/topics/19583976"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/72480082", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 6, 
            "title": "React+Koa+MongoDB+Dockerå¼€å‘ç¯å¢ƒ", 
            "content": "<h2>å‰è¨€</h2><p>æœ¬æ¬¡åšæ–‡ä¾ç„¶æ˜¯å¯¹ <code>multi-spa-webpack-cli</code> çš„æ‰©å……å’Œå®Œå–„ã€‚</p><ol><li>é›†æˆ <b>mongoose</b>ã€‚</li><li>é›†æˆ <b>Docker</b> å¼€å‘ç¯å¢ƒã€‚</li></ol><p><code>multi-spa-webpack-cli</code> å·²ç»å‘å¸ƒåˆ° npmï¼Œåªè¦åœ¨ node ç¯å¢ƒä¸‹å®‰è£…å³å¯ã€‚</p><div class=\"highlight\"><pre><code class=\"language-bash\">npm install multi-spa-webpack-cli -g</code></pre></div><p>ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:</p><div class=\"highlight\"><pre><code class=\"language-bash\"><span class=\"c1\"># 1. åˆå§‹åŒ–é¡¹ç›®</span>\n\nmulti-spa-webpack-cli init spa-project\n\n<span class=\"c1\"># 2. è¿›å…¥æ–‡ä»¶ç›®å½•</span>\n\n<span class=\"nb\">cd</span> spa-project\n\n<span class=\"c1\"># æœªä½¿ç”¨ Docker</span>\n<span class=\"c1\"># 3. æ‰“åŒ…ä¸å˜çš„éƒ¨åˆ†</span>\n\nnpm run build:dll\n\n<span class=\"c1\"># 4. å¯åŠ¨é¡¹ç›®ï¼ˆæ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨ï¼šlocalhost:8090ï¼‰</span>\n\nnpm start\n\n<span class=\"c1\"># 5. å¯åŠ¨ MongoDB</span>\n\nmongod\n\n<span class=\"c1\"># 6. å¯åŠ¨æœåŠ¡</span>\n\n<span class=\"nb\">cd</span> server\nnpm install\nnpm start\n\n<span class=\"c1\"># ä½¿ç”¨ Dockerï¼ˆéœ€å®‰è£…dockerï¼‰</span>\n<span class=\"c1\"># 3. å¯åŠ¨é¡¹ç›®ï¼ˆæ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨ï¼šlocalhost:8090ï¼‰</span>\n\nnpm run docker:dev</code></pre></div><p>ä»ä¸Šé¢çš„æ­¥éª¤å¯ä»¥çœ‹å‡ºï¼ŒDocker åªéœ€è¦ 3 æ­¥å°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ã€‚</p><h2>mongoose</h2><blockquote>mongoose æ˜¯åœ¨ node.js ç¯å¢ƒä¸‹å¯¹ MongoDB è¿›è¡Œä¾¿æ·æ“ä½œçš„å¯¹è±¡æ¨¡å‹å·¥å…·ã€‚</blockquote><p>åœ¨æ²¡å¼€å§‹ä¹‹å‰ï¼Œè¦å…ˆå®‰è£… MongoDBã€‚å®‰è£… MongoDB çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰äº›å°éº»çƒ¦ï¼Œå°¤å…¶æ˜¯å…¬å¸çš„ç”µè„‘ï¼ˆè°ä¹Ÿä¸çŸ¥é“ç”µè„‘é‡Œé…ç½®äº†ä»€ä¹ˆä¸œè¥¿ï¼‰ã€‚å®‰è£…è¿‡ç¨‹å¯å‚ç…§ ã€<a href=\"https://link.zhihu.com/?target=https%3A//docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/%23install\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å®˜ç½‘ï¼šå®‰è£…MongoDB</a>ã€‘</p><p>è¿˜è¦çŸ¥é“ MongoDB çš„ä¸€äº›æ¦‚å¿µã€‚</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-6b301c63250bfdcba44034ba5e5eb46c_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1814\" data-rawheight=\"740\" class=\"origin_image zh-lightbox-thumb\" width=\"1814\" data-original=\"https://pic1.zhimg.com/v2-6b301c63250bfdcba44034ba5e5eb46c_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1814&#39; height=&#39;740&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1814\" data-rawheight=\"740\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1814\" data-original=\"https://pic1.zhimg.com/v2-6b301c63250bfdcba44034ba5e5eb46c_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-6b301c63250bfdcba44034ba5e5eb46c_b.jpg\"/></figure><p>æ•°æ®åº“æœåŠ¡å’Œå®¢æˆ·ç«¯ï¼š</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-4eda59e8d65c3a32fba60b10d9929cc7_b.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1810\" data-rawheight=\"290\" class=\"origin_image zh-lightbox-thumb\" width=\"1810\" data-original=\"https://pic4.zhimg.com/v2-4eda59e8d65c3a32fba60b10d9929cc7_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1810&#39; height=&#39;290&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1810\" data-rawheight=\"290\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1810\" data-original=\"https://pic4.zhimg.com/v2-4eda59e8d65c3a32fba60b10d9929cc7_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-4eda59e8d65c3a32fba60b10d9929cc7_b.png\"/></figure><p>mongoose ç›¸å…³æ¦‚å¿µçœ‹çœ‹å®˜ç½‘å°±å¥½äº†ã€<a href=\"https://link.zhihu.com/?target=https%3A//mongoosedoc.top/docs/index.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">mongoose ä¸­æ–‡æ–‡æ¡£</a>ã€‘</p><p>ç”¨æ³•å¾ˆç®€å•ï¼Œå®šä¹‰ Schemaï¼Œè½¬æ¢æˆ Modelï¼Œæ“ä½œ Modelï¼Œç”Ÿæˆå®ä¾‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"cm\">/* model.js */</span>\n<span class=\"k\">const</span> <span class=\"nx\">mongoose</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">&#39;mongoose&#39;</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">Schema</span> <span class=\"o\">=</span> <span class=\"nx\">mongoose</span><span class=\"p\">.</span><span class=\"nx\">Schema</span><span class=\"p\">;</span>\n<span class=\"c1\">// å®šä¹‰ Schema\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">UserSchema</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Schema</span><span class=\"p\">({</span>\n  <span class=\"nx\">username</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"nb\">String</span><span class=\"p\">,</span>\n    <span class=\"nx\">unique</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"nx\">require</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n  <span class=\"p\">},</span>\n  <span class=\"nx\">password</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"nb\">String</span><span class=\"p\">,</span>\n    <span class=\"nx\">require</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">});</span>\n\n<span class=\"c1\">// è½¬æ¢æˆ Model\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">UserModel</span> <span class=\"o\">=</span> <span class=\"nx\">mongoose</span><span class=\"p\">.</span><span class=\"nx\">model</span><span class=\"p\">(</span><span class=\"s1\">&#39;User&#39;</span><span class=\"p\">,</span> <span class=\"nx\">UserSchema</span><span class=\"p\">);</span>\n\n<span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"nx\">UserModel</span><span class=\"p\">;</span>\n\n<span class=\"cm\">/* user.js */</span>\n<span class=\"c1\">// æ“ä½œ Model\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">user</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">UserModel</span><span class=\"p\">.</span><span class=\"nx\">findOne</span><span class=\"p\">({</span> <span class=\"nx\">username</span> <span class=\"p\">});</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">user</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">try</span> <span class=\"p\">{</span>\n            <span class=\"c1\">// ç”Ÿæˆå®ä¾‹\n</span><span class=\"c1\"></span>            <span class=\"kr\">await</span> <span class=\"k\">new</span> <span class=\"nx\">UserModel</span><span class=\"p\">({</span>\n            <span class=\"nx\">username</span><span class=\"p\">,</span>\n            <span class=\"nx\">password</span>\n            <span class=\"p\">}).</span><span class=\"nx\">save</span><span class=\"p\">();</span>\n            <span class=\"nx\">ctx</span><span class=\"p\">.</span><span class=\"nx\">body</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&#34;success&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n            <span class=\"s2\">&#34;message&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;æ³¨å†ŒæˆåŠŸ&#34;</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"nx\">ctx</span><span class=\"p\">.</span><span class=\"nx\">body</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&#34;success&#34;</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n            <span class=\"s2\">&#34;message&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;æ³¨å†Œå¤±è´¥&#34;</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"nx\">ctx</span><span class=\"p\">.</span><span class=\"nx\">body</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"s2\">&#34;success&#34;</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;message&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;ç”¨æˆ·åå·²å­˜åœ¨&#34;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>Docker</h2><p>ç”±ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œé¡¹ç›®å¯åŠ¨æ­¥éª¤éº»çƒ¦ï¼Œè€Œä¸”åœ¨å®‰è£… MongoDB ç¯å¢ƒæ—¶ï¼Œå®¹æ˜“å—å¹²æ‰°ã€‚</p><p>ä¸‹é¢é€šè¿‡ Docker æ¥æ„å»ºå¼€å‘ç¯å¢ƒï¼Œæé«˜å¼€å‘ä½“éªŒã€‚</p><p>åœ¨ä½¿ç”¨ Docker ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹å‡ ä¸ªæ¦‚å¿µã€‚</p><ul><li>é•œåƒï¼š é•œåƒåªæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå…¶å®é™…ä½“ç°å¹¶éç”±ä¸€ä¸ªæ–‡ä»¶ç»„æˆï¼Œè€Œæ˜¯ç”±ä¸€ç»„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œæˆ–è€…è¯´ï¼Œç”±å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚</li></ul><blockquote>é•œåƒæ„å»ºæ—¶ï¼Œä¼šä¸€å±‚å±‚æ„å»ºï¼Œå‰ä¸€å±‚æ˜¯åä¸€å±‚çš„åŸºç¡€ã€‚æ¯ä¸€å±‚æ„å»ºå®Œå°±ä¸ä¼šå†å‘ç”Ÿæ”¹å˜ï¼Œåä¸€å±‚ä¸Šçš„ä»»ä½•æ”¹å˜åªå‘ç”Ÿåœ¨è‡ªå·±è¿™ä¸€å±‚ã€‚æ¯”å¦‚ï¼Œåˆ é™¤å‰ä¸€å±‚æ–‡ä»¶çš„æ“ä½œï¼Œå®é™…ä¸æ˜¯çœŸçš„åˆ é™¤å‰ä¸€å±‚çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä»…åœ¨å½“å‰å±‚æ ‡è®°ä¸ºè¯¥æ–‡ä»¶å·²åˆ é™¤ã€‚åœ¨æœ€ç»ˆå®¹å™¨è¿è¡Œçš„æ—¶å€™ï¼Œè™½ç„¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥æ–‡ä»¶ä¼šä¸€ç›´è·Ÿéšé•œåƒã€‚å› æ­¤ï¼Œåœ¨æ„å»ºé•œåƒçš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–å°å¿ƒï¼Œæ¯ä¸€å±‚å°½é‡åªåŒ…å«è¯¥å±‚éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•é¢å¤–çš„ä¸œè¥¿åº”è¯¥åœ¨è¯¥å±‚æ„å»ºç»“æŸå‰æ¸…ç†æ‰ã€‚</blockquote><p>æ‰€ä»¥ï¼Œåœ¨ç”Ÿäº§éƒ¨ç½²æ—¶ï¼Œç¡®ä¿æ¯ä¸€å±‚çš„çº¯å‡€ï¼Œå‰”é™¤ä¸å¿…è¦æ–‡ä»¶ã€‚æ¯”å¦‚å¼€å‘ç¼–è¯‘æ—¶çš„æ–‡ä»¶ç­‰ï¼ˆ node_module ï¼‰ã€‚è¿™æ ·ä¹Ÿé¿å…äº†é•œåƒä¸å¿…è¦çš„è‡ƒè‚¿ã€‚</p><ul><li>å®¹å™¨ï¼šå®¹å™¨çš„å®è´¨æ˜¯è¿›ç¨‹ï¼Œä½†ä¸ç›´æ¥åœ¨å®¿ä¸»æ‰§è¡Œçš„è¿›ç¨‹ä¸åŒï¼Œå®¹å™¨è¿›ç¨‹è¿è¡Œäºå±äºè‡ªå·±çš„ç‹¬ç«‹çš„ å‘½åç©ºé—´ã€‚</li></ul><blockquote>å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒé‡Œï¼Œä½¿ç”¨èµ·æ¥ï¼Œå°±å¥½åƒæ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹äºå®¿ä¸»çš„ç³»ç»Ÿä¸‹æ“ä½œä¸€æ ·ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—å®¹å™¨å°è£…çš„åº”ç”¨æ¯”ç›´æ¥åœ¨å®¿ä¸»è¿è¡Œæ›´åŠ å®‰å…¨ã€‚<br/>æ¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ä»¥é•œåƒä¸ºåŸºç¡€å±‚ï¼Œåœ¨å…¶ä¸Šåˆ›å»ºä¸€ä¸ªå½“å‰å®¹å™¨çš„å­˜å‚¨å±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªä¸ºå®¹å™¨è¿è¡Œæ—¶è¯»å†™è€Œå‡†å¤‡çš„å­˜å‚¨å±‚ä¸ºå®¹å™¨å­˜å‚¨å±‚ã€‚<br/>å®¹å™¨å­˜å‚¨å±‚çš„ç”Ÿå­˜å‘¨æœŸå’Œå®¹å™¨ä¸€æ ·ï¼Œå®¹å™¨æ¶ˆäº¡æ—¶ï¼Œå®¹å™¨å­˜å‚¨å±‚ä¹Ÿéšä¹‹æ¶ˆäº¡ã€‚å› æ­¤ï¼Œä»»ä½•ä¿å­˜äºå®¹å™¨å­˜å‚¨å±‚çš„ä¿¡æ¯éƒ½ä¼šéšå®¹å™¨åˆ é™¤è€Œä¸¢å¤±ã€‚<br/>æŒ‰ç…§ Docker æœ€ä½³å®è·µçš„è¦æ±‚ï¼Œå®¹å™¨ä¸åº”è¯¥å‘å…¶å­˜å‚¨å±‚å†…å†™å…¥ä»»ä½•æ•°æ®ï¼Œå®¹å™¨å­˜å‚¨å±‚è¦ä¿æŒæ— çŠ¶æ€åŒ–ã€‚æ‰€æœ‰çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨ æ•°æ®å·ï¼ˆVolumeï¼‰ã€æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œåœ¨è¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»ï¼ˆæˆ–ç½‘ç»œå­˜å‚¨ï¼‰å‘ç”Ÿè¯»å†™ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚</blockquote><p>å¼€å‘ç¯å¢ƒç»å¸¸å¯¹æ–‡ä»¶ä¿®æ”¹ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™é‡Œçš„æ•°æ®å·ç»‘å®šå®¿ä¸»ç›®å½•ã€‚</p><ul><li>ä¸Šä¸‹æ–‡ï¼šä¼ ç»™ Docker å¼•æ“çš„æ–‡ä»¶ç›®å½•ã€‚</li></ul><p>Docker åœ¨è¿è¡Œæ—¶åˆ†ä¸º Docker å¼•æ“ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œå®¢æˆ·ç«¯å·¥å…·ã€‚åœ¨æ„å»ºé•œåƒæ—¶ï¼Œä¼šå°†ä¸Šä¸‹æ–‡å¤åˆ¶åˆ° Docker å¼•æ“ã€‚ç„¶åé€šè¿‡ Docker å®¢æˆ·ç«¯å‘å‡ºæŒ‡ä»¤ï¼Œè€ŒæŒ‡ä»¤çš„æ‰§è¡Œæ˜¯åœ¨ Docker å¼•æ“ä¸­ã€‚æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡çš„èŒƒå›´è¦åˆç†ï¼ŒèŒƒå›´è¿‡å¤§ï¼Œå°±ä¼šå¯¼è‡´æ–‡ä»¶å¤åˆ¶åˆ° Docker å¼•æ“çš„æ—¶é—´é•¿ï¼›èŒƒå›´è¿‡å°ï¼Œåˆ™ä¼šå¯¼è‡´æ— æ³•æ“ä½œèŒƒå›´å¤–çš„æ–‡ä»¶ã€‚</p><h2>Docker éƒ¨ç½²å¼€å‘ç¯å¢ƒ</h2><p>éƒ¨ç½²å¼€å‘ç¯å¢ƒå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦é…ç½® Dockerfile å’Œ docker-compose å³å¯ã€‚ç›¸å…³æ–‡æ¡£å¯è§ï¼šã€<a href=\"https://link.zhihu.com/?target=https%3A//www.hacking8.com/docker-practice/image/dockerfile/README.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Dockerfile æŒ‡ä»¤è¯¦è§£</a>ã€‘å’Œã€<a href=\"https://link.zhihu.com/?target=https%3A//www.hacking8.com/docker-practice/compose/compose_file.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Compose æ¨¡æ¿æ–‡ä»¶</a>ã€‘</p><p>docker-compose ä½¿ç”¨çš„æ˜¯ YAML è¯­è¨€ï¼Œã€<a href=\"https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2016/07/yaml.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">YAML è¯­è¨€æ•™ç¨‹</a>ã€‘</p><div class=\"highlight\"><pre><code class=\"language-yaml\">version<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s1\">&#39;3.6&#39;</span><span class=\"w\">\n</span><span class=\"w\">\n</span><span class=\"w\"></span>services<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">  </span>client<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">    </span>container_name<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&#34;client&#34;</span><span class=\"w\">\n</span><span class=\"w\">    </span>build<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>context<span class=\"p\">:</span><span class=\"w\"> </span>../<span class=\"w\">\n</span><span class=\"w\">      </span>dockerfile<span class=\"p\">:</span><span class=\"w\"> </span>Dockerfile.client.dev<span class=\"w\">\n</span><span class=\"w\">    </span>volumes<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span>../src<span class=\"p\">:</span>/app/client/src<span class=\"w\">\n</span><span class=\"w\">    </span>ports<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span><span class=\"s2\">&#34;8090:8090&#34;</span><span class=\"w\">\n</span><span class=\"w\">    </span>depends_on<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span>server<span class=\"w\">\n</span><span class=\"w\">\n</span><span class=\"w\">  </span>server<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">    </span>container_name<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&#34;server&#34;</span><span class=\"w\">\n</span><span class=\"w\">    </span>build<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>context<span class=\"p\">:</span><span class=\"w\"> </span>../server<span class=\"w\">\n</span><span class=\"w\">      </span>dockerfile<span class=\"p\">:</span><span class=\"w\"> </span>Dockerfile.server.dev<span class=\"w\">\n</span><span class=\"w\">    </span>volumes<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span>../server<span class=\"p\">:</span>/app/server<span class=\"w\">\n</span><span class=\"w\">    </span>ports<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span><span class=\"s2\">&#34;8080:8080&#34;</span><span class=\"w\">\n</span><span class=\"w\">    </span>depends_on<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span>database<span class=\"w\">\n</span><span class=\"w\">\n</span><span class=\"w\">\n</span><span class=\"w\">  </span>database<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">    </span>container_name<span class=\"p\">:</span><span class=\"w\"> </span>mongo<span class=\"w\">\n</span><span class=\"w\">    </span>image<span class=\"p\">:</span><span class=\"w\"> </span>mongo<span class=\"w\">\n</span><span class=\"w\">    </span>volumes<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span>../data<span class=\"p\">:</span>/data/db<span class=\"w\">\n</span><span class=\"w\">    </span>ports<span class=\"p\">:</span><span class=\"w\">\n</span><span class=\"w\">      </span>-<span class=\"w\"> </span><span class=\"s2\">&#34;27017:27017&#34;</span></code></pre></div><p>å¼€å‘ç¯å¢ƒéœ€è¦çš„å°±æ˜¯å®æ—¶å±•ç°æ•ˆæœï¼Œå‰ç«¯é¡µé¢æ˜¯è¿™æ ·ï¼Œåç«¯æœåŠ¡äº¦æ˜¯å¦‚æ­¤ã€‚ å¦‚ä¸Šæ–‡æåˆ°ï¼Œä¸Šä¸‹æ–‡å·²ç»æäº¤åˆ°é•œåƒï¼Œå‰ç«¯é¡¹ç›®å¦‚ä½•æ‰èƒ½å¤Ÿåœ¨å®¹å™¨ä¸­å®ç°çƒ­æ›¿æ¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ volumes è¿™ä¸ªé…ç½®ã€‚åŒç†ï¼Œåç«¯ä¹Ÿæ˜¯ï¼Œä¸è¿‡è¿˜éœ€è¦ modemon å·¥å…·ååŠ©ã€‚</p><p>åœ¨éƒ¨ç½²æ—¶ï¼Œä¹Ÿè¦åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯åœ¨é•œåƒä¸­ï¼Œlocalhost æ— æ³•ä½¿ç”¨ï¼Œéœ€è¦ç”¨ IP ä»£æ›¿ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å‰ç«¯é¡¹ç›®\n</span><span class=\"c1\"></span><span class=\"cm\">/* webpack.dev.js */</span>\n  <span class=\"nx\">devServer</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"nx\">publicPath</span><span class=\"o\">:</span> <span class=\"s1\">&#39;/&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">contentBase</span><span class=\"o\">:</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;dist&#39;</span><span class=\"p\">),</span>\n    <span class=\"nx\">port</span><span class=\"o\">:</span> <span class=\"nx\">APP_CONFIG</span><span class=\"p\">.</span><span class=\"nx\">port</span><span class=\"p\">,</span>\n    <span class=\"nx\">host</span><span class=\"o\">:</span> <span class=\"s1\">&#39;0.0.0.0&#39;</span><span class=\"p\">,</span> <span class=\"c1\">// éœ€æŒ‡æ˜\n</span><span class=\"c1\"></span>    <span class=\"nx\">hot</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"nx\">historyApiFallback</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n      <span class=\"nx\">index</span><span class=\"o\">:</span> <span class=\"s1\">&#39;/&#39;</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n\n<span class=\"c1\">// åç«¯é¡¹ç›®\n</span><span class=\"c1\"></span><span class=\"cm\">/* config.js */</span>\n<span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"s1\">&#39;database&#39;</span><span class=\"o\">:</span> <span class=\"s1\">&#39;mongodb://database:27017/yexiaochen&#39;</span>  <span class=\"c1\">// ä¸ docker-compose ä¸­ database æœåŠ¡ååŒ¹é…\n</span><span class=\"c1\"></span><span class=\"p\">}</span>\n</code></pre></div><p></p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "Docker", 
                    "tagLink": "https://api.zhihu.com/topics/19950993"
                }, 
                {
                    "tag": "å…¨æ ˆå¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/20043281"
                }
            ], 
            "comments": [
                {
                    "userName": "ç®€ç®€å•å•", 
                    "userLink": "https://www.zhihu.com/people/a9e8b01ad028f67c05b7a3b718f5d06c", 
                    "content": "<p>åªé™äºlinuxç³»ç»Ÿå§ï¼Œwindowç³»ç»Ÿä¸å…¼å®¹</p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "ä¸æ’é™¤è¿™ä¸ªå¯èƒ½ï¼Œæˆ‘æ˜¯åœ¨macä¸Šå¼€å‘çš„[æ‚è„¸]", 
                            "likes": 0, 
                            "replyToAuthor": "ç®€ç®€å•å•"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/71605785", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 2, 
            "title": "react+redux+react-router-domè„šæ‰‹æ¶æ­å»º(nodeæœåŠ¡ã€å¯é€‰ã€‘)", 
            "content": "<h2>å‰è¨€</h2><p>ä¹‹å‰çš„ <code>multi-spa-webpack-cli</code> åªæ˜¯ä¸º React + antd æ¨¡æ¿æä¾›äº†å¼€å‘æ—¶å¿…è¦çš„ç¯å¢ƒï¼Œå¯¹äºå®é™…çš„å¼€å‘å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ã€‚ ä¸ºäº†æ›´è´´è¿‘å®é™…å¼€å‘ï¼Œæœ¬æ¬¡ React + antd æ¨¡æ¿å®Œå–„äº†ä¸€äº›åŠŸèƒ½ã€‚</p><ol><li>å°è£… <b>fetch</b>ï¼Œæ–°å¢è¯·æ±‚é”™è¯¯æç¤ºï¼›</li><li>é›†æˆ <b>react-router-dom</b> è·¯ç”±ç®¡ç†ï¼›</li><li>é›†æˆ <b>react-redux</b> çŠ¶æ€ç®¡ç†ï¼›</li><li>å¿…ä¸å¯å°‘çš„ <b>antd</b> é›†æˆï¼›</li><li><b>node</b> æœåŠ¡é›†æˆï¼ˆå¯é€‰ï¼‰ã€‚</li></ol><p>node æœåŠ¡å’Œ React+antd æ¨¡æ¿æ˜¯æ²¡æœ‰å¤šå¤§çš„å…³ç³»çš„ã€‚æœ¬æ–‡åªæ˜¯æƒ³é€šè¿‡ä¸€ä¸ªç®€å•çš„ç™»é™†é€»è¾‘æ¥æ¼”ç¤ºä»¥ä¸Šçš„åŠŸèƒ½ï¼Œæ‰€ä»¥ node æœåŠ¡ä¸æ˜¯å¿…é¡»çš„ã€‚</p><p><code>multi-spa-webpack-cli</code> å·²ç»å‘å¸ƒåˆ° npmï¼Œåªè¦åœ¨ node ç¯å¢ƒä¸‹å®‰è£…å³å¯ã€‚</p><div class=\"highlight\"><pre><code class=\"language-ps1con\">npm install multi-spa-webpack-cli -g</code></pre></div><p>ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:</p><div class=\"highlight\"><pre><code class=\"language-ps1con\"># 1. åˆå§‹åŒ–é¡¹ç›®\nmulti-spa-webpack-cli init spa-project</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-22b061a53e599f888d2eb980c38f3412_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"910\" data-rawheight=\"276\" class=\"origin_image zh-lightbox-thumb\" width=\"910\" data-original=\"https://pic3.zhimg.com/v2-22b061a53e599f888d2eb980c38f3412_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;910&#39; height=&#39;276&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"910\" data-rawheight=\"276\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"910\" data-original=\"https://pic3.zhimg.com/v2-22b061a53e599f888d2eb980c38f3412_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-22b061a53e599f888d2eb980c38f3412_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-ps1con\"># 2. è¿›å…¥æ–‡ä»¶ç›®å½•\ncd spa-project\n\n# 3. å®‰è£…ä¾èµ–\nnpm install\n\n# 4. æ‰“åŒ…ä¸å˜çš„éƒ¨åˆ†\nnpm run build:dll\n\n# 5. å¯åŠ¨é¡¹ç›®ï¼ˆæ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨ï¼šlocalhost:8090ï¼‰\nnpm start\n\n# 6. å¯åŠ¨æœåŠ¡(å¯é€‰)\ncd server\nnpm install\nnpm start</code></pre></div><p>é¢„è§ˆï¼š</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-f2a9240f2b6ae94c6856fc4bf134335a_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"968\" data-rawheight=\"1104\" data-thumbnail=\"https://pic3.zhimg.com/v2-f2a9240f2b6ae94c6856fc4bf134335a_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"968\" data-original=\"https://pic3.zhimg.com/v2-f2a9240f2b6ae94c6856fc4bf134335a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;968&#39; height=&#39;1104&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"968\" data-rawheight=\"1104\" data-thumbnail=\"https://pic3.zhimg.com/v2-f2a9240f2b6ae94c6856fc4bf134335a_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"968\" data-original=\"https://pic3.zhimg.com/v2-f2a9240f2b6ae94c6856fc4bf134335a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-f2a9240f2b6ae94c6856fc4bf134335a_b.gif\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>å°è£… fetch</h2><p>ç°åœ¨å¤„ç†å¼‚æ­¥çš„æ–¹å¼ï¼Œå¤§å¤šæ•°åŸºäº Promise çš„ã€‚è€Œ fetch æ˜¯å¤©ç„¶æ”¯æŒ Promise çš„ï¼Œæ‰€ä»¥æ— éœ€å†æ‰‹åŠ¨å°è£…ã€‚åœ¨ PWA æŠ€æœ¯ä¸­ï¼Œå·²ä½œä¸ºä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†åœ¨ä½¿ç”¨ã€‚</p><p>fetch ä¸ºäººè¯Ÿç—…çš„ç¼ºç‚¹ä¹‹ä¸€ï¼Œå°±æ˜¯ä¸èƒ½ Abort è¯·æ±‚ã€‚æœ‰æ–¹æ¡ˆæå‡ºæå‡ºï¼Œé€šè¿‡ Promise.race çš„æ–¹æ³•æ¥æ¨¡æ‹Ÿ timeoutã€‚å®é™…ä¸Šè¯¥æ‰§è¡Œçš„å·²ç„¶æ‰§è¡Œï¼Œåªæ˜¯è¡¨è±¡ä¸Šè¾¾åˆ°äº†é¢„æœŸçš„æ•ˆæœã€‚ä¸è¿‡æµè§ˆå™¨ç°ä»¥å®éªŒæ€§å¼€å§‹æ”¯æŒ AbortController ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">notification</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;antd&#39;</span><span class=\"p\">;</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">env</span> <span class=\"o\">=</span> <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">NODE_ENV</span><span class=\"p\">;</span>\n<span class=\"k\">const</span> <span class=\"nx\">baseURL</span> <span class=\"o\">=</span> <span class=\"nx\">APP_CONFIG</span><span class=\"p\">[</span><span class=\"nx\">env</span><span class=\"p\">].</span><span class=\"nx\">ip</span><span class=\"p\">;</span>\n<span class=\"c1\">// timeout ;\n</span><span class=\"c1\">// const controller = new AbortController();\n</span><span class=\"c1\">// const signal = controller.signal;\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">defaultConfig</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"nx\">credentials</span><span class=\"o\">:</span> <span class=\"s1\">&#39;include&#39;</span><span class=\"p\">,</span>\n  <span class=\"nx\">headers</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"nx\">Accept</span><span class=\"o\">:</span> <span class=\"s1\">&#39;application/json&#39;</span>\n  <span class=\"p\">},</span>\n  <span class=\"c1\">// signal\n</span><span class=\"c1\"></span><span class=\"p\">};</span>\n<span class=\"k\">const</span> <span class=\"nx\">codeMessage</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"mi\">301</span><span class=\"o\">:</span> <span class=\"s1\">&#39;æ°¸ä¹…ç§»åŠ¨&#39;</span><span class=\"p\">,</span>\n  <span class=\"mi\">302</span><span class=\"o\">:</span> <span class=\"s1\">&#39;ä¸´æ—¶ç§»åŠ¨&#39;</span><span class=\"p\">,</span>\n<span class=\"c1\">// ...\n</span><span class=\"c1\"></span>  <span class=\"mi\">504</span><span class=\"o\">:</span> <span class=\"s1\">&#39;ç½‘å…³è¶…æ—¶ã€‚&#39;</span>\n<span class=\"p\">};</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">checkStatus</span> <span class=\"o\">=</span> <span class=\"nx\">response</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">status</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">200</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">status</span> <span class=\"o\">&lt;</span> <span class=\"mi\">300</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">response</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">const</span> <span class=\"nx\">errortext</span> <span class=\"o\">=</span> <span class=\"nx\">codeMessage</span><span class=\"p\">[</span><span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">status</span><span class=\"p\">]</span> <span class=\"o\">||</span> <span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">statusText</span><span class=\"p\">;</span>\n  <span class=\"nx\">notification</span><span class=\"p\">.</span><span class=\"nx\">error</span><span class=\"p\">({</span>\n    <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"sb\">`è¯·æ±‚é”™è¯¯ </span><span class=\"si\">${</span><span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">status</span><span class=\"si\">}</span><span class=\"sb\">: </span><span class=\"si\">${</span><span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">url</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">,</span>\n    <span class=\"nx\">description</span><span class=\"o\">:</span> <span class=\"nx\">errortext</span>\n  <span class=\"p\">});</span>\n<span class=\"p\">};</span>\n\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"kr\">async</span> <span class=\"kd\">function</span> <span class=\"nx\">Fetch</span><span class=\"p\">(</span><span class=\"nx\">url</span><span class=\"p\">,</span> <span class=\"nx\">config</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">newUrl</span> <span class=\"o\">=</span> <span class=\"nx\">baseURL</span> <span class=\"o\">+</span> <span class=\"nx\">url</span><span class=\"p\">;</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">newConfig</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"p\">...</span><span class=\"nx\">defaultConfig</span><span class=\"p\">,</span>\n    <span class=\"p\">...</span><span class=\"nx\">config</span>\n  <span class=\"p\">};</span>\n  <span class=\"c1\">// const timeoutId = setTimeout(() =&gt; controller.abort(), 5000);\n</span><span class=\"c1\"></span>  <span class=\"k\">if</span> <span class=\"p\">(</span>\n    <span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">method</span><span class=\"p\">.</span><span class=\"nx\">toLocaleLowerCase</span><span class=\"p\">()</span> <span class=\"o\">===</span> <span class=\"s1\">&#39;post&#39;</span> <span class=\"o\">||</span>\n    <span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">method</span><span class=\"p\">.</span><span class=\"nx\">toLocaleLowerCase</span><span class=\"p\">()</span> <span class=\"o\">===</span> <span class=\"s1\">&#39;put&#39;</span> <span class=\"o\">||</span>\n    <span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">method</span><span class=\"p\">.</span><span class=\"nx\">toLocaleLowerCase</span><span class=\"p\">()</span> <span class=\"o\">===</span> <span class=\"s1\">&#39;delete&#39;</span>\n  <span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">body</span> <span class=\"k\">instanceof</span> <span class=\"nx\">FormData</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n      <span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">headers</span><span class=\"p\">[</span><span class=\"s1\">&#39;Content-Type&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;application/json; charset=utf-8&#39;</span><span class=\"p\">;</span>\n      <span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">body</span> <span class=\"o\">=</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">(</span><span class=\"nx\">newConfig</span><span class=\"p\">.</span><span class=\"nx\">body</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">try</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">newUrl</span><span class=\"p\">,</span> <span class=\"nx\">newConfig</span><span class=\"p\">);</span>\n    <span class=\"c1\">// clearTimeout(timeoutId);\n</span><span class=\"c1\"></span>    <span class=\"k\">return</span> <span class=\"nx\">checkStatus</span><span class=\"p\">(</span><span class=\"nx\">response</span><span class=\"p\">).</span><span class=\"nx\">json</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">notification</span><span class=\"p\">.</span><span class=\"nx\">error</span><span class=\"p\">({</span>\n      <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"sb\">`è¯·æ±‚é”™è¯¯ : </span><span class=\"si\">${</span><span class=\"nx\">newUrl</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">,</span>\n      <span class=\"nx\">description</span><span class=\"o\">:</span> <span class=\"nx\">error</span><span class=\"p\">.</span><span class=\"nx\">message</span>\n    <span class=\"p\">});</span>\n    <span class=\"k\">throw</span> <span class=\"nx\">error</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>é›†æˆ <b>react-router-dom</b> è·¯ç”±ç®¡ç†</h2><p>è‡ª raect-router v4 ä¹‹åï¼Œä¾¿ä¸å†æ”¯æŒé›†ä¸­å¼ç®¡ç†è·¯ç”±ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨å»å®ç°ã€‚React + antd æ¨¡æ¿é‡‡ç”¨çš„æ˜¯å®˜ç½‘æ¨èçš„æ–¹å¼ï¼Œlayouts ç›®å½•ä¸‹çš„æ–‡ä»¶ç”¨æ¥ç®¡ç†è·¯ç”±ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-03f909053b5074751b372b692051d079_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2746\" data-rawheight=\"1618\" class=\"origin_image zh-lightbox-thumb\" width=\"2746\" data-original=\"https://pic2.zhimg.com/v2-03f909053b5074751b372b692051d079_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;2746&#39; height=&#39;1618&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2746\" data-rawheight=\"1618\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"2746\" data-original=\"https://pic2.zhimg.com/v2-03f909053b5074751b372b692051d079_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-03f909053b5074751b372b692051d079_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2>é›†æˆ <b>react-redux</b> çŠ¶æ€ç®¡ç†</h2><p>Redux ä½œä¸ºçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œé™¤äº† Reactï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å…¶ä»–åœ°æ–¹ï¼ˆæ„æ€æ˜¯è¯´ï¼Œå’Œ React æ²¡åŠæ¯›é’±å…³ç³»ï¼‰ã€‚åœ¨Reactä¸­ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© React-redux å·¥å…·ï¼Œè¿™æ ·ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚</p><blockquote>ä¸¥æ ¼çš„å•å‘æ•°æ®æµæ˜¯ Redux æ¶æ„çš„è®¾è®¡æ ¸å¿ƒã€‚</blockquote><p>redux æ•°æ®æµå‘ï¼š</p><p>å°±æ˜¯æŠŠ actionï¼ˆè¡Œä¸ºï¼‰ dispatchï¼ˆä¸¢ç»™ï¼‰reducerï¼ˆæ›´æ–° stateï¼‰ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-9dc9c5bb470aab1a8482356cc824de1f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3840\" data-rawheight=\"2400\" class=\"origin_image zh-lightbox-thumb\" width=\"3840\" data-original=\"https://pic4.zhimg.com/v2-9dc9c5bb470aab1a8482356cc824de1f_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;3840&#39; height=&#39;2400&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3840\" data-rawheight=\"2400\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"3840\" data-original=\"https://pic4.zhimg.com/v2-9dc9c5bb470aab1a8482356cc824de1f_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-9dc9c5bb470aab1a8482356cc824de1f_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h2><b>node</b> æœåŠ¡é›†æˆï¼ˆå¯é€‰ï¼‰</h2><p>node æœåŠ¡ç™»é™†é‡‡ç”¨çš„æ˜¯ session æ¥è®°å½•çŠ¶æ€ã€‚</p><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-d4009fb7c9004bb241e428db19e1bced_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3840\" data-rawheight=\"2400\" class=\"origin_image zh-lightbox-thumb\" width=\"3840\" data-original=\"https://pic2.zhimg.com/v2-d4009fb7c9004bb241e428db19e1bced_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;3840&#39; height=&#39;2400&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3840\" data-rawheight=\"2400\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"3840\" data-original=\"https://pic2.zhimg.com/v2-d4009fb7c9004bb241e428db19e1bced_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-d4009fb7c9004bb241e428db19e1bced_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><p>å°±è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶å®£å‘Šå®Œæˆã€‚</p><p>ä¸è¿‡ï¼Œè¿™æ‰åªæ˜¯ä¸ªå¼€å§‹ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "React", 
                    "tagLink": "https://api.zhihu.com/topics/20013159"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/70068048", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 17, 
            "title": "webpackå¼€å‘ç¯å¢ƒé…ç½®", 
            "content": "<h2>æ—¥å¸¸åæ§½</h2><p>ç»è¿‡ä¸æ–­çš„è°ƒæ•´å’Œæµ‹è¯•ï¼Œå…³äº react çš„ webpack é…ç½®ç»ˆäºæ–°é²œå‡ºç‚‰ã€‚æœ¬æ¬¡çš„é‡ç‚¹ä¸»è¦é›†ä¸­åœ¨å¼€å‘ç¯å¢ƒä¸Šï¼Œç”Ÿäº§ç¯å¢ƒåˆ™æ˜¯ä½¿ç”¨ webpack çš„ production é»˜è®¤æ¨¡å¼ã€‚</p><p>æœ¬æ¬¡é…ç½®ä¸»è¦æœ‰ï¼š</p><ol><li><b>eslint+prettier</b>;</li><li><b>optimization.splitChunks</b>;</li><li><b>happypack</b>;</li><li><b>DllReferencePlugin &amp; DllPlugin</b>;</li><li>...</li></ol><h2>æ–‡æ¡£çš„é‡è¦æ€§</h2><p>è®²çœŸï¼Œå¯¹äºåˆæ¬¡æ¥è§¦ webpack çš„åŒå­¦ï¼Œæ€•çš„å¯èƒ½ä¸æ˜¯ webpack çš„é…ç½®ï¼Œè€Œæ˜¯é•¿é•¿çš„ package.jsonã€‚ä¾èµ–é‚£ä¹ˆå¤šï¼Œä½ æ€ä¹ˆå°±çŸ¥é“éœ€è¦å“ªäº›ä¾èµ–å‘¢ã€‚ä¸å¼€ç©ç¬‘ï¼Œæˆ‘è¿˜çœŸçŸ¥é“ã€‚ webpack çš„ä¾èµ–ä¸»è¦æ˜¯ä¸€äº› loader å’Œ pluginsã€‚æˆ‘ä»¬çŸ¥é“å•é¡µé¢å¼•ç”¨è¢«æ‰“åŒ…åï¼ŒåŸæœ‰çš„ç»“æ„åŸºæœ¬ä¸Šä¸å¤å­˜åœ¨äº†ã€‚è€Œä¹‹å‰å¼•ç”¨çš„å›¾ç‰‡æˆ–å­—ä½“èµ„æºè¿˜æŒ‰ç…§ä¹‹å‰çš„è·¯å¾„æŸ¥æ‰¾ï¼Œè‚¯å®šæ˜¯æ‰¾ä¸åˆ°çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è½¬æ¢å·¥å…·ï¼ˆé¡ºä¾¿è½¬æ¢èµ„æºï¼‰â€”â€” <code>url-loader</code>|<code>file-loader</code>ã€‚ å¤§å¤šæ•°äººå†™æ ·å¼æ—¶ï¼Œå–œæ¬¢ä½¿ç”¨ cssã€lessã€sassã€‚è¿™æ—¶ä¹Ÿä¼šæœ‰å¯¹åº”çš„å·¥å…· <code>style-loader</code>, <code>css-loader</code>, <code>less-loader</code>ã€‚ æƒ³è¦ä½¿ç”¨ JavaScript æ–°ç‰¹æ€§æˆ–å¤„ç†å…¼å®¹æ€§ï¼Œå°±ç”¨ <code>babel-loader</code>ã€‚ä»¥ä¸Šè¿™äº›åŸºæœ¬ä¸Šå¯ä»¥åº”ä»˜ä¸€äº›ç®€å•çš„é¡¹ç›®ã€‚å¯å®é™…ä¸Šå‘¢ï¼Ÿ</p><blockquote>æˆ‘ä¿¡ä½ ä¸ªé¬¼ï¼Œä½ è¿™ä¸ªç³Ÿè€å¤´åçš„å¾ˆï¼</blockquote><p>çœ‹æ–‡æ¡£å•Šï¼Œçœ‹å®˜æ–¹ä»‹ç»å•Šã€‚æœ¬æ¬¡ä¹Ÿæ˜¯é€šè¿‡çœ‹ babel æ–‡æ¡£ï¼Œå’Œä¸€äº›ä¾èµ–æ–‡æ¡£æ¥é…ç½® webpack çš„ï¼Œå…¨ç¨‹æ— å‹åŠ›ï¼Œè€Œä¸”å¾ˆæ­£å®—ã€‚æ‰€ä»¥ï¼Œæ–‡æ¡£å¾ˆé‡è¦ã€‚</p><h2>eslint+prettier</h2><p>å¦‚æœæ—¶å›¢é˜Ÿåˆä½œï¼Œä»£ç è§„èŒƒæ˜¯å¾ˆé‡è¦çš„ã€‚å¯ä»¥é€šè¿‡ eslint+prettier è§„èŒƒã€‚è¿™ä¸¤ä¸ªå·¥å…·å„æœ‰ä¾§é‡ç‚¹ï¼Œä¸è¿‡å®˜ç½‘ä¹Ÿæä¾›äº†ä¸¤è€…ç»“åˆçš„æ–¹æ¡ˆã€‚è¯¦ç»†ä»‹ç»è§å®˜ç½‘ã€‚æˆ‘ä¸ªäººä¸ä¹ æƒ¯åˆ›å»ºå¤ªå¤šçš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥éƒ½æ”¾åœ¨äº† package.json æ–‡ä»¶ä¸­ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">//  webpack.common.js\n</span><span class=\"c1\"></span><span class=\"p\">{</span>\n    <span class=\"nx\">enforce</span><span class=\"o\">:</span> <span class=\"s2\">&#34;pre&#34;</span><span class=\"p\">,</span>\n    <span class=\"nx\">test</span><span class=\"o\">:</span> <span class=\"sr\">/\\.m?jsx?$/</span><span class=\"p\">,</span>\n    <span class=\"nx\">exclude</span><span class=\"o\">:</span> <span class=\"sr\">/node_modules/</span><span class=\"p\">,</span>\n    <span class=\"nx\">loader</span><span class=\"o\">:</span> <span class=\"s2\">&#34;eslint-loader&#34;</span><span class=\"p\">,</span>\n    <span class=\"nx\">options</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"nx\">fix</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n        <span class=\"nx\">cache</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n        <span class=\"nx\">formatter</span><span class=\"o\">:</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s2\">&#34;eslint-friendly-formatter&#34;</span><span class=\"p\">),</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">},</span>\n<span class=\"s2\">&#34;eslintConfig&#34;</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&#34;parser&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;babel-eslint&#34;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&#34;env&#34;</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">&#34;browser&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;es6&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;node&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n    <span class=\"p\">},</span>\n    <span class=\"s2\">&#34;parserOptions&#34;</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">&#34;ecmaVersion&#34;</span><span class=\"o\">:</span> <span class=\"mi\">6</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;sourceType&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;module&#34;</span>\n    <span class=\"p\">},</span>\n    <span class=\"s2\">&#34;extends&#34;</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&#34;plugin:prettier/recommended&#34;</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">},</span>\n<span class=\"s2\">&#34;prettier&#34;</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&#34;singleQuote&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"s2\">&#34;semi&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n<span class=\"p\">},</span>\n</code></pre></div><h2>å¼€å‘ç¯å¢ƒ</h2><p>å¼€å‘ç¯å¢ƒæ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œç®€å•æ˜“é…ç½®ï¼Œå®˜ç½‘å¾ˆè¯¦ç»†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.dev.js\n</span><span class=\"c1\"></span>\n<span class=\"nx\">plugins</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"c1\">//...\n</span><span class=\"c1\"></span>    <span class=\"k\">new</span> <span class=\"nx\">webpack</span><span class=\"p\">.</span><span class=\"nx\">HotModuleReplacementPlugin</span><span class=\"p\">()</span>\n<span class=\"p\">},</span>\n<span class=\"nx\">devtool</span><span class=\"o\">:</span> <span class=\"s2\">&#34;eval-source-map&#34;</span><span class=\"p\">,</span>\n<span class=\"nx\">devServer</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n<span class=\"nx\">contentBase</span><span class=\"o\">:</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;dist&#39;</span><span class=\"p\">),</span>\n<span class=\"nx\">port</span><span class=\"o\">:</span> <span class=\"nx\">APP_CONFIG</span><span class=\"p\">.</span><span class=\"nx\">port</span><span class=\"p\">,</span>\n<span class=\"nx\">hot</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n<span class=\"nx\">open</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// index.js\n</span><span class=\"c1\">// å…¥å£å¤„è¦é…ç½®è¿™äº›ï¼Œåˆ«å¿˜äº†ã€‚\n</span><span class=\"c1\">// å› ä¸ºæœ‰å†’æ³¡çš„æœºåˆ¶ï¼Œæ‰€ä»¥åœ¨é¡¶ç«¯åŠ ä¸€ä¸ªå°±å¥½ã€‚\n</span><span class=\"c1\"></span><span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">hot</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">hot</span><span class=\"p\">.</span><span class=\"nx\">accept</span><span class=\"p\">(</span><span class=\"s1\">&#39;./views/login/index.js&#39;</span><span class=\"p\">,</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">render</span><span class=\"p\">(</span><span class=\"nx\">App</span><span class=\"p\">)</span> <span class=\"c1\">// æ¸²æŸ“åº”ç”¨\n</span><span class=\"c1\"></span>  <span class=\"p\">})</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>optimization.splitChunks</h2><p>è¿™ä¸ªé…ç½®æ˜¯ç”¨æ¥åˆ†å‰²åŒ…çš„ã€‚åœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šï¼Œè¯·æ±‚æ•°å’Œè¯·æ±‚åŒ…çš„å¤§å°ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¼˜åŒ–ç‚¹ã€‚è¯·æ±‚æ•°é‡å’Œè¯·æ±‚æ•°æ®å¤§å°è¦æ§åˆ¶åœ¨åˆç†çš„èŒƒå›´å†…ã€‚ ä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°†åŒ…åˆ†å‰²ä¸ºå†…å®¹ä¸å˜çš„éƒ¨åˆ†å’Œå†…å®¹å˜åŒ–çš„éƒ¨åˆ†ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸ºäº†å°†å¤§çš„åŒ…åˆ†å‰²æˆæ›´å°çš„åŒ…ï¼Œä¹Ÿæ˜¯ä¸ºäº†èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç¼“å­˜æœºåˆ¶ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.common.js\n</span><span class=\"c1\"></span><span class=\"nx\">runtimeChunk</span><span class=\"o\">:</span> <span class=\"s1\">&#39;single&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">splitChunks</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"nx\">cacheGroups</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"nx\">verdor</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n            <span class=\"nx\">test</span><span class=\"o\">:</span> <span class=\"sr\">/[\\\\/]node_modules[\\\\/]/</span><span class=\"p\">,</span>\n            <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;verdors&#39;</span><span class=\"p\">,</span>\n            <span class=\"nx\">chunks</span><span class=\"o\">:</span> <span class=\"s1\">&#39;all&#39;</span><span class=\"p\">,</span>\n            <span class=\"nx\">priority</span><span class=\"o\">:</span> <span class=\"o\">-</span><span class=\"mi\">10</span><span class=\"p\">,</span>\n        <span class=\"p\">},</span>\n        <span class=\"nx\">common</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n            <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;common&#39;</span><span class=\"p\">,</span>\n            <span class=\"nx\">chunks</span><span class=\"o\">:</span> <span class=\"s1\">&#39;all&#39;</span><span class=\"p\">,</span>\n            <span class=\"nx\">minChunks</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span>\n            <span class=\"nx\">priority</span><span class=\"o\">:</span> <span class=\"o\">-</span><span class=\"mi\">20</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>happypack</h2><p>è½¬æ¢æ–‡ä»¶ç®—æ˜¯æ‰“åŒ…è¿‡ç¨‹ä¸­æ¯”è¾ƒè€—æ—¶çš„äº‹æƒ…ï¼Œé€šè¿‡ happypack å¯ä»¥å°†è¿™ä»¶äº‹åˆ†æ‘Šç»™å¤šä¸ª node è¿›ç¨‹ï¼Œè¿™æ ·å°±ä¼šå¤§å¤§ç¼©çŸ­äº†æ‰“åŒ…æ—¶é—´ï¼ˆåŒç†ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>thread-loader</code>ï¼‰ã€‚ä¸è¿‡è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ˜¯è¦å¼€é”€çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–æ–¹å‘ï¼Œè¦ä¸è¦é‡‡ç”¨ï¼Œè¿˜éœ€è¦é…Œæƒ…è€ƒè™‘ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// loader\n</span><span class=\"c1\"></span><span class=\"p\">{</span>\n    <span class=\"nx\">test</span><span class=\"o\">:</span> <span class=\"sr\">/\\.m?jsx?$/</span><span class=\"p\">,</span>\n    <span class=\"nx\">exclude</span><span class=\"o\">:</span> <span class=\"sr\">/node_modules/</span><span class=\"p\">,</span>\n    <span class=\"nx\">use</span><span class=\"o\">:</span> <span class=\"s1\">&#39;happypack/loader?id=js&#39;</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// plugins\n</span><span class=\"c1\"></span><span class=\"k\">new</span> <span class=\"nx\">HappyPack</span><span class=\"p\">({</span>\n    <span class=\"nx\">id</span><span class=\"o\">:</span> <span class=\"s1\">&#39;js&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">threadPool</span><span class=\"o\">:</span> <span class=\"nx\">happyThreadPool</span><span class=\"p\">,</span>\n    <span class=\"nx\">loaders</span><span class=\"o\">:</span> <span class=\"p\">[{</span>\n    <span class=\"nx\">loader</span><span class=\"o\">:</span> <span class=\"s1\">&#39;babel-loader&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">options</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"nx\">cacheDirectory</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n        <span class=\"nx\">presets</span><span class=\"o\">:</span> <span class=\"p\">[[</span><span class=\"s1\">&#39;@babel/preset-env&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n        <span class=\"s2\">&#34;useBuiltIns&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;usage&#34;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;corejs&#34;</span><span class=\"o\">:</span> <span class=\"mi\">3</span>\n        <span class=\"p\">}],</span> <span class=\"s2\">&#34;@babel/preset-react&#34;</span><span class=\"p\">],</span>\n        <span class=\"nx\">plugins</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"s1\">&#39;@babel/transform-runtime&#39;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;@babel/plugin-proposal-class-properties&#34;</span><span class=\"p\">,</span> <span class=\"p\">[</span>\n            <span class=\"s2\">&#34;import&#34;</span><span class=\"p\">,</span>\n            <span class=\"p\">{</span>\n            <span class=\"s2\">&#34;libraryName&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;antd&#34;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&#34;style&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n        <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n    <span class=\"p\">}]</span>\n<span class=\"p\">})</span>\n</code></pre></div><p>ä¸å–œæ¬¢å•ç‹¬çš„ babel æ–‡ä»¶ï¼Œæ‰€ä»¥ babel çš„é…ç½®éƒ½åœ¨è¿™é‡Œäº†ã€‚å…¶å®ï¼Œå…³äº babel è¦é…ç½®çš„å†…å®¹è¿˜æ˜¯æŒºå¤šçš„ã€‚ä¸è¿‡ä¸è¦æ€•ï¼Œbabel çš„å®˜æ–¹æ–‡æ¡£æœ‰è¯¦ç»†è¯´æ˜ã€‚</p><h2>DllReferencePlugin &amp; DllPlugin</h2><p>ä¹‹å‰ä¹Ÿæåˆ°è¿‡ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ <code>optimization.splitChunks</code> æ¥å¤„ç†ç¬¬ä¸‰æ–¹åº“ï¼Œå°†å…¶åˆ†å‰²æˆä¸å˜çš„éƒ¨åˆ†ã€‚å¯æ˜¯ï¼Œæ¯æ¬¡æ‰“åŒ…çš„æ—¶å€™éƒ½éœ€è¦é‡å¤è¿™ä¸€æ­¥éª¤ã€‚ è¿™æ—¶å€™æˆ‘ä»¬å°±æƒ³å•Šï¼Œä¸å˜çš„éƒ¨åˆ†æ‰“åŒ…ä¸€æ¬¡ä¸å°±å¯ä»¥äº†ä¹ˆï¼Œä¹‹åå°±åªæ‰“åŒ…é‚£äº›ç»å¸¸å˜åŒ–çš„éƒ¨åˆ†ï¼Œè¿™æ ·ä¸å°±èƒ½æé«˜æ•ˆç‡äº†ä¹ˆï¼Ÿæ˜¯çš„ï¼Œ <code>DllReferencePlugin &amp; DllPlugin</code> åŸºæœ¬ä¸Šè¦åšçš„å°±æ˜¯è¿™ä¹ˆä¸€å›äº‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼šé’ˆå¯¹è¿™ä¸¤éƒ¨åˆ†åšä¸åŒçš„é…ç½®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.dll.js\n</span><span class=\"c1\"></span><span class=\"k\">new</span> <span class=\"nx\">webpack</span><span class=\"p\">.</span><span class=\"nx\">DllPlugin</span><span class=\"p\">({</span>\n    <span class=\"nx\">context</span><span class=\"o\">:</span> <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">cwd</span><span class=\"p\">(),</span>\n    <span class=\"nx\">path</span><span class=\"o\">:</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">join</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;dist&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;dll&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;[name]-manifest.json&#39;</span><span class=\"p\">),</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;[name]_[hash]&#39;</span>\n<span class=\"p\">})</span>\n<span class=\"c1\">// webpack.common.js\n</span><span class=\"c1\"></span><span class=\"k\">new</span> <span class=\"nx\">webpack</span><span class=\"p\">.</span><span class=\"nx\">DllReferencePlugin</span><span class=\"p\">({</span>\n    <span class=\"nx\">context</span><span class=\"o\">:</span> <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">cwd</span><span class=\"p\">(),</span> \n    <span class=\"nx\">manifest</span><span class=\"o\">:</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;dist&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;dll&#39;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;vendor-manifest.json&#34;</span><span class=\"p\">))</span>\n<span class=\"p\">}),</span>\n</code></pre></div><h2>multi-spa-webpack-cliä½¿ç”¨è¯´æ˜</h2><p><code>multi-spa-webpack-cli</code> å·²ç»å‘å¸ƒåˆ° npmï¼Œåªè¦åœ¨ node ç¯å¢ƒä¸‹å®‰è£…å³å¯ã€‚<b>ä¸€è·¯æŒ‰ Enterï¼Œå…¨éƒ¨æºç éƒ½åœ¨é‡Œé¢ï¼ï¼ï¼</b></p><div class=\"highlight\"><pre><code class=\"language-bash\">npm install multi-spa-webpack-cli -g</code></pre></div><p>ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:</p><div class=\"highlight\"><pre><code class=\"language-bash\"><span class=\"c1\"># 1. åˆå§‹åŒ–é¡¹ç›®</span>\nmulti-spa-webpack-cli init spa-project\n\n<span class=\"c1\"># 2. è¿›å…¥æ–‡ä»¶ç›®å½•</span>\n<span class=\"nb\">cd</span> spa-project\n\n<span class=\"c1\"># 3. å®‰è£…ä¾èµ–</span>\nnpm install\n\n<span class=\"c1\"># 4. æ‰“åŒ…ä¸å˜çš„éƒ¨åˆ†</span>\nnpm run build:dll\n\n<span class=\"c1\"># 5. å¯åŠ¨é¡¹ç›®ï¼ˆæ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨ï¼šlocalhost:8090ï¼‰</span>\nnpm start</code></pre></div><p></p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "webpack", 
                    "tagLink": "https://api.zhihu.com/topics/20032877"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/69289711", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 26, 
            "title": "æ‰‹å†™webpackè„šæ‰‹æ¶å‘½ä»¤è¡Œå·¥å…·", 
            "content": "<h2>æ—¥å¸¸åæ§½</h2><p>æœ¬æ¥æƒ³æ­å»ºä¸€ä¸ªwebpackè„šæ‰‹æ¶çš„ï¼Œäºæ˜¯åœ¨æ­å»ºçš„è¿‡ç¨‹ä¸­ä¸æ–­åœ°æœé›†ç›¸å…³èµ„æ–™ã€‚å¯æœ€ç»ˆçš„ç»“æœæ˜¯ï¼Œwebpackè„šæ‰‹æ¶æ²¡æœ‰æ­å»ºæˆï¼Œå´å†™å‡ºä¸ª CLI å°å·¥å…·ã€‚å…¶å®ï¼Œè¿™ä¹Ÿå¹¶ä¸æ˜¯æ²¡æœ‰åŸå› çš„ã€‚ç°åœ¨æµè¡Œçš„æ¡†æ¶éƒ½æ¨å‡ºäº†è‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·ï¼Œæ¯”å¦‚ï¼ŒVue CLIï¼ŒCreate React App ç­‰ã€‚è„šæ‰‹æ¶å’ŒCLIå¾€å¾€å¦‚å½±éšå½¢ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†ä¸¤è€…åœ¨æ¦‚å¿µä¸Šçš„æ··æ·†ã€‚æ ‡é¢˜ä¸ºä»€ä¹ˆè¿™ä¹ˆæ‹—å£ï¼Œå…¶å®æ˜¯ä¸ºäº†åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚</p><h2>æˆ‘æœ‰ä¸€ä¸ªæƒ³æ³•</h2><p>æ—¢ç„¶è¢«å¸¦è·‘åäº†ï¼Œå°±åªèƒ½åœ¨è·‘åçš„è·¯ä¸Šè¶Šè·‘è¶Šè¿œå§ã€‚</p><blockquote>å‘½ä»¤è¡Œç•Œé¢ï¼ˆè‹±è¯­ï¼šCommand-Line Interfaceï¼Œç¼©å†™ï¼šCLIï¼‰æ˜¯åœ¨å›¾å½¢ç”¨æˆ·ç•Œé¢å¾—åˆ°æ™®åŠä¹‹å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ç”¨æˆ·ç•Œé¢ï¼Œå®ƒé€šå¸¸ä¸æ”¯æŒé¼ æ ‡ï¼Œç”¨æˆ·é€šè¿‡é”®ç›˜è¾“å…¥æŒ‡ä»¤ï¼Œè®¡ç®—æœºæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œäºˆä»¥æ‰§è¡Œã€‚ä¹Ÿæœ‰äººç§°ä¹‹ä¸ºå­—ç¬¦ç”¨æˆ·ç•Œé¢ï¼ˆcharacter user interface, CUIï¼‰ â€”â€”â€”â€” ç»´åŸºç™¾ç§‘</blockquote><p>ä½¿ç”¨è¿‡ Vue CLI çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç»ˆç«¯æ•²å‡ ä¸ªçš„å‘½ä»¤å°±å¯ä»¥æ­å»ºä¸€ä¸ª Vue çš„è„šæ‰‹æ¶ã€‚å¦‚æœä¸ä½¿ç”¨ CLI çš„è¯ï¼Œæ¯æ¬¡åˆ›å»ºé¡¹ç›®æ—¶ï¼Œéƒ½éœ€è¦é…ç½®æ–‡ä»¶ï¼ˆæ¯”å¦‚webpacké…ç½®æ–‡ä»¶ï¼‰ã€è®¾è®¡ç»“æ„ã€æŠ€æœ¯æ ˆé€‰å‹ç­‰ã€‚å¦‚æœæ¯æ¬¡ä»é›¶å¼€å§‹å»æ­å»ºé¡¹ç›®å°±ä¼šå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠç›¸åŒçš„ä¸œè¥¿æŠ½ç¦»æˆè„šæ‰‹æ¶ã€‚ä»¥ååˆ›å»ºé¡¹ç›®æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠè„šæ‰‹æ¶å¤åˆ¶è¿‡æ¥ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€æ­å»ºé¡¹ç›®ã€‚</p><p>å›è¿‡å¤´æ¥å†çœ‹çœ‹æˆ‘ä»¬æ‰‹åŠ¨æ­å»ºé¡¹ç›®çš„è¿‡ç¨‹ï¼Œä»æ¯æ¬¡ä»é›¶å¼€å§‹æ­å»ºé¡¹ç›®åˆ°è„šæ‰‹æ¶çš„å¤ç”¨ï¼Œè¿™ä¸­é—´æœ‰äº†å¾ˆå¤§çš„è¿›æ­¥ã€‚å¯å³ä½¿æ˜¯å¤åˆ¶é»è´´ï¼Œæˆ‘ä»¬ä¾ç„¶è§‰å¾—å¾ˆéº»çƒ¦ï¼Œå¦‚æœç”¨å‘½ä»¤è¡Œçš„æ–¹å¼æ¥å–ä»£å›¾å½¢æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ‡’ä¸€äº›äº†ã€‚</p><p>å›åˆ°ä¸»é¢˜ï¼Œæˆ‘æœ¬æ¥æ‰“ç®—å†™çš„webpackè„šæ‰‹æ¶æ˜¯åŸºäºè¿™æ ·çš„ä¸€ä¸ªæƒ³æ³•ã€‚â¡ï¸ ç°åœ¨å¤§éƒ¨åˆ†çš„å‰ç«¯å·¥ç¨‹ï¼Œwebpackä½œä¸ºæ‰“åŒ…å·¥å…·å·²ç»æˆäº†æ ‡é…äº†ã€‚è€Œ webpack çš„é…ç½®æ˜¯å¤§åŒå°å¼‚çš„ï¼Œå®Œå…¨å¯ä»¥å‰¥ç¦»å‡ºä¸€ä¸ªé€šç”¨çš„webpacké…ç½®ï¼Œç„¶åé’ˆå¯¹ä¸ªåˆ«é…ç½®è¿›è¡Œä¿®æ”¹ã€‚æœ¬æ¬¡å¸Œæœ›æœ€ç»ˆå®ç°ä¸€ä¸ªåŸºäºwebpacké€‚ç”¨äºä¸åŒå‰ç«¯æ¨¡æ¿ï¼ˆReactã€Vueã€ES+ï¼‰çš„è„šæ‰‹æ¶ã€‚</p><p>ç°åœ¨è„šæ‰‹æ¶æœ‰äº†ï¼Œå¦‚ä½•<b>è‡ªåŠ¨åŒ–</b>å»æ­å»ºä¸€ä¸ªé¡¹ç›®å‘¢ï¼Ÿ</p><ol><li>å¤åˆ¶æˆ–ä¸‹è½½è„šæ‰‹æ¶æ¨¡æ¿ã€‚ï¼ˆä¸ºäº†æ›´çµæ´»ï¼Œä¸Šä¼ åˆ°GitHubï¼Œæˆ–å‘å¸ƒnpmä¸­ï¼‰ã€‚</li><li>æ ¹æ®ä¸åŒéœ€æ±‚ï¼Œåœ¨è„šæ‰‹æ¶æ¨¡æ¿åŸºç¡€ä¸Šé‡æ–°é…ç½®webpackã€packageæ–‡ä»¶ã€‚</li><li>å®‰è£…ä¾èµ–ã€‚</li></ol><p>ä»¥ä¸‹ä»£ç å¯è§<a href=\"https://link.zhihu.com/?target=https%3A//github.com/yexiaochen/multi-spa-webpack-cli\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">GitHub</a>ã€‚</p><h2>CLI ä¸­çš„é¢„å¤‡å·¥ä½œ</h2><p>é¦–å…ˆäº†è§£ä¸€ä¸‹ <code>#!</code>ã€‚æ–‡ä»¶å¼€å¤´è¦åŠ ä¸Š<code>#! /usr/bin/env node</code>ã€‚</p><blockquote>åœ¨è®¡ç®—é¢†åŸŸä¸­ï¼ŒShebangï¼ˆä¹Ÿç§°ä¸º Hashbang ï¼‰æ˜¯ä¸€ä¸ªç”±äº•å·å’Œå¹å·æ„æˆçš„å­—ç¬¦åºåˆ— #! ï¼Œå…¶å‡ºç°åœ¨æ–‡æœ¬æ–‡ä»¶çš„ç¬¬ä¸€è¡Œçš„å‰ä¸¤ä¸ªå­—ç¬¦ã€‚ åœ¨æ–‡ä»¶ä¸­å­˜åœ¨ Shebang çš„æƒ…å†µä¸‹ï¼Œç±» Unix æ“ä½œç³»ç»Ÿçš„ç¨‹åºåŠ è½½å™¨ä¼šåˆ†æ Shebang åçš„å†…å®¹ï¼Œå°†è¿™äº›å†…å®¹ä½œä¸ºè§£é‡Šå™¨æŒ‡ä»¤ï¼Œå¹¶è°ƒç”¨è¯¥æŒ‡ä»¤ï¼Œå¹¶å°†è½½æœ‰ Shebang çš„æ–‡ä»¶è·¯å¾„ä½œä¸ºè¯¥è§£é‡Šå™¨çš„å‚æ•°ã€‚ â€”â€”â€”â€” ç»´åŸºç™¾ç§‘<br/>ä½¿ç”¨ #!/usr/bin/env è„šæœ¬è§£é‡Šå™¨åç§° æ˜¯ä¸€ç§å¸¸è§çš„åœ¨ä¸åŒå¹³å°ä¸Šéƒ½èƒ½æ­£ç¡®æ‰¾åˆ°è§£é‡Šå™¨çš„åŠæ³•ã€‚ â€”â€”â€”â€” ç»´åŸºç™¾ç§‘</blockquote><p>ç„¶åçœ‹çœ‹éƒ½ç”¨åˆ°äº†å“ªäº›ä¸œè¥¿ï¼ˆéƒ¨åˆ†ï¼‰ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">npm</span> <span class=\"nx\">install</span> <span class=\"nx\">commander</span> <span class=\"nx\">chalk</span> <span class=\"nx\">fs</span><span class=\"o\">-</span><span class=\"nx\">extra</span> <span class=\"nx\">shelljs</span> <span class=\"nx\">inquirer</span> <span class=\"nx\">ora</span> <span class=\"nx\">ejs</span> <span class=\"o\">--</span><span class=\"nx\">save</span>\n</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-text\">#! /usr/bin/env node\n\n// multi-spa.js\nconst program = require(&#39;commander&#39;);  // è§£æå‘½ä»¤;\nconst chalk = require(&#39;chalk&#39;);  // å‘½ä»¤è¡Œç•Œé¢è¾“å‡ºç¾é¢œ\nconst fs = require(&#39;fs-extra&#39;);  // fsçš„æ‹“å±•;\nconst shell = require(&#39;shelljs&#39;);  // é‡æ–°åŒ…è£…äº† child_processï¼›\nconst inquirer = require(&#39;inquirer&#39;);  // äº¤äº’å¼é—®ç­”ï¼›\nconst ora = require(&#39;ora&#39;);  // è¾“å‡ºæ ·å¼ç¾åŒ–ï¼›\nconst ejs = require(&#39;ejs&#39;);  // æ¨¡ç‰ˆå¼•æ“ï¼›\nconst path = require(&#39;path&#39;);\nconst currentPath = process.cwd();\nlet answersConfig = null;</code></pre></div><h2>å‘½ä»¤çš„è§£æ</h2><p>ç±»ä¼¼ä¸ Vue çš„ <code>vue init</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›è‡ªå·±çš„ CLI ä¹Ÿèƒ½æ‹¥æœ‰ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// package.json\n</span><span class=\"c1\"></span>  <span class=\"s2\">&#34;bin&#34;</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&#34;multi-spa-webpack&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;./bin/multi-spa.js&#34;</span>\n  <span class=\"p\">},</span>\n</code></pre></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†<code>multi-spa-webpack</code>çš„å‘½ä»¤ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å…¨å±€ä½¿ç”¨ï¼Œè¿˜éœ€è¦æ‰§è¡Œä¸‹é¢å‘½ä»¤ã€‚</p><div class=\"highlight\"><pre><code class=\"language-ps1con\">npm link</code></pre></div><p>æ¥ä¸‹æ¥å°±è¦åˆå§‹åŒ–<code>multi-spa-webpack</code>ç›¸å…³çš„å‘½ä»¤äº†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// multi-spa.js\n</span><span class=\"c1\"></span><span class=\"nx\">program</span>\n  <span class=\"p\">.</span><span class=\"nx\">command</span><span class=\"p\">(</span><span class=\"s1\">&#39;init &lt;é¡¹ç›®è·¯å¾„&gt; [é€‰é¡¹]&#39;</span><span class=\"p\">)</span>\n  <span class=\"p\">.</span><span class=\"nx\">description</span><span class=\"p\">(</span><span class=\"s1\">&#39;æŒ‡ä»¤è¯´æ˜ï¼šåˆå§‹åŒ–é¡¹ç›®&#39;</span><span class=\"p\">)</span>\n  <span class=\"p\">.</span><span class=\"nx\">action</span><span class=\"p\">(</span><span class=\"kr\">async</span> <span class=\"p\">(</span><span class=\"nx\">appName</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">try</span> <span class=\"p\">{</span>\n      <span class=\"nx\">answersConfig</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">getAnswers</span><span class=\"p\">(</span><span class=\"nx\">appName</span><span class=\"p\">);</span>\n      <span class=\"kd\">let</span> <span class=\"nx\">targetDir</span> <span class=\"o\">=</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">currentPath</span><span class=\"p\">,</span> <span class=\"nx\">appName</span> <span class=\"o\">||</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">);</span>\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">pathExistsSync</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">program</span><span class=\"p\">.</span><span class=\"nx\">force</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n          <span class=\"nx\">GenarateProject</span><span class=\"p\">(</span><span class=\"nx\">appName</span><span class=\"p\">);</span>  <span class=\"c1\">// åˆ›å»ºé¡¹ç›®ï¼›\n</span><span class=\"c1\"></span>        <span class=\"p\">}</span>\n        <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`ï¼å½“å‰ç›®å½•ä¸‹ï¼Œ</span><span class=\"si\">${</span><span class=\"nx\">appName</span><span class=\"si\">}</span><span class=\"sb\">å·²å­˜åœ¨ï¼Œè¯·ä¿®æ”¹åç§°åé‡è¯•`</span><span class=\"p\">)).</span><span class=\"nx\">fail</span><span class=\"p\">();</span>\n        <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n      <span class=\"p\">};</span>\n      <span class=\"nx\">GenarateProject</span><span class=\"p\">(</span><span class=\"nx\">appName</span><span class=\"p\">);</span>  <span class=\"c1\">// åˆ›å»ºé¡¹ç›®ï¼›\n</span><span class=\"c1\"></span>    <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`é¡¹ç›®åˆ›å»ºå¤±è´¥ï¼š</span><span class=\"si\">${</span><span class=\"nx\">error</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">)).</span><span class=\"nx\">fail</span><span class=\"p\">();</span>\n      <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">});</span>\n<span class=\"nx\">program</span>\n  <span class=\"p\">.</span><span class=\"nx\">arguments</span><span class=\"p\">(</span><span class=\"s1\">&#39;&lt;command&gt;&#39;</span><span class=\"p\">)</span>\n  <span class=\"p\">.</span><span class=\"nx\">action</span><span class=\"p\">((</span><span class=\"nx\">cmd</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`ï¼å‘½ä»¤æœªèƒ½è§£æ &lt;</span><span class=\"si\">${</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">green</span><span class=\"p\">(</span><span class=\"nx\">cmd</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"sb\">&gt;`</span><span class=\"p\">));</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">();</span>\n    <span class=\"nx\">program</span><span class=\"p\">.</span><span class=\"nx\">outputHelp</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">();</span>\n  <span class=\"p\">});</span>\n<span class=\"nx\">program</span><span class=\"p\">.</span><span class=\"nx\">parse</span><span class=\"p\">(</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">argv</span><span class=\"p\">);</span>\n<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">program</span><span class=\"p\">.</span><span class=\"nx\">args</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">===</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">();</span>\n  <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"s1\">&#39;ï¼è¾“å…¥çš„å‘½ä»¤æœ‰è¯¯&#39;</span><span class=\"p\">));</span>\n  <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">();</span>\n  <span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"nx\">program</span><span class=\"p\">.</span><span class=\"nx\">help</span><span class=\"p\">());</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>å¤åˆ¶æˆ–ä¸‹è½½æ¨¡æ¿</h2><p>åœ¨æ‰§è¡Œ<code>multi-spa-webpack init spa-project</code>åï¼Œå°±éœ€è¦æ‹·è´ä¸€ä»½è„šæ‰‹æ¶åˆ°æœ¬åœ°äº†ã€‚è‡³äºè„šæ‰‹æ¶ä»å“ªé‡Œæ¥ï¼Œå¯ä»¥æ”¾åœ¨ github ä¸Šï¼ˆç±»ä¼¼ Vue CLIï¼‰æˆ– æ”¾åœ¨ CLI å¯¹åº”çš„ç›®å½•ä¸‹ï¼ˆç±»ä¼¼create-react-appï¼‰ã€‚</p><p>æœ¬æ–‡æ˜¯é‡‡ç”¨çš„æ˜¯ä» github è·å–è„šæ‰‹æ¶æ¨¡æ¿çš„ã€‚ä½†æ˜¯å¸¸è§„çš„æ–¹å¼ï¼Œåªèƒ½ä¸‹è½½æ•´ä¸ªé¡¹ç›®ï¼Œè€Œå¯¹äºä¸éœ€è¦çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶ï¼Œä¹Ÿä¼šåŒæ—¶ä¸‹è½½ï¼Œä¸‹è½½åï¼Œåªèƒ½åœ¨æœ¬åœ°ä¸­åˆ é™¤æ— å…³æ–‡ä»¶äº†ã€‚æˆ‘è¿™é‡Œæ˜¯ä»æºå¤´ä¸Šå‰”é™¤æ— å…³æ–‡ä»¶çš„ä¸‹è½½ï¼Œè¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šæœ‰ä¸€äº›å±€é™æ€§å§ï¼ˆsparse-checkoutï¼‰ã€‚ä¸è¿‡ä¸¤è€…æœ€ç»ˆçš„ç›®çš„æ˜¯ä¸€æ ·çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// multi-spa.js\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">DownTemplate</span><span class=\"p\">(</span><span class=\"nx\">projectDir</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">const</span> <span class=\"nx\">remote</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;https://github.com/yexiaochen/multi-spa-webpack-cli.git&#39;</span><span class=\"p\">;</span>\n  <span class=\"k\">const</span> <span class=\"p\">{</span> <span class=\"nx\">template</span> <span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"nx\">answersConfig</span><span class=\"p\">;</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">downTemplateSpinner</span> <span class=\"o\">=</span> <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"s1\">&#39;æ¨¡æ¿ä¸‹è½½ä¸­...&#39;</span><span class=\"p\">)).</span><span class=\"nx\">start</span><span class=\"p\">();</span>\n  <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nb\">Promise</span><span class=\"p\">((</span><span class=\"nx\">resolve</span><span class=\"p\">,</span> <span class=\"nx\">reject</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">shell</span><span class=\"p\">.</span><span class=\"nx\">exec</span><span class=\"p\">(</span><span class=\"sb\">`\n</span><span class=\"sb\">      mkdir </span><span class=\"si\">${</span><span class=\"nx\">projectDir</span><span class=\"si\">}</span><span class=\"sb\">\n</span><span class=\"sb\">      cd </span><span class=\"si\">${</span><span class=\"nx\">projectDir</span><span class=\"si\">}</span><span class=\"sb\">\n</span><span class=\"sb\">      git init\n</span><span class=\"sb\">      git remote add -f origin </span><span class=\"si\">${</span><span class=\"nx\">remote</span><span class=\"si\">}</span><span class=\"sb\">\n</span><span class=\"sb\">      git config core.sparsecheckout true\n</span><span class=\"sb\">      echo &#34;template/common&#34; &gt;&gt; .git/info/sparse-checkout\n</span><span class=\"sb\">      echo &#34;template/config&#34; &gt;&gt; .git/info/sparse-checkout\n</span><span class=\"sb\">      echo &#34;template/services&#34; &gt;&gt; .git/info/sparse-checkout\n</span><span class=\"sb\">      echo &#34;template/</span><span class=\"si\">${</span><span class=\"nx\">template</span><span class=\"si\">}</span><span class=\"sb\">&#34; &gt;&gt; .git/info/sparse-checkout\n</span><span class=\"sb\">      echo &#34;.gitignore&#34; &gt;&gt; .git/info/sparse-checkout\n</span><span class=\"sb\">      echo &#34;package.json&#34; &gt;&gt; .git/info/sparse-checkout\n</span><span class=\"sb\">      git pull origin master\n</span><span class=\"sb\">      rm -rf .git\n</span><span class=\"sb\">      mv template/* ./\n</span><span class=\"sb\">      rm -rf template\n</span><span class=\"sb\">      `</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n          <span class=\"nx\">downTemplateSpinner</span><span class=\"p\">.</span><span class=\"nx\">stop</span><span class=\"p\">()</span>\n          <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`æ¨¡æ¿ä¸‹è½½å¤±è´¥ï¼š</span><span class=\"si\">${</span><span class=\"nx\">error</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">)).</span><span class=\"nx\">fail</span><span class=\"p\">()</span>\n          <span class=\"nx\">reject</span><span class=\"p\">()</span>\n        <span class=\"p\">}</span>\n        <span class=\"nx\">downTemplateSpinner</span><span class=\"p\">.</span><span class=\"nx\">stop</span><span class=\"p\">();</span>\n        <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"s1\">&#39;æ¨¡æ¿ä¸‹è½½æˆåŠŸ&#39;</span><span class=\"p\">)).</span><span class=\"nx\">succeed</span><span class=\"p\">();</span>\n        <span class=\"nx\">resolve</span><span class=\"p\">();</span>\n      <span class=\"p\">})</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶</h2><p>åƒ webpackã€package ç­‰é…ç½®æ–‡ä»¶ï¼Œä¹Ÿéƒ½æ˜¯åŒ…å«åœ¨è„šæ‰‹æ¶é‡Œçš„ï¼Œä¸è¿‡è¿™äº›é…ç½®è¿˜ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨ã€‚æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡äº¤äº’å¼é—®ç­”ï¼Œæ¥é’ˆå¯¹æ€§å¾—åœ¨ç°æœ‰çš„åŸºç¡€ä¸Šé‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// multi-spa.js\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">getAnswers</span><span class=\"p\">(</span><span class=\"nx\">appName</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">const</span> <span class=\"nx\">options</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"s1\">&#39;input&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"s1\">&#39;é¡¹ç›®åç§°&#39;</span><span class=\"p\">,</span>\n      <span class=\"k\">default</span><span class=\"o\">:</span> <span class=\"nx\">appName</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"s1\">&#39;input&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;description&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"s1\">&#39;é¡¹ç›®æè¿°&#39;</span><span class=\"p\">,</span>\n      <span class=\"k\">default</span><span class=\"o\">:</span> <span class=\"s1\">&#39;å•é¡µé¢åº”ç”¨&#39;</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"s1\">&#39;confirm&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;eslint&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"s1\">&#39;æ˜¯å¦å¯ç”¨ eslint+pretty&#39;</span><span class=\"p\">,</span>\n      <span class=\"k\">default</span><span class=\"o\">:</span> <span class=\"kc\">true</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;cssPreprocessor&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"s1\">&#39;list&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"s1\">&#39;CSS é¢„å¤„ç†å™¨&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">choices</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&#34;less&#34;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;sass&#34;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;none&#34;</span><span class=\"p\">,</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;template&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">type</span><span class=\"o\">:</span> <span class=\"s1\">&#39;list&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"s1\">&#39;é€‰å–æ¨¡æ¿&#39;</span><span class=\"p\">,</span>\n      <span class=\"nx\">choices</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&#34;react&#34;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;vue&#34;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;es&#34;</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">},</span>\n  <span class=\"p\">];</span>\n  <span class=\"k\">return</span> <span class=\"nx\">inquirer</span><span class=\"p\">.</span><span class=\"nx\">prompt</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>åœ¨è·å¾—ç‰¹å®šçš„éœ€æ±‚åï¼Œè¿˜è¦æŠŠè¿™äº›æ•°æ®æ³¨å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚å°±æ˜¯é€šè¿‡æ¨¡æ¿å¼•æ“æŠŠæ•°æ®å¡åˆ°æ¨¡æ¿é‡Œã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ ejs æ¨¡ç‰ˆå¼•æ“ã€‚</p><div class=\"highlight\"><pre><code class=\"language-html\"><span class=\"c\">&lt;!--webpack.common.ejs--&gt;</span>\n<span class=\"err\">&lt;</span>%= answers.cssPreprocessor == &#39;none&#39;\n    ? /\\.css$/ : (answers.cssPreprocessor == &#39;less&#39; ? /\\.less$/ : /\\.scss$/) %&gt;\n\n<span class=\"err\">&lt;</span>%= answers.cssPreprocessor == &#39;none&#39;\n    ? &#39;&#39; : (answers.cssPreprocessor == &#39;less&#39; ? &#39;less-loader&#39; : &#39;sass-loader&#39;) %&gt;</code></pre></div><p class=\"ztext-empty-paragraph\"><br/></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// multi-spa.js\n</span><span class=\"c1\"></span><span class=\"kr\">async</span> <span class=\"kd\">function</span> <span class=\"nx\">GenarateWebpackConfig</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">try</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"nx\">webpackConfigPath</span> <span class=\"o\">=</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">currentPath</span><span class=\"si\">}</span><span class=\"sb\">/</span><span class=\"si\">${</span><span class=\"nx\">targetDir</span><span class=\"si\">}</span><span class=\"sb\">/config`</span><span class=\"p\">,</span> <span class=\"s1\">&#39;webpack.common.ejs&#39;</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">webpackConfigTargetPath</span> <span class=\"o\">=</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">currentPath</span><span class=\"si\">}</span><span class=\"sb\">/</span><span class=\"si\">${</span><span class=\"nx\">targetDir</span><span class=\"si\">}</span><span class=\"sb\">/config`</span><span class=\"p\">,</span> <span class=\"s1\">&#39;webpack.common.js&#39;</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">webpackConfigSpinner</span> <span class=\"o\">=</span> <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"sb\">`é…ç½® webpack æ–‡ä»¶...`</span><span class=\"p\">)).</span><span class=\"nx\">start</span><span class=\"p\">();</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">webpackConfig</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">readFile</span><span class=\"p\">(</span><span class=\"nx\">webpackConfigPath</span><span class=\"p\">,</span> <span class=\"s1\">&#39;utf8&#39;</span><span class=\"p\">);</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">generatedWebpackConfig</span> <span class=\"o\">=</span> <span class=\"nx\">ejs</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">(</span><span class=\"nx\">webpackConfig</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"nx\">answers</span><span class=\"o\">:</span> <span class=\"nx\">answersConfig</span> <span class=\"p\">});</span>\n    <span class=\"kr\">await</span> <span class=\"nb\">Promise</span><span class=\"p\">.</span><span class=\"nx\">all</span><span class=\"p\">([</span>\n      <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">writeFile</span><span class=\"p\">(</span><span class=\"nx\">webpackConfigTargetPath</span><span class=\"p\">,</span> <span class=\"nx\">generatedWebpackConfig</span><span class=\"p\">),</span>\n      <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">remove</span><span class=\"p\">(</span><span class=\"nx\">webpackConfigPath</span><span class=\"p\">)</span>\n    <span class=\"p\">])</span>\n    <span class=\"nx\">webpackConfigSpinner</span><span class=\"p\">.</span><span class=\"nx\">stop</span><span class=\"p\">();</span>\n    <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"sb\">`é…ç½® webpack å®Œæˆ`</span><span class=\"p\">)).</span><span class=\"nx\">succeed</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`é…ç½®æ–‡ä»¶å¤±è´¥ï¼š</span><span class=\"si\">${</span><span class=\"nx\">error</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">)).</span><span class=\"nx\">fail</span><span class=\"p\">();</span>\n    <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kr\">async</span> <span class=\"kd\">function</span> <span class=\"nx\">GenaratePackageJson</span><span class=\"p\">(</span><span class=\"nx\">projectDir</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">try</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"p\">{</span> <span class=\"nx\">name</span><span class=\"p\">,</span> <span class=\"nx\">description</span><span class=\"p\">,</span> <span class=\"nx\">cssPreprocessor</span> <span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"nx\">answersConfig</span><span class=\"p\">;</span>\n    <span class=\"k\">const</span> <span class=\"nx\">packageJsonPath</span> <span class=\"o\">=</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">currentPath</span><span class=\"si\">}</span><span class=\"sb\">/</span><span class=\"si\">${</span><span class=\"nx\">projectDir</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">,</span> <span class=\"s1\">&#39;package.json&#39;</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">packageJsonSpinner</span> <span class=\"o\">=</span> <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"s1\">&#39;é…ç½® package.json æ–‡ä»¶...&#39;</span><span class=\"p\">)).</span><span class=\"nx\">start</span><span class=\"p\">();</span>\n    <span class=\"kd\">let</span> <span class=\"kr\">package</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">readJson</span><span class=\"p\">(</span><span class=\"nx\">packageJsonPath</span><span class=\"p\">);</span>\n    <span class=\"kr\">package</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span><span class=\"p\">;</span>\n    <span class=\"kr\">package</span><span class=\"p\">.</span><span class=\"nx\">description</span> <span class=\"o\">=</span> <span class=\"nx\">description</span><span class=\"p\">;</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">cssPreprocessor</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;less&#39;</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"kr\">package</span><span class=\"p\">.</span><span class=\"nx\">devDependencies</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"p\">...</span><span class=\"kr\">package</span><span class=\"p\">.</span><span class=\"nx\">devDependencies</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;less-loader&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;^5.0.0&#34;</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">cssPreprocessor</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;sass&#39;</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"kr\">package</span><span class=\"p\">.</span><span class=\"nx\">devDependencies</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"p\">...</span><span class=\"kr\">package</span><span class=\"p\">.</span><span class=\"nx\">devDependencies</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;node-sass&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;^4.12.0&#34;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&#34;sass-loader&#34;</span><span class=\"o\">:</span> <span class=\"s2\">&#34;^7.1.0&#34;</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"kr\">await</span> <span class=\"nx\">fs</span><span class=\"p\">.</span><span class=\"nx\">writeJson</span><span class=\"p\">(</span><span class=\"nx\">packageJsonPath</span><span class=\"p\">,</span> <span class=\"kr\">package</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"nx\">spaces</span><span class=\"o\">:</span> <span class=\"s1\">&#39;\\t&#39;</span> <span class=\"p\">});</span>\n    <span class=\"nx\">packageJsonSpinner</span><span class=\"p\">.</span><span class=\"nx\">stop</span><span class=\"p\">();</span>\n    <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"s1\">&#39;package.json é…ç½®å®Œæˆ&#39;</span><span class=\"p\">)).</span><span class=\"nx\">succeed</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`é…ç½®æ–‡ä»¶å¤±è´¥ï¼š</span><span class=\"si\">${</span><span class=\"nx\">error</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">)).</span><span class=\"nx\">fail</span><span class=\"p\">();</span>\n      <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n    <span class=\"p\">};</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>å®‰è£…ä¾èµ–</h2><p>å…¶å®é…ç½®æ–‡ä»¶ç”Ÿæˆåï¼ŒCLI å°±å¿«æ¥è¿‘å°¾å£°äº†ã€‚å‰©ä¸‹å°±æ˜¯å®‰è£…ä¾èµ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// multi-spa.js\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">InstallDependencies</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">const</span> <span class=\"nx\">installDependenciesSpinner</span> <span class=\"o\">=</span> <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"sb\">`å®‰è£…ä¾èµ–ä¸­...`</span><span class=\"p\">)).</span><span class=\"nx\">start</span><span class=\"p\">();</span>\n  <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nb\">Promise</span><span class=\"p\">((</span><span class=\"nx\">resolve</span><span class=\"p\">,</span> <span class=\"nx\">reject</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">shell</span><span class=\"p\">.</span><span class=\"nx\">exec</span><span class=\"p\">(</span><span class=\"sb\">`\n</span><span class=\"sb\">    cd </span><span class=\"si\">${</span><span class=\"nx\">targetDir</span><span class=\"si\">}</span><span class=\"sb\">\n</span><span class=\"sb\">    npm i\n</span><span class=\"sb\">    `</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n          <span class=\"nx\">installDependenciesSpinner</span><span class=\"p\">.</span><span class=\"nx\">stop</span><span class=\"p\">()</span>\n          <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">red</span><span class=\"p\">(</span><span class=\"sb\">`ä¾èµ–å®‰è£…å¤±è´¥ï¼š</span><span class=\"si\">${</span><span class=\"nx\">error</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">)).</span><span class=\"nx\">fail</span><span class=\"p\">()</span>\n          <span class=\"nx\">reject</span><span class=\"p\">()</span>\n        <span class=\"p\">}</span>\n        <span class=\"nx\">installDependenciesSpinner</span><span class=\"p\">.</span><span class=\"nx\">stop</span><span class=\"p\">();</span>\n        <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"s1\">&#39;ä¾èµ–å®‰è£…å®Œæˆ&#39;</span><span class=\"p\">)).</span><span class=\"nx\">succeed</span><span class=\"p\">();</span>\n        <span class=\"nx\">resolve</span><span class=\"p\">();</span>\n      <span class=\"p\">})</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">}</span>\n</code></pre></div><h2>å°ç»“</h2><p>ä¸€ä¸ªç²—ç³™çš„CLIï¼Œå°±è¿™ä¹ˆå®Œæˆäº†ã€‚æŠŠä»¥ä¸Šå‡ ä¸ªæ–¹æ³•åŒ…è£…ä¸€ä¸‹ï¼Œå°±æ˜¯æœ¬æ¬¡ CLI çš„å…¨éƒ¨å†…å®¹äº†ã€‚</p><ol><li>æ‹·è´è„šæ‰‹æ¶ã€‚2. é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚3å®‰è£…ä¾èµ–ã€‚</li></ol><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// multi-spa.js\n</span><span class=\"c1\"></span><span class=\"kr\">async</span> <span class=\"kd\">function</span> <span class=\"nx\">GenarateProject</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kr\">await</span> <span class=\"nx\">DownTemplate</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">);</span>\n  <span class=\"kr\">await</span> <span class=\"nb\">Promise</span><span class=\"p\">.</span><span class=\"nx\">all</span><span class=\"p\">([</span><span class=\"nx\">GenaratePackageJson</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">InstallDependencies</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">);</span>\n  <span class=\"p\">}),</span>\n  <span class=\"nx\">GenarateWebpackConfig</span><span class=\"p\">(</span><span class=\"nx\">targetDir</span><span class=\"p\">)</span>\n  <span class=\"p\">]);</span>\n  <span class=\"nx\">ora</span><span class=\"p\">(</span><span class=\"nx\">chalk</span><span class=\"p\">.</span><span class=\"nx\">cyan</span><span class=\"p\">(</span><span class=\"s1\">&#39;é¡¹ç›®åˆ›å»ºæˆåŠŸï¼&#39;</span><span class=\"p\">)).</span><span class=\"nx\">succeed</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>å¦‚æœæƒ³è¦å‘å¸ƒï¼Œéœ€è¦ç™»é™†npm ï¼Œ<code>npm publish</code>ã€‚</p>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "Node.js", 
                    "tagLink": "https://api.zhihu.com/topics/19569535"
                }, 
                {
                    "tag": "å‰ç«¯å¼€å‘", 
                    "tagLink": "https://api.zhihu.com/topics/19550901"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/68345092", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 5, 
            "title": "æ•°æ®ç»“æ„çš„JavaScriptæè¿°", 
            "content": "<p>ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•JavaScriptæè¿°ã€‹ï¼Œæœ‰ä¸€ç§èŠ±äº†æ­£ç‰ˆçš„é’±ä¹°äº†ç›—ç‰ˆçš„ä¹¦çš„æ„Ÿè§‰ã€‚èŠ±äº†ç‚¹æ—¶é—´æ•´ç†äº†ä¸€ä¸‹ï¼Œå¯ä»¥ä¿è¯éƒ½èƒ½è·‘é€šã€‚<b>å¯¹ç€æˆªå›¾æ•²ä¸€éï¼Œæ¯”å¤åˆ¶é»è´´æ•ˆæœå¥½</b>ã€‚</p><h3>åˆ—è¡¨</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b9fe9d206b2df303a34c8f584dd9b0a9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"588\" data-rawheight=\"3085\" class=\"origin_image zh-lightbox-thumb\" width=\"588\" data-original=\"https://pic2.zhimg.com/v2-b9fe9d206b2df303a34c8f584dd9b0a9_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;588&#39; height=&#39;3085&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"588\" data-rawheight=\"3085\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"588\" data-original=\"https://pic2.zhimg.com/v2-b9fe9d206b2df303a34c8f584dd9b0a9_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-b9fe9d206b2df303a34c8f584dd9b0a9_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>æ ˆ</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-255e6fad0a1df9fe578d25e1ce4b0f70_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"1393\" class=\"origin_image zh-lightbox-thumb\" width=\"640\" data-original=\"https://pic1.zhimg.com/v2-255e6fad0a1df9fe578d25e1ce4b0f70_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;640&#39; height=&#39;1393&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"1393\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"640\" data-original=\"https://pic1.zhimg.com/v2-255e6fad0a1df9fe578d25e1ce4b0f70_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-255e6fad0a1df9fe578d25e1ce4b0f70_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>é˜Ÿåˆ—</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c655621029260be1a7e85494f456b815_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"559\" data-rawheight=\"1501\" class=\"origin_image zh-lightbox-thumb\" width=\"559\" data-original=\"https://pic2.zhimg.com/v2-c655621029260be1a7e85494f456b815_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;559&#39; height=&#39;1501&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"559\" data-rawheight=\"1501\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"559\" data-original=\"https://pic2.zhimg.com/v2-c655621029260be1a7e85494f456b815_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-c655621029260be1a7e85494f456b815_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>é“¾è¡¨</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-b55b9d64adce1c1a745562882f6bc7dc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"732\" data-rawheight=\"2365\" class=\"origin_image zh-lightbox-thumb\" width=\"732\" data-original=\"https://pic1.zhimg.com/v2-b55b9d64adce1c1a745562882f6bc7dc_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;732&#39; height=&#39;2365&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"732\" data-rawheight=\"2365\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"732\" data-original=\"https://pic1.zhimg.com/v2-b55b9d64adce1c1a745562882f6bc7dc_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-b55b9d64adce1c1a745562882f6bc7dc_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>å­—å…¸</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-315ca3361f2c4001a73420afd75fc248_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"638\" data-rawheight=\"1429\" class=\"origin_image zh-lightbox-thumb\" width=\"638\" data-original=\"https://pic1.zhimg.com/v2-315ca3361f2c4001a73420afd75fc248_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;638&#39; height=&#39;1429&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"638\" data-rawheight=\"1429\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"638\" data-original=\"https://pic1.zhimg.com/v2-315ca3361f2c4001a73420afd75fc248_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-315ca3361f2c4001a73420afd75fc248_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>æ•£åˆ—</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-b4660a6035471da0a8b28c8b5eb71d2b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"622\" data-rawheight=\"2563\" class=\"origin_image zh-lightbox-thumb\" width=\"622\" data-original=\"https://pic4.zhimg.com/v2-b4660a6035471da0a8b28c8b5eb71d2b_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;622&#39; height=&#39;2563&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"622\" data-rawheight=\"2563\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"622\" data-original=\"https://pic4.zhimg.com/v2-b4660a6035471da0a8b28c8b5eb71d2b_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-b4660a6035471da0a8b28c8b5eb71d2b_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>é›†åˆ</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-7888110d64dc60e5096d0f7c5024a800_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"850\" data-rawheight=\"2473\" class=\"origin_image zh-lightbox-thumb\" width=\"850\" data-original=\"https://pic1.zhimg.com/v2-7888110d64dc60e5096d0f7c5024a800_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;850&#39; height=&#39;2473&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"850\" data-rawheight=\"2473\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"850\" data-original=\"https://pic1.zhimg.com/v2-7888110d64dc60e5096d0f7c5024a800_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-7888110d64dc60e5096d0f7c5024a800_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>äºŒå‰æŸ¥æ‰¾æ ‘</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-b7127b2d9cf415ae5730e3cb1faeb71d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"791\" data-rawheight=\"3895\" class=\"origin_image zh-lightbox-thumb\" width=\"791\" data-original=\"https://pic2.zhimg.com/v2-b7127b2d9cf415ae5730e3cb1faeb71d_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;791&#39; height=&#39;3895&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"791\" data-rawheight=\"3895\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"791\" data-original=\"https://pic2.zhimg.com/v2-b7127b2d9cf415ae5730e3cb1faeb71d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-b7127b2d9cf415ae5730e3cb1faeb71d_b.jpg\"/></figure><p class=\"ztext-empty-paragraph\"><br/></p><h3>å›¾</h3><p class=\"ztext-empty-paragraph\"><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-6ca4f9e0cf3166bc5765efbb616bd25a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"749\" data-rawheight=\"1897\" class=\"origin_image zh-lightbox-thumb\" width=\"749\" data-original=\"https://pic3.zhimg.com/v2-6ca4f9e0cf3166bc5765efbb616bd25a_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;749&#39; height=&#39;1897&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"749\" data-rawheight=\"1897\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"749\" data-original=\"https://pic3.zhimg.com/v2-6ca4f9e0cf3166bc5765efbb616bd25a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-6ca4f9e0cf3166bc5765efbb616bd25a_b.jpg\"/></figure><p></p>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "æ•°æ®ç»“æ„", 
                    "tagLink": "https://api.zhihu.com/topics/19591797"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/66349682", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 32, 
            "title": "æµ…å°webpack", 
            "content": "<h2>åæ§½ä¸€ä¸‹</h2><p>webpack è‡ªå‡ºç°æ—¶ï¼Œä¸€ç›´å¤‡å—é’çã€‚ä½œä¸ºå¼ºå¤§çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒåªæ˜¯å‡ºç°åœ¨é¡¹ç›®åˆå§‹æˆ–ä¼˜åŒ–çš„é˜¶æ®µã€‚å¦‚æœæ²¡æœ‰å‚ä¸é¡¹ç›®çš„æ„å»ºï¼Œæ¥è§¦çš„æœºä¼šå‡ ä¹ä¸ºé›¶ã€‚å³ä½¿æ˜¯å‚ä¸äº†ï¼Œä½†ä¹Ÿä¼šå› ä¸ºé¡¹ç›®çš„å‘¨æœŸçŸ­ï¼Œä»ç½‘ä¸Šä¸œæ‹¼è¥¿å‡‘è‰è‰äº†äº‹ã€‚</p><p>çºµè§‚ç½‘ä¸Šçš„ webpack æ•™ç¨‹ï¼Œè¦ä¹ˆæ˜¯èœ»èœ“ç‚¹æ°´ï¼Œç§‘æ™®äº†ä¸€äº›å¸¸è§„é…ç½®é¡¹ï¼›è¦ä¹ˆæ˜¯è¿‡äºæ·±å…¥åŸç†ï¼Œäºå®é™…æ“ä½œæ— ç›Šã€‚æœ€è¿‘ä¸€æ®µæ—¶é—´ï¼Œæˆ‘æŠŠ webpack çš„å®˜æ–¹æ–‡æ¡£æ¥æ¥å›å›åœ°çœ‹äº†å‡ éï¼Œç»“æœå‘ç°ï¼ŒçœŸé¦™ã€‚ä¸­æ–‡ç‰ˆçš„å®˜æ–¹æ–‡æ¡£ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œå¾ˆæ„Ÿè°¢ç¿»è¯‘ç»„çš„è¾›å‹¤å¥‰çŒ®ã€‚çœ‹å®Œä¹‹åï¼Œè™½ç„¶è¾¾ä¸åˆ°ç‚‰ç«çº¯é’çš„åœ°æ­¥ï¼Œä½†ä¹Ÿä¸ä¼šæ‰è¥Ÿè§è‚˜ï¼Œç–²äºåº”ä»˜ã€‚</p><p>å¯¹äºè¿™ç§å·¥å…·ç±»çš„åšæ–‡ï¼Œä¾ç„¶æ²¿è¢­ <a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/%25E7%2594%25A8Type%25E9%25A9%25AF%25E5%258C%2596JavaScript/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç”¨Typeé©¯åŒ–JavaScript</a> çš„é£æ ¼ï¼Œä¸²è”å„ä¸ªæ¦‚å¿µã€‚è‡³äºç»†èŠ‚ï¼Œå°±æ˜¯å®˜æ–¹æ–‡æ¡£çš„äº‹äº†ã€‚</p><p>æœ¬æ–‡åŸºäº <i><b>webpack v4.31.0</b></i> ç‰ˆæœ¬ã€‚</p><h2>Tapable</h2><blockquote>Tapable æ˜¯ä¸€ä¸ªå°å‹çš„åº“ï¼Œå…è®¸ä½ å¯¹ä¸€ä¸ª javascript æ¨¡å—æ·»åŠ å’Œåº”ç”¨æ’ä»¶ã€‚å®ƒå¯ä»¥è¢«ç»§æ‰¿æˆ–æ··å…¥åˆ°å…¶ä»–æ¨¡å—ä¸­ã€‚ç±»ä¼¼äº NodeJS çš„ EventEmitter ç±»ï¼Œä¸“æ³¨äºè‡ªå®šä¹‰äº‹ä»¶çš„è§¦å‘å’Œå¤„ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒTapable è¿˜å…è®¸ä½ é€šè¿‡å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œè®¿é—®äº‹ä»¶çš„â€œè§¦å‘è€…(emittee)â€æˆ–â€œæä¾›è€…(producer)â€ã€‚</blockquote><p>tapable æ˜¯ webpack çš„æ ¸å¿ƒï¼Œwebpack ä¸­çš„å¾ˆå¤šå¯¹è±¡ï¼ˆcompileï¼Œ compilationç­‰ï¼‰éƒ½æ‰©å±•è‡ªtapableï¼ŒåŒ…æ‹¬ webpack ä¹Ÿæ˜¯ tapable çš„å®ä¾‹ã€‚æ‰©å±•è‡ª tapable çš„å¯¹è±¡å†…éƒ¨ä¼šæœ‰å¾ˆå¤šé’©å­ï¼Œå®ƒä»¬è´¯ç©¿äº† webpack æ„å»ºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›é’©å­ï¼Œåœ¨å…¶è¢«è§¦å‘æ—¶ï¼Œåšä¸€äº›æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ã€‚</p><p>æŠ›å¼€ webpack ä¸è°ˆï¼Œå…ˆçœ‹çœ‹ tapable çš„ç®€å•ä½¿ç”¨ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Main.js\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"p\">{</span>\n  <span class=\"nx\">SyncHook</span>\n<span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s2\">&#34;tapable&#34;</span><span class=\"p\">);</span>\n<span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">hooks</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n      <span class=\"nx\">init</span><span class=\"o\">:</span> <span class=\"k\">new</span> <span class=\"nx\">SyncHook</span><span class=\"p\">([</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">])</span>\n    <span class=\"p\">};</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">plugins</span> <span class=\"o\">=</span> <span class=\"nx\">options</span><span class=\"p\">.</span><span class=\"nx\">plugins</span><span class=\"p\">;</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">init</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">beforeInit</span><span class=\"p\">();</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nb\">Array</span><span class=\"p\">.</span><span class=\"nx\">isArray</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">plugins</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n      <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">plugins</span><span class=\"p\">.</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">plugin</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"nx\">plugin</span><span class=\"p\">.</span><span class=\"nx\">apply</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">);</span>\n      <span class=\"p\">})</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">hooks</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"s1\">&#39;åˆå§‹åŒ–ä¸­ã€‚ã€‚ã€‚&#39;</span><span class=\"p\">);</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">afterInit</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">beforeInit</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;åˆå§‹åŒ–å‰ã€‚ã€‚ã€‚&#39;</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">afterInit</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;åˆå§‹åŒ–åã€‚ã€‚ã€‚&#39;</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"nx\">Main</span><span class=\"p\">;</span>\n<span class=\"c1\">// MyPlugin.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">MyPlugin</span> <span class=\"p\">{</span>\n  <span class=\"nx\">apply</span><span class=\"p\">(</span><span class=\"nx\">main</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">main</span><span class=\"p\">.</span><span class=\"nx\">hooks</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">.</span><span class=\"nx\">tap</span><span class=\"p\">(</span><span class=\"s1\">&#39;MyPlugin&#39;</span><span class=\"p\">,</span> <span class=\"nx\">param</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n      <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;init é’©å­ï¼Œåšäº›å•¥ï¼›&#39;</span><span class=\"p\">,</span> <span class=\"nx\">param</span><span class=\"p\">);</span>\n    <span class=\"p\">});</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">};</span>\n<span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"nx\">MyPlugin</span><span class=\"p\">;</span>\n<span class=\"c1\">// index.js\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">Main</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">&#39;./Main&#39;</span><span class=\"p\">);</span>\n<span class=\"k\">const</span> <span class=\"nx\">MyPlugin</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">&#39;./MyPlugin&#39;</span><span class=\"p\">);</span>\n<span class=\"kd\">let</span> <span class=\"nx\">myPlugin</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">MyPlugin</span><span class=\"p\">();</span>\n<span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">({</span> <span class=\"nx\">plugins</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"nx\">myPlugin</span><span class=\"p\">]</span> <span class=\"p\">});</span>\n\n<span class=\"c1\">// åˆå§‹åŒ–å‰ã€‚ã€‚ã€‚\n</span><span class=\"c1\">// init é’©å­ï¼Œåšäº›å•¥; åˆå§‹åŒ–ä¸­ã€‚ã€‚ã€‚\n</span><span class=\"c1\">// åˆå§‹åŒ–åã€‚ã€‚ã€‚\n</span></code></pre></div><p>ç†è§£èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ <code>init</code> å¤„è§¦å‘é’©å­ï¼Œ<code>this.hooks.init.call(params)</code> ç±»ä¼¼äºæˆ‘ä»¬ç†Ÿæ‚‰çš„ <code>EventEmitter.emit(&#39;init&#39;, params)</code>ã€‚<code>main.hooks.init.tap</code> ç±»ä¼¼äº <code>EventEmitter.on(&#39;init&#39;, callback)</code>ï¼Œåœ¨ <code>init</code>é’©å­ä¸Šç»‘å®šä¸€äº›æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ã€‚åœ¨åé¢å°†è¦è¯´çš„ webpack è‡ªå®šä¹‰æ’ä»¶ï¼Œå°±æ˜¯åœ¨ webpack ä¸­çš„æŸä¸ªé’©å­å¤„ï¼Œæ’å…¥è‡ªå®šä¹‰çš„äº‹ã€‚</p><h2>ç†æ¸…æ¦‚å¿µ</h2><ul><li><b>ä¾èµ–å›¾</b> åœ¨å•é¡µé¢åº”ç”¨ä¸­ï¼Œåªè¦æœ‰ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œå°±å¯ä»¥æŠŠæ•£è½åœ¨é¡¹ç›®ä¸‹çš„å„ä¸ªæ–‡ä»¶æ•´åˆåˆ°ä¸€èµ·ã€‚ä½•è°“ä¾èµ–ï¼Œå½“å‰æ–‡ä»¶éœ€è¦ä»€ä¹ˆï¼Œä»€ä¹ˆå°±æ˜¯å½“å‰æ–‡ä»¶çš„ä¾èµ–ã€‚ä¾èµ–å¼•å…¥çš„å½¢å¼æœ‰å¦‚ä¸‹ï¼š<br/></li><ul><li>ES2015 <code>import</code> è¯­å¥</li><li>CommonJS <code>require()</code> è¯­å¥</li><li>AMD <code>define</code> å’Œ <code>require</code> è¯­å¥</li><li>æ ·å¼(<code>url(...)</code>)æˆ– HTML æ–‡ä»¶(<code>&lt;img src=...&gt;</code>)ä¸­çš„å›¾ç‰‡é“¾æ¥</li></ul><li><b>å…¥å£(entry)</b> å…¥å£èµ·ç‚¹(entry point)æŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾ï¼ˆdependency graphï¼‰çš„å¼€å§‹ã€‚</li><li><b>è¾“å‡º(output)</b> output å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundleï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ã€‚</li><li><b>æ¨¡å—(module)</b> å†³å®šäº†å¦‚ä½•å¤„ç†é¡¹ç›®ä¸­çš„ä¸åŒç±»å‹çš„æ¨¡å—ã€‚æ¯”å¦‚è®¾ç½® loaderï¼Œå¤„ç†å„ç§æ¨¡å—ã€‚è®¾ç½® noParseï¼Œå¿½ç•¥æ— éœ€ webpack è§£æçš„æ¨¡å—ã€‚</li><li><b>è§£æ(resolve)</b> è®¾ç½®æ¨¡å—å¦‚ä½•è¢«è§£æã€‚å¼•ç”¨ä¾èµ–æ—¶ï¼Œéœ€è¦çŸ¥é“ä¾èµ–é—´çš„è·¯å¾„å…³ç³»ï¼Œåº”éµå¾ªä½•ç§è§£æè§„åˆ™ã€‚æ¯”å¦‚ç»™è·¯å¾„è®¾ç½®åˆ«åï¼ˆaliasï¼‰ï¼Œè§£ææ¨¡å—çš„æœç´¢ç›®å½•ï¼ˆmodulesï¼‰ï¼Œè§£æ loader åŒ…è·¯å¾„ï¼ˆresolveLoaderï¼‰ç­‰ã€‚</li><li><b>å¤–éƒ¨æ‰©å±•(externals)</b> é˜²æ­¢å°†æŸäº› import çš„åŒ…ï¼ˆpackageï¼‰æ‰“åŒ…åˆ° bundle ä¸­ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å†å»ä»å¤–éƒ¨è·å–è¿™äº›æ‰©å±•ä¾èµ–ã€‚æ¯”å¦‚è¯´ï¼Œé¡¹ç›®ä¸­å¼•ç”¨äº† jQuery çš„CDNèµ„æºï¼Œåœ¨ä½¿ç”¨ <code>import $ from &#39;jquery&#39;;</code>æ—¶ï¼Œwebpack ä¼šæŠŠ jQuery æ‰“åŒ…è¿› bundleï¼Œå…¶å®è¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œæ­¤æ—¶éœ€è¦é…ç½® <code>externals: {jquery: &#39;jQuery&#39;}</code>ï¼Œå°†å…¶å‰”é™¤ bundleã€‚</li><li><b>æ’ä»¶(plugins)</b> ç”¨äºä»¥å„ç§æ–¹å¼è‡ªå®šä¹‰ webpack æ„å»ºè¿‡ç¨‹ã€‚å¯ä»¥åˆ©ç”¨ webpack ä¸­çš„é’©å­ï¼Œåšäº›ä¼˜åŒ–æˆ–è€…æäº›å°åŠ¨ä½œã€‚</li><li><b>å¼€å‘è®¾ç½®(devServer)</b> é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¼€å‘æ—¶ç”¨åˆ°çš„é€‰é¡¹ã€‚æ¯”å¦‚ï¼Œå¼€å‘æœåŠ¡æ ¹è·¯å¾„ï¼ˆcontentBaseï¼‰ï¼Œæ¨¡å—çƒ­æ›¿æ¢ï¼ˆhotï¼Œéœ€é…åˆ <code>HotModuleReplacementPlugin</code> ä½¿ç”¨ï¼‰ï¼Œä»£ç†ï¼ˆproxyï¼‰ç­‰ã€‚</li><li><b>æ¨¡å¼(mode)</b> æä¾› mode é…ç½®é€‰é¡¹ï¼Œå‘ŠçŸ¥ webpack ä½¿ç”¨ç›¸åº”ç¯å¢ƒçš„å†…ç½®ä¼˜åŒ–ã€‚å…·ä½“å¯è§ <a href=\"https://link.zhihu.com/?target=https%3A//webpack.docschina.org/concepts/mode/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">æ¨¡å¼(mode)</a></li><li><b>ä¼˜åŒ–(optimization)</b> ä» webpack 4 å¼€å§‹ï¼Œä¼šæ ¹æ®ä½ é€‰æ‹©çš„ mode æ¥æ‰§è¡Œä¸åŒçš„ä¼˜åŒ–ï¼Œä¸è¿‡æ‰€æœ‰çš„ä¼˜åŒ–è¿˜æ˜¯å¯ä»¥æ‰‹åŠ¨é…ç½®å’Œé‡å†™ã€‚æ¯”å¦‚ï¼Œ<code>CommonsChunkPlugin</code>è¢« <code>optimization.splitChunks</code> å–ä»£ã€‚</li></ul><p>webpack å·®ä¸å¤šå°±æ˜¯è¿™å‡ ä¸ªé…ç½®é¡¹ï¼Œææ¸…æ¥šè¿™å‡ ä¸ªæ¦‚å¿µï¼Œä¸Šæ‰‹è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚</p><h2>ä»£ç åˆ†ç¦»</h2><p>ç°åœ¨çš„å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚ï¼Œå¦‚æœæœ€ç»ˆå¯¼å‡ºä¸ºä¸€ä¸ª bundleï¼Œä¼šæå¤§åœ°å½±å“åŠ è½½é€Ÿåº¦ã€‚åˆ‡å‰² bundleï¼Œæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼ŒæŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½ï¼Œåˆç†åº”ç”¨å°±ä¼šå¤§å¤§ç¼©çŸ­åŠ è½½æ—¶é—´ã€‚å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸‰ç§å¸¸è§çš„ä»£ç åˆ†ç¦»æ–¹æ³•ï¼š</p><ul><li><b>å…¥å£èµ·ç‚¹</b> é…ç½®å¤šä¸ªå…¥å£æ–‡ä»¶ï¼Œç„¶åå°†æœ€ç»ˆç”Ÿæˆçš„è¿‡ä¸ª bundle å‡ºå…¥åˆ° HTML ä¸­ã€‚ä¸è¿‡å¦‚æœè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­å­˜åœ¨ç›¸åŒçš„æ¨¡å—ï¼Œè¿™å°±æ„å‘³ç€ç›¸åŒçš„æ¨¡å—è¢«åŠ è½½äº†ä¸¤æ¬¡ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦æå–å‡ºé‡å¤çš„æ¨¡å—ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.config.js \n</span><span class=\"c1\"></span><span class=\"nx\">entry</span><span class=\"o\">:</span> <span class=\"p\">{</span>     <span class=\"nx\">index</span><span class=\"o\">:</span> <span class=\"s1\">&#39;./src/index.js&#39;</span><span class=\"p\">,</span>     <span class=\"nx\">vendor</span><span class=\"o\">:</span> <span class=\"s1\">&#39;./src/vendor.js&#39;</span> <span class=\"p\">}</span>\n<span class=\"nx\">output</span><span class=\"o\">:</span> <span class=\"p\">{</span>     <span class=\"nx\">filename</span><span class=\"o\">:</span> <span class=\"s1\">&#39;[name].bundle.js&#39;</span><span class=\"p\">,</span> <span class=\"p\">},</span>\n<span class=\"nx\">plugins</span><span class=\"o\">:</span> <span class=\"p\">[</span> <span class=\"k\">new</span> <span class=\"nx\">HtmlWebpackPlugin</span><span class=\"p\">({</span>     <span class=\"nx\">chunks</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"s1\">&#39;vendor&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;index&#39;</span><span class=\"p\">]</span> <span class=\"p\">})</span> <span class=\"p\">]</span>\n</code></pre></div><ul><li><b>é˜²æ­¢é‡å¤</b> åœ¨ webpack è€çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>CommonsChunkPlugin</code> å¸¸ç”¨æ¥æå–å…¬å…±çš„æ¨¡å—ã€‚æ–°ç‰ˆæœ¬ä¸­ <code>SplitChunksPlugin</code> å–è€Œä»£ä¹‹ï¼Œå¯ä»¥é€šè¿‡ <code>optimization.splitChunks</code> è®¾ç½®ï¼Œå¤šè§äºå¤šé¡µé¢åº”ç”¨ã€‚</li><li><b>åŠ¨æ€å¯¼å…¥</b> å°±æ˜¯åœ¨éœ€è¦æ—¶å†å»åŠ è½½æ¨¡å—ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘çš„å…¨éƒ¨åŠ è½½ã€‚webpack è¿˜æä¾›äº†é¢„å–å’Œé¢„åŠ è½½çš„æ–¹å¼ã€‚éå…¥å£ chunkï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ chunkFilename ä¸ºå…¶å‘½åã€‚å¸¸è§çš„å¦‚ï¼Œvue è·¯ç”±åŠ¨æ€å¯¼å…¥ã€‚</li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.config.js \n</span><span class=\"c1\"></span><span class=\"nx\">output</span><span class=\"o\">:</span> <span class=\"p\">{</span>   <span class=\"nx\">chunkFilename</span><span class=\"o\">:</span> <span class=\"s1\">&#39;[name].bundle.js&#39;</span><span class=\"p\">,</span> <span class=\"p\">}</span> \n<span class=\"c1\">// index.js \n</span><span class=\"c1\"></span><span class=\"k\">import</span><span class=\"p\">(</span><span class=\"cm\">/* webpackChunkName: &#34;someJs&#34; */</span> <span class=\"s1\">&#39;someJs&#39;</span><span class=\"p\">);</span> \n<span class=\"k\">import</span><span class=\"p\">(</span><span class=\"cm\">/* webpackPrefetch: true */</span> <span class=\"s1\">&#39;someJs&#39;</span><span class=\"p\">);</span> \n<span class=\"k\">import</span><span class=\"p\">(</span><span class=\"cm\">/* webpackPreload: true */</span> <span class=\"s1\">&#39;someJs&#39;</span><span class=\"p\">);</span>\n</code></pre></div><h2>ç¼“å­˜</h2><p>åŸºäºæµè§ˆå™¨çš„ç¼“å­˜ç­–ç•¥ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœæœ¬åœ°ç¼“å­˜å‘½ä¸­ï¼Œåˆ™æ— éœ€å†æ¬¡è¯·æ±‚èµ„æºã€‚å¯¹äºæ”¹åŠ¨ä¸é¢‘ç¹æˆ–åŸºæœ¬ä¸ä¼šå†åšæ”¹åŠ¨çš„æ¨¡å—ï¼Œå¯ä»¥å‰¥ç¦»å‡ºæ¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.config.js\n</span><span class=\"c1\"></span>  <span class=\"nx\">output</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n    <span class=\"nx\">filename</span><span class=\"o\">:</span> <span class=\"s1\">&#39;[name].[contenthash].js&#39;</span><span class=\"p\">,</span>\n  <span class=\"p\">}</span>\n</code></pre></div><p>æŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•ï¼Œåªè¦æ¨¡å—çš„å†…å®¹æ²¡æœ‰å˜åŒ–ï¼Œå¯¹åº”çš„åå­—ä¹Ÿå°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·ç¼“å­˜å°±ä¼šèµ·ä½œç”¨äº†ã€‚äº‹å®ä¸Šå¹¶éå¦‚æ­¤ï¼Œwebpack æ‰“åŒ…åçš„æ–‡ä»¶ï¼Œå¹¶éåªæœ‰ç”¨æˆ·è‡ªå·±çš„ä»£ç ï¼Œè¿˜åŒ…æ‹¬ç®¡ç†ç”¨æˆ·ä»£ç çš„ä»£ç ï¼Œå¦‚ runtime å’Œ manifestã€‚</p><p>æ¨¡å—ä¾èµ–é—´çš„æ•´åˆå¹¶ä¸æ˜¯ç®€å•çš„ä»£ç æ‹¼æ¥ï¼Œå…¶ä¸­åŒ…æ‹¬æ¨¡å—çš„åŠ è½½å’Œè§£æé€»è¾‘ã€‚æ³¨å…¥çš„ runtime å’Œ manifest åœ¨æ¯æ¬¡æ„å»ºåéƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™å°±å¯¼è‡´äº†å³ä½¿ç”¨æˆ·ä»£ç æ²¡æœ‰å˜åŒ–ï¼ŒæŸäº› hash è¿˜æ˜¯å‘ç”Ÿäº†æ”¹å˜ã€‚é€šè¿‡ <code>optimization.runtimeChunk</code> æå– runtime ä»£ç ã€‚é€šè¿‡ <code>optimization.splitChunks</code> å‰¥ç¦»ç¬¬ä¸‰æ–¹åº“ã€‚æ¯”å¦‚ï¼Œ reactï¼Œreact-domã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"c1\">//...\n</span><span class=\"c1\"></span>  <span class=\"nx\">optimization</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n  <span class=\"nx\">runtimeChunk</span><span class=\"o\">:</span> <span class=\"s1\">&#39;single&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">splitChunks</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n      <span class=\"nx\">cacheGroups</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"nx\">vendor</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n          <span class=\"nx\">test</span><span class=\"o\">:</span> <span class=\"sr\">/[\\\\/]node_modules[\\\\/](react|react-dom)[\\\\/]/</span><span class=\"p\">,</span>\n          <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;vendor&#39;</span><span class=\"p\">,</span>\n          <span class=\"nx\">chunks</span><span class=\"o\">:</span> <span class=\"s1\">&#39;all&#39;</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">};</span>\n</code></pre></div><p>æœ€åä½¿ç”¨ <code>HashedModuleIdsPlugin</code> æ¥æ¶ˆé™¤å› æ¨¡å— ID å˜åŠ¨å¸¦æ¥çš„å½±å“ã€‚</p><h2>loader</h2><p>loader ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loader æ˜¯å¯¼å‡ºä¸ºä¸€ä¸ªå‡½æ•°çš„ node æ¨¡å—ã€‚è¯¥å‡½æ•°åœ¨ loader è½¬æ¢èµ„æºçš„æ—¶å€™è°ƒç”¨ã€‚ç»™å®šçš„å‡½æ•°å°†è°ƒç”¨ loader APIï¼Œå¹¶é€šè¿‡ this ä¸Šä¸‹æ–‡è®¿é—®ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// loader API;\n</span><span class=\"c1\"></span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">callback</span><span class=\"p\">(</span>\n  <span class=\"nx\">err</span><span class=\"o\">:</span> <span class=\"nb\">Error</span> <span class=\"o\">|</span> <span class=\"kc\">null</span><span class=\"p\">,</span>\n  <span class=\"nx\">content</span><span class=\"o\">:</span> <span class=\"nx\">string</span> <span class=\"o\">|</span> <span class=\"nx\">Buffer</span><span class=\"p\">,</span>\n  <span class=\"nx\">sourceMap</span><span class=\"o\">?:</span> <span class=\"nx\">SourceMap</span><span class=\"p\">,</span>\n  <span class=\"nx\">meta</span><span class=\"o\">?:</span> <span class=\"nx\">any</span>\n<span class=\"p\">);</span>\n<span class=\"c1\">// sync loader\n</span><span class=\"c1\"></span><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">content</span><span class=\"p\">,</span> <span class=\"nx\">map</span><span class=\"p\">,</span> <span class=\"nx\">meta</span><span class=\"p\">){</span>\n  <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">callback</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"nx\">syncOperation</span><span class=\"p\">(</span><span class=\"nx\">content</span><span class=\"p\">,</span> <span class=\"nx\">map</span><span class=\"p\">,</span> <span class=\"nx\">meta</span><span class=\"p\">));</span>\n  <span class=\"k\">return</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// async loader\n</span><span class=\"c1\"></span><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">content</span><span class=\"p\">,</span> <span class=\"nx\">map</span><span class=\"p\">,</span> <span class=\"nx\">meta</span><span class=\"p\">){</span>\n  <span class=\"kd\">let</span> <span class=\"nx\">callback</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"kr\">async</span><span class=\"p\">();</span>\n  <span class=\"nx\">asyncOperation</span><span class=\"p\">(</span><span class=\"nx\">content</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">,</span> <span class=\"nx\">result</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"nx\">callback</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">);</span>\n    <span class=\"nx\">callback</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"nx\">result</span><span class=\"p\">,</span> <span class=\"nx\">map</span><span class=\"p\">,</span> <span class=\"nx\">meta</span><span class=\"p\">);</span>\n    <span class=\"k\">return</span><span class=\"p\">;</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>å¤šä¸ª loader ä¸²è¡Œæ—¶ï¼Œåœ¨ä»å³å‘å·¦æ‰§è¡Œ loader ä¹‹å‰ï¼Œä¼šå‘ä»å·¦åˆ°å³è°ƒç”¨ loader ä¸Šçš„ pitch æ–¹æ³•ã€‚å¦‚æœåœ¨ pitch ä¸­è¿”å›äº†ç»“æœï¼Œåˆ™ä¼šè·³è¿‡åç»­ loaderã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"o\">|-</span> <span class=\"nx\">a</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"sb\">`pitch`</span>\n  <span class=\"o\">|-</span> <span class=\"nx\">b</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"sb\">`pitch`</span>\n    <span class=\"o\">|-</span> <span class=\"nx\">c</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"sb\">`pitch`</span>\n      <span class=\"o\">|-</span> <span class=\"nx\">requested</span> <span class=\"nx\">module</span> <span class=\"nx\">is</span> <span class=\"nx\">picked</span> <span class=\"nx\">up</span> <span class=\"nx\">as</span> <span class=\"nx\">a</span> <span class=\"nx\">dependency</span>\n    <span class=\"o\">|-</span> <span class=\"nx\">c</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"nx\">normal</span> <span class=\"nx\">execution</span>\n  <span class=\"o\">|-</span> <span class=\"nx\">b</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"nx\">normal</span> <span class=\"nx\">execution</span>\n<span class=\"o\">|-</span> <span class=\"nx\">a</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"nx\">normal</span> <span class=\"nx\">execution</span>\n\n<span class=\"c\">&lt;!--</span> <span class=\"nx\">pitch</span> <span class=\"nx\">ä¸­è¿”å›ç»“æœ</span> <span class=\"o\">--&gt;</span>\n\n<span class=\"o\">|-</span> <span class=\"nx\">a</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"sb\">`pitch`</span>\n  <span class=\"o\">|-</span> <span class=\"nx\">b</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"sb\">`pitch`</span> <span class=\"nx\">returns</span> <span class=\"nx\">a</span> <span class=\"nx\">module</span>\n<span class=\"o\">|-</span> <span class=\"nx\">a</span><span class=\"o\">-</span><span class=\"nx\">loader</span> <span class=\"nx\">normal</span> <span class=\"nx\">execution</span>\n</code></pre></div><h2>plugins</h2><p>webpack çš„è‡ªå®šä¹‰æ’ä»¶å’Œæœ¬æ–‡å¼€å¤´ Tapable ä¸­çš„å·®ä¸å¤šã€‚webpack æ’ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰ apply æ–¹æ³•çš„ JavaScript å¯¹è±¡ã€‚apply æ–¹æ³•ä¼šè¢« webpack compiler è°ƒç”¨ï¼Œå¹¶ä¸” compiler å¯¹è±¡å¯åœ¨æ•´ä¸ªç¼–è¯‘ç”Ÿå‘½å‘¨æœŸè®¿é—®ã€‚é’©å­æœ‰åŒæ­¥çš„ï¼Œä¹Ÿæœ‰å¼‚æ­¥çš„ï¼Œè¿™éœ€è¦æ ¹æ® webpack æä¾›çš„ API æ–‡æ¡£ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å®˜æ–¹ä¾‹å­\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">FileListPlugin</span> <span class=\"p\">{</span>\n  <span class=\"nx\">apply</span><span class=\"p\">(</span><span class=\"nx\">compiler</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// emit æ˜¯å¼‚æ­¥ hookï¼Œä½¿ç”¨ tapAsync è§¦åŠå®ƒï¼Œè¿˜å¯ä»¥ä½¿ç”¨ tapPromise/tap(åŒæ­¥)\n</span><span class=\"c1\"></span>    <span class=\"nx\">compiler</span><span class=\"p\">.</span><span class=\"nx\">hooks</span><span class=\"p\">.</span><span class=\"nx\">emit</span><span class=\"p\">.</span><span class=\"nx\">tapAsync</span><span class=\"p\">(</span><span class=\"s1\">&#39;FileListPlugin&#39;</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nx\">compilation</span><span class=\"p\">,</span> <span class=\"nx\">callback</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n      <span class=\"c1\">// åœ¨ç”Ÿæˆæ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå¤´éƒ¨å­—ç¬¦ä¸²ï¼š\n</span><span class=\"c1\"></span>      <span class=\"kd\">var</span> <span class=\"nx\">filelist</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;In this build:\\n\\n&#39;</span><span class=\"p\">;</span>\n      <span class=\"c1\">// éå†æ‰€æœ‰ç¼–è¯‘è¿‡çš„èµ„æºæ–‡ä»¶ï¼Œ\n</span><span class=\"c1\"></span>      <span class=\"c1\">// å¯¹äºæ¯ä¸ªæ–‡ä»¶åç§°ï¼Œéƒ½æ·»åŠ ä¸€è¡Œå†…å®¹ã€‚\n</span><span class=\"c1\"></span>      <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">filename</span> <span class=\"k\">in</span> <span class=\"nx\">compilation</span><span class=\"p\">.</span><span class=\"nx\">assets</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">filelist</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;- &#39;</span> <span class=\"o\">+</span> <span class=\"nx\">filename</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;\\n&#39;</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n      <span class=\"c1\">// å°†è¿™ä¸ªåˆ—è¡¨ä½œä¸ºä¸€ä¸ªæ–°çš„æ–‡ä»¶èµ„æºï¼Œæ’å…¥åˆ° webpack æ„å»ºä¸­ï¼š\n</span><span class=\"c1\"></span>      <span class=\"nx\">compilation</span><span class=\"p\">.</span><span class=\"nx\">assets</span><span class=\"p\">[</span><span class=\"s1\">&#39;filelist.md&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"nx\">source</span><span class=\"o\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n          <span class=\"k\">return</span> <span class=\"nx\">filelist</span><span class=\"p\">;</span>\n        <span class=\"p\">},</span>\n        <span class=\"nx\">size</span><span class=\"o\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n          <span class=\"k\">return</span> <span class=\"nx\">filelist</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">};</span>\n      <span class=\"nx\">callback</span><span class=\"p\">();</span>\n    <span class=\"p\">});</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"nx\">FileListPlugin</span><span class=\"p\">;</span>\n</code></pre></div><ul><li>ProvidePlugin è‡ªåŠ¨åŠ è½½æ¨¡å—ï¼Œæ— éœ€å¤„å¤„å¼•ç”¨ã€‚æœ‰ç‚¹ç±»ä¼¼ <code>expose-loader</code>ã€‚   </li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack.config.js \n</span><span class=\"c1\"></span><span class=\"k\">new</span> <span class=\"nx\">webpack</span><span class=\"p\">.</span><span class=\"nx\">ProvidePlugin</span><span class=\"p\">({</span>   <span class=\"nx\">$</span><span class=\"o\">:</span> <span class=\"s1\">&#39;jquery&#39;</span><span class=\"p\">,</span> <span class=\"p\">})</span> \n<span class=\"c1\">// some.js \n</span><span class=\"c1\"></span><span class=\"nx\">$</span><span class=\"p\">(</span><span class=\"s1\">&#39;#item&#39;</span><span class=\"p\">);</span>\n</code></pre></div><ul><li>DllPlugin å°†åŸºç¡€æ¨¡å—æ‰“åŒ…è¿›åŠ¨æ€é“¾æ¥åº“ï¼Œå½“ä¾èµ–çš„æ¨¡å—å­˜åœ¨äºåŠ¨æ€é“¾æ¥åº“ä¸­æ—¶ï¼Œæ— éœ€å†æ¬¡æ‰“åŒ…ï¼Œè€Œæ˜¯ç›´æ¥ä»åŠ¨æ€é“¾æ¥åº“ä¸­è·å–ã€‚DLLPlugin è´Ÿè´£æ‰“åŒ…å‡ºåŠ¨æ€é“¾æ¥åº“ï¼ŒDllReferencePlugin è´Ÿè´£ä»ä¸»è¦é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ DllPlugin æ’ä»¶æ‰“åŒ…å¥½çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚<br/></li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// webpack-dll-config.js \n</span><span class=\"c1\">// å…ˆæ‰§è¡Œè¯¥é…ç½®æ–‡ä»¶ \n</span><span class=\"c1\"></span><span class=\"nx\">output</span><span class=\"o\">:</span> <span class=\"p\">{</span>   <span class=\"nx\">path</span><span class=\"o\">:</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">join</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s2\">&#34;dist&#34;</span><span class=\"p\">),</span>   \n<span class=\"nx\">filename</span><span class=\"o\">:</span> <span class=\"s2\">&#34;MyDll.[name].js&#34;</span><span class=\"p\">,</span>   <span class=\"nx\">library</span><span class=\"o\">:</span> <span class=\"s2\">&#34;[name]_[hash]&#34;</span> <span class=\"p\">},</span> \n<span class=\"nx\">plugins</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"k\">new</span> <span class=\"nx\">webpack</span><span class=\"p\">.</span><span class=\"nx\">DllPlugin</span><span class=\"p\">({</span><span class=\"nx\">path</span><span class=\"o\">:</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">join</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s2\">&#34;dist&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;[name]-manifest.json&#34;</span><span class=\"p\">),</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s2\">&#34;[name]_[hash]&#34;</span><span class=\"p\">})]</span> \n<span class=\"c1\">// webpack-config.js \n</span><span class=\"c1\">// åæ‰§è¡Œè¯¥é…ç½®æ–‡ä»¶ \n</span><span class=\"c1\"></span><span class=\"nx\">plugins</span><span class=\"o\">:</span> <span class=\"p\">[</span>   <span class=\"k\">new</span> <span class=\"nx\">webpack</span><span class=\"p\">.</span><span class=\"nx\">DllReferencePlugin</span><span class=\"p\">({</span>     <span class=\"nx\">manifest</span><span class=\"o\">:</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s2\">&#34;../dll/dist/alpha-manifest.json&#34;</span><span class=\"p\">)</span>   <span class=\"p\">}),</span> <span class=\"p\">]</span>\n</code></pre></div><ul><li>HappyPack å¯åŠ¨å­è¿›ç¨‹å¤„ç†ä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨èµ„æºã€‚ä¸è¿‡è¿›ç¨‹é—´çš„é€šè®¯æ¯”è¾ƒè€—èµ„æºï¼Œè¦é…Œæƒ…å¤„ç†ã€‚<br/></li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">HappyPack</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">&#39;happypack&#39;</span><span class=\"p\">);</span> \n<span class=\"c1\">// loader \n</span><span class=\"c1\"></span><span class=\"p\">{</span>   <span class=\"nx\">test</span><span class=\"o\">:</span> <span class=\"sr\">/\\.js$/</span><span class=\"p\">,</span>   <span class=\"nx\">use</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"s1\">&#39;happypack/loader?id=babel&#39;</span><span class=\"p\">],</span>   <span class=\"nx\">exclude</span><span class=\"o\">:</span> <span class=\"nx\">path</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">__dirname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;node_modules&#39;</span><span class=\"p\">),</span> <span class=\"p\">},</span> \n<span class=\"c1\">// plugins \n</span><span class=\"c1\"></span><span class=\"k\">new</span> <span class=\"nx\">HappyPack</span><span class=\"p\">({</span>   <span class=\"nx\">id</span><span class=\"o\">:</span> <span class=\"s1\">&#39;babel&#39;</span><span class=\"p\">,</span>   <span class=\"nx\">loaders</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"s1\">&#39;babel-loader?cacheDirectory&#39;</span><span class=\"p\">],</span> <span class=\"p\">}),</span>\n</code></pre></div><ul><li>webpack-bundle-analyzer<br/>webpack æ‰“åŒ…åçš„åˆ†æå·¥å…·ã€‚</li></ul><p>webpack å‘Šä¸€æ®µè½ï¼Œæµ…å°è¾„æ­¢ã€‚</p>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "webpack", 
                    "tagLink": "https://api.zhihu.com/topics/20032877"
                }
            ], 
            "comments": [
                {
                    "userName": "çŸ¥ä¹ç”¨æˆ·", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "<p>emmm.....æ„Ÿè§‰æ˜¯ä¸æ˜¯ç ”ç©¶çš„å¤ªæ·±äº†</p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "å¯èƒ½å§ï¼ŒçŸ¥é“çš„è¶Šå¤šè¶Šå¥½ï¼Œä¸è¦æ€•[æœºæ™º]", 
                            "likes": 0, 
                            "replyToAuthor": "çŸ¥ä¹ç”¨æˆ·"
                        }
                    ]
                }, 
                {
                    "userName": "æ—å¿—é¹", 
                    "userLink": "https://www.zhihu.com/people/4324e37aac091e55f1054d596b41bce6", 
                    "content": "çœ‹åˆ°tapableå†³å®šæ”¶è—ä¸€ä¸‹ï¼Œé‡è¦çš„ç‚¹åŸºæœ¬éƒ½æåˆ°äº†ï¼Œç¾ä¸­ä¸è¶³å°±æ˜¯è¿˜æ˜¯å†™çš„å¤ªç®€ç•¥ã€‚æœŸå¾…å‡ºç³»åˆ—æ–‡ç«  <a class=\"comment_sticker\" href=\"https://pic4.zhimg.com/v2-db92f653a2ec17ea3ff309d6d56e8507.gif\" data-sticker-id=\"980770591112015872\"> [åƒç“œ]</a>", 
                    "likes": 2, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "å†™å¾—å†ç»†å°±æˆå®˜æ–¹æ–‡æ¡£äº†ï¼Œå¼ºçƒˆæ¨èçœ‹ä¸€æ³¢å®˜æ–¹æ–‡æ¡£[æœºæ™º]", 
                            "likes": 0, 
                            "replyToAuthor": "æ—å¿—é¹"
                        }, 
                        {
                            "userName": "æ—å¿—é¹", 
                            "userLink": "https://www.zhihu.com/people/4324e37aac091e55f1054d596b41bce6", 
                            "content": "å®˜æ–¹æ–‡æ¡£æˆ‘éƒ½ç¿»çƒ‚äº†ï¼Œå¥½å¤šä¸œè¥¿æ˜¯æ²¡æœ‰çš„ï¼Œåªèƒ½æ‰¾å„ç§æ’ä»¶çœ‹æºç è¿™æ ·å­æ‰èƒ½ç»´æŒçš„äº†ç”Ÿæ´»è¿™æ ·å­", 
                            "likes": 0, 
                            "replyToAuthor": "æ›‰å®¸"
                        }
                    ]
                }, 
                {
                    "userName": "çŸ¥ä¹ç”¨æˆ·", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "è¿™ä¹ˆå¤æ‚è¿˜ç®€å•ï¼Ÿæ²¡æœ‰å¬é”™å§", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "æ˜¯ä¸ç®€å•ï¼Œæ‰€ä»¥æ‰æµ…å°å•Šã€‚ä¸‡äº‹æ— ä»–ï¼Œå”¯æ‰‹ç†Ÿå°”ã€‚å¤šçœ‹æ–‡æ¡£å°±å¥½äº†[çœ‹çœ‹ä½ ]", 
                            "likes": 0, 
                            "replyToAuthor": "çŸ¥ä¹ç”¨æˆ·"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/65270400", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 0, 
            "title": "å¾ªåºæ¸è¿›ä¹‹å¼‚æ­¥ç¼–ç¨‹ï¼ˆä¸‰ï¼‰", 
            "content": "<h2>å›é¡¾</h2><p>æ‰€è°“çš„å¼‚æ­¥ï¼Œå°±æ˜¯ç¨‹åºçš„ä¸€éƒ¨åˆ†ç°åœ¨è¿›è¡Œï¼Œè€Œå¦ä¸€éƒ¨åˆ†åˆ™åœ¨å°†æ¥è¿è¡Œã€‚å¼‚æ­¥å¤„ç†çš„é‡ç‚¹å°±æ˜¯å¦‚ä½•å¤„ç†å°†æ¥è¿è¡Œçš„é‚£ä¸€éƒ¨åˆ†ã€‚</p><p>å›è°ƒæ˜¯ <b>JavaScript</b> ä¸­æœ€åŸºæœ¬çš„å¼‚æ­¥æ¨¡å¼ï¼Œå°±æ˜¯äº‹å…ˆçº¦å®šå¥½å°†æ¥è¦åšçš„äº‹ç„¶åå›å¤´è°ƒç”¨ã€‚ç®€å•ç›´æ¥ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸ä¿¡ä»»ã€è°ƒç”¨åµŒå¥—è¿‡æ·±ç­‰é—®é¢˜ã€‚å¯¹äºç¼–å†™ä»£ç ã€ç»´æŠ¤ä»£ç çš„æˆ‘ä»¬è€Œè¨€ï¼Œäººç±»çš„å¤§è„‘è¿˜æ˜¯ä¹ æƒ¯äºçº¿æ€§çš„å¤„ç†æ–¹å¼ã€‚</p><p>åŸºäºå›è°ƒçš„å¼‚æ­¥æ¨¡å¼æ‰€å­˜åœ¨çš„é—®é¢˜ä¿ƒä½¿ç€æˆ‘ä»¬å¯»æ±‚ä¸€ç§æœºåˆ¶æ¥ä¿è¯å›è°ƒçš„å¯ä¿¡ä»»ï¼ŒåŒæ—¶èƒ½æ›´å¥½çš„è¡¨è¾¾å¼‚æ­¥ã€‚è¿™æ—¶å€™ <b>Promise</b> å‡ºç°äº†ï¼Œ<b>Promise</b> çš„å‡ºç°ï¼Œå¹¶éè¦å–ä»£å›è°ƒã€‚è€Œæ˜¯æŠŠå›è°ƒè½¬äº¤ç»™äº†ä¸€ä¸ªä½äºæˆ‘ä»¬å’Œå…¶å®ƒå·¥å…·ä¹‹é—´çš„å¯ä¿¡ä»»çš„ä¸­ä»‹æœºåˆ¶ã€‚<b>Promise</b> é“¾ä¹Ÿæä¾›ï¼ˆå°½ç®¡å¹¶ä¸å®Œç¾ï¼‰ä»¥é¡ºåºçš„æ–¹å¼è¡¨è¾¾å¼‚æ­¥æµçš„ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬çš„å¤§è„‘æ›´å¥½åœ°è®¡åˆ’å’Œç»´æŠ¤å¼‚æ­¥ <b>JavaScript</b> ä»£ç ã€‚</p><h2>ç”Ÿæˆå™¨</h2><blockquote><b>Promise</b> è™½ç„¶æœ‰åºã€å¯é åœ°ç®¡ç†å›è°ƒï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›å¦‚åŒæ­¥èˆ¬è¡¨è¾¾å¼‚æ­¥ã€‚</blockquote><p>æˆ‘ä»¬å·²ç»çŸ¥é“ç”Ÿæˆå™¨æ˜¯ä½œä¸ºç”Ÿäº§è¿­ä»£å™¨çš„å·¥å‚å‡½æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜è¦çŸ¥é“ç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿã€‚</p><h3>ä¸ºä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨</h3><p>åœ¨ç”Ÿæˆå™¨å‡ºç°ä¹‹å‰ï¼Œç¨‹åºä»£ç ä¸€æ—¦æ‰§è¡Œï¼Œå°±æ²¡æœ‰åœä¸‹æ¥çš„æ—¶å€™ï¼Œç›´åˆ°ç¨‹åºç»“æŸğŸ”šã€‚ç„¶è€Œåœ¨ç”Ÿæˆå™¨é‡Œä»£ç æ˜¯å¯ä»¥æš‚åœçš„ï¼Œè€Œä¸”è¿˜å¯ä»¥å’Œç”Ÿæˆå™¨ä¹‹å¤–é€šä¿¡â˜ï¸ï¼Œé€šä¿¡ç»“æŸååˆå¯ä»¥æ¢å¤æ‰§è¡Œã€‚å›æƒ³ä¸€ä¸‹ä¹‹å‰çš„å¼‚æ­¥æµç¨‹æ§åˆ¶ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨æƒ³æ–¹è®¾æ³•ä½¿å¾—å¼‚æ­¥ä»»åŠ¡èƒ½å¤ŸåŒæ­¥è¡¨è¾¾ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç”Ÿæˆå™¨æ¥å®ç°è¿™ä¸€æƒ³æ³•ğŸ’¡ã€‚</p><p>äº†è§£äº†ç”Ÿæˆå™¨çš„ç‰¹æ€§ä¹‹åï¼Œæˆ‘ä»¬å°±åº”è¯¥çŸ¥é“ï¼Œå½“ç”Ÿæˆå™¨åœ¨æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œå®Œå…¨å¯ä»¥æŠŠå¼‚æ­¥ä»»åŠ¡æ”¾åœ¨ç”Ÿæˆå™¨å¤–éƒ¨æ‰§è¡Œï¼Œå¾…å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸåå†è¿”å›ğŸ”™ç”Ÿæˆå™¨æ¢å¤æ‰§è¡Œã€‚è¦çŸ¥é“ï¼Œç”Ÿæˆå™¨æš‚åœçš„åªæ˜¯å†…éƒ¨çš„çŠ¶æ€ï¼Œç¨‹åºçš„å…¶ä½™éƒ¨åˆ†è¿˜æ˜¯æ­£å¸¸è¿è¡Œçš„ã€‚è¿™æ ·çš„è¯ï¼Œç”Ÿæˆå™¨å†…éƒ¨çš„æ‰€æœ‰ä»£ç çœ‹èµ·æ¥éƒ½æ˜¯åŒæ­¥è¡¨è¾¾äº†ã€‚</p><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿè¦æ³¨æ„åˆ°ï¼Œç”Ÿæˆå™¨ä¸è¿‡æ˜¯ä¸€ç§æ–°ğŸ†•çš„è¡¨è¾¾æ–¹å¼ï¼Œå’Œå¼‚æ­¥è¿˜æ˜¯åŒæ­¥æ²¡æœ‰åŠæ¯›é’±ğŸ’°å…³ç³»ã€‚æ—¢ç„¶æ²¡æœ‰å…³ç³»ï¼Œé‚£åœ¨å¼‚æ­¥æ¨¡å¼é€‰æ‹©ä¸Šå°±æ›´æ— æ‰€è°“äº†ã€‚è€ƒè™‘åˆ°å¼‚æ­¥ç³»åˆ—æ–‡ç« æ˜¯æ¸è¿›å¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨ <code>Promise + ç”Ÿæˆå™¨</code> æ¨¡å¼æ¥è¡¨è¾¾å¼‚æ­¥ã€‚</p><h3>ç”Ÿæˆå™¨ä¸Promiseçš„ç»“åˆ</h3><p>åœ¨å¼‚æ­¥æµç¨‹æ§åˆ¶æ–¹é¢ï¼Œç”Ÿæˆå™¨æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ã€‚ä¸€éƒ¨åˆ†æ˜¯ç”Ÿæˆå™¨å†…éƒ¨ä»£ç ä»¥åŒæ­¥çš„æ–¹å¼è¡¨è¾¾ä»»åŠ¡ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ç”±ç”Ÿæˆå™¨ç”Ÿæˆçš„è¿­ä»£å™¨å¤„ç†å¼‚æ­¥ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"kr\">async</span> <span class=\"o\">=</span> <span class=\"nx\">n</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nb\">Promise</span><span class=\"p\">(</span><span class=\"nx\">resolve</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"nx\">setTimeout</span><span class=\"p\">(()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n            <span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"sb\">`ç¬¬</span><span class=\"si\">${</span><span class=\"nx\">n</span><span class=\"si\">}</span><span class=\"sb\">ä¸ªå¼‚æ­¥ä»»åŠ¡`</span><span class=\"p\">)</span>\n        <span class=\"p\">},</span> <span class=\"mi\">0</span><span class=\"p\">);</span>\n    <span class=\"p\">})</span>\n<span class=\"p\">};</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">generator</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"o\">*</span><span class=\"nx\">generator</span><span class=\"p\">(){</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_1</span> <span class=\"o\">=</span> <span class=\"k\">yield</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_2</span> <span class=\"o\">=</span> <span class=\"k\">yield</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_3</span> <span class=\"o\">=</span> <span class=\"k\">yield</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">);</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;response_1: %s;response_2: %s;response_3: %s;&#39;</span><span class=\"p\">,</span><span class=\"nx\">response_1</span><span class=\"p\">,</span><span class=\"nx\">response_2</span><span class=\"p\">,</span><span class=\"nx\">response_3</span><span class=\"p\">);</span>\n<span class=\"p\">};</span>\n\n<span class=\"k\">const</span> <span class=\"nx\">gen</span> <span class=\"o\">=</span> <span class=\"nx\">generator</span><span class=\"p\">();</span>\n<span class=\"k\">const</span> <span class=\"nx\">gen_1</span> <span class=\"o\">=</span> <span class=\"nx\">generator</span><span class=\"p\">();</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;gen_next_1: %s; gen_next_2: %s; gen_next_3: %s;&#39;</span><span class=\"p\">,</span> <span class=\"nx\">gen_1</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">().</span><span class=\"nx\">value</span><span class=\"p\">,</span> <span class=\"nx\">gen_1</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">().</span><span class=\"nx\">value</span><span class=\"p\">,</span> <span class=\"nx\">gen_1</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">().</span><span class=\"nx\">value</span><span class=\"p\">);</span>\n<span class=\"nx\">gen</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">().</span><span class=\"nx\">value</span><span class=\"p\">.</span><span class=\"nx\">then</span><span class=\"p\">(</span><span class=\"nx\">yield_1</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;yield_1: %s;&#39;</span><span class=\"p\">,</span> <span class=\"nx\">yield_1</span><span class=\"p\">);</span>\n    <span class=\"k\">return</span> <span class=\"nx\">gen</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">(</span><span class=\"nx\">yield_1</span><span class=\"p\">).</span><span class=\"nx\">value</span><span class=\"p\">.</span><span class=\"nx\">then</span><span class=\"p\">(</span><span class=\"nx\">yield_2</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;yield_2: %s;&#39;</span><span class=\"p\">,</span> <span class=\"nx\">yield_2</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"nx\">gen</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">(</span><span class=\"nx\">yield_2</span><span class=\"p\">).</span><span class=\"nx\">value</span><span class=\"p\">.</span><span class=\"nx\">then</span><span class=\"p\">(</span><span class=\"nx\">yield_3</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n            <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;yield_3: %s&#39;</span><span class=\"p\">,</span> <span class=\"nx\">yield_3</span><span class=\"p\">);</span>\n            <span class=\"k\">return</span> <span class=\"nx\">gen</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">(</span><span class=\"nx\">yield_3</span><span class=\"p\">);</span>\n        <span class=\"p\">})</span>\n    <span class=\"p\">})</span>\n<span class=\"p\">});</span>\n\n<span class=\"c1\">// gen_next_1: [object Promise]; gen_next_2: [object Promise]; gen_next_3: [object Promise];\n</span><span class=\"c1\">// yield_1: ç¬¬1ä¸ªå¼‚æ­¥ä»»åŠ¡;\n</span><span class=\"c1\">// yield_2: ç¬¬2ä¸ªå¼‚æ­¥ä»»åŠ¡;\n</span><span class=\"c1\">// yield_3: ç¬¬3ä¸ªå¼‚æ­¥ä»»åŠ¡\n</span><span class=\"c1\">// response_1: ç¬¬1ä¸ªå¼‚æ­¥ä»»åŠ¡;response_2: ç¬¬2ä¸ªå¼‚æ­¥ä»»åŠ¡;response_3: ç¬¬3ä¸ªå¼‚æ­¥ä»»åŠ¡;\n</span></code></pre></div><p>å¦‚æœåªçœ‹ <b>generator</b> å‡½æ•°è¿™å—ï¼Œå‡½æ•°å†…éƒ¨çš„å†™æ³•å’ŒåŒæ­¥æ— å¼‚ã€‚<b>gen</b> å’Œ <b>gen_1</b> éƒ½æ˜¯åŒä¸€ç”Ÿæˆå™¨çš„å®ä¾‹ã€‚</p><p>å¦‚å‰æ–‡æ‰€è¿°ï¼Œç†è§£è¿™å—ä»£ç è¿˜æ˜¯è¦ä»ä¸¤æ–¹é¢å…¥æ‰‹ â€”â€”â€”â€” è¿­ä»£å’Œæ¶ˆæ¯ä¼ é€’ã€‚è¿­ä»£å±æ€§åœ¨æ­¤ä¸å†èµ˜è¿°ï¼Œç°åœ¨é‡ç‚¹æ˜¯æ¶ˆæ¯ä¼ é€’çš„å±æ€§ã€‚åœ¨ç”Ÿæˆå™¨ä¸­ï¼Œç”Ÿæˆå™¨å‡½æ•°è¢«è°ƒç”¨åå¹¶æœªç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ„é€ äº†ä¸€ä¸ªè¿­ä»£å™¨ã€‚è€Œç”Ÿæˆå™¨æ­£æ˜¯é ç€ <code>yield/next</code> æ¥å®Œæˆç”Ÿæˆå™¨å†…å¤–éƒ¨çš„åŒå‘é€šä¿¡ã€‚</p><p>åœ¨ç”Ÿæˆå™¨å†…éƒ¨ï¼Œ<b>yield</b> æ˜¯ç”¨æ¥æš‚åœï¼ˆå®Œå…¨ä¿æŒå…¶çŠ¶æ€ï¼‰å’Œå‘å¤–éƒ¨ä¼ é€’æ•°æ®çš„å…³é”®å­—/è¡¨è¾¾å¼ï¼ˆåˆå§‹æ—¶å‡½æ•°ä¹Ÿæ˜¯å¤„äºæœªæ‰§è¡ŒçŠ¶æ€ï¼‰ã€‚åœ¨ç”Ÿæˆå™¨å¤–éƒ¨ï¼Œnext å…·æœ‰æ¢å¤ç”Ÿæˆå™¨å’Œå‘ç”Ÿæˆå™¨å†…éƒ¨ä¼ é€’æ•°æ®çš„èƒ½åŠ›ã€‚</p><p>æ··æ²Œåˆå§‹ï¼ˆ<code>gen</code> é€ å‡ºæ¥äº†ï¼‰ï¼Œç›˜å¤å¼€å¤©è¾Ÿåœ°ï¼ˆç¬¬ä¸€ä¸ª <code>next()</code> æ‰§è¡Œï¼‰ï¼Œå¤©åœ°åˆæˆï¼Œç»§å¥³å¨²é€ äººåï¼Œä¸€åˆ‡æ¬£æ¬£å‘è£ã€‚å…±å·¥å’Œç¥èä¸¤ä¸ªè°ƒçš®è›‹æ’åäº†ä¸å‘¨å±±ï¼Œç»™å¥³å¨²å‡ºäº†ä¸€ä¸ªéš¾é¢˜ï¼ˆ<code>yield</code>ï¼‰ï¼Œåå¤å²é©»æ­¤ä¸å‰ã€‚å¥³å¨²å‘ä¸Šå¤©æ±‚åŠ©ï¼ˆ<code>yield async(1)</code>ï¼‰ï¼Œä¸Šå¤©å›åº”äº†å¹¶é€æ¥äº†äº”å½©çŸ³ï¼ˆ<code>yield_1</code>ï¼‰,å¥³å¨²é¡ºåˆ©è¡¥å¤©ï¼Œåå¤å²å†æ¬¡å¯ç¨‹ï¼ˆ<code>next(yield_1)</code>ï¼‰ã€‚</p><p>ç„¶è€Œå¥½æ™¯ä¸é•¿ï¼Œåå¤éƒ¨è½ç»å¸¸å—åˆ°èš©å°¤éƒ¨è½éªšæ‰°ä¾µçŠ¯ï¼Œèš©å°¤çš„å­˜åœ¨å†æ¬¡é˜»ç¢äº†åå¤å²çš„å‰è¡Œï¼ˆ<code>yield</code>ï¼‰ã€‚é»„å¸æ— å¥ˆå‘å…¶å¸ˆæ±‚åŠ©ï¼ˆ<code>yield async(2)</code>ï¼‰ï¼Œä¹å¤©ç„å¥³æˆå…¶å…µæ³•ï¼ˆ<code>yield_2</code>ï¼‰,é»„å¸é¡ºåˆ©æ€èš©å°¤ï¼Œåå¤å²å†æ¬¡å¯ç¨‹ï¼ˆ<code>next(yield_2)</code>ï¼‰ã€‚</p><p>ç„¶è€Œå¥½æ™¯ä¸é•¿ï¼Œä¸­åŸåœ°å¸¦æ´ªæ°´æ³›æ»¥ï¼Œåå¤å²å†æ¬¡å—é˜»ï¼ˆ<code>yield</code>ï¼‰ã€‚å¤ç¦¹æ— å¥ˆå‘å¤ªä¸Šè€å›æ±‚åŠ©ï¼ˆ<code>yield async(3)</code>ï¼‰,å¤ªä¸Šè€å›èµ å…¶ç¥é“ï¼ˆ<code>yield_3</code>ï¼‰,å¤ç¦¹é¡ºåˆ©æ²»æ°´ï¼Œåå¤å²å†æ¬¡å¯ç¨‹ï¼ˆ<code>next (yield_3)</code>ï¼‰ã€‚</p><p>å®åœ¨ç¼–ä¸ä¸‹å»äº†ï¼Œè¿˜å¥½ç»“æŸäº†ã€‚ğŸ˜“ ä»£ç è¿è¡Œè¿‡ç¨‹å¤§æŠµå¦‚æ­¤ã€‚ç”Ÿæˆå™¨å†…éƒ¨ç”Ÿæˆä¸€ä¸ªæ•°æ®ï¼Œç„¶åæŠ›ç»™è¿­ä»£å™¨æ¶ˆè´¹ï¼Œè¿­ä»£å™¨åˆæŠŠæ‰§è¡Œç»“æœç”©ç»™äº†ç”Ÿæˆå™¨ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œåˆ«æƒ³çš„å¤ªå¤æ‚å°±è¡Œã€‚</p><p>æ‰€è°“çš„æ¶ˆæ¯åŒå‘ä¼ é€’ï¼ŒæŒ‡çš„ä¸ä»…ä»…æ˜¯æ­£å¸¸æƒ…å†µä¸‹ç”Ÿæˆå™¨å†…å¤–éƒ¨çš„æ•°æ®ã€‚å¯¹äºå¼‚å¸¸é”™è¯¯ï¼Œç”Ÿæˆå™¨å†…å¤–éƒ¨ä¹Ÿå¯ä»¥åŒå‘æ•æ‰ã€‚å› ä¸ºç”Ÿæˆå™¨å†…éƒ¨çš„æš‚åœï¼Œæ˜¯ä¿ç•™äº†å…¶ä¸Šä¸‹æ–‡çš„ï¼Œæ‰€ä»¥ <code>try...catch</code> åˆå¯ä»¥ä¸€å±•èº«æ‰‹äº†ã€‚</p><h2>ç”Ÿæˆå™¨è‡ªæ‰§è¡Œ &amp; async/await</h2><p><code>Promise + ç”Ÿæˆå™¨</code> æ¥è¡¨è¾¾å¼‚æ­¥ç®—æ˜¯å®ç°äº†ï¼Œç„¶è€Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æ³¨æ„åˆ°åœ¨ç”¨è¿­ä»£å™¨æ§åˆ¶ç”Ÿæˆå™¨çš„é‚£éƒ¨åˆ†å¤ªè¿‡ç¹çã€‚ å¦‚æœèƒ½å¤Ÿå°è£…ä¸‹å°±å¥½äº†ï¼Œ å¦‚ä¸‹ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">generator_wrap</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">generator</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"nx\">args</span> <span class=\"o\">=</span> <span class=\"p\">[...</span><span class=\"nx\">arguments</span><span class=\"p\">].</span><span class=\"nx\">slice</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">gen</span> <span class=\"o\">=</span> <span class=\"nx\">generator</span><span class=\"p\">.</span><span class=\"nx\">apply</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">args</span><span class=\"p\">);</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nb\">Promise</span><span class=\"p\">((</span><span class=\"nx\">resolve</span><span class=\"p\">,</span> <span class=\"nx\">reject</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n        <span class=\"k\">const</span> <span class=\"nx\">handleNext</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"nx\">handleNext</span><span class=\"p\">(</span><span class=\"k\">yield</span><span class=\"p\">){</span>\n            <span class=\"kd\">let</span> <span class=\"nx\">next</span><span class=\"p\">;</span>\n            <span class=\"k\">try</span> <span class=\"p\">{</span>\n                <span class=\"nx\">next</span> <span class=\"o\">=</span> <span class=\"nx\">gen</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">(</span><span class=\"k\">yield</span><span class=\"p\">);</span>\n            <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n                <span class=\"nx\">reject</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">)</span>\n            <span class=\"p\">}</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">next</span><span class=\"p\">.</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n                <span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">next</span><span class=\"p\">.</span><span class=\"nx\">value</span><span class=\"p\">)</span>\n            <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n                <span class=\"k\">return</span> <span class=\"nb\">Promise</span><span class=\"p\">.</span><span class=\"nx\">resolve</span><span class=\"p\">(</span><span class=\"nx\">next</span><span class=\"p\">.</span><span class=\"nx\">value</span><span class=\"p\">).</span><span class=\"nx\">then</span><span class=\"p\">(</span><span class=\"k\">yield</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n                    <span class=\"nx\">handleNext</span><span class=\"p\">(</span><span class=\"k\">yield</span><span class=\"p\">);</span>\n                <span class=\"p\">},</span> <span class=\"nx\">error</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n                    <span class=\"nx\">gen</span><span class=\"p\">.</span><span class=\"k\">throw</span><span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"p\">);</span>\n                <span class=\"p\">})</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">};</span>\n        <span class=\"nx\">handleNext</span><span class=\"p\">();</span>\n    <span class=\"p\">})</span>\n<span class=\"p\">};</span>\n<span class=\"c1\">// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” æ‰‹åŠ¨åˆ†å‰²çº¿ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">generator</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"o\">*</span><span class=\"nx\">generator</span><span class=\"p\">(){</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_1</span> <span class=\"o\">=</span> <span class=\"k\">yield</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_2</span> <span class=\"o\">=</span> <span class=\"k\">yield</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_3</span> <span class=\"o\">=</span> <span class=\"k\">yield</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">);</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;response_1: %s;response_2: %s;response_3: %s;&#39;</span><span class=\"p\">,</span><span class=\"nx\">response_1</span><span class=\"p\">,</span><span class=\"nx\">response_2</span><span class=\"p\">,</span><span class=\"nx\">response_3</span><span class=\"p\">);</span>\n<span class=\"p\">};</span>\n\n<span class=\"nx\">generator_wrap</span><span class=\"p\">(</span><span class=\"nx\">generator</span><span class=\"p\">);</span>\n<span class=\"c1\">// response_1: ç¬¬1ä¸ªå¼‚æ­¥ä»»åŠ¡;response_2: ç¬¬2ä¸ªå¼‚æ­¥ä»»åŠ¡;response_3: ç¬¬3ä¸ªå¼‚æ­¥ä»»åŠ¡;\n</span></code></pre></div><p>ä¸çœ‹ <b>generator_wrap</b> å‡½æ•°ï¼Œåªçœ‹åˆ†å‰²çº¿ä»¥ä¸‹çš„éƒ¨åˆ†ã€‚è‡³æ­¤ï¼Œå¼‚æ­¥æµç¨‹çš„è¡¨è¾¾è¶Šæ¥è¶Šæ¥è¿‘ç†æƒ³ä¸­çš„æ¨¡æ ·äº†ã€‚ä½† <b>generator_wrap</b> å‡½æ•°è¿˜æ˜¯éœ€è¦è‡ªå·±æ‰‹åŠ¨å°è£…ï¼Œä¸è¿‡ç°åœ¨ä¸ç”¨å•¦ğŸ˜„</p><p><b>ES2017</b> æ¨å‡ºäº† <code>async/await</code> ï¼Œæˆ‘ä»¬ä¸ç”¨å†è‡ªå·±å»ç®¡ç†ç”Ÿæˆå™¨ï¼Œç®€å•ã€å¼ºå¤§ã€æ–¹ä¾¿çš„ <code>async/await</code> ä¸ºæˆ‘ä»¬å¤„ç†äº†ä¸€åˆ‡ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">awati_async</span> <span class=\"o\">=</span> <span class=\"kr\">async</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_1</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_2</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n    <span class=\"k\">const</span> <span class=\"nx\">response_3</span> <span class=\"o\">=</span> <span class=\"kr\">await</span> <span class=\"kr\">async</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">);</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;response_1: %s;response_2: %s;response_3: %s;&#39;</span><span class=\"p\">,</span> <span class=\"nx\">response_1</span><span class=\"p\">,</span> <span class=\"nx\">response_2</span><span class=\"p\">,</span> <span class=\"nx\">response_3</span><span class=\"p\">);</span>\n<span class=\"p\">};</span>\n\n<span class=\"nx\">awati_async</span><span class=\"p\">();</span>\n<span class=\"c1\">// response_1: ç¬¬1ä¸ªå¼‚æ­¥ä»»åŠ¡;response_2: ç¬¬2ä¸ªå¼‚æ­¥ä»»åŠ¡;response_3: ç¬¬3ä¸ªå¼‚æ­¥ä»»åŠ¡;\n</span></code></pre></div><p>è‡³æ­¤ï¼Œå…³äº JavaScript çš„å¼‚æ­¥è¡¨è¾¾æš‚æ—¶å‘Šä¸€æ®µè½äº†ğŸ‘‹ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href=\"https://link.zhihu.com/?target=https%3A//developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Iterators_and_Generators\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è¿­ä»£å™¨å’Œç”Ÿæˆå™¨</a></p><p><a href=\"https://link.zhihu.com/?target=https%3A//www.kancloud.cn/kancloud/you-dont-know-js-async-performance\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä½ ä¸çŸ¥é“çš„ JavaScript ï¼ˆä¸­å·ï¼‰</a></p><p><a href=\"https://link.zhihu.com/?target=https%3A//www.kancloud.cn/kancloud/you-dont-know-js-es6-beyond\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä½ ä¸çŸ¥é“çš„ JavaScript ï¼ˆä¸‹å·ï¼‰</a></p><p><a href=\"https://link.zhihu.com/?target=http%3A//es6.ruanyifeng.com/%23docs/generator-async\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Generator å‡½æ•°çš„å¼‚æ­¥åº”ç”¨</a></p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å…¥é—¨", 
                    "tagLink": "https://api.zhihu.com/topics/19590813"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/64315406", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 5, 
            "title": "ä»è¿­ä»£å™¨æ¨¡å¼åˆ°è¿­ä»£åè®®", 
            "content": "<h2>è¿­ä»£å™¨æ¨¡å¼</h2><p>è¿­ä»£å™¨æ¨¡å¼æ˜¯æŒ‡æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p><p>è¿­ä»£å™¨åˆ†ä¸ºå†…éƒ¨è¿­ä»£å™¨å’Œå¤–éƒ¨è¿­ä»£å™¨ã€‚å†…éƒ¨è¿­ä»£å™¨åªéœ€ä¸€æ¬¡åˆå§‹è°ƒç”¨ï¼Œè€Œå¤–éƒ¨è¿­ä»£å™¨å¿…é¡»æ˜¾å¼åœ°è¯·æ±‚è¿­ä»£ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨æ§åˆ¶è¿­ä»£è¿‡ç¨‹ã€‚</p><p>å®ç°ä¸€ä¸ªå†…éƒ¨è¿­ä»£å™¨ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Array</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">innerIterator</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">callback</span><span class=\"p\">){</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"nx\">len</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">len</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">callback</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">callback</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">],</span> <span class=\"k\">this</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">],</span> <span class=\"nx\">i</span><span class=\"p\">)</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">};</span>\n<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">].</span><span class=\"nx\">innerIterator</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">item</span><span class=\"p\">,</span> <span class=\"nx\">index</span><span class=\"p\">){</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;item:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">item</span><span class=\"p\">,</span> <span class=\"s1\">&#39;index:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">index</span><span class=\"p\">)</span>\n<span class=\"p\">})</span>\n<span class=\"c1\">// item: 1 index: 0\n</span><span class=\"c1\">// item: 2 index: 1\n</span><span class=\"c1\">// item: 3 index: 2\n</span></code></pre></div><p>å®ç°ä¸€ä¸ªå¤–éƒ¨è¿­ä»£å™¨ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Array</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">outerInterator</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">index</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span>\n            <span class=\"nx\">next</span><span class=\"o\">:</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n                <span class=\"k\">return</span> <span class=\"nx\">index</span> <span class=\"o\">&lt;</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">?</span>\n                <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"k\">this</span><span class=\"p\">[</span><span class=\"nx\">index</span><span class=\"o\">++</span><span class=\"p\">],</span> <span class=\"nx\">done</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span><span class=\"o\">:</span>\n                <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"kc\">undefined</span><span class=\"p\">,</span> <span class=\"nx\">done</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">}</span>\n            <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">iterator</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">].</span><span class=\"nx\">outerInterator</span><span class=\"p\">();</span>\n\n<span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">next</span><span class=\"p\">;</span> <span class=\"p\">(</span><span class=\"nx\">next</span> <span class=\"o\">=</span> <span class=\"nx\">iterator</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">())</span> <span class=\"o\">&amp;&amp;</span> <span class=\"o\">!</span><span class=\"nx\">next</span><span class=\"p\">.</span><span class=\"nx\">done</span><span class=\"p\">;)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;item&#39;</span><span class=\"p\">,</span> <span class=\"nx\">next</span><span class=\"p\">.</span><span class=\"nx\">value</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// item 1\n</span><span class=\"c1\">// item 2\n</span><span class=\"c1\">// item 3\n</span></code></pre></div><h2>è¿­ä»£åè®®</h2><p>äº†è§£äº†è¿­ä»£å™¨æ¨¡å¼ï¼Œå†æ¥çœ‹çœ‹ ES6 ä¸­è¡¥å……çš„è¿­ä»£åè®®ã€‚å¯è¿­ä»£ï¼ˆiterableï¼‰åè®®å’Œè¿­ä»£å™¨ï¼ˆiteratorï¼‰åè®®ã€‚</p><p>å¯è¿­ä»£åè®®ï¼š</p><p>ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆæˆ–å…¶åŸå‹ä¸Šï¼‰ï¼Œå¿…é¡»æœ‰ä¸€ä¸ª <code>Symbol.iterator</code> çš„å±æ€§ï¼Œè¯¥å±æ€§æ‰€å¯¹åº”çš„å€¼ä¸ºè¿”å›ä¸€ä¸ªå¯¹è±¡çš„æ— åƒå‡½æ•°ï¼Œè¢«è¿”å›å¯¹è±¡ç¬¦åˆè¿­ä»£å™¨åè®®ã€‚å½“å¯è¿­ä»£å¯¹è±¡éœ€è¦è¿­ä»£æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><p>ä¸€äº›æ•°æ®ç±»å‹å†…ç½®äº† <code>@@iterator</code> æ–¹æ³•ï¼Œæœ‰è‡ªå·±é»˜è®¤çš„è¿­ä»£è¡Œä¸ºã€‚ï¼ˆ<b>String</b>, <b>Array</b>, <b>TypedArray</b>, <b>Map</b> , <b>Set</b> ç­‰éƒ½æ˜¯å†…ç½®å¯è¿­ä»£å¯¹è±¡ï¼Œ å› ä¸ºå®ƒä»¬çš„åŸå‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>@@iterator</code> æ–¹æ³•.ï¼‰ï¼ˆ<i><code>[Symbol.iterator]</code>ã€<code>@@iterator</code></i> <i>å¯ä»¥è®¤ä¸ºæ˜¯ä¸€å›äº‹</i>ï¼‰</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">iterator</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hi&#39;</span><span class=\"p\">)[</span><span class=\"nx\">Symbol</span><span class=\"p\">.</span><span class=\"nx\">iterator</span><span class=\"p\">]()</span>\n<span class=\"kd\">var</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"nx\">iterator</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">();</span>\n<span class=\"c1\">// a { value: &#39;h&#39;, done: false }\n</span></code></pre></div><p>è¿­ä»£å™¨åè®®ï¼š</p><p>ä¸€ä¸ªè¿­ä»£å™¨å¿…é¡»å®ç°äº† <code>next()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡çš„æ— åƒå‡½æ•°ã€‚è¢«è¿”å›çš„å¯¹è±¡æœ‰ä¸¤ä¸ªå¿…è¦çš„å±æ€§ï¼šdone å’Œ valueã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Array</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">Iteration</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">index</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span>\n            <span class=\"p\">[</span><span class=\"nx\">Symbol</span><span class=\"p\">.</span><span class=\"nx\">iterator</span><span class=\"p\">](){</span><span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">},</span>\n            <span class=\"nx\">next</span><span class=\"o\">:</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n                <span class=\"k\">return</span> <span class=\"nx\">index</span> <span class=\"o\">&lt;</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">?</span>\n                <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"k\">this</span><span class=\"p\">[</span><span class=\"nx\">index</span><span class=\"o\">++</span><span class=\"p\">],</span> <span class=\"nx\">done</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span><span class=\"o\">:</span>\n                <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"kc\">undefined</span><span class=\"p\">,</span> <span class=\"nx\">done</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">}</span>\n            <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">};</span>\n<span class=\"kd\">let</span> <span class=\"nx\">Iteration</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">].</span><span class=\"nx\">Iteration</span><span class=\"p\">();</span>\n<span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">value</span> <span class=\"k\">of</span> <span class=\"nx\">Iteration</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// value 2\n</span><span class=\"c1\">// value 3\n</span><span class=\"c1\">// value 4\n</span></code></pre></div><p>ä¸èƒ½å‘ç°ï¼ŒIteration åŒæ—¶æ»¡è¶³å¯è¿­ä»£åè®®å’Œè¿­ä»£åè®®ã€‚åˆå› ä¸ºæ˜¯å¯è¿­ä»£çš„ï¼Œ<code>for...of</code> æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªå’Œå¤–éƒ¨è¿­ä»£å™¨ååˆ†ç›¸ä¼¼ã€‚</p><p>ä¸€æ—¦ä¸€ç§æ•°æ®ç»“æ„æœ‰äº† <code>@@iterator</code> æ–¹æ³•åï¼Œ å°±è®¤ä¸ºæ˜¯å¯è¿­ä»£çš„ã€‚ES6 ä¸­è®¸å¤šæ–°çš„æ–¹æ³•å°±æ˜¯åŸºäºæ­¤çš„ <code>è§£æ„èµ‹å€¼</code>ã€<code>æ‰©å±•è¿ç®—ç¬¦</code>ã€<code>yield*</code>ï¼Œè¿˜æœ‰ <code>for..of</code>ã€<code>Array.from()</code>ç­‰ã€‚</p><p>çŸ¥é“äº†ä»¥ä¸ŠçŸ¥è¯†ï¼Œä¹Ÿå°±çŸ¥é“äº†ä¸ºä»€ä¹ˆå¯¹è±¡ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>for...of</code> äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡åŸå‹ä¸Šæ·»åŠ  <code>@@iterator</code> æ–¹æ³•ï¼Œä½¿ä¹‹æˆä¸ºå¯è¿­ä»£çš„ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">Iteration</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">keys</span> <span class=\"o\">=</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">keys</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">),</span> <span class=\"nx\">index</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n        <span class=\"k\">return</span><span class=\"p\">{</span>\n            <span class=\"p\">[</span><span class=\"nx\">Symbol</span><span class=\"p\">.</span><span class=\"nx\">iterator</span><span class=\"p\">](){</span><span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">},</span>\n            <span class=\"nx\">next</span><span class=\"o\">:</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n                <span class=\"kd\">let</span> <span class=\"nx\">current</span> <span class=\"o\">=</span> <span class=\"nx\">index</span><span class=\"o\">++</span><span class=\"p\">;</span>\n                <span class=\"k\">return</span> <span class=\"nx\">current</span> <span class=\"o\">&lt;</span> <span class=\"nx\">keys</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"o\">?</span>\n                <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"nx\">keys</span><span class=\"p\">[</span><span class=\"nx\">current</span><span class=\"p\">],</span> <span class=\"k\">this</span><span class=\"p\">[</span><span class=\"nx\">keys</span><span class=\"p\">[</span><span class=\"nx\">current</span><span class=\"p\">]]],</span> <span class=\"nx\">done</span><span class=\"o\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span><span class=\"o\">:</span>\n                <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"o\">:</span> <span class=\"kc\">undefined</span><span class=\"p\">,</span> <span class=\"nx\">done</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">};</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">iterator</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;a&#39;</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;b&#39;</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;c&#39;</span><span class=\"o\">:</span> <span class=\"mi\">3</span><span class=\"p\">}.</span><span class=\"nx\">Iteration</span><span class=\"p\">();</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">]</span> <span class=\"k\">of</span> <span class=\"nx\">iterator</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;key:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// key: a value: 1\n</span><span class=\"c1\">// key: b value: 2\n</span><span class=\"c1\">// key: c value: 3\n</span></code></pre></div><h2>ç”Ÿæˆå™¨</h2><p>åƒä»¥ä¸Šçš„çš„å¯¹è±¡éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å®ç°çš„ï¼Œç¬¦åˆå¯è¿­ä»£åè®®å’Œè¿­ä»£åè®®çš„å¯¹è±¡ã€‚çœ‹èµ·æ¥å¾ˆéº»çƒ¦ï¼Œè¿˜å¥½è¿™äº›å·¥ä½œå·²ç»æœ‰å‡½æ•°æ›¿æˆ‘ä»¬åšäº†ï¼Œé‚£å°±æ˜¯ç”Ÿæˆå™¨å‡½æ•°ã€‚</p><p>ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¯ä»¥ä½œä¸ºè¿­ä»£å™¨å·¥å‚çš„å‡½æ•°ï¼Œå½“å®ƒè¢«æ‰§è¡Œæ—¶ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Generator å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç¬¦åˆå¯è¿­ä»£åè®®å’Œè¿­ä»£å™¨åè®®ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ç”¨ç”Ÿæˆå™¨å‡½æ•°ä½¿å¾—å¯¹è±¡ç¬¦åˆè¿­ä»£åè®®ï¼š</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">Iteration</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"o\">*</span><span class=\"p\">(){</span>\n    <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">]</span> <span class=\"k\">of</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">entries</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">)){</span>\n        <span class=\"k\">yield</span> <span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">]</span> <span class=\"k\">of</span> <span class=\"p\">{</span><span class=\"s1\">&#39;a&#39;</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;b&#39;</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;c&#39;</span><span class=\"o\">:</span> <span class=\"mi\">3</span><span class=\"p\">}.</span><span class=\"nx\">Iteration</span><span class=\"p\">())</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;key:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value:&#39;</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// key: a value: 1\n</span><span class=\"c1\">// key: b value: 2\n</span><span class=\"c1\">// key: c value: 3\n</span></code></pre></div><p>åœ¨è¿™é‡Œç”Ÿæˆå™¨å‡½æ•°åªæ˜¯ä½œä¸ºç”Ÿäº§è¿­ä»£å™¨çš„å·¥å‚è€Œå·²ï¼Œå…¶å®å®ƒè¿˜æ˜¯æ¶ˆæ¯åŒå‘ä¼ é€’ç³»ç»Ÿã€‚ä¹Ÿæ­£æ˜¯è¿™äº›ç‰¹æ€§çš„å­˜åœ¨ï¼Œä½¿å¾—å¼‚æ­¥æµç¨‹æ§åˆ¶åˆå‘å‰è¿ˆäº†ä¸€å¤§æ­¥ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å…¥é—¨", 
                    "tagLink": "https://api.zhihu.com/topics/19590813"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/63780333", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 4, 
            "title": "TypeScript+Reactç»ƒæ‰‹å°é¡¹ç›®", 
            "content": "<p>åœ¨å†™ <a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/%25E5%2585%25B3%25E4%25BA%258EMVC%25E6%25A8%25A1%25E5%25BC%258F%25E7%25AE%2580%25E5%258D%2595%25E4%25BB%25A3%25E7%25A0%2581%25E5%25AE%259E%25E7%258E%25B0/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">å…³äºMVCæ¨¡å¼ç®€å•ä»£ç å®ç°</a> çš„è¿‡ç¨‹ä¸­ï¼Œè§‰å¾—æœ€éº»çƒ¦çš„å°±æ˜¯æ“ä½œ DOMã€‚æ‰€ä»¥è¿™æ¬¡å‡çº§äº†ï¼Œæ‰“ç®—ç”¨ Reactã€‚ç”¨è¿‡ React çš„åŒå­¦éƒ½çŸ¥é“ï¼ŒReact åœ¨æ›´æ–°è§†å›¾æ—¶ï¼Œå¿…é¡»è¦é€šè¿‡ <code>setState</code> æ–¹å¼æ”¹å˜çŠ¶æ€ï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¯éœ€è¦æˆ‘ä»¬ä¸»åŠ¨è°ƒç”¨çš„ã€‚è€Œ Vue æ˜¯é€šè¿‡å¯¹ <code>data</code> ä¸‹çš„å˜é‡èµ‹å€¼ç›´æ¥æ›´æ–°äº†è§†å›¾ï¼ŒVue ä¹‹æ‰€ä»¥è¿™ä¹ˆç®€å•ï¼Œæ˜¯å› ä¸ºé‡‡ç”¨äº†æ•°æ®åŠ«æŒçš„æ–¹å¼ã€‚æ‰€ä»¥ï¼Œè¿™æ¬¡çš„ç›®çš„å°±æ˜¯åœ¨ React çš„åŸºç¡€ä¸Šå®ç°å’Œ Vue ç±»ä¼¼çš„æ•ˆæœã€‚</p><p><br/>å®ç°æ€è·¯å°±æ˜¯åˆ©ç”¨é«˜é˜¶ç»„ä»¶é‡Œçš„åå‘ç»§æ‰¿å¯¹åŒ…è£¹ç»„ä»¶çš„ <code>state</code> åŠ«æŒã€‚è¿™æ˜¯ä¸€ä¸ªç»ƒæ‰‹çš„å°é¡¹ç›®ï¼Œæ²¡è€ƒè™‘é‚£ä¹ˆå¤šğŸ˜‚ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆæ— èŠï¼Œé‚£æ˜¯å› ä¸ºä¹‹å‰å†™äº† <a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/%25E7%2594%25A8Type%25E9%25A9%25AF%25E5%258C%2596JavaScript/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ç”¨Typeé©¯åŒ–JavaScript</a> è¿™ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥å°±æ£é¼“å‡ºè¿™ä¹ˆä¸€ä¸ªç©æ„ã€‚</p><p><br/><b>æ‰€æœ‰ä»£ç å¯è§<a href=\"https://link.zhihu.com/?target=https%3A//github.com/yexiaochen/mvvm_react_typescript\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">github</a>ã€‚</b><br/><br/></p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-019b6d8183cb878a7ea0f4524cff5226_b.gif\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"579\" data-rawheight=\"771\" data-thumbnail=\"https://pic3.zhimg.com/v2-019b6d8183cb878a7ea0f4524cff5226_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"579\" data-original=\"https://pic3.zhimg.com/v2-019b6d8183cb878a7ea0f4524cff5226_r.jpg\"/></noscript><img src=\"data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;579&#39; height=&#39;771&#39;&gt;&lt;/svg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"579\" data-rawheight=\"771\" data-thumbnail=\"https://pic3.zhimg.com/v2-019b6d8183cb878a7ea0f4524cff5226_b.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"579\" data-original=\"https://pic3.zhimg.com/v2-019b6d8183cb878a7ea0f4524cff5226_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-019b6d8183cb878a7ea0f4524cff5226_b.gif\"/></figure><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Mvvm.tsx\n</span><span class=\"c1\"></span><span class=\"p\">......</span>\n<span class=\"k\">const</span> <span class=\"nx\">hocExtends</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">WrapperComponent</span><span class=\"o\">:</span> <span class=\"nx\">ComponentClass</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">(</span>\n <span class=\"k\">class</span> <span class=\"k\">extends</span> <span class=\"nx\">WrapperComponent</span> <span class=\"p\">{</span>\n <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">props</span><span class=\"o\">:</span> <span class=\"nx\">any</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n <span class=\"k\">super</span><span class=\"p\">(</span><span class=\"nx\">props</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n <span class=\"kd\">let</span> <span class=\"nx\">self</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">;</span>\n <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">state</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Proxy</span><span class=\"p\">({</span> <span class=\"p\">...</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">state</span> <span class=\"p\">},</span> <span class=\"p\">{</span>\n <span class=\"nx\">get</span><span class=\"o\">:</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">target</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">receiver</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n <span class=\"k\">return</span> <span class=\"nx\">Reflect</span><span class=\"p\">.</span><span class=\"nx\">get</span><span class=\"p\">(</span><span class=\"nx\">target</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">receiver</span><span class=\"p\">);</span>\n        <span class=\"p\">},</span>\n <span class=\"nx\">set</span><span class=\"o\">:</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">target</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">,</span> <span class=\"nx\">receiver</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">any</span> <span class=\"p\">{</span>\n <span class=\"nx\">self</span><span class=\"p\">.</span><span class=\"nx\">setState</span><span class=\"p\">({</span>\n            <span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">]</span><span class=\"o\">:</span> <span class=\"nx\">value</span>\n          <span class=\"p\">})</span>\n <span class=\"k\">return</span> <span class=\"nx\">Reflect</span><span class=\"p\">.</span><span class=\"nx\">set</span><span class=\"p\">(</span><span class=\"nx\">target</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">,</span> <span class=\"nx\">receiver</span><span class=\"p\">);</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">})</span>\n <span class=\"k\">return</span> <span class=\"k\">super</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">()</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"p\">......</span>\n<span class=\"nx\">filterSearchStuff</span><span class=\"p\">(</span><span class=\"nx\">searchStuff</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"k\">void</span> <span class=\"p\">{</span>\n <span class=\"k\">const</span> <span class=\"p\">{</span> <span class=\"nx\">stuffData</span> <span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">state</span><span class=\"p\">;</span>\n <span class=\"kd\">let</span> <span class=\"nx\">stuffItem</span><span class=\"o\">:</span> <span class=\"nx\">IStuff</span> <span class=\"o\">=</span> <span class=\"nx\">stuffData</span><span class=\"p\">.</span><span class=\"nx\">find</span><span class=\"p\">((</span><span class=\"nx\">item</span><span class=\"o\">:</span> <span class=\"nx\">IStuff</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">stuff</span> <span class=\"o\">===</span> <span class=\"nx\">searchStuff</span><span class=\"p\">)</span>\n <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">state</span><span class=\"p\">.</span><span class=\"nx\">stuffItem</span> <span class=\"o\">=</span> <span class=\"nx\">stuffItem</span><span class=\"p\">;</span>\n <span class=\"c1\">// this.setState({\n</span><span class=\"c1\"></span> <span class=\"c1\">//   stuffItem\n</span><span class=\"c1\"></span> <span class=\"c1\">// })\n</span><span class=\"c1\"></span>  <span class=\"p\">}</span>\n<span class=\"p\">......</span>\n</code></pre></div><p></p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "TypeScript", 
                    "tagLink": "https://api.zhihu.com/topics/19766226"
                }, 
                {
                    "tag": "React", 
                    "tagLink": "https://api.zhihu.com/topics/20013159"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/63175443", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 5, 
            "title": "è®°ä¸ä½çš„ç»§æ‰¿æ–¹å¼", 
            "content": "<blockquote>éƒ½è¯´ç¨‹åºå‘˜æ˜¯è¿™ä¸ªä¸–ç•Œä¸Šæœ€æ‡’çš„äºº, èƒ½èººç€ç»ä¸åç€, å…¨å¹²ç€å¤åˆ¶é»è´´çš„æ´».<br/>â€˜ä»€ä¹ˆ, ä½ è¯´è¿™å¥—é€»è¾‘ä¹‹å‰å†™è¿‡?!?! é€Ÿé€ŸæŠŠä»£ç å‘ˆä¸Šæ¥!!!â€™.<br/>æœ€æ‡’çš„äººå¾€å¾€ä¿¡å¥‰ç€â€˜æ‹¿æ¥ä¸»ä¹‰â€™. è‹¥åªæ˜¯ç®€å•çš„å¤åˆ¶é»è´´, å°±ä¼šæ˜¾å¾—æ²¡æœ‰é€¼æ ¼.</blockquote><p>åœ¨ <i><b>JavaScript</b></i> ä¸­, é‡å¤ç”¨åˆ°çš„é€»è¾‘æˆ‘ä»¬ä¼šç”¨å‡½æ•°åŒ…è£…èµ·æ¥, åœ¨åˆé€‚ä¸”éœ€è¦çš„æƒ…å†µä¸‹, è°ƒç”¨è¯¥å‡½æ•°å³å¯. è€Œ <i><b>apply</b></i>, <i><b>call</b></i>, <i><b>new</b></i> ç­‰æ–¹æ³•ä¹Ÿæ‹“å®½äº†å‡½æ•°çš„ä½¿ç”¨åœºæ™¯.</p><p>é™¤äº†è¿™ç§å€Ÿæ¥çš„, æˆ‘ä»¬è¿˜æœ‰ç»§æ‰¿æ¥çš„. è¿™å°±æ˜¯å¸¸è¯´çš„åŸå‹ç»§æ‰¿. å½“å¯¹è±¡æœ¬èº«æ²¡æœ‰è¦æŸ¥è¯¢çš„å±æ€§æˆ–æ–¹æ³•æ—¶, å®ƒä¼šæ²¿ç€åŸå‹é“¾æŸ¥æ‰¾, æ‰¾åˆ°äº†å°±ä¼šæ‹¿æ¥ä½¿ç”¨. è¿™ç§&#39;æ— &#39;ä¸­ç”Ÿæœ‰çš„äº‹, ä¸å¦¨äº†è§£ä¸€ä¸‹.</p><h2>é¢„å¤‡çŸ¥è¯†</h2><ul><li>é»˜è®¤æƒ…å†µä¸‹, æ‰€æœ‰çš„åŸå‹å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª <i><b>constructor</b></i> (æ„é€ å‡½æ•°)å±æ€§, è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘ <i><b>prototype</b></i> å±æ€§æ‰€åœ¨å‡½æ•°çš„æŒ‡é’ˆ. æ„é€ å‡½æ•°çš„åŸå‹ <i><b>prototype</b></i> ä¸Š <i><b>constructor</b></i> çš„åˆå§‹å€¼æ˜¯æ„é€ å‡½æ•°æœ¬èº«. å³,</li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Function</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">===</span> <span class=\"nb\">Function</span> <span class=\"c1\">// true\n</span></code></pre></div><ul><li>ç”±æ„é€ å‡½æ•°æ„é€ å‡ºæ¥çš„å®ä¾‹æœ¬èº«æ²¡æœ‰ <i><b>constructor</b></i> å±æ€§, ä¸è¿‡å¯ä»¥é€šè¿‡åŸå‹é“¾ç»§æ‰¿è¿™ä¸ªå±æ€§.</li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// ä»¥ä¸‹personçš„constructorå±æ€§ç»§æ‰¿è‡ªPerson.prototype \n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">Person</span><span class=\"p\">()</span> <span class=\"p\">{}</span> <span class=\"nx\">Person</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">===</span> <span class=\"nx\">Person</span> <span class=\"c1\">// true \n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">person</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Person</span><span class=\"p\">();</span> <span class=\"nx\">person</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">===</span> <span class=\"nx\">Person</span> <span class=\"c1\">// true\n</span><span class=\"c1\"></span><span class=\"nx\">person</span><span class=\"p\">.</span><span class=\"nx\">hasOwnProperty</span><span class=\"p\">(</span><span class=\"s1\">&#39;constructor&#39;</span><span class=\"p\">)</span> <span class=\"o\">===</span> <span class=\"kc\">false</span> <span class=\"c1\">// true \n</span><span class=\"c1\"></span><span class=\"nx\">person_1</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">===</span> <span class=\"nx\">Person</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"c1\">// true\n</span></code></pre></div><ul><li>ç®€å•æ•°æ®ç±»å‹å’Œå¤æ‚æ•°æ®ç±»å‹èµ‹å€¼ä¼ å‚çš„åŒºåˆ«.<br/><i><b>JavaScript</b></i> ä¸­å˜é‡ä¸å¯èƒ½æˆä¸ºåªæƒ³å¦ä¸€ä¸ªå˜é‡çš„å¼•ç”¨. å¼•ç”¨æŒ‡å‘çš„æ˜¯å€¼. å¤æ‚æ•°æ®ç±»å‹çš„å¼•ç”¨æŒ‡å‘çš„éƒ½æ˜¯åŒä¸€ä¸ªå€¼.å®ƒä»¬ç›¸äº’ä¹‹é—´æ²¡æœ‰å¼•ç”¨/æŒ‡å‘å…³ç³». ä¸€æ—¦å€¼å‘ç”Ÿå˜åŒ–, æŒ‡å‘è¯¥å€¼çš„å¤šä¸ªå¼•ç”¨å°†å…±äº«è¿™ä¸ªå˜åŒ–.</li><li><i><b>new</b></i>, <i><b>apply</b></i>, <i><b>call</b></i> çš„å‡½æ•°è°ƒç”¨æ¨¡å¼.<br/>ä¸‰è€…çš„å…±åŒç‚¹éƒ½æ˜¯éƒ½æ˜¯æŒ‡å®šè°ƒç”¨å‡½æ•°çš„ <i><b>this</b></i> å€¼. è¿™ä½¿å¾—åŒä¸€ä¸ªå‡½æ•°å¯ä»¥åœ¨ä¸åŒçš„è¯­å¢ƒä¸‹æ­£ç¡®æ‰§è¡Œ. <i><b>new</b></i> æ›´ä¸ºå¤æ‚ä¸€äº›. å¯å¤§è‡´æ¨¡æ‹Ÿä¸º,</li></ul><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"k\">new</span><span class=\"p\">(</span><span class=\"nx\">constructor</span><span class=\"p\">,</span> <span class=\"nx\">arguments</span><span class=\"p\">)</span> <span class=\"p\">{</span>     \n  <span class=\"kd\">let</span> <span class=\"nx\">instance</span> <span class=\"o\">=</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">(</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">)</span> <span class=\"c1\">// å§‘ä¸”ç§°ä¹‹ä¸º new çš„ç‰¹æ€§ä¸€     \n</span><span class=\"c1\"></span>  <span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">apply</span><span class=\"p\">(</span><span class=\"nx\">instance</span><span class=\"p\">,</span> <span class=\"nx\">arguments</span><span class=\"p\">)</span>  <span class=\"c1\">// å§‘ä¸”ç§°ä¹‹ä¸º new çš„ç‰¹æ€§äºŒ     \n</span><span class=\"c1\"></span>  <span class=\"k\">return</span> <span class=\"nx\">instance</span> \n<span class=\"p\">}</span>\n</code></pre></div><blockquote>å¾ˆæ˜æ˜¾, <i><b>new</b></i> çš„æ“ä½œä¸­åŒ…æ¶µäº† <i><b>apply</b></i>, <i><b>call</b></i> è¦åšçš„äº‹. åœ¨æ­¤å¤§èƒ†çŒœæµ‹ä¸€ä¸‹, åœ¨å®ç°ç»§æ‰¿çš„è¿‡ç¨‹ä¸­, ä¸€æ—¦åŒæ—¶å‡ºç° <i><b>new</b></i> å’Œ <i><b>apply</b></i>æˆ– <i><b>call</b></i>, å°±ä¼šæœ‰é‡å¤äº¤é›†çš„å¯èƒ½, è¿™æ—¶å°±éœ€è¦æƒ³æƒ³æ˜¯å¦æœ‰å¯ä»¥æ”¹è¿›çš„åœ°æ–¹.</blockquote><h2>ä¸ç€ç—•è¿¹çš„æ‹¿æ¥ä¸»ä¹‰</h2><blockquote>&#39;å„å•ä½è¯·æ³¨æ„, ä¸‹é¢åˆ°æˆ‘è¡¨æ¼”çš„æ—¶å€™äº†&#39;<br/>&#39;ä¸Šé“å…·!&#39;</blockquote><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n<span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">()</span> <span class=\"p\">{}</span> <span class=\"c1\">// æˆ‘æ˜¯å¤´å°ç‹®å­\n</span></code></pre></div><p>æƒ³è¦æ— ä¸­ç”Ÿæœ‰, é‚£æ˜¯ä¸å¯èƒ½çš„ğŸ˜, æ‰€ä»¥æˆ‘ä»¬å‡†å¤‡äº†æ¨¡æ¿ <i><b>Animal</b></i>. <i><b>Animal</b></i> æœ‰çš„ä¸œè¥¿, <i><b>Leo</b></i> ä¹Ÿæƒ³æ‹¥æœ‰.</p><p>è€Œä¸” <i><b>Animal</b></i> èƒ½ç”¨åœ°ä¸œè¥¿ä¹ŸåŒæ ·é€‚ç”¨äº <i><b>Leo</b></i>. æ‰€ä»¥, æˆ‘ä»¬æœŸå¾… <i><b>Leo</b></i> æœ€ç»ˆé•¿æˆè¿™ä¸ªæ ·å­.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n</code></pre></div><blockquote>&#39;å°±é•¿è¿™å‰¯ç†Šæ ·!? è¿™å’Œç®€å•çš„å¤åˆ¶é»è´´æœ‰ä»€ä¹ˆåŒºåˆ«!? è¿™å’Œå’¸é±¼åˆæœ‰ä»€ä¹ˆåŒºåˆ«!ï¼Ÿ è¯´å¥½çš„é€¼æ ¼å‘¢ï¼ï¼Ÿ&#39;</blockquote><p>è§‚å¯Ÿä¸€ä¸‹ <i><b>Leo</b></i>, <i><b>Leo</b></i> æ„é€ å‡½æ•°å†…éƒ¨é€»è¾‘å’Œ <i><b>Animal</b></i> æ„é€ å‡½æ•°çš„å†…éƒ¨é€»è¾‘å¦‚å‡ºä¸€è¾™. æ—¢ç„¶éƒ½æ˜¯ä¸€æ ·çš„, ä¸ºä»€ä¹ˆä¸èƒ½å€Ÿæ¥ç”¨ç”¨å‘¢? æ”¹é€ ä¸€ä¸‹,</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">name</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>è¿™ç§åœ¨æ„é€ å‡½æ•°å†…éƒ¨å€Ÿå‡½æ•°è€Œä¸å€ŸåŠ©åŸå‹ç»§æ‰¿çš„æ–¹å¼è¢«ç§°ä¹‹ä¸º <b>å€Ÿç”¨æ„é€ å‡½æ•°å¼ç»§æ‰¿</b>.</p><p>æŠŠå±æ€§å’Œæ–¹æ³•æ”¾åœ¨æ„é€ å‡½æ•°å†…éƒ¨çš„å®šä¹‰, ä½¿å¾—æ¯ä¸ªæ„é€ å‡ºæ¥çš„å®ä¾‹éƒ½æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•. è€Œå¯¹ä¸€äº›éœ€è¦å®ä¾‹é—´å…±äº«çš„å±æ€§æˆ–æ–¹æ³•å´æ˜¯æ²¡è¾™.</p><p>å½“ç„¶äº†, æˆ‘ä»¬æœ¬æ¥å°±æ²¡æ‰“ç®—æ­¢æ­¥äºæ­¤. æ„é€ å‡½æ•°å†…éƒ¨å¯ä»¥é å€Ÿ, é‚£åŸå‹ä¸Šå‘¢? å¦‚ä½•è®© <i><b>Leo</b></i> çš„åŸå‹ä¸Šèƒ½å’Œ <i><b>Animal</b></i> çš„åŸå‹ä¿æŒä¸€è‡´å‘¢?</p><blockquote>&#39;è¿™ä¸æ˜¯åºŸè¯ä¹ˆ? æˆ‘é™¤äº†ä¼šå€Ÿ, æˆ‘è¿˜ä¼šç»§æ‰¿å•Š, åŸå‹ç»§æ‰¿å•Š!!!&#39;</blockquote><p>å…³äºåŸå‹é“¾, æˆ‘ä»¬å·²ç»çŸ¥é“æ˜¯æ€ä¹ˆä¸€å›äº‹äº†(ä¸çŸ¥é“çš„å¯å‚è€ƒ<a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E4%25BB%258EFunction%25E5%2585%25A5%25E6%2589%258B%25E5%258E%259F%25E5%259E%258B%25E9%2593%25BE/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä»Functionå…¥æ‰‹åŸå‹é“¾</a>).</p><p>åŸå‹ç»§æ‰¿å°±æ˜¯é€šè¿‡åŸå‹é“¾å®ç°äº†å¯¹è±¡æœ¬èº«æ²¡æœ‰çš„å±æ€§è®¿é—®å’Œæ–¹æ³•è°ƒç”¨. åˆ©ç”¨è¿™ä¸ªç‰¹æ€§, æˆ‘ä»¬å¯ä»¥åœ¨åŸå‹ä¸Šåšäº›æ‰‹è„š.</p><p><b>æ€è·¯ä¸€</b>: å¯ä»¥ä½¿å¾— <b><i>Leo</i></b> çš„ <b><i>prototype</i></b> ç›´æ¥æŒ‡å‘ <b><i>Animal</i></b> çš„ <b><i>prototype</i></b>.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">name</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span> <span class=\"o\">=</span> <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span>\n</code></pre></div><p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„, <code>Leo.prototype = Animal.prototype</code> è¿™ç§å†™æ³•å°±ç­‰äºå®Œå…¨è¦†å†™äº† <i><b>Leo</b></i> çš„åŸå‹, <code>Leo.prototype.constructor</code> å°†å’Œ <code>Animal.prototype.constructor</code> ä¿æŒä¸€è‡´, è¿™ä¼šä½¿å¾—ä¸€äº›ç­‰å¼æ˜¾å¾—è¯¡å¼‚.</p><p>ä¸ä¿¡, è¯·çœ‹:</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">===</span> <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">===</span> <span class=\"nx\">Animal</span>\n</code></pre></div><p>é’ˆå¯¹è¿™ç§æƒ…å†µ, æˆ‘ä»¬å¾€å¾€ä¼šåšä¸€äº›ä¿®æ­£:</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ¥ä¸Šä¾‹ä»£ç çœç•¥\n</span><span class=\"c1\"></span><span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span> <span class=\"o\">=</span> <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">constructor</span> <span class=\"o\">=</span> <span class=\"nx\">Leo</span>\n</code></pre></div><p>å³ä½¿ä¿®æ­£å¥½äº†, å¯æ˜¯è¿˜æœ‰ä¸ªå¤§é—®é¢˜.</p><p>é‚£å°±æ˜¯, å¦‚æœæƒ³ç»™ <i><b>Leo</b></i> åŸå‹æ·»åŠ å±æ€§æˆ–æ–¹æ³•, å°†ä¼šå½±å“åˆ° <i><b>Animal</b></i>, è¿›è€Œä¼šå½±å“åˆ°æ‰€æœ‰ <i><b>Animal</b></i> çš„å®ä¾‹. æ¯•ç«Ÿå®ƒä»¬çš„åŸå‹ä¹‹é—´å·²ç»ç”»äº†ç­‰å·.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ¥ä¸Šä¾‹ä»£ç çœç•¥\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">Dog</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"s1\">&#39;dog&#39;</span><span class=\"p\">)</span>\n<span class=\"nx\">Dog</span><span class=\"p\">.</span><span class=\"nx\">sayName</span>  <span class=\"c1\">// undefined\n</span><span class=\"c1\"></span><span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">sayName</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Dog</span><span class=\"p\">.</span><span class=\"nx\">sayName</span><span class=\"p\">()</span>   <span class=\"c1\">//  dog\n</span></code></pre></div><blockquote>&#39;æˆ‘åªæƒ³å·ä¸ªæ‡’, æ²¡æƒ³è¿‡è¦æ£ä¹±å•ŠğŸ˜²!!!&#39;</blockquote><p>ä¸ºäº†æ¶ˆé™¤è¿™ç§å½±å“, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´çº½å¸¦è¿‡æ¸¡. è¿˜å¥½æˆ‘ä»¬çŸ¥é“ <i><b>new</b></i> å¯ä»¥ç”¨æ¥ä¿®æ”¹åŸå‹é“¾.</p><p><b>æ€è·¯äºŒ</b>: <b><i>Leo</i></b> çš„ <b><i>prototype</i></b> æŒ‡å‘ <b><i>Animal</i></b> çš„å®ä¾‹.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">name</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Animal</span><span class=\"p\">()</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">contructor</span> <span class=\"o\">=</span> <span class=\"nx\">Leo</span>\n</code></pre></div><p>è¿™ç§åœ¨æ„é€ å‡½æ•°å†…éƒ¨å€Ÿå‡½æ•°åŒæ—¶åˆå€ŸåŠ©åŸå‹ç»§æ‰¿çš„æ–¹å¼è¢«ç§°ä¹‹ä¸º <b>ç»„åˆç»§æ‰¿</b>. <b><i>Leo</i></b> æ¢ä¸ªè§’åº¦å…¶å®é•¿è¿™æ ·:</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"o\">:</span> <span class=\"nx\">Leo</span><span class=\"p\">,</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"kc\">undefined</span><span class=\"p\">,</span>\n    <span class=\"nx\">__proto__</span><span class=\"o\">:</span> <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>åœ¨è¿™ç§ç»§æ‰¿æ¨¡å¼ä¸­, <i><b>Leo</b></i> çš„å®ä¾‹å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•, å®ä¾‹ä¹‹é—´åˆå¯ä»¥é€šè¿‡ <i><b>prototype</b></i> æ¥å…±äº«å±æ€§å’Œæ–¹æ³•å´ä¸ä¼šå½±å“ <i><b>Animal</b></i>, è¿˜å¯ä»¥é€šè¿‡ <i><b><code>_proto_</code></b></i> è¿½æº¯åˆ° <i><b>Animal.prototype</b></i>.</p><p>ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ğŸ‘. ä¸è¿‡è¿˜è®°å¾—æ–‡ç« å¼€å§‹æ—¶æ‰€è¯´çš„ä¹ˆ</p><blockquote>åœ¨å®ç°ç»§æ‰¿çš„è¿‡ç¨‹ä¸­, ä¸€æ—¦åŒæ—¶å‡ºç° <i><b>new</b></i> å’Œ <i><b>apply</b></i> æˆ– <i><b>call</b></i>, å°±ä¼šæœ‰é‡å¤äº¤é›†çš„å¯èƒ½, è¿™æ—¶å°±éœ€è¦æƒ³æƒ³æ˜¯å¦æœ‰å¯ä»¥æ”¹è¿›çš„åœ°æ–¹.</blockquote><p><i><b>Animal</b></i> è¢«è°ƒç”¨äº†ä¸¤æ¬¡, ç¬¬ä¸€æ¬¡æ˜¯ <i><b>Leo</b></i> æ„é€ å‡½æ•°å†…éƒ¨ä½œä¸ºä¸€ä¸ªæ™®é€šå‡½æ•°è¢«è°ƒç”¨, ç¬¬äºŒæ¬¡æ˜¯è¢«ä½œä¸ºæ„é€ å‡½æ•°æ„é€ ä¸€ä¸ªå®ä¾‹å……å½“ <i><b>Leo</b></i>çš„åŸå‹.</p><p><i><b>Animal</b></i> å†…éƒ¨å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•åŒæ—¶å‡ºç°åœ¨ <i><b>Leo</b></i> çš„åŸå‹å’Œ <i><b>Leo</b></i> çš„å®ä¾‹ä¸Š. å®ä¾‹ä¸Šæœ‰çš„ä¸œè¥¿å°±ä¸ä¼šå†åˆ°åŸå‹ä¸ŠæŸ¥æ‰¾. åä¹‹, å®ä¾‹ä¸Šæ²¡æœ‰çš„ä¸œè¥¿æ‰ä¼šåˆ°åŸå‹ä¸ŠæŸ¥æ‰¾. æ˜¾ç„¶, æœ‰å¤šä½™çš„å­˜åœ¨.</p><blockquote>&#39;è¿™ä¸æ˜¯æœ€ä¼˜è§£, æˆ‘è¦æœ€å¥½çš„! ä¸‹ä¸€ä¸ª!&#39;</blockquote><p><b>æ€è·¯ä¸‰</b>: æ—¢ç„¶æœ‰é‡å¤, é‚£å°±å»å…¶ä¸€å‘—. æ—¢ç„¶ <b><i>new</i></b> æ¯” <b><i>call</i></b> å’Œ <b><i>apply</i></b> å‰å®³, é‚£å°±ç•™ç€ <b><i>new</i></b> å§.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{}</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Animal</span><span class=\"p\">()</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">contructor</span> <span class=\"o\">=</span> <span class=\"nx\">Leo</span>\n</code></pre></div><p>è¿™ç§åœ¨æ„é€ å‡½æ•°å†…éƒ¨ä¸å€Ÿå‡½æ•°åªå€ŸåŠ©åŸå‹ç»§æ‰¿çš„æ–¹å¼è¢«ç§°ä¹‹ä¸º <b>åŸå‹é“¾ç»§æ‰¿</b>.</p><p>ç»è¿‡è¿™ä¹ˆä¸€æŠ˜è…¾, å‘ç°ä¸å¥½çš„åœ°æ–¹æœ‰å¢æ— å‡. å®ä¾‹æ²¡äº†è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•äº†, è¿ <i><b>Animal</b></i> æ„é€ å‡½æ•°å†…éƒ¨å®šä¹‰çš„å±æ€§æ–¹æ³•éƒ½å¯ä»¥åœ¨å®ä¾‹é—´å…±äº«äº†(<i>æ€è·¯äºŒä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜</i>), è€Œä¸”å‚æ•°ä¹Ÿä¸ç»™ä¼ äº†.</p><blockquote>&#39;æˆ‘è¦çš„ä¸å¤š, èƒ½è½»ç‚¹æŠ˜è…¾ä¸, å¿ƒè„ä¸å¥½&#39;</blockquote><p>å›åˆ° <b>æ€è·¯äºŒ</b>, é‚£å°±åˆ äº† <b><i>new</i></b> å§.</p><p><b>æ€è·¯å››</b>: æ¥ä¸Š <b>æ€è·¯äºŒ</b>, åˆ äº† <b><i>new</i></b>, é‚£åªèƒ½åœ¨åŸå‹ä¸Šåšè°ƒæ•´äº†.</p><p>æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±åªæ˜¯å¸Œæœ› <i><b>Leo</b></i> çš„ <i><b>prototype</b></i> æŒ‡å‘ <i><b>Animal</b></i> çš„ <i><b>prototype</b></i>, ä¸å¤šä¸å°‘ä¸”ä¸ä¼šå‡ºç° <b>æ€è·¯ä¸€</b> çš„åå½±å“.</p><p>æ—¢ç„¶ä¸èƒ½ç›´æ¥åœ¨ä¸¤è€…ä¹‹é—´ç”»ç­‰å·, å°±é€ ä¸€ä¸ªè¿‡æ¸¡çº½å¸¦å‘—. èƒ½å¤Ÿå…³è”èµ·åŸå‹é“¾çš„ä¸åªæœ‰ <i><b>new</b></i>, <i><b>Object.create()</b></i> ä¹Ÿæ˜¯å¯ä»¥çš„.</p><p>åˆ›å»ºä¸€ä¸ª <i><b><code>_proto_</code></b></i> æŒ‡å‘ <i><b>Animal.prototype</b></i> çš„å¯¹è±¡å……å½“ <i><b>Leo</b></i> çš„åŸå‹ä¸å°±è§£å†³é—®é¢˜äº†ä¹ˆ.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">function</span> <span class=\"nx\">Animal</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">Leo</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">name</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span> <span class=\"o\">=</span> <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">(</span><span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">)</span>\n<span class=\"nx\">Leo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">contructor</span> <span class=\"o\">=</span> <span class=\"nx\">Leo</span>\n</code></pre></div><p>è¿™ç§åœ¨æ„é€ å‡½æ•°å†…éƒ¨å€Ÿå‡½æ•°åŒæ—¶åˆé—´æ¥å€ŸåŠ©åŸå‹ç»§æ‰¿çš„æ–¹å¼è¢«ç§°ä¹‹ä¸º <b>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</b>.</p><p>è¿™ç§æ¨¡å¼å®Œç¾è§£å†³äº† <b>æ€è·¯äºŒ</b> çš„å¼Šç«¯. ç®—æ˜¯è¾ƒä¸ºç†æƒ³çš„ç»§æ‰¿æ¨¡å¼å§.</p><blockquote>&#39;ç¡®è®¤è¿‡çœ¼ç¥, ä½ æ‰æˆ‘æƒ³è¦çš„!&#39;</blockquote><p>ä»¥ä¸Šè¿˜æ˜¯åªæ˜¯æ„é€ å‡½æ•°é—´çš„ç»§æ‰¿, è¿˜æœ‰åŸºäºå·²å­˜åœ¨å¯¹è±¡çš„ç»§æ‰¿, è­¬å¦‚, <b>åŸå‹å¼ç»§æ‰¿</b> å’Œ <b>å¯„ç”Ÿå¼ç»§æ‰¿ç­‰</b>.</p><p>è®²çœŸ, è¯´äº†è¾£ä¹ˆå¤š, æˆ‘è¿˜çœŸæ²¡è®°ä½ <b>å€Ÿç”¨æ„é€ å‡½æ•°å¼ç»§æ‰¿</b>, <b>ç»„åˆç»§æ‰¿</b>, <b>åŸå‹é“¾ç»§æ‰¿</b>, <b>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</b>, <b>åŸå‹å¼ç»§æ‰¿</b>, <b>å¯„ç”Ÿå¼ç»§æ‰¿ç­‰</b>.</p><blockquote>&#39;ä½ æ²¡è®°ä½è¿™ä¹ˆå¤šæ¨¡å¼, é‚£ä½ éƒ½è®°ä½ä»€ä¹ˆäº†&#39;</blockquote><p>ç­”æ›°: è¦æƒ³å¾ˆå¥½å¾—ç»§æ‰¿, ä¸€é æœ‹å‹, äºŒé æ‹¼çˆ¹.</p><blockquote>&#39;è¿™å­©å­æ˜¯ä¸æ˜¯å‚»? è¿™éƒ½ä»€ä¹ˆå¹´ä»£äº†? å†è¯´äº†, å°±æ²¡äººå‘Šè¯‰ä½ ä½ å®¶é‡Œæœ‰çŸ¿???&#39;</blockquote><p><b>æ€è·¯äº”</b>: <b><i>ES6</i></b> å¼•å…¥äº† <b><i>Class</i></b>ï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œé€šè¿‡ <b><i>class</i></b> å…³é”®å­—ï¼Œå¯ä»¥å®šä¹‰ç±», <b><i>Class</i></b> å®è´¨ä¸Šæ˜¯ <b><i>JavaScript</i></b> ç°æœ‰çš„åŸºäºåŸå‹çš„ç»§æ‰¿çš„è¯­æ³•ç³–. <b><i>Class</i></b> å¯ä»¥é€šè¿‡extendså…³é”®å­—å®ç°ç»§æ‰¿. æˆ‘ä»¬å¯ä»¥å¯¹ <b><i>æ€è·¯å››</i></b> æ¥ä¸ªåä¸½å˜èº«.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Animal</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">Animal</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">species</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;animal&#39;</span>\n\n<span class=\"k\">class</span> <span class=\"nx\">Leo</span> <span class=\"k\">extends</span> <span class=\"nx\">Animal</span> <span class=\"p\">{</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">super</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>ç»è¿‡è¿™ä¹ˆä¸€å¤„ç†åè¡Œä¸ºä¸Šå’Œ <i><b>æ€è·¯å››</b></i> åŸºæœ¬æ²¡ä»€ä¹ˆåŒºåˆ«, <code>constructor(){}</code> å……å½“äº†ä¹‹å‰çš„æ„é€ å‡½æ•°, <code>super()</code> ä½œä¸ºå‡½æ•°è°ƒç”¨æ‰®æ¼”ç€ <code>Animal.call(this, name)</code> çš„è§’è‰²(<i>è¿˜å¯ä»¥è¡¨ç¤ºçˆ¶ç±»</i>). æœ€é‡è¦çš„æ˜¯ <i><b>Leo</b></i> çš„ <i><b><code>_proto_</code></b></i> ä¹ŸæŒ‡å‘äº† <i><b>Animal</b></i>.</p><blockquote>&#39;çŸ¿å¤šåŸºå› å¥½, å•§å•§å•§, æˆ‘éƒ½å¿«è¦å–œæ¬¢ä¸Šæˆ‘è‡ªå·±äº†ğŸ˜.&#39;</blockquote>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "å‰ç«¯å…¥é—¨", 
                    "tagLink": "https://api.zhihu.com/topics/19590813"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/62666613", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 18, 
            "title": "ç”¨Typeé©¯åŒ–JavaScript", 
            "content": "<p><b>é˜…å‰å¿…çŸ¥ï¼šæœ¬æ–‡å±äºæ€»ç»“æ€§æ–‡ç« ï¼Œé˜…è¯»å‰ï¼ŒTypeScript å®˜æ–¹æ–‡æ¡£åº”æœ‰æŸ¥é˜…è¿‡ã€‚</b></p><blockquote>TypeScript å…·æœ‰ç±»å‹ç³»ç»Ÿï¼Œä¸”æ˜¯ JavaScript çš„è¶…é›†ã€‚å®ƒå¯ä»¥ç¼–è¯‘æˆæ™®é€šçš„ JavaScript ä»£ç ã€‚TypeScript æ”¯æŒä»»æ„æµè§ˆå™¨ï¼Œä»»æ„ç¯å¢ƒï¼Œä»»æ„ç³»ç»Ÿå¹¶ä¸”æ˜¯å¼€æºçš„ã€‚</blockquote><p>ä½œä¸ºå¼±ç±»å‹ã€åŠ¨æ€å‹è¯­è¨€ï¼ŒJavaScript å°±åƒæœªé©¯åŒ–çš„é‡é©¬ä¸€æ ·ã€‚æ¯ä¸ªäººéƒ½èƒ½ä¸Šå»åä¸¤ä¸‹ï¼Œä½†æ˜¯çœŸæ­£èƒ½å¤Ÿé©¾é©­çš„åªèƒ½æ˜¯ä¸ªä¸­å¥½æ‰‹ã€‚</p><p>è¿‘å‡ å¹´ï¼Œå‰ç«¯ç»å†äº†å¿«é€Ÿçš„å‘å±•å·²ç»ä¸å†æ˜¯ä»¥å‰éšä¾¿ç©ç©çš„å°ç©æ„äº†ã€‚é¢å¯¹è¶Šæ¥è¶Šå¤§å‹ã€è¶Šæ¥è¶ŠæŒä¹…çš„é¡¹ç›®æ¥è¯´ï¼Œè¿™ç§å®½æ¾çš„æ–¹å¼åè€Œæˆäº†é˜»ç¢ã€‚</p><blockquote>ä¸œè¥¿åšå¤§äº†ï¼Œéšä¹‹è€Œæ¥çš„å°±æ˜¯å„ç§è§„çŸ©</blockquote><p>è§„çŸ©æ˜¯ä»ç»éªŒä¸­æ€»ç»“ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†æœæ›´å¥½çš„æ–¹å‘å‘å±•ï¼Œå°±æ¯”å¦‚ç¼–ç¨‹é‡Œçš„è®¾è®¡åŸåˆ™å’Œè®¾è®¡æ¨¡å¼ã€‚ã€ŒMan maketh mannersã€ï¼Œè®°å¾—ç‹ç‰Œç‰¹å·¥é‡Œï¼Œä¸»è§’ä»¬åœ¨æ•™è‚²åˆ«äººçš„æ—¶å€™æ€»å–œæ¬¢è¯´è¿™ä¹ˆä¸€å¥è¯ï¼Œã€Œä¸çŸ¥ç¤¼ï¼Œæ— ä»¥ç«‹ä¹Ÿã€ã€‚</p><p>åœ¨ TypeScript é‡Œï¼Œã€Œç¤¼ã€å°±æ˜¯ Typeï¼ŒType å°±æ˜¯è§„çŸ©ã€‚Typescript é€šè¿‡ç±»å‹æ³¨è§£æä¾›ç¼–è¯‘æ—¶çš„é™æ€ç±»å‹æ£€æŸ¥ï¼Œæå‰å‘ç°é”™è¯¯ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><blockquote>TypeScript é‡Œçš„ç±»å‹æ³¨è§£æ˜¯ä¸€ç§è½»é‡çº§çš„ä¸ºå‡½æ•°æˆ–å˜é‡æ·»åŠ çº¦æŸçš„æ–¹å¼</blockquote><p>åœ¨ JavaScript é‡Œï¼Œå˜é‡ç”¨äºåœ¨ç‰¹å®šæ—¶é—´å­˜å‚¨ç‰¹å®šå€¼ï¼Œå…¶å€¼åŠæ•°æ®ç±»å‹å¯ä»¥åœ¨è„šæœ¬çš„ç”Ÿå‘½å‘¨æœŸå†…æ”¹å˜ã€‚</p><p>è€Œåœ¨ TypeScript ä¸­ï¼Œæ ‡è¯†ç¬¦ï¼ˆå˜é‡ã€å‡½æ•°ã€ç±»ã€å±æ€§çš„åå­—ï¼Œæˆ–è€…å‡½æ•°å‚æ•°ï¼‰åœ¨å…¶å®šä¹‰æ—¶å°±æŒ‡å®šäº†ç±»å‹ï¼ˆæˆ–ç±»å‹æ¨è®ºå‡ºï¼‰ã€‚åœ¨ç¼–è¯‘é˜¶æ®µï¼Œè‹¥å‡ºç°äº†æœŸæœ›ä¹‹å¤–çš„ç±»å‹ï¼ŒTypeScript å°†ä¼šæç¤ºæŠ›é”™ï¼ˆè™½ç„¶æœ‰æ—¶å€™å¹¶ä¸ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼‰ã€‚</p><p>åœ¨ TypeScript ä¸­ï¼Œé€šè¿‡ <code>: ç±»å‹</code> çš„æ–¹å¼ä¸ºæ ‡è¯†ç¬¦æ·»åŠ ç±»å‹æ³¨è§£ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">isDone</span><span class=\"o\">:</span> <span class=\"kr\">boolean</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"p\">;</span>    <span class=\"c1\">// booleanï¼›\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">decLiteral</span><span class=\"o\">:</span> <span class=\"nx\">number</span> <span class=\"o\">=</span> <span class=\"mi\">6</span><span class=\"p\">;</span>    <span class=\"c1\">// numberï¼›\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;bob&#34;</span><span class=\"p\">;</span>    <span class=\"c1\">// stringï¼›\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">list</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">[]</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">];</span>    <span class=\"c1\">// Array&lt;number&gt;;\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">list</span><span class=\"o\">:</span> <span class=\"nb\">Array</span><span class=\"o\">&lt;</span><span class=\"nx\">number</span><span class=\"o\">&gt;</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">];</span>    <span class=\"c1\">// Array&lt;number&gt;;\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"p\">[</span><span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"nx\">number</span><span class=\"p\">];</span>    <span class=\"c1\">// tuple;\n</span><span class=\"c1\"></span><span class=\"kr\">enum</span> <span class=\"nx\">Color</span> <span class=\"p\">{</span><span class=\"nx\">Red</span><span class=\"p\">,</span> <span class=\"nx\">Green</span><span class=\"p\">,</span> <span class=\"nx\">Blue</span><span class=\"p\">}</span>    <span class=\"c1\">// enum;\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">notSure</span><span class=\"o\">:</span> <span class=\"nx\">any</span> <span class=\"o\">=</span> <span class=\"mi\">4</span><span class=\"p\">;</span>    <span class=\"c1\">// any;\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">warnUser</span><span class=\"p\">()</span><span class=\"o\">:</span> <span class=\"k\">void</span> <span class=\"p\">{</span>    <span class=\"c1\">// void;\n</span><span class=\"c1\"></span><span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s2\">&#34;This is my warning message&#34;</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">u</span><span class=\"o\">:</span> <span class=\"kc\">undefined</span> <span class=\"o\">=</span> <span class=\"kc\">undefined</span><span class=\"p\">;</span>    <span class=\"c1\">// undefined;\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">n</span><span class=\"o\">:</span> <span class=\"kc\">null</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"p\">;</span>    <span class=\"c1\">// null;\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">error</span><span class=\"p\">(</span><span class=\"nx\">message</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">never</span> <span class=\"p\">{</span>    <span class=\"c1\">// never;\n</span><span class=\"c1\"></span><span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"nb\">Error</span><span class=\"p\">(</span><span class=\"nx\">message</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">obj</span><span class=\"o\">:</span> <span class=\"nx\">object</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>    <span class=\"c1\">// object\n</span></code></pre></div><p>åœ¨ TypeScript ä¸­ï¼Œæ•°ç»„ï¼ˆArrayï¼‰æ˜¯åˆå¹¶äº†ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œè€Œå…ƒç»„ï¼ˆtupleï¼‰åˆå¹¶äº†ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ï¼ˆ<code>Array&lt;any&gt;</code>,ä¹Ÿå¯ä»¥åˆå¹¶ä¸åŒç±»å‹çš„æ•°æ®ï¼‰</p><blockquote>ç±»å‹æ³¨è§£ä¸­çš„ç±»å‹å°±æ˜¯ä»¥ä¸Šçš„é‚£äº›ç±»å‹ä¹ˆï¼Ÿ</blockquote><p>TypeScript çš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€æ˜¯å¯¹å€¼æ‰€å…·æœ‰çš„ç»“æ„è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå®ƒæœ‰æ—¶è¢«ç§°åšã€Œé¸­å¼è¾¨å‹æ³•ã€æˆ–ã€Œç»“æ„æ€§å­ç±»å‹åŒ–ã€ã€‚ä¸Šé¢çš„åªæ˜¯åŸºç¡€ç±»å‹ï¼Œå®ƒä»¬æ˜¯å¡«å……ç»“æ„çš„åŸºæœ¬å•ä½è€Œå·²ã€‚åœ¨ TypeScript é‡Œï¼Œç±»å‹ä¸åº”è¯¥è¿˜åœç•™åœ¨ JavaScript æ•°æ®ç±»å‹çš„å±‚é¢ä¸Šï¼Œè¿˜åº”åŒ…æ‹¬åŸºç¡€ç±»å‹çš„ç»„åˆç»“æ„åŒ–ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kd\">let</span> <span class=\"nx\">str</span><span class=\"o\">:</span> <span class=\"s1\">&#39;Hello&#39;</span><span class=\"p\">;</span>    <span class=\"c1\">// å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ï¼›\n</span><span class=\"c1\"></span><span class=\"nx\">str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;Hi&#39;</span>    <span class=\"c1\">// errorï¼›\n</span><span class=\"c1\"></span>\n<span class=\"kd\">let</span> <span class=\"nx\">something</span><span class=\"o\">:</span> <span class=\"s1\">&#39;Hello&#39;</span> <span class=\"o\">|</span> <span class=\"mi\">1</span><span class=\"p\">;</span>    <span class=\"c1\">// è”åˆç±»å‹ï¼›\n</span><span class=\"c1\"></span><span class=\"nx\">something</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>    <span class=\"c1\">// okï¼›\n</span><span class=\"c1\"></span>\n<span class=\"kd\">let</span> <span class=\"nx\">obj</span><span class=\"o\">:</span> <span class=\"p\">{</span><span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">};</span>    <span class=\"c1\">// å¯¹è±¡å­—é¢é‡\n</span><span class=\"c1\"></span><span class=\"nx\">obj</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s2\">&#34;å¤œæ›‰å®¸&#34;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">18</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>æ¢å¥è¯è¯´ï¼Œåœ¨å®šä¹‰æ ‡è¯†ç¬¦çš„æ—¶å€™ï¼Œç”¨ä¸€ä¸ªç±»å‹æ¨¡æ¿æ¥æè¿°æ ‡è¯†ç¬¦çš„ç»“æ„å’Œå†…éƒ¨ç±»å‹ç»„æˆã€‚å³ç±»å‹æ¨¡æ¿å°±æ˜¯æ ‡è¯†ç¬¦æœŸæœ›çš„æ ·å­ã€‚</p><blockquote>ä»£ç æ˜¯ç»™äººçœ‹çš„ï¼Œé¡ºä¾¿æ˜¯ç»™æœºå™¨è¿è¡Œçš„</blockquote><p>éƒ½è¯´å¥½çš„ä»£ç å°±è¯¥è¿™æ ·ã€‚ä½†æ˜¯åœ¨ TypeScript é‡Œï¼Œè¿™ä¸¤å¥è¯å¯ä»¥é¢ å€’ä¸‹é¡ºåºã€‚ä»£ç æ˜¯ç»™æœºå™¨è¿è¡Œçš„ï¼Œé¡ºä¾¿æ˜¯ç»™äººçœ‹çš„ã€‚ åœ¨è°ˆåˆ° TypeScript çš„å¥½å¤„æ—¶ï¼Œæœ‰ä¸€æ¡å¾ˆé‡è¦ï¼Œå¢å¼ºäº†ç¼–è¯‘å™¨å’Œ IDE çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»£ç è¡¥å…¨ã€æ¥å£æç¤ºã€è·³è½¬åˆ°å®šä¹‰ã€é‡æ„ç­‰ã€‚</p><p>è€Œè¿™äº›ä¹Ÿå¾—ç›Šäºæ ‡è¯†ç¬¦çš„ç±»å‹çš„ç²¾ç¡®åˆ’åˆ†æˆ–è¡¨è¿°ï¼Œæ‰€ä»¥æƒ³å†™å¥½ Typescript ä»£ç ï¼Œå°±åº”è¯¥ç²¾ç¡®æè¿°æ ‡è¯†ç¬¦çš„ç±»å‹ï¼Œè€Œä¸æ˜¯éšå¤„å®‰æ”¾çš„ <code>any</code>ã€‚</p><blockquote>è¡¨è¿°å¤æ‚ç»“æ„æœ€å¸¸ç”¨çš„æ–¹å¼ â€”â€”â€”â€” æ¥å£</blockquote><p>æ¥å£æ˜¯ JavaScript ä¸­æ²¡æœ‰çš„ä¸œè¥¿ï¼Œæ˜¯ä¸€ä¸ªéå¸¸çµæ´»çš„æ¦‚å¿µï¼Œå¯ä»¥æŠ½è±¡è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥æè¿°ã€Œå¯¹è±¡çš„å½¢çŠ¶ã€ã€‚ å¯¹äºéœ€è¦å¤ç”¨çš„ç»“æ„ç±»å‹ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¥å£çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯å¯¹è±¡å­—é¢é‡å†…è”å¼æ³¨è§£ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kr\">interface</span> <span class=\"nx\">Iperson</span> <span class=\"p\">{</span>    <span class=\"c1\">// å¯¹è±¡\n</span><span class=\"c1\"></span>    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">,</span>\n    <span class=\"nx\">sayHi</span><span class=\"p\">()</span><span class=\"o\">:</span> <span class=\"k\">void</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">obj</span><span class=\"o\">:</span> <span class=\"nx\">Iperson</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s2\">&#34;å¤œæ›‰å®¸&#34;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">18</span><span class=\"p\">,</span>\n    <span class=\"nx\">sayHi</span><span class=\"o\">:</span> <span class=\"p\">()=&gt;</span> <span class=\"p\">{}</span>\n<span class=\"p\">}</span>\n\n<span class=\"cm\">/* â€”â€”â€”â€”â€”â€”äººå·¥åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€” */</span>\n\n<span class=\"kr\">interface</span> <span class=\"nx\">Iperson</span> <span class=\"p\">{</span>    <span class=\"c1\">// å‡½æ•°ç±»å‹\n</span><span class=\"c1\"></span>    <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">string</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">person</span><span class=\"o\">:</span> <span class=\"nx\">Iperson</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\">,</span><span class=\"si\">${</span><span class=\"nx\">age</span><span class=\"si\">}</span><span class=\"sb\">`</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span> <span class=\"mi\">18</span><span class=\"p\">);</span>\n\n<span class=\"cm\">/* â€”â€”â€”â€”â€”â€”äººå·¥åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€” */</span>\n\n<span class=\"kr\">interface</span> <span class=\"nx\">Iperson</span> <span class=\"p\">{</span>    <span class=\"c1\">// æ„é€ å‡½æ•°\n</span><span class=\"c1\"></span>    <span class=\"k\">new</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">person</span><span class=\"o\">:</span> <span class=\"nx\">Iperson</span> <span class=\"o\">=</span> <span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span><span class=\"p\">;</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">age</span> <span class=\"o\">=</span> <span class=\"nx\">age</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">new</span> <span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span> <span class=\"mi\">18</span><span class=\"p\">);</span>\n\n<span class=\"cm\">/* â€”â€”â€”â€”â€”â€”äººå·¥åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€” */</span>\n\n<span class=\"kr\">interface</span> <span class=\"nx\">Iperson</span> <span class=\"p\">{</span>    <span class=\"c1\">// ç±»å®ç°æ¥å£\n</span><span class=\"c1\"></span>    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"kr\">implements</span> <span class=\"nx\">Iperson</span><span class=\"p\">{</span>\n    <span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span>\n    <span class=\"nx\">age</span> <span class=\"o\">=</span> <span class=\"mi\">18</span>\n<span class=\"p\">}</span>\n<span class=\"k\">new</span> <span class=\"nx\">Person</span><span class=\"p\">()</span>\n\n<span class=\"cm\">/* â€”â€”â€”â€”â€”â€”äººå·¥åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€” */</span>\n\n<span class=\"kr\">interface</span> <span class=\"nx\">Iperson</span> <span class=\"p\">{</span>    <span class=\"c1\">// æ··åˆç±»å‹\n</span><span class=\"c1\"></span>    <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">Person</span><span class=\"p\">()</span><span class=\"o\">:</span> <span class=\"nx\">Iperson</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">me</span> <span class=\"o\">=</span> <span class=\"o\">&lt;</span><span class=\"nx\">Iperson</span><span class=\"o\">&gt;</span><span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">string</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\">, </span><span class=\"si\">${</span><span class=\"nx\">age</span><span class=\"si\">}</span><span class=\"sb\">`</span>\n    <span class=\"p\">}</span>\n    <span class=\"nx\">me</span><span class=\"p\">.</span><span class=\"nx\">age</span> <span class=\"o\">=</span> <span class=\"mi\">18</span><span class=\"p\">;</span>\n    <span class=\"k\">return</span> <span class=\"nx\">me</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">let</span> <span class=\"nx\">person</span> <span class=\"o\">=</span> <span class=\"nx\">Person</span><span class=\"p\">();</span>\n<span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span> <span class=\"mi\">18</span><span class=\"p\">)</span>\n<span class=\"nx\">person</span><span class=\"p\">.</span><span class=\"nx\">age</span>\n\n</code></pre></div><p>ä»¥ä¸Šæ˜¯æ¥å£åœ¨å¯¹è±¡ã€æ™®é€šå‡½æ•°ã€æ„é€ å‡½æ•°ã€ç±»ä¸Šçš„è¡¨ç°ã€‚å¯¹äºæ¥å£çš„å±æ€§ï¼Œè¿˜å¯ä»¥åšåˆ°ç²¾ç¡®æ§åˆ¶ï¼Œå¦‚å¯é€‰å±æ€§ã€ä»»æ„å±æ€§ã€åªè¯»å±æ€§ç­‰ã€‚</p><p>æœ€åï¼Œæ¥å£é—´å¯ä»¥ç»§æ‰¿ï¼Œæ¥å£è¿˜å¯ä»¥ç»§æ‰¿ç±»ã€‚å½“æ¥å£ç»§æ‰¿ç±»æ—¶ï¼Œå®ƒä¼šç»§æ‰¿ç±»çš„æˆå‘˜ä½†ä¸åŒ…æ‹¬å…¶å®ç°ï¼Œä½†æ˜¯è‹¥ç»§æ‰¿äº†æ‹¥æœ‰ç§æœ‰æˆ–å—ä¿æŠ¤çš„æˆå‘˜ç±»æ—¶ï¼Œè¿™ä¸ªæ¥å£åªèƒ½ç”±è¿™ä¸ªç±»æˆ–å…¶å­ç±»æ¥å®ç°äº†ï¼Œè¿™ä¸ªå’Œç±»çš„è®¿é—®ä¿®é¥°ç¬¦çš„ç‰¹ç‚¹æœ‰å…³ç³»ã€‚</p><p>è¯´å®Œæ¥å£ï¼Œå°±è¦è¯´è¯´ç±»äº†ï¼Œå› ä¸ºå®ƒä»¬æœ‰å¤šç›¸ä¼¼çš„åœ°æ–¹ï¼Œæ¯”å¦‚å……å½“å¯¹è±¡çš„ç±»å‹æ¨¡æ¿ï¼Œç»§æ‰¿æˆå‘˜ç­‰ã€‚</p><blockquote>ç±»åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</blockquote><p>ES6 å¼•å…¥äº† Classï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œé€šè¿‡ class å…³é”®å­—ï¼Œå¯ä»¥å®šä¹‰ç±», Class å®è´¨ä¸Šæ˜¯ JavaScript ç°æœ‰çš„åŸºäºåŸå‹çš„ç»§æ‰¿çš„è¯­æ³•ç³–. Class å¯ä»¥é€šè¿‡extendså…³é”®å­—å®ç°ç»§æ‰¿ã€‚TypeScript é™¤äº†å®ç°äº†æ‰€æœ‰ ES6 ä¸­çš„ç±»çš„åŠŸèƒ½ä»¥å¤–ï¼Œè¿˜æ·»åŠ äº†ä¸€äº›æ–°çš„ç”¨æ³•ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n    <span class=\"kr\">static</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span> <span class=\"o\">=</span> <span class=\"mi\">18</span><span class=\"p\">;</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"kr\">public</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"kr\">public</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"p\">}</span>\n    <span class=\"nx\">sayHi</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"sb\">`Hi,</span><span class=\"si\">${</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\">`</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"cm\">/* â€”â€”â€”â€”â€”â€” åˆ†å‰²çº¿ â€”â€”â€”â€”â€”â€” */</span>\n<span class=\"kd\">var</span> <span class=\"nx\">Person</span> <span class=\"o\">=</span> <span class=\"cm\">/** @class */</span> <span class=\"p\">(</span><span class=\"kd\">function</span> <span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">function</span> <span class=\"nx\">Person</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">name</span><span class=\"p\">;</span>\n        <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">age</span> <span class=\"o\">=</span> <span class=\"nx\">age</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"nx\">Person</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">sayHi</span> <span class=\"o\">=</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"s2\">&#34;Hi,&#34;</span> <span class=\"o\">+</span> <span class=\"nx\">name</span><span class=\"p\">;</span>\n    <span class=\"p\">};</span>\n    <span class=\"nx\">Person</span><span class=\"p\">.</span><span class=\"nx\">age</span> <span class=\"o\">=</span> <span class=\"mi\">18</span><span class=\"p\">;</span>\n    <span class=\"k\">return</span> <span class=\"nx\">Person</span><span class=\"p\">;</span>\n<span class=\"p\">}());</span>\n</code></pre></div><p>TypeScript ç¼–è¯‘åï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œç±»å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°è€Œå·²ã€‚</p><p>åœ¨ ES6 ä¹‹å‰ï¼Œé€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼ <code>new</code> å‡ºå¯¹è±¡ï¼Œé€ å‡ºçš„å¯¹è±¡æ‹¥æœ‰å’Œå…±äº«äº†æ„é€ å‡½æ•°å†…éƒ¨ç»‘å®šçš„å±æ€§æ–¹æ³•åŠåŸå‹ä¸Šçš„å±æ€§æ–¹æ³•ã€‚TypeScript é‡Œçš„æ¥å£æè¿°çš„ç±»ç±»å‹å°±æ˜¯ç±»çš„å®ä¾‹éƒ¨åˆ†åº”è¯¥éµå¾ªçš„ç±»å‹æ¨¡æ¿ã€‚ä½œä¸ºç±»çš„é™æ€éƒ¨åˆ† â€”â€”â€”â€” æ„é€ å‡½æ•°ï¼Œå‡½æ•°ä¹Ÿåº”è¯¥æœ‰è‡ªå·±çš„å±æ€§ç‰¹å¾ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"kr\">interface</span> <span class=\"nx\">static_person</span> <span class=\"p\">{</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">,</span>\n    <span class=\"k\">new</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kr\">interface</span> <span class=\"nx\">instance_person</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">,</span>\n    <span class=\"nx\">say</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">string</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">let</span> <span class=\"nx\">person</span><span class=\"o\">:</span> <span class=\"nx\">static_person</span> <span class=\"o\">=</span> <span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"kr\">implements</span> <span class=\"nx\">instance_person</span><span class=\"p\">{</span>\n    <span class=\"kr\">static</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span> <span class=\"o\">=</span> <span class=\"mi\">18</span><span class=\"p\">;</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"kr\">public</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"kr\">public</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"p\">}</span>\n    <span class=\"nx\">say</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"sb\">`Hi,</span><span class=\"si\">${</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\">`</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">new</span> <span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span><span class=\"mi\">18</span><span class=\"p\">)</span>\n</code></pre></div><p>ç”±ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œç±»çš„é™æ€éƒ¨åˆ†å’ŒåŠ¨æ€éƒ¨åˆ†éƒ½æœ‰å„è‡ªçš„ç±»å‹æ¨¡æ¿ã€‚è‹¥æ˜¯æƒ³è¦å°†ç±»è‡ªèº«ä½œä¸ºç±»å‹æ¨¡æ¿åˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ <code>typeof ç±»</code> çš„æ–¹å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"kr\">static</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span> <span class=\"o\">=</span> <span class=\"mi\">18</span><span class=\"p\">;</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"kr\">public</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"kr\">public</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">)</span> <span class=\"p\">{}</span>\n    <span class=\"nx\">say</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"sb\">`Hi,</span><span class=\"si\">${</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\">`</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Man</span> <span class=\"p\">{</span>\n    <span class=\"kr\">static</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n    <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"kr\">public</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">,</span> <span class=\"kr\">public</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">)</span> <span class=\"p\">{}</span>\n    <span class=\"kr\">public</span> <span class=\"nx\">sex</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;man&#39;</span><span class=\"p\">;</span>\n    <span class=\"nx\">say</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">){</span><span class=\"k\">return</span> <span class=\"sb\">`Hi, </span><span class=\"si\">${</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">sex</span><span class=\"si\">}</span><span class=\"sb\">,</span><span class=\"si\">${</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">man</span><span class=\"o\">:</span> <span class=\"k\">typeof</span> <span class=\"nx\">Person</span> <span class=\"o\">=</span> <span class=\"nx\">Man</span><span class=\"p\">;</span>\n<span class=\"k\">new</span> <span class=\"nx\">man</span><span class=\"p\">(</span><span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span> <span class=\"mi\">18</span><span class=\"p\">)</span>\n</code></pre></div><p>ç±»é™æ€éƒ¨åˆ†ã€ç±»å®ä¾‹éƒ¨åˆ†å’Œç±»è‡ªèº«ï¼Œå®ƒä»¬éƒ½æœ‰è‡ªå·±éœ€è¦éµå¾ªçš„ç±»å‹æ¨¡æ¿ã€‚çŸ¥é“äº†å…¶ä¸­çš„åŒºåˆ«ï¼Œä¹Ÿå°±èƒ½æ›´å¥½å¾—ç†è§£ç±»ä½œä¸ºæ¥å£ä½¿ç”¨ã€æ¥å£ç»§æ‰¿ç±»ç­‰ç”¨æ³•äº†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n  <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"kr\">interface</span> <span class=\"nx\">Man</span> <span class=\"k\">extends</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"nx\">sex</span><span class=\"o\">:</span> <span class=\"s1\">&#39;man&#39;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">let</span> <span class=\"nx\">man</span><span class=\"o\">:</span> <span class=\"nx\">Man</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">18</span><span class=\"p\">,</span>\n    <span class=\"nx\">sex</span><span class=\"o\">:</span> <span class=\"s1\">&#39;man&#39;</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>é™¤äº†ç»“æ„ä¸Šçš„çº¦æŸï¼Œç±»ä¹Ÿé€šè¿‡è®¿é—®ä¿®é¥°ç¬¦å¯¹å…¶æˆå‘˜åšäº†çº¦æŸï¼ŒåŒ…æ‹¬ publicï¼Œprivateï¼Œprotectedï¼Œreadonlyç­‰ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"kr\">private</span> <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n  <span class=\"kr\">protected</span> <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kr\">interface</span> <span class=\"nx\">SayPerson</span> <span class=\"k\">extends</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"nx\">sayHi</span><span class=\"p\">()</span><span class=\"o\">:</span> <span class=\"nx\">string</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">class</span> <span class=\"nx\">Human</span> <span class=\"k\">extends</span> <span class=\"nx\">Person</span> <span class=\"kr\">implements</span> <span class=\"nx\">SayPerson</span> <span class=\"p\">{</span>\n  <span class=\"nx\">sayHi</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"sb\">`Hi, </span><span class=\"si\">${</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">age</span><span class=\"si\">}</span><span class=\"sb\">`</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>çŸ¥é“äº†è®¿é—®ä¿®é¥°ç¬¦çš„ç‰¹ç‚¹ï¼Œä¹Ÿå°±æ˜ç™½ä¹‹å‰è¯´è¿‡çš„ã€Œå½“æ¥å£ç»§æ‰¿ç±»æ—¶ï¼Œå®ƒä¼šç»§æ‰¿ç±»çš„æˆå‘˜ä½†ä¸åŒ…æ‹¬å…¶å®ç°ï¼Œä½†æ˜¯è‹¥ç»§æ‰¿äº†æ‹¥æœ‰ç§æœ‰æˆ–å—ä¿æŠ¤çš„æˆå‘˜ç±»æ—¶ï¼Œè¿™ä¸ªæ¥å£åªèƒ½ç”±è¿™ä¸ªç±»æˆ–å…¶å­ç±»æ¥å®ç°äº†ã€ã€‚</p><blockquote>å¦‚æœä¸€ä¸ªæ ‡è¯†ç¬¦çš„ç±»å‹ä¸ç¡®å®šï¼Œè¯¥å¦‚ä½•ï¼Ÿ</blockquote><p>å¯¹äºä¸€ä¸ªå†…éƒ¨é€»è¾‘ç›¸å·®ä¸å¤§ï¼Œå…¥åƒç±»å‹ä¸åŒçš„å‡½æ•°æ¥è¯´ï¼Œæ²¡å¿…è¦å› ä¸ºå‚æ•°ç±»å‹ä¸åŒè€Œé‡å¤å¤§éƒ¨åˆ†ä»£ç ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªç±»å‹å˜é‡æ¥ä»£æ›¿ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"cm\">/* èŒƒå‹å‡½æ•° */</span>\n<span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n    <span class=\"nx\">className</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;person&#39;</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Human</span> <span class=\"p\">{</span>\n    <span class=\"nx\">classname</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;human&#39;</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">function</span> <span class=\"nx\">create</span><span class=\"o\">&lt;</span><span class=\"nx\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"nx\">Class</span><span class=\"o\">:</span> <span class=\"k\">new</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">T</span><span class=\"p\">)</span> <span class=\"o\">:</span> <span class=\"nx\">T</span><span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nx\">Class</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">create</span><span class=\"p\">(</span><span class=\"nx\">Person</span><span class=\"p\">).</span><span class=\"nx\">className</span>\n\n<span class=\"cm\">/* èŒƒå‹æ¥å£ */</span>\n<span class=\"kr\">interface</span> <span class=\"nx\">Creat</span><span class=\"o\">&lt;</span><span class=\"nx\">T</span><span class=\"o\">&gt;</span><span class=\"p\">{</span>\n    <span class=\"p\">(</span><span class=\"nx\">Class</span><span class=\"o\">:</span> <span class=\"k\">new</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">T</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"nx\">T</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n    <span class=\"nx\">className</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;person&#39;</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Human</span> <span class=\"p\">{</span>\n    <span class=\"nx\">classname</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;human&#39;</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">function</span> <span class=\"nx\">create</span><span class=\"o\">&lt;</span><span class=\"nx\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"nx\">Class</span><span class=\"o\">:</span> <span class=\"k\">new</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">T</span><span class=\"p\">)</span> <span class=\"o\">:</span> <span class=\"nx\">T</span><span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">new</span> <span class=\"nx\">Class</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">person</span><span class=\"o\">:</span> <span class=\"nx\">Creat</span><span class=\"o\">&lt;</span><span class=\"nx\">Person</span><span class=\"o\">&gt;</span> <span class=\"o\">=</span> <span class=\"nx\">create</span><span class=\"p\">;</span>\n\n<span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"nx\">Person</span><span class=\"p\">)</span>    <span class=\"c1\">// OK\n</span><span class=\"c1\"></span><span class=\"nx\">person</span><span class=\"p\">(</span><span class=\"nx\">Human</span><span class=\"p\">)</span>    <span class=\"c1\">// Error\n</span></code></pre></div><p>æ³¨æ„äº†ï¼Œç±»å‹å˜é‡è¡¨ç¤ºçš„æ˜¯ç±»å‹ï¼Œè€Œä¸æ˜¯å€¼ã€‚ç±»å‹å˜é‡é‡Œå¡çš„å¯èƒ½æ˜¯ä»»æ„ä¸€ä¸ªç±»å‹ï¼Œä½†æ ¹æ®åœºæ™¯ï¼Œæˆ‘ä»¬æœ€å¥½èƒ½å¤Ÿæ›´åŠ ç²¾ç¡®çš„æè¿°æ ‡è¯†ç¬¦çš„ç±»å‹ã€‚åº”äº†ä¸Šé¢çš„ä¸€å¥è¯ï¼Œã€Œæƒ³å†™å¥½ Typescript ä»£ç ï¼Œå°±åº”è¯¥ç²¾ç¡®æè¿°æ ‡è¯†ç¬¦çš„ç±»å‹ï¼Œè€Œä¸æ˜¯éšå¤„å®‰æ”¾çš„ <code>any</code>ã€ã€‚æ‰€ä»¥å¯¹äºæ³›å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åšäº›çº¦æŸï¼Œå³ï¼Œæ³›å‹çº¦æŸã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n  <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"kr\">interface</span> <span class=\"nx\">Man</span> <span class=\"k\">extends</span> <span class=\"nx\">Person</span> <span class=\"p\">{</span>\n  <span class=\"nx\">sex</span><span class=\"o\">:</span> <span class=\"s1\">&#39;man&#39;</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">function</span> <span class=\"nx\">getProperty</span><span class=\"o\">&lt;</span><span class=\"nx\">T</span><span class=\"p\">,</span> <span class=\"nx\">K</span> <span class=\"k\">extends</span> <span class=\"nx\">keyof</span> <span class=\"nx\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"nx\">obj</span><span class=\"o\">:</span> <span class=\"nx\">T</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"o\">:</span> <span class=\"nx\">K</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">any</span> <span class=\"p\">{</span>\n  <span class=\"k\">return</span> <span class=\"nx\">obj</span><span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">]</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">man</span><span class=\"o\">:</span> <span class=\"nx\">Man</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">18</span><span class=\"p\">,</span>\n    <span class=\"nx\">sex</span><span class=\"o\">:</span> <span class=\"s1\">&#39;man&#39;</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">getProperty</span><span class=\"p\">(</span><span class=\"nx\">man</span><span class=\"p\">,</span> <span class=\"s1\">&#39;sex&#39;</span><span class=\"p\">)</span>\n</code></pre></div><p>ç”¨ç±»å‹å˜é‡æ¥æ³¨é‡Šæ ‡è¯†ç¬¦çš„ç±»å‹æœ‰æ—¶ä¼šè§‰å¾—è¿˜æ˜¯ä¸å¤Ÿç²¾ç¡®ã€‚</p><blockquote>çŸ¥é“æ ‡è¯†ç¬¦çš„å¯èƒ½ç±»å‹ï¼Œç„¶åç»„åˆèµ·æ¥</blockquote><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Man</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n    <span class=\"nx\">study</span><span class=\"p\">()</span><span class=\"o\">:</span><span class=\"nx\">string</span> <span class=\"p\">{</span><span class=\"k\">return</span> <span class=\"s1\">&#39;&#39;</span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Women</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n    <span class=\"nx\">sing</span><span class=\"p\">()</span><span class=\"o\">:</span><span class=\"nx\">string</span><span class=\"p\">{</span><span class=\"k\">return</span> <span class=\"s1\">&#39;&#39;</span><span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"kd\">function</span> <span class=\"nx\">instance</span><span class=\"p\">(</span><span class=\"nx\">Class</span><span class=\"o\">:</span> <span class=\"nx\">Man</span> <span class=\"o\">|</span> <span class=\"nx\">Women</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">((</span><span class=\"o\">&lt;</span><span class=\"nx\">Man</span><span class=\"o\">&gt;</span><span class=\"nx\">Class</span><span class=\"p\">).</span><span class=\"nx\">study</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"o\">&lt;</span><span class=\"nx\">Man</span><span class=\"o\">&gt;</span><span class=\"nx\">Class</span><span class=\"p\">).</span><span class=\"nx\">study</span><span class=\"p\">()</span>\n    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"o\">&lt;</span><span class=\"nx\">Women</span><span class=\"o\">&gt;</span><span class=\"nx\">Class</span><span class=\"p\">).</span><span class=\"nx\">sing</span><span class=\"p\">()</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">man</span><span class=\"o\">:</span><span class=\"nx\">Man</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;å¤œæ›‰å®¸&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">18</span><span class=\"p\">,</span>\n    <span class=\"nx\">study</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;æˆ‘çˆ±å­¦ä¹ &#39;</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"kd\">let</span> <span class=\"nx\">women</span><span class=\"o\">:</span> <span class=\"nx\">Women</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">name</span><span class=\"o\">:</span> <span class=\"s1\">&#39;godness&#39;</span><span class=\"p\">,</span>\n    <span class=\"nx\">age</span><span class=\"o\">:</span> <span class=\"mi\">17</span><span class=\"p\">,</span>\n    <span class=\"nx\">sing</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;æˆ‘çˆ±å”±æ­Œ&#39;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">instance</span><span class=\"p\">(</span><span class=\"nx\">man</span><span class=\"p\">)</span>    <span class=\"c1\">// æˆ‘çˆ±å­¦ä¹ \n</span><span class=\"c1\"></span><span class=\"nx\">instance</span><span class=\"p\">(</span><span class=\"nx\">women</span><span class=\"p\">)</span>    <span class=\"c1\">// æˆ‘çˆ±å”±æ­Œ\n</span></code></pre></div><p>æœ‰äº¤å‰ç±»å‹ã€è”åˆç±»å‹ç­‰ï¼Œè€Œç±»å‹å‘½ååˆ™æ˜¯æ›´çµæ´»çš„ç±»å‹ç»„ç»‡æ–¹å¼ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å®˜ç½‘ğŸŒ°\n</span><span class=\"c1\"></span><span class=\"nx\">type</span> <span class=\"nx\">Name</span> <span class=\"o\">=</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n<span class=\"nx\">type</span> <span class=\"nx\">NameResolver</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">string</span><span class=\"p\">;</span>\n<span class=\"nx\">type</span> <span class=\"nx\">NameOrResolver</span> <span class=\"o\">=</span> <span class=\"nx\">Name</span> <span class=\"o\">|</span> <span class=\"nx\">NameResolver</span><span class=\"p\">;</span>\n<span class=\"kd\">function</span> <span class=\"nx\">getName</span><span class=\"p\">(</span><span class=\"nx\">n</span><span class=\"o\">:</span> <span class=\"nx\">NameOrResolver</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">Name</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">n</span> <span class=\"o\">===</span> <span class=\"s1\">&#39;string&#39;</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"nx\">n</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">else</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"nx\">n</span><span class=\"p\">();</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>ç±»å‹å¤šäº†ä¹‹åï¼Œæœ‰æ—¶å€™éœ€è¦å¯¹æŸä¸€ç±»å‹åšç‰¹åˆ«å¤„ç†ï¼Œäºæ˜¯æœ‰ç±»å‹æ–­è¨€ ï¼ˆ<code>&lt;ç±»å‹&gt;</code>ï¼‰ å’Œç±»å‹å®ˆå«ï¼ˆ<code>typeof</code>, <code>instanceof</code>, <code>in</code>ç­‰ï¼‰ã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡æ¡ä»¶åˆ¤æ–­æ¥é€‰æ‹©å“ªç§ç±»å‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å®˜ç½‘ğŸŒ°\n</span><span class=\"c1\"></span><span class=\"nx\">declare</span> <span class=\"kd\">function</span> <span class=\"nx\">f</span><span class=\"o\">&lt;</span><span class=\"nx\">T</span> <span class=\"k\">extends</span> <span class=\"kr\">boolean</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"nx\">x</span><span class=\"o\">:</span> <span class=\"nx\">T</span><span class=\"p\">)</span><span class=\"o\">:</span> <span class=\"nx\">T</span> <span class=\"k\">extends</span> <span class=\"kc\">true</span> <span class=\"o\">?</span> <span class=\"nx\">string</span> <span class=\"o\">:</span> <span class=\"nx\">number</span><span class=\"p\">;</span>\n<span class=\"c1\">// Type is &#39;string | number\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">x</span> <span class=\"o\">=</span> <span class=\"nx\">f</span><span class=\"p\">(</span><span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">random</span><span class=\"p\">()</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.5</span><span class=\"p\">)</span>\n</code></pre></div><p>å½“ç„¶äº†ï¼Œä»¥ä¸Šä»£ç å¥½å¤šçš„æ ‡è¯†ç¬¦æ˜¯æ²¡æœ‰å¿…è¦æ·»åŠ ç±»å‹æ³¨è§£çš„ã€‚</p><blockquote>ç±»å‹æ¨æ–­ï¼Œå³ï¼Œç±»å‹æ˜¯åœ¨å“ªé‡Œå¦‚ä½•è¢«æ¨æ–­çš„</blockquote><p>ç±»å‹æ³¨è§£ä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå³ä½¿æœ‰äº›åœ°æ–¹ä½ ä¸æ·»åŠ ç±»å‹æ³¨è§£ï¼ŒTypeScript ä¹Ÿä¼šé€šè¿‡ä¸Šä¸‹æ–‡å½’ç±»ç­‰æ–¹å¼æ‰¾åˆ°æœ€ä½³é€šç”¨ç±»å‹ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "TypeScript", 
                    "tagLink": "https://api.zhihu.com/topics/19766226"
                }
            ], 
            "comments": [
                {
                    "userName": "addamx", 
                    "userLink": "https://www.zhihu.com/people/8f763e1ea87a82390501b380c20d6515", 
                    "content": "æ¦‚æ‹¬å¾—çœŸå¥½ï¼Œå‰å‡ å¤©çœ‹handbookçœ‹å¾—æˆ‘æœ‰ç‚¹ä¹±ï¼Œç°åœ¨æ¸…æ™°äº†è®¸å¤šã€‚", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<p>å®˜æ–¹æ–‡æ¡£å„çŸ¥è¯†ç‚¹é—´å†…å®¹æœ‰äº¤å‰ï¼Œå¤šçœ‹å‡ éæ‰ç†å¾—æ¸…ğŸ˜‚</p>", 
                            "likes": 0, 
                            "replyToAuthor": "addamx"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/62069910", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 13, 
            "title": "è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä»æœªå¦‚æ­¤ç®€å•", 
            "content": "<h2>å•†å“ä¿¡æ¯æ”¹å˜å¸¦æ¥çš„çƒ¦æ¼</h2><blockquote>Talk is cheap. Show me the code. (è¯‘: å±è¯å°‘è¯´, æ”¾ç è¿‡æ¥)</blockquote><p><i>ä»¥ä¸‹æ‰€æœ‰ä»£ç å‚è§<a href=\"https://link.zhihu.com/?target=https%3A//codepen.io/yexiaochen/pen/rQmYQJ%3Feditors%3D0110\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Design pattern transformation</a>.</i></p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å•†å“çš„ä¿¡æ¯: ä»·æ ¼ &amp; æŠ˜æ‰£\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"nx\">price</span><span class=\"o\">:</span> <span class=\"mi\">100</span><span class=\"p\">,</span>\n    <span class=\"nx\">discount</span><span class=\"o\">:</span> <span class=\"mf\">0.8</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// é¡¾å®¢ä¿¡æ¯: æ˜¯å¦ä¸ºä¼šå‘˜ &amp; è´­ä¹°æ•°é‡ &amp; æ€»æ¶ˆè´¹ &amp; è´­ä¹°æ—¶é—´æˆ³\n</span><span class=\"c1\"></span><span class=\"k\">const</span> <span class=\"nx\">customer</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&#34;VIP&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"s2\">&#34;quantity&#34;</span><span class=\"o\">:</span> <span class=\"mi\">10</span><span class=\"p\">,</span>\n    <span class=\"s2\">&#34;total&#34;</span><span class=\"o\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// æ€»æ¶ˆè´¹è®¡ç®—æ–¹å¼\n</span><span class=\"c1\"></span><span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">info</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">VIP</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">price</span> <span class=\"o\">*</span> <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">quantity</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n        <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">price</span> <span class=\"o\">*</span> <span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">discount</span> <span class=\"o\">*</span> <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">quantity</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">total</span><span class=\"p\">(</span><span class=\"nx\">customer</span><span class=\"p\">);</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;customer&#39;</span><span class=\"p\">,</span> <span class=\"nx\">customer</span><span class=\"p\">);</span>\n<span class=\"c1\">// customer { VIP: true, quantity: 10, total: 800 }\n</span></code></pre></div><p>ä»ä»£ç ä¸­å¾ˆå®¹æ˜“çœ‹å¾—å‡ºæ¥, æˆ‘ä»¬å°±æ˜¯æƒ³å®ç°ä¸€ä¸ªç®€å•çš„è®¡è´¹åŠŸèƒ½. å¯ç°å®ä¸­, å•†å“çš„ä»·æ ¼å¯èƒ½å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„.</p><blockquote>data.price = 200</blockquote><p>ä»·æ ¼å˜åŠ¨å, æˆ‘ä»¬éœ€è¦åŠæ—¶åœ°è·å–æ€»æ¶ˆè´¹, é‚£ä¹ˆå°±å¿…é¡»é‡æ–°è°ƒç”¨ä¸‹ <b>total</b> è®¡è´¹.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">total</span><span class=\"p\">(</span><span class=\"nx\">customer</span><span class=\"p\">);</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;customer&#39;</span><span class=\"p\">,</span> <span class=\"nx\">customer</span><span class=\"p\">);</span>\n<span class=\"c1\">// customer { VIP: true, quantity: 10, total: 1600 }\n</span></code></pre></div><p>è¿™æ˜¯ä¸€ä¸ªå¤§æ•°æ®æ—¶ä»£, ä»»ä½•æ•°æ®éƒ½æœ‰ä»·å€¼. ç°åœ¨, æˆ‘ä»¬è¿˜æƒ³è¦æ¯æ¬¡è´­ä¹°æ—¶çš„æ—¶é—´ç‚¹.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">const</span> <span class=\"nx\">customer</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&#34;VIP&#34;</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"s2\">&#34;quantity&#34;</span><span class=\"o\">:</span> <span class=\"mi\">10</span><span class=\"p\">,</span>\n    <span class=\"s2\">&#34;total&#34;</span><span class=\"o\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"o\">+</span>   <span class=\"s2\">&#34;timeStamp&#34;</span><span class=\"o\">:</span> <span class=\"mi\">0</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// è·å–è´­ä¹°æ—¶é—´\n</span><span class=\"c1\"></span><span class=\"nx\">purchaseTime</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">info</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">timeStamp</span> <span class=\"o\">=</span> <span class=\"nb\">Date</span><span class=\"p\">.</span><span class=\"nx\">now</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>äºæ˜¯, æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‡½æ•°å°±å¤šäº†ä¸€ä¸ª.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nx\">total</span><span class=\"p\">(</span><span class=\"nx\">customer</span><span class=\"p\">)</span>\n<span class=\"nx\">purchaseTime</span><span class=\"p\">(</span><span class=\"nx\">customer</span><span class=\"p\">)</span>\n<span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;customer&#39;</span><span class=\"p\">,</span> <span class=\"nx\">customer</span><span class=\"p\">)</span>\n<span class=\"c1\">// { VIP: true, quantity: 10, total: 1600, timeStamp: 1542293676297 }\n</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬çš„éœ€æ±‚è¿˜æœ‰å¾ˆå¤š, è€Œä¸”ä¸åªä¸€ä¸ª <b>customer</b> å‘¢. é‚£ä¹ˆ, æ¯æ¬¡ä»·æ ¼å˜åŒ–æˆ‘ä»¬éœ€è¦æ‰§è¡Œå¾ˆå¤šæ­¥éª¤, æ¯æ¬¡å•Š, éº»çƒ¦å¾—å¾ˆ.</p><div class=\"highlight\"><pre><code class=\"language-diff\"><span class=\"gi\">+    const customer1 = {\n</span><span class=\"gi\">+    &#34;VIP&#34;: false,\n</span><span class=\"gi\">+    &#34;quantity&#34;: 8,\n</span><span class=\"gi\">+    &#34;total&#34;: 0,\n</span><span class=\"gi\">+    &#34;timeStamp&#34;: 0\n</span><span class=\"gi\">+    }\n</span><span class=\"gi\"></span>\n    total(customer)\n    purchaseTime(customer)\n    func(customer)\n    ...\n    funcN(customer1)\n    total(customer1)\n    purchaseTime(customer1)\n    func(customer1)\n    ...\n    funcN(customer)\n    ...\n    funcN(customerN)\n</code></pre></div><p>ç°åœ¨æˆ‘ä»¬å°±å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œè§‚å¯Ÿè€…æ¨¡å¼æ”¹é€ .</p><h2>ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ”¹é€ </h2><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ğŸŒ°ğŸ€„ï¸ä¸éš¾çœ‹å‡º, æ¯æ¬¡ä»·æ ¼å˜åŒ–æ—¶, æˆ‘ä»¬éƒ½éœ€è¦é‡å¤è°ƒç”¨æ»¡è¶³éœ€æ±‚çš„æ–¹æ³•. ä¸å¦¨æƒ³æƒ³, å¦‚æœæˆ‘ä»¬æŠŠè¿™äº›æ–¹æ³•å­˜å‚¨èµ·æ¥, ç­‰åˆ°ä»·æ ¼å˜åŒ–æ—¶å†å»ç»Ÿä¸€è°ƒç”¨, å²‚ä¸æ˜¯å¾ˆæ–¹ä¾¿. </p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†, è¿™å’Œä¹‹å‰æ‰€è¯´çš„è§‚å¯Ÿè€…æ¨¡å¼(<a href=\"https://link.zhihu.com/?target=https%3A//yexiaochen.github.io/%25E4%25BB%258E%25E8%25A7%2582%25E5%25AF%259F%25E8%2580%2585%25E6%25A8%25A1%25E5%25BC%258F%25E8%25AF%25B4%25E8%25B5%25B7/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä»è§‚å¯Ÿè€…æ¨¡å¼è¯´èµ·</a>)æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢? åœ¨æ­¤, æˆ‘ä»¬è¯•ç€ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ”¹é€ ä¸‹. </p><p>é¦–å…ˆï¼Œè§‚å¯Ÿè€…æ¨¡å¼éƒ½æ˜¯ä¸€ä¸ªå¥—è·¯. å…ˆä¸€ä¸ªç±»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨, å¯¹åˆ—è¡¨æœ‰å¢åˆ å’Œé€šçŸ¥æ›´æ–°åŠŸèƒ½. å¦ä¸€ä¸ªç±»åˆ™æ˜¯æä¾›äº†æ›´æ–°æ¥å£.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// è§‚å¯Ÿç›®æ ‡ç±»\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Subject</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">observerList</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">addObserver</span><span class=\"p\">(</span><span class=\"nx\">observer</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">observerList</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span><span class=\"nx\">observer</span><span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">notify</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">observerList</span><span class=\"p\">.</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">observer</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n      <span class=\"nx\">observer</span><span class=\"p\">.</span><span class=\"nx\">update</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">)</span>\n    <span class=\"p\">})</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// è§‚å¯Ÿè€…ç±»\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Observer</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">fn</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">update</span> <span class=\"o\">=</span> <span class=\"nx\">fn</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>æ¥ç€, æŠŠæˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„æ–¹æ³•åŒ…è£…ä¸€ä¸‹, å­˜å‚¨èµ·æ¥.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// å°†è¦é‡å¤ä½¿ç”¨çš„åŒ…è£…ä¸€ä¸‹\n</span><span class=\"c1\"></span><span class=\"nx\">observer1</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Observer</span><span class=\"p\">(</span><span class=\"nx\">total</span><span class=\"p\">)</span>\n<span class=\"nx\">observer2</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Observer</span><span class=\"p\">(</span><span class=\"nx\">purchaseTime</span><span class=\"p\">)</span>\n\n<span class=\"c1\">// å­˜èµ·æ¥\n</span><span class=\"c1\"></span><span class=\"kd\">let</span> <span class=\"nx\">subject</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Subject</span><span class=\"p\">()</span>\n<span class=\"nx\">subject</span><span class=\"p\">.</span><span class=\"nx\">addObserver</span><span class=\"p\">(</span><span class=\"nx\">observer1</span><span class=\"p\">)</span>\n<span class=\"nx\">subject</span><span class=\"p\">.</span><span class=\"nx\">addObserver</span><span class=\"p\">(</span><span class=\"nx\">observer2</span><span class=\"p\">)</span>\n</code></pre></div><p>æ¯æ¬¡ä»·æ ¼æ”¹å˜æ—¶, åªéœ€è¦é€šçŸ¥ä¸€ä¸‹å³å¯.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// è°ƒæ•´å•†å“ä»·æ ¼\n</span><span class=\"c1\"></span><span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">price</span> <span class=\"o\">=</span> <span class=\"mi\">100</span>\n<span class=\"nx\">subject</span><span class=\"p\">.</span><span class=\"nx\">notify</span><span class=\"p\">(</span><span class=\"nx\">customer</span><span class=\"p\">)</span>\n<span class=\"nx\">subject</span><span class=\"p\">.</span><span class=\"nx\">notify</span><span class=\"p\">(</span><span class=\"nx\">customer1</span><span class=\"p\">)</span>\n</code></pre></div><p>æ”¹é€ ç»“æŸ. åˆçœ‹èµ·æ¥, å¯èƒ½å˜å¾—ç¹çäº†. ä½†æ˜¯, é‡åˆ°å¤æ‚çš„æƒ…å†µ, è¿™ä¸å¤±æ˜¯ä¸€ä¸ªå¥½åŠæ³•. æ¥ä¸‹æ¥, æˆ‘ä»¬çœ‹çœ‹ç»“åˆ <code>Objec.defineProperty</code> ä¼šæœ‰ä»€ä¹ˆæƒŠå–œ.</p><h2>ä¸Objec.definePropertyç»“åˆ</h2><p>æ”¯ä»˜å®çš„èŠ±å‘—éƒ½å¯ä»¥è‡ªå·±è¿˜é’±äº†ğŸ¤£, æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦åˆ«äººç®¡ç€ğŸ˜. </p><p>å¤§å®¶éƒ½çŸ¥é“ç»è¿‡ <code>Objec.defineProperty</code> å¤„ç†çš„å¯¹è±¡, åœ¨è®¾ç½®å’Œè·å–å¯¹è±¡å±æ€§çš„æ—¶å€™, ä¼šè‡ªåŠ¨è§¦å‘å“åº” <code>set</code> å’Œ <code>get</code> æ–¹æ³•. åˆ©ç”¨è¿™ä¸€ç‚¹, æˆ‘ä»¬å°±å¯ä»¥åšåˆ°ç”Ÿæ´»è‡ªç†äº†.</p><p> ç†Ÿæ‚‰çš„é…æ–¹, ç†Ÿæ‚‰çš„å‘³é“. ç†Ÿæ‚‰çš„å¥—è·¯æˆ‘ä»¬ä¸å¦¨å†èµ°ä¸€é.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// è§‚å¯Ÿç›®æ ‡ç±»\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Dependency</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">watcherList</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">addObserver</span><span class=\"p\">(</span><span class=\"nx\">observer</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">watcherList</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span><span class=\"nx\">observer</span><span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">notify</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">watcherList</span><span class=\"p\">.</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">watcher</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n      <span class=\"nx\">watcher</span><span class=\"p\">.</span><span class=\"nx\">update</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">)</span>\n    <span class=\"p\">})</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// è§‚å¯Ÿç±»\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Watcher</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">fn</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">update</span> <span class=\"o\">=</span> <span class=\"nx\">fn</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>æˆ‘ä»¬æ­¤è¡Œçš„ç›®çš„, æ˜¯è¦åœ¨ <code>data.price</code> æˆ– <code>data.discount</code> æ”¹å˜æ—¶, ç¨‹åºèƒ½å¤Ÿè‡ªåŠ¨è§¦å‘, å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ. æ¢å¥è¯è¯´, é€šçŸ¥æ›´æ–°çš„æ—¶æœºæ˜¯åœ¨è®¾ç½® <code>data.price</code> æˆ– <code>data.discount</code> çš„æ—¶å€™.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">keys</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">).</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">key</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">value</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">]</span>\n    <span class=\"k\">const</span> <span class=\"nx\">dep</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Dependency</span><span class=\"p\">()</span>\n    <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">defineProperty</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n        <span class=\"nx\">set</span><span class=\"p\">(</span><span class=\"nx\">newVal</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"nx\">value</span> <span class=\"o\">=</span> <span class=\"nx\">newVal</span>\n            <span class=\"nx\">dep</span><span class=\"p\">.</span><span class=\"nx\">notify</span><span class=\"p\">()</span>\n        <span class=\"p\">},</span>\n        <span class=\"nx\">get</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n            <span class=\"k\">return</span> <span class=\"nx\">value</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">})</span>\n<span class=\"p\">})</span>\n</code></pre></div><p>å¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½ç»™äº†ä¸€ä¸ªä¾èµ–å®ä¾‹, ç®¡ç†è‡ªå·±çš„ä¾èµ–. è€ƒè™‘åˆ° <b>customer</b> æœ‰å¾ˆå¤šä¸ª, éœ€è¦é€šçŸ¥åˆ°ä½. </p><p>å¦å¤–, æ·»åŠ ä¾èµ–å’Œç®¡ç†ä¾èµ–, å‰è€…æ˜¯å› , åè€…æ˜¯æœ. åœ¨ç®¡ç†ä¹‹å‰æˆ‘ä»¬éœ€è¦æƒ³å¥½æ€ä¹ˆæ·»åŠ ä¾èµ–. </p><p>å›å¤´çœ‹ä¸€çœ‹.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// æ€»æ¶ˆè´¹è®¡ç®—æ–¹å¼\n</span><span class=\"c1\"></span><span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">info</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">VIP</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">price</span> <span class=\"o\">*</span> <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">quantity</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n        <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">total</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">price</span> <span class=\"o\">*</span> <span class=\"nx\">data</span><span class=\"p\">.</span><span class=\"nx\">discount</span> <span class=\"o\">*</span> <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">quantity</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// è·å–è´­ä¹°æ—¶é—´\n</span><span class=\"c1\"></span><span class=\"nx\">purchaseTime</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">info</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">info</span><span class=\"p\">.</span><span class=\"nx\">timeStamp</span> <span class=\"o\">=</span> <span class=\"nb\">Date</span><span class=\"p\">.</span><span class=\"nx\">now</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n</code></pre></div><p>æˆ‘ä»¬å‘ç°, <b>total</b> å‡½æ•°ä¾èµ–äº <code>data.price</code> æˆ– <code>data.discount</code> çš„. å¦‚æœæˆ‘ä»¬åœ¨è·å–å±æ€§æ—¶å»æ·»åŠ ä¾èµ–å€’æ˜¯ä¸€ä¸ªå¥½æ—¶æœº.</p><div class=\"highlight\"><pre><code class=\"language-diff\">class Dependency {\n    // çœç•¥\n}\n<span class=\"gi\">+   Dependency.targey = null;\n</span><span class=\"gi\"></span>\nclass Watcher {\n    constructor(fn, key) {\n        this.update = fn\n<span class=\"gi\">+        this.key = key\n</span><span class=\"gi\">+        this.value = this.getter()\n</span><span class=\"gi\"></span>    }\n<span class=\"gi\">+    getter() {\n</span><span class=\"gi\">+        Dependency.targey = this;\n</span><span class=\"gi\">+        // è§¦å‘ä¸‹é¢çš„get()\n</span><span class=\"gi\">+        this.value = data[this.key];\n</span><span class=\"gi\">+        Dependency.targey = null;\n</span><span class=\"gi\">+    }\n</span><span class=\"gi\"></span>}\n\nObject.keys(data).forEach(key =&gt; {\n    let value = data[key]\n    const dep = new Dependency()\n    Object.defineProperty(data, key, {\n        set(newVal) {\n            value = newVal\n            dep.notify()\n        },\n        get() {\n<span class=\"gi\">+            if (Dependency.targey) {\n</span><span class=\"gi\">+                dep.addObserver(Dependency.targey)\n</span><span class=\"gi\">+            }\n</span><span class=\"gi\"></span>            return value\n        }\n    })\n})\n</code></pre></div><p>ç„¶è€Œ <b>purchaseTime</b> æ–¹æ³•é‡Œå¹¶æ²¡æœ‰ <code>data.price</code> æˆ– <code>data.discount</code> å¯ä»¥è®¾ç½®. æ‰€ä»¥è¿™ä¸ªæ–¹æ³•è¡Œä¸é€š. é‚£ä¹ˆ, å¹²è„†ç´§æ¥ç€ä¾èµ–å®ä¾‹å»æ·»åŠ ä¾èµ–å§. åŒæ—¶è€ƒè™‘åˆ°å¤šä¸ª <b>customer</b>, æˆ‘ä»¬å°è£…ä¸‹.</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// ä¸definePropertyç»“åˆ\n</span><span class=\"c1\"></span><span class=\"kd\">function</span> <span class=\"nx\">defineReactive</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"nx\">watcherList</span><span class=\"p\">,</span> <span class=\"nx\">funcList</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">keys</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">).</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">key</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">value</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">]</span>\n    <span class=\"k\">const</span> <span class=\"nx\">dep</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Dependency</span><span class=\"p\">()</span>\n    <span class=\"nx\">funcList</span><span class=\"p\">.</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">func</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n      <span class=\"nx\">dep</span><span class=\"p\">.</span><span class=\"nx\">addObserver</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Watcher</span><span class=\"p\">(</span><span class=\"nx\">func</span><span class=\"p\">))</span>\n    <span class=\"p\">})</span>\n    <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">defineProperty</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"nx\">key</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n      <span class=\"nx\">set</span><span class=\"p\">(</span><span class=\"nx\">newVal</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"nx\">value</span> <span class=\"o\">=</span> <span class=\"nx\">newVal</span>\n        <span class=\"nx\">watcherList</span><span class=\"p\">.</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">watcher</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n          <span class=\"nx\">dep</span><span class=\"p\">.</span><span class=\"nx\">notify</span><span class=\"p\">(</span><span class=\"nx\">watcher</span><span class=\"p\">)</span>\n        <span class=\"p\">})</span>\n      <span class=\"p\">},</span>\n      <span class=\"nx\">get</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"nx\">value</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">})</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">defineReactive</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"nx\">customer</span><span class=\"p\">,</span> <span class=\"nx\">customer1</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"nx\">total</span><span class=\"p\">,</span> <span class=\"nx\">purchaseTime</span><span class=\"p\">])</span>\n</code></pre></div><p>å¤§åŠŸå‘Šæˆ, ä»·æ ¼å˜åŠ¨æ—¶, æˆ‘ä»¬å°±ä¼šè‡ªåŠ¨è·å–åˆ°æƒ³è¦çš„ç»“æœäº†. </p><p>æˆ‘éƒ½èƒ½è‡ªç†äº†, ä½ èŠ±å‘—ä¸ºå˜›è¿˜ä¸èƒ½è‡ªå·±è¿˜é’±å‘¢ğŸ˜’</p><p><b>è§‚å¯Ÿè€…æ¨¡å¼ç³»åˆ—:</b></p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E4%25BB%258E%25E8%25A7%2582%25E5%25AF%259F%25E8%2580%2585%25E6%25A8%25A1%25E5%25BC%258F%25E8%25AF%25B4%25E8%25B5%25B7/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">ä»è§‚å¯Ÿè€…æ¨¡å¼è¯´èµ·</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E8%25BF%259B%25E5%2587%25BB%25E7%259A%2584%25E8%25A7%2582%25E5%25AF%259F%25E8%2580%2585%25E6%25A8%25A1%25E5%25BC%258F/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è¿›å‡»çš„è§‚å¯Ÿè€…æ¨¡å¼</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.yexiaochen.com/%25E8%25A7%2582%25E5%25AF%259F%25E8%2580%2585%25E6%25A8%25A1%25E5%25BC%258F%25E5%2586%258D%25E6%25AC%25A1%25E8%25BF%259B%25E9%2598%25B6/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">è§‚å¯Ÿè€…æ¨¡å¼å†æ¬¡è¿›é˜¶-å‘å¸ƒ/è®¢é˜…</a></li></ul>", 
            "topic": [
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "è®¾è®¡æ¨¡å¼", 
                    "tagLink": "https://api.zhihu.com/topics/19599592"
                }
            ], 
            "comments": [
                {
                    "userName": "å‘µå‘µå“’", 
                    "userLink": "https://www.zhihu.com/people/39a3bcb9da54b1a65eab6cd51476042d", 
                    "content": "è¿™ç¯‡æ–‡ç« åº”è¯¥æ”¹ä¸ºä»vueæºç çœ‹è§‚å¯Ÿè€…æ¨¡å¼[æœºæ™º]", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "è¿™è¯æˆ‘ä¸æ•¢è¯´ï¼Œå› ä¸ºæˆ‘æ²¡çœ‹è¿‡vueæºç [æ‚è„¸]", 
                            "likes": 0, 
                            "replyToAuthor": "å‘µå‘µå“’"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/61018434", 
            "userName": "æ›‰å®¸", 
            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
            "upvote": 157, 
            "title": "ä»å‰ç«¯è§’åº¦å½»åº•ææ‡‚ DIPã€IoCã€DIã€JS", 
            "content": "<p>åœ¨è¿™ä¸ªæ ‡é¢˜ä¸­ï¼Œé™¤äº† <b>JS</b> æ˜¯ä¹±å…¥ä¹‹å¤–ï¼Œå…¶å®ƒçš„å‡ ä¸ªè¯æ±‡éƒ½æ˜¯å­˜åœ¨ä¸€ä¸ªå…±åŒç‚¹çš„ï¼Œé‚£å°±æ˜¯ä¾èµ–ã€‚</p><blockquote>é‚£ä¹ˆï¼Œä¾èµ–æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</blockquote><p>æ¯”å¦‚ï¼Œç°åœ¨æˆ‘æ­£åœ¨å†™è¿™ç¯‡åšå®¢æ–‡ï¼Œä½†æ˜¯æˆ‘å¾—åœ¨ç”µè„‘ä¸Šç¼–è¾‘ï¼Œç”µè„‘ä¾¿æ˜¯æˆ‘å®Œæˆè¿™ä»¶äº‹çš„ä¾èµ–ã€‚è€Œåœ¨ä»£ç ä¸­ï¼Œæœ€ç›´è§‚çš„ä½“ç°æ˜¯æ¨¡å—ä¹‹é—´çš„ä¾èµ–ã€‚å¦‚æŸä¸ªæ¨¡å—ä¾èµ–å¦å¤–ä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆå¦å¤–çš„é‚£ä¸ªæ¨¡å—å°±æ˜¯è¯¥æ¨¡å—çš„ä¾èµ–ã€‚å…¶å®åœ¨ä¸Šç¯‡åšå®¢æ–‡ç« ã€Š<a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/JaVaScript%25E4%25B8%25AD%25E7%259A%2584%25E6%25A8%25A1%25E5%259D%2597/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JaVaScriptä¸­çš„æ¨¡å—</a>ã€‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ‰‹å†™äº†ä¸€ä¸ªæ¨¡å—ä¾èµ–ç®¡ç†å™¨ã€‚</p><p>ä¾èµ–è¿™ä¸ªç†è§£èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¿™ä¸ä»£è¡¨å¯ä»¥éšæ„çš„ä¾èµ–ã€‚åœ¨å†™æ¨¡å—çš„æ—¶å€™ï¼Œè®²ç©¶ä¸ªé«˜å†…èšä½è€¦åˆï¼Œä»¥æé«˜æ¨¡å—çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ¨¡å—ä¾èµ–äº†è°ï¼Œæ€ä¹ˆå»ä¾èµ–ï¼Œéƒ½å…³ä¹äº†æœ€ç»ˆæ¨¡å—çš„å¥½ä¸åã€‚</p><p>è¿˜å¥½åœ¨ç¼–ç¨‹ç•Œæœ‰ç€æé«˜ä»£ç è´¨é‡çš„é‡‘ç§‘ç‰å¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç†è®ºæ¥æŒ‡å¯¼å®è·µï¼Œå†™å‡ºæ›´å¥½çš„ä»£ç ã€‚</p><h2>ä¾èµ–åè½¬åŸåˆ™</h2><blockquote>ä¾èµ–åè½¬åŸåˆ™ï¼ˆDependency inversion principleï¼ŒDIPï¼‰ï¼Œæ˜¯ä¸€ç§ç‰¹å®šçš„è§£è€¦å½¢å¼ï¼Œä½¿å¾—é«˜å±‚æ¬¡çš„æ¨¡å—ä¸ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—çš„å®ç°ç»†èŠ‚ï¼Œä¾èµ–å…³ç³»è¢«é¢ å€’ï¼ˆåè½¬ï¼‰ï¼Œä»è€Œä½¿å¾—ä½å±‚æ¬¡æ¨¡å—ä¾èµ–äºé«˜å±‚æ¬¡æ¨¡å—çš„éœ€æ±‚æŠ½è±¡ã€‚â€”â€”â€”â€” ç»´åŸºç™¾ç§‘</blockquote><p>è¯¥åŸåˆ™è§„å®šï¼š</p><ol><li>é«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä¸ä½å±‚æ¬¡çš„æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚</li><li>æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ã€‚è€Œå…·ä½“å®ç°åˆ™åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚</li></ol><p>ç°åœ¨ç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€æ³¢ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Ajax.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Ajax</span> <span class=\"p\">{</span>\n  <span class=\"nx\">get</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Ajax</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// main.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"nx\">Ajax</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Ajax&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">()</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Ajax</span><span class=\"p\">()).</span><span class=\"nx\">get</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;content from&#39;</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">();</span>\n</code></pre></div><p>åˆšå¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŸºäº <b>XMLHttpRequest</b> å¯¹è±¡ï¼Œå°è£…äº† Ajax ç”¨äºè¯·æ±‚æ•°æ®ã€‚åæ¥ <b>fetch</b> å‡ºæ¥äº†ï¼Œæˆ‘ä»¬æ‰“ç®—è·Ÿä¸Šæ—¶ä»£çš„è„šæ­¥ï¼Œå°è£… <b>fetch</b> ä»¥å–ä»£ <b>Ajax</b>ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Fetch.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Fetch</span> <span class=\"p\">{</span>\n  <span class=\"nx\">fetch</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Fetch</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// main.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"nx\">Fetch</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Fetch&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Fetch</span><span class=\"p\">()).</span><span class=\"nx\">fetch</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;content from&#39;</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">();</span>\n</code></pre></div><p>ä»ä»¥ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ•´ä¸ªæ›¿ä»£è¿‡ç¨‹å¾ˆéº»çƒ¦ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºå°è£…è¯·æ±‚æ¨¡å—ï¼ˆ<b>Ajax</b>ã€<b>Fetch</b>ï¼‰çš„æ‰€æœ‰å¼•ç”¨ï¼Œç„¶åæ›¿æ¢æ‰ã€‚åˆç”±äº <b>Ajax</b>ã€<b>Fetch</b> çš„æ–¹æ³•å‘½åä¹Ÿæ˜¯ä¸åŒï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å¯¹åº”åœ°åšæ›´æ”¹ã€‚</p><p>è¿™å°±æ˜¯ä¼ ç»Ÿçš„å¤„ç†ä¾èµ–å…³ç³»çš„æ–¹å¼ã€‚åœ¨è¿™é‡Œ <b>Main</b> æ˜¯é«˜å±‚æ¬¡æ¨¡å—ï¼Œ<b>Ajax</b>ã€<b>Fetch</b> æ˜¯ä½å±‚æ¬¡æ¨¡å—ã€‚ä¾èµ–å…³ç³»åˆ›å»ºäºé«˜å±‚æ¬¡æ¨¡å—ï¼Œä¸”é«˜å±‚æ¬¡æ¨¡å—ç›´æ¥ä¾èµ–ä½å±‚æ¬¡æ¨¡å—ï¼Œè¿™ç§ä¾èµ–å…³ç³»é™åˆ¶äº†é«˜å±‚æ¬¡æ¨¡å—çš„å¤ç”¨æ€§ã€‚</p><p>ä¾èµ–åè½¬åŸåˆ™åˆ™é¢ å€’è¿™ç§ä¾èµ–å…³ç³»ï¼Œå¹¶ä»¥ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªè§„å®šä½œä¸ºæŒ‡å¯¼æ€æƒ³ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Service.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Service</span> <span class=\"p\">{</span>\n  <span class=\"nx\">request</span><span class=\"p\">(){</span>\n    <span class=\"k\">throw</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\"> æ²¡æœ‰å®ç° request æ–¹æ³•ï¼`</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Ajax</span> <span class=\"k\">extends</span> <span class=\"nx\">Service</span> <span class=\"p\">{</span>\n  <span class=\"nx\">request</span><span class=\"p\">(){</span>\n      <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Ajax</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// Main.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"nx\">Service</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Service.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Service</span><span class=\"p\">).</span><span class=\"nx\">request</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;content from&#39;</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">();</span>\n</code></pre></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠå…±åŒä¾èµ–çš„ <b>Service</b> ä½œä¸ºæŠ½è±¡æ¥å£ï¼Œå®ƒå°±æ˜¯é«˜å±‚æ¬¡æ¨¡å—ä¸ä½å±‚æ¬¡æ¨¡å—éœ€è¦å…±åŒéµå®ˆçš„å¥‘çº¦ã€‚åœ¨é«˜å±‚æ¬¡æ¨¡å—ä¸­ï¼Œå®ƒä¼šé»˜è®¤ <b>Service</b> ä¼šæœ‰ <b>request</b> æ–¹æ³•ç”¨æ¥è¯·æ±‚æ•°æ®ã€‚åœ¨ä½å±‚æ¬¡æ¨¡å—ä¸­ï¼Œå®ƒä¼šéµä» <b>Service</b> å¤å†™åº”è¯¥å­˜åœ¨çš„æ–¹æ³•ã€‚è¿™åœ¨ã€Š<a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/%25E5%259C%25A8JavaScript%25E4%25B8%25AD%25E5%25B0%259D%25E8%25AF%2595%25E7%25BB%2584%25E5%2590%2588%25E6%25A8%25A1%25E5%25BC%258F/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">åœ¨JavaScriptä¸­å°è¯•ç»„åˆæ¨¡å¼</a>ã€‹ä¸­ï¼Œæ— è®ºåˆ†æ”¯å¯¹è±¡è¿˜æ˜¯å¶å¯¹è±¡éƒ½å®ç° <code>expense()</code> æ–¹æ³•çš„é“ç†å·®ä¸å¤šã€‚</p><p>å³ä½¿åæ¥éœ€è¦å°è£… <b>axios</b> å–ä»£ <b>fetch</b>ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦åœ¨ <b>Service.js</b> ä¸­ä¿®æ”¹å³å¯ã€‚</p><p>å†æ¬¡å›é¡¾ä¸‹ä¼ ç»Ÿçš„ä¾èµ–å…³ç³»ã€‚</p><blockquote>ä¾èµ–å…³ç³»åˆ›å»ºäºé«˜å±‚æ¬¡æ¨¡å—ï¼Œä¸”é«˜å±‚æ¬¡æ¨¡å—ç›´æ¥ä¾èµ–ä½å±‚æ¬¡æ¨¡å—ã€‚</blockquote><p>ç»è¿‡ä»¥ä¸Šçš„æŠ˜è…¾ï¼Œæˆ‘ä»¬å……å…¶é‡åªæ˜¯è§£å†³äº†é«˜å±‚æ¬¡æ¨¡å—ç›´æ¥ä¾èµ–ä½å±‚æ¬¡æ¨¡å—çš„é—®é¢˜ã€‚é‚£ä¹ˆä¾èµ–å…³ç³»åˆ›å»ºäºé«˜å±‚æ¬¡æ¨¡å—çš„é—®é¢˜å‘¢ï¼Ÿ</p><h2>æ§åˆ¶åè½¬</h2><p>å¦‚æœè¯´ä¾èµ–åè½¬åŸåˆ™å‘Šè¯‰æˆ‘ä»¬è¯¥ä¾èµ–è°ï¼Œé‚£ä¹ˆæ§åˆ¶åè½¬åˆ™å‘Šè¯‰ä»¬è°åº”è¯¥æ¥æ§åˆ¶ä¾èµ–ã€‚</p><p>åƒä¸Šé¢çš„ <b>Main</b> æ¨¡å—ï¼Œå®ƒä¾èµ– <b>Service</b> æ¨¡å—ã€‚ä¸ºäº†è·å¾— <b>Service</b> å®ä¾‹çš„å¼•ç”¨ï¼Œ<b>Main</b> åœ¨å†…éƒ¨é è‡ªèº« <code>new</code> å‡ºäº†ä¸€ä¸ª <b>Service</b> å®ä¾‹ã€‚è¿™æ ·æ˜æ˜¾åœ°å¼•ç”¨å…¶å®ƒæ¨¡å—ï¼Œæ— å¼‚åŠ å¤§äº†æ¨¡å—é—´çš„è€¦åˆã€‚</p><blockquote>æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼ŒIoCï¼‰ï¼Œé€šè¿‡æ§åˆ¶åè½¬ï¼Œå¯¹è±¡åœ¨è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæ§åˆ¶ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¤–ç•Œå®ä½“ï¼Œå°†å…¶æ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™å®ƒã€‚å¯ä»¥è¯´ï¼Œä¾èµ–è¢«æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚â€”â€”â€”â€” ç»´åŸºç™¾ç§‘</blockquote><p>è¿™äº›è¯çš„æ„æ€å°±æ˜¯å°†ä¾èµ–å¯¹è±¡çš„åˆ›å»ºå’Œç»‘å®šè½¬ç§»åˆ°è¢«ä¾èµ–å¯¹è±¡ç±»çš„å¤–éƒ¨æ¥å®ç°ã€‚å®ç°æ§åˆ¶åè½¬æœ€å¸¸è§çš„æ–¹å¼æ˜¯ä¾èµ–æ³¨å…¥ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼ä¾èµ–æŸ¥æ‰¾ã€‚</p><h3>ä¾èµ–æ³¨å…¥</h3><blockquote>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ï¼Œåœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œä¾èµ–æ³¨å…¥æ˜¯ç§å®ç°æ§åˆ¶åè½¬ç”¨äºè§£å†³ä¾èµ–æ€§è®¾è®¡æ¨¡å¼ã€‚ä¸€ä¸ªä¾èµ–å…³ç³»æŒ‡çš„æ˜¯å¯è¢«åˆ©ç”¨çš„ä¸€ç§å¯¹è±¡ï¼ˆå³æœåŠ¡æä¾›ç«¯ï¼‰ã€‚ä¾èµ–æ³¨å…¥æ˜¯å°†æ‰€ä¾èµ–çš„ä¼ é€’ç»™å°†ä½¿ç”¨çš„ä»å±å¯¹è±¡ï¼ˆå³å®¢æˆ·ç«¯ï¼‰ã€‚è¯¥æœåŠ¡å°†ä¼šå˜æˆå®¢æˆ·ç«¯çš„çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚ä¼ é€’æœåŠ¡ç»™å®¢æˆ·ç«¯ï¼Œè€Œéå…è®¸å®¢æˆ·ç«¯æ¥å»ºç«‹æˆ–å¯»æ‰¾æœåŠ¡ï¼Œæ˜¯æœ¬è®¾è®¡æ¨¡å¼çš„åŸºæœ¬è¦æ±‚ã€‚</blockquote><p>æ²¡çœ‹æ‡‚ï¼Ÿæ²¡å…³ç³»ã€‚è¿™å¥è¯è®²çš„æ˜¯ï¼ŒæŠŠè¿‡ç¨‹æ”¾åœ¨å¤–é¢ï¼Œå°†ç»“æœå¸¦å…¥å†…éƒ¨ã€‚åœ¨ã€Š<a href=\"https://link.zhihu.com/?target=http%3A//www.yexiaochen.com/JaVaScript%25E4%25B8%25AD%25E7%259A%2584%25E6%25A8%25A1%25E5%259D%2597/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">JaVaScriptä¸­çš„æ¨¡å—</a>ã€‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»ç”¨åˆ°è¿‡ä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯<code>å¯¹äºä¾èµ–æ¨¡å—çš„æ¨¡å—ï¼Œåˆ™æŠŠä¾èµ–ä½œä¸ºå‚æ•°ä½¿ç”¨</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å†æ¬¡æ”¹é€ ä¸‹ï¼Œ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Service.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Service</span> <span class=\"p\">{</span>\n  <span class=\"nx\">request</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">throw</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\"> æ²¡æœ‰å®ç° request æ–¹æ³•ï¼`</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">class</span> <span class=\"nx\">Ajax</span> <span class=\"k\">extends</span> <span class=\"nx\">Service</span> <span class=\"p\">{</span>\n  <span class=\"nx\">request</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Ajax</span><span class=\"p\">;</span>\n<span class=\"c1\">// Main.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">Service</span> <span class=\"o\">=</span> <span class=\"nx\">options</span><span class=\"p\">.</span><span class=\"nx\">Service</span><span class=\"p\">;</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">Service</span><span class=\"p\">.</span><span class=\"nx\">request</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;content from&#39;</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Main</span><span class=\"p\">;</span>\n<span class=\"c1\">// index.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"nx\">Service</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Service.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"nx\">Main</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Main.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">({</span>\n  <span class=\"nx\">Service</span><span class=\"o\">:</span> <span class=\"k\">new</span> <span class=\"nx\">Service</span><span class=\"p\">()</span>\n<span class=\"p\">})</span>\n</code></pre></div><p>åœ¨ <b>Main</b> æ¨¡å—ä¸­, <b>Service</b> çš„å®ä¾‹åŒ–æ˜¯åœ¨å¤–éƒ¨å®Œæˆï¼Œå¹¶åœ¨ <code>index.js</code> ä¸­æ³¨å…¥ã€‚ç›¸æ¯”ä¸Šä¸€æ¬¡ï¼Œæ”¹åŠ¨åçš„ä»£ç å¹¶æ²¡æœ‰çœ‹å‡ºå¸¦æ¥å¤šå¤§çš„å¥½å¤„ã€‚å¦‚æœæˆ‘ä»¬å†å¢åŠ ä¸€ä¸ªæ¨¡å—å‘¢ï¼Ÿ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"k\">class</span> <span class=\"nx\">Router</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">init</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;Router::init&#39;</span><span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Router</span><span class=\"p\">;</span>\n<span class=\"err\">#</span> <span class=\"nx\">Main</span><span class=\"p\">.</span><span class=\"nx\">js</span>\n<span class=\"o\">+</span>   <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">Service</span> <span class=\"o\">=</span> <span class=\"nx\">options</span><span class=\"p\">.</span><span class=\"nx\">Router</span><span class=\"p\">;</span>\n\n<span class=\"err\">#</span> <span class=\"nx\">index</span><span class=\"p\">.</span><span class=\"nx\">js</span>\n<span class=\"o\">+</span>   <span class=\"k\">import</span> <span class=\"nx\">Router</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Router.js&#39;</span>\n    <span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">({</span>\n<span class=\"o\">+</span>        <span class=\"nx\">Router</span><span class=\"o\">:</span> <span class=\"k\">new</span> <span class=\"nx\">Service</span><span class=\"p\">()</span>\n    <span class=\"p\">})</span>\n</code></pre></div><p>è‹¥æ˜¯å†…éƒ¨å®ä¾‹åŒ–å°±ä¸å¥½å¤„ç†äº†ã€‚å¯æ¢æˆä¾èµ–æ³¨å…¥åï¼Œè¿™ä¸ªé—®é¢˜å°±å¾ˆå¥½è§£å†³äº†ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// utils.js\n</span><span class=\"c1\"></span><span class=\"k\">export</span> <span class=\"k\">const</span> <span class=\"nx\">toOptions</span> <span class=\"o\">=</span> <span class=\"nx\">params</span> <span class=\"p\">=&gt;</span>\n  <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">entries</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">).</span><span class=\"nx\">reduce</span><span class=\"p\">((</span><span class=\"nx\">accumulator</span><span class=\"p\">,</span> <span class=\"nx\">currentValue</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">accumulator</span><span class=\"p\">[</span><span class=\"nx\">currentValue</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">currentValue</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]()</span>\n    <span class=\"k\">return</span> <span class=\"nx\">accumulator</span><span class=\"p\">;</span>\n  <span class=\"p\">},</span> <span class=\"p\">{});</span>\n\n<span class=\"c1\">// Main.js\n</span><span class=\"c1\"></span><span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">assign</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">);</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">Service</span><span class=\"p\">.</span><span class=\"nx\">request</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;content from&#39;</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Main</span><span class=\"p\">;</span>\n\n<span class=\"c1\">// index.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"nx\">Service</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Service.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"nx\">Router</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Router.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"nx\">Main</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Main.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">toOptions</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./utils.js&#39;</span>\n<span class=\"cm\">/**\n</span><span class=\"cm\"> * toOptions è½¬æ¢æˆå‚æ•°å½¢å¼\n</span><span class=\"cm\"> * @params {Object} ç±»\n</span><span class=\"cm\"> * @return {Object} {Service: Serviceå®ä¾‹, Router: Routerå®ä¾‹}\n</span><span class=\"cm\"> */</span>\n<span class=\"k\">const</span> <span class=\"nx\">options</span> <span class=\"o\">=</span> <span class=\"nx\">toOptions</span><span class=\"p\">({</span><span class=\"nx\">Service</span><span class=\"p\">,</span> <span class=\"nx\">Router</span><span class=\"p\">});</span>\n<span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">);</span>\n</code></pre></div><p>å› ä¸ºä¾èµ–æ³¨å…¥æŠŠä¾èµ–çš„å¼•ç”¨ä»å¤–éƒ¨å¼•å…¥ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ <code>Object.assign(this, options)</code> æ–¹å¼ï¼ŒæŠŠä¾èµ–å…¨éƒ¨åŠ åˆ°äº† <b>this</b> ä¸Šã€‚å³ä½¿å†å¢åŠ æ¨¡å—ï¼Œä¹Ÿåªéœ€è¦åœ¨ <code>index.js</code> ä¸­å¼•å…¥å³å¯ã€‚</p><p>åˆ°äº†è¿™é‡Œï¼Œ<b>DIP</b>ã€<b>IoC</b>ã€<b>DI</b> çš„æ¦‚å¿µåº”è¯¥æœ‰ä¸ªæ¸…æ™°çš„è®¤è¯†äº†ã€‚ç„¶åæˆ‘ä»¬å†ç»“åˆå®é™…ï¼ŒåŠ ä¸ªåŠŸèƒ½å†æ¬¡å·©å›ºä»¥ä¸‹ã€‚</p><p>ä½œä¸ºä¸€ä¸ªåŠŸèƒ½ç‹¬ç«‹çš„æ¨¡å—ï¼Œä¸€èˆ¬éƒ½æœ‰ä¸ªåˆå§‹åŒ–çš„è¿‡ç¨‹ã€‚</p><p>ç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯éµå®ˆä¸€ä¸ªåˆå§‹åŒ–çš„çº¦å®šï¼Œå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Interface.js\n</span><span class=\"c1\"></span><span class=\"k\">export</span> <span class=\"k\">class</span> <span class=\"nx\">Service</span> <span class=\"p\">{</span>\n  <span class=\"nx\">request</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">throw</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\"> æ²¡æœ‰å®ç° request æ–¹æ³•ï¼`</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">class</span> <span class=\"nx\">Init</span> <span class=\"p\">{</span>\n  <span class=\"nx\">init</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">throw</span> <span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"si\">}</span><span class=\"sb\"> æ²¡æœ‰å®ç° init æ–¹æ³•ï¼`</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"c1\">// Service.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">Init</span><span class=\"p\">,</span> <span class=\"nx\">Service</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Interface.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">mix</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./utils.js&#39;</span>\n<span class=\"k\">class</span> <span class=\"nx\">Ajax</span> <span class=\"k\">extends</span> <span class=\"nx\">mix</span><span class=\"p\">(</span><span class=\"nx\">Init</span><span class=\"p\">,</span> <span class=\"nx\">Service</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">super</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">init</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;Service::init&#39;</span><span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">request</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">constructor</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Ajax</span><span class=\"p\">;</span>\n</code></pre></div><p><b>Main</b>ã€<b>Service</b>ã€<b>Router</b> éƒ½ä¾èµ– <b>Init</b> æ¥å£ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯ä¸€ç§åå®šï¼‰ï¼Œ<b>Service</b> æ¨¡å—æ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥åšäº† <b>Mixin</b> å¤„ç†ã€‚è¦åšåˆ°ç»Ÿä¸€åˆå§‹åŒ–ï¼Œ<b>Main</b> è¿˜éœ€è¦åšäº›äº‹ã€‚</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// Main.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">Init</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Interface.js&#39;</span>\n<span class=\"k\">class</span> <span class=\"nx\">Main</span> <span class=\"k\">extends</span> <span class=\"nx\">Init</span> <span class=\"p\">{</span>\n  <span class=\"nx\">constructor</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">super</span><span class=\"p\">();</span>\n    <span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">assign</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">);</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">options</span> <span class=\"o\">=</span> <span class=\"nx\">options</span><span class=\"p\">;</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">init</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"p\">(</span><span class=\"nb\">Object</span><span class=\"p\">.</span><span class=\"nx\">values</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">options</span><span class=\"p\">)).</span><span class=\"nx\">map</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"p\">=&gt;</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">());</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;Main::init&#39;</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">render</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">content</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">Service</span><span class=\"p\">.</span><span class=\"nx\">request</span><span class=\"p\">();</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"s1\">&#39;content from&#39;</span><span class=\"p\">,</span> <span class=\"nx\">content</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"nx\">Main</span><span class=\"p\">;</span>\n</code></pre></div><p>è‡³æ­¤ï¼Œç»“æŸ</p><div class=\"highlight\"><pre><code class=\"language-js\"><span class=\"c1\">// index.js\n</span><span class=\"c1\"></span><span class=\"k\">import</span> <span class=\"nx\">Service</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Service.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"nx\">Router</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Router.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"nx\">Main</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Main.js&#39;</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">toOptions</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./utils.js&#39;</span>\n\n<span class=\"cm\">/**\n</span><span class=\"cm\"> * toOptions\n</span><span class=\"cm\"> * è½¬æ¢æˆå‚æ•°å½¢å¼\n</span><span class=\"cm\"> * @params {Object} ç±»\n</span><span class=\"cm\"> * @return {Object}\n</span><span class=\"cm\"> * {\n</span><span class=\"cm\"> *    Service: Serviceå®ä¾‹,\n</span><span class=\"cm\"> *    Router: Routerå®ä¾‹\n</span><span class=\"cm\"> * }\n</span><span class=\"cm\"> */</span>\n<span class=\"k\">const</span> <span class=\"nx\">options</span> <span class=\"o\">=</span> <span class=\"nx\">toOptions</span><span class=\"p\">({</span> <span class=\"nx\">Service</span><span class=\"p\">,</span> <span class=\"nx\">Router</span> <span class=\"p\">});</span>\n\n<span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Main</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">)).</span><span class=\"nx\">init</span><span class=\"p\">();</span>\n\n<span class=\"c1\">//  content from Ajax\n</span><span class=\"c1\">//  Service::init\n</span><span class=\"c1\">//  Router::init\n</span><span class=\"c1\">//  Main::init\n</span></code></pre></div><p>ä»¥ä¸Šæ‰€æœ‰ç¤ºä¾‹å¯è§<a href=\"https://link.zhihu.com/?target=https%3A//github.com/yexiaochen/DIP\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">GitHub</a>ã€‚</p>", 
            "topic": [
                {
                    "tag": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
                    "tagLink": "https://api.zhihu.com/topics/19573936"
                }, 
                {
                    "tag": "JavaScript", 
                    "tagLink": "https://api.zhihu.com/topics/19552521"
                }, 
                {
                    "tag": "è®¾è®¡æ¨¡å¼", 
                    "tagLink": "https://api.zhihu.com/topics/19599592"
                }
            ], 
            "comments": [
                {
                    "userName": "æœ•éåœ£è´¤", 
                    "userLink": "https://www.zhihu.com/people/92ecd429863652e2576e0a402d5c9eb5", 
                    "content": "é¦–èµï¼Œé¦–è¯„ï¼Œé¡ºå¸¦æ‰‹åŠ¨ä¸‰è¿ï¼Œå»ºè®®çŸ¥ä¹ä»¥ååŒå‡»åŠŸèƒ½æ·»åŠ ä¸Šã€‚å“ˆå“ˆå“ˆ", 
                    "likes": 1, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<a class=\"comment_sticker\" href=\"https://pic3.zhimg.com/v2-6eeb544aa5ce6be1e6a6add75e436746.gif\" data-width=\"\" data-height=\"\">[å“ˆå“ˆ]</a>", 
                            "likes": 1, 
                            "replyToAuthor": "æœ•éåœ£è´¤"
                        }
                    ]
                }, 
                {
                    "userName": "ã€Œå·²æ³¨é”€ã€", 
                    "userLink": "https://www.zhihu.com/people/07064391353c4edfb693488768960065", 
                    "content": "å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚è°¢è°¢åˆ†äº«", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<a href=\"https://pic3.zhimg.com/v2-6eeb544aa5ce6be1e6a6add75e436746.gif\" class=\"comment_sticker\" data-width=\"0\" data-height=\"0\" data-sticker-id=\"951517104676491264\">[å“ˆå“ˆ]</a>", 
                            "likes": 1, 
                            "replyToAuthor": "ã€Œå·²æ³¨é”€ã€"
                        }
                    ]
                }, 
                {
                    "userName": "é¢œç”Ÿ", 
                    "userLink": "https://www.zhihu.com/people/3bf741dd54a4319e718d11fcaeb0f57a", 
                    "content": "é©¬å…‹", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<a href=\"https://pic3.zhimg.com/v2-6eeb544aa5ce6be1e6a6add75e436746.gif\" class=\"comment_sticker\" data-width=\"0\" data-height=\"0\" data-sticker-id=\"951517104676491264\">[å“ˆå“ˆ]</a>", 
                            "likes": 0, 
                            "replyToAuthor": "é¢œç”Ÿ"
                        }
                    ]
                }, 
                {
                    "userName": "æ²¡æœ‰æ•…äº‹çš„ç¾Šå°å’©", 
                    "userLink": "https://www.zhihu.com/people/fce1e804a50d90c671243d6fca237cda", 
                    "content": "<p>é€šä¿—æ˜“æ‡‚</p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "<a href=\"https://pic3.zhimg.com/v2-6eeb544aa5ce6be1e6a6add75e436746.gif\" class=\"comment_sticker\" data-width=\"0\" data-height=\"0\" data-sticker-id=\"951517104676491264\">[å“ˆå“ˆ]</a>", 
                            "likes": 1, 
                            "replyToAuthor": "æ²¡æœ‰æ•…äº‹çš„ç¾Šå°å’©"
                        }
                    ]
                }, 
                {
                    "userName": "çŸ¥ä¹ç”¨æˆ·", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "æœ¬è´¨ä¸Šéƒ½æ˜¯å¹²ä¸€ç§äº‹ï¼Œé‚£å°±æ˜¯ä¾èµ–è§£è€¦ï¼Œé‚£äº›äººé€ äº†ä¸€å †åè¯æ¦‚å¿µï½", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "æ›‰å®¸", 
                            "userLink": "https://www.zhihu.com/people/0143390ef10b928cd675db4c322045e8", 
                            "content": "æ˜¯çš„ï¼Œå…¶å®é¡¹ç›®ä¸­å¥½å¤šåœ°æ–¹å·²ç»ç”¨ä¸Šäº†ï¼Œå´ä¸çŸ¥é“è¿˜æœ‰è¿™æ ·çš„å«æ³•<a href=\"https://pic3.zhimg.com/v2-6eeb544aa5ce6be1e6a6add75e436746.gif\" class=\"comment_sticker\" data-width=\"0\" data-height=\"0\" data-sticker-id=\"951517104676491264\">[å“ˆå“ˆ]</a>", 
                            "likes": 0, 
                            "replyToAuthor": "çŸ¥ä¹ç”¨æˆ·"
                        }
                    ]
                }
            ]
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/c_1072861698884673536"
}
