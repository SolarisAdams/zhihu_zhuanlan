{
    "title": "量化掘金", 
    "description": "在市场上，我们一直是奔跑者的姿态，用量化科技的手段，洞察并挖掘瞬息万变的机会。", 
    "followers": [
        "https://www.zhihu.com/people/dong-fang-liu-xiang", 
        "https://www.zhihu.com/people/tianbao-zhang", 
        "https://www.zhihu.com/people/gnxall", 
        "https://www.zhihu.com/people/cpp001", 
        "https://www.zhihu.com/people/catomy", 
        "https://www.zhihu.com/people/xin-ba-33-19", 
        "https://www.zhihu.com/people/zhou-ming-zheng-28", 
        "https://www.zhihu.com/people/ijunyi", 
        "https://www.zhihu.com/people/fu-hua-ru-xi-fu-sheng-ru-xi", 
        "https://www.zhihu.com/people/page-jim", 
        "https://www.zhihu.com/people/kongjy", 
        "https://www.zhihu.com/people/tian-si-16-91", 
        "https://www.zhihu.com/people/wang-kang-78-9-10", 
        "https://www.zhihu.com/people/lintao-fan", 
        "https://www.zhihu.com/people/YinengXiong", 
        "https://www.zhihu.com/people/xiao-zuo-lun", 
        "https://www.zhihu.com/people/cloud-15", 
        "https://www.zhihu.com/people/zhang-peng-12-13-44", 
        "https://www.zhihu.com/people/nankaiy", 
        "https://www.zhihu.com/people/wang-gang-40-35-71", 
        "https://www.zhihu.com/people/guo-qiang-60", 
        "https://www.zhihu.com/people/18938939650", 
        "https://www.zhihu.com/people/lou-xi", 
        "https://www.zhihu.com/people/zhen-zhi-61-89", 
        "https://www.zhihu.com/people/EricW", 
        "https://www.zhihu.com/people/xiaohui168", 
        "https://www.zhihu.com/people/zhong-yang-42-6", 
        "https://www.zhihu.com/people/lu-wen-hao-44", 
        "https://www.zhihu.com/people/yan-zhi-peng-30", 
        "https://www.zhihu.com/people/cheng-xiao-han-18", 
        "https://www.zhihu.com/people/zhang-xiao-chun-76-24", 
        "https://www.zhihu.com/people/landmine-16", 
        "https://www.zhihu.com/people/kirawxz", 
        "https://www.zhihu.com/people/fan-fan-90-14-26", 
        "https://www.zhihu.com/people/shoufuwangergou", 
        "https://www.zhihu.com/people/yzr-41", 
        "https://www.zhihu.com/people/jason-36-44-74", 
        "https://www.zhihu.com/people/yu-jia-cheng-85", 
        "https://www.zhihu.com/people/bvxj", 
        "https://www.zhihu.com/people/shuai-qi-shi-zu-90"
    ], 
    "article": [
        {
            "url": "https://zhuanlan.zhihu.com/p/42923743", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 3, 
            "title": "波动率曲面", 
            "content": "<p>波动率曲面在期权定价中非常重要，它代表着对未来波动率的期望。我写了这篇文章希望给大家从横向和纵向的维度简单介绍一下隐含波动率曲面。以后可能还会继续讨论一下基于曲面的套利和曲面的interpolation方法。</p><p>如果有问题或建议，欢迎随时关注私信讨论。</p><p>原文发布在我的个人博客</p><a href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/volatility-surface/\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">Volatility Surface - Keep Running</a><p></p>", 
            "topic": [
                {
                    "tag": "波动率", 
                    "tagLink": "https://api.zhihu.com/topics/19950560"
                }, 
                {
                    "tag": "金融", 
                    "tagLink": "https://api.zhihu.com/topics/19609455"
                }, 
                {
                    "tag": "期权定价", 
                    "tagLink": "https://api.zhihu.com/topics/19915412"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/40760093", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 0, 
            "title": "期权风险Greeks", 
            "content": "<p>最近不少朋友在问常见期权的风险greeks都有哪些？他们之间的相互关系以及对期权价格的影响？如何有效地管理这些风险？</p><p>我今天就大概写了一篇科普文来介绍一些基础。文章发布在我的个人博客上，如果有问题欢迎关注私信交流哈</p><a data-draft-node=\"block\" data-draft-type=\"link-card\" href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/option-greeks/\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://</span><span class=\"visible\">keeprunning.sg/option-g</span><span class=\"invisible\">reeks/</span><span class=\"ellipsis\"></span></a><p></p>", 
            "topic": [], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/39796727", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 3, 
            "title": "美式期权定价 - 二叉树法", 
            "content": "<p>大家好！想必大家对美式期权都挺熟悉，今天写了一篇用二叉树法做美式期权定价的方法。并用Python敲出了代码，大家可以参考讨论。</p><p>原文在我的个人博客：</p><a href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/american-vanilla-option-pricing-binomial-tree-method/\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">American Vanilla Option Pricing - Binomial Tree Method - Keep Running</a><p>欢迎大家关注讨论哈。</p>", 
            "topic": [
                {
                    "tag": "期权", 
                    "tagLink": "https://api.zhihu.com/topics/19820147"
                }, 
                {
                    "tag": "定价", 
                    "tagLink": "https://api.zhihu.com/topics/19585002"
                }, 
                {
                    "tag": "二叉树期权定价模型", 
                    "tagLink": "https://api.zhihu.com/topics/20002045"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/38736698", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 4, 
            "title": "用Python计算分析实现波动率和隐含波动率", 
            "content": "<p>今天又敲了一个volatility_pricer.py，可以分别计算给定股票的实现波动率，和用Black-Scholes算出的隐含波动率。</p><p>详细原文请看我的个人博客：</p><a href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/%25E7%2594%25A8python%25E8%25AE%25A1%25E7%25AE%2597%25E5%2588%2586%25E6%259E%2590%25E5%25AE%259E%25E7%258E%25B0%25E6%25B3%25A2%25E5%258A%25A8%25E7%258E%2587%25E5%2592%258C%25E9%259A%2590%25E5%2590%25AB%25E6%25B3%25A2%25E5%258A%25A8%25E7%258E%2587/\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">用Python计算分析实现波动率和隐含波动率 - Keep Running</a><p></p><p></p>", 
            "topic": [
                {
                    "tag": "波动率", 
                    "tagLink": "https://api.zhihu.com/topics/19950560"
                }, 
                {
                    "tag": "量化交易", 
                    "tagLink": "https://api.zhihu.com/topics/19815465"
                }, 
                {
                    "tag": "Python", 
                    "tagLink": "https://api.zhihu.com/topics/19552832"
                }
            ], 
            "comments": []
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/38705937", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 1, 
            "title": "欧式期权定价 - 蒙特卡罗和Black-Scholes方法", 
            "content": "<p>好久没有写了，今天又是一篇干货，一时兴起，就写了一个Vanilla Option的Pricer。分别用Monte Carlo和Black-Scholes方法。完全用python写的，可以方便大家交流使用。大家可以对比这两种定价方法。</p><p>详细原文请看我的个人博客，我是分开两篇文章介绍的：</p><a href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/european-vanilla-option-pricing-black-scholes-pde/\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">European Vanilla Option Pricing - Black-Scholes PDE - Keep Running</a><a href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/european-vanilla-option-pricing-monte-carlo-methods/\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">European Vanilla Option Pricing - Monte Carlo Methods - Keep Running</a><p></p><p></p><p></p><p></p>", 
            "topic": [
                {
                    "tag": "数学", 
                    "tagLink": "https://api.zhihu.com/topics/19554091"
                }, 
                {
                    "tag": "期权", 
                    "tagLink": "https://api.zhihu.com/topics/19820147"
                }, 
                {
                    "tag": "蒙特卡洛方法", 
                    "tagLink": "https://api.zhihu.com/topics/19800937"
                }
            ], 
            "comments": [
                {
                    "userName": "知乎用户", 
                    "userLink": "https://www.zhihu.com/people/0", 
                    "content": "<p>嗨嗨~~答主能否推荐下欧式期权定价的书或者paper呢，最好是python示例的。我本来是学金数，但毕业好久不用都忘了，想快速捡起来做个小project。。。不胜感激！</p>", 
                    "likes": 0, 
                    "childComments": [
                        {
                            "userName": "官景峰爱老婆", 
                            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
                            "content": "最经典的肯定是halls 可是一般用的话 我的博客里都有啊", 
                            "likes": 0, 
                            "replyToAuthor": "知乎用户"
                        }, 
                        {
                            "userName": "知乎用户", 
                            "userLink": "https://www.zhihu.com/people/0", 
                            "content": "哈哈 已关注", 
                            "likes": 0, 
                            "replyToAuthor": "官景峰爱老婆"
                        }
                    ]
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/35342535", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 1, 
            "title": "由最近市场波动引发的关于对冲(Hedging)的几点思考", 
            "content": "<p>最近一直比较忙工作，在大家的再三催促下，抽出点时间写写这几天的感悟。：）</p><p>进入2018年2月以来市场打破了几年来的平静，有据说程序带来的闪崩，有FB为主的data privacy的担心，更有特朗普炮轰亚马逊和trade war的恐慌。总之，一个字：不平静。</p><p>市场的波动性理论上会带来更多的盈利机会，当然，也会给很多小白带来很多不确定性和亏损。应对这种不确定性，避免自己爆仓，对冲（hedging）自然是非常重要的。</p><p>对于对冲，简单谈谈几点思考，以后有机会还会做进一步展开讨论。</p><p>详细原文请看我的个人博客：</p><a href=\"https://link.zhihu.com/?target=http%3A//keeprunning.sg/%25E7%2594%25B1%25E6%259C%2580%25E8%25BF%2591%25E5%25B8%2582%25E5%259C%25BA%25E6%25B3%25A2%25E5%258A%25A8%25E5%25BC%2595%25E5%258F%2591%25E7%259A%2584%25E5%2585%25B3%25E4%25BA%258E%25E5%25AF%25B9%25E5%2586%25B2hedging%25E7%259A%2584%25E5%2587%25A0%25E7%2582%25B9%25E6%2580%259D%25E8%2580%2583/\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">由最近市场波动引发的关于对冲(Hedging)的几点思考 - Keep Running</a><p></p><p></p>", 
            "topic": [
                {
                    "tag": "对冲策略", 
                    "tagLink": "https://api.zhihu.com/topics/19797797"
                }, 
                {
                    "tag": "股价波动", 
                    "tagLink": "https://api.zhihu.com/topics/19610797"
                }, 
                {
                    "tag": "投资", 
                    "tagLink": "https://api.zhihu.com/topics/19551404"
                }
            ], 
            "comments": [
                {
                    "userName": "Sunny", 
                    "userLink": "https://www.zhihu.com/people/2a8a83b6613c7a15cd71ed80720bae2e", 
                    "content": "好文，但是还没做到深入浅出。", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }, 
        {
            "url": "https://zhuanlan.zhihu.com/p/34964886", 
            "userName": "官景峰爱老婆", 
            "userLink": "https://www.zhihu.com/people/fc8281ed32777e62a9126bb195a576f5", 
            "upvote": 2, 
            "title": "Python 量化策略回测框架", 
            "content": "<p>就直接上干货吧（小编实在太忙，奔跑嘛:），整个量化策略的回测框架都是自己写的，这样做的初衷就是尽可能地可以customize策略本身和回测系统。</p><p>整个框架由三部分组成：策略（Magi.py），数据（DataHub.py），交易执行（xMan.py）。</p><p>下面贴出的策略在这就不细讲了，相信有心的读者一定能读懂。我做过很多回测，效果还不错，大家可以在此基础上不断提高哈。</p><p>大家如果有什么问题，尽管私信我。欢迎转载，或者提建议哈，一同进步嘛！</p><p>请忽略我如此fancy的命名，哈哈哈。</p><ol><li>DataHub.py：数据的下载初步处理</li></ol><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">import</span> <span class=\"nn\">pandas_datareader.data</span> <span class=\"kn\">as</span> <span class=\"nn\">web</span>\n<span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"kn\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"n\">DATA_SOURCE_YAHOO</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;yahoo&#39;</span>\n<span class=\"n\">DATA_SOURCE_GOOGLE</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;google&#39;</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">DataHub</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">pass</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_downloadData</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">startDate</span><span class=\"o\">=</span><span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2017</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">endDate</span><span class=\"o\">=</span><span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"o\">.</span><span class=\"n\">today</span><span class=\"p\">(),</span> <span class=\"n\">symbols</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;AAPL&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SPY&#39;</span><span class=\"p\">],</span> <span class=\"n\">dataSource</span><span class=\"o\">=</span><span class=\"n\">DATA_SOURCE_YAHOO</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;\n</span><span class=\"s2\">        Downland stock historical data from Yahoo finance, histPanel is a Panel, already in ascending order, e.g:\n</span><span class=\"s2\">        Dimensions: 6 (items) x 2 (major_axis) x 2 (minor_axis)\n</span><span class=\"s2\">        Items axis(0): Open to Adj Close\n</span><span class=\"s2\">        Major_axis axis(1): 2016-10-11 00:00:00 to 2016-10-12 00:00:00\n</span><span class=\"s2\">        Minor_axis axis(2): SPY to ^N225\n</span><span class=\"s2\">\n</span><span class=\"s2\">        We now use dict of DataFrames to replace panel as Panel is depreciated in Pandas.\n</span><span class=\"s2\">        key: symbol\n</span><span class=\"s2\">        value: DataFrame with dates as index and &#34;Open&#34; etc as columns\n</span><span class=\"s2\">\n</span><span class=\"s2\">        Now we allow different indexes across different symbol DataFrames\n</span><span class=\"s2\">        And we will simply remove all 0 or NaN in every DataFrame\n</span><span class=\"s2\">        &#34;&#34;&#34;</span>\n        <span class=\"n\">symbolData</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">symbol</span> <span class=\"ow\">in</span> <span class=\"n\">symbols</span><span class=\"p\">:</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">web</span><span class=\"o\">.</span><span class=\"n\">DataReader</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"n\">dataSource</span><span class=\"p\">,</span> <span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span><span class=\"p\">:</span>\n                <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s1\">&#39;DataHub: _downloadData: Cannot download historical data for symbol={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">))</span>\n                <span class=\"k\">continue</span>\n            <span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">df</span>\n\n        <span class=\"c1\"># Cleanse data: remove dates where there is NaN or 0</span>\n        <span class=\"k\">for</span> <span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"n\">df</span> <span class=\"ow\">in</span> <span class=\"n\">symbolData</span><span class=\"o\">.</span><span class=\"n\">iteritems</span><span class=\"p\">():</span>\n            <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">replace</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">nan</span><span class=\"p\">)</span>\n            <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">dropna</span><span class=\"p\">()</span>\n            <span class=\"c1\"># Remove duplicated date index</span>\n            <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"o\">~</span><span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"o\">.</span><span class=\"n\">duplicated</span><span class=\"p\">(</span><span class=\"n\">keep</span><span class=\"o\">=</span><span class=\"s1\">&#39;first&#39;</span><span class=\"p\">)]</span>\n            <span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">sort_index</span><span class=\"p\">(</span><span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;DataHub: downlaodData: Completed startDate={}, endDate={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">symbolData</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">downloadDataFromYahoo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"p\">,</span> <span class=\"n\">symbols</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_downloadData</span><span class=\"p\">(</span><span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"p\">,</span> <span class=\"n\">symbols</span><span class=\"p\">,</span> <span class=\"n\">DATA_SOURCE_YAHOO</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">downloadDataFromGoogle</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"p\">,</span> <span class=\"n\">symbols</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_downloadData</span><span class=\"p\">(</span><span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"p\">,</span> <span class=\"n\">symbols</span><span class=\"p\">,</span> <span class=\"n\">DATA_SOURCE_GOOGLE</span><span class=\"p\">)</span></code></pre></div><ol><li>xMan.py：交易执行过程中order tracking, position tracking, performance evaluation等</li></ol><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">import</span> <span class=\"nn\">uuid</span>\n<span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n\n<span class=\"n\">ORDER_STATE_NEW</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_STATE_NEW&#39;</span>\n<span class=\"n\">ORDER_STATE_PARTIALLY_FILLED</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_STATE_PARTIALLY_FILLED&#39;</span>\n<span class=\"n\">ORDER_STATE_FULLY_FILLED</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_STATE_FULLY_FILLED&#39;</span>\n<span class=\"n\">ORDER_STATE_CANCELLED</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_STATE_CANCELLED&#39;</span>\n<span class=\"n\">ORDER_TYPE_MARKET</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_TYPE_MARKET&#39;</span>\n<span class=\"n\">ORDER_TYPE_LIMIT</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_TYPE_LIMIT&#39;</span>\n<span class=\"n\">ORDER_TYPE_STOP</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_TYPE_STOP&#39;</span>\n<span class=\"n\">ORDER_DIRECTION_BUY</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_DIRECTION_BUY&#39;</span>\n<span class=\"n\">ORDER_DIRECTION_SELL</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ORDER_DIRECTION_SELL&#39;</span>\n\n<span class=\"n\">MIN_COMMISSION_PER_ORDER</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n<span class=\"n\">MAX_COMMISSION_PER_ORDER_PER_TRADE_VALUE</span> <span class=\"o\">=</span> <span class=\"mf\">0.005</span>\n<span class=\"n\">COMMISSION_PER_SHARE</span> <span class=\"o\">=</span> <span class=\"mf\">0.005</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Order</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"n\">direction</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"p\">,</span> <span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">openDtIdx</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderId</span> <span class=\"o\">=</span> <span class=\"n\">uuid</span><span class=\"o\">.</span><span class=\"n\">uuid4</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">=</span> <span class=\"n\">symbol</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">=</span> <span class=\"n\">direction</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">=</span> <span class=\"nb\">type</span>\n        <span class=\"c1\"># this is the price submitted when placing order</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">price</span> <span class=\"o\">=</span> <span class=\"n\">price</span>\n        <span class=\"c1\"># this is the average price filling the order</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fillPrice</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"c1\"># this quantity should be non-negative</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"o\">=</span> <span class=\"n\">quantity</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"n\">ORDER_STATE_NEW</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">commission</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">linkId</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n        <span class=\"c1\"># this is when the order is created</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">openDtIdx</span> <span class=\"o\">=</span> <span class=\"n\">openDtIdx</span>\n        <span class=\"c1\"># this is when the order is fully filled or cancelled</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;Order&lt;orderId={}, symbol={}, direction={}, type={}, price={}, fillPrice={}, quantityOutstanding={}, quantityFilled={}, state={}, commission={}, linkId={}, openDtIdx={}, closeDtIdx={}&gt;&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderId</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">direction</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"nb\">type</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fillPrice</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">commission</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">linkId</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">openDtIdx</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">calculateCommission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Calculate commission for this order, commission is only incurred on fully filled&#34;&#34;&#34;</span>\n        <span class=\"n\">minCommission</span> <span class=\"o\">=</span> <span class=\"n\">MIN_COMMISSION_PER_ORDER</span>\n        <span class=\"n\">maxCommission</span> <span class=\"o\">=</span> <span class=\"n\">MAX_COMMISSION_PER_ORDER_PER_TRADE_VALUE</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fillPrice</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span><span class=\"p\">)</span>\n        <span class=\"n\">commission</span> <span class=\"o\">=</span> <span class=\"n\">COMMISSION_PER_SHARE</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">commission</span> <span class=\"o\">=</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"nb\">min</span><span class=\"p\">(</span><span class=\"n\">commission</span><span class=\"p\">,</span> <span class=\"n\">maxCommission</span><span class=\"p\">),</span> <span class=\"n\">minCommission</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">fill</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fillPrice</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">):</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Order: fill: BEFORE: order={} CHANGE: fillPrice={}, quantity={}, datetime={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fillPrice</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">quantity</span> <span class=\"o\">&gt;</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"ow\">or</span> <span class=\"n\">quantity</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s1\">&#39;Order: fill: orderId={} Invalid quantity={}!&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderId</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">))</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">Exception</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fillPrice</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fillPrice</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span> <span class=\"o\">+</span> <span class=\"n\">fillPrice</span> <span class=\"o\">*</span> <span class=\"n\">quantity</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span> <span class=\"o\">+</span> <span class=\"n\">quantity</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityFilled</span> <span class=\"o\">+=</span> <span class=\"n\">quantity</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"o\">-=</span> <span class=\"n\">quantity</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"n\">ORDER_STATE_PARTIALLY_FILLED</span>\n        <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">calculateCommission</span><span class=\"p\">()</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Order: fill: AFTER: order={} CHANGE: fillPrice={}, quantity={}, datetime={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fillPrice</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">cancel</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">):</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Order: cancel: BEFORE: order={} CHANGE: datetime={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">))</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"n\">ORDER_STATE_CANCELLED</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Order: cancel: AFTER: order={} CHANGE: datetime={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Position</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">=</span> <span class=\"n\">symbol</span>\n        <span class=\"c1\"># Can be short position, where quantity is negative</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cost</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;Position&lt;symbol={}, quantity={}, cost={}, realizedPNL={}&gt;&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cost</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">change</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">commission</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Position change should ONLY triggered by order execution&#34;&#34;&#34;</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Position: BEFORE: position={} CHANGE: price={}, quantity={}, commission={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">commission</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">quantity</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s1\">&#39;Position: change: symbol={} Invalid quantity is 0&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">))</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">Exception</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span> <span class=\"o\">*</span> <span class=\"n\">quantity</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Increasing position, either short or long, commission is included in position cost</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span> <span class=\"o\">+=</span> <span class=\"n\">quantity</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cost</span> <span class=\"o\">+=</span> <span class=\"p\">(</span><span class=\"n\">price</span> <span class=\"o\">*</span> <span class=\"n\">quantity</span> <span class=\"o\">+</span> <span class=\"n\">commission</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Reducing position, either short or long, commission is included in realizedPNL</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span> <span class=\"o\">+=</span> <span class=\"p\">((</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cost</span><span class=\"o\">/</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span> <span class=\"o\">-</span> <span class=\"n\">price</span><span class=\"p\">)</span><span class=\"o\">*</span><span class=\"n\">quantity</span> <span class=\"o\">-</span> <span class=\"n\">commission</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cost</span> <span class=\"o\">+=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cost</span><span class=\"o\">/</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span><span class=\"o\">*</span><span class=\"n\">quantity</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">quantity</span> <span class=\"o\">+=</span> <span class=\"n\">quantity</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Position: AFTER: position={} CHANGE: price={}, quantity={}, commission={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">commission</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">MarketTick</span><span class=\"p\">:</span>\n    <span class=\"s2\">&#34;&#34;&#34;\n</span><span class=\"s2\">    MarketTick is symbol specific, which simulates the real-time market data tick.\n</span><span class=\"s2\">    In reality, different symbols may tick at different time.\n</span><span class=\"s2\">    &#34;&#34;&#34;</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"nb\">open</span><span class=\"p\">,</span> <span class=\"n\">close</span><span class=\"p\">,</span> <span class=\"n\">high</span><span class=\"p\">,</span> <span class=\"n\">low</span><span class=\"p\">,</span> <span class=\"n\">volume</span><span class=\"p\">,</span> <span class=\"n\">dtIdx</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">=</span> <span class=\"n\">symbol</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"nb\">open</span> <span class=\"o\">=</span> <span class=\"nb\">open</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">close</span> <span class=\"o\">=</span> <span class=\"n\">close</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">high</span> <span class=\"o\">=</span> <span class=\"n\">high</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">low</span> <span class=\"o\">=</span> <span class=\"n\">low</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">volume</span> <span class=\"o\">=</span> <span class=\"n\">volume</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span> <span class=\"o\">=</span> <span class=\"n\">dtIdx</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;MarketTick&lt;symbol={}, open={}, close={}, high={}, low={}, volume={}, dtIdx={}&gt;&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"nb\">open</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">high</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">low</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">volume</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Performance</span><span class=\"p\">:</span>\n    <span class=\"s2\">&#34;&#34;&#34;Performance metrics for each symbol&#34;&#34;&#34;</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">=</span> <span class=\"n\">symbol</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingMarketOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingStopOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingLimitOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledMarketOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledStopOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledLimitOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledMarketOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledStopOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledLimitOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">maxCapitalRequired</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positionQuantity</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positionCost</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">totalTradeLife</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">timedelta</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;Performance&lt;symbol={}, outstandingMarketOrders={}, outstandingStopOrders={}, outstandingLimitOrders={}, filledMarketOrders={}, filledStopOrders={}, filledLimitOrders={}, cancelledMarketOrders={}, cancelledStopOrders={}, cancelledLimitOrders={}, success={}, failure={}, successRate={:.2f}%, maxCapitalRequired={}, realizedPNL={}, positionQuantity={}, positionCost={}, totalTradeLife={}, averageTradeLife={}&gt;&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingMarketOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingStopOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingLimitOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledMarketOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledStopOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledLimitOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledMarketOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledStopOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledLimitOrders</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"o\">*</span><span class=\"mi\">100</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"s1\">&#39;nan&#39;</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">maxCapitalRequired</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positionQuantity</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positionCost</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">totalTradeLife</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">totalTradeLife</span><span class=\"o\">/</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;No Trades&#39;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">updatePerformance</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">outstandingMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">outstandingStopOrders</span><span class=\"p\">,</span> <span class=\"n\">outstandingLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">filledMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">filledStopOrders</span><span class=\"p\">,</span> <span class=\"n\">filledLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledStopOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">success</span><span class=\"p\">,</span> <span class=\"n\">failure</span><span class=\"p\">,</span> <span class=\"n\">maxCapitalRequired</span><span class=\"p\">,</span> <span class=\"n\">realizedPNL</span><span class=\"p\">,</span> <span class=\"n\">positionQuantity</span><span class=\"p\">,</span> <span class=\"n\">positionCost</span><span class=\"p\">,</span> <span class=\"n\">totalTradeLife</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingMarketOrders</span> <span class=\"o\">=</span> <span class=\"n\">outstandingMarketOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingStopOrders</span> <span class=\"o\">=</span> <span class=\"n\">outstandingStopOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">outstandingLimitOrders</span> <span class=\"o\">=</span> <span class=\"n\">outstandingLimitOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledMarketOrders</span> <span class=\"o\">=</span> <span class=\"n\">filledMarketOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledStopOrders</span> <span class=\"o\">=</span> <span class=\"n\">filledStopOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filledLimitOrders</span> <span class=\"o\">=</span> <span class=\"n\">filledLimitOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledMarketOrders</span> <span class=\"o\">=</span> <span class=\"n\">cancelledMarketOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledStopOrders</span> <span class=\"o\">=</span> <span class=\"n\">cancelledStopOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelledLimitOrders</span> <span class=\"o\">=</span> <span class=\"n\">cancelledLimitOrders</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span> <span class=\"o\">=</span> <span class=\"n\">success</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">failure</span> <span class=\"o\">=</span> <span class=\"n\">failure</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">maxCapitalRequired</span> <span class=\"o\">=</span> <span class=\"n\">maxCapitalRequired</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span> <span class=\"o\">=</span> <span class=\"n\">realizedPNL</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positionQuantity</span> <span class=\"o\">=</span> <span class=\"n\">positionQuantity</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positionCost</span> <span class=\"o\">=</span> <span class=\"n\">positionCost</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">totalTradeLife</span> <span class=\"o\">=</span> <span class=\"n\">totalTradeLife</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">xMan</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">initialCapital</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">performances</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioRealizedPNL</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioCashBalance</span> <span class=\"o\">=</span> <span class=\"n\">initialCapital</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">initialCapital</span> <span class=\"o\">=</span> <span class=\"n\">initialCapital</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioPositionCost</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioMaxCapitalRequired</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">placeOrder</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getOrderByOrderId</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">orderId</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Return a single order or None given the unique orderId&#34;&#34;&#34;</span>\n        <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">orderId</span> <span class=\"o\">==</span> <span class=\"n\">orderId</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">order</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: getOrderByOrderId: No order found for orderId={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">orderId</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getOrdersByLinkId</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">linkId</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Return a list of orders given the linkId&#34;&#34;&#34;</span>\n        <span class=\"n\">orders</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">linkId</span> <span class=\"ow\">and</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">linkId</span> <span class=\"o\">==</span> <span class=\"n\">linkId</span><span class=\"p\">:</span>\n                <span class=\"n\">orders</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">orders</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getOrdersBySymbol</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Return a list of orders given the symbol&#34;&#34;&#34;</span>\n        <span class=\"n\">orders</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">==</span> <span class=\"n\">symbol</span><span class=\"p\">:</span>\n                <span class=\"n\">orders</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">orders</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getPositionBySymbol</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">):</span>\n        <span class=\"k\">for</span> <span class=\"n\">position</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">==</span> <span class=\"n\">symbol</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">position</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: getPositionBySymbol: No position found for symbol={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getPerformanceBySymbol</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbol</span><span class=\"p\">):</span>\n        <span class=\"k\">for</span> <span class=\"n\">performance</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">performances</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">performance</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"o\">==</span> <span class=\"n\">symbol</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">performance</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: getPerformanceBySymbol: No position found for symbol={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">executeMarketOrder</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Execute market order, update position&#34;&#34;&#34;</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: executeMarketOrder: Check order={}, marketTick={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">))</span>\n        <span class=\"c1\"># We always fully fill market orders</span>\n        <span class=\"n\">quantityChanged</span> <span class=\"o\">=</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_BUY</span> <span class=\"k\">else</span> <span class=\"o\">-</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span>\n        <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">fill</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"nb\">open</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelLinkedOrders</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n\n        <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getPositionBySymbol</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">position</span><span class=\"p\">:</span>\n            <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"n\">Position</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">position</span><span class=\"p\">)</span>\n        <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">change</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"nb\">open</span><span class=\"p\">,</span> <span class=\"n\">quantityChanged</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">commission</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">executeLimitOrder</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Execute limit order, update position&#34;&#34;&#34;</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: executeLimitOrder: Check order={}, marketTick={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_BUY</span> <span class=\"ow\">and</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span> <span class=\"o\">&gt;=</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">low</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_SELL</span> <span class=\"ow\">and</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span> <span class=\"o\">&lt;=</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">high</span><span class=\"p\">):</span>\n            <span class=\"n\">quantityChanged</span> <span class=\"o\">=</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_BUY</span> <span class=\"k\">else</span> <span class=\"o\">-</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span>\n            <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">fill</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelLinkedOrders</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n\n            <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getPositionBySymbol</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">position</span><span class=\"p\">:</span>\n                <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"n\">Position</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">position</span><span class=\"p\">)</span>\n            <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">change</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">quantityChanged</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">commission</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">executeStopOrder</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Execute stop order, update position&#34;&#34;&#34;</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: executeStopOrder: Check order={}, marketTick={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_BUY</span> <span class=\"ow\">and</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span> <span class=\"o\">&lt;=</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">high</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_SELL</span> <span class=\"ow\">and</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span> <span class=\"o\">&gt;=</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">low</span><span class=\"p\">):</span>\n            <span class=\"n\">quantityChanged</span> <span class=\"o\">=</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span> <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_DIRECTION_BUY</span> <span class=\"k\">else</span> <span class=\"o\">-</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span>\n            <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">fill</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">quantityOutstanding</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cancelLinkedOrders</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n\n            <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getPositionBySymbol</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">position</span><span class=\"p\">:</span>\n                <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"n\">Position</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">position</span><span class=\"p\">)</span>\n            <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">change</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">price</span><span class=\"p\">,</span> <span class=\"n\">quantityChanged</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">commission</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">executeOrdersOnMarketTick</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">):</span>\n        <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getOrdersBySymbol</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">,</span> <span class=\"n\">ORDER_STATE_CANCELLED</span><span class=\"p\">]:</span>\n                <span class=\"k\">continue</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_MARKET</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">executeMarketOrder</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">)</span>\n            <span class=\"c1\">#TODO: We execute stop order ahead of limit order, limit order can possibly be cancelled before filled</span>\n            <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_STOP</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">executeStopOrder</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_LIMIT</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">executeLimitOrder</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: executeOrdersOnMarketTick: Unsupported order type {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">cancelLinkedOrders</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">order</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;If one order get fully filled, other linked orders will be cancelled&#34;&#34;&#34;</span>\n        <span class=\"n\">linkedOrders</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getOrdersByLinkId</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">linkId</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">linkedOrder</span> <span class=\"ow\">in</span> <span class=\"n\">linkedOrders</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">linkedOrder</span><span class=\"o\">.</span><span class=\"n\">orderId</span> <span class=\"o\">!=</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">orderId</span><span class=\"p\">:</span>\n                <span class=\"n\">linkedOrder</span><span class=\"o\">.</span><span class=\"n\">cancel</span><span class=\"p\">(</span><span class=\"n\">datetime</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">linkOrders</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">orders</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;If one order get fully filled, other linked orders will be cancelled&#34;&#34;&#34;</span>\n        <span class=\"n\">linkId</span> <span class=\"o\">=</span> <span class=\"n\">uuid</span><span class=\"o\">.</span><span class=\"n\">uuid4</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"n\">orders</span><span class=\"p\">:</span>\n            <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">linkId</span> <span class=\"o\">=</span> <span class=\"n\">linkId</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: linkOrders: Linked orderIds={}, linkId={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">([</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">orderId</span> <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"n\">orders</span><span class=\"p\">],</span> <span class=\"n\">linkId</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getAllSymbols</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Get all symbols ever executed&#34;&#34;&#34;</span>\n        <span class=\"n\">orderSymbols</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span><span class=\"p\">]</span>\n        <span class=\"n\">positionSymbols</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">symbol</span> <span class=\"k\">for</span> <span class=\"n\">position</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span><span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"n\">orderSymbols</span> <span class=\"o\">+</span> <span class=\"n\">positionSymbols</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">evaluatePerformance</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioRealizedPNL</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioCashBalance</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">initialCapital</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioPositionCost</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioTotalTradeLife</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">timedelta</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">symbol</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getAllSymbols</span><span class=\"p\">():</span>\n            <span class=\"n\">outstandingMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">outstandingStopOrders</span><span class=\"p\">,</span> <span class=\"n\">outstandingLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">filledMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">filledStopOrders</span><span class=\"p\">,</span> <span class=\"n\">filledLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledStopOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledLimitOrders</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span>\n            <span class=\"n\">totalTradeLife</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">timedelta</span><span class=\"p\">()</span>\n            <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getOrdersBySymbol</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">):</span>\n                <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">ORDER_STATE_PARTIALLY_FILLED</span><span class=\"p\">,</span> <span class=\"n\">ORDER_STATE_NEW</span><span class=\"p\">]:</span>\n                    <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_MARKET</span><span class=\"p\">:</span>\n                        <span class=\"n\">outstandingMarketOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_STOP</span><span class=\"p\">:</span>\n                        <span class=\"n\">outstandingStopOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_LIMIT</span><span class=\"p\">:</span>\n                        <span class=\"n\">outstandingLimitOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">:</span>\n                    <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_MARKET</span><span class=\"p\">:</span>\n                        <span class=\"n\">filledMarketOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_STOP</span><span class=\"p\">:</span>\n                        <span class=\"n\">filledStopOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                        <span class=\"n\">totalTradeLife</span> <span class=\"o\">+=</span> <span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span><span class=\"o\">.</span><span class=\"n\">to_pydatetime</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">openDtIdx</span><span class=\"o\">.</span><span class=\"n\">to_pydatetime</span><span class=\"p\">())</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_LIMIT</span><span class=\"p\">:</span>\n                        <span class=\"n\">filledLimitOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                        <span class=\"n\">totalTradeLife</span> <span class=\"o\">+=</span> <span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span><span class=\"o\">.</span><span class=\"n\">to_pydatetime</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">openDtIdx</span><span class=\"o\">.</span><span class=\"n\">to_pydatetime</span><span class=\"p\">())</span>\n                <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_STATE_CANCELLED</span><span class=\"p\">:</span>\n                    <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_MARKET</span><span class=\"p\">:</span>\n                        <span class=\"n\">cancelledMarketOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_STOP</span><span class=\"p\">:</span>\n                        <span class=\"n\">cancelledStopOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_TYPE_LIMIT</span><span class=\"p\">:</span>\n                        <span class=\"n\">cancelledLimitOrders</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n            <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getPositionBySymbol</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">position</span><span class=\"p\">:</span>\n                <span class=\"n\">position</span> <span class=\"o\">=</span> <span class=\"n\">Position</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">positions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">position</span><span class=\"p\">)</span>\n            <span class=\"n\">performance</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getPerformanceBySymbol</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">performance</span><span class=\"p\">:</span>\n                <span class=\"n\">performance</span> <span class=\"o\">=</span> <span class=\"n\">Performance</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">performances</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">performance</span><span class=\"p\">)</span>\n            <span class=\"n\">success</span> <span class=\"o\">=</span> <span class=\"n\">filledLimitOrders</span>\n            <span class=\"n\">failure</span> <span class=\"o\">=</span> <span class=\"n\">filledStopOrders</span>\n            <span class=\"n\">maxCapitalRequired</span> <span class=\"o\">=</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"n\">performance</span><span class=\"o\">.</span><span class=\"n\">maxCapitalRequired</span><span class=\"p\">,</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">cost</span><span class=\"p\">)</span>\n            <span class=\"n\">performance</span><span class=\"o\">.</span><span class=\"n\">updatePerformance</span><span class=\"p\">(</span><span class=\"n\">outstandingMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">outstandingStopOrders</span><span class=\"p\">,</span> <span class=\"n\">outstandingLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">filledMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">filledStopOrders</span><span class=\"p\">,</span> <span class=\"n\">filledLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledMarketOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledStopOrders</span><span class=\"p\">,</span> <span class=\"n\">cancelledLimitOrders</span><span class=\"p\">,</span> <span class=\"n\">success</span><span class=\"p\">,</span> <span class=\"n\">failure</span><span class=\"p\">,</span> <span class=\"n\">maxCapitalRequired</span><span class=\"p\">,</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span><span class=\"p\">,</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">cost</span><span class=\"p\">,</span> <span class=\"n\">totalTradeLife</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: evaluatePerformance: performance={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">performance</span><span class=\"p\">))</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span> <span class=\"o\">+=</span> <span class=\"n\">success</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span> <span class=\"o\">+=</span> <span class=\"n\">failure</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioTotalTradeLife</span> <span class=\"o\">+=</span> <span class=\"n\">totalTradeLife</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioRealizedPNL</span> <span class=\"o\">+=</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioCashBalance</span> <span class=\"o\">+=</span> <span class=\"p\">(</span><span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">realizedPNL</span> <span class=\"o\">-</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">cost</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioPositionCost</span> <span class=\"o\">+=</span> <span class=\"n\">position</span><span class=\"o\">.</span><span class=\"n\">cost</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioMaxCapitalRequired</span> <span class=\"o\">=</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioMaxCapitalRequired</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioPositionCost</span><span class=\"p\">)</span>\n\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: evaluatePerformance: Portfolio portfolioRealizedPNL={}, portfolioCashBalance={}, portfolioPositionCost={}, portfolioMaxCapitalRequired={}, portfolioSuccess={}, portfolioFailure={}, portfolioSuccessRate={:.2f}%, portfolioAverageTradeLife={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioRealizedPNL</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioCashBalance</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioPositionCost</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioMaxCapitalRequired</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span><span class=\"p\">)</span><span class=\"o\">*</span><span class=\"mi\">100</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span> <span class=\"k\">else</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"s1\">&#39;nan&#39;</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioTotalTradeLife</span><span class=\"o\">/</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioSuccess</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">portfolioFailure</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;No Trades&#39;</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">describeTradesExecutedByDatetime</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">order</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orders</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">==</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">:</span>\n                <span class=\"n\">daycounts</span> <span class=\"o\">=</span> <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span><span class=\"p\">,</span> <span class=\"nb\">dict</span><span class=\"p\">())</span>\n                <span class=\"n\">count</span> <span class=\"o\">=</span> <span class=\"n\">daycounts</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n                <span class=\"n\">daycounts</span><span class=\"p\">[</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"nb\">type</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">count</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n                <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">order</span><span class=\"o\">.</span><span class=\"n\">closeDtIdx</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">daycounts</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Trades Execution Summary for all dates&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;------------------------------------------------------------&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">keys</span> <span class=\"o\">=</span> <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">()</span>\n        <span class=\"n\">keys</span><span class=\"o\">.</span><span class=\"n\">sort</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">dt</span> <span class=\"ow\">in</span> <span class=\"n\">keys</span><span class=\"p\">:</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;xMan: describeTradesExecutedByDatetime: {}: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">dt</span><span class=\"p\">,</span> <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">dt</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ERROR&#39;</span><span class=\"p\">)))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span></code></pre></div><ol><li>Magi.py：最核心的策略本身了。</li></ol><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">from</span> <span class=\"nn\">DataHub</span> <span class=\"kn\">import</span> <span class=\"n\">DataHub</span>\n<span class=\"kn\">from</span> <span class=\"nn\">xMan</span> <span class=\"kn\">import</span> <span class=\"n\">Order</span><span class=\"p\">,</span> <span class=\"n\">MarketTick</span><span class=\"p\">,</span> <span class=\"n\">Position</span><span class=\"p\">,</span> <span class=\"n\">xMan</span><span class=\"p\">,</span> <span class=\"n\">ORDER_STATE_NEW</span><span class=\"p\">,</span> <span class=\"n\">ORDER_STATE_PARTIALLY_FILLED</span><span class=\"p\">,</span> <span class=\"n\">ORDER_STATE_FULLY_FILLED</span><span class=\"p\">,</span> <span class=\"n\">ORDER_STATE_CANCELLED</span><span class=\"p\">,</span> <span class=\"n\">ORDER_TYPE_MARKET</span><span class=\"p\">,</span> <span class=\"n\">ORDER_TYPE_LIMIT</span><span class=\"p\">,</span> <span class=\"n\">ORDER_TYPE_STOP</span><span class=\"p\">,</span> <span class=\"n\">ORDER_DIRECTION_BUY</span><span class=\"p\">,</span> <span class=\"n\">ORDER_DIRECTION_SELL</span>\n<span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">math</span>\n<span class=\"kn\">import</span> <span class=\"nn\">pandas</span>\n\n<span class=\"n\">STOCKS_SELECTED</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;NFLX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;YUM&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CCE&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;WY&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;VRTX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MYL&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;GIS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;D&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;DHR&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;URI&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;HRS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;AMGN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;GD&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;T&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MAS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MAR&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;IPG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;OI&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SNA&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;LEG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;NTRS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;DG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;JNJ&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SYY&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;TSN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BEN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CMI&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CME&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ESRX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;NVDA&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;FDX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CMS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;DTV&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;AVGO&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ETN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;RTN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;AMG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;GRMN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BLX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SCHW&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ED&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;FFIV&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;XRX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;APC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;UPS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;NFX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MPC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MO&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MDLZ&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;IVZ&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;DVA&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ACN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;COST&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;DOV&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;TMO&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;NI&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;TEL&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;FCX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ECL&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ZBH&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BSK&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;NUE&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;HP&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;LNC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;EXPD&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ETFC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ADS&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ADP&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SRE&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CB&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CA&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CF&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;R&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CLX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;UNH&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ADM&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;OMC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;NTAP&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;XEC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MMV&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;RLC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;EBAY&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MET&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;JNPR&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SE&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;KLAC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BF-B&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;GNW&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BXP&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;AIV&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CAT&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BAC&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CAG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;TXN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PPG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ISRG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;LH&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ORCL&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PGR&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;HIG&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ZION&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;HON&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;IP&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;IR&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;STI&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MLM&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;STT&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ABBV&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ALXN&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;JCI&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BDX&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PRU&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;CSCO&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PNC&#39;</span><span class=\"p\">]</span>\n<span class=\"n\">SYMBOLS</span> <span class=\"o\">=</span> <span class=\"n\">STOCKS_SELECTED</span>\n\n<span class=\"n\">START_DATE</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2017</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">END_DATE</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2018</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">SD_PERIOD</span> <span class=\"o\">=</span> <span class=\"mi\">22</span>\n<span class=\"c1\"># This is for trading signal logic</span>\n<span class=\"n\">LOOK_BACK_PERIOD</span> <span class=\"o\">=</span> <span class=\"mi\">22</span>\n<span class=\"c1\"># This allows to trade on next day&#39;s open</span>\n<span class=\"n\">LOOK_FORWARD_PERIOD</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"n\">MA_SHORT_PERIOD</span> <span class=\"o\">=</span> <span class=\"mi\">5</span>\n<span class=\"n\">MA_LONG_PERIOD</span> <span class=\"o\">=</span> <span class=\"n\">SD_PERIOD</span>\n<span class=\"n\">TRIGGER_DISTANCE</span> <span class=\"o\">=</span> <span class=\"mi\">3</span>\n<span class=\"n\">STOP_ORDER_DISTANCE</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>\n<span class=\"n\">LIMIT_ORDER_DISTANCE</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>\n<span class=\"n\">ORDER_LIMIT</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span>\n<span class=\"n\">CAPITAL</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Magi</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span> <span class=\"o\">=</span> <span class=\"n\">xMan</span><span class=\"p\">(</span><span class=\"n\">CAPITAL</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dataHub</span> <span class=\"o\">=</span> <span class=\"n\">DataHub</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n        <span class=\"c1\"># Strategy config</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbols</span> <span class=\"o\">=</span> <span class=\"n\">SYMBOLS</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">startDate</span> <span class=\"o\">=</span> <span class=\"n\">START_DATE</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">endDate</span> <span class=\"o\">=</span> <span class=\"n\">END_DATE</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sdPeriod</span> <span class=\"o\">=</span> <span class=\"n\">SD_PERIOD</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookBackPeriod</span> <span class=\"o\">=</span> <span class=\"n\">LOOK_BACK_PERIOD</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookForwardPeriod</span> <span class=\"o\">=</span> <span class=\"n\">LOOK_FORWARD_PERIOD</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MAShortPeriod</span> <span class=\"o\">=</span> <span class=\"n\">MA_SHORT_PERIOD</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MALongPeriod</span> <span class=\"o\">=</span> <span class=\"n\">MA_LONG_PERIOD</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">triggerDistance</span> <span class=\"o\">=</span> <span class=\"n\">TRIGGER_DISTANCE</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">stopOrderDistance</span> <span class=\"o\">=</span> <span class=\"n\">STOP_ORDER_DISTANCE</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">limitOrderDistance</span> <span class=\"o\">=</span> <span class=\"n\">LIMIT_ORDER_DISTANCE</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderLimit</span> <span class=\"o\">=</span> <span class=\"n\">ORDER_LIMIT</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">capital</span> <span class=\"o\">=</span> <span class=\"n\">CAPITAL</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logConfig</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;He is my shield!&#39;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">logConfig</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi strategy config:&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;SYMBOLS; {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbols</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;START_DATE: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">startDate</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;END_DATE: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">endDate</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;SD_PERIOD: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sdPeriod</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;LOOK_BACK_PERIOD: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookBackPeriod</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;LOOK_FORWARD_PERIOD: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookForwardPeriod</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;MA_SHORT_PERIOD: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MAShortPeriod</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;MA_LONG_PERIOD: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MALongPeriod</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;TRIGGER_DISTANCE: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">triggerDistance</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;STOP_ORDER_DISTANCE: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">stopOrderDistance</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;LIMIT_ORDER_DISTANCE: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">limitOrderDistance</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;ORDER_LIMIT: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderLimit</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;CAPITAL: {}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">capital</span><span class=\"p\">))</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">setUpConfig</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">symbols</span><span class=\"o\">=</span><span class=\"n\">SYMBOLS</span><span class=\"p\">,</span> <span class=\"n\">startDate</span><span class=\"o\">=</span><span class=\"n\">START_DATE</span><span class=\"p\">,</span> <span class=\"n\">endDate</span><span class=\"o\">=</span><span class=\"n\">END_DATE</span><span class=\"p\">,</span> <span class=\"n\">sdPeriod</span><span class=\"o\">=</span><span class=\"n\">SD_PERIOD</span><span class=\"p\">,</span> <span class=\"n\">lookBackPeriod</span><span class=\"o\">=</span><span class=\"n\">LOOK_BACK_PERIOD</span><span class=\"p\">,</span> <span class=\"n\">lookForwardPeriod</span><span class=\"o\">=</span><span class=\"n\">LOOK_FORWARD_PERIOD</span><span class=\"p\">,</span> <span class=\"n\">MAShortPeriod</span><span class=\"o\">=</span><span class=\"n\">MA_SHORT_PERIOD</span><span class=\"p\">,</span> <span class=\"n\">MALongPeriod</span><span class=\"o\">=</span><span class=\"n\">MA_LONG_PERIOD</span><span class=\"p\">,</span> <span class=\"n\">triggerDistance</span><span class=\"o\">=</span><span class=\"n\">TRIGGER_DISTANCE</span><span class=\"p\">,</span> <span class=\"n\">stopOrderDistance</span><span class=\"o\">=</span><span class=\"n\">STOP_ORDER_DISTANCE</span><span class=\"p\">,</span> <span class=\"n\">limitOrderDistance</span><span class=\"o\">=</span><span class=\"n\">LIMIT_ORDER_DISTANCE</span><span class=\"p\">,</span> <span class=\"n\">orderLimit</span><span class=\"o\">=</span><span class=\"n\">ORDER_LIMIT</span><span class=\"p\">,</span> <span class=\"n\">capital</span><span class=\"o\">=</span><span class=\"n\">CAPITAL</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbols</span> <span class=\"o\">=</span> <span class=\"n\">symbols</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">startDate</span> <span class=\"o\">=</span> <span class=\"n\">startDate</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">endDate</span> <span class=\"o\">=</span> <span class=\"n\">endDate</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sdPeriod</span> <span class=\"o\">=</span> <span class=\"n\">sdPeriod</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookBackPeriod</span> <span class=\"o\">=</span> <span class=\"n\">lookBackPeriod</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookForwardPeriod</span> <span class=\"o\">=</span> <span class=\"n\">lookForwardPeriod</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MAShortPeriod</span> <span class=\"o\">=</span> <span class=\"n\">MAShortPeriod</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MALongPeriod</span> <span class=\"o\">=</span> <span class=\"n\">MALongPeriod</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">triggerDistance</span> <span class=\"o\">=</span> <span class=\"n\">triggerDistance</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">stopOrderDistance</span> <span class=\"o\">=</span> <span class=\"n\">stopOrderDistance</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">limitOrderDistance</span> <span class=\"o\">=</span> <span class=\"n\">limitOrderDistance</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderLimit</span> <span class=\"o\">=</span> <span class=\"n\">orderLimit</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">capital</span> <span class=\"o\">=</span> <span class=\"n\">capital</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logConfig</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">prepareSymbolData</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dataHub</span><span class=\"o\">.</span><span class=\"n\">downloadDataFromYahoo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">endDate</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbols</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getStartIndex</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sdPeriod</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookBackPeriod</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MAShortPeriod</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MALongPeriod</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getEndIndex</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookForwardPeriod</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">getOrderSize</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">price</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;Esitmate the order size based on the current price and order limit&#34;&#34;&#34;</span>\n        <span class=\"c1\">#TODO: We need to improve the logic</span>\n        <span class=\"k\">return</span> <span class=\"n\">math</span><span class=\"o\">.</span><span class=\"n\">floor</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">orderLimit</span> <span class=\"o\">/</span> <span class=\"n\">price</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">runStrategyOnMarketTick</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"p\">):</span>\n        <span class=\"s2\">&#34;&#34;&#34;\n</span><span class=\"s2\">        Run strategy for the marketTick given for a specific symbol.\n</span><span class=\"s2\">        The strategy probably also depends on past marketTicks, which need to be looked up in self.symbolData\n</span><span class=\"s2\">        Place orders based on strategy signals\n</span><span class=\"s2\">        &#34;&#34;&#34;</span>\n        <span class=\"c1\"># We do not execute strategy if we already have an open position.</span>\n        <span class=\"c1\">#position = self.xMan.getPositionBySymbol(marketTick.symbol)</span>\n        <span class=\"c1\">#if position and position.quantity != 0:</span>\n        <span class=\"c1\">#    return</span>\n\n        <span class=\"n\">ts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">][</span><span class=\"s1\">&#39;Close&#39;</span><span class=\"p\">]</span>\n        <span class=\"n\">sd</span> <span class=\"o\">=</span> <span class=\"n\">ts</span><span class=\"p\">[:</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sdPeriod</span><span class=\"p\">:]</span><span class=\"o\">.</span><span class=\"n\">std</span><span class=\"p\">()</span>\n        <span class=\"n\">highest</span> <span class=\"o\">=</span> <span class=\"n\">ts</span><span class=\"p\">[:</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookBackPeriod</span><span class=\"p\">:]</span><span class=\"o\">.</span><span class=\"nb\">max</span><span class=\"p\">()</span>\n        <span class=\"n\">lowest</span> <span class=\"o\">=</span> <span class=\"n\">ts</span><span class=\"p\">[:</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lookBackPeriod</span><span class=\"p\">:]</span><span class=\"o\">.</span><span class=\"nb\">min</span><span class=\"p\">()</span>\n        <span class=\"n\">MAShort</span> <span class=\"o\">=</span> <span class=\"n\">ts</span><span class=\"p\">[:</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MAShortPeriod</span><span class=\"p\">:]</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n        <span class=\"n\">MALong</span> <span class=\"o\">=</span> <span class=\"n\">ts</span><span class=\"p\">[:</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">MALongPeriod</span><span class=\"p\">:]</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n        <span class=\"n\">currPrice</span> <span class=\"o\">=</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">close</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">currPrice</span> <span class=\"o\">&lt;</span> <span class=\"n\">highest</span> <span class=\"o\">-</span> <span class=\"n\">sd</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">triggerDistance</span> <span class=\"ow\">and</span> <span class=\"n\">currPrice</span> <span class=\"o\">&gt;=</span> <span class=\"n\">MAShort</span><span class=\"p\">:</span>\n            <span class=\"n\">quantity</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getOrderSize</span><span class=\"p\">(</span><span class=\"n\">currPrice</span><span class=\"p\">)</span>\n            <span class=\"c1\">#TODO: Without knowledge of the next marketTick, we place orders based on current marketTick</span>\n            <span class=\"k\">if</span> <span class=\"n\">quantity</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">marketOrder</span> <span class=\"o\">=</span> <span class=\"n\">Order</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"n\">ORDER_DIRECTION_BUY</span><span class=\"p\">,</span> <span class=\"n\">ORDER_TYPE_MARKET</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"s1\">&#39;nan&#39;</span><span class=\"p\">),</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">placeOrder</span><span class=\"p\">(</span><span class=\"n\">marketOrder</span><span class=\"p\">)</span>\n                <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi: runStrategyOnMarketTick: TRIGGER BUY: Placed marketOrder={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">marketOrder</span><span class=\"p\">))</span>\n                <span class=\"n\">stopOrder</span> <span class=\"o\">=</span> <span class=\"n\">Order</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"n\">ORDER_DIRECTION_SELL</span><span class=\"p\">,</span> <span class=\"n\">ORDER_TYPE_STOP</span><span class=\"p\">,</span> <span class=\"n\">currPrice</span><span class=\"o\">-</span><span class=\"n\">sd</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">stopOrderDistance</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n                <span class=\"n\">limitOrder</span> <span class=\"o\">=</span> <span class=\"n\">Order</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"n\">ORDER_DIRECTION_SELL</span><span class=\"p\">,</span> <span class=\"n\">ORDER_TYPE_LIMIT</span><span class=\"p\">,</span> <span class=\"n\">currPrice</span> <span class=\"o\">+</span> <span class=\"n\">sd</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">limitOrderDistance</span><span class=\"p\">,</span> <span class=\"n\">quantity</span><span class=\"p\">,</span> <span class=\"n\">marketTick</span><span class=\"o\">.</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">linkOrders</span><span class=\"p\">([</span><span class=\"n\">stopOrder</span><span class=\"p\">,</span> <span class=\"n\">limitOrder</span><span class=\"p\">])</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">placeOrder</span><span class=\"p\">(</span><span class=\"n\">stopOrder</span><span class=\"p\">)</span>\n                <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi: runStrategyOnMarketTick: Placed stopOrder={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">stopOrder</span><span class=\"p\">))</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">placeOrder</span><span class=\"p\">(</span><span class=\"n\">limitOrder</span><span class=\"p\">)</span>\n                <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi: runStrategyOnMarketTick: Placed limitOrder={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">limitOrder</span><span class=\"p\">))</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi: runStrategyOnMarketTick: TRIGGER BUY, but cannot trade due to quantity=0, marketTick={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">run</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">prepareSymbolData</span><span class=\"p\">()</span>\n\n        <span class=\"c1\"># Determine trading range for running strategy. Exclude periods for strategy setup, endIdx Not inclusive</span>\n        <span class=\"n\">dtIndexes</span> <span class=\"o\">=</span> <span class=\"n\">pandas</span><span class=\"o\">.</span><span class=\"n\">date_range</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">startDate</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">endDate</span><span class=\"p\">,</span> <span class=\"n\">freq</span><span class=\"o\">=</span><span class=\"s1\">&#39;B&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">startIdx</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getStartIndex</span><span class=\"p\">()</span>\n        <span class=\"n\">endIdx</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">getEndIndex</span><span class=\"p\">()</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi: run: startIdx={}, endIdx={}&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">startIdx</span><span class=\"p\">,</span> <span class=\"n\">endIdx</span><span class=\"p\">))</span>\n\n        <span class=\"k\">for</span> <span class=\"n\">dtIdx</span> <span class=\"ow\">in</span> <span class=\"n\">dtIndexes</span><span class=\"p\">:</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;------------------------------------------------------------&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Execute existing orders and run strategy for today&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;------------------------------------------------------------&#39;</span><span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">symbol</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n                <span class=\"k\">if</span> <span class=\"n\">dtIdx</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">[</span><span class=\"n\">startIdx</span><span class=\"p\">:]</span> <span class=\"k\">if</span> <span class=\"n\">endIdx</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">[</span><span class=\"n\">startIdx</span><span class=\"p\">:</span> <span class=\"n\">endIdx</span><span class=\"p\">]):</span>\n                    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s1\">&#39;Magi: run: dtIdx={}: Cannot trade, outside strategy running period&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">dtIdx</span><span class=\"p\">))</span>\n                    <span class=\"k\">continue</span>\n\n                <span class=\"c1\"># Construct marketTick for this tradingDate</span>\n                <span class=\"nb\">open</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">dtIdx</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Open&#39;</span><span class=\"p\">]</span>\n                <span class=\"n\">close</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">dtIdx</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Close&#39;</span><span class=\"p\">]</span>\n                <span class=\"n\">high</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">dtIdx</span><span class=\"p\">,</span> <span class=\"s1\">&#39;High&#39;</span><span class=\"p\">]</span>\n                <span class=\"n\">low</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">dtIdx</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Low&#39;</span><span class=\"p\">]</span>\n                <span class=\"n\">volume</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">symbolData</span><span class=\"p\">[</span><span class=\"n\">symbol</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">dtIdx</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Volume&#39;</span><span class=\"p\">]</span>\n                <span class=\"n\">marketTick</span> <span class=\"o\">=</span> <span class=\"n\">MarketTick</span><span class=\"p\">(</span><span class=\"n\">symbol</span><span class=\"p\">,</span> <span class=\"nb\">open</span><span class=\"p\">,</span> <span class=\"n\">close</span><span class=\"p\">,</span> <span class=\"n\">high</span><span class=\"p\">,</span> <span class=\"n\">low</span><span class=\"p\">,</span> <span class=\"n\">volume</span><span class=\"p\">,</span> <span class=\"n\">dtIdx</span><span class=\"p\">)</span>\n\n                <span class=\"c1\"># Execute existing orders from previous tradingPeriod. In reality, this happens during current tradingPeriod.</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">executeOrdersOnMarketTick</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"p\">)</span>\n\n                <span class=\"c1\"># Run strategy on current tradingPeriod. In reality, this happens immediately after current tradingPeriod.</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">runStrategyOnMarketTick</span><span class=\"p\">(</span><span class=\"n\">marketTick</span><span class=\"p\">)</span>\n\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;------------------------------------------------------------&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Performance Summary for today&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;------------------------------------------------------------&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">evaluatePerformance</span><span class=\"p\">()</span>\n            <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;============================================================&#39;</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">xMan</span><span class=\"o\">.</span><span class=\"n\">describeTradesExecutedByDatetime</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">():</span>\n    <span class=\"s2\">&#34;&#34;&#34;Main function&#34;&#34;&#34;</span>\n    <span class=\"c1\">#logging.basicConfig(format=&#39;%(asctime)s %(levelname)s: %(message)s&#39;, level=logging.INFO)</span>\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">basicConfig</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"s1\">&#39;Magi_{0}.log&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s1\">&#39;%Y-%m-</span><span class=\"si\">%d</span><span class=\"s1\">_%H-%M-%S&#39;</span><span class=\"p\">)),</span> <span class=\"n\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;</span><span class=\"si\">%(levelname)s</span><span class=\"s1\">: </span><span class=\"si\">%(message)s</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"o\">=</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">)</span>\n    <span class=\"n\">magi</span> <span class=\"o\">=</span> <span class=\"n\">Magi</span><span class=\"p\">()</span>\n    <span class=\"n\">magi</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">:</span>\n    <span class=\"s2\">&#34;&#34;&#34;Entry point&#34;&#34;&#34;</span>\n<span class=\"n\">main</span><span class=\"p\">()</span></code></pre></div><p></p>", 
            "topic": [
                {
                    "tag": "Python", 
                    "tagLink": "https://api.zhihu.com/topics/19552832"
                }, 
                {
                    "tag": "量化交易", 
                    "tagLink": "https://api.zhihu.com/topics/19815465"
                }, 
                {
                    "tag": "交易策略", 
                    "tagLink": "https://api.zhihu.com/topics/20003503"
                }
            ], 
            "comments": [
                {
                    "userName": "夏宇的迷弟", 
                    "userLink": "https://www.zhihu.com/people/9d9a568581d493538ed8171148620044", 
                    "content": "<p>冗余代码一大堆，写的合理，没几行。而且命名也不规范。</p>", 
                    "likes": 0, 
                    "childComments": []
                }
            ]
        }
    ], 
    "url": "https://zhuanlan.zhihu.com/c_173330477"
}
